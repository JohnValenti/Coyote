<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>TraceChunk.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.ejb.bbm.timeseries.model</a> &gt; <span class="el_source">TraceChunk.java</span></div><h1>TraceChunk.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.ejb.bbm.timeseries.model;

import java.io.Externalizable;
import java.io.IOException;
import java.io.ObjectInput;
import java.io.ObjectOutput;
import java.util.Arrays;
import java.util.Date;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.ejb.bbm.timeseries.util.TraceUtil;

/**
 * Title: Blue Pumpkin Software Basic Business Model Description: TraceChunk
 * object, BPX uses this to insert all traces at one point for BPDE Copyright:
 * Copyright (c) 2002 Company: Blue Pumpkin Software, inc
 * 
 * @author Sheng Song
 * @version 2.0
 */

public class TraceChunk extends Trace implements Comparable&lt;TraceChunk&gt;, Externalizable {
	private static final long serialVersionUID = 1L;

<span class="pc" id="L25">	private float[] m_TraceValue = new float[Trace.MAX_TYPE];</span>

<span class="pc" id="L27">	private Date m_LastModifiedAt = new Date();</span>

	public TraceChunk() {
<span class="nc" id="L30">		super();</span>
<span class="nc" id="L31">		initTrace();</span>
<span class="nc" id="L32">	}</span>

	/**
	 * TraceChunk intends to be a container for Traces happening at the same
	 * point Once the object is created, these two basic values are not to be
	 * changed The constructor will normalize the StartDate to mid-night
	 * 
	 * @param ID
	 *            , queueID
	 * @param Date
	 *            , startDate, any time
	 */
<span class="fc" id="L44">	public TraceChunk(ID queueID, Date startDate) {</span>
<span class="fc" id="L45">		m_QueueID = queueID;</span>
<span class="fc" id="L46">		m_StartDate = TraceUtil.snapDate(startDate);</span>
<span class="fc" id="L47">		initTrace();</span>
<span class="fc" id="L48">	}</span>

	/**
	 * getTraceTypes, return Types that has non -1 value
	 * 
	 * @return short[]
	 */
	public short[] getTraceTypes() {
<span class="nc" id="L56">		short size = 0;</span>
<span class="nc bnc" id="L57" title="All 2 branches missed.">		for (short i = 0; i &lt; Trace.MAX_TYPE; i++) {</span>
<span class="nc bnc" id="L58" title="All 2 branches missed.">			if (m_TraceValue[i] != TRACENA) {</span>
<span class="nc" id="L59">				size++;</span>
			}
		}
<span class="nc bnc" id="L62" title="All 2 branches missed.">		if (size == 0) {</span>
<span class="nc" id="L63">			return null;</span>
		}
<span class="nc" id="L65">		short[] types = new short[size];</span>
<span class="nc bnc" id="L66" title="All 2 branches missed.">		for (short i = 0, j = 0; i &lt; Trace.MAX_TYPE; i++) {</span>
<span class="nc bnc" id="L67" title="All 2 branches missed.">			if (m_TraceValue[i] != TRACENA) {</span>
<span class="nc" id="L68">				types[j] = i;</span>
<span class="nc" id="L69">				j++;</span>
			}
		}
<span class="nc" id="L72">		return types;</span>
	}

	/**
	 * getTraceValue, based on the type
	 * 
	 * @param short, Trace Type definition
	 * @return float, Trace value, -1 means Unknown
	 */
	public float getTraceValue(short type) {
<span class="pc bpc" id="L82" title="2 of 4 branches missed.">		if (type &gt;= 0 &amp;&amp; type &lt; Trace.MAX_TYPE) {</span>
<span class="fc" id="L83">			return m_TraceValue[type];</span>
		}
<span class="nc" id="L85">		return TRACENA;</span>
	}

	/**
	 * quickly return all values in float[]
	 * 
	 * @return float[], all trace types value
	 */
	public float[] getTraceValues() {
<span class="nc" id="L94">		return m_TraceValue;</span>
	}

	/**
	 * quickly return all values in float[]
	 * 
	 * @return float[], all trace types value
	 */
	public float[] getTraceValues(short[] types) {
<span class="fc" id="L103">		float[] values = new float[types.length];</span>
<span class="fc bfc" id="L104" title="All 2 branches covered.">		for (int i = 0; i &lt; types.length; i++) {</span>
<span class="fc" id="L105">			values[i] = m_TraceValue[types[i]];</span>
		}
<span class="fc" id="L107">		return values;</span>
	}

	/**
	 * setTraceValue, set Trace value for each Type one by one
	 * 
	 * @param short, Trace Type definition
	 * @param float, Trace Value
	 */
	public void setTraceValue(short type, float value) {
<span class="pc bpc" id="L117" title="2 of 4 branches missed.">		if (type &gt;= 0 &amp;&amp; type &lt; Trace.MAX_TYPE) {</span>
<span class="fc" id="L118">			m_TraceValue[type] = value;</span>
		}
<span class="fc" id="L120">		m_LastModifiedAt = new Date();</span>
<span class="fc" id="L121">	}</span>

	/**
	 * setTraceValues, set Trace value as an Array
	 * 
	 * @param short[], Trace Type definition for each Trace Value
	 * @param float[], Trace value corresponding to the Trace Type
	 */
	public void setTraceValues(short[] types, float[] values) {
<span class="nc bnc" id="L130" title="All 2 branches missed.">		for (int i = 0; i &lt; types.length; i++) {</span>
			// Early termination, if values are less than types
<span class="nc bnc" id="L132" title="All 2 branches missed.">			if (i == values.length) {</span>
<span class="nc" id="L133">				break;</span>
			}
<span class="nc" id="L135">			setTraceValue(types[i], values[i]);</span>
		}
<span class="nc" id="L137">	}</span>

	/**
	 * setTraceValues, set Trace value as an Array
	 * 
	 * @param short[], Trace Type definition for each Trace Value
	 * @param int[], Trace value corresponding to the Trace Type
	 */
	public void setTraceValues(short[] types, int[] values) {
<span class="nc bnc" id="L146" title="All 2 branches missed.">		for (int i = 0; i &lt; types.length; i++) {</span>
			// Early termination, if values are less than types
<span class="nc bnc" id="L148" title="All 2 branches missed.">			if (i == values.length) {</span>
<span class="nc" id="L149">				break;</span>
			}
<span class="nc" id="L151">			setTraceValue(types[i], values[i]);</span>
		}
<span class="nc" id="L153">	}</span>

	/**
	 * setTraceValues, set Trace value as an Array
	 * 
	 * @param short[], Trace Type definition for each Trace Value
	 * @param double[], Trace value corresponding to the Trace Type
	 */
	public void setTraceValues(short[] types, double[] values) {
<span class="nc bnc" id="L162" title="All 2 branches missed.">		for (int i = 0; i &lt; types.length; i++) {</span>
			// Early termination, if values are less than types
<span class="nc bnc" id="L164" title="All 2 branches missed.">			if (i == values.length) {</span>
<span class="nc" id="L165">				break;</span>
			}
<span class="nc" id="L167">			setTraceValue(types[i], (float) values[i]);</span>
		}
<span class="nc" id="L169">	}</span>

	public Date getLastModifedDate() {
<span class="nc" id="L172">		return m_LastModifiedAt;</span>
	}

	public void setLastModifiedDate(Date date) {
<span class="nc" id="L176">		m_LastModifiedAt = date;</span>
<span class="nc" id="L177">	}</span>

	// Convert TraceChunk into a String
	public String toString() {
<span class="nc" id="L181">		StringBuffer sb = new StringBuffer(100);</span>
<span class="nc" id="L182">		sb.append(&quot;TraceChunk&quot;);</span>
<span class="nc bnc" id="L183" title="All 2 branches missed.">		if (getQueueID() != null) {</span>
<span class="nc" id="L184">			sb.append(&quot;\t&quot;).append(&quot;Queue ID: &quot; + getQueueID());</span>
		}
<span class="nc bnc" id="L186" title="All 2 branches missed.">		if (getStartDate() != null) {</span>
<span class="nc" id="L187">			sb.append(&quot;\t&quot;).append(&quot;Started at: &quot; + getStartDate());</span>
		}
<span class="nc" id="L189">		sb.append(&quot;\n&quot;);</span>
<span class="nc bnc" id="L190" title="All 2 branches missed.">		for (int i = 0; i &lt; m_TraceValue.length; i++) {</span>
<span class="nc" id="L191">			sb.append(&quot;\t&quot;).append(getTraceName((short) i)).append(&quot; has &quot;).append(m_TraceValue[i]);</span>
		}
<span class="nc bnc" id="L193" title="All 2 branches missed.">		if (m_LastModifiedAt != null) {</span>
<span class="nc" id="L194">			sb.append(&quot;, last modified at: &quot;).append(m_LastModifiedAt);</span>
		}
<span class="nc" id="L196">		sb.append(&quot;\n&quot;);</span>
<span class="nc" id="L197">		return sb.toString();</span>
	}
	
	@Override
	public int hashCode() {
<span class="nc" id="L202">		int result = 17;</span>
<span class="nc bnc" id="L203" title="All 2 branches missed.">		result = 31 * result + (getQueueID() == null ? 0 : getQueueID().hashCode());</span>
<span class="nc bnc" id="L204" title="All 2 branches missed.">		result = 31 * result + (getStartDate() == null ? 0 : getStartDate().hashCode());</span>
<span class="nc" id="L205">		return result;</span>
	}

	@Override
	public boolean equals(Object obj) {
<span class="nc bnc" id="L210" title="All 2 branches missed.">		if (obj instanceof TraceChunk) {</span>
<span class="nc" id="L211">			TraceChunk tc = (TraceChunk) obj;</span>
<span class="nc" id="L212">			ID qID = getQueueID();</span>
<span class="nc" id="L213">			ID tcQID = tc.getQueueID();</span>
<span class="nc bnc" id="L214" title="All 4 branches missed.">			if (qID == null || tcQID == null) {</span>
<span class="nc" id="L215">				return false;</span>
			}
<span class="nc bnc" id="L217" title="All 2 branches missed.">			if (qID.equals(tcQID)) {</span>
<span class="nc" id="L218">				Date date1 = getStartDate();</span>
<span class="nc" id="L219">				Date date2 = tc.getStartDate();</span>
<span class="nc bnc" id="L220" title="All 4 branches missed.">				if (date1 == null || date2 == null) {</span>
<span class="nc" id="L221">					return false;</span>
				}
<span class="nc bnc" id="L223" title="All 2 branches missed.">				if (!date1.equals(date2)) {</span>
<span class="nc" id="L224">					return false;</span>
				} else {
<span class="nc" id="L226">					return true;</span>
				}
			}
		}
<span class="nc" id="L230">		return false;</span>
	}

	@Override
	public int compareTo(TraceChunk obj) {
<span class="nc" id="L235">		TraceChunk tc = obj;</span>
<span class="nc" id="L236">		Date date1 = getStartDate();</span>
<span class="nc" id="L237">		Date date2 = tc.getStartDate();</span>
<span class="nc bnc" id="L238" title="All 4 branches missed.">		if (date1 == null || date2 == null) {</span>
<span class="nc" id="L239">			return 1;</span>
		}
<span class="nc bnc" id="L241" title="All 2 branches missed.">		if (date1.before(date2)) {</span>
<span class="nc" id="L242">			return TRACENA;</span>
<span class="nc bnc" id="L243" title="All 2 branches missed.">		} else if (date1.after(date2)) {</span>
<span class="nc" id="L244">			return 1;</span>
		} else {
<span class="nc" id="L246">			return 0;</span>
		}
	}

	// Internal function to preset TraceValue to -1
	private void initTrace() {
<span class="fc" id="L252">		Arrays.fill(m_TraceValue, TRACENA);</span>
<span class="fc" id="L253">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see java.io.Externalizable#readExternal(java.io.ObjectInput)
	 */
	public void readExternal(ObjectInput in) throws IOException, ClassNotFoundException {
<span class="nc" id="L261">		m_QueueID = (ID) in.readObject();</span>
<span class="nc" id="L262">		m_StartDate = (Date) in.readObject();</span>
<span class="nc" id="L263">		m_LastModifiedAt = (Date) in.readObject();</span>
<span class="nc" id="L264">		m_TraceValue = (float[]) in.readObject();</span>

<span class="nc" id="L266">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see java.io.Externalizable#writeExternal(java.io.ObjectOutput)
	 */
	public void writeExternal(ObjectOutput out) throws IOException {
<span class="nc" id="L274">		out.writeObject(m_QueueID);</span>
<span class="nc" id="L275">		out.writeObject(m_StartDate);</span>
<span class="nc" id="L276">		out.writeObject(m_LastModifiedAt);</span>
<span class="nc" id="L277">		out.writeObject(m_TraceValue);</span>
<span class="nc" id="L278">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>