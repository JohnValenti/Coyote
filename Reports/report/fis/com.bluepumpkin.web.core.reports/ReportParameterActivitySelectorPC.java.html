<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>ReportParameterActivitySelectorPC.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.core.reports</a> &gt; <span class="el_source">ReportParameterActivitySelectorPC.java</span></div><h1>ReportParameterActivitySelectorPC.java</h1><pre class="source lang-java linenums">/**
 * Title: ReportParametersPCInterface Description: Common interface for all Page Components which
 * will be handling Report Parameters Copyright: Copyright (c) 2005 Company: Witness, Inc
 * 
 * @author Tom Nevin, tnevin@witness.com
 * @version 1.0 Created on August 18, 2005
 */
package com.bluepumpkin.web.core.reports;

import java.util.List;

import javax.servlet.http.HttpServletRequest;

import org.w3c.dom.Node;

import com.bluepumpkin.common.datatypes.StringsPair;
import com.bluepumpkin.common.util.StringUtil;
import com.bluepumpkin.web.bbm.activity.selection.ActivitySelectorPC;
import com.bluepumpkin.web.core.l10n.ReportParameterBundleKey;
import com.bluepumpkin.web.ireport.framework.RffParameter;
import com.bluepumpkin.web.ireport.framework.RffRequest;
import com.witness.web.uif.l10n.UIFWebBundleKey;
import com.witness.web.uif.pagecomponent.toolbar.ToolbarPC;
import com.witness.web.uif.system.RequestContext;

public class ReportParameterActivitySelectorPC extends ActivitySelectorPC implements
				ReportParametersPCInterface {

	private static final String ALL_TIMEOFF_ACTIVITIES_VALUE = ReportsParametersModelHandler.ALL_TIMEOFF_ACTIVITIES_VALUE;
	private static final String DEFAULT_NOT_SET_VALUE = ReportParametersDesignPC.DEFAULT_NOT_SET_VALUE;
	private static final String DELIM = ReportParametersDesignPC.DELIM;

<span class="nc" id="L33">	private ReportControlsXml reportControls = ReportControlsXml.getInstance();</span>
<span class="nc" id="L34">	private ReportParameterUtil reportUtil = ReportParameterUtil.getInstance();</span>

	/**
	 * This constructor passes on most of it's work to super classes, however the name of the page
	 * component is set at this time. The component name often matches the parameter name.
	 * 
	 * @param context the composite of the servlet information, the servlet request, servlet
	 *            response, session context, etc.
	 * @param toolbar
	 * @param controlNode the child with in the controls document which contains the information
	 *            regarding this PC component (i.e. Report Control).
	 */
	public ReportParameterActivitySelectorPC(RequestContext context, ToolbarPC toolbar,
					Node controlNode) {
<span class="nc" id="L48">		super(context, toolbar);</span>

<span class="nc" id="L50">		setName(reportControls.getControlSingleParameterName(controlNode));</span>
<span class="nc" id="L51">		setIsRequired(reportControls.isControlRequired(controlNode));</span>
<span class="nc" id="L52">	}</span>

	/**
	 * Returns the displayable label for the assigned report parameter. The label should be in the
	 * proper locale.
	 * 
	 * @param rff the report framework request, which contains all the parameters, is not needed in
	 *            single parameter ReportParametersPCIntereface's.
	 * @param controlNode the child with in the controls document which contains the information
	 *            regarding this PC component (i.e. Report Control).
	 * @return the displayable report label.
	 */
	public String getLabel(RffRequest rff, Node controlNode) {
<span class="nc" id="L65">		String label = reportControls.getControlLabel(controlNode);</span>
<span class="nc bnc" id="L66" title="All 4 branches missed.">		if (label == null || label.length() == 0) {</span>
<span class="nc" id="L67">			label = ReportParameterBundleKey.ACTIVITIES_KEY;</span>
		}
<span class="nc" id="L69">		return label;</span>
	}

	/**
	 * Returns the HTML source for the implementation of the page component, corresponding to the
	 * specified frame work parameter and control data. &lt;br&gt;
	 * Special processing is required if the HTTP parameter is stored, as a single string separated
	 * by a comma (DELIM).
	 * 
	 * @param rff the report framework request, which contains all the parameters.
	 * @param controlNode the child with in the controls document which contains the information
	 *            regarding this PC component (i.e. Report Control).
	 * @return the HTML source for the input control
	 */
	public String getHtmlDisplay(RffRequest rff, Node controlNode) {
<span class="nc" id="L84">		return getHtmlDisplay(rff, controlNode, false);</span>
	}

	/* (non-Javadoc)
	 * @see com.bluepumpkin.web.core.reports.ReportParametersPCInterface#getHtmlDisplay(com.bluepumpkin.web.ireport.framework.RffRequest, org.w3c.dom.Node, boolean)
	 */
	public String getHtmlDisplay(RffRequest rff, Node controlNode,
			boolean readOnly) {
<span class="nc bnc" id="L92" title="All 2 branches missed.">		if (reportControls.hasSingleParameter(controlNode) == false) {</span>
<span class="nc" id="L93">			throw new IllegalArgumentException(&quot;Can only handle single report parameter.&quot;);</span>
		}
<span class="nc" id="L95">		Node paramNode = reportControls.getParameter(controlNode);</span>
<span class="nc bnc" id="L96" title="All 2 branches missed.">		if (paramNode == null) {</span>
<span class="nc" id="L97">			throw new IllegalArgumentException(&quot;A parameter was not specified for this control.&quot;);</span>
		}
<span class="nc" id="L99">		String paramName = reportControls.getParameterName(paramNode);</span>
<span class="nc" id="L100">		String optionType = reportControls.getControlFilterMethod(controlNode);</span>
<span class="nc" id="L101">		boolean isInString = reportControls.isParameterInString(paramNode);</span>

<span class="nc" id="L103">		RffParameter param = rff.getRffParameter(paramName);</span>
<span class="nc" id="L104">		Object currentValues[] = null;</span>
<span class="nc bnc" id="L105" title="All 2 branches missed.">		if (param != null) {</span>
<span class="nc" id="L106">			currentValues = param.getCurrentValues();</span>
		}
<span class="nc bnc" id="L108" title="All 6 branches missed.">		if (isInString &amp;&amp; currentValues != null &amp;&amp; currentValues.length &gt; 0) {</span>
<span class="nc" id="L109">			String strValue = currentValues[0].toString();</span>
<span class="nc" id="L110">			currentValues = StringUtil.parseStringToArray(strValue, DELIM);</span>
		}

<span class="nc" id="L113">		String html = reportUtil.getHtmlDisplay(this, m_context, currentValues, paramNode,</span>
<span class="nc" id="L114">						optionType, rff.getParentId(), readOnly);</span>
<span class="nc bnc" id="L115" title="All 2 branches missed.">		if (html == null) {</span>
<span class="nc" id="L116">			return i18n(m_common_bundle, UIFWebBundleKey.NONE);</span>
		}
<span class="nc" id="L118">		return html;</span>
	}

	/**
	 * Assigns to the RFF request the values of the servlet request, these value will have been the
	 * user entered data. The RFF parameter will be those assigned thru the setRffParameter or the
	 * setRffRequest methods. Simply, extract the parameters from the HTTP request and put them in
	 * the report framework, for use by the reporting system. &lt;br&gt;
	 * Special processing is required if the HTTP parameter is stored, as a single string separated
	 * by a comma (DELIM). In addition, if one of the selections is the ALL value then set it in the
	 * RFF and leave, don't need to press the any other parameters.
	 * 
	 * @param request the HTTP request in which parameters are to be retrieved.
	 * @param rff the report framework request which contains the RFF parameters where the data is
	 *            to be placed.
	 * @param controlNode the child with in the controls document which contains the information
	 *            regarding this PC component (i.e. Report Control).
	 */
	public void setRffParameterValue(HttpServletRequest request, RffRequest rff, Node controlNode) {
<span class="nc bnc" id="L137" title="All 2 branches missed.">		if (reportControls.hasSingleParameter(controlNode) == false) {</span>
<span class="nc" id="L138">			throw new IllegalArgumentException(&quot;Can only handle single report parameter.&quot;);</span>
		}
<span class="nc" id="L140">		Node paramNode = reportControls.getParameter(controlNode);</span>
<span class="nc bnc" id="L141" title="All 2 branches missed.">		if (paramNode == null) {</span>
<span class="nc" id="L142">			throw new IllegalArgumentException(&quot;A parameter was not specified for this control.&quot;);</span>
		}
<span class="nc" id="L144">		String paramName = reportControls.getParameterName(paramNode);</span>
<span class="nc" id="L145">		RffParameter param = rff.getRffParameter(paramName);</span>
<span class="nc bnc" id="L146" title="All 2 branches missed.">		if (param == null) {</span>
<span class="nc" id="L147">			throw new IllegalArgumentException(&quot;Parameter in controls but not in report: &quot;</span>
							+ paramName);
		}
<span class="nc" id="L150">		String paramValues[] = request.getParameterValues(paramName);</span>
<span class="nc" id="L151">		String currentValues[] = paramValues;</span>
<span class="nc" id="L152">		StringBuffer displayValue = new StringBuffer();</span>
<span class="nc" id="L153">		String optionType = reportControls.getControlFilterMethod(controlNode);</span>
<span class="nc" id="L154">		List options = reportUtil.getOptions(m_context, paramNode, optionType, rff.getParentId());</span>

<span class="nc bnc" id="L156" title="All 4 branches missed.">		if (paramValues == null || paramValues.length == 0) {</span>
<span class="nc" id="L157">			currentValues = new String[] { DEFAULT_NOT_SET_VALUE };</span>

<span class="nc bnc" id="L159" title="All 2 branches missed.">		} else if (reportControls.isParameterInString(paramNode)) {</span>
<span class="nc" id="L160">			StringBuffer strValue = new StringBuffer();</span>
<span class="nc bnc" id="L161" title="All 2 branches missed.">			for (int iValue = 0; iValue &lt; paramValues.length; iValue++) {</span>
<span class="nc" id="L162">				String activityValue = paramValues[iValue];</span>
				// Just pass &quot;ALL&quot; back to report if it if selected
<span class="nc bnc" id="L164" title="All 2 branches missed.">				if (ALL_TIMEOFF_ACTIVITIES_VALUE.equals(activityValue)) {</span>
<span class="nc" id="L165">					strValue = new StringBuffer(ALL_TIMEOFF_ACTIVITIES_VALUE);</span>
<span class="nc" id="L166">					displayValue = new StringBuffer(ALL_TIMEOFF_ACTIVITIES_VALUE);</span>
<span class="nc" id="L167">					break;</span>
				}
<span class="nc bnc" id="L169" title="All 2 branches missed.">				if (iValue &gt; 0) {</span>
<span class="nc" id="L170">					strValue.append(DELIM);</span>
<span class="nc" id="L171">					displayValue.append(DELIM);</span>
				}
<span class="nc" id="L173">				strValue.append(activityValue);</span>
<span class="nc" id="L174">				displayValue.append(findActivityName(options, activityValue));</span>
			}
<span class="nc" id="L176">			currentValues = new String[] { strValue.toString() };</span>
		}
<span class="nc" id="L178">		param.setCurrentValues(currentValues);</span>

<span class="nc" id="L180">		String displayParamName = reportControls.getParameterDisplayName(paramNode);</span>
<span class="nc" id="L181">		RffParameter displayParam = rff.getRffParameter(displayParamName);</span>
<span class="nc bnc" id="L182" title="All 4 branches missed.">		if (displayParam != null &amp;&amp; displayValue.length() &gt; 0) {</span>
<span class="nc" id="L183">			displayParam.setCurrentValue(displayValue.toString());</span>
		}
<span class="nc" id="L185">	}</span>

	private String findActivityName(List options, String key) {
<span class="nc bnc" id="L188" title="All 2 branches missed.">		for (int i = 0; i &lt; options.size(); i++) {</span>
<span class="nc" id="L189">			StringsPair pair = (StringsPair) options.get(i);</span>
<span class="nc bnc" id="L190" title="All 2 branches missed.">			if (key.equals(pair.getKey())) {</span>
<span class="nc" id="L191">				return pair.getValue();</span>
			}
		}
<span class="nc" id="L194">		return null;</span>
	}

	/**
	 * Return any custom java-script for the PC, the custom java script must be a block of
	 * java-script code which will be inserted into the initialization java-script method.
	 * 
	 * @param controlNode the child with in the controls document which contains the information
	 *            regarding this PC component (i.e. Report Control).
	 * @return bock of java script code.
	 */

	public String getCustomJavaScript(Node controlNode) {
<span class="nc" id="L207">		return null;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>