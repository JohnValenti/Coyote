<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>RfsDBConnection.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.verint.ejb.rfs.dbconfig</a> &gt; <span class="el_source">RfsDBConnection.java</span></div><h1>RfsDBConnection.java</h1><pre class="source lang-java linenums">package com.verint.ejb.rfs.dbconfig;
/**
 * Title:        RfsDBConnection
 * Description:  Database connection info for RFS Forecaster reports 
 * Copyright:    Copyright (c) 2013
 * Company:      Verint Systems, Inc
 * @author       Amritha Nuthi
 * @version 	 1.0
 */
import java.io.IOException;

import com.bluepumpkin.common.base.Log;
import com.bluepumpkin.common.jdmo.Jdmo;
import com.bluepumpkin.common.jdmo.JdmoRowset;
import com.bluepumpkin.common.logging.Category;
import com.bluepumpkin.ejb.bbm.config.model.ConfigDAO;
import com.witness.common.apps.util.CCLEncryptionUtil;

public class RfsDBConnection 
{
<span class="nc" id="L21">    protected static Category cat = Log.initCategory( RfsDBConnection.class.getName() );</span>

	protected static final String RFS_FORECASTER_DS = &quot;verint/ssrs/rfsForecasterDataSource&quot;;
	protected static final String IMSA_USER_NAME = &quot;framework/report/CognosAdminName&quot;;
	protected static final String IMSA_PASSWORD = &quot;framework/report/CognosAdminPassword&quot;;
	
	protected static final String SELECT_BPCONFIG_VALUE = &quot;select VALUE from BPCONFIG where NAME=&quot;;

<span class="nc" id="L29">    String sDataSource = null;</span>
<span class="nc" id="L30">    boolean bWinAuth = true;</span>

	private String driverName;
	private String driverUrl;
	private String adminUsername;
	private String adminPassword;

<span class="nc" id="L37">   public RfsDBConnection() throws IOException {    	</span>
<span class="nc" id="L38">        setupMssql();</span>
<span class="nc" id="L39">    }</span>

    public void initialize() throws IOException {     	 
<span class="nc" id="L42">         setupMssql();</span>
<span class="nc" id="L43">    }</span>
      
    protected void setupMssql() throws IOException {
<span class="nc" id="L46">        this.driverName = net.sourceforge.jtds.jdbc.Driver.class.getName();</span>
<span class="nc" id="L47">        this.adminUsername = getConfigValue(IMSA_USER_NAME); </span>
<span class="nc" id="L48">        cat.info(&quot;IMSA User Name: &quot; + adminUsername);</span>
<span class="nc" id="L49">        this.adminPassword = CCLEncryptionUtil.decrypt(getConfigValue(IMSA_PASSWORD));</span>
<span class="nc" id="L50">        String rfsDS = getConfigValue(RFS_FORECASTER_DS);</span>
<span class="nc" id="L51">        this.driverUrl  = &quot;jdbc:jtds:sqlserver://&quot; + rfsDS.substring(0,rfsDS.indexOf(&quot;/&quot;)) + &quot;;DatabaseName=&quot; + rfsDS.substring(rfsDS.indexOf(&quot;/&quot;)+1);</span>
<span class="nc" id="L52">        this.driverUrl += &quot;;useNTLMv2=true&quot;;</span>
<span class="nc" id="L53">        this.driverUrl += &quot;;domain=&quot;+adminUsername.substring(0,adminUsername.indexOf(&quot;\\&quot;))+&quot;;&quot;;        </span>
<span class="nc" id="L54">        this.adminUsername = adminUsername.substring(adminUsername.indexOf(&quot;\\&quot;)+1);</span>
<span class="nc" id="L55">        cat.info(&quot;Driver URL &quot; + driverUrl);</span>
       // cat.info(&quot;IMSA Pwd : &quot; + ConfigDAO.decryptBpConfigValue(adminPassword));
<span class="nc" id="L57">     }</span>
    
    private String getConfigValue(String name)  {
<span class="nc" id="L60">		Jdmo jdmo = new Jdmo(false);</span>
<span class="nc" id="L61">		cat.debug(&quot; In RFS getConfig value&quot; + jdmo.toString());</span>
		JdmoRowset rs;
<span class="nc" id="L63">		String query = SELECT_BPCONFIG_VALUE + getQuotedString(name);</span>
<span class="nc" id="L64">		String value = null;</span>
		try {
<span class="nc" id="L66">			rs = jdmo.createRowset(query);</span>
<span class="nc bnc" id="L67" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L68">				value = rs.getString(1);</span>
			}
			
		}	
<span class="nc" id="L72">		catch(Exception e) {</span>
<span class="nc" id="L73">			cat.error(&quot;Error in getConfigValue() &quot;, e);</span>
		}		
		finally {
<span class="nc bnc" id="L76" title="All 6 branches missed.">				if (jdmo!=null) jdmo.cleanUp(); jdmo = null;</span>
<span class="nc" id="L77">		}</span>
		//cat.info(&quot;BPConfigvalue for &quot; + name + &quot; is : &quot; + value);
<span class="nc" id="L79">		return value;</span>
	}
	
	private String getQuotedString (String s) {
<span class="nc" id="L83">		return new String(&quot;'&quot;+s+&quot;'&quot;);</span>
	}
	
	public Jdmo getJdmoInstance() throws Exception {		
<span class="nc" id="L87">		Jdmo jdmo = new Jdmo(driverName, driverUrl, adminUsername, adminPassword);</span>
		//Jdmo jdmo = 
		//	new Jdmo(driverName,
		//	&quot;jdbc:jtds:sqlserver://sd-automation:1433;DatabaseName=mike-sdqa-11.0.5;instance=MSSQLSERVER;useNTLMv2=true;domain=lab&quot;,
		//	&quot;qaadmin&quot;,&quot;pumpkin&quot;);
<span class="nc" id="L92">		cat.info(&quot;Jdmo instance &quot; + jdmo);</span>
<span class="nc" id="L93">		return jdmo;</span>
	}	
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>