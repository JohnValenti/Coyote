<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>MediaTypesSetupPageModel.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.core.setup.mediatypes</a> &gt; <span class="el_source">MediaTypesSetupPageModel.java</span></div><h1>MediaTypesSetupPageModel.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.core.setup.mediatypes;

import java.util.ArrayList;
import java.util.Collection;
import java.util.Iterator;
import java.util.ResourceBundle;
import java.util.HashMap;

import com.bluepumpkin.common.datatypes.StringsPair;
import com.bluepumpkin.web.core.l10n.CoreWebBundleKey;
import com.witness.ejb.core.mediatypes.model.MediaType;
import com.witness.ejb.core.security.PrivilegeKeys;
import com.witness.ejb.core.security.model.User;
import com.witness.web.uif.keys.PageAction;
import com.witness.web.uif.l10n.UIFWebBundleKey;
import com.witness.web.uif.pagecomponent.contenttitle.ContentTitlePC;
import com.witness.web.uif.pagecomponent.form.FormTwoColumnPC;
import com.witness.web.uif.pagemodel.PageModel;
import com.witness.web.uif.pagemodel.WorkpaneFormPageModel;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.util.HtmlUtil;
import com.bluepumpkin.ejb.bbm.workload.model.Media;
import com.bluepumpkin.ejb.core.CoreManagerFactory;
import com.witness.ejb.core.licensing.LicenseKeys;
import com.witness.ejb.core.licensing.ejb.LicenseManager;
import com.bluepumpkin.common.datatypes.ID;

@SuppressWarnings({ &quot;serial&quot; })
public class MediaTypesSetupPageModel extends WorkpaneFormPageModel {

    private static final String REQUIRED_SAVE_PRIVILEGE = PrivilegeKeys.FS_CONFIGUREMEDIATYPES;

	// Field Names
<span class="nc" id="L34">	private Collection mediaTypes = null;</span>

	// Page Components
	protected FormTwoColumnPC m_formPC;
	protected ResourceBundle m_core_bundle;

<span class="nc" id="L40">    protected HashMap&lt;String, String&gt; m_hmMediaUnits = new HashMap&lt;String, String&gt;();</span>

	/**
	 * Constructor
	 */
	public MediaTypesSetupPageModel(RequestContext context) {
<span class="nc" id="L46">		super(context, BASIC_MODEL);</span>
<span class="nc" id="L47">		m_core_bundle = m_localizer.getBundle(CoreWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L48">		m_formPC = new FormTwoColumnPC(context);</span>
<span class="nc" id="L49">		addChildComponent(m_formPC);</span>
<span class="nc" id="L50">	}</span>

	/**
	 * Return an instance of the model that is ready for rendering
	 */
	public static PageModel getInstance(RequestContext context) throws Exception {
<span class="nc" id="L56">		return getInstance(context, MediaTypesSetupPageModel.class);</span>
	}

	/**
	 * Load Mail Setting Data
	 */
	protected void loadData() throws Exception {
<span class="nc" id="L63">		mediaTypes = MediaTypesSetupModelHandler.getAllMediaTypes();</span>
<span class="nc" id="L64">	}</span>

	/**
	 * Initialize Form Display
	 */
	protected void initForm() {
<span class="nc" id="L70">		addForm(m_formPC);</span>
<span class="nc" id="L71">		String title = i18n(m_core_bundle, CoreWebBundleKey.MEDIA_TYPES_SETUP);</span>
<span class="nc" id="L72">		m_formPC.setTitle(title);</span>

<span class="nc" id="L74">		ArrayList&lt;StringsPair&gt; timeUnitStringsPair = new ArrayList&lt;StringsPair&gt;(3);</span>
<span class="nc" id="L75">		timeUnitStringsPair.add(new StringsPair(&quot;0&quot;, i18n(m_core_bundle, CoreWebBundleKey.SECONDS)));</span>
<span class="nc" id="L76">		timeUnitStringsPair.add(new StringsPair(&quot;1&quot;, i18n(m_core_bundle, CoreWebBundleKey.MINUTES)));</span>
<span class="nc" id="L77">		timeUnitStringsPair.add(new StringsPair(&quot;2&quot;, i18n(m_core_bundle, CoreWebBundleKey.HOURS)));</span>

<span class="nc" id="L79">        boolean isEditable = isAuthorized(REQUIRED_SAVE_PRIVILEGE);</span>

		// Show the list
<span class="nc" id="L82">		MediaType media = null;</span>
<span class="nc" id="L83">        LicenseManager licManager = null;</span>
        try
        {
<span class="nc" id="L86">            licManager = CoreManagerFactory.getLicenseManager();</span>
<span class="nc bnc" id="L87" title="All 2 branches missed.">            for (Iterator i = mediaTypes.iterator(); i.hasNext(); )</span>
            {
<span class="nc" id="L89">                media = (MediaType)i.next();</span>

<span class="nc bnc" id="L91" title="All 2 branches missed.">                if (isLicensedForMedia(licManager, media.getSID()))</span>
                {
<span class="nc" id="L93">                    String mediaName = media.getID();</span>
                    //strip-off the &quot;ID_&quot; part of the mediaName
<span class="nc" id="L95">                    mediaName = mediaName.substring(3).trim().toLowerCase();</span>

<span class="nc bnc" id="L97" title="All 2 branches missed.">                    if (isEditable)</span>
                    {
<span class="nc" id="L99">                        m_formPC.addRow(media.getName(),</span>
<span class="nc" id="L100">                                HtmlUtil.makeSelectInput(mediaName+&quot;TimeUnit&quot;,</span>
<span class="nc" id="L101">                                        Integer.toString(media.getTimeUnit()),&quot;&quot;, timeUnitStringsPair));</span>
                    }
                    else
                    {
                        String unit;
<span class="nc bnc" id="L106" title="All 2 branches missed.">                        if (media.getTimeUnit() == 0)</span>
<span class="nc" id="L107">                            unit = i18n(m_core_bundle, CoreWebBundleKey.SECONDS);</span>
<span class="nc bnc" id="L108" title="All 2 branches missed.">                        else if (media.getTimeUnit() == 1)</span>
<span class="nc" id="L109">                            unit = i18n(m_core_bundle, CoreWebBundleKey.MINUTES);</span>
                        else
<span class="nc" id="L111">                            unit = i18n(m_core_bundle, CoreWebBundleKey.HOURS);</span>

<span class="nc" id="L113">                        m_formPC.addRow(media.getName(), unit);</span>
                    }
<span class="nc" id="L115">                    m_hmMediaUnits.put(media.getSID().toString(), &quot;&quot; + media.getTimeUnit());</span>
<span class="nc" id="L116">                }</span>
            }
        }
<span class="nc" id="L119">        catch (Exception ex){</span>
<span class="nc" id="L120">        }</span>
<span class="nc" id="L121">	}</span>

    /**
     * Return true if media is licensed (or if no license required), false otherwise.
     * @param mediaID - the SID of the Media object
     */
	public static boolean isLicensedForMedia(LicenseManager licManager, ID mediaID)
    {
<span class="fc bfc" id="L129" title="All 2 branches covered.">        if (mediaID.equals(Media.MEDIA_ID_PHONE))</span>
        {
<span class="fc" id="L131">            return true; //no license required</span>
        }

        try
        {
<span class="fc bfc" id="L136" title="All 2 branches covered.">            if (mediaID.equals(Media.MEDIA_ID_PROJECT) ||</span>
<span class="fc bfc" id="L137" title="All 2 branches covered.">                mediaID.equals(Media.MEDIA_ID_PHONE_OUTBOUND) ||</span>
<span class="fc bfc" id="L138" title="All 2 branches covered.">                mediaID.equals(Media.MEDIA_ID_OPERATIONS))</span>
            {
                //these types require a license
<span class="pc bpc" id="L141" title="1 of 4 branches missed.">                if (mediaID.equals(Media.MEDIA_ID_PROJECT) &amp;&amp; licManager.isLicensed(LicenseKeys.APP_PROJECTS))</span>
<span class="fc" id="L142">                    return true;</span>

<span class="pc bpc" id="L144" title="1 of 4 branches missed.">                if (mediaID.equals(Media.MEDIA_ID_PHONE_OUTBOUND) &amp;&amp; licManager.isLicensed(LicenseKeys.APP_MEDIA_OUTBOUND))</span>
<span class="fc" id="L145">                    return true;</span>

<span class="pc bpc" id="L147" title="4 of 6 branches missed.">                if (mediaID.equals(Media.MEDIA_ID_OPERATIONS) &amp;&amp; (licManager.isLicensed(LicenseKeys.APP_MULTIMEDIA) || hasAnyBackOfficeLicence())) {</span>
                    // we enable Operations for Multi-Media license to avoid break old systems
<span class="fc" id="L149">                    return true;</span>
                }

<span class="nc" id="L152">                return false;</span>
            }
<span class="pc bpc" id="L154" title="1 of 2 branches missed.">            else if (licManager.isLicensed(LicenseKeys.APP_MULTIMEDIA))</span>
            {
                //all others require Multimedia license
<span class="fc" id="L157">                return true;</span>
            }
        }
<span class="nc" id="L160">        catch (Exception ex)</span>
        {
<span class="nc" id="L162">            return false;</span>
<span class="nc" id="L163">        }</span>

<span class="nc" id="L165">        return false;</span>
    }

    public static boolean isLicensedForMedia(LicenseManager licManager, String strMediaID)
    {
<span class="fc bfc" id="L170" title="All 2 branches covered.">        if (strMediaID.equals(Media.MEDIA_STRING_ID_PHONE.trim()))</span>
        {
<span class="fc" id="L172">            return true; //no license required</span>
        }

        try
        {
<span class="fc bfc" id="L177" title="All 2 branches covered.">            if (strMediaID.equals(Media.MEDIA_STRING_ID_PROJECT.trim()) ||</span>
<span class="fc bfc" id="L178" title="All 2 branches covered.">            		strMediaID.equals(Media.MEDIA_STRING_ID_PHONE_OUTBOUND.trim()) ||</span>
<span class="fc bfc" id="L179" title="All 2 branches covered.">            		strMediaID.equals(Media.MEDIA_STRING_ID_OPERATIONS.trim())) {</span>
                //these types require a license
<span class="pc bpc" id="L181" title="1 of 4 branches missed.">                if (strMediaID.equals(Media.MEDIA_STRING_ID_PROJECT.trim()) &amp;&amp; licManager.isLicensed(LicenseKeys.APP_PROJECTS)) {</span>
<span class="fc" id="L182">                    return true;</span>
                }

<span class="pc bpc" id="L185" title="1 of 4 branches missed.">                if (strMediaID.equals(Media.MEDIA_STRING_ID_PHONE_OUTBOUND.trim()) &amp;&amp; licManager.isLicensed(LicenseKeys.APP_MEDIA_OUTBOUND)) {</span>
<span class="fc" id="L186">                    return true;</span>
                }

<span class="pc bpc" id="L189" title="4 of 6 branches missed.">                if (strMediaID.equals(Media.MEDIA_STRING_ID_OPERATIONS.trim()) &amp;&amp; (licManager.isLicensed(LicenseKeys.APP_MULTIMEDIA) || hasAnyBackOfficeLicence())) {</span>
<span class="fc" id="L190">                    return true;</span>
                }

<span class="nc" id="L193">                return false;</span>
            }
<span class="pc bpc" id="L195" title="1 of 2 branches missed.">            else if (licManager.isLicensed(LicenseKeys.APP_MULTIMEDIA))</span>
            {
                //all others require Multimedia license
<span class="fc" id="L198">                return true;</span>
            }
        }
<span class="nc" id="L201">        catch (Exception ex)</span>
        {
<span class="nc" id="L203">            return false;</span>
<span class="nc" id="L204">        }</span>

<span class="nc" id="L206">        return false;</span>
    }

    public static boolean hasAnyBackOfficeLicence() throws Exception {
<span class="nc" id="L210">        LicenseManager licManager = CoreManagerFactory.getLicenseManager();</span>
<span class="nc bnc" id="L211" title="All 2 branches missed.">        return licManager.isLicensed(LicenseKeys.APP_Operations)</span>
<span class="nc bnc" id="L212" title="All 2 branches missed.">                || licManager.isLicensed(LicenseKeys.APP_Operations_ItemTracking)</span>
<span class="nc bnc" id="L213" title="All 2 branches missed.">                || licManager.isLicensed(LicenseKeys.APP_Operations_CapacityAndProductivity);</span>
    }

	/**
	 * Initialize Toolbar
	 */
	public void initToolbar() {
<span class="nc" id="L220">		String saveDisplay = i18n(m_common_bundle, UIFWebBundleKey.TOOLBAR_SAVE);</span>
<span class="nc" id="L221">		m_toolbar.addValidateSubmitTextButton(PageAction.SAVE, saveDisplay, isAuthorized(REQUIRED_SAVE_PRIVILEGE));</span>
<span class="nc" id="L222">	}</span>

    public boolean isAuthorized(String privName)
    {
<span class="nc" id="L226">        User user = m_context.getUser();</span>
<span class="nc bnc" id="L227" title="All 2 branches missed.">        if (user!=null)</span>
        {
<span class="nc bnc" id="L229" title="All 2 branches missed.">            if (user.isAuthorized(privName))</span>
<span class="nc" id="L230">                return true;</span>
        }
<span class="nc" id="L232">       return false;</span>
    }

	/**
	 * Return the Form action to be used
	 */
	public String getFormAction() {
<span class="nc" id="L239">		return &quot;media_types&quot;;</span>
	}

	/**
	 * Return Content Title
	 */
	public ContentTitlePC getContentTitle() {
<span class="nc" id="L246">		String pageTitle = i18n(m_core_bundle, CoreWebBundleKey.MEDIA_TYPES_SETUP);</span>
<span class="nc" id="L247">		m_contentTitlePC.setPageTitle(pageTitle);</span>
<span class="nc" id="L248">        m_contentTitlePC.setItemName(&quot;&quot;);</span>
<span class="nc" id="L249">		return m_contentTitlePC;</span>
	}

	/**
	 * Generate the HTML Code associated with the page model
	 */
	public String getHtmlDisplay() {
<span class="nc" id="L256">		return m_formPC.getHtmlDisplay();</span>
	}

    //Getters &amp; Setters

    public String getCallbackTimeUnit()
    {
<span class="nc" id="L263">        return (String)m_hmMediaUnits.get(Media.MEDIA_ID_CALLBACK.toString());</span>
    }
    public void setCallbackTimeUnit(String timeUnit)
    {
<span class="nc" id="L267">        m_hmMediaUnits.put(Media.MEDIA_ID_CALLBACK.toString(), timeUnit);</span>
<span class="nc" id="L268">    }</span>

    public String getChatTimeUnit()
    {
<span class="nc" id="L272">        return (String)m_hmMediaUnits.get(Media.MEDIA_ID_CHAT.toString());</span>
    }
    public void setChatTimeUnit(String timeUnit)
    {
<span class="nc" id="L276">        m_hmMediaUnits.put(Media.MEDIA_ID_CHAT.toString(), timeUnit);</span>
<span class="nc" id="L277">    }</span>

    public String getEmailTimeUnit()
    {
<span class="nc" id="L281">        return (String)m_hmMediaUnits.get(Media.MEDIA_ID_EMAIL.toString());</span>
    }
    public void setEmailTimeUnit(String timeUnit)
    {
<span class="nc" id="L285">        m_hmMediaUnits.put(Media.MEDIA_ID_EMAIL.toString(), timeUnit);</span>
<span class="nc" id="L286">    }</span>

    public String getFaxTimeUnit()
    {
<span class="nc" id="L290">        return (String)m_hmMediaUnits.get(Media.MEDIA_ID_FAX.toString());</span>
    }
    public void setFaxTimeUnit(String timeUnit)
    {
<span class="nc" id="L294">        m_hmMediaUnits.put(Media.MEDIA_ID_FAX.toString(), timeUnit);</span>
<span class="nc" id="L295">    }</span>

    public String getOperationsTimeUnit()
    {
<span class="nc" id="L299">        return (String)m_hmMediaUnits.get(Media.MEDIA_ID_OPERATIONS.toString());</span>
    }
    public void setOperationsTimeUnit(String timeUnit)
    {
<span class="nc" id="L303">        m_hmMediaUnits.put(Media.MEDIA_ID_OPERATIONS.toString(), timeUnit);</span>
<span class="nc" id="L304">    }</span>

    public String getPhoneTimeUnit()
    {
<span class="nc" id="L308">        return (String)m_hmMediaUnits.get(Media.MEDIA_ID_PHONE.toString());</span>
    }
    public void setPhoneTimeUnit(String timeUnit)
    {
<span class="nc" id="L312">        m_hmMediaUnits.put(Media.MEDIA_ID_PHONE.toString(), timeUnit);</span>
<span class="nc" id="L313">    }</span>

    public String getPhone_outTimeUnit()
    {
<span class="nc" id="L317">        return (String)m_hmMediaUnits.get(Media.MEDIA_ID_PHONE_OUTBOUND.toString());</span>
    }
    public void setPhone_outTimeUnit(String timeUnit)
    {
<span class="nc" id="L321">        m_hmMediaUnits.put(Media.MEDIA_ID_PHONE_OUTBOUND.toString(), timeUnit);</span>
<span class="nc" id="L322">    }</span>

    public String getProjectTimeUnit()
    {
<span class="nc" id="L326">        return (String)m_hmMediaUnits.get(Media.MEDIA_ID_PROJECT.toString());</span>
    }
    public void setProjectTimeUnit(String timeUnit)
    {
<span class="nc" id="L330">        m_hmMediaUnits.put(Media.MEDIA_ID_PROJECT.toString(), timeUnit);</span>
<span class="nc" id="L331">    }</span>

    public String getVoipTimeUnit()
    {
<span class="nc" id="L335">        return (String)m_hmMediaUnits.get(Media.MEDIA_ID_VOIP.toString());</span>
    }
    public void setVoipTimeUnit(String timeUnit)
    {
<span class="nc" id="L339">        m_hmMediaUnits.put(Media.MEDIA_ID_VOIP.toString(), timeUnit);</span>
<span class="nc" id="L340">    }</span>

	public String getSocial_postTimeUnit()
    {
<span class="nc" id="L344">        return (String)m_hmMediaUnits.get(Media.MEDIA_ID_SOCIAL_POST.toString());</span>
    }
    public void setSocial_postTimeUnit(String timeUnit)
    {
<span class="nc" id="L348">        m_hmMediaUnits.put(Media.MEDIA_ID_SOCIAL_POST.toString(), timeUnit);</span>
<span class="nc" id="L349">    }</span>

	public String getFacetofaceTimeUnit() {
<span class="nc" id="L352">		return m_hmMediaUnits.get(Media.MEDIA_ID_FACETOFACE.toString());</span>
	}

	public void setFacetofaceTimeUnit(String timeUnit) {
<span class="nc" id="L356">		m_hmMediaUnits.put(Media.MEDIA_ID_FACETOFACE.toString(), timeUnit);</span>
<span class="nc" id="L357">	}</span>

	public String getResoltionTimeUnit() {
<span class="nc" id="L360">		return m_hmMediaUnits.get(Media.MEDIA_ID_RESOLUTION.toString());</span>
	}

	public void setResolutionTimeUnit(String timeUnit) {
<span class="nc" id="L364">		m_hmMediaUnits.put(Media.MEDIA_ID_RESOLUTION.toString(), timeUnit);</span>
<span class="nc" id="L365">	}</span>


    /**
     * Return the HashMap of Media.SID String to time unit String (&quot;0&quot;=seconds, &quot;1&quot;=minutes, &quot;2&quot;=hours)
     */
    public HashMap&lt;String, String&gt; getMediaUnits()
    {
<span class="nc" id="L373">        return m_hmMediaUnits;</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>