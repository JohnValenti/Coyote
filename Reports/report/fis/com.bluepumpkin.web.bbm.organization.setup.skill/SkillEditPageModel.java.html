<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>SkillEditPageModel.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.bbm.organization.setup.skill</a> &gt; <span class="el_source">SkillEditPageModel.java</span></div><h1>SkillEditPageModel.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.bbm.organization.setup.skill;

import java.util.Collection;
import java.util.Collections;
import java.util.Iterator;
import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.keys.DBInfo;
import com.bluepumpkin.common.logging.Category;
import com.bluepumpkin.common.util.StringUtil;
import com.witness.ejb.core.licensing.ejb.LicenseManager;
import com.witness.web.uif.keys.*;
import com.witness.web.uif.util.*;
import com.witness.web.uif.util.js.*;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.pagecomponent.form.FormTwoColumnPC;
import com.witness.web.uif.pagecomponent.toolbar.ToolbarUtil;
import com.witness.web.uif.validator.*;
import com.witness.web.uif.pagemodel.PageModel;
import com.bluepumpkin.web.bbm.Log;
import com.bluepumpkin.web.bbm.l10n.BbmWebBundleKey;
import com.bluepumpkin.web.bbm.organization.OrgWorkpaneFormPageModel;
import com.bluepumpkin.web.bbm.organization.OrganizationModelHandler;
import com.bluepumpkin.web.bbm.organization.tree.OrganizationTreeHelper;
import com.bluepumpkin.ejb.bbm.skill.model.Skill;
import com.bluepumpkin.web.bbm.skill.SkillModelHandler;
import com.bluepumpkin.web.bbm.workload.WorkloadModelHandler;
import com.bluepumpkin.ejb.bbm.workload.model.Media;
import com.bluepumpkin.ejb.core.CoreManagerFactory;
import com.bluepumpkin.common.datatypes.StringsPair;
import com.bluepumpkin.web.core.setup.mediatypes.MediaTypesSetupPageModel;
import java.util.ArrayList;


/**
 * Title:        SkillEditPageModel
 * Description:  Display the Edit page for Skills
 * Copyright:    Copyright (c) 2008
 * Company:      Verint Systems, Inc.
 * @author       Gonzalo Quintanar
 */
public class SkillEditPageModel extends OrgWorkpaneFormPageModel 
{
<span class="fc" id="L43">	private static final Category log = Log.initCategory(SkillEditPageModel.class.getName());</span>

    public static final String SKILL_NAME_FN = &quot;skillName&quot;;
    public static final String SKILL_MEDIA_TYPE_FN = &quot;skillMediaType&quot;;
    public static final String SKILL_DESC_FN = &quot;skillDesc&quot;;
    public static final String OWNER_ORG_FN   = &quot;organizationID&quot;;

	private Skill m_skill;
	private FormTwoColumnPC m_formPC;
    private Collection m_mediaStringPairs;

	/**
	 * Constructor
	 */
	public SkillEditPageModel(RequestContext context) 
    {
<span class="fc" id="L59">		super(context);</span>

		// Initialize Form PC
<span class="fc" id="L62">		m_formPC = new FormTwoColumnPC(context);</span>
<span class="fc" id="L63">		addChildComponent(m_formPC);</span>

		// Component specific required JavaScript Files
<span class="fc" id="L66">		addRequiredJavaScriptFile(JavaScriptFileID.MEDIATOR_WORKPANE);</span>
<span class="fc" id="L67">		setJSMediator(JavaScriptFileID.MEDIATOR_WORKPANE_GENERIC);</span>
        
<span class="fc" id="L69">        m_skill = new Skill();</span>
<span class="fc" id="L70">        m_skill.setName(&quot;&quot;);</span>
<span class="fc" id="L71">        m_skill.setDescription(&quot;&quot;);</span>
<span class="fc" id="L72">        m_skill.setSkillActive(true);</span>
<span class="fc" id="L73">        m_skill.setMediaID(Media.MEDIA_ID_PHONE);</span>
<span class="fc" id="L74">	}</span>

	/**
	 * Return instance of Model which is ready to be rendered
	 */
	public static PageModel getInstance(RequestContext context) 
    {
<span class="fc" id="L81">		return getInstance(context, SkillEditPageModel.class);</span>
	}

	/**
	 * Create Form Model
	 */
	protected void createFormModel() 
    {
		try 
        {            
<span class="fc" id="L91">            initSkill();</span>
            
<span class="pc bpc" id="L93" title="1 of 2 branches missed.">            if (getSkillID() != null) </span>
            {
<span class="nc" id="L95">				ID orgID = getSelectedIDObject();</span>
<span class="nc" id="L96">				m_skill = SkillModelHandler.getSkillByStringID(m_context, getSkillID(), orgID);</span>
			}
            
            // load media for the drop down
<span class="fc" id="L100">            m_mediaStringPairs = getMediaStringsPair();</span>
		} 
<span class="nc" id="L102">        catch (Exception ex) </span>
        {
<span class="nc" id="L104">			handleUnableToLoadDataError(log, ex);</span>
<span class="fc" id="L105">		}</span>
<span class="fc" id="L106">	}</span>

    /**
     * Initialize the skill
     */
    private void initSkill()
    {
<span class="pc bpc" id="L113" title="3 of 4 branches missed.">        if ((m_performActionOnIDs != null) &amp;&amp; (m_performActionOnIDs.length&gt;0)) </span>
<span class="nc" id="L114">            m_skill.setID(m_performActionOnIDs[getEditIndex()]);</span>

<span class="pc bpc" id="L116" title="1 of 4 branches missed.">        if (hasSelectedID() &amp;&amp; m_skill.getOrganizationID()==null ) </span>
        {
<span class="fc" id="L118">            ID orgID = getSelectedIDObject();</span>
<span class="fc" id="L119">            m_skill.setOrganizationID(orgID);</span>
        }
<span class="fc" id="L121">    }</span>
    
    /**
     * Return Collection of Media StringsPair (String mediaId, String mediaName)
     */
    private Collection getMediaStringsPair() throws Exception 
    {
<span class="fc" id="L128">        Collection stringPairs = WorkloadModelHandler.getMediaWithIDStringsPairList(m_context, m_localizer);</span>
<span class="fc" id="L129">        Collection licensedStringPairs = new ArrayList(stringPairs.size());</span>
        
<span class="fc" id="L131">        LicenseManager licManager = CoreManagerFactory.getLicenseManager();</span>
<span class="fc bfc" id="L132" title="All 2 branches covered.">        for (Iterator it=stringPairs.iterator(); it.hasNext();)</span>
        {
<span class="fc" id="L134">            StringsPair stringPair = (StringsPair)it.next();</span>
<span class="fc" id="L135">            ID mediaId = new ID(stringPair.getKey());</span>
            //QC109687: Resolution should not be listed as a media type in this page
<span class="fc bfc" id="L137" title="All 2 branches covered.">            if(mediaId.equals(Media.MEDIA_ID_RESOLUTION)) continue;</span>
            
<span class="pc bpc" id="L139" title="1 of 2 branches missed.">            if (MediaTypesSetupPageModel.isLicensedForMedia(licManager,mediaId ))</span>
<span class="fc" id="L140">                licensedStringPairs.add(stringPair);</span>
<span class="fc" id="L141">        }</span>
<span class="fc" id="L142">        return licensedStringPairs;</span>
    }

	/**
	 * Initialize Form Display
	 */
	protected void initForm() 
    {
        try
        {
<span class="fc" id="L152">        	setForm(m_formPC);</span>
<span class="fc" id="L153">			m_formPC.setTitle(getFormTitle());</span>
	
<span class="fc" id="L155">			m_formPC.addRow(getOrganizationLabel(), getOrganizationDropDown());</span>
	
<span class="fc" id="L157">			m_formPC.addRow(getSkillLabel(),</span>
<span class="fc" id="L158">				HtmlUtil.makeTextInput(SKILL_NAME_FN,50,DBInfo.SKILL_NAME_MAXLENGTH,getSkillName(),JSUtil.ON_CHANGE));</span>
	
<span class="fc" id="L160">	        m_formPC.addRow(getSkillDescLabel(),</span>
<span class="fc" id="L161">	                HtmlUtil.makeTextInput(SKILL_DESC_FN,50,50,getSkillDesc(),JSUtil.ON_CHANGE));</span>

<span class="fc" id="L163">            m_formPC.addRow(getSkillMediaTypeLabel(), getMediaDropDown());</span>
        }
<span class="nc" id="L165">        catch(Exception exp)</span>
        {
<span class="nc" id="L167">            handleUnableToLoadDataError(log, exp);</span>
<span class="nc" id="L168">            m_initFailure = true;</span>
<span class="fc" id="L169">        }        </span>
<span class="fc" id="L170">	}</span>
	
	/**
	 * Return the DropDown display of organizations
	 */
	public String getOrganizationDropDown() throws Exception{
<span class="fc" id="L176">		return HtmlUtil.makeSelectInput(OWNER_ORG_FN, getOrganizationID(),</span>
<span class="fc" id="L177">      			JSUtil.ON_CHANGE, getOrganizationStringsPair());</span>
	}
	
	public String getOrganizationID() 
	{		
		{
<span class="fc" id="L183">			ID id = m_skill.getOrganizationID();</span>
<span class="pc bpc" id="L184" title="2 of 4 branches missed.">			if( id != null &amp;&amp; !id.toString().equals(&quot;&quot;)) </span>
			{
<span class="fc" id="L186">				return id.toString();</span>
			}
			else 
			{				
<span class="nc" id="L190">				return this.getSelectedID();</span>
			}
		} 
	}
	
	public void setOrganizationID(String id) 
	{
<span class="pc bpc" id="L197" title="1 of 2 branches missed.">		if(!StringUtil.isEmpty(id)) </span>
		{
<span class="fc" id="L199">			m_skill.setOrganizationID(new ID(id));</span>
		}
<span class="fc" id="L201">	}</span>

	private Collection getOrganizationStringsPair() throws Exception 
	{
<span class="fc" id="L205">		Collection collOrgs = OrganizationModelHandler.getAllOrgsInUserScope(m_context, m_context.getUser() );</span>
<span class="fc" id="L206">		Collection collStringPair = OrganizationTreeHelper.createOrgNameList(collOrgs, m_localizer);</span>
<span class="fc" id="L207">		Collections.sort((ArrayList)collStringPair);</span>
<span class="fc" id="L208">		return collStringPair;</span>
	}
    
    /**
     * Return the DropDown display of Media Types
     * with the current selected Type choosen
     */
    public Object getMediaDropDown() throws Exception
    {
<span class="fc" id="L217">        return HtmlUtil.makeSelectInput(SKILL_MEDIA_TYPE_FN, </span>
<span class="fc" id="L218">                getSkillMediaType().toString(), JSUtil.ON_CHANGE, m_mediaStringPairs);</span>
    }

	/**
	 * Initialize Toolbar
	 */
	protected void initToolbar() 
    {
<span class="fc" id="L226">		ToolbarUtil.addValidateSaveBtn(m_toolbar, true);</span>
<span class="fc" id="L227">		ToolbarUtil.addConfirmDoneBtn(m_toolbar, true);</span>
<span class="fc" id="L228">		ToolbarUtil.addResetBtn(m_toolbar, true);</span>
<span class="fc" id="L229">	}</span>

	/**
	 * Set the validators to the form fields
	 */
	protected void initFieldValidators() 
    {
		// Add Field Validators
<span class="fc" id="L237">		addValidator(new IsEnteredFieldValidator(this, SKILL_NAME_FN,</span>
			BbmWebBundleKey.ORG_SKILL_LABEL, BbmWebBundleKey.BUNDLE_NAME));
<span class="fc" id="L239">	}</span>

	/**
	 * Set Skill
	 */
	public void setSkillName(String Skill) 
    {
<span class="fc" id="L246">		m_skill.setName(Skill);</span>
<span class="fc" id="L247">	}</span>

	/**
	 * Return Skill
	 */
	public String getSkillName() 
    {
<span class="fc" id="L254">		return m_skill.getName();</span>
	}
    
    /**
     * Set Media ID
     */
    public void setSkillMediaType(ID mediaID) 
    {
<span class="fc" id="L262">        m_skill.setMediaID(mediaID);</span>
<span class="fc" id="L263">    }</span>

    /**
     * Return Media ID
     */
    public ID getSkillMediaType() 
    {
<span class="fc" id="L270">        return m_skill.getMediaID();</span>
    }
    
    /**
     * Return Media name
     */
    public String getSkillMediaTypeName() 
    {
<span class="nc" id="L278">        String mediaName = &quot;&quot;;</span>
        try
        {
<span class="nc" id="L281">            mediaName = SkillModelHandler.getMedia(getSkillMediaType()).getName();</span>
        } 
<span class="nc" id="L283">        catch (Exception ex) </span>
        {
<span class="nc" id="L285">            handleUnableToLoadDataError(log, ex);</span>
<span class="nc" id="L286">        }</span>
<span class="nc" id="L287">        return mediaName;</span>
    }
    
	/**
	 * Set Skill Description
	 */
	public void setSkillDesc(String skillDesc) 
    {
<span class="fc" id="L295">		m_skill.setDescription(skillDesc);</span>
<span class="fc" id="L296">	}</span>

	/**
	 * Return Skill Description
	 */
	public String getSkillDesc() 
    {
<span class="fc" id="L303">		return m_skill.getDescription();</span>
	}

	/**
	 * Return the Associated Skill Object
	 */
	public Skill getSkill() 
    {
<span class="fc" id="L311">		return m_skill;</span>
	}
    
    /**
     * Set Skill ID
     */
    public void setSkillID(ID id) 
    {
<span class="nc" id="L319">        m_skill.setID(id);</span>
<span class="nc" id="L320">    }</span>

	/**
	 * Return Skill ID
	 */
	public ID getSkillID() 
    {
<span class="fc" id="L327">        initSkill();</span>
        
<span class="fc" id="L329">        return m_skill.getID();</span>
	}

	/**
	 * Return true if the skill is new, false otherwise.
	 */
	public boolean isNew() 
    {
<span class="pc bpc" id="L337" title="1 of 2 branches missed.">		return getSkillID()==null;</span>
	}

	/**
	 * Return Localized Organization Label
	 */
	public String getOrganizationLabel() 
    {
<span class="fc" id="L345">		return i18n(m_bbmBundle, BbmWebBundleKey.ORGANIZATION_NAME);</span>
	}

	/**
	 * Return Localized Skill Label
	 */
	public String getSkillLabel() 
    {
<span class="fc" id="L353">		return i18n(m_bbmBundle, BbmWebBundleKey.NAME);</span>
	}

	/**
	 * Return Localized Skill Description Label
	 */
	public String getSkillDescLabel() 
    {
<span class="fc" id="L361">		return i18n(m_bbmBundle, BbmWebBundleKey.ORG_SKILL_DESC_LABEL);</span>
	}

    /**
     * Return Localized Skill Media Type Label
     */
    public String getSkillMediaTypeLabel() 
    {
<span class="fc" id="L369">        return i18n(m_bbmBundle, BbmWebBundleKey.ORG_SKILL_MEDIA_TYPE_LABEL);</span>
    }
    
	/**
	 * Return the form title
	 *
	 * @return form title
	 */
	public String getFormTitle() 
    {
<span class="pc bpc" id="L379" title="1 of 2 branches missed.">		if (isNew()) </span>
        {
<span class="fc" id="L381">			return i18n(m_bbmBundle, BbmWebBundleKey.ORG_SKILL_CREATING);</span>
		} 
        else 
        {
<span class="nc" id="L385">			return HtmlUtil.NBSP;</span>
		}
	}

	/**
	 * Get entity name. Used for title.
	 */
	protected String getTitleEntityType() 
    {
<span class="fc" id="L394">		return i18n(m_bbmBundle, BbmWebBundleKey.ORG_SKILL_CONTENT_TITLE);</span>
	}

	/**
	 * Returns an entity name. Used for title.
	 */
	protected String getEntityName() 
    {
<span class="nc" id="L402">		return getSkillName();</span>
	}

	/**
	 * Return URL for HTML Form Action
	 */
	public String getFormAction() 
    {
<span class="fc" id="L410">		return &quot;org_skill&quot;;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>