<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>WorkRulesModelHandler.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.verint.web.fs.workrules</a> &gt; <span class="el_source">WorkRulesModelHandler.java</span></div><h1>WorkRulesModelHandler.java</h1><pre class="source lang-java linenums">package com.verint.web.fs.workrules;

import java.rmi.RemoteException;
import java.util.ArrayList;
import java.util.Collection;
import java.util.Collections;
import java.util.Comparator;
import java.util.Date;
import java.util.HashMap;
import java.util.LinkedHashMap;
import java.util.List;
import java.util.Map;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.PaginationPair;
import com.bluepumpkin.common.datatypes.Pair;
import com.bluepumpkin.common.datatypes.ScopeID;
import com.bluepumpkin.common.localization.LocaleContext;
import com.bluepumpkin.ejb.bbm.BbmEJBCreateException;
import com.bluepumpkin.ejb.bbm.BbmManagerFactory;
import com.bluepumpkin.ejb.bbm.activity.ejb.ActivityManager;
import com.bluepumpkin.ejb.bbm.activity.model.Activity;
import com.bluepumpkin.ejb.bbm.base.BbmCreateException;
import com.bluepumpkin.ejb.bbm.base.BbmDuplicateNameException;
import com.bluepumpkin.ejb.bbm.base.BbmException;
import com.bluepumpkin.ejb.bbm.base.BbmFinderException;
import com.bluepumpkin.ejb.bbm.base.BbmRemoveException;
import com.bluepumpkin.ejb.bbm.base.BbmUpdateException;
import com.bluepumpkin.ejb.bbm.campaign.ejb.CampaignManager;
import com.bluepumpkin.ejb.bbm.campaign.model.Campaign;
import com.bluepumpkin.ejb.bbm.campaign.model.CampaignWorkResource;
import com.bluepumpkin.ejb.bbm.campaign.model.SchedulingPeriod;
import com.bluepumpkin.ejb.bbm.config.ConfigKey;
import com.bluepumpkin.ejb.bbm.empworkrule.ejb.EmpWorkRuleManager;
import com.bluepumpkin.ejb.bbm.empworkrule.model.EmpTimeBank;
import com.bluepumpkin.ejb.bbm.empworkrule.model.TimePeriodOfDay;
import com.bluepumpkin.ejb.bbm.empworkrule.model.WorkResourceComplexWorkRule;
import com.bluepumpkin.ejb.bbm.empworkrule.model.WorkResourceRotation;
import com.bluepumpkin.ejb.bbm.empworkrule.model.WorkResourceWorkPattern;
import com.bluepumpkin.ejb.bbm.vo.DBSortField;
import com.bluepumpkin.ejb.bbm.workresource.ejb.WorkResourceManager;
import com.bluepumpkin.ejb.bbm.workresource.model.Organization;
import com.bluepumpkin.ejb.bbm.workrules.ejb.WorkRuleManager;
import com.bluepumpkin.ejb.bbm.workrules.ejb.WorkRuleManager.AssignmentRuleValidationError;
import com.bluepumpkin.ejb.bbm.workrules.model.ComplexWorkRule;
import com.bluepumpkin.ejb.bbm.workrules.model.ProjectRules;
import com.bluepumpkin.ejb.bbm.workrules.model.Rotation;
import com.bluepumpkin.ejb.bbm.workrules.model.Shift;
import com.bluepumpkin.ejb.bbm.workrules.model.ShiftEvent;
import com.bluepumpkin.ejb.bbm.workrules.model.ShiftFieldInfo;
import com.bluepumpkin.ejb.bbm.workrules.model.ShiftOTExtension;
import com.bluepumpkin.ejb.bbm.workrules.model.ShiftPattern;
import com.bluepumpkin.ejb.bbm.workrules.model.TimeBank;
import com.bluepumpkin.ejb.bbm.workrules.model.VTOEvent;
import com.bluepumpkin.ejb.core.CoreManagerFactory;
import com.bluepumpkin.web.core.setup.general.GeneralSetupModelHandler;
import com.verint.ejb.wfm.WfmManagerFactory;
import com.witness.ejb.core.licensing.LicenseKeys;
import com.witness.ejb.core.licensing.ejb.LicenseManager;
import com.witness.web.uif.system.RequestContext;

// TODO: Auto-generated Javadoc
/**
 * The Class WorkRulesModelHandler.
 */
<span class="nc" id="L66">public class WorkRulesModelHandler {</span>
	
	/**
	 * Gets the work rule manager.
	 *
	 * @param context the context
	 * @return the work rule manager
	 * @throws BbmException the bbm exception
	 */
	public static WorkRuleManager getWorkRuleManager(RequestContext context) throws BbmException {
<span class="fc" id="L76">		return WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
	}
	
	//Shift Patterns
	/**
	 * Gets the shift patterns.
	 *
	 * @param context the context
	 * @param ids the ids
	 * @return the shift patterns
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Collection&lt;ShiftPattern&gt; getShiftPatterns(RequestContext context, Collection&lt;ID&gt; ids) throws BbmFinderException {
		try {
<span class="fc" id="L90">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L91">			return wrm.getShiftPatternsByIDs(ids);</span>
<span class="nc" id="L92">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L93">			throw e;</span>
<span class="nc" id="L94">		} catch (Exception e) {</span>
<span class="nc" id="L95">			throw new BbmFinderException(e);</span>
		}
	}
	
	/**
	 * Gets the shift patterns by org hierarchy.
	 *
	 * @param context the context
	 * @param orgID the org id
	 * @param isAscendingSort the is ascending sort
	 * @param pageIDSize the page id size
	 * @param pageIndex the page index
	 * @param sortFieldMap the sort field map
	 * @param filteredIDs the filtered i ds
	 * @return the shift patterns by org hierarchy
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static PaginationPair&lt;ShiftPattern&gt; getShiftPatternsByOrgHierarchy(RequestContext context, ID orgID, boolean isAscendingSort, int pageIDSize,
			int pageIndex, LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap, Collection&lt;ID&gt; filteredIDs)
			throws BbmFinderException {
		try {
<span class="nc" id="L116">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L117">			return wrm.getCurrentShiftPatternsByOrgHierarchy(orgID, isAscendingSort, pageIDSize, pageIndex,</span>
					sortFieldMap, filteredIDs);
<span class="nc" id="L119">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L120">			throw e;</span>
<span class="nc" id="L121">		} catch (Exception e) {</span>
<span class="nc" id="L122">			throw new BbmFinderException(e);</span>
		}
	}
	
	/**
	 * Gets the shift patterns by org hierarchy.
	 *
	 * @param context the context
	 * @param orgID the org id
	 * @param isAscendingSort the is ascending sort
	 * @param pageIDSize the page id size
	 * @param pageIndex the page index
	 * @param sortFieldMap the sort field map
	 * @param filteredIDs the filtered i ds
	 * @param filterByName the filter by name
	 * @return the shift patterns by org hierarchy
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static PaginationPair&lt;ShiftPattern&gt; getShiftPatternsByOrgHierarchy(RequestContext context, ID orgID, boolean isAscendingSort, int pageIDSize,
			int pageIndex, LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap, Collection&lt;ID&gt; filteredIDs, String filterByName)
			throws BbmFinderException {
		try {
<span class="fc" id="L144">			WorkRuleManager wrm = getWorkRuleManager(context);</span>
<span class="fc" id="L145">			return wrm.getCurrentShiftPatternsByOrgHierarchy(orgID, isAscendingSort, pageIDSize, pageIndex,</span>
					sortFieldMap, filteredIDs,filterByName);
<span class="nc" id="L147">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L148">			throw e;</span>
<span class="nc" id="L149">		} catch (Exception e) {</span>
<span class="nc" id="L150">			throw new BbmFinderException(e);</span>
		}
	}
	
	/**
	 * Returns the current weekly shift patterns (excluding monthly pattern types) for a given organization and it's hierarchy.
	 *
	 * @param context {@link com.witness.web.uif.system.RequestContext RequestContext}
	 * @param orgID Organization ID
	 * @param isAscendingSort Ascending/Descending sort order
	 * @param pageIDSize Size of pages
	 * @param pageIndex Page index
	 * @param sortFieldMap Sorting map of {@link com.bluepumpkin.ejb.bbm.vo.DBSortField DBSortField} and {@link java.util.Comparator Comparator}
	 * @param filteredIDs Ids to filter
	 * @return {@link com.bluepumpkin.common.datatypes.PaginationPair PaginationPair}
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static PaginationPair&lt;ShiftPattern&gt; getWeeklyShiftPatternsByOrgHierarchy(RequestContext context, ID orgID, boolean isAscendingSort, int pageIDSize,
			int pageIndex, LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap, Collection&lt;ID&gt; filteredIDs)
			throws BbmFinderException {
		try {
<span class="nc" id="L171">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L172">			return wrm.getCurrentWeeklyShiftPatternsByOrgHierarchy(orgID, isAscendingSort, pageIDSize, pageIndex,</span>
					sortFieldMap, filteredIDs);
<span class="nc" id="L174">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L175">			throw e;</span>
<span class="nc" id="L176">		} catch (Exception e) {</span>
<span class="nc" id="L177">			throw new BbmFinderException(e);</span>
		}
	}
	
	/**
	 * Returns the current weekly shift patterns (excluding monthly pattern types) for a given organization and it's hierarchy.
	 *
	 * @param context {@link com.witness.web.uif.system.RequestContext RequestContext}
	 * @param orgID Organization ID
	 * @param isAscendingSort Ascending/Descending sort order
	 * @param pageIDSize Size of pages
	 * @param pageIndex Page index
	 * @param sortFieldMap Sorting map of {@link com.bluepumpkin.ejb.bbm.vo.DBSortField DBSortField} and {@link java.util.Comparator Comparator}
	 * @param filteredIDs Ids to filter
	 * @param filterByName to filter (For Find functionality)
	 * @return {@link com.bluepumpkin.common.datatypes.PaginationPair PaginationPair}
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static PaginationPair&lt;ShiftPattern&gt; getWeeklyShiftPatternsByOrgHierarchy(RequestContext context, ID orgID, boolean isAscendingSort, int pageIDSize,
			int pageIndex, LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap, Collection&lt;ID&gt; filteredIDs,String filterByName)
			throws BbmFinderException {
		try {
<span class="fc" id="L199">			WorkRuleManager wrm = getWorkRuleManager(context);</span>
<span class="fc" id="L200">			return wrm.getCurrentWeeklyShiftPatternsByOrgHierarchy(orgID, isAscendingSort, pageIDSize, pageIndex,</span>
					sortFieldMap, filteredIDs,filterByName);
<span class="nc" id="L202">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L203">			throw e;</span>
<span class="nc" id="L204">		} catch (Exception e) {</span>
<span class="nc" id="L205">			throw new BbmFinderException(e);</span>
		}
	}
	
	/**
	 * Returns the shift patterns defined for a specific organization (excluding hierarchy org scoped items).
	 *
	 * @param context the context
	 * @param orgID Organization ID
	 * @return Collection collection of shift patterns
	 * @throws BbmFinderException If the organization cannot be found
	 * @see ShiftPattern
	 */
	public static Collection&lt;ShiftPattern&gt; getShiftPatternsByOrg(RequestContext context, ID orgID)
			throws BbmFinderException {
		try {
<span class="nc" id="L221">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L222">			return wrm.getCurrentShiftPatternsByOrg(orgID);</span>
<span class="nc" id="L223">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L224">			throw e;</span>
<span class="nc" id="L225">		} catch (Exception e) {</span>
<span class="nc" id="L226">			throw new BbmFinderException(e);</span>
		}
	}	
	
	/**
	 * Gets the shift patterns by scheduling period.
	 *
	 * @param context the context
	 * @param sp the sp
	 * @param isAscendingSort the is ascending sort
	 * @param pageIDSize the page id size
	 * @param pageIndex the page index
	 * @param sortFieldMap the sort field map
	 * @param filteredIDs the filtered i ds
	 * @return the shift patterns by scheduling period
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static PaginationPair&lt;ShiftPattern&gt; getShiftPatternsBySchedulingPeriod(RequestContext context, SchedulingPeriod sp,
			boolean isAscendingSort, int pageIDSize, int pageIndex,
			LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap, Collection&lt;ID&gt; filteredIDs)
			throws BbmFinderException {
		try {
<span class="nc" id="L248">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L249">			return wrm.getCurrentShiftPatternsBySchedulingPeriod(sp, isAscendingSort, pageIDSize, pageIndex,</span>
					sortFieldMap, filteredIDs);
<span class="nc" id="L251">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L252">			throw e;</span>
<span class="nc" id="L253">		} catch (Exception e) {</span>
<span class="nc" id="L254">			throw new BbmFinderException(e);</span>
		}
	}
	
	/**
	 * Gets the shift patterns by scheduling period.
	 *
	 * @param context the context
	 * @param sp the sp
	 * @param isAscendingSort the is ascending sort
	 * @param pageIDSize the page id size
	 * @param pageIndex the page index
	 * @param sortFieldMap the sort field map
	 * @param filteredIDs the filtered i ds
	 * @param filterByName the filter by name
	 * @return the shift patterns by scheduling period
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static PaginationPair&lt;ShiftPattern&gt; getShiftPatternsBySchedulingPeriod(RequestContext context, SchedulingPeriod sp,
			boolean isAscendingSort, int pageIDSize, int pageIndex,
			LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap, Collection&lt;ID&gt; filteredIDs,String filterByName)
			throws BbmFinderException {
		try {
<span class="nc" id="L277">			WorkRuleManager wrm = getWorkRuleManager(context);</span>
<span class="nc" id="L278">			return wrm.getCurrentShiftPatternsBySchedulingPeriod(sp, isAscendingSort, pageIDSize, pageIndex,</span>
					sortFieldMap, filteredIDs,filterByName);
<span class="nc" id="L280">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L281">			throw e;</span>
<span class="nc" id="L282">		} catch (Exception e) {</span>
<span class="nc" id="L283">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Returns the shift patterns for a scheduling period that have been defined in the campaign only (not the organizations that participate).
	 *
	 * @param context Request context
	 * @param sp Scheduling period
	 * @return Collection of shift patterns
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Collection&lt;ShiftPattern&gt; getShiftPatternsBySchedulingPeriodCampaignOnly(RequestContext context, SchedulingPeriod sp)
			throws BbmFinderException {
		try {
<span class="nc" id="L298">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L299">			return wrm.getCurrentShiftPatternsBySchedulingPeriodCampaignOnly(sp);</span>
<span class="nc" id="L300">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L301">			throw e;</span>
<span class="nc" id="L302">		} catch (Exception e) {</span>
<span class="nc" id="L303">			throw new BbmFinderException(e);</span>
		}
	}
	
	/**
	 * Gets the available shift patterns for employees.
	 *
	 * @param context the context
	 * @param workResourceIDs the work resource i ds
	 * @param startDate the start date
	 * @param endDate the end date
	 * @param employeeTypeID the employee type id
	 * @param selectedSchedulingPeriod the selected scheduling period
	 * @param isAscendingSort the is ascending sort
	 * @param pageIDSize the page id size
	 * @param pageIndex the page index
	 * @param sortFieldMap the sort field map
	 * @param filteredIDs the filtered i ds
	 * @return the available shift patterns for employees
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static PaginationPair&lt;ShiftPattern&gt; getAvailableShiftPatternsForEmployees(RequestContext context, Collection&lt;ID&gt; workResourceIDs,
			Date startDate, Date endDate, ID employeeTypeID, SchedulingPeriod selectedSchedulingPeriod, boolean isAscendingSort,
			int pageIDSize, int pageIndex, LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap, Collection&lt;ID&gt; filteredIDs)
			throws BbmFinderException {
		try {
<span class="nc" id="L329">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L330">			return wrm.getAvailableShiftPatternsForEmployees(workResourceIDs,</span>
					startDate, endDate, employeeTypeID, selectedSchedulingPeriod, isAscendingSort, pageIDSize,
					pageIndex, sortFieldMap, filteredIDs, null);
<span class="nc" id="L333">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L334">			throw e;</span>
<span class="nc" id="L335">		} catch (Exception e) {</span>
<span class="nc" id="L336">			throw new BbmFinderException(e);</span>
		}		
	}
	
	/**
	 * Gets the available shift patterns for employees.
	 *
	 * @param context the context
	 * @param workResourceIDs the work resource i ds
	 * @param startDate the start date
	 * @param endDate the end date
	 * @param employeeTypeID the employee type id
	 * @param selectedSchedulingPeriod the selected scheduling period
	 * @param isAscendingSort the is ascending sort
	 * @param pageIDSize the page id size
	 * @param pageIndex the page index
	 * @param sortFieldMap the sort field map
	 * @param filteredIDs the filtered i ds
	 * @param filterByName the filter by name
	 * @return the available shift patterns for employees
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static PaginationPair&lt;ShiftPattern&gt; getAvailableShiftPatternsForEmployees(RequestContext context, Collection&lt;ID&gt; workResourceIDs,
			Date startDate, Date endDate, ID employeeTypeID, SchedulingPeriod selectedSchedulingPeriod, boolean isAscendingSort,
			int pageIDSize, int pageIndex, LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap, Collection&lt;ID&gt; filteredIDs, String filterByName )
			throws BbmFinderException {
		try {
<span class="fc" id="L363">			WorkRuleManager wrm = getWorkRuleManager(context);</span>
<span class="fc" id="L364">			return wrm.getAvailableShiftPatternsForEmployees(workResourceIDs,</span>
					startDate, endDate, employeeTypeID, selectedSchedulingPeriod, isAscendingSort, pageIDSize,
					pageIndex, sortFieldMap, filteredIDs, filterByName); 
<span class="nc" id="L367">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L368">			throw e;</span>
<span class="nc" id="L369">		} catch (Exception e) {</span>
<span class="nc" id="L370">			throw new BbmFinderException(e);</span>
		}		
	}
	
	/**
	 * Delete shift patterns.
	 *
	 * @param context the context
	 * @param shiftPatternIDs the shift pattern i ds
	 * @throws BbmRemoveException the bbm remove exception
	 */
	public static void deleteShiftPatterns(RequestContext context, Collection&lt;ID&gt; shiftPatternIDs) throws BbmRemoveException {
		try {
<span class="fc" id="L383">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L384">			wrm.deleteShiftPatterns(shiftPatternIDs);</span>
<span class="nc" id="L385">		} catch (BbmEJBCreateException e) {</span>
<span class="nc" id="L386">			throw new BbmRemoveException(e);</span>
<span class="nc" id="L387">		} catch (RemoteException e) {</span>
<span class="nc" id="L388">			throw new BbmRemoveException(e);</span>
<span class="fc" id="L389">		}</span>
<span class="fc" id="L390">	}</span>
	
	/**
	 * Copy shift patterns.
	 *
	 * @param context the context
	 * @param shiftPatternIDs the shift pattern i ds
	 * @param isOrgMode the is org mode
	 * @param ownerID the owner id
	 * @param localeContext the locale context
	 * @throws BbmException the bbm exception
	 */
	public static void copyShiftPatterns(RequestContext context, Collection&lt;ID&gt; shiftPatternIDs, boolean isOrgMode, ID ownerID,
			LocaleContext localeContext) throws BbmException {
		try {
<span class="nc" id="L405">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L406">			wrm.copyShiftPatterns(shiftPatternIDs, isOrgMode, ownerID, localeContext);</span>
<span class="nc" id="L407">		} catch (RemoteException ex) {</span>
<span class="nc" id="L408">			throw new BbmException(ex);</span>
<span class="nc" id="L409">		}		</span>
<span class="nc" id="L410">	}</span>
	
	/**
	 * Creates the shift pattern.
	 *
	 * @param context the context
	 * @param shiftPattern the shift pattern
	 * @return the shift pattern
	 * @throws BbmException the bbm exception
	 * @throws BbmDuplicateNameException the bbm duplicate name exception
	 */
	public static ShiftPattern createShiftPattern(RequestContext context, ShiftPattern shiftPattern) throws BbmException, BbmDuplicateNameException {
		try {
<span class="fc" id="L423">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L424">			return wrm.createShiftPattern(shiftPattern);</span>
<span class="nc" id="L425">		} catch (RemoteException ex) {</span>
<span class="nc" id="L426">			throw new BbmException(ex);</span>
		}		
	}
	
	/**
	 * Update shift patterns.
	 *
	 * @param context the context
	 * @param shiftPatterns the shift patterns
	 * @throws BbmUpdateException the bbm update exception
	 * @throws BbmDuplicateNameException the bbm duplicate name exception
	 */
	public static void updateShiftPatterns(RequestContext context, Collection&lt;ShiftPattern&gt; shiftPatterns) throws BbmUpdateException, BbmDuplicateNameException {
		try {
<span class="fc" id="L440">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L441">			wrm.updateShiftPatterns(shiftPatterns);</span>
<span class="nc" id="L442">		} catch (Exception ex) {</span>
<span class="nc bnc" id="L443" title="All 2 branches missed.">			if (ex instanceof BbmUpdateException) throw (BbmUpdateException)ex;</span>
<span class="nc bnc" id="L444" title="All 2 branches missed.">			if (ex instanceof BbmDuplicateNameException) throw (BbmDuplicateNameException)ex;</span>
<span class="nc" id="L445">			else throw new BbmUpdateException(ex);</span>
<span class="fc" id="L446">		}</span>
<span class="fc" id="L447">	}</span>
	
	/**
	 * Gets the possible days off shift.
	 *
	 * @param context the context
	 * @return the possible days off shift
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Shift getPossibleDaysOffShift(RequestContext context) throws BbmFinderException {
		try {
<span class="fc" id="L458">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L459">			Collection&lt;Shift&gt; shifts = wrm.getShiftsByIDs(</span>
<span class="fc" id="L460">					Collections.singleton(new ID(ShiftFieldInfo.POSSIBLE_DAYS_OFF_SHIFT_ID)));</span>
<span class="pc bpc" id="L461" title="2 of 4 branches missed.">			if (shifts != null &amp;&amp; !shifts.isEmpty()) {</span>
<span class="fc" id="L462">				return shifts.iterator().next();</span>
			}
<span class="nc" id="L464">			return null;</span>
<span class="nc" id="L465">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L466">			throw e;</span>
<span class="nc" id="L467">		} catch (Exception e) {</span>
<span class="nc" id="L468">			throw new BbmFinderException(e);</span>
		}
	}
	
	//Shifts
	/**
	 * Gets the shifts by i ds.
	 *
	 * @param context the context
	 * @param ids the ids
	 * @return the shifts by i ds
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Collection&lt;Shift&gt; getShiftsByIDs(RequestContext context, Collection&lt;ID&gt; ids) throws BbmFinderException {
		try {
<span class="fc" id="L483">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L484">			return wrm.getShiftsByIDs(ids);</span>
<span class="nc" id="L485">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L486">			throw e;</span>
<span class="nc" id="L487">		} catch (Exception e) {</span>
<span class="nc" id="L488">			throw new BbmFinderException(e);</span>
		}
	}
	
	/**
	 * Returns a shift with the given ID.
	 *
	 * @param context Request context
	 * @param shiftId ID of the shift
	 * @return the shift
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Shift getShift(RequestContext context, ID shiftId) throws BbmFinderException {
		try {
<span class="fc" id="L502">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L503">			return wrm.getShift(shiftId);</span>
<span class="nc" id="L504">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L505">			throw e;</span>
<span class="nc" id="L506">		} catch (Exception e) {</span>
<span class="nc" id="L507">			throw new BbmFinderException(e);</span>
		}
	}
	
	/**
	 * Gets the shifts by name.
	 *
	 * @param context the context
	 * @param scope the scope
	 * @param names the names
	 * @return the shifts by name
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Collection&lt;Shift&gt; getShiftsByName(RequestContext context, ScopeID scope, Collection&lt;String&gt; names) throws BbmFinderException {
		try {
<span class="nc" id="L522">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L523">			return wrm.getShiftsByName(scope, names);</span>
<span class="nc" id="L524">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L525">			throw e;</span>
<span class="nc" id="L526">		} catch (Exception e) {</span>
<span class="nc" id="L527">			throw new BbmFinderException(e);</span>
		}
	}
	
	/**
	 * Gets the shift names by org.
	 *
	 * @param context the context
	 * @param orgID the org id
	 * @return the shift names by org
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static HashMap&lt;ID, String&gt; getShiftNamesByOrg(RequestContext context, ID orgID) throws BbmFinderException {
		try {
<span class="fc" id="L541">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L542">			return wrm.getShiftNamesByOrg(orgID);</span>
<span class="nc" id="L543">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L544">			throw e;</span>
<span class="nc" id="L545">		} catch (Exception e) {</span>
<span class="nc" id="L546">			throw new BbmFinderException(e);</span>
		}
	}
	
	/**
	 * Returns the shift events scoped at an organization keyed by name (no inherited shift events).
	 *
	 * @param context the context
	 * @param organizationID the organization id
	 * @return the shift events by org
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Map&lt;String, ShiftEvent&gt; getShiftEventsByOrg(RequestContext context, ID organizationID) throws BbmFinderException {
		try {
<span class="nc" id="L560">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L561">			Map&lt;String, ShiftEvent&gt; result = new HashMap&lt;String, ShiftEvent&gt;();</span>
<span class="nc" id="L562">			Collection&lt;ShiftEvent&gt; shiftEvents = wrm.getShiftEventsByOrg(organizationID);</span>
<span class="nc bnc" id="L563" title="All 2 branches missed.">			for(ShiftEvent shiftEvent : shiftEvents) {</span>
<span class="nc" id="L564">				result.put(shiftEvent.getName(), shiftEvent);</span>
<span class="nc" id="L565">			}</span>
<span class="nc" id="L566">			return result;</span>
<span class="nc" id="L567">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L568">			throw e;</span>
<span class="nc" id="L569">		} catch (Exception e) {</span>
<span class="nc" id="L570">			throw new BbmFinderException(e);</span>
		}
	}
	
	/**
	 * Returns the shift events scoped at an organization keyed by name (no inherited shift events).
	 *
	 * @param context the context
	 * @param shiftEventID the shift event id
	 * @return the shift event
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static ShiftEvent getShiftEvent(RequestContext context, ID shiftEventID) throws BbmFinderException {
		try {
<span class="nc" id="L584">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L585">			return wrm.getShiftEvent(shiftEventID);</span>
<span class="nc" id="L586">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L587">			throw e;</span>
<span class="nc" id="L588">		} catch (Exception e) {</span>
<span class="nc" id="L589">			throw new BbmFinderException(e);</span>
		}
	}
	
	/**
	 * Gets the shift names by scheduling period.
	 *
	 * @param context the context
	 * @param sp the sp
	 * @return the shift names by scheduling period
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static HashMap&lt;ID, String&gt; getShiftNamesBySchedulingPeriod(RequestContext context, SchedulingPeriod sp) throws BbmFinderException {
		try {
<span class="nc" id="L603">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L604">			return wrm.getShiftNamesBySchedulingPeriod(sp);</span>
<span class="nc" id="L605">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L606">			throw e;</span>
<span class="nc" id="L607">		} catch (Exception e) {</span>
<span class="nc" id="L608">			throw new BbmFinderException(e);</span>
		}
	}
	
	/**
	 * Gets the shift list by org.
	 *
	 * @param context the context
	 * @param orgID the org id
	 * @param isAscendingSort the is ascending sort
	 * @param pageIDSize the page id size
	 * @param pageIndex the page index
	 * @param sortFieldMap the sort field map
	 * @param filteredIDs the filtered i ds
	 * @param filterByName the filter by name
	 * @return the shift list by org
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static PaginationPair&lt;Shift&gt; getShiftListByOrg(RequestContext context, ID orgID, boolean isAscendingSort, int pageIDSize,
			int pageIndex, LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap, Collection&lt;ID&gt; filteredIDs,
			String filterByName)
			throws BbmFinderException {
		try {
<span class="fc" id="L631">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L632">			return wrm.getCurrentShiftsByOrgHierarchy(orgID, isAscendingSort, pageIDSize, pageIndex, sortFieldMap,</span>
					filteredIDs, filterByName);
<span class="nc" id="L634">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L635">			throw e;</span>
<span class="nc" id="L636">		} catch (Exception e) {</span>
<span class="nc" id="L637">			throw new BbmFinderException(e);</span>
		}
	}
	
	public static Map&lt;ID, String&gt; getShiftIDNameListByOrg(RequestContext context, ID orgID)
			throws BbmFinderException {
		try {
<span class="fc" id="L644">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L645">			return wrm.getShiftNamesByOrg(orgID);</span>
<span class="nc" id="L646">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L647">			throw e;</span>
<span class="nc" id="L648">		} catch (Exception e) {</span>
<span class="nc" id="L649">			throw new BbmFinderException(e);</span>
		}
	}
	
	
	/**
	 * Gets the shift list by scheduling period.
	 *
	 * @param context the context
	 * @param sp the sp
	 * @param isAscendingSort the is ascending sort
	 * @param pageIDSize the page id size
	 * @param pageIndex the page index
	 * @param sortFieldMap the sort field map
	 * @param filteredIDs the filtered i ds
	 * @param filterByName the filter by name
	 * @return the shift list by scheduling period
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static PaginationPair&lt;Shift&gt; getShiftListBySchedulingPeriod(RequestContext context, SchedulingPeriod sp,
			boolean isAscendingSort, int pageIDSize, int pageIndex,
			LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap, Collection&lt;ID&gt; filteredIDs, String filterByName)
			throws BbmFinderException {
		try {
<span class="nc" id="L673">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L674">			return wrm.getCurrentShiftsBySchedulingPeriod(sp, isAscendingSort, pageIDSize, pageIndex, sortFieldMap,</span>
					filteredIDs, filterByName);
<span class="nc" id="L676">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L677">			throw e;</span>
<span class="nc" id="L678">		} catch (Exception e) {</span>
<span class="nc" id="L679">			throw new BbmFinderException(e);</span>
		}
	}
	
	/**
	 * Delete shifts.
	 *
	 * @param context the context
	 * @param shiftIDs the shift i ds
	 * @throws BbmRemoveException the bbm remove exception
	 */
	public static void deleteShifts(RequestContext context, Collection&lt;ID&gt; shiftIDs) throws BbmRemoveException {
		try {
<span class="fc" id="L692">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L693">			wrm.deleteShifts(shiftIDs);</span>
<span class="nc" id="L694">		} catch (BbmEJBCreateException e) {</span>
<span class="nc" id="L695">			throw new BbmRemoveException(e);</span>
<span class="nc" id="L696">		} catch (RemoteException e) {</span>
<span class="nc" id="L697">			throw new BbmRemoveException(e);</span>
<span class="fc" id="L698">		}</span>
<span class="fc" id="L699">	}</span>
	
	/**
	 * Copy shifts.
	 *
	 * @param context the context
	 * @param shiftIDs the shift i ds
	 * @param isOrgMode the is org mode
	 * @param ownerID the owner id
	 * @param localeContext the locale context
	 * @throws BbmException the bbm exception
	 */
	public static void copyShifts(RequestContext context, Collection&lt;ID&gt; shiftIDs, boolean isOrgMode, ID ownerID,
			LocaleContext localeContext) throws BbmException {
		try {
<span class="nc" id="L714">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L715">			wrm.copyShifts(shiftIDs, isOrgMode, ownerID, localeContext);</span>
<span class="nc" id="L716">		} catch (RemoteException ex) {</span>
<span class="nc" id="L717">			throw new BbmException(ex);</span>
<span class="nc" id="L718">		}		</span>
<span class="nc" id="L719">	}</span>
	
	/**
	 * Creates the shift.
	 *
	 * @param context the context
	 * @param shift the shift
	 * @return the shift
	 * @throws BbmException the bbm exception
	 */
	public static Shift createShift(RequestContext context, Shift shift) throws BbmException {
		try {
<span class="fc" id="L731">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L732">			return wrm.createShift(shift);</span>
<span class="nc" id="L733">		} catch (RemoteException ex) {</span>
<span class="nc" id="L734">			throw new BbmException(ex);</span>
		}		
	}
	
	/**
	 * Update shifts.
	 *
	 * @param context the context
	 * @param shifts the shifts
	 * @throws BbmUpdateException the bbm update exception
	 */
	public static void updateShifts(RequestContext context, Collection&lt;Shift&gt; shifts) throws BbmUpdateException {
		try {
<span class="nc" id="L747">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L748">			wrm.updateShifts(shifts);</span>
<span class="nc" id="L749">		} catch (BbmUpdateException ex) {</span>
<span class="nc" id="L750">			throw ex;</span>
<span class="nc" id="L751">		} catch (Exception ex) {</span>
<span class="nc" id="L752">			throw new BbmUpdateException(ex);</span>
<span class="nc" id="L753">		}</span>
<span class="nc" id="L754">	}</span>
	
	//Shift Events
	/**
	 * Gets the shift events by org hierarchy.
	 *
	 * @param context the context
	 * @param orgID the org id
	 * @param isAscendingSort the is ascending sort
	 * @param pageIDSize the page id size
	 * @param pageIndex the page index
	 * @param sortFieldMap the sort field map
	 * @param filteredIDs the filtered i ds
	 * @param filterByName the filter by name
	 * @return the shift events by org hierarchy
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static PaginationPair&lt;ShiftEvent&gt; getShiftEventsByOrgHierarchy(RequestContext context, ID orgID, boolean isAscendingSort,
			int pageIDSize, int pageIndex, LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap,
			Collection&lt;ID&gt; filteredIDs, String filterByName) throws BbmFinderException {
		try {
<span class="fc" id="L775">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L776">			return wrm.getShiftEventsByOrgHierarchy(orgID, isAscendingSort, pageIDSize, pageIndex, sortFieldMap,</span>
					filteredIDs, filterByName);
<span class="nc" id="L778">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L779">			throw e;</span>
<span class="nc" id="L780">		} catch (Exception e) {</span>
<span class="nc" id="L781">			throw new BbmFinderException(e);</span>
		}
	}
	
	/**
	 * Gets the shift events by scheduling period.
	 *
	 * @param context the context
	 * @param sp the sp
	 * @param isAscendingSort the is ascending sort
	 * @param pageIDSize the page id size
	 * @param pageIndex the page index
	 * @param sortFieldMap the sort field map
	 * @param filteredIDs the filtered i ds
	 * @param filterByName the filter by name
	 * @return the shift events by scheduling period
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static PaginationPair&lt;ShiftEvent&gt; getShiftEventsBySchedulingPeriod(RequestContext context, SchedulingPeriod sp,
			boolean isAscendingSort, int pageIDSize, int pageIndex,
			LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap, Collection&lt;ID&gt; filteredIDs, String filterByName)
			throws BbmFinderException {
		try {
<span class="nc" id="L804">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L805">			return wrm.getShiftEventsBySchedulingPeriod(sp, isAscendingSort, pageIDSize, pageIndex, sortFieldMap,</span>
					filteredIDs, filterByName);
<span class="nc" id="L807">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L808">			throw e;</span>
<span class="nc" id="L809">		} catch (Exception e) {</span>
<span class="nc" id="L810">			throw new BbmFinderException(e);</span>
		}
	}
	
	/**
	 * Gets the shift events.
	 *
	 * @param context the context
	 * @param ids the ids
	 * @return the shift events
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Collection&lt;ShiftEvent&gt; getShiftEvents(RequestContext context, Collection&lt;ID&gt; ids) throws BbmFinderException {
		try {
<span class="fc" id="L824">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L825">			return wrm.getShiftEvents(ids);</span>
<span class="nc" id="L826">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L827">			throw e;</span>
<span class="nc" id="L828">		} catch (Exception e) {</span>
<span class="nc" id="L829">			throw new BbmFinderException(e);</span>
		}		
	}
	
	/**
	 * Creates the shift event.
	 *
	 * @param context the context
	 * @param shiftEvent the shift event
	 * @return the shift event
	 * @throws BbmException the bbm exception
	 */
	public static ShiftEvent createShiftEvent(RequestContext context, ShiftEvent shiftEvent)
	throws BbmException {
		try {
<span class="fc" id="L844">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L845">			return wrm.createShiftEvent(shiftEvent);</span>
<span class="nc" id="L846">		} catch (RemoteException ex) {</span>
<span class="nc" id="L847">			throw new BbmException(ex);</span>
		}
	}
	
	/**
	 * Update shift events.
	 *
	 * @param context the context
	 * @param shiftEvents the shift events
	 * @throws BbmUpdateException the bbm update exception
	 */
	public static void updateShiftEvents(RequestContext context, Collection&lt;ShiftEvent&gt; shiftEvents) throws BbmUpdateException {
		try {
<span class="nc" id="L860">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L861">			wrm.updateShiftEvents(shiftEvents);</span>
<span class="nc" id="L862">		} catch (Exception ex) {</span>
<span class="nc bnc" id="L863" title="All 2 branches missed.">			if (ex instanceof BbmUpdateException) throw (BbmUpdateException)ex;</span>
<span class="nc" id="L864">			else throw new BbmUpdateException(ex);</span>
<span class="nc" id="L865">		}</span>
<span class="nc" id="L866">	}</span>
	
	/**
	 * Delete shift events.
	 *
	 * @param context the context
	 * @param shiftEventIDs the shift event i ds
	 * @throws BbmRemoveException the bbm remove exception
	 */
	public static void deleteShiftEvents(RequestContext context, Collection&lt;ID&gt; shiftEventIDs) throws BbmRemoveException {
		try {
<span class="fc" id="L877">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L878">			wrm.deleteShiftEvents(shiftEventIDs);</span>
<span class="nc" id="L879">		} catch (Exception e) {</span>
<span class="nc" id="L880">			throw new BbmRemoveException(e);</span>
<span class="fc" id="L881">		}</span>
<span class="fc" id="L882">	}</span>

	/**
	 * Copy shift events.
	 *
	 * @param context the context
	 * @param shiftEventIDs the shift event i ds
	 * @param isOrgMode the is org mode
	 * @param ownerID the owner id
	 * @param localeContext the locale context
	 * @throws BbmException the bbm exception
	 */
	public static void copyShiftEvents(RequestContext context, Collection&lt;ID&gt; shiftEventIDs, boolean isOrgMode, ID ownerID,
			LocaleContext localeContext) throws BbmException {
		try {
<span class="nc" id="L897">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L898">			wrm.copyShiftEvents(shiftEventIDs, isOrgMode, ownerID, localeContext);</span>
<span class="nc" id="L899">		} catch (RemoteException ex) {</span>
<span class="nc" id="L900">			throw new BbmException(ex);</span>
<span class="nc" id="L901">		}		</span>
<span class="nc" id="L902">	}</span>
	
	//OT Extensions
	/**
	 * Gets the shift ot extensions by org hierarchy.
	 *
	 * @param context the context
	 * @param orgID the org id
	 * @param isAscendingSort the is ascending sort
	 * @param pageIDSize the page id size
	 * @param pageIndex the page index
	 * @param sortFieldMap the sort field map
	 * @param filteredIDs the filtered i ds
	 * @return the shift ot extensions by org hierarchy
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static PaginationPair&lt;ShiftOTExtension&gt; getShiftOTExtensionsByOrgHierarchy(RequestContext context, ID orgID, boolean isAscendingSort,
			int pageIDSize, int pageIndex, LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap,
			Collection&lt;ID&gt; filteredIDs) throws BbmFinderException {
		try {
<span class="fc" id="L922">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L923">			return wrm.getShiftOTExtensionsByOrgHierarchy(orgID, isAscendingSort, pageIDSize, pageIndex,</span>
					sortFieldMap, filteredIDs);
<span class="nc" id="L925">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L926">			throw e;</span>
<span class="nc" id="L927">		} catch (Exception e) {</span>
<span class="nc" id="L928">			throw new BbmFinderException(e);</span>
		}
	}
	
	/**
	 * Gets the shift ot extensions by scheduling period.
	 *
	 * @param context the context
	 * @param sp the sp
	 * @param isAscendingSort the is ascending sort
	 * @param pageIDSize the page id size
	 * @param pageIndex the page index
	 * @param sortFieldMap the sort field map
	 * @param filteredIDs the filtered i ds
	 * @return the shift ot extensions by scheduling period
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static PaginationPair&lt;ShiftOTExtension&gt; getShiftOTExtensionsBySchedulingPeriod(RequestContext context, SchedulingPeriod sp,
			boolean isAscendingSort, int pageIDSize, int pageIndex,
			LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap, Collection&lt;ID&gt; filteredIDs)
			throws BbmFinderException {
		try {
<span class="nc" id="L950">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L951">			return wrm.getShiftOTExtensionsBySchedulingPeriod(sp, isAscendingSort, pageIDSize, pageIndex,</span>
					sortFieldMap, filteredIDs);
<span class="nc" id="L953">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L954">			throw e;</span>
<span class="nc" id="L955">		} catch (Exception e) {</span>
<span class="nc" id="L956">			throw new BbmFinderException(e);</span>
		}
	}
	
	/**
	 * Gets the shift ot extension by id.
	 *
	 * @param context the context
	 * @param shiftOTExtensionID the shift ot extension id
	 * @return the shift ot extension by id
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static ShiftOTExtension getShiftOTExtensionByID(RequestContext context, ID shiftOTExtensionID) throws BbmFinderException {
		try {
<span class="nc" id="L970">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L971">			return wrm.getShiftOTExtensionByID(shiftOTExtensionID);</span>
<span class="nc" id="L972">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L973">			throw e;</span>
<span class="nc" id="L974">		} catch (Exception e) {</span>
<span class="nc" id="L975">			throw new BbmFinderException(e);</span>
		}
	}
	
	/**
	 * Gets the shift ot extensions by i ds.
	 *
	 * @param context the context
	 * @param shiftOTExtensionIDs the shift ot extension i ds
	 * @return the shift ot extensions by i ds
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Collection&lt;ShiftOTExtension&gt; getShiftOTExtensionsByIDs(RequestContext context, Collection&lt;ID&gt; shiftOTExtensionIDs)
	throws BbmFinderException 
	{
		try {
<span class="fc" id="L991">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L992">			return wrm.getShiftOTExtensionsByIDs(shiftOTExtensionIDs);</span>
<span class="nc" id="L993">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L994">			throw e;</span>
<span class="nc" id="L995">		} catch (Exception e) {</span>
<span class="nc" id="L996">			throw new BbmFinderException(e);</span>
		}		
	}
	
	/**
	 * Delete ot extensions.
	 *
	 * @param context the context
	 * @param otextensionIDs the otextension i ds
	 * @throws BbmRemoveException the bbm remove exception
	 * @throws RemoteException the remote exception
	 */
	public static void deleteOTExtensions(RequestContext context, Collection&lt;ID&gt; otextensionIDs) throws BbmRemoveException, RemoteException {
		try {
<span class="fc" id="L1010">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L1011">			wrm.deleteOTExtensions(otextensionIDs);</span>
<span class="nc" id="L1012">		} catch (BbmEJBCreateException e) {</span>
<span class="nc" id="L1013">			throw new BbmRemoveException(e);</span>
<span class="nc" id="L1014">		} catch (RemoteException e) {</span>
<span class="nc" id="L1015">			throw new BbmRemoveException(e);</span>
<span class="fc" id="L1016">		}</span>
<span class="fc" id="L1017">	}</span>
	
		
	/**
	 * Copy ot extensions.
	 *
	 * @param context the context
	 * @param otextensionIDs the otextension i ds
	 * @param isOrgMode the is org mode
	 * @param ownerID the owner id
	 * @param localeContext the locale context
	 * @throws BbmException the bbm exception
	 */
	public static void copyOTExtensions(RequestContext context, Collection&lt;ID&gt; otextensionIDs, boolean isOrgMode, ID ownerID,
			LocaleContext localeContext) throws BbmException {
		try {
<span class="nc" id="L1033">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1034">			wrm.copyOTExtensions(otextensionIDs, isOrgMode, ownerID, localeContext);</span>
<span class="nc" id="L1035">		} catch (RemoteException ex) {</span>
<span class="nc" id="L1036">			throw new BbmException(ex);</span>
<span class="nc" id="L1037">		}		</span>
<span class="nc" id="L1038">	}</span>
	
	/**
	 * Creates the ot extension.
	 *
	 * @param context the context
	 * @param otExtension the ot extension
	 * @return the id
	 * @throws BbmException the bbm exception
	 */
	public static ID createOTExtension(RequestContext context, ShiftOTExtension otExtension) throws BbmException {
		try {
<span class="fc" id="L1050">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L1051">			return wrm.createOTExtension(otExtension);</span>
<span class="nc" id="L1052">		} catch (RemoteException ex) {</span>
<span class="nc" id="L1053">			throw new BbmException(ex);</span>
		}		
	}
	
	/**
	 * Update ot extensions.
	 *
	 * @param context the context
	 * @param otExtensions the ot extensions
	 * @throws BbmUpdateException the bbm update exception
	 * @throws RemoteException the remote exception
	 */
	public static void updateOTExtensions(RequestContext context, Collection&lt;ShiftOTExtension&gt; otExtensions) throws BbmUpdateException, RemoteException {
		try {
<span class="fc" id="L1067">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L1068">			wrm.updateOTExtensions(otExtensions);</span>
<span class="nc" id="L1069">		} catch (Exception ex) {</span>
<span class="nc bnc" id="L1070" title="All 2 branches missed.">			if (ex instanceof BbmUpdateException) throw (BbmUpdateException)ex;</span>
<span class="nc" id="L1071">			else throw new BbmUpdateException(ex);</span>
<span class="fc" id="L1072">		}</span>
<span class="fc" id="L1073">	}</span>
	
	/**
	 * Gets the OT extension names by org.
	 *
	 * @param context the context
	 * @param orgID the org id
	 * @return the OT extension names by org
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static HashMap&lt;ID, String&gt; getOTExtensionNamesByOrg(RequestContext context, ID orgID) throws BbmFinderException {
		try {
<span class="fc" id="L1085">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L1086">			return wrm.getOTExtensionNamesByOrg(orgID);</span>
<span class="nc" id="L1087">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1088">			throw e;</span>
<span class="nc" id="L1089">		} catch (Exception e) {</span>
<span class="nc" id="L1090">			throw new BbmFinderException(e);</span>
		}
	}
	
	/**
	 * Gets the OT extension names by scheduling period.
	 *
	 * @param context the context
	 * @param sp the sp
	 * @return the OT extension names by scheduling period
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static HashMap&lt;ID, String&gt; getOTExtensionNamesBySchedulingPeriod(RequestContext context, SchedulingPeriod sp) throws BbmFinderException {
		try {
<span class="nc" id="L1104">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1105">			return wrm.getOTExtensionNamesBySchedulingPeriod(sp);</span>
<span class="nc" id="L1106">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1107">			throw e;</span>
<span class="nc" id="L1108">		} catch (Exception e) {</span>
<span class="nc" id="L1109">			throw new BbmFinderException(e);</span>
		}
	}
	//VTO Events
	/**
	 * Gets the VTO events by org hierarchy.
	 *
	 * @param context the context
	 * @param orgID the org id
	 * @param isAscendingSort the is ascending sort
	 * @param pageIDSize the page id size
	 * @param pageIndex the page index
	 * @param sortFieldMap the sort field map
	 * @param filteredIDs the filtered i ds
	 * @return the VTO events by org hierarchy
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static PaginationPair&lt;VTOEvent&gt; getVTOEventsByOrgHierarchy(RequestContext context, ID orgID, boolean isAscendingSort,
			int pageIDSize, int pageIndex, LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap,
			Collection&lt;ID&gt; filteredIDs) throws BbmFinderException {
		try {
<span class="fc" id="L1130">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L1131">			return wrm.getVTOEventsByOrgHierarchy(orgID, isAscendingSort, pageIDSize, pageIndex, sortFieldMap,</span>
					filteredIDs);
<span class="nc" id="L1133">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1134">			throw e;</span>
<span class="nc" id="L1135">		} catch (Exception e) {</span>
<span class="nc" id="L1136">			throw new BbmFinderException(e);</span>
		}
	}
	
	/**
	 * Gets the VTO events by scheduling period.
	 *
	 * @param context the context
	 * @param sp the sp
	 * @param isAscendingSort the is ascending sort
	 * @param pageIDSize the page id size
	 * @param pageIndex the page index
	 * @param sortFieldMap the sort field map
	 * @param filteredIDs the filtered i ds
	 * @return the VTO events by scheduling period
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static PaginationPair&lt;VTOEvent&gt; getVTOEventsBySchedulingPeriod(RequestContext context, SchedulingPeriod sp,
			boolean isAscendingSort, int pageIDSize, int pageIndex,
			LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap, Collection&lt;ID&gt; filteredIDs)
			throws BbmFinderException {
		try {
<span class="nc" id="L1158">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1159">			return wrm.getVTOEventsBySchedulingPeriod(sp, isAscendingSort, pageIDSize, pageIndex, sortFieldMap,</span>
					filteredIDs);
<span class="nc" id="L1161">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1162">			throw e;</span>
<span class="nc" id="L1163">		} catch (Exception e) {</span>
<span class="nc" id="L1164">			throw new BbmFinderException(e);</span>
		}
	}
	
	/**
	 * Gets the VTO events by i ds.
	 *
	 * @param context the context
	 * @param vtoEventIDs the vto event i ds
	 * @return the VTO events by i ds
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Collection&lt;VTOEvent&gt; getVTOEventsByIDs(RequestContext context, Collection&lt;ID&gt; vtoEventIDs)
	throws BbmFinderException {
		try {
<span class="fc" id="L1179">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L1180">			return wrm.getVTOEventsByIDs(vtoEventIDs);</span>
<span class="nc" id="L1181">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1182">			throw e;</span>
<span class="nc" id="L1183">		} catch (Exception e) {</span>
<span class="nc" id="L1184">			throw new BbmFinderException(e);</span>
		}		
	}
	
	/**
	 * Gets the VTO event by id.
	 *
	 * @param context the context
	 * @param vtoEventID the vto event id
	 * @return the VTO event by id
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static VTOEvent getVTOEventByID(RequestContext context, ID vtoEventID)
	throws BbmFinderException {
		try {
<span class="nc" id="L1199">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1200">			return wrm.getVTOEventByID(vtoEventID);</span>
<span class="nc" id="L1201">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1202">			throw e;</span>
<span class="nc" id="L1203">		} catch (Exception e) {</span>
<span class="nc" id="L1204">			throw new BbmFinderException(e);</span>
		}		
	}
	
	/**
	 * Creates the vto event.
	 *
	 * @param context the context
	 * @param vtoEvent the vto event
	 * @return the id
	 * @throws BbmException the bbm exception
	 */
	public static ID createVTOEvent(RequestContext context, VTOEvent vtoEvent)
	throws BbmException {
		try {
<span class="fc" id="L1219">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L1220">			return wrm.createVTOEvent(vtoEvent);</span>
<span class="nc" id="L1221">		} catch (RemoteException ex) {</span>
<span class="nc" id="L1222">			throw new BbmException(ex);</span>
		}
	}
	
	/**
	 * Update vto events.
	 *
	 * @param context the context
	 * @param vtoEvents the vto events
	 * @throws BbmUpdateException the bbm update exception
	 */
	public static void updateVTOEvents(RequestContext context, Collection&lt;VTOEvent&gt; vtoEvents) throws BbmUpdateException {
		try {
<span class="nc" id="L1235">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1236">			wrm.updateVTOEvents(vtoEvents);</span>
<span class="nc" id="L1237">		} catch (Exception ex) {</span>
<span class="nc bnc" id="L1238" title="All 2 branches missed.">			if (ex instanceof BbmUpdateException) throw (BbmUpdateException)ex;</span>
<span class="nc" id="L1239">			else throw new BbmUpdateException(ex);</span>
<span class="nc" id="L1240">		}</span>
<span class="nc" id="L1241">	}</span>
	
	/**
	 * Delete vto events.
	 *
	 * @param context the context
	 * @param vtoEventIDs the vto event i ds
	 * @throws BbmRemoveException the bbm remove exception
	 */
	public static void deleteVTOEvents(RequestContext context, Collection&lt;ID&gt; vtoEventIDs) throws BbmRemoveException {
		try {
<span class="fc" id="L1252">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L1253">			wrm.deleteVTOEvents(vtoEventIDs);</span>
<span class="nc" id="L1254">		} catch (Exception e) {</span>
<span class="nc" id="L1255">			throw new BbmRemoveException(e);</span>
<span class="fc" id="L1256">		}</span>
<span class="fc" id="L1257">	}</span>

	/**
	 * Copy vto events.
	 *
	 * @param context the context
	 * @param vtoEventIDs the vto event i ds
	 * @param isOrgMode the is org mode
	 * @param ownerID the owner id
	 * @param localeContext the locale context
	 * @throws BbmException the bbm exception
	 */
	public static void copyVTOEvents(RequestContext context, Collection&lt;ID&gt; vtoEventIDs, boolean isOrgMode, ID ownerID,
			LocaleContext localeContext) throws BbmException {
		try {
<span class="nc" id="L1272">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1273">			wrm.copyVTOEvents(vtoEventIDs, isOrgMode, ownerID, localeContext);</span>
<span class="nc" id="L1274">		} catch (RemoteException ex) {</span>
<span class="nc" id="L1275">			throw new BbmException(ex);</span>
<span class="nc" id="L1276">		}		</span>
<span class="nc" id="L1277">	}</span>
	
	/**
	 * Gets the VTO names by org.
	 *
	 * @param context the context
	 * @param orgID the org id
	 * @return the VTO names by org
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static HashMap&lt;ID, String&gt; getVTONamesByOrg(RequestContext context, ID orgID) throws BbmFinderException {
		try {
<span class="fc" id="L1289">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L1290">			return wrm.getVTONamesByOrg(orgID);</span>
<span class="nc" id="L1291">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1292">			throw e;</span>
<span class="nc" id="L1293">		} catch (Exception e) {</span>
<span class="nc" id="L1294">			throw new BbmFinderException(e);</span>
		}
	}
	
	/**
	 * Gets the VTO names by scheduling period.
	 *
	 * @param context the context
	 * @param sp the sp
	 * @return the VTO names by scheduling period
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static HashMap&lt;ID, String&gt; getVTONamesBySchedulingPeriod(RequestContext context, SchedulingPeriod sp) throws BbmFinderException {
		try {
<span class="nc" id="L1308">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1309">			return wrm.getVTONamesBySchedulingPeriod(sp);</span>
<span class="nc" id="L1310">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1311">			throw e;</span>
<span class="nc" id="L1312">		} catch (Exception e) {</span>
<span class="nc" id="L1313">			throw new BbmFinderException(e);</span>
		}
	}
	
	//Work Pattern employee assignment
	/**
	 * Gets the work pattern assignments for employees.
	 *
	 * @param context the context
	 * @param employeeIDs the employee i ds
	 * @param startDate the start date
	 * @param endDate the end date
	 * @return the work pattern assignments for employees
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static HashMap&lt;ID, Collection&lt;WorkResourceWorkPattern&gt;&gt; getWorkPatternAssignmentsForEmployees(RequestContext context, Collection&lt;ID&gt; employeeIDs,
			Date startDate, Date endDate) throws BbmFinderException 
	{
		try {
<span class="fc" id="L1332">			EmpWorkRuleManager wrm = WfmManagerFactory.getEmpWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L1333">			return wrm.getWorkPatternAssignments(employeeIDs, startDate, endDate);</span>
<span class="nc" id="L1334">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1335">			throw e;</span>
<span class="nc" id="L1336">		} catch (Exception e) {</span>
<span class="nc" id="L1337">			throw new BbmFinderException(e);</span>
		}		
	}
	
	/**
	 * Gets the work pattern assignments for employee.
	 *
	 * @param context the context
	 * @param employeeID the employee id
	 * @param startDate the start date
	 * @param endDate the end date
	 * @return the work pattern assignments for employee
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Collection&lt;WorkResourceWorkPattern&gt; getWorkPatternAssignmentsForEmployee(RequestContext context, ID employeeID,
			Date startDate, Date endDate) throws BbmFinderException 
	{
		try {
<span class="nc" id="L1355">			EmpWorkRuleManager wrm = WfmManagerFactory.getEmpWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1356">			return wrm.getWorkPatternAssignmentsForEmployee(employeeID, startDate, endDate);</span>
<span class="nc" id="L1357">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1358">			throw e;</span>
<span class="nc" id="L1359">		} catch (Exception e) {</span>
<span class="nc" id="L1360">			throw new BbmFinderException(e);</span>
		}
	}
	
	/**
	 * This method will delete the work pattern assignments in assignmentsToDelete, and will
	 * create new assignments for the assignments in assignmentsToCreate.
	 *
	 * @param context the context
	 * @param assignmentsToDelete the assignments to delete
	 * @param assignmentsToCreate the assignments to create
	 * @throws BbmException the bbm exception
	 */
	public static void saveWorkPatternAssignments(RequestContext context,
			Collection&lt;WorkResourceWorkPattern&gt; assignmentsToDelete,
			Collection&lt;WorkResourceWorkPattern&gt; assignmentsToCreate) throws BbmException {
		try {
<span class="pc bpc" id="L1377" title="3 of 6 branches missed.">			if ((assignmentsToDelete != null &amp;&amp; !assignmentsToDelete.isEmpty()) ||</span>
<span class="fc bfc" id="L1378" title="All 2 branches covered.">					(assignmentsToCreate != null &amp;&amp; !assignmentsToCreate.isEmpty())) {</span>
<span class="fc" id="L1379">				EmpWorkRuleManager wrm = WfmManagerFactory.getEmpWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L1380">				wrm.saveWorkPatternAssignments(assignmentsToDelete, assignmentsToCreate);</span>
			}
<span class="nc" id="L1382">		} catch (Exception e) {</span>
<span class="nc" id="L1383">			throw new BbmException(e);</span>
<span class="fc" id="L1384">		}</span>
<span class="fc" id="L1385">	}</span>
	
	//Work Rule Employee Assignment
	/**
	 * Gets the complex work rule assignments.
	 *
	 * @param context the context
	 * @param employeeIDs the employee i ds
	 * @return the complex work rule assignments
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static HashMap&lt;ID, Collection&lt;WorkResourceComplexWorkRule&gt;&gt; getComplexWorkRuleAssignments(RequestContext context, Collection&lt;ID&gt; employeeIDs)
		throws BbmFinderException 
	{
		try {
<span class="fc" id="L1400">			EmpWorkRuleManager wrm = WfmManagerFactory.getEmpWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L1401">			return wrm.getComplexWorkRuleAssignments(employeeIDs);</span>
<span class="nc" id="L1402">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1403">			throw e;</span>
<span class="nc" id="L1404">		} catch (Exception e) {</span>
<span class="nc" id="L1405">			throw new BbmFinderException(e);</span>
		}		
	}
	
	/**
	 * Gets the complex work rule assignments by cwri ds.
	 *
	 * @param context the context
	 * @param complexWorkRuleIDs the complex work rule i ds
	 * @return the complex work rule assignments by cwri ds
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Map&lt;ID, ? extends Collection&lt;WorkResourceComplexWorkRule&gt;&gt; getComplexWorkRuleAssignmentsByCWRIDs(RequestContext context, Collection&lt;ID&gt; complexWorkRuleIDs) throws BbmFinderException {
		try {
<span class="fc" id="L1419">			EmpWorkRuleManager wrm = WfmManagerFactory.getEmpWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L1420">			return wrm.getComplexWorkRuleAssignmentsByCWRIDs(complexWorkRuleIDs);</span>
<span class="nc" id="L1421">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1422">			throw e;</span>
<span class="nc" id="L1423">		} catch (Exception e) {</span>
<span class="nc" id="L1424">			throw new BbmFinderException(e);</span>
		}		
	}
	
	/**
	 * Gets the rotation assignments by rotation i ds.
	 *
	 * @param context the context
	 * @param rotationIDs the rotation i ds
	 * @return the rotation assignments by rotation i ds
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Map&lt;ID, ? extends Collection&lt;WorkResourceRotation&gt;&gt; getRotationAssignmentsByRotationIDs(RequestContext context, Collection&lt;ID&gt; rotationIDs) throws BbmFinderException {
		try {
<span class="fc" id="L1438">			EmpWorkRuleManager wrm = WfmManagerFactory.getEmpWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L1439">			return wrm.getRotationAssignmentsByRotationIDs(rotationIDs);</span>
<span class="nc" id="L1440">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1441">			throw e;</span>
<span class="nc" id="L1442">		} catch (Exception e) {</span>
<span class="nc" id="L1443">			throw new BbmFinderException(e);</span>
		}		
	}
	
	/**
	 * Gets the complex work rules by i ds.
	 *
	 * @param context the context
	 * @param workRuleIDs the work rule i ds
	 * @return the complex work rules by i ds
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Collection&lt;ComplexWorkRule&gt; getComplexWorkRulesByIDs(RequestContext context, Collection&lt;ID&gt; workRuleIDs)
	throws BbmFinderException 
	{
		try {
<span class="fc" id="L1459">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L1460">			return wrm.getComplexWorkRulesByIDs(workRuleIDs);</span>
<span class="nc" id="L1461">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1462">			throw e;</span>
<span class="nc" id="L1463">		} catch (Exception e) {</span>
<span class="nc" id="L1464">			throw new BbmFinderException(e);</span>
		}		
	}
	
	/**
	 * Gets the available complex work rules for employees.
	 *
	 * @param context the context
	 * @param workResourceIDs the work resource i ds
	 * @param startDate the start date
	 * @param endDate the end date
	 * @param isAscendingSort the is ascending sort
	 * @param pageIDSize the page id size
	 * @param pageIndex the page index
	 * @param sortFieldMap the sort field map
	 * @param filteredIDs the filtered i ds
	 * @return the available complex work rules for employees
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static PaginationPair&lt;ComplexWorkRule&gt; getAvailableComplexWorkRulesForEmployees(RequestContext context, Collection&lt;ID&gt; workResourceIDs,
			Date startDate, Date endDate, boolean isAscendingSort, int pageIDSize, int pageIndex,
			LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap, Collection&lt;ID&gt; filteredIDs)
			throws BbmFinderException {
		try {
<span class="fc" id="L1488">			EmpWorkRuleManager wrm = WfmManagerFactory.getEmpWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L1489">			return wrm.getAvailableComplexWorkRulesForEmployees(workResourceIDs, startDate, endDate,</span>
					isAscendingSort, pageIDSize, pageIndex, sortFieldMap, filteredIDs);
<span class="nc" id="L1491">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1492">			throw e;</span>
<span class="nc" id="L1493">		} catch (Exception e) {</span>
<span class="nc" id="L1494">			throw new BbmFinderException(e);</span>
		}		
	}
	
	/**
	 * Creates the complex work rule assignments.
	 *
	 * @param context the context
	 * @param wrcwrs the wrcwrs
	 * @return the collection
	 * @throws BbmException the bbm exception
	 */
	public static Collection&lt;ID&gt; createComplexWorkRuleAssignments(RequestContext context, Collection&lt;WorkResourceComplexWorkRule&gt; wrcwrs)
	throws BbmException
	{
		try {
<span class="fc" id="L1510">			EmpWorkRuleManager wrm = WfmManagerFactory.getEmpWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L1511">			return wrm.createComplexWorkRuleAssignments(wrcwrs);</span>
<span class="nc" id="L1512">		} catch (Exception e) {</span>
<span class="nc" id="L1513">			throw new BbmException(e);</span>
		}			
	}
	
	/**
	 * Update complex work rule assignments.
	 *
	 * @param context the context
	 * @param wrcwrs the wrcwrs
	 * @throws BbmUpdateException the bbm update exception
	 */
	public static void updateComplexWorkRuleAssignments(RequestContext context, Collection&lt;WorkResourceComplexWorkRule&gt; wrcwrs)
	throws BbmUpdateException
	{
		try {
<span class="nc" id="L1528">			EmpWorkRuleManager wrm = WfmManagerFactory.getEmpWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1529">			wrm.updateComplexWorkRuleAssignments(wrcwrs);</span>
<span class="nc" id="L1530">		} catch (Exception ex) {</span>
<span class="nc bnc" id="L1531" title="All 2 branches missed.">			if (ex instanceof BbmUpdateException) throw (BbmUpdateException)ex;</span>
<span class="nc" id="L1532">			else throw new BbmUpdateException(ex);</span>
<span class="nc" id="L1533">		}</span>
<span class="nc" id="L1534">	}</span>
	
	/**
	 * Delete complex work rule assignments.
	 *
	 * @param context the context
	 * @param workResourceComplexWorkRuleIDs the work resource complex work rule i ds
	 * @throws BbmRemoveException the bbm remove exception
	 */
	public static void deleteComplexWorkRuleAssignments(RequestContext context, Collection&lt;ID&gt; workResourceComplexWorkRuleIDs)
	throws BbmRemoveException
	{
		try {
<span class="nc" id="L1547">			EmpWorkRuleManager wrm = WfmManagerFactory.getEmpWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1548">			wrm.deleteComplexWorkRuleAssignments(workResourceComplexWorkRuleIDs);</span>
<span class="nc" id="L1549">		} catch (Exception e) {</span>
<span class="nc" id="L1550">			throw new BbmRemoveException(e);</span>
<span class="nc" id="L1551">		}</span>
<span class="nc" id="L1552">	}</span>
	
	//Rotation employee assignment
	/**
	 * Gets the rotations by i ds.
	 *
	 * @param context the context
	 * @param rotationIDs the rotation i ds
	 * @return the rotations by i ds
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Collection&lt;Rotation&gt; getRotationsByIDs(RequestContext context, Collection&lt;ID&gt; rotationIDs)
	throws BbmFinderException 
	{
		try {
<span class="fc" id="L1567">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L1568">			return wrm.getRotationsByIDs(rotationIDs);</span>
<span class="nc" id="L1569">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1570">			throw e;</span>
<span class="nc" id="L1571">		} catch (Exception e) {</span>
<span class="nc" id="L1572">			throw new BbmFinderException(e);</span>
		}		
	}
	
	/**
	 * Gets the rotation assignments.
	 *
	 * @param context the context
	 * @param employeeIDs the employee i ds
	 * @return the rotation assignments
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static HashMap&lt;ID, Collection&lt;WorkResourceRotation&gt;&gt; getRotationAssignments(RequestContext context, Collection&lt;ID&gt; employeeIDs)
	throws BbmFinderException 
	{
		try {
<span class="fc" id="L1588">			EmpWorkRuleManager wrm = WfmManagerFactory.getEmpWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L1589">			return wrm.getRotationAssignments(employeeIDs);</span>
<span class="nc" id="L1590">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1591">			throw e;</span>
<span class="nc" id="L1592">		} catch (Exception e) {</span>
<span class="nc" id="L1593">			throw new BbmFinderException(e);</span>
		}		
	}
	
	/**
	 * Return the work rules associated to the filtered org set - all common orgs or common parent orgs
	 * that also have the same start week offset as the employee's orgs.
	 *
	 * @param context the context
	 * @param workResourceIDs the work resource i ds
	 * @param startDate the start date
	 * @param endDate the end date
	 * @param isAscendingSort the is ascending sort
	 * @param pageIDSize the page id size
	 * @param pageIndex the page index
	 * @param sortFieldMap the sort field map
	 * @param filteredIDs the filtered i ds
	 * @return the available rotations for employees
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static PaginationPair&lt;Rotation&gt; getAvailableRotationsForEmployees(RequestContext context, Collection&lt;ID&gt; workResourceIDs,
			Date startDate, Date endDate, boolean isAscendingSort, int pageIDSize, int pageIndex,
			LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap, Collection&lt;ID&gt; filteredIDs)
			throws BbmFinderException {
		try {
<span class="nc" id="L1618">			EmpWorkRuleManager wrm = WfmManagerFactory.getEmpWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1619">			return wrm.getAvailableRotationsForEmployees(workResourceIDs, startDate, endDate, isAscendingSort, pageIDSize,</span>
					pageIndex, sortFieldMap, filteredIDs);
<span class="nc" id="L1621">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1622">			throw e;</span>
<span class="nc" id="L1623">		} catch (Exception e) {</span>
<span class="nc" id="L1624">			throw new BbmFinderException(e);</span>
		}		
	}
	
	/**
	 * Return the work rules associated to the filtered org set - all common orgs or common parent orgs
	 * that also have the same start week offset as the employee's orgs.
	 *
	 * @param context the context
	 * @param workResourceIDs the work resource i ds
	 * @param startDate the start date
	 * @param endDate the end date
	 * @param isAscendingSort the is ascending sort
	 * @param pageIDSize the page id size
	 * @param pageIndex the page index
	 * @param sortFieldMap the sort field map
	 * @param filteredIDs the filtered i ds
	 * @param filterByName the filter by name
	 * @return the available rotations for employees
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static PaginationPair&lt;Rotation&gt; getAvailableRotationsForEmployees(RequestContext context, Collection&lt;ID&gt; workResourceIDs,
			Date startDate, Date endDate, boolean isAscendingSort, int pageIDSize, int pageIndex,
			LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap, Collection&lt;ID&gt; filteredIDs,String filterByName)
			throws BbmFinderException {
		try {
<span class="fc" id="L1650">			EmpWorkRuleManager wrm = WfmManagerFactory.getEmpWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L1651">			return wrm.getAvailableRotationsForEmployees(workResourceIDs, startDate, endDate, isAscendingSort, pageIDSize,</span>
					pageIndex, sortFieldMap, filteredIDs, filterByName); 
<span class="nc" id="L1653">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1654">			throw e;</span>
<span class="nc" id="L1655">		} catch (Exception e) {</span>
<span class="nc" id="L1656">			throw new BbmFinderException(e);</span>
		}		
	
	}
	
	/**
	 * Creates the rotation assignments.
	 *
	 * @param context the context
	 * @param rotationAssignments the rotation assignments
	 * @return the collection
	 * @throws BbmException the bbm exception
	 */
	public static Collection&lt;ID&gt; createRotationAssignments(RequestContext context, Collection&lt;WorkResourceRotation&gt; rotationAssignments)
	throws BbmException
	{
		try {
<span class="fc" id="L1673">			EmpWorkRuleManager wrm = WfmManagerFactory.getEmpWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L1674">			return wrm.createRotationAssignments(rotationAssignments);</span>
<span class="nc" id="L1675">		} catch (Exception e) {</span>
<span class="nc" id="L1676">			throw new BbmException(e);</span>
		}			
	}
	
	/**
	 * Update rotation assignments.
	 *
	 * @param context the context
	 * @param rotationAssignments the rotation assignments
	 * @throws BbmUpdateException the bbm update exception
	 */
	public static void updateRotationAssignments(RequestContext context, Collection&lt;WorkResourceRotation&gt; rotationAssignments)
	throws BbmUpdateException
	{
		try {
<span class="nc" id="L1691">			EmpWorkRuleManager wrm = WfmManagerFactory.getEmpWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1692">			wrm.updateRotationAssignments(rotationAssignments);</span>
<span class="nc" id="L1693">		} catch (Exception ex) {</span>
<span class="nc bnc" id="L1694" title="All 2 branches missed.">			if (ex instanceof BbmUpdateException) throw (BbmUpdateException)ex;</span>
<span class="nc" id="L1695">			else throw new BbmUpdateException(ex);</span>
<span class="nc" id="L1696">		}</span>
<span class="nc" id="L1697">	}</span>
	
	/**
	 * Delete rotation assignments.
	 *
	 * @param context the context
	 * @param rotationAssignmentIDs the rotation assignment i ds
	 * @throws BbmRemoveException the bbm remove exception
	 */
	public static void deleteRotationAssignments(RequestContext context, Collection&lt;ID&gt; rotationAssignmentIDs) throws BbmRemoveException {
		try {
<span class="nc" id="L1708">			EmpWorkRuleManager wrm = WfmManagerFactory.getEmpWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1709">			wrm.deleteRotationAssignments(rotationAssignmentIDs);</span>
<span class="nc" id="L1710">		} catch (Exception e) {</span>
<span class="nc" id="L1711">			throw new BbmRemoveException(e);</span>
<span class="nc" id="L1712">		}</span>
<span class="nc" id="L1713">	}</span>
	
	/**
	 * Delete rotations.
	 *
	 * @param context the context
	 * @param rotationIDs the rotation i ds
	 * @throws BbmRemoveException the bbm remove exception
	 */
	public static void deleteRotations(RequestContext context, Collection&lt;ID&gt; rotationIDs) throws BbmRemoveException {
		try {
<span class="nc" id="L1724">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1725">			wrm.deleteRotations(rotationIDs);</span>
<span class="nc" id="L1726">		} catch (Exception e) {</span>
<span class="nc bnc" id="L1727" title="All 2 branches missed.">			if (e instanceof BbmRemoveException) throw (BbmRemoveException) e;</span>
<span class="nc" id="L1728">			throw new BbmRemoveException(e);</span>
<span class="nc" id="L1729">		}</span>
<span class="nc" id="L1730">	}</span>
	
	/**
	 * Copy rotations to org.
	 *
	 * @param context the context
	 * @param rotationIDs the rotation i ds
	 * @param orgID the org id
	 * @param localeContext the locale context
	 * @throws BbmCreateException the bbm create exception
	 */
	public static void copyRotationsToOrg(RequestContext context, Collection&lt;ID&gt; rotationIDs, ID orgID, LocaleContext localeContext) throws BbmCreateException {
		try {
<span class="nc" id="L1743">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1744">			wrm.copyRotationsToOrg(rotationIDs, orgID, localeContext);</span>
<span class="nc" id="L1745">		} catch (Exception e) {</span>
<span class="nc bnc" id="L1746" title="All 2 branches missed.">			if (e instanceof BbmCreateException) throw (BbmCreateException) e;</span>
<span class="nc" id="L1747">			else throw new BbmCreateException(e);</span>
<span class="nc" id="L1748">		}</span>
<span class="nc" id="L1749">	}</span>
	
	/**
	 * Gets the time bank assignments.
	 *
	 * @param context the context
	 * @param employeeIDs the employee i ds
	 * @param startDate the start date
	 * @param endDate the end date
	 * @return the time bank assignments
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static HashMap&lt;ID, Collection&lt;EmpTimeBank&gt;&gt; getTimeBankAssignments(RequestContext context,
			Collection&lt;ID&gt; employeeIDs, Date startDate, Date endDate) throws BbmFinderException
	{
		try {
<span class="fc" id="L1765">			EmpWorkRuleManager wrm = WfmManagerFactory.getEmpWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L1766">			return wrm.getTimeBankAssignments(employeeIDs, startDate, endDate);</span>
<span class="nc" id="L1767">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1768">			throw e;</span>
<span class="nc" id="L1769">		} catch (Exception e) {</span>
<span class="nc" id="L1770">			throw new BbmFinderException(e);</span>
		}
	}
	
	/**
	 * Gets the time banks by i ds.
	 *
	 * @param context the context
	 * @param timeBankIDs the time bank i ds
	 * @return the time banks by i ds
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Collection&lt;TimeBank&gt; getTimeBanksByIDs(RequestContext context,
			Collection&lt;ID&gt; timeBankIDs) throws BbmFinderException
	{
		try {
<span class="fc" id="L1786">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L1787">			return wrm.getTimeBanks(timeBankIDs);</span>
<span class="nc" id="L1788">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1789">			throw e;</span>
<span class="nc" id="L1790">		} catch (Exception e) {</span>
<span class="nc" id="L1791">			throw new BbmFinderException(e);</span>
		}
	}
	
	/**
	 * Returns a collection of PaginationPair objects with TimeBank data (used for pagination).
	 * The time banks returned will be the time banks that are available to be assigned to ALL of the given employees (workResourceIDs)
	 * for the date range between startDate and endDate.  This is used when adding new time bank assignments to employees.
	 *
	 * @param context the context
	 * @param workResourceIDs the work resource i ds
	 * @param startDate the start date
	 * @param endDate the end date
	 * @param isAscendingSort the is ascending sort
	 * @param pageIDSize the page id size
	 * @param pageIndex the page index
	 * @param sortFieldMap the sort field map
	 * @param filteredIDs the filtered i ds
	 * @return the available time banks for employees
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static PaginationPair&lt;TimeBank&gt; getAvailableTimeBanksForEmployees(RequestContext context, Collection&lt;ID&gt; workResourceIDs,
			Date startDate, Date endDate, boolean isAscendingSort, int pageIDSize, int pageIndex,
			LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap, Collection&lt;ID&gt; filteredIDs)
			throws BbmFinderException {
		try {
<span class="nc" id="L1817">			EmpWorkRuleManager wrm = WfmManagerFactory.getEmpWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1818">			return wrm.getAvailableTimeBanksForEmployees(workResourceIDs, startDate, endDate, isAscendingSort,</span>
					pageIDSize, pageIndex, sortFieldMap, filteredIDs);
<span class="nc" id="L1820">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1821">			throw e;</span>
<span class="nc" id="L1822">		} catch (Exception e) {</span>
<span class="nc" id="L1823">			throw new BbmFinderException(e);</span>
		}		
	}
	
	/**
	 * Creates the time bank assignments.
	 *
	 * @param context the context
	 * @param timeBankAssignments the time bank assignments
	 * @return the collection
	 * @throws BbmException the bbm exception
	 */
	public static Collection&lt;ID&gt; createTimeBankAssignments(RequestContext context, Collection&lt;EmpTimeBank&gt; timeBankAssignments)
	throws BbmException
	{
		try {
<span class="nc" id="L1839">			EmpWorkRuleManager wrm = WfmManagerFactory.getEmpWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1840">			Collection&lt;ID&gt; retVal = new ArrayList&lt;ID&gt;();</span>
<span class="nc bnc" id="L1841" title="All 2 branches missed.">			for (EmpTimeBank etb : timeBankAssignments) {</span>
<span class="nc" id="L1842">				retVal.add(wrm.createTimeBankAssignmentWithNoOverlap(etb));</span>
<span class="nc" id="L1843">			}</span>
<span class="nc" id="L1844">			return retVal;</span>
<span class="nc" id="L1845">		} catch (Exception e) {</span>
<span class="nc" id="L1846">			throw new BbmException(e);</span>
		}			
	}
	
	/**
	 * Delete time bank assignments.
	 *
	 * @param context the context
	 * @param timeBankAssignmentIDs the time bank assignment i ds
	 * @throws BbmRemoveException the bbm remove exception
	 */
	public static void deleteTimeBankAssignments(RequestContext context, Collection&lt;ID&gt; timeBankAssignmentIDs) throws BbmRemoveException {
		try {
<span class="nc" id="L1859">			EmpWorkRuleManager wrm = WfmManagerFactory.getEmpWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1860">			wrm.deleteTimeBankAssignments(timeBankAssignmentIDs);</span>
<span class="nc" id="L1861">		} catch (Exception e) {</span>
<span class="nc" id="L1862">			throw new BbmRemoveException(e);</span>
<span class="nc" id="L1863">		}</span>
<span class="nc" id="L1864">	}</span>
	
	/**
	 * Gets the org i ds linked to sp.
	 *
	 * @param context the context
	 * @param spID the sp id
	 * @return the org i ds linked to sp
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Collection&lt;ID&gt; getOrgIDsLinkedToSP(RequestContext context, ID spID) throws BbmFinderException {
		try {
<span class="fc" id="L1876">			CampaignManager cm = WfmManagerFactory.getCampaignManager(context.isInWhatIfMode());</span>
<span class="fc" id="L1877">			return cm.getLinkedOrgsforSP(spID);</span>
<span class="nc" id="L1878">		} catch (Exception e) {</span>
<span class="nc" id="L1879">			throw new BbmFinderException(e);</span>
		}		
	}

	// -- Utility Methods -- //
	/**
	 * Gets the activities.
	 *
	 * @param context the context
	 * @param activityIDs the activity i ds
	 * @return the activities
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Map&lt;ID, Activity&gt; getActivities(RequestContext context, Collection&lt;ID&gt; activityIDs) throws BbmFinderException {
		try {
<span class="fc" id="L1894">			ActivityManager am = WfmManagerFactory.getActivityManager(context.isInWhatIfMode());</span>
<span class="fc" id="L1895">			Map&lt;ID, Activity&gt; activityMap = new HashMap&lt;ID, Activity&gt;();</span>
<span class="fc" id="L1896">			Collection&lt;Activity&gt; activities = am.findActivities(activityIDs);</span>
<span class="fc bfc" id="L1897" title="All 2 branches covered.">			for (Activity a : activities) {</span>
<span class="fc" id="L1898">				activityMap.put(a.getID(), a);</span>
<span class="fc" id="L1899">			}</span>
<span class="fc" id="L1900">			return activityMap;</span>
<span class="nc" id="L1901">		} catch (BbmEJBCreateException e) {</span>
<span class="nc" id="L1902">			throw new BbmFinderException(e);</span>
<span class="nc" id="L1903">		} catch (RemoteException e) {</span>
<span class="nc" id="L1904">			throw new BbmFinderException(e);</span>
		}
	}
	
	/**
	 * Gets the organization activities.
	 *
	 * @param context the context
	 * @param organizationIds the organization ids
	 * @return the organization activities
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Map&lt;ID, Activity&gt; getOrganizationActivities(RequestContext context, Collection&lt;ID&gt; organizationIds) throws BbmFinderException {
		try {
<span class="nc" id="L1918">			ActivityManager am = WfmManagerFactory.getActivityManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1919">			Map&lt;ID, Activity&gt; activityMap = new HashMap&lt;ID, Activity&gt;();</span>
<span class="nc" id="L1920">			Collection&lt;Activity&gt; activities = am.findOrganizationActivities(organizationIds, true);</span>
<span class="nc bnc" id="L1921" title="All 2 branches missed.">			for (Activity a : activities) {</span>
<span class="nc" id="L1922">				activityMap.put(a.getID(), a);</span>
<span class="nc" id="L1923">			}</span>
<span class="nc" id="L1924">			return activityMap;</span>
<span class="nc" id="L1925">		} catch (BbmEJBCreateException e) {</span>
<span class="nc" id="L1926">			throw new BbmFinderException(e);</span>
<span class="nc" id="L1927">		} catch (RemoteException e) {</span>
<span class="nc" id="L1928">			throw new BbmFinderException(e);</span>
		}
	}
	
	/**
	 * Returns a map of organizations keyed on their IDs.
	 *
	 * @param context the context
	 * @param orgIDs the org i ds
	 * @return the orgs
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Map&lt;ID, Organization&gt; getOrgs(RequestContext context, Collection&lt;ID&gt; orgIDs) throws BbmFinderException {
		try {
<span class="fc" id="L1942">			WorkResourceManager wrm = BbmManagerFactory.getWorkResourceManager(context.isInWhatIfMode());</span>
<span class="fc" id="L1943">			Map&lt;ID, Organization&gt; orgMap = new HashMap&lt;ID, Organization&gt;();</span>
<span class="fc" id="L1944">			Collection&lt;Organization&gt; orgs = wrm.getOrganizationsByIDs(orgIDs);</span>
<span class="fc bfc" id="L1945" title="All 2 branches covered.">			for (Organization org : orgs) {</span>
<span class="fc" id="L1946">				orgMap.put(org.getID(), org);</span>
<span class="fc" id="L1947">			}</span>
<span class="fc" id="L1948">			return orgMap;</span>
<span class="nc" id="L1949">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1950">			throw e;</span>
<span class="nc" id="L1951">		} catch (Exception e) {</span>
<span class="nc" id="L1952">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Takes a collection of campaign IDs, returns a map of Campaign IDs -&gt; Campaigns.
	 *
	 * @param context the context
	 * @param campaignIDs the campaign i ds
	 * @return Map of Campaign IDs -&gt; Campaigns
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Map&lt;ID, Campaign&gt; getCampaigns(RequestContext context, Collection&lt;ID&gt; campaignIDs) throws BbmFinderException {
		try {
<span class="fc" id="L1966">			CampaignManager cm = WfmManagerFactory.getCampaignManager(context.isInWhatIfMode());</span>
<span class="fc" id="L1967">			Map&lt;ID, Campaign&gt; cMap = new HashMap&lt;ID, Campaign&gt;();</span>
<span class="fc" id="L1968">			Collection&lt;Campaign&gt; campaigns = cm.getCampaignsByIDs(campaignIDs);</span>
<span class="pc bpc" id="L1969" title="1 of 2 branches missed.">			for (Campaign c : campaigns) {</span>
<span class="nc" id="L1970">				cMap.put(c.getID(), c);</span>
<span class="nc" id="L1971">			}</span>
<span class="fc" id="L1972">			return cMap;</span>
<span class="nc" id="L1973">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1974">			throw e;</span>
<span class="nc" id="L1975">		} catch (Exception e) {</span>
<span class="nc" id="L1976">			throw new BbmFinderException(e);</span>
		}
	}
	
	/**
	 * Returns the resources that are linked to the given campaign over the given time period.  Because employees are not literally linked
	 * to the campaign, this returns the employees that are linked to the SPs in the given campaign that span the given time period.
	 * If the campaign is a distributed campaign, this method will also return the employees that are linked in the sub campaigns.
	 *
	 * @param context the context
	 * @param campaignID the campaign id
	 * @param startDate the start date
	 * @param endDate the end date
	 * @return the campaign work resource assignments
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Collection&lt;CampaignWorkResource&gt; getCampaignWorkResourceAssignments(RequestContext context, ID campaignID, Date startDate, Date endDate) throws BbmFinderException {
		try {
<span class="fc" id="L1994">			List&lt;CampaignWorkResource&gt; retVal = new ArrayList&lt;CampaignWorkResource&gt;();</span>
<span class="fc" id="L1995">			CampaignManager cm = WfmManagerFactory.getCampaignManager(context.isInWhatIfMode());</span>

			//If a distributed campaign ID was handed in, we need to also retrieve the work resource assignments for the sub campaigns
<span class="fc" id="L1998">			Collection&lt;ID&gt; campaignIDs = cm.getSubCampaignIDs(campaignID);</span>
<span class="pc bpc" id="L1999" title="1 of 2 branches missed.">			if (campaignIDs == null) {</span>
<span class="nc" id="L2000">				campaignIDs = new ArrayList&lt;ID&gt;();</span>
			}
<span class="fc" id="L2002">			campaignIDs.add(campaignID);</span>
			
<span class="fc bfc" id="L2004" title="All 2 branches covered.">			for (ID id : campaignIDs) {</span>
<span class="fc" id="L2005">				Collection&lt;CampaignWorkResource&gt; assignments = cm.getCampaignWorkResourceAssignments(id, startDate, endDate);</span>
<span class="pc bpc" id="L2006" title="1 of 2 branches missed.">				if (assignments != null) {</span>
<span class="fc" id="L2007">					retVal.addAll(assignments);</span>
				}
<span class="fc" id="L2009">			}</span>
			
<span class="fc" id="L2011">			return retVal;</span>
<span class="nc" id="L2012">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L2013">			throw e;</span>
<span class="nc" id="L2014">		} catch (Exception e) {</span>
<span class="nc" id="L2015">			throw new BbmFinderException(e);</span>
		}
	}
	//Projects
	/**
	 * Gets the project rules list by org.
	 *
	 * @param context the context
	 * @param orgID the org id
	 * @param isAscendingSort the is ascending sort
	 * @param pageIDSize the page id size
	 * @param pageIndex the page index
	 * @param sortFieldMap the sort field map
	 * @param filteredIDs the filtered i ds
	 * @param filterByName the filter by name
	 * @return the project rules list by org
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static PaginationPair&lt;ProjectRules&gt; getProjectRulesListByOrg(RequestContext context, ID orgID, boolean isAscendingSort, int pageIDSize,
			int pageIndex, LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap, Collection&lt;ID&gt; filteredIDs,
			String filterByName)
			throws BbmFinderException {
		try {
<span class="nc" id="L2038">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L2039">			return wrm.getProjectRulesByOrgHierarchy(orgID, isAscendingSort, pageIDSize, pageIndex, sortFieldMap,</span>
					filteredIDs, filterByName);
<span class="nc" id="L2041">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L2042">			throw e;</span>
<span class="nc" id="L2043">		} catch (Exception e) {</span>
<span class="nc" id="L2044">			throw new BbmFinderException(e);</span>
		}
	}
	
	/**
	 * Gets the project list by scheduling period.
	 *
	 * @param context the context
	 * @param sp the sp
	 * @param isAscendingSort the is ascending sort
	 * @param pageIDSize the page id size
	 * @param pageIndex the page index
	 * @param sortFieldMap the sort field map
	 * @param filteredIDs the filtered i ds
	 * @param filterByName the filter by name
	 * @return the project list by scheduling period
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static PaginationPair&lt;ProjectRules&gt; getProjectListBySchedulingPeriod(RequestContext context, SchedulingPeriod sp,
			boolean isAscendingSort, int pageIDSize, int pageIndex,
			LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap, Collection&lt;ID&gt; filteredIDs, String filterByName)
			throws BbmFinderException {
		try {
<span class="nc" id="L2067">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L2068">			return wrm.getCurrentProjectsBySchedulingPeriod(sp, isAscendingSort, pageIDSize, pageIndex, sortFieldMap,</span>
					filteredIDs, filterByName);
<span class="nc" id="L2070">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L2071">			throw e;</span>
<span class="nc" id="L2072">		} catch (Exception e) {</span>
<span class="nc" id="L2073">			throw new BbmFinderException(e);</span>
		}
	}
	
	/**
	 * Delete project rules.
	 *
	 * @param context the context
	 * @param projectRuleIDs the project rule i ds
	 * @throws BbmRemoveException the bbm remove exception
	 */
	public static void deleteProjectRules(RequestContext context, Collection&lt;ID&gt; projectRuleIDs) throws BbmRemoveException {
		try {
<span class="nc" id="L2086">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L2087">			wrm.deleteProjects(projectRuleIDs);</span>
<span class="nc" id="L2088">		} catch (BbmEJBCreateException e) {</span>
<span class="nc" id="L2089">			throw new BbmRemoveException(e);</span>
<span class="nc" id="L2090">		} catch (RemoteException e) {</span>
<span class="nc" id="L2091">			throw new BbmRemoveException(e);</span>
<span class="nc" id="L2092">		}</span>
<span class="nc" id="L2093">	}</span>
	
	/**
	 * Creates the project.
	 *
	 * @param context the context
	 * @param projRule the proj rule
	 * @return the id
	 * @throws BbmException the bbm exception
	 */
	public static ID createProject(RequestContext context, ProjectRules projRule) throws BbmException {
		try {
<span class="nc" id="L2105">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L2106">			return wrm.createProjectRule(projRule);</span>
<span class="nc" id="L2107">		} catch (RemoteException ex) {</span>
<span class="nc" id="L2108">			throw new BbmException(ex);</span>
		}		
	}
	
	/**
	 * Update projects.
	 *
	 * @param context the context
	 * @param projRule the proj rule
	 * @throws BbmUpdateException the bbm update exception
	 */
	public static void updateProjects(RequestContext context, Collection&lt;ProjectRules&gt; projRule) throws BbmUpdateException {
		try {
<span class="nc" id="L2121">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L2122">			wrm.updateProjectRule(projRule);</span>
<span class="nc" id="L2123">		} catch (BbmUpdateException e) {</span>
<span class="nc" id="L2124">			throw e;</span>
<span class="nc" id="L2125">		}  catch (Exception ex) {</span>
<span class="nc" id="L2126">			throw new BbmUpdateException(ex);</span>
<span class="nc" id="L2127">		}</span>
<span class="nc" id="L2128">	}</span>
	
	/**
	 * Copy projects.
	 *
	 * @param context the context
	 * @param shiftIDs the shift i ds
	 * @param isOrgMode the is org mode
	 * @param ownerID the owner id
	 * @param localeContext the locale context
	 * @throws BbmException the bbm exception
	 */
	public static void copyProjects(RequestContext context, Collection&lt;ID&gt; shiftIDs, boolean isOrgMode, ID ownerID,
			LocaleContext localeContext) throws BbmException {
		try {
<span class="nc" id="L2143">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L2144">			wrm.copyProjects(shiftIDs, isOrgMode, ownerID, localeContext);</span>
<span class="nc" id="L2145">		} catch (RemoteException ex) {</span>
<span class="nc" id="L2146">			throw new BbmException(ex);</span>
<span class="nc" id="L2147">		}		</span>
<span class="nc" id="L2148">	}</span>
	
	
	/**
	 * Gets the project rules by id.
	 *
	 * @param context the context
	 * @param ids the ids
	 * @return the project rules by id
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Collection&lt;ProjectRules&gt; getProjectRulesByID(RequestContext context, Collection&lt;ID&gt; ids) throws BbmFinderException {
		try {
<span class="nc" id="L2161">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L2162">			return wrm.getProjectRulesByID(ids);</span>
<span class="nc" id="L2163">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L2164">			throw e;</span>
<span class="nc" id="L2165">		} catch (Exception e) {</span>
<span class="nc" id="L2166">			throw new BbmFinderException(e);</span>
		}
	}	
	
	/**
	 * Returns the currently active shifts for an organization (no hierarchy inherited items).
	 *
	 * @param context the context
	 * @param orgID the org id
	 * @return the current shifts by org
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Collection&lt;Shift&gt; getCurrentShiftsByOrg(RequestContext context, ID orgID) throws BbmFinderException {
		try {
<span class="nc" id="L2180">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L2181">			return wrm.getCurrentShiftsByOrg(orgID);</span>
<span class="nc" id="L2182">		} catch (BbmFinderException ex) {</span>
<span class="nc" id="L2183">			throw ex;</span>
<span class="nc" id="L2184">		} catch (Exception ex) {</span>
<span class="nc" id="L2185">			throw new BbmFinderException(ex);</span>
		}
	}
	
	/**
	 * Returns the currently active shifts for an organization hierarchy.
	 *
	 * @param context the context
	 * @param orgID the org id
	 * @return the current shifts by org hierarchy
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Collection&lt;Shift&gt; getCurrentShiftsByOrgHierarchy(RequestContext context, ID orgID) throws BbmFinderException {
		try {
<span class="nc" id="L2199">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L2200">			return wrm.getCurrentShiftsByOrgHierarchy(orgID);</span>
<span class="nc" id="L2201">		} catch (BbmFinderException ex) {</span>
<span class="nc" id="L2202">			throw ex;</span>
<span class="nc" id="L2203">		} catch (Exception ex) {</span>
<span class="nc" id="L2204">			throw new BbmFinderException(ex);</span>
		}
	}
	
	/**
	 * Returns the currently active shifts for a schedule period.
	 *
	 * @param context the context
	 * @param spID the sp id
	 * @return the current shifts by scheduling period
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Collection&lt;Shift&gt; getCurrentShiftsBySchedulingPeriod(RequestContext context, ID spID) throws BbmFinderException {
		try {		
<span class="nc" id="L2218">			CampaignManager campaignMgr = WfmManagerFactory.getCampaignManager(context.isInWhatIfMode());</span>
<span class="nc" id="L2219">			SchedulingPeriod schedulingPeriod = campaignMgr.getSchedulingPeriodByID(spID);</span>
<span class="nc" id="L2220">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L2221">			return wrm.getCurrentShiftsBySchedulingPeriod(schedulingPeriod);</span>
<span class="nc" id="L2222">		} catch (BbmFinderException ex) {</span>
<span class="nc" id="L2223">			throw ex;</span>
<span class="nc" id="L2224">		} catch (Exception ex) {</span>
<span class="nc" id="L2225">			throw new BbmFinderException(ex);</span>
		}
	}
	
	/**
	 * Returns the currently active shifts for a schedule period campaign only (aka local).
	 *
	 * @param context the context
	 * @param spID the sp id
	 * @return the current shifts by scheduling period campaign only
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Collection&lt;Shift&gt; getCurrentShiftsBySchedulingPeriodCampaignOnly(RequestContext context, ID spID) throws BbmFinderException {
		try {		
<span class="nc" id="L2239">			CampaignManager campaignMgr = WfmManagerFactory.getCampaignManager(context.isInWhatIfMode());</span>
<span class="nc" id="L2240">			SchedulingPeriod schedulingPeriod = campaignMgr.getSchedulingPeriodByID(spID);</span>
<span class="nc" id="L2241">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L2242">			return wrm.getCurrentShiftsBySchedulingPeriodCampaignOnly(schedulingPeriod);</span>
<span class="nc" id="L2243">		} catch (BbmFinderException ex) {</span>
<span class="nc" id="L2244">			throw ex;</span>
<span class="nc" id="L2245">		} catch (Exception ex) {</span>
<span class="nc" id="L2246">			throw new BbmFinderException(ex);</span>
		}
	}
	
	/**
	 * Returns the shift events for an organization hierarchy.
	 *
	 * @param context 		Request Context
	 * @param orgID 		Organization ID
	 * @return Collection of Shift Events
	 * @throws BbmFinderException the bbm finder exception
	 * @see ShiftEvent
	 */
	public static Collection&lt;ShiftEvent&gt; getShiftEventsByOrgHierarchy(RequestContext context, ID orgID) throws BbmFinderException {
		try {
<span class="fc" id="L2261">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L2262">			return wrm.getShiftEventsByOrgHierarchy(orgID);</span>
<span class="nc" id="L2263">		} catch(BbmFinderException ex) {</span>
<span class="nc" id="L2264">			throw ex;</span>
<span class="nc" id="L2265">		} catch(Exception ex) {</span>
<span class="nc" id="L2266">			throw new BbmFinderException(ex);</span>
		}
	}
	
	/**
	 * Returns the shift events for a scheduling period.
	 *
	 * @param context Request Context
	 * @param spID Scheduling Period ID
	 * @return Collection of Shift Events
	 * @throws BbmFinderException the bbm finder exception
	 * @see ShiftEvent
	 */
	public static Collection&lt;ShiftEvent&gt; getShiftEventsBySchedulingPeriod(RequestContext context, ID spID) throws BbmFinderException {
		try {
<span class="nc" id="L2281">			CampaignManager campaignMgr = WfmManagerFactory.getCampaignManager(context.isInWhatIfMode());</span>
<span class="nc" id="L2282">			SchedulingPeriod schedulingPeriod = campaignMgr.getSchedulingPeriodByID(spID);</span>
<span class="nc" id="L2283">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L2284">			return wrm.getShiftEventsBySchedulingPeriod(schedulingPeriod);</span>
<span class="nc" id="L2285">		} catch(BbmFinderException ex) {</span>
<span class="nc" id="L2286">			throw ex;</span>
<span class="nc" id="L2287">		} catch(Exception ex) {</span>
<span class="nc" id="L2288">			throw new BbmFinderException(ex);</span>
		} 
	}
	
	/**
	 * Returns the shift events for a scheduling period campaign only (aka local).
	 *
	 * @param context Request Context
	 * @param spID Scheduling Period ID
	 * @return Collection of Shift Events
	 * @throws BbmFinderException the bbm finder exception
	 * @see ShiftEvent
	 */
	public static Collection&lt;ShiftEvent&gt; getShiftEventsBySchedulingPeriodCampaignOnly(RequestContext context, ID spID) throws BbmFinderException {
		try {
<span class="nc" id="L2303">			CampaignManager campaignMgr = WfmManagerFactory.getCampaignManager(context.isInWhatIfMode());</span>
<span class="nc" id="L2304">			SchedulingPeriod schedulingPeriod = campaignMgr.getSchedulingPeriodByID(spID);</span>
<span class="nc" id="L2305">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L2306">			return wrm.getShiftEventsBySchedulingPeriodCampaignOnly(schedulingPeriod);</span>
<span class="nc" id="L2307">		} catch(BbmFinderException ex) {</span>
<span class="nc" id="L2308">			throw ex;</span>
<span class="nc" id="L2309">		} catch(Exception ex) {</span>
<span class="nc" id="L2310">			throw new BbmFinderException(ex);</span>
		} 
	}

	/**
	 * Save rotation.
	 *
	 * @param context the context
	 * @param rot the rot
	 * @throws BbmUpdateException the bbm update exception
	 * @throws BbmCreateException the bbm create exception
	 */
	public static void saveRotation(RequestContext context, Rotation rot) throws BbmUpdateException, BbmCreateException {
		try {
<span class="fc" id="L2324">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L2325">			wrm.saveRotation(rot);</span>
<span class="nc" id="L2326">		} catch (BbmEJBCreateException e) {</span>
<span class="nc" id="L2327">			throw new BbmCreateException(e);</span>
<span class="nc" id="L2328">		} catch (RemoteException e) {</span>
<span class="nc" id="L2329">			throw new BbmCreateException(e);</span>
<span class="fc" id="L2330">		}</span>
<span class="fc" id="L2331">	}</span>

	/**
	 * Save assignment rule.
	 *
	 * @param context the context
	 * @param assignmentRule the assignment rule
	 * @return the collection
	 * @throws BbmCreateException the bbm create exception
	 */
	public static Collection&lt;Pair&lt;AssignmentRuleValidationError, List&lt;?&gt;&gt;&gt; saveAssignmentRule(RequestContext context,
			ComplexWorkRule assignmentRule) throws BbmCreateException {
		try {
<span class="fc" id="L2344">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L2345">			return wrm.saveAssignmentRule(assignmentRule);</span>
<span class="nc" id="L2346">		} catch (BbmCreateException e) {</span>
<span class="nc" id="L2347">			throw e;</span>
<span class="nc" id="L2348">		} catch (Exception e) {</span>
<span class="nc" id="L2349">			throw new BbmCreateException(e);</span>
		}
	}

	/**
	 * Copy assignment rules to org.
	 *
	 * @param context the context
	 * @param performActionOnIDsAsCollection the perform action on i ds as collection
	 * @param selectedIDObject the selected id object
	 * @param localeContext the locale context
	 * @throws BbmCreateException the bbm create exception
	 */
	public static void copyAssignmentRulesToOrg(RequestContext context,
			Collection&lt;ID&gt; performActionOnIDsAsCollection, ID selectedIDObject,
			LocaleContext localeContext) throws BbmCreateException {
		try {
<span class="nc" id="L2366">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L2367">			wrm.copyAssignmentRulesToOrg(performActionOnIDsAsCollection, selectedIDObject, localeContext);</span>
<span class="nc" id="L2368">		} catch (BbmCreateException e) {</span>
<span class="nc" id="L2369">			throw e;</span>
<span class="nc" id="L2370">		} catch (Exception e) {</span>
<span class="nc" id="L2371">			throw new BbmCreateException(e);</span>
<span class="nc" id="L2372">		}</span>
<span class="nc" id="L2373">	}</span>

	/**
	 * Delete complex work rule.
	 *
	 * @param context the context
	 * @param performActionOnIDsAsCollection the perform action on i ds as collection
	 * @throws BbmRemoveException the bbm remove exception
	 */
	public static void deleteComplexWorkRule(RequestContext context,
			Collection&lt;ID&gt; performActionOnIDsAsCollection) throws BbmRemoveException {
		try {
<span class="nc" id="L2385">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L2386">			wrm.deleteAssignmentRules(performActionOnIDsAsCollection);</span>
<span class="nc" id="L2387">		} catch (BbmRemoveException e) {</span>
<span class="nc" id="L2388">			throw e;</span>
<span class="nc" id="L2389">		} catch (Exception e) {</span>
<span class="nc" id="L2390">			throw new BbmRemoveException(e);</span>
<span class="nc" id="L2391">		}</span>
<span class="nc" id="L2392">	}</span>
	
	/**
	 * Gets the time periods of day.
	 *
	 * @param context the context
	 * @return the time periods of day
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Collection&lt;TimePeriodOfDay&gt; getTimePeriodsOfDay(RequestContext context) throws BbmFinderException {
		try {
<span class="fc" id="L2403">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L2404">			return wrm.getTimePeriodsOfDay();</span>
<span class="nc" id="L2405">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L2406">			throw e;</span>
<span class="nc" id="L2407">		} catch (Exception e) {</span>
<span class="nc" id="L2408">			throw new BbmFinderException(e);</span>
		}
	}
	
	/**
	 * Checks if is multi week rules enabled.
	 *
	 * @return true, if is multi week rules enabled
	 * @throws Exception the exception
	 */
	public static boolean isMultiWeekRulesEnabled() throws Exception {
		// MultiWeekOptimization is set to 1 in BPCONFIG
<span class="fc" id="L2420">		return &quot;1&quot;.equals(GeneralSetupModelHandler.getGenericDbValue(ConfigKey.DE_MULTI_WEEK_OPTIMIZATION));</span>
	}

	/**
	 * Checks if is monthly rules enabled.
	 *
	 * @return true, if is monthly rules enabled
	 * @throws Exception the exception
	 */
	public static boolean isMonthlyRulesEnabled() throws Exception {
<span class="fc" id="L2430">		LicenseManager licenseManager = CoreManagerFactory.getLicenseManager();</span>
<span class="fc" id="L2431">		return licenseManager.isLicensed(LicenseKeys.APP_MONTHLY_FORECAST_AND_RULES);</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>