<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>TimeOffIntervalCalendarPC.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.rm.requests.timeoff</a> &gt; <span class="el_source">TimeOffIntervalCalendarPC.java</span></div><h1>TimeOffIntervalCalendarPC.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.rm.requests.timeoff;

import java.text.NumberFormat;
import java.util.List;
import java.util.ResourceBundle;
import java.util.TimeZone;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.l10n.RegionalFormatBundleKey;
import com.bluepumpkin.common.util.HtmlEncoder;
import com.bluepumpkin.ejb.rm.requests.timeoff.model.TOIntervalCalendar;
import com.bluepumpkin.ejb.rm.requests.timeoff.model.TOIntervalCalendarDay;
import com.bluepumpkin.ejb.rm.requests.timeoff.model.TOIntervalCalendarIncrement;
import com.bluepumpkin.ejb.rm.requests.timeoff.model.TOIntervalCalendarInterval;
import com.bluepumpkin.ejb.rm.setup.calendartimeoff.model.TOIntervalAllocation;
import com.bluepumpkin.ejb.rm.setup.settings.model.OrganizationSetting;
import com.bluepumpkin.ejb.rm.util.DateUtil;
import com.bluepumpkin.web.core.l10n.CoreWebBundleKey;
import com.bluepumpkin.web.rm.keys.RmJavaScriptFileID;
import com.bluepumpkin.web.rm.l10n.RmWebBundleKey;
import com.witness.ejb.core.security.PrivilegeKeys;
import com.witness.web.uif.l10n.UIFWebBundleKey;
import com.witness.web.uif.pagecomponent.CompositePC;
import com.witness.web.uif.pagecomponent.container.DualContainerPC;
import com.witness.web.uif.system.RequestContext;

/**
 * Renders HTML for the Time Off Interval Calendar.
 */
public class TimeOffIntervalCalendarPC extends CompositePC {
	private static final int NUMBER_OF_DECIMALS = 2;

	/**
	 *
	 */
	private static final long serialVersionUID = 5093278963757536344L;

	private final ResourceBundle rmWebBundle;
<span class="nc" id="L39">	private DualContainerPC dualContainerPC = null;</span>
	private String legendHtml;
	private final NumberFormat numberFormat;
	private OrganizationSetting orgSetting;
	private TOIntervalCalendar timeOffIntervalCalendar;
	private final TimeOffIntervalCalendarCellDetailBuilder cellBuilder;
	private final boolean isLinkToRequestEnabledForInterval;

	// ================================================================================
	// CONSTRUCTION
	// ================================================================================

	/**
	 * Constructor
	 *
	 * @param context
	 *            The RequestContext
	 */
	public TimeOffIntervalCalendarPC(RequestContext context) {
<span class="nc" id="L58">		super(context);</span>

<span class="nc" id="L60">		setName(&quot;timeOffIntervalCalendarPC&quot;);</span>
<span class="nc" id="L61">		rmWebBundle = m_localizer.getBundle(RmWebBundleKey.BUNDLE_NAME);</span>

<span class="nc" id="L63">		dualContainerPC = new DualContainerPC(context);</span>
<span class="nc" id="L64">		dualContainerPC.setName(this.getName() + &quot;_DualContainer&quot;);</span>
<span class="nc" id="L65">		addChildComponent(dualContainerPC);</span>

		// start with empty cells so it doesn't render &quot;null&quot;
<span class="nc" id="L68">		dualContainerPC.setLeftComponent(&quot;&quot;);</span>
<span class="nc" id="L69">		dualContainerPC.setRightComponent(&quot;&quot;);</span>

<span class="nc" id="L71">		numberFormat = getNumberFormat();</span>
<span class="nc" id="L72">		isLinkToRequestEnabledForInterval = context.getUser().isAuthorized(PrivilegeKeys.TOM_VIEWINTERVALCALENDARLINKS);</span>
<span class="nc" id="L73">		cellBuilder = new TimeOffIntervalCalendarCellDetailBuilder(numberFormat, m_localizer, getName(),isLinkToRequestEnabledForInterval);</span>

<span class="nc" id="L75">		setJSMediator(RmJavaScriptFileID.TIMEOFF_CAL_CONTAINER);</span>
<span class="nc" id="L76">		addRequiredJavaScriptFile(RmJavaScriptFileID.JQUERY_UI);</span>
<span class="nc" id="L77">		addRequiredJavaScriptFile(RmJavaScriptFileID.TIME_OFF_INTERVAL_CALENDAR_EXPANDED_VIEW);</span>
<span class="nc" id="L78">	}</span>

	// ================================================================================
	// INTERFACE
	// ================================================================================

	/**
	 * Initialize For Display
	 */
	@Override
	public void initForDisplay() {
<span class="nc bnc" id="L89" title="All 2 branches missed.">		if (m_isInitializedForDisplay) {</span>
<span class="nc" id="L90">			return;</span>
		} else {
<span class="nc" id="L92">			super.initForDisplay();</span>
		}
<span class="nc" id="L94">	}</span>

	@Override
	public String getCustomJavaScript() {
<span class="nc" id="L98">		String js = super.getCustomJavaScript();</span>
<span class="nc bnc" id="L99" title="All 2 branches missed.">		if (dualContainerPC != null) {</span>
<span class="nc" id="L100">			js += &quot;\nfunction customResize() {&quot; + dualContainerPC.getName() + &quot;.onResize(); } \n&quot;;</span>
		}
<span class="nc" id="L102">		return js;</span>
	}

	public void setLegendHtml(String legendHtml) {
<span class="nc" id="L106">		this.legendHtml = legendHtml;</span>
<span class="nc" id="L107">	}</span>

	public void setMode(boolean isAgentView, boolean isAgentTOPoolView) {
<span class="nc" id="L110">		cellBuilder.setMode(isAgentView, isAgentTOPoolView);</span>
<span class="nc" id="L111">	}</span>

	public void setOrganizationSetting(OrganizationSetting orgSetting) {
<span class="nc" id="L114">		this.orgSetting = orgSetting;</span>
<span class="nc" id="L115">	}</span>

	public void setSelectedOrganization(ID orgID) {
<span class="nc" id="L118">		cellBuilder.setSelectedOrganization(orgID);</span>
<span class="nc" id="L119">	}</span>

	public void setSelectedPool(ID topID) {
<span class="nc" id="L122">		cellBuilder.setSelectedPool(topID);</span>
<span class="nc" id="L123">	}</span>

	public void setTimeOffIntervalCalendar(TOIntervalCalendar timeOffIntervalCalendar) {
<span class="nc" id="L126">		this.timeOffIntervalCalendar = timeOffIntervalCalendar;</span>
<span class="nc" id="L127">	}</span>

	/**
	 * Return HTML Display
	 */
	@Override
	public String getHtmlDisplay() {
<span class="nc" id="L134">		StringBuilder sb = new StringBuilder();</span>
<span class="nc" id="L135">		sb.append(&quot;&lt;div id=\&quot;timeOffIntervalCalendarPC\&quot; class=\&quot;timeOffIntervalCalendarPC\&quot; &quot;);</span>
<span class="nc" id="L136">		sb.append(&quot;style=\&quot;position:absolute;top:25px;left:0px;right:0px;bottom:0px;\&quot;&gt;\n&quot;);</span>
<span class="nc" id="L137">		appendStyle(sb);</span>
<span class="nc bnc" id="L138" title="All 2 branches missed.">		if (timeOffIntervalCalendar != null) {</span>
<span class="nc" id="L139">			buildDates();</span>
<span class="nc" id="L140">			buildIntervalGrid();</span>
		}
<span class="nc" id="L142">		sb.append(dualContainerPC.getHtmlDisplay());</span>
<span class="nc" id="L143">		return sb.toString();</span>
	}

	// ================================================================================
	// IMPLEMENTATION
	// ================================================================================

	/**
	 * Appends the legend container and the legend HTML. This is used because of the sync scrolling on the dual list container.
	 */
	private void appendLegend(StringBuilder sb, boolean isAppendingLegend) {
<span class="nc" id="L154">		sb.append(&quot;&lt;br/&gt;&quot;);</span>
<span class="nc" id="L155">		sb.append(&quot;&lt;div class=\&quot;legendContainer\&quot;&gt;&quot;);</span>
<span class="nc bnc" id="L156" title="All 4 branches missed.">		if (isAppendingLegend &amp;&amp; legendHtml != null) {</span>
<span class="nc" id="L157">			sb.append(legendHtml);</span>
		}
<span class="nc" id="L159">		sb.append(&quot;&lt;/div&gt;&quot;);</span>
<span class="nc" id="L160">	}</span>

	private void appendStyle(StringBuilder sb) {
<span class="nc" id="L163">		sb.append(&quot;&lt;style type=\&quot;text/css\&quot;&gt;&quot;);</span>
<span class="nc" id="L164">		sb.append(&quot;.timeOffIntervalCalendarPC .legendContainer { display: inline-block; height: 200px; width: 100%; font-family:arial; }&quot;);</span>
<span class="nc" id="L165">		sb.append(&quot;.toicIntervalGrid { box-sizing: border-box; margin: 0px 1em 0px 0px; padding: 0px; font-family:arial; }&quot;);</span>
<span class="nc" id="L166">		sb.append(&quot;.toicIntervalGrid td, .toicIntervalGrid th { white-space: nowrap; }&quot;);</span>
<span class="nc" id="L167">		sb.append(&quot;.toicIntervalGrid th span.hour { height: 23px; box-sizing: border-box; width: 60px;  }&quot;);</span>
<span class="nc" id="L168">		sb.append(&quot;.toicIntervalGrid th { }&quot;);</span>
<span class="nc" id="L169">		sb.append(&quot;.toicIntervalGrid td { }&quot;);</span>
<span class="nc" id="L170">		sb.append(&quot;.toicIntervalGrid .scroll-spacer { width: 5px; }&quot;);</span>
<span class="nc" id="L171">		sb.append(&quot;.toicIntervalGrid .intervalcell { padding-top: 2px; padding-bottom: 2px; display:inline-block; &quot;);</span>
<span class="nc" id="L172">		sb.append(&quot; border: 1px solid #e3e3e3; overflow: hidden; text-overflow: ellipsis; text-align: center; box-sizing: border-box; &quot;);</span>
<span class="nc" id="L173">		sb.append(&quot; position: relative; z-index: 0; height: 22px; vertical-align: middle; }&quot;);</span>

<span class="nc" id="L175">		sb.append(&quot;.toicIntervalGrid .intervalcell label { vertical-align: middle; font-family:arial; } &quot;);</span>
<span class="nc" id="L176">		sb.append(&quot;.toicIntervalGrid td span span.increment { position: absolute; top: 0px; bottom: 0px; width: 15px; z-index: -1; }&quot;);</span>
<span class="nc" id="L177">		cellBuilder.appendOrganziationColorStyles(sb, orgSetting, &quot;.toicIntervalGrid td span span.increment&quot;);</span>
<span class="nc" id="L178">		sb.append(&quot;.toicIntervalGrid td span.spacer { display: inline-block; border: none; width:60px; max-width:60px; }&quot;);</span>
<span class="nc" id="L179">		sb.append(&quot;.toicIntervalGrid tr { height: 22px; max-height: 22px; }&quot;);</span>
<span class="nc" id="L180">		sb.append(&quot;.toicIntervalGrid_HeaderRow { height: 29px; font-family:arial; }&quot;);</span>

<span class="nc" id="L182">		sb.append(&quot;.expandedView { position: absolute; display:inline-block;  padding: 6px; min-height: 66px; border: 1px solid #e3e3e3; font-family:arial;&quot;);</span>
<span class="nc" id="L183">		sb.append(&quot; background-color:#ffffca; z-index: 10;} &quot;);</span>

<span class="nc" id="L185">		sb.append(&quot;.toicDateGrid { box-sizing: border-box; margin: 0px 0px 0px 0px; padding: 0px; font-family:arial; }&quot;);</span>
<span class="nc" id="L186">		sb.append(&quot;.toicDateGrid td, .toicDateGrid th { padding-left: 1px; padding-right: 1px; }&quot;);</span>
<span class="nc" id="L187">		sb.append(&quot;.toicDateGrid th.date { vertical-align: middle; white-space: nowrap; text-align: right; }&quot;);</span>
<span class="nc" id="L188">		sb.append(&quot;.toicDateGrid tbody tr { height: 22px; max-height: 22px; }&quot;);</span>
<span class="nc" id="L189">		sb.append(&quot;&lt;/style&gt;&quot;);</span>
<span class="nc" id="L190">	}</span>

	private void buildDates() {
<span class="nc" id="L193">		List&lt;TOIntervalCalendarDay&gt; days = timeOffIntervalCalendar.getDays();</span>
<span class="nc" id="L194">		TimeZone tz = m_context.getViewingTimeZone();</span>
<span class="nc" id="L195">		StringBuilder sb = new StringBuilder();</span>

<span class="nc" id="L197">		sb.append(&quot;&lt;table class=\&quot;toicDateGrid\&quot; cellspacing=\&quot;0\&quot; cellpadding=\&quot;0\&quot;&gt;&quot;);</span>
<span class="nc" id="L198">		sb.append(&quot;&lt;thead&gt;&lt;tr&gt;&lt;th class=\&quot;tableHeaderLightLeft\&quot;&gt;&quot;);</span>
<span class="nc" id="L199">		sb.append(i18n(m_common_bundle, UIFWebBundleKey.DATE));</span>
<span class="nc" id="L200">		sb.append(&quot;&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&quot;);</span>
<span class="nc bnc" id="L201" title="All 2 branches missed.">		for (TOIntervalCalendarDay day : days) {</span>
<span class="nc" id="L202">			sb.append(&quot;&lt;tr&gt;&lt;th class=\&quot;date\&quot;&gt;&quot;);</span>
<span class="nc" id="L203">			sb.append(m_localizer.formatDate(day.getStartTime(), tz, RegionalFormatBundleKey.FULL_DATE_FORMAT));</span>
<span class="nc" id="L204">			sb.append(&quot;&lt;/th&gt;&lt;/tr&gt;&quot;);</span>
<span class="nc" id="L205">		}</span>
<span class="nc" id="L206">		sb.append(&quot;&lt;/tbody&gt;&lt;/table&gt;&quot;);</span>

<span class="nc" id="L208">		appendLegend(sb, false);</span>

<span class="nc" id="L210">		dualContainerPC.setLeftComponent(sb.toString());</span>
<span class="nc" id="L211">	}</span>

	private void buildIntervalGrid() {
<span class="nc" id="L214">		TOIntervalCalendarDay longestDay = timeOffIntervalCalendar.getLongestDay();</span>
<span class="nc bnc" id="L215" title="All 2 branches missed.">		if (longestDay == null) {</span>
<span class="nc" id="L216">			return;</span>
		}
<span class="nc" id="L218">		TimeZone tz = m_context.getViewingTimeZone();</span>
<span class="nc" id="L219">		int index = timeOffIntervalCalendar.getIndex(longestDay.getStartTime());</span>
<span class="nc" id="L220">		int endIndexExclusive = timeOffIntervalCalendar.getIndex(longestDay.getEndTime());</span>
<span class="nc" id="L221">		List&lt;TOIntervalCalendarIncrement&gt; increments = timeOffIntervalCalendar.getIncrements();</span>

<span class="nc" id="L223">		StringBuilder sb = new StringBuilder();</span>
<span class="nc" id="L224">		sb.append(getExpandedView());</span>

<span class="nc" id="L226">		sb.append(&quot;&lt;table class=\&quot;toicIntervalGrid\&quot; cellspacing=\&quot;0\&quot; cellpadding=\&quot;0\&quot; &quot;);</span>
<span class="nc" id="L227">		sb.append(&quot;style=\&quot;\&quot;&gt;&lt;thead&gt;&lt;tr class=\&quot;toicIntervalGrid_HeaderRow\&quot;&gt;&quot;);</span>

<span class="nc" id="L229">		sb.append(&quot;&lt;th class=\&quot;\&quot;&gt;&quot;);</span>
<span class="nc bnc" id="L230" title="All 2 branches missed.">		for (; index &lt; endIndexExclusive; index += DateUtil.INTERVALS_IN_HOUR) {</span>
<span class="nc" id="L231">			TOIntervalCalendarIncrement increment = increments.get(index);</span>
<span class="nc" id="L232">			String time = m_localizer.formatDate(increment.getDate(), tz, RegionalFormatBundleKey.TIME_FORMAT);</span>
<span class="nc" id="L233">			sb.append(&quot;&lt;span class=\&quot;hour\&quot;&gt;&quot;).append(time).append(&quot;&lt;/span&gt;&quot;);</span>
		}
<span class="nc" id="L235">		sb.append(&quot;&lt;/th&gt;&lt;th class=\&quot;scroll-spacer\&quot;&gt;&amp;nbsp;&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&quot;);</span>
<span class="nc" id="L236">		buildIntervals(sb);</span>
<span class="nc" id="L237">		sb.append(&quot;&lt;/tbody&gt;&lt;/table&gt;&quot;);</span>

<span class="nc" id="L239">		appendLegend(sb, true);</span>

<span class="nc" id="L241">		dualContainerPC.setRightComponent(sb.toString());</span>
<span class="nc" id="L242">	}</span>

	private String getExpandedView() {
<span class="nc" id="L245">		return &quot;&lt;div class='expandedView'&gt;&quot;</span>
				// table start and header
				+ &quot;&lt;table&gt;&lt;tr&gt;&lt;td colspan='2'&gt;&lt;b&gt;&lt;label id='expanded_view_heading'&gt;&lt;/label&gt;&lt;/b&gt;&lt;td&gt;&lt;/tr&gt; &lt;tr&gt;&lt;td&gt;&quot;
				// hours available/allocated
<span class="nc" id="L249">				+ cellBuilder.getAvailableOrAllocatedLabelText()</span>
				+ &quot;&lt;/td&gt;&lt;td&gt;&lt;label id='expanded_view_val_available'&gt;&lt;/label&gt;&lt;td&gt;&lt;/tr&gt;&quot;
				// hours pending
<span class="nc" id="L252">				+ getExpandedViewRow(&quot;pending&quot;, i18n(rmWebBundle, RmWebBundleKey.TIMEOFF_HOURS_PENDING))</span>
				// hours scheduled
<span class="nc" id="L254">				+ getExpandedViewRow(&quot;scheduled&quot;, i18n(rmWebBundle, RmWebBundleKey.TIMEOFF_SCHEDULED_TO))</span>
				// close table
				+ &quot;&lt;/table&gt;&lt;/div&gt;&quot;;
	}

	private String getExpandedViewRow(String id, String heading) {
<span class="nc" id="L260">		return String.format(</span>
				// heading cell
				&quot;&lt;tr&gt;&lt;td&gt; &lt;label id='label_%s'&gt;%s&lt;/label&gt;&lt;a id='anchor_%s'&gt;%s&lt;/a&gt;  &lt;/td&gt;&quot;
						// value cell
						+ &quot;&lt;td&gt;&lt;label id='label_val_%s'&gt;&lt;/label&gt;&lt;a id='anchor_val_%s'&gt;&lt;/a&gt; &lt;td&gt;&lt;/tr&gt;&quot;,
				// heading cell
				id, heading, id, heading,
				// value cell
				id, id);
	}

	private void buildIncrements(StringBuilder sb, TOIntervalCalendarInterval interval) {
<span class="nc" id="L272">		int startIndex = timeOffIntervalCalendar.getIndex(interval.getStartTime());</span>
<span class="nc" id="L273">		int endIndexExclusive = timeOffIntervalCalendar.getIndex(interval.getEndTime());</span>
<span class="nc" id="L274">		List&lt;TOIntervalCalendarIncrement&gt; increments = timeOffIntervalCalendar.getIncrements();</span>
<span class="nc" id="L275">		int dstOffset = 0;</span>
<span class="nc bnc" id="L276" title="All 2 branches missed.">		for (int index = startIndex; index &lt; endIndexExclusive; index++) {</span>
<span class="nc" id="L277">			TOIntervalCalendarIncrement increment = increments.get(index);</span>
<span class="nc" id="L278">			boolean sameStartTime = interval.getStartTime().equals(increment.getDate());</span>
<span class="nc bnc" id="L279" title="All 4 branches missed.">			if (!sameStartTime &amp;&amp; timeOffIntervalCalendar.hasDstTransitionGapBefore(increment)) {</span>
<span class="nc" id="L280">				dstOffset = DateUtil.INTERVALS_IN_HOUR;</span>
			}
<span class="nc" id="L282">			String cssClass = cellBuilder.getCssClass(increment);</span>
<span class="nc" id="L283">			sb.append(&quot;&lt;span class=\&quot;increment &quot;).append(cssClass).append(&quot;\&quot; style=\&quot;&quot;);</span>
<span class="nc" id="L284">			sb.append(&quot;left:&quot;).append((index - startIndex + dstOffset) * DateUtil.TIME_INTERVAL).append(&quot;px;&quot;);</span>
<span class="nc" id="L285">			sb.append(&quot;\&quot;&gt;&lt;/span&gt;&quot;);</span>
		}
<span class="nc" id="L287">	}</span>

	private void buildIntervals(StringBuilder sb) {
<span class="nc" id="L290">		List&lt;TOIntervalCalendarDay&gt; days = timeOffIntervalCalendar.getDays();</span>
<span class="nc bnc" id="L291" title="All 2 branches missed.">		for (int dayIndex = 0; dayIndex &lt; days.size(); dayIndex++) {</span>
<span class="nc" id="L292">			TOIntervalCalendarDay day = days.get(dayIndex);</span>
<span class="nc" id="L293">			sb.append(&quot;&lt;tr&gt;&lt;td&gt;&quot;);</span>
<span class="nc" id="L294">			List&lt;TOIntervalCalendarInterval&gt; intervals = day.getIntervals();</span>
<span class="nc bnc" id="L295" title="All 2 branches missed.">			for (TOIntervalCalendarInterval interval : intervals) {</span>
<span class="nc" id="L296">				int index = timeOffIntervalCalendar.getIndex(interval.getStartTime());</span>
<span class="nc" id="L297">				int endIndexExclusive = timeOffIntervalCalendar.getIndex(interval.getEndTime());</span>
<span class="nc" id="L298">				int colspan = endIndexExclusive - index;</span>
				// Add a spacer cell if necessary
<span class="nc bnc" id="L300" title="All 2 branches missed.">				if (timeOffIntervalCalendar.hasDstTransitionGapBefore(interval, day)) {</span>
<span class="nc" id="L301">					sb.append(&quot;&lt;span class=\&quot;spacer\&quot; style=\&quot;\&quot;&gt; &lt;/span&gt;&quot;);</span>
<span class="nc bnc" id="L302" title="All 2 branches missed.">				} else if (timeOffIntervalCalendar.hasDstTransitionGapWithin(interval)) {</span>
					// Add spacer columns to the interval.
<span class="nc" id="L304">					colspan += DateUtil.INTERVALS_IN_HOUR;</span>
				}
<span class="nc" id="L306">				buildIntervalCell(sb, interval, colspan);</span>
<span class="nc" id="L307">			}</span>
<span class="nc" id="L308">			sb.append(&quot;&lt;/td&gt;&lt;td class=\&quot;scroll-spacer\&quot;&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;&quot;);</span>
		}
<span class="nc" id="L310">	}</span>

	private void buildIntervalCell(StringBuilder sb, TOIntervalCalendarInterval interval, int colspan) {

<span class="nc" id="L314">		cellBuilder.initialize(interval);</span>
<span class="nc" id="L315">		String dateRangeText = getDateRangeText(interval);</span>
<span class="nc" id="L316">		String cell = cellBuilder.getCellText();</span>
<span class="nc" id="L317">		String tooltip = cellBuilder.getCellTooltip(dateRangeText);</span>

<span class="nc" id="L319">		sb.append(&quot;&lt;span class='intervalcell' data-columns=\&quot;&quot;).append(colspan).append(&quot;\&quot; &quot;);</span>
<span class="nc" id="L320">		addDataElement(sb, &quot;data-heading&quot;, dateRangeText);</span>
<span class="nc" id="L321">		addDataElement(sb, &quot;data-availableorallocated&quot;, cellBuilder.getAvailableOrAllocatedHoursText());</span>
<span class="nc" id="L322">		addDataElement(sb, &quot;data-pending&quot;, cellBuilder.getPendingHoursText());</span>
<span class="nc" id="L323">		addDataElement(sb, &quot;data-scheduled&quot;, cellBuilder.getScheduledHoursText());</span>

<span class="nc" id="L325">		sb.append(&quot;style=\&quot;width: &quot;).append(colspan * DateUtil.TIME_INTERVAL).append(&quot;px;&quot;);</span>
<span class="nc" id="L326">		sb.append(&quot;max-width: &quot;).append(colspan * DateUtil.TIME_INTERVAL).append(&quot;px;&quot;);</span>
<span class="nc" id="L327">		sb.append(&quot;min-width: &quot;).append(colspan * DateUtil.TIME_INTERVAL).append(&quot;px;\&quot; &quot;);</span>
<span class="nc" id="L328">		sb.append(&quot;title=\&quot;&quot;).append(HtmlEncoder.encode(tooltip)).append(&quot;\&quot; &gt;&quot;);</span>

<span class="nc" id="L330">		buildIncrements(sb, interval);</span>

<span class="nc" id="L332">		sb.append(&quot;&lt;label style=\&quot;width: 100%;\&quot;&gt;&quot;);</span>
<span class="nc" id="L333">		sb.append(cell);</span>
<span class="nc" id="L334">		sb.append(&quot;&lt;/label&gt;&quot;);</span>

<span class="nc" id="L336">		sb.append(&quot;&lt;/span&gt;&quot;);</span>
<span class="nc" id="L337">	}</span>

	private void addDataElement(StringBuilder sb, String elementName, String value) {
<span class="nc" id="L340">		sb.append(elementName).append(&quot;='&quot;).append(HtmlEncoder.encode(value)).append(&quot;'&quot;);</span>
<span class="nc" id="L341">	}</span>

	private String getDateRangeText(TOIntervalCalendarInterval interval) {
<span class="nc" id="L344">		TimeZone timeZone = m_context.getViewingTimeZone();</span>
<span class="nc" id="L345">		TOIntervalAllocation allocationInterval = interval.getInterval();</span>
<span class="nc" id="L346">		return m_localizer.i18n(CoreWebBundleKey.BUNDLE_NAME, CoreWebBundleKey.RANGE_SEPARATOR,</span>
<span class="nc" id="L347">				m_localizer.formatDateTime(allocationInterval.getStartTime(), timeZone),</span>
<span class="nc" id="L348">				m_localizer.formatDateTime(allocationInterval.getEndTime(), timeZone));</span>
	}

	/**
	 * Gets the number formatter used for the interval's allocated hours.
	 */
	private NumberFormat getNumberFormat() {
<span class="nc" id="L355">		NumberFormat format = m_context.getLocalizer().getNumberFormatter(NUMBER_OF_DECIMALS);</span>
<span class="nc" id="L356">		format.setMinimumFractionDigits(0);</span>
<span class="nc" id="L357">		format.setMaximumFractionDigits(NUMBER_OF_DECIMALS);</span>
<span class="nc" id="L358">		return format;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>