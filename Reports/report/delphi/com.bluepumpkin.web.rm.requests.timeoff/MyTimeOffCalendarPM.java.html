<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>MyTimeOffCalendarPM.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.rm.requests.timeoff</a> &gt; <span class="el_source">MyTimeOffCalendarPM.java</span></div><h1>MyTimeOffCalendarPM.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.rm.requests.timeoff;

import java.util.ArrayList;
import java.util.Collections;
import java.util.List;
import java.util.ResourceBundle;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.StringsPair;
import com.bluepumpkin.common.logging.Category;
import com.bluepumpkin.ejb.bbm.activity.model.Activity;
import com.bluepumpkin.ejb.rm.RmManagerFactory;
import com.bluepumpkin.ejb.rm.setup.calendartimeoff.model.TOPool;
import com.bluepumpkin.ejb.rm.setup.settings.model.OrganizationSetting;
import com.bluepumpkin.ejb.rm.util.LicenseUtil;
import com.bluepumpkin.web.bbm.activity.ActivityModelHandler;
import com.bluepumpkin.web.bbm.organization.OrganizationModelHandler;
import com.bluepumpkin.web.rm.Log;
import com.bluepumpkin.web.rm.keys.RmKeys;
import com.bluepumpkin.web.rm.keys.RmPageAction;
import com.bluepumpkin.web.rm.l10n.RmWebBundleKey;
import com.bluepumpkin.web.rm.requests.RequestUtil;
import com.bluepumpkin.web.rm.requests.RequestsMH;
import com.witness.ejb.core.security.PrivilegeKeys;
import com.witness.ejb.core.security.model.User;
import com.witness.web.uif.base.Message;
import com.witness.web.uif.keys.JavaScriptFileID;
import com.witness.web.uif.l10n.UIFWebBundleKey;
import com.witness.web.uif.pagecomponent.container.ContainerPC;
import com.witness.web.uif.pagecomponent.contenttitle.ContentTitlePC;
import com.witness.web.uif.pagemodel.PageModel;
import com.witness.web.uif.pagemodel.WorkpanePageModel;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.util.HtmlUtil;
import com.witness.web.uif.util.js.JSUtil;

/**
 * Title:        MyTimeOffCalendarPM
 * Description:  My Time Off Calendar
 * Copyright:    Copyright (c) 2001
 * Company:      Blue Pumpkin Software, inc
 * @author       David Su
 * @version      1.0
 */
public class MyTimeOffCalendarPM extends WorkpanePageModel {
   
	private static final long serialVersionUID = 6548090037151131781L;

<span class="nc" id="L49">	private static Category log	= Log.initCategory(MyTimeOffCalendarPM.class.getName());</span>

    private static final String VIEW_MODE_KEY = &quot;MyTOCalViewMode&quot;;
    private static final String FORM_ACTION = &quot;my_timeoff_calendar&quot;;
    private static final String VIEW_MODE_FN = &quot;viewMode&quot;;

    private static final String HOURS_MODE_KEY = &quot;MyTOCalHoursMode&quot;;
    private static final String HOURS_MODE_FN = &quot;hoursMode&quot;;
    
    private static final String TOACTIVITY_SELECTION_KEY = &quot;MyTOCalActivitySelection&quot;;
    private static final String TOACTIVITY_SELECTION_FN = &quot;activitySelection&quot;;
    
    

    // VIEW RANGE MODES
    public static final String TWO_MONTH_VIEW = &quot;TWO_MONTH_VIEW&quot;;
    public static final String YEAR_VIEW = &quot;YEAR_VIEW&quot;;
    public static final String INTERVAL_VIEW = &quot;INTERVAL_VIEW&quot;;

    // HOURS TYPE MODES
    public static final String SHOW_TIME_OFF_POOL_VIEW = &quot;SHOW_TIME_OFF_POOL_VIEW&quot;;
    public static final String SHOW_PERSONAL_VIEW = &quot;SHOW_PERSONAL_VIEW&quot;;

    private final TimeOffCalendarPC timeOffCalendarPC;
    private ContainerPC interDayPC;
    private final ResourceBundle bundle;

    //TWO_MONTH_VIEW or YEAR_VIEW
    private String viewRangeMode; 
    //SHOW_TIME_OFF_POOL_VIEW or SHOW_PERSONAL_VIEW
    private String hoursMode;
    
    private String activitySelection;
    
    private OrganizationSetting orgSetting;
    private final User user;
    private final ID empID;
<span class="nc" id="L86">    private boolean isAuthorizedToView = false;</span>
<span class="nc" id="L87">    private boolean isTOActive = true;</span>
<span class="nc" id="L88">	private boolean hasAdvancedRMLicense = false;</span>
	
<span class="nc" id="L90">	private List&lt;Activity&gt; listTOActivities = new ArrayList&lt;Activity&gt;();</span>
<span class="nc" id="L91">	private final List&lt;StringsPair&gt; stringPairlistTOActivities = new ArrayList&lt;StringsPair&gt;();</span>

	
    /**
     * Constructs a schedule view page model shell.
     */
    public MyTimeOffCalendarPM(RequestContext context)	{
<span class="nc" id="L98">        super(context, BASIC_MODEL);</span>

<span class="nc" id="L100">        bundle = m_localizer.getBundle(RmWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L101">        user = context.getUser();</span>
<span class="nc" id="L102">        empID = RequestUtil.getEmpIDAndAddMsgIfNotAvailable(context, this);</span>
<span class="nc" id="L103">        setJSMediator(JavaScriptFileID.MEDIATOR_WORKPANE_GENERIC);</span>

<span class="nc" id="L105">        timeOffCalendarPC = new TimeOffCalendarPC(m_context, m_toolbar);</span>
<span class="nc" id="L106">        addChildComponent(timeOffCalendarPC);</span>

<span class="nc" id="L108">        hasAdvancedRMLicense = LicenseUtil.isAdvancedRMLicense();</span>
<span class="nc" id="L109">        isAuthorizedToView = isAuthToView();</span>
<span class="nc" id="L110">        initViewMode();</span>
<span class="nc" id="L111">        initHoursMode();</span>
<span class="nc" id="L112">        initActivitySelector();</span>
       
       
<span class="nc" id="L115">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
	private void initActivitySelector() {
<span class="nc bnc" id="L119" title="All 2 branches missed.">    	 if (hasAdvancedRMLicense) {</span>
<span class="nc" id="L120">    		loadActivities();</span>
<span class="nc bnc" id="L121" title="All 2 branches missed.">			if(listTOActivities!=null){</span>
<span class="nc bnc" id="L122" title="All 2 branches missed.">				for (Activity act : listTOActivities) {</span>
<span class="nc" id="L123">					StringsPair pair = new StringsPair(act.getID().toString(), act.getName());</span>
<span class="nc" id="L124">					stringPairlistTOActivities.add(pair);</span>
<span class="nc" id="L125">				}</span>
			
<span class="nc" id="L127">				Collections.sort((ArrayList&lt;StringsPair&gt;)stringPairlistTOActivities);</span>
				
			}
<span class="nc" id="L130">         	initActivitySelection();</span>
 		}
		
<span class="nc" id="L133">	}</span>

	private void initViewMode() {
<span class="nc" id="L136">        viewRangeMode = (String)m_context.getAttribute(RequestContext.SESSION_SCOPE,</span>
                VIEW_MODE_KEY);
<span class="nc bnc" id="L138" title="All 2 branches missed.">        if (viewRangeMode==null) {</span>
<span class="nc" id="L139">			viewRangeMode = TWO_MONTH_VIEW;</span>
		}
<span class="nc" id="L141">    }</span>

    private void initHoursMode() {
<span class="nc" id="L144">        hoursMode = (String)m_context.getAttribute(RequestContext.SESSION_SCOPE,</span>
                HOURS_MODE_KEY);
<span class="nc bnc" id="L146" title="All 2 branches missed.">        if (hoursMode==null) {</span>
<span class="nc" id="L147">			hoursMode = SHOW_PERSONAL_VIEW;</span>
		}
<span class="nc" id="L149">    }</span>
    
    private void initActivitySelection(){
    	
<span class="nc" id="L153">    	this.activitySelection = (String)m_context.getAttribute(RequestContext.SESSION_SCOPE,</span>
    			TOACTIVITY_SELECTION_KEY);
    	
    	
<span class="nc bnc" id="L157" title="All 4 branches missed.">        if (activitySelection==null &amp;&amp; !this.stringPairlistTOActivities.isEmpty()) {</span>
<span class="nc" id="L158">        	StringsPair pair = stringPairlistTOActivities.get(0);</span>
<span class="nc" id="L159">        	activitySelection = pair.getKey();</span>
		}
    	
<span class="nc" id="L162">    }</span>

    /**
     * Initialize For Display
     */
    @Override
	public void initForDisplay() {
<span class="nc bnc" id="L169" title="All 2 branches missed.">        if (m_isInitializedForDisplay) {</span>
<span class="nc" id="L170">			return;</span>
		} else {
<span class="nc" id="L172">            super.initForDisplay();</span>

<span class="nc bnc" id="L174" title="All 2 branches missed.">            if (!isTOActive) {</span>
<span class="nc" id="L175">				TimeOffRequestUtil.addTONotActiveMsg(this);</span>
			}

            // Popup TimeOff Request Window
<span class="nc" id="L179">            addPopupArgs(RmPageAction.POPUP_TIMEOFF_REQUEST_FORM_ACTION, RmKeys.RH_TIMEOFF_FORM,</span>
                    null, null, &quot;800,600,ctr,ctr&quot;, true, 1);
        }
<span class="nc" id="L182">    }</span>

    /**
     * Return instance of Model which is ready to be rendered
     */
    public static PageModel getInstance(RequestContext context) {
<span class="nc" id="L188">        MyTimeOffCalendarPM model = null;</span>

<span class="nc" id="L190">        PageModel cachedModel = context.getPageModel();</span>
<span class="nc bnc" id="L191" title="All 2 branches missed.">        if (cachedModel instanceof MyTimeOffCalendarPM) {</span>
<span class="nc" id="L192">            model = (MyTimeOffCalendarPM)cachedModel;</span>
        } else {
<span class="nc" id="L194">            model = new MyTimeOffCalendarPM(context);</span>
<span class="nc" id="L195">            model.extractParameters(context.getRequest());</span>
<span class="nc" id="L196">            context.setPageModel(model);</span>
        }

        // Make sure model is populated
<span class="nc" id="L200">        model.populateModel();</span>

<span class="nc" id="L202">        return model;</span>
    }

    /**
     * Populate Model
     */
    private void populateModel() {
<span class="nc bnc" id="L209" title="All 2 branches missed.">        if (m_isInitialized) {</span>
<span class="nc" id="L210">			return;</span>
		} else {
<span class="nc" id="L212">			m_isInitialized = true;</span>
		}

        try {
<span class="nc bnc" id="L216" title="All 2 branches missed.">            if (isAuthorizedToView) {</span>
<span class="nc" id="L217">            	ID orgID = OrganizationModelHandler.getEmployeeOrgID(m_context, empID);</span>

<span class="nc" id="L219">                orgSetting = RequestsMH.getOrgSetting(orgID);</span>
<span class="nc bnc" id="L220" title="All 2 branches missed.">                if (orgSetting == null){</span>
<span class="nc" id="L221">                	this.addPageMessage(Message.ERROR_TYPE, RmWebBundleKey.EMP_NO_ORG,</span>
        					RmWebBundleKey.BUNDLE_NAME);
<span class="nc" id="L223">                	return;</span>
                }
<span class="nc" id="L225">                isTOActive = orgSetting.getAgentTimeOffWorkflowActive();</span>

               
<span class="nc" id="L228">                boolean isTimeOffPoolView = hoursMode.equals(SHOW_TIME_OFF_POOL_VIEW);</span>
<span class="nc" id="L229">                initCalendarForDataFetch();</span>
<span class="nc" id="L230">                timeOffCalendarPC.setOrgSetting(orgSetting);</span>
<span class="nc" id="L231">                timeOffCalendarPC.setIsAgentCal(true);</span>
                //fetch data based on selection
<span class="nc bnc" id="L233" title="All 2 branches missed.">				if (shouldGetPool()) { </span>

<span class="nc" id="L235">					ID toPoolID = null;</span>
<span class="nc" id="L236">					TOPool toPool = TimeOffRequestsMH.getEmpPool(empID, null);</span>
<span class="nc bnc" id="L237" title="All 2 branches missed.">					toPoolID = toPool == null ? null : toPool.getID();</span>

<span class="nc" id="L239">					timeOffCalendarPC.fetchData(empID, isTimeOffPoolView, toPoolID, getAllocationType(), null);</span>
<span class="nc" id="L240">				} else {</span>
<span class="nc" id="L241">					ID activityID = null;</span>
<span class="nc bnc" id="L242" title="All 6 branches missed.">					if (isActivitySelectorEnabled() &amp;&amp; !this.listTOActivities.isEmpty() &amp;&amp; this.activitySelection != null) {</span>
<span class="nc" id="L243">						activityID = ID.fromInt(Integer.parseInt(activitySelection));</span>
					}
<span class="nc" id="L245">					timeOffCalendarPC.fetchData(empID, isTimeOffPoolView, null, getAllocationType(), activityID);</span>
				}
            }
<span class="nc" id="L248">        } catch (Exception ex) {</span>
<span class="nc" id="L249">            handleUnableToLoadDataError(log, ex);</span>
        } finally {
<span class="nc" id="L251">            initToolbar();</span>
<span class="nc" id="L252">        }</span>
<span class="nc" id="L253">    }</span>
    
    private boolean isActivitySelectorEnabled(){
<span class="nc" id="L256">    	return hasAdvancedRMLicense; </span>
    }

	private boolean shouldGetPool() {
		 
<span class="nc bnc" id="L261" title="All 4 branches missed.">		if (isActivitySelectorEnabled() &amp;&amp; !listTOActivities.isEmpty()) {</span>
<span class="nc" id="L262">			return false;</span>
		}
		 
<span class="nc bnc" id="L265" title="All 4 branches missed.">		if (hoursMode == null || !hoursMode.equals(SHOW_TIME_OFF_POOL_VIEW)) {</span>
<span class="nc" id="L266">			return false;</span>
		}
<span class="nc bnc" id="L268" title="All 4 branches missed.">		return timeOffCalendarPC.isDetailEnabled() || getAllocationType() == TimeOffCalendarPC.INTERVAL_ALLOCATION;</span>
	}

	private int getAllocationType() {
<span class="nc bnc" id="L272" title="All 4 branches missed.">		if (INTERVAL_VIEW.equals(viewRangeMode) &amp;&amp; hasAdvancedRMLicense) {</span>
<span class="nc" id="L273">			return TimeOffCalendarPC.INTERVAL_ALLOCATION;</span>
		}
<span class="nc" id="L275">		return TimeOffCalendarPC.DAILY_ALLOCATION;</span>
	}

	/**
     * Return the content title
     */
    @Override
	public ContentTitlePC getContentTitle()	{
        // Initialize Content Title
<span class="nc" id="L284">        String pageTitle = i18n(bundle, RmWebBundleKey.RM_MYSCHEDULE_TIMEOFFCAL);</span>
<span class="nc" id="L285">        m_contentTitlePC.setPageTitle(pageTitle);</span>
<span class="nc bnc" id="L286" title="All 2 branches missed.">        if (isAccessibilityComplianceMode()){</span>
<span class="nc" id="L287">            m_contentTitlePC.setAriaRegion(true);</span>
        }

<span class="nc bnc" id="L290" title="All 2 branches missed.">        if (isDisplayEnabled()) {</span>
            // Calendar Navigation
<span class="nc" id="L292">            String calendarNav = timeOffCalendarPC.getNavigationControl();</span>
<span class="nc" id="L293">            m_contentTitlePC.setItemName(calendarNav);</span>

<span class="nc bnc" id="L295" title="All 2 branches missed.">            if(isActivitySelectorEnabled()){</span>
<span class="nc" id="L296">            	String timeoffPoolLabel = i18n(bundle, RmWebBundleKey.TIMEOFF_TYPE_LABEL);</span>
<span class="nc" id="L297">            	m_contentTitlePC.addActiveComponent(timeoffPoolLabel, makeActivitiesDropDown(timeoffPoolLabel)+ &quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&quot;, true);</span>
            	
            }
            
            // View Options
<span class="nc" id="L302">            String viewLabel = i18n(m_common_bundle, UIFWebBundleKey.VIEW);</span>
<span class="nc" id="L303">            m_contentTitlePC.addActiveComponent(viewLabel, makeViewDropDown(viewLabel), true);</span>

            //Hours options (only relevant for details mode)
<span class="nc bnc" id="L306" title="All 2 branches missed.">            if (!YEAR_VIEW.equals(viewRangeMode)){</span>
<span class="nc" id="L307">                String hoursLabel = i18n(bundle, RmWebBundleKey.HOURS_TYPE);</span>
<span class="nc" id="L308">                m_contentTitlePC.addActiveComponent(&quot;&amp;nbsp;&amp;nbsp;&quot; + hoursLabel, makeHoursDropDown(hoursLabel) + &quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&quot;, true);</span>
            }
           
            
            
        }
<span class="nc" id="L314">        return m_contentTitlePC;</span>
    }

    /**
     * Initialize Calendar for Data Fetch
     */
    private void initCalendarForDataFetch() {
<span class="nc bnc" id="L321" title="All 2 branches missed.">        if (YEAR_VIEW.equals(viewRangeMode)) {</span>
<span class="nc" id="L322">            timeOffCalendarPC.setNumOfCals(12);</span>
        }
<span class="nc bnc" id="L324" title="All 4 branches missed.">        else if(INTERVAL_VIEW.equals(viewRangeMode)&amp;&amp; hasAdvancedRMLicense) {</span>
<span class="nc" id="L325">        	timeOffCalendarPC.setTimeOffAllocationType(TimeOffCalendarPC.INTERVAL_ALLOCATION_DROPDOWN_VALUE);</span>
<span class="nc" id="L326">        	timeOffCalendarPC.setShowTOPoolsToolTip(true);</span>
        }
        else {
<span class="nc" id="L329">            timeOffCalendarPC.setNumOfCals(2);</span>
<span class="nc" id="L330">            timeOffCalendarPC.setIsDetailEnabled(true);</span>
<span class="nc" id="L331">            timeOffCalendarPC.setShowAvailableHours(SHOW_PERSONAL_VIEW.equals(hoursMode));</span>
<span class="nc" id="L332">            timeOffCalendarPC.setShowTOPoolsToolTip(true);</span>
        }
<span class="nc" id="L334">    }</span>

    /**
     * Initialize Toolbar
     */
    @Override
	protected void initToolbar() {
<span class="nc" id="L341">        boolean isBtnEnabled = isDisplayEnabled();</span>

<span class="nc" id="L343">        String newRequestLabel = i18n(bundle, RmWebBundleKey.CREATE_NEW_REQUEST);</span>
<span class="nc" id="L344">        m_toolbar.addPopupWindowTextButton(RmPageAction.POPUP_TIMEOFF_REQUEST_FORM_ACTION,</span>
                newRequestLabel, isBtnEnabled);
<span class="nc" id="L346">    }</span>

    /** Return URL for HTML Form Action
     */
    @Override
	public String getFormAction() {
<span class="nc" id="L352">        return FORM_ACTION;</span>
    }

    /**
     * Create a dropdown Option
     */
    private StringsPair createDDOption(String value, String rbKey) {
<span class="nc" id="L359">        return new StringsPair(value, i18n(bundle, rbKey));</span>
    }

    /**
     * Create HTML for Drop down for View selection
     */
    private String makeViewDropDown(String viewLabel) {
<span class="nc" id="L366">        String onChangeJS = JSUtil.REFRESH_PAGE;</span>

<span class="nc" id="L368">        ArrayList options = new ArrayList();</span>
<span class="nc" id="L369">        options.add(createDDOption(YEAR_VIEW, RmWebBundleKey.VIEW_YEAR_AT_A_GLANCE));</span>
<span class="nc" id="L370">        options.add(createDDOption(TWO_MONTH_VIEW, RmWebBundleKey.VIEW_TWO_MONTHS));</span>
<span class="nc bnc" id="L371" title="All 4 branches missed.">        if(hasAdvancedRMLicense &amp;&amp;isAuthToViewInterval()) {</span>
<span class="nc" id="L372">			options.add(createDDOption(INTERVAL_VIEW, RmWebBundleKey.TIMEOFF_POOL_INTERVAL_VIEW));</span>
		}

<span class="nc" id="L375">		return HtmlUtil.makeSelectInput(VIEW_MODE_FN, null, new String[]{viewRangeMode}, </span>
			     onChangeJS, options, null, false, false, true, false, null, null, true, 
			     viewLabel, null);
    }

    /**
     * Create HTML for Drop down for Allocated/Available Hours selection
     */
    private String makeHoursDropDown(String hoursLabel) {
<span class="nc" id="L384">        String onChangeJS = JSUtil.REFRESH_PAGE;</span>

<span class="nc" id="L386">        ArrayList options = new ArrayList();</span>
<span class="nc" id="L387">        options.add(createDDOption(SHOW_TIME_OFF_POOL_VIEW, RmWebBundleKey.MY_TOPOOL_VIEW));</span>
<span class="nc" id="L388">        options.add(createDDOption(SHOW_PERSONAL_VIEW, RmWebBundleKey.PERSONAL_VIEW));</span>

<span class="nc" id="L390">		return HtmlUtil.makeSelectInput(HOURS_MODE_FN, null, new String[] {</span>
				hoursMode }, onChangeJS, options, null, false,
                false, true, false, null, null, true, hoursLabel, null);
	}
    /**
     * Create HTML for Drop down for Allocated/Available Hours selection
	 * @param activitiesLabel aria label of drop down
	 */
    private String makeActivitiesDropDown(String activitiesLabel) {
<span class="nc" id="L399">        String onChangeJS = JSUtil.REFRESH_PAGE;</span>

<span class="nc" id="L401">        List&lt;StringsPair&gt; options = new ArrayList&lt;StringsPair&gt;();</span>
<span class="nc bnc" id="L402" title="All 2 branches missed.">        for (StringsPair entry : stringPairlistTOActivities){</span>
<span class="nc" id="L403">        	 options.add(new StringsPair(entry.getKey(), entry.getValue()));</span>
<span class="nc" id="L404">        }</span>

<span class="nc" id="L406">		return HtmlUtil.makeSelectInput(TOACTIVITY_SELECTION_FN, null, new String[]{activitySelection}, onChangeJS, options, null, false, false,</span>
			true, false, null, null, true, activitiesLabel, null);

	}
    
    
    /**
     * Set activitySelection
     */
    public void setActivitySelection(String id) {
<span class="nc" id="L416">    	activitySelection = id;</span>
<span class="nc" id="L417">        m_context.setAttribute(RequestContext.SESSION_SCOPE, TOACTIVITY_SELECTION_KEY, id);</span>
        
<span class="nc" id="L419">    }</span>

    /**
     * Return activitySelection
     */
    public String getActivitySelection() {
<span class="nc" id="L425">        return activitySelection;</span>
    }

    /**
     * Set View Mode
     */
    public void setViewMode(String mode) {
<span class="nc" id="L432">        viewRangeMode = mode;</span>
<span class="nc" id="L433">        m_context.setAttribute(RequestContext.SESSION_SCOPE, VIEW_MODE_KEY, mode);</span>
<span class="nc" id="L434">    }</span>

    /**
     * Return View Mode
     */
    public String getViewMode() {
<span class="nc" id="L440">        return viewRangeMode;</span>
    }

    /**
     * Set Hours Mode
     */
    public void setHoursMode(String mode) {
<span class="nc" id="L447">        hoursMode = mode;</span>
<span class="nc" id="L448">        m_context.setAttribute(RequestContext.SESSION_SCOPE, HOURS_MODE_KEY, mode);</span>
<span class="nc" id="L449">    }</span>

    /**
     * Return Hours Mode
     */
    public String getHoursMode() {
<span class="nc" id="L455">        return hoursMode;</span>
    }

    /**
     * Return True if Employee is Valid
     */
    protected boolean isValidEmployee() {
<span class="nc bnc" id="L462" title="All 2 branches missed.">        return empID!=null;</span>
    }

    /**
     * Return true if Authorized to this Page
     */
    public boolean isAuthToView() {
<span class="nc bnc" id="L469" title="All 2 branches missed.">        return isValidEmployee() &amp;&amp;</span>
<span class="nc bnc" id="L470" title="All 2 branches missed.">        user.isAuthorized(PrivilegeKeys.TOM_VIEWPERSONALCALENDAR);</span>
    }
    /**
     * Return true if Authorized to show the option Interval view
     */
    public boolean isAuthToViewInterval() {
<span class="nc bnc" id="L476" title="All 2 branches missed.">        return isValidEmployee() &amp;&amp; </span>
<span class="nc bnc" id="L477" title="All 2 branches missed.">        user.isAuthorized(PrivilegeKeys.TOM_VIEWPERSONALINTERVALCALENDAR);</span>
    }

    /**
     * Return Html Display
     */
    @Override
	public String getHtmlDisplay() {
<span class="nc bnc" id="L485" title="All 2 branches missed.">        if (!isDisplayEnabled()) {</span>
<span class="nc" id="L486">			return &quot;&quot;;</span>
		}

<span class="nc" id="L489">        return timeOffCalendarPC.getHtmlDisplay();</span>
    }

    /**
     * Return true if Display is Enabled
     */
    private boolean isDisplayEnabled() {
<span class="nc bnc" id="L496" title="All 4 branches missed.">        return (isTOActive &amp;&amp; isAuthorizedToView);</span>
    }
    
    
    private void loadActivities(){
		try {
<span class="nc" id="L502">			ID orgID = OrganizationModelHandler.getEmployeeOrgID(m_context, empID);</span>
			
<span class="nc" id="L504">			RmManagerFactory managerFactory = RmManagerFactory.getInstance();</span>
<span class="nc" id="L505">			List&lt;Activity&gt; activityList = managerFactory.getTimeOffRequestManager().getTOActivitiesForEmp(empID, orgID, true, false);</span>
<span class="nc" id="L506">			listTOActivities = ActivityModelHandler.getActivitiesWithTOPools(m_context, activityList);</span>
			
						
<span class="nc" id="L509">		} catch (Exception ex) {</span>
<span class="nc" id="L510">			handleUnableToLoadDataError(log, ex);</span>
<span class="nc" id="L511">		}</span>
<span class="nc" id="L512">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>