<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>RequestsFilterPropPC.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.rm.requests.filter</a> &gt; <span class="el_source">RequestsFilterPropPC.java</span></div><h1>RequestsFilterPropPC.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.rm.requests.filter;

import java.io.Serializable;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Calendar;
import java.util.Collection;
import java.util.Collections;
import java.util.Date;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Map;
import java.util.Map.Entry;
import java.util.ResourceBundle;

import javax.servlet.http.HttpServletRequest;

import com.bluepumpkin.common.datatypes.CalendarRange;
import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.StringsPair;
import com.bluepumpkin.common.util.DateTimeUtil;
import com.bluepumpkin.common.util.StringUtil;
import com.bluepumpkin.ejb.bbm.activity.model.Activity;
import com.bluepumpkin.ejb.bbm.campaign.model.Campaign;
import com.bluepumpkin.ejb.bbm.skill.model.Skill;
import com.bluepumpkin.ejb.bbm.workresource.model.EmployeeName;
import com.bluepumpkin.ejb.core.filterconfig.model.Filter;
import com.bluepumpkin.ejb.rm.requests.common.model.Request;
import com.bluepumpkin.ejb.rm.requests.commonrequestmanager.model.RequestFilter;
import com.bluepumpkin.ejb.rm.requests.custshift.model.CustShiftReq;
import com.bluepumpkin.ejb.rm.requests.swap.request.model.ShiftSwapRequest;
import com.bluepumpkin.ejb.rm.setup.calendartimeoff.model.TOPool;
import com.bluepumpkin.ejb.rm.setup.timeoffbid.model.TimeOffBid;
import com.bluepumpkin.ejb.rm.util.LicenseUtil;
import com.bluepumpkin.web.bbm.l10n.BbmWebBundleKey;
import com.bluepumpkin.web.rm.l10n.RmWebBundleKey;
import com.bluepumpkin.web.rm.requests.shiftbidding.ShiftBidUtil;
import com.witness.web.uif.base.Message;
import com.witness.web.uif.l10n.UIFWebBundleKey;
import com.witness.web.uif.pagecomponent.DefaultMultiColumnNodeData;
import com.witness.web.uif.pagecomponent.MultiColumnNodeData;
import com.witness.web.uif.pagecomponent.form.FormInputPC;
import com.witness.web.uif.pagecomponent.list.MultiColListPC;
import com.witness.web.uif.pagecomponent.picker.date.DatePickerPC;
import com.witness.web.uif.pagecomponent.picker.date.DateRangePickerPC;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.util.HtmlUtil;
import com.witness.web.uif.util.js.JSUtil;

/**
 * Title: RequestsFilterPropPC Description: Encapsulate UI fro Request Filter Properties Copyright: Copyright (c) 2002 Company: Blue
 * Pumpkin Software, Inc
 *
 * @author David Su, dsu
 * @version 1.0
 *
 *          Created on October 16, 2002, 11:23 AM
 */
public class RequestsFilterPropPC extends MultiColListPC {
	/**
	 * 
	 */
	private static final long serialVersionUID = -3280961197501869103L;
	private static final String SUPERVISOR_FN = &quot;supervisor&quot;;
	private static final String STATUS_FN = &quot;status&quot;;
	private static final String SUBMITTED_DR_FN = &quot;submitted&quot;;
	private static final String SENIORITY_DR_FN = &quot;seniority&quot;;
	private static final String START_END_DR_FN = &quot;startEndDates&quot;;
	private static final String FLEX_MAKEUP_START_END_DR_FN = &quot;flexMakeupStartEndDates&quot;;

	private static final String TO_NUM_CHOICE_FN = &quot;toNumOfChoice&quot;;
	private static final String TO_POOL_FN = &quot;toPoolName&quot;;
	private static final String TO_BID_FN = &quot;toBidName&quot;;
	private static final String TO_ACTIVITIES_FN = &quot;toActivities&quot;;

	private static final String SS_TYPE_FN = &quot;ssType&quot;;
	private static final String SS_SKILLS_FN = &quot;ssSkills&quot;;

	private static final String OPERATOR_SUFFIX = &quot;Op&quot;;
	private static final String SB_AUCTION_FN = &quot;sbAuctionNames&quot;;
	private static final String SB_PREF_FN = &quot;sbPref&quot;;
	private static final String SB_REQDAY_FN = &quot;sbRD&quot;;
	private static final String SB_DEADLINE_FN = &quot;sbDl&quot;;
	private static final String SB_DEADLINE_OP_FN = SB_DEADLINE_FN + OPERATOR_SUFFIX;
	private static final String SB_RANK_FN = &quot;sbRank&quot;;
	private static final String SB_RANK_OP_FN = SB_RANK_FN + OPERATOR_SUFFIX;
	private static final String SB_POINTS_FN = &quot;sbPoints&quot;;
	private static final String SB_POINTS_OP_FN = SB_POINTS_FN + OPERATOR_SUFFIX;
	private static final String SB_BONUS_FN = &quot;sbBonus&quot;;
	private static final String SB_BONUS_OP_FN = SB_BONUS_FN + OPERATOR_SUFFIX;
	private static final String SB_SCORE_FN = &quot;sbScore&quot;;
	private static final String SB_SCORE_OP_FN = SB_SCORE_FN + OPERATOR_SUFFIX;

	private static final String CS_SUBTYPE_FN = &quot;csSubType&quot;;
	private static final String CS_CAMPAIGN_FN = &quot;csCampaign&quot;;
	private static final String CS_ACTIVITY_FN = &quot;csActivity&quot;;
	private static final String CS_SHIFT_FN = &quot;csShift&quot;;
	private static final String CS_EXTENSION_FN = &quot;csExtension&quot;;
	private static final String CS_OVERTIME_FN = &quot;csOvertime&quot;;

	private final FormInputPC m_inputPC;
	private final DatePickerPC m_datePC;
	private final DateRangePickerPC m_dateRangePC;
	private RequestFilter m_rFilter;

<span class="nc" id="L107">	private List m_reqStatusList = Collections.emptyList();</span>
<span class="nc" id="L108">	private Collection m_supervisorList = Collections.emptyList();</span>
<span class="nc" id="L109">	private Collection m_skillList = Collections.emptyList();</span>
<span class="nc" id="L110">	private Collection m_poolList = Collections.emptyList();</span>
<span class="nc" id="L111">	private Collection bidList = Collections.emptyList();</span>
<span class="nc" id="L112">	private Collection&lt;Activity&gt; timeOffActivityList = Collections.emptyList();</span>
<span class="nc" id="L113">	private Collection m_campaignList = Collections.emptyList();</span>
<span class="nc" id="L114">	private Map&lt;ID, String&gt; m_shiftIDNamesMap = new HashMap&lt;ID, String&gt;();</span>
<span class="nc" id="L115">	private Collection m_activityList = Collections.emptyList();</span>
<span class="nc" id="L116">	private Map&lt;ID, String&gt; m_extIDNamesMap = new HashMap&lt;ID, String&gt;();</span>
<span class="nc" id="L117">	private String componentTitle = &quot;&quot;;</span>
<span class="nc" id="L118">	private List&lt;StringsPair&gt; shiftBidList = Collections.emptyList();</span>

	private final StringsPair m_allOption;
	private final ResourceBundle m_bundle;

<span class="nc" id="L123">	private boolean hasAdvRMLicense = false;</span>

	/** Creates a new instance of RequestsFilterPropPC */
	public RequestsFilterPropPC(RequestContext context, DatePickerPC datePC, DateRangePickerPC drPC) {
<span class="nc" id="L127">		super(context);</span>

<span class="nc" id="L129">		m_bundle = m_localizer.getBundle(RmWebBundleKey.BUNDLE_NAME);</span>

<span class="nc" id="L131">		hasAdvRMLicense = LicenseUtil.isAdvancedRMLicense();</span>

<span class="nc" id="L133">		setEnabled(false);</span>
<span class="nc" id="L134">		setIsBorderEnabled(true);</span>

<span class="nc" id="L136">		m_datePC = datePC;</span>
<span class="nc" id="L137">		m_dateRangePC = drPC;</span>

<span class="nc" id="L139">		m_allOption = new StringsPair(&quot;&quot;, &quot;&quot;);</span>

<span class="nc" id="L141">		m_inputPC = new FormInputPC(m_context);</span>
<span class="nc" id="L142">		addChildComponent(m_inputPC);</span>
<span class="nc" id="L143">	}</span>

	/**
	 * Initialize Component
	 */
	public void init(Collection supervisorList, List reqStatusList, Collection skillList, Collection poolList, Collection bidList,
			Collection campaignList, Map&lt;ID, String&gt; shiftMap, Collection activityList, Map&lt;ID, String&gt; extensionMap,Collection&lt;Activity&gt; toActivityList,
			List&lt;StringsPair&gt; shiftBidAuctionList ) {
<span class="nc" id="L151">		m_supervisorList = supervisorList;</span>
<span class="nc" id="L152">		m_reqStatusList = reqStatusList;</span>
<span class="nc" id="L153">		m_skillList = skillList;</span>
<span class="nc" id="L154">		m_poolList = poolList;</span>
<span class="nc" id="L155">		this.bidList = bidList;</span>
<span class="nc" id="L156">		m_campaignList = campaignList;</span>
<span class="nc" id="L157">		m_shiftIDNamesMap = shiftMap;</span>
<span class="nc" id="L158">		m_activityList = activityList;</span>
<span class="nc" id="L159">		m_extIDNamesMap = extensionMap;</span>
<span class="nc" id="L160">		timeOffActivityList = toActivityList;</span>
<span class="nc" id="L161">		shiftBidList= shiftBidAuctionList;</span>
<span class="nc" id="L162">	}</span>

	/**
	 * Initialize Component for display
	 */
	@Override
	public void initForDisplay() {
<span class="nc bnc" id="L169" title="All 2 branches missed.">		if (m_isInitializedForDisplay) {</span>
<span class="nc" id="L170">			return;</span>
		} else {
<span class="nc" id="L172">			super.initForDisplay();</span>

<span class="nc" id="L174">			initHeader();</span>
<span class="nc" id="L175">			initList();</span>
		}
<span class="nc" id="L177">	}</span>

	/**
	 * Validates the Page Component
	 *
	 * NOTE: This method recurse through all sub-components
	 */
	@Override
	public boolean validate() {
<span class="nc" id="L186">		boolean success = super.validate();</span>

<span class="nc" id="L188">		ID shiftID = (ID) m_rFilter.getValueForKey(RequestFilter.CS_SHIFTID_KEY);</span>
<span class="nc" id="L189">		ID extID = (ID) m_rFilter.getValueForKey(RequestFilter.CS_EXTID_KEY);</span>
<span class="nc bnc" id="L190" title="All 8 branches missed.">		if (shiftID != null &amp;&amp; shiftID.toString().length() &gt; 0 &amp;&amp; extID != null &amp;&amp; extID.toString().length() &gt; 0) {</span>
<span class="nc" id="L191">			addPageMessage(Message.WARNING_TYPE, RmWebBundleKey.CSR_WARNING_CANNOT_SELECT_SHIFT_AND_EXT, RmWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L192">			return false;</span>
		}
<span class="nc" id="L194">		return success;</span>
	}

	/**
	 * limit the DateRange picker to +/- 30 years
	 */
	protected void limitDateRangePicker() {
<span class="nc" id="L201">		CalendarRange selectableRange = DateTimeUtil.makeTimeRangeAroundNow(Calendar.YEAR, 30, 30); // +/-30 years</span>
<span class="nc" id="L202">		m_dateRangePC.getStartDatePickerPC().setLowerLimit(selectableRange.getStartDate());</span>
<span class="nc" id="L203">		m_dateRangePC.getEndDatePickerPC().setUpperLimit(selectableRange.getEndDate());</span>
<span class="nc" id="L204">	}</span>

	/**
	 * Initialize Header
	 */
	protected void initHeader() {
<span class="nc" id="L210">		String name = i18n(m_common_bundle, UIFWebBundleKey.NAME);</span>
<span class="nc" id="L211">		String value = i18n(m_common_bundle, UIFWebBundleKey.VALUE);</span>
<span class="nc" id="L212">		getHeader().addColumnHeaderData(&quot;&quot;, name);</span>
<span class="nc" id="L213">		getHeader().addColumnHeaderData(&quot;&quot;, value);</span>
<span class="nc" id="L214">	}</span>

	/**
	 * Initialize List
	 */
	protected void initList() {
<span class="nc" id="L220">		String reqType = (String) m_rFilter.getValueForKey(RequestFilter.REQUEST_TYPE_KEY);</span>

<span class="nc" id="L222">		ArrayList listModel = new ArrayList();</span>
<span class="nc" id="L223">		addCommonProp(listModel);</span>
<span class="nc bnc" id="L224" title="All 2 branches missed.">		if (Request.REQUESTTYPE_TIMEOFF.equals(reqType)) {</span>
<span class="nc" id="L225">			addTimeOffProp(listModel);</span>
<span class="nc bnc" id="L226" title="All 2 branches missed.">		} else if (Request.REQUESTTYPE_FLEXTIME.equals(reqType)) {</span>
<span class="nc" id="L227">			addFlexTimeProp(listModel);</span>
<span class="nc bnc" id="L228" title="All 2 branches missed.">		} else if (Request.REQUESTTYPE_SHIFTSWAP.equals(reqType)) {</span>
<span class="nc" id="L229">			addShiftSwapProp(listModel);</span>
<span class="nc bnc" id="L230" title="All 2 branches missed.">		} else if (Request.REQUESTTYPE_SHIFTBID.equals(reqType)) {</span>
<span class="nc" id="L231">			addShiftBidProp(listModel);</span>
<span class="nc bnc" id="L232" title="All 2 branches missed.">		} else if (Request.REQUESTTYPE_CUSTSHIFT.equals(reqType)) {</span>
<span class="nc" id="L233">			addCustShiftProp(listModel);</span>
		}

<span class="nc" id="L236">		setListModel(listModel);</span>
<span class="nc" id="L237">	}</span>
	
	// set title(aria-label) for current component and store
	// until it is taken using getComponentTitle
	private void setComponentTitle (String title) {
<span class="nc" id="L242">		this.componentTitle = title;</span>
<span class="nc" id="L243">	}</span>
	
	// get current component title value and erase it
	// second execution will return empty string
	private String getComponentTitle() {
<span class="nc" id="L248">		String title = this.componentTitle;</span>
<span class="nc" id="L249">		this.componentTitle = &quot;&quot;;</span>
<span class="nc" id="L250">		return title;</span>
	}
	
	/**
	 * Create Common Filter Properties
	 */
	protected void addCommonProp(List listModel) {
<span class="nc" id="L257">		String label = i18n(m_common_bundle, UIFWebBundleKey.SUPERVISOR);</span>
<span class="nc" id="L258">		setComponentTitle(label);</span>
<span class="nc" id="L259">		String value = createSupervisorDD();</span>
<span class="nc" id="L260">		listModel.add(createNodeData(label, value));</span>

<span class="nc" id="L262">		label = i18n(m_common_bundle, UIFWebBundleKey.STATUS);</span>
<span class="nc" id="L263">		setComponentTitle(label);</span>
<span class="nc" id="L264">		value = createStatusDD();</span>
<span class="nc" id="L265">		listModel.add(createNodeData(label, value));</span>

<span class="nc" id="L267">		label = i18n(m_common_bundle, UIFWebBundleKey.SUBMITTED);</span>
<span class="nc" id="L268">		setComponentTitle(label);</span>
<span class="nc" id="L269">		value = createDateRange(SUBMITTED_DR_FN, RequestFilter.SUBMITTED_KEY);</span>
<span class="nc" id="L270">		listModel.add(createNodeData(label, value));</span>

<span class="nc" id="L272">		label = i18n(m_common_bundle, UIFWebBundleKey.SENIORITY);</span>
<span class="nc" id="L273">		setComponentTitle(label);</span>
<span class="nc" id="L274">		value = createDateRange(SENIORITY_DR_FN, RequestFilter.SENIORITY_KEY);</span>
<span class="nc" id="L275">		listModel.add(createNodeData(label, value));</span>
<span class="nc" id="L276">	}</span>

	/**
	 * @param listModel
	 */
	protected void addStartEndProp(List listModel) {
<span class="nc" id="L282">		String label = i18n(m_common_bundle, UIFWebBundleKey.START_END_DATES);</span>
<span class="nc" id="L283">		addStartEndProp(listModel, START_END_DR_FN, RequestFilter.REQUEST_DATE_RANGE_KEY, label);</span>
<span class="nc" id="L284">	}</span>

	/**
	 * @param listModel
	 */
	protected void addStartEndProp(List listModel, String fieldName, String key, String label) {
		String value;
<span class="nc" id="L291">		setComponentTitle(label);</span>
<span class="nc" id="L292">		value = createDateRange(fieldName, key);</span>
<span class="nc" id="L293">		listModel.add(createNodeData(label, value));</span>
<span class="nc" id="L294">	}</span>

	/**
	 * Create Time Off Specific Properties
	 */
	protected void addTimeOffProp(List listModel) {
<span class="nc" id="L300">		addStartEndProp(listModel);</span>

<span class="nc bnc" id="L302" title="All 2 branches missed.">		if (hasAdvRMLicense) {</span>
<span class="nc" id="L303">			String label = i18n(m_bundle, RmWebBundleKey.RM_TIMEOFF_BID);</span>
<span class="nc" id="L304">			setComponentTitle(label);</span>
<span class="nc" id="L305">			String value = createTimeOffBidDD();</span>
<span class="nc" id="L306">			listModel.add(createNodeData(label, value));</span>
		}

<span class="nc" id="L309">		String label = i18n(m_common_bundle, UIFWebBundleKey.NUMBER_OF_CHOICES);</span>
<span class="nc" id="L310">		setComponentTitle(label);</span>
<span class="nc" id="L311">		String value = createTimeOffChoiceDD();</span>
<span class="nc" id="L312">		listModel.add(createNodeData(label, value));</span>

<span class="nc" id="L314">		label = i18n(m_bundle, RmWebBundleKey.TIME_OFF_POOL);</span>
<span class="nc" id="L315">		setComponentTitle(label);</span>
<span class="nc" id="L316">		value = createPoolDD();</span>
<span class="nc" id="L317">		listModel.add(createNodeData(label, value));</span>
		
<span class="nc" id="L319">		label = i18n(m_bundle, RmWebBundleKey.TIMEOFF_TYPE_LABEL);</span>
<span class="nc" id="L320">		value = createTimeOffActivitiesDD();</span>
<span class="nc" id="L321">		listModel.add(createNodeData(label, value));</span>
<span class="nc" id="L322">	}</span>

	/**
	 * Create Flex Time Specific Properties
	 */
	protected void addFlexTimeProp(List listModel) {
<span class="nc" id="L328">		String label = i18n(m_bundle, RmWebBundleKey.TIMEOFF_START_END_DATES);</span>
<span class="nc" id="L329">		addStartEndProp(listModel, START_END_DR_FN, RequestFilter.REQUEST_DATE_RANGE_KEY, label);</span>

<span class="nc" id="L331">		label = i18n(m_bundle, RmWebBundleKey.FLEX_MAKEUP_START_END_DATES);</span>
<span class="nc" id="L332">		addStartEndProp(listModel, FLEX_MAKEUP_START_END_DR_FN, RequestFilter.REQUEST_FLEX_MAKEUP_DATE_RANGE_KEY, label);</span>

		// Activity
<span class="nc" id="L335">		label = i18n(m_bundle, RmWebBundleKey.RM_SA_FILTER_MAKEUP_ACTIVITY);</span>
<span class="nc" id="L336">		setComponentTitle(label);</span>
<span class="nc" id="L337">		String value = createActivityDD();</span>
<span class="nc" id="L338">		listModel.add(createNodeData(label, value));</span>
<span class="nc" id="L339">	}</span>

	/**
	 * Create Shift Swap Specific Properties
	 */
	protected void addShiftSwapProp(List listModel) {
<span class="nc" id="L345">		addStartEndProp(listModel);</span>

<span class="nc" id="L347">		String label = i18n(m_common_bundle, UIFWebBundleKey.TYPE);</span>
<span class="nc" id="L348">		setComponentTitle(label);</span>
<span class="nc" id="L349">		String value = createShiftSwapTypeDD();</span>
<span class="nc" id="L350">		listModel.add(createNodeData(label, value));</span>

<span class="nc" id="L352">		ResourceBundle m_bbm_bundle = m_localizer.getBundle(BbmWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L353">		label = i18n(m_bbm_bundle, BbmWebBundleKey.BBM_PEOPLE_SKILLS);</span>
<span class="nc" id="L354">		setComponentTitle(label);</span>
<span class="nc" id="L355">		value = createShiftSwapSkillDD();</span>
<span class="nc" id="L356">		listModel.add(createNodeData(label, value));</span>
<span class="nc" id="L357">	}</span>

	/**
	 * Create Shift Swap Specific Properties
	 */
	protected void addShiftBidProp(List listModel) {
		// Auction Name
<span class="nc" id="L364">		String label = i18n(m_bundle, RmWebBundleKey.RM_SA_AUCTION_NAME);	</span>
<span class="nc" id="L365">		String value = createShiftBidAuctionDD();</span>
<span class="nc" id="L366">		listModel.add(createNodeData(label, value));</span>
<span class="nc" id="L367">		addStartEndProp(listModel);</span>
		// preference
<span class="nc" id="L369">		Integer prefValue = (Integer) m_rFilter.getValueForKey(RequestFilter.BID_PREF_KEY);</span>
<span class="nc bnc" id="L370" title="All 2 branches missed.">		String sPrefValue = prefValue != null ? prefValue.toString() : null;</span>
<span class="nc" id="L371">		label = i18n(m_common_bundle, UIFWebBundleKey.PREFERENCE);</span>
<span class="nc" id="L372">		value = ShiftBidUtil.createBidPrefDDForFilter(SB_PREF_FN, sPrefValue, m_allOption, m_localizer);</span>
<span class="nc" id="L373">		listModel.add(createNodeData(label, value));</span>

		// day
<span class="nc" id="L376">		label = i18n(m_common_bundle, UIFWebBundleKey.DAY);</span>
<span class="nc" id="L377">		Integer dayValue = (Integer) m_rFilter.getValueForKey(RequestFilter.BID_REQUESTED_DAY_KEY);</span>
<span class="nc bnc" id="L378" title="All 2 branches missed.">		int iDayValue = dayValue != null ? dayValue.intValue() : -1;</span>
<span class="nc" id="L379">		value = HtmlUtil.getDayOfWeekDropDown(SB_REQDAY_FN, iDayValue, JSUtil.ON_CHANGE, true, m_localizer, label);</span>
<span class="nc" id="L380">		listModel.add(createNodeData(label, value));</span>

		// deadline
<span class="nc" id="L383">		ArrayList opOptionsForDealine = new ArrayList(3);</span>
<span class="nc" id="L384">		opOptionsForDealine.add(new StringsPair(Filter.LESS_THAN_OPERATION, i18n(m_common_bundle, UIFWebBundleKey.BEFORE)));</span>
<span class="nc" id="L385">		opOptionsForDealine.add(new StringsPair(Filter.EQUAL_OPERATION, i18n(m_common_bundle, UIFWebBundleKey.EQUAL_TO)));</span>
<span class="nc" id="L386">		opOptionsForDealine.add(new StringsPair(Filter.GREATER_THAN_OPERATION, i18n(m_common_bundle, UIFWebBundleKey.AFTER)));</span>
<span class="nc" id="L387">		label = i18n(m_common_bundle, UIFWebBundleKey.DEADLINE);</span>
<span class="nc" id="L388">		Date deadlineValue = (Date) m_rFilter.getValueForKey(RequestFilter.BID_DEADLINE_KEY);</span>
<span class="nc" id="L389">		String sOperator = (String) m_rFilter.getValueForKey(RequestFilter.BID_DEADLINE_OPERATOR_KEY);</span>
<span class="nc" id="L390">		initDate(SB_DEADLINE_FN);</span>
<span class="nc" id="L391">		m_datePC.setDate(deadlineValue);</span>
<span class="nc" id="L392">		m_datePC.setAriaLabel(label);</span>
<span class="nc" id="L393">		value = HtmlUtil.makeSelectInput(SB_DEADLINE_OP_FN, sOperator, JSUtil.ON_CHANGE, opOptionsForDealine, false, label) + &quot; &quot;</span>
<span class="nc" id="L394">				+ m_datePC.getHtmlDisplay();</span>
<span class="nc" id="L395">		listModel.add(createNodeData(label, value));</span>

<span class="nc" id="L397">		ArrayList opOptionsForNum = new ArrayList(3);</span>
<span class="nc" id="L398">		opOptionsForNum.add(new StringsPair(Filter.LESS_THAN_OPERATION, i18n(m_common_bundle, UIFWebBundleKey.LESS_THAN)));</span>
<span class="nc" id="L399">		opOptionsForNum.add(new StringsPair(Filter.EQUAL_OPERATION, i18n(m_common_bundle, UIFWebBundleKey.EQUAL_TO)));</span>
<span class="nc" id="L400">		opOptionsForNum.add(new StringsPair(Filter.GREATER_THAN_OPERATION, i18n(m_common_bundle, UIFWebBundleKey.MORE_THAN)));</span>

		// Rank
<span class="nc" id="L403">		addNumWithOperatorInput(SB_RANK_FN, SB_RANK_OP_FN, UIFWebBundleKey.RANK, RequestFilter.EMP_RANK_KEY,</span>
				RequestFilter.EMP_RANK_OPERATOR_KEY, opOptionsForNum, listModel);

		// Points
<span class="nc" id="L407">		addNumWithOperatorInput(SB_POINTS_FN, SB_POINTS_OP_FN, UIFWebBundleKey.POINTS, RequestFilter.BID_POINTS_KEY,</span>
				RequestFilter.BID_POINTS_OPERATOR_KEY, opOptionsForNum, listModel);

		// Bonus
<span class="nc" id="L411">		addNumWithOperatorInput(SB_BONUS_FN, SB_BONUS_OP_FN, UIFWebBundleKey.BONUS, RequestFilter.BID_BONUS_KEY,</span>
				RequestFilter.BID_BONUS_OPERATOR_KEY, opOptionsForNum, listModel);

		// Score
<span class="nc" id="L415">		addNumWithOperatorInput(SB_SCORE_FN, SB_SCORE_OP_FN, UIFWebBundleKey.SCORE, RequestFilter.BID_SCORE_KEY,</span>
				RequestFilter.BID_SCORE_OPERATOR_KEY, opOptionsForNum, listModel);

<span class="nc" id="L418">	}</span>

	/**
	 * Create Custom Shift Specific Properties The Custom Requests will be filtered on the following columns &gt; Request sub type (new
	 * shift /shift change) &gt; Campaign ID (Name) &gt; Activity ID (Name) in main shift or extensions &gt; Shift ID(Name ) OR &gt; Extn
	 * ID(Name) (You can either filter by shift name or extn name but not by both) //Extn Name applicable to both before and after
	 * extn &gt; Overtime (Yes/No) (will filter for either shift or extn)
	 */
	protected void addCustShiftProp(List listModel) {
<span class="nc" id="L427">		addStartEndProp(listModel);</span>

		// Sub Type (New Shift/Shift Change)
<span class="nc" id="L430">		String label = i18n(m_common_bundle, UIFWebBundleKey.TYPE);</span>
<span class="nc" id="L431">		setComponentTitle(label);</span>
<span class="nc" id="L432">		String value = createCustShiftTypeDD();</span>
<span class="nc" id="L433">		listModel.add(createNodeData(label, value));</span>

		// Campaign
<span class="nc" id="L436">		label = i18n(m_bundle, RmWebBundleKey.CAMPAIGN);</span>
<span class="nc" id="L437">		setComponentTitle(label);</span>
<span class="nc" id="L438">		value = createCampaignDD();</span>
<span class="nc" id="L439">		listModel.add(createNodeData(label, value));</span>

		// Shift
<span class="nc" id="L442">		label = i18n(m_bundle, RmWebBundleKey.RM_SA_FILTER_SHIFT);</span>
<span class="nc" id="L443">		setComponentTitle(label);</span>
<span class="nc" id="L444">		value = createShiftDD();</span>
<span class="nc" id="L445">		listModel.add(createNodeData(label, value));</span>

		// Activity
<span class="nc" id="L448">		label = i18n(m_bundle, RmWebBundleKey.RM_SA_FILTER_ACTIVITY);</span>
<span class="nc" id="L449">		setComponentTitle(label);</span>
<span class="nc" id="L450">		value = createActivityDD();</span>
<span class="nc" id="L451">		listModel.add(createNodeData(label, value));</span>

		// Extension
<span class="nc" id="L454">		label = i18n(m_bundle, RmWebBundleKey.CSR_EXTENSION_BEFORE_OR_AFTER_SHIFT);</span>
<span class="nc" id="L455">		setComponentTitle(label);</span>
<span class="nc" id="L456">		value = createExtensionDD();</span>
<span class="nc" id="L457">		listModel.add(createNodeData(label, value));</span>

		// OT (Yes/No)
<span class="nc" id="L460">		label = i18n(m_bundle, RmWebBundleKey.ORG_RM_FILING_RULE_OVERTIME);</span>
<span class="nc" id="L461">		setComponentTitle(label);</span>
<span class="nc" id="L462">		value = createOvertimeDD();</span>
<span class="nc" id="L463">		listModel.add(createNodeData(label, value));</span>
<span class="nc" id="L464">	}</span>

	private void addNumWithOperatorInput(String fn, String opFn, String rbKey, String reqKey, String reqOpKey, List opOptions,
			List listModel) {
<span class="nc" id="L468">		String label = i18n(m_common_bundle, rbKey);</span>
<span class="nc" id="L469">		Integer reqVal = (Integer) m_rFilter.getValueForKey(reqKey);</span>
<span class="nc" id="L470">		String sOperator = (String) m_rFilter.getValueForKey(reqOpKey);</span>

<span class="nc" id="L472">		m_inputPC.reset();</span>
<span class="nc" id="L473">		m_inputPC.setInputFN(fn);</span>
<span class="nc" id="L474">		m_inputPC.setInputFieldDesc(label);</span>
<span class="nc" id="L475">		m_inputPC.setInputType(FormInputPC.TYPE_INTEGER);</span>
<span class="nc" id="L476">		m_inputPC.setLowerLimit(0, true);</span>
<span class="nc" id="L477">		m_inputPC.setAriaLabel(label);</span>
<span class="nc bnc" id="L478" title="All 2 branches missed.">		if (reqVal != null){</span>
<span class="nc" id="L479">			m_inputPC.setInputValue(reqVal.toString());</span>
		}

<span class="nc" id="L482">		String value = HtmlUtil.makeSelectInput(opFn, sOperator, JSUtil.ON_CHANGE, opOptions, false, label) + &quot; &quot; + m_inputPC.getHtmlDisplay();</span>
<span class="nc" id="L483">		listModel.add(createNodeData(label, value));</span>
<span class="nc" id="L484">	}</span>

	/**
	 * Set Request Filter
	 */
	public void setRequestFilter(RequestFilter rFilter) {
<span class="nc" id="L490">		m_rFilter = rFilter;</span>
<span class="nc" id="L491">	}</span>

	/**
	 * Extract Parameter
	 */
	@Override
	public boolean extractParameters(HttpServletRequest request) {
<span class="nc" id="L498">		boolean success = super.extractParameters(request);</span>

<span class="nc" id="L500">		extractValue(request, STATUS_FN, RequestFilter.STATUS_KEY);</span>
<span class="nc" id="L501">		extractDateRange(request, SUBMITTED_DR_FN, RequestFilter.SUBMITTED_KEY);</span>
<span class="nc" id="L502">		extractDateRange(request, SENIORITY_DR_FN, RequestFilter.SENIORITY_KEY);</span>
<span class="nc" id="L503">		extractDateRange(request, START_END_DR_FN, RequestFilter.REQUEST_DATE_RANGE_KEY);</span>
<span class="nc" id="L504">		extractDateRange(request, FLEX_MAKEUP_START_END_DR_FN, RequestFilter.REQUEST_FLEX_MAKEUP_DATE_RANGE_KEY);</span>

<span class="nc" id="L506">		extractValue(request, TO_NUM_CHOICE_FN, RequestFilter.TO_NUMBER_OF_CHOICES_KEY);</span>
<span class="nc" id="L507">		extractID(request, TO_BID_FN, RequestFilter.TOBID_KEY);</span>
<span class="nc" id="L508">		extractIDs(request, TO_ACTIVITIES_FN, RequestFilter.TO_ACTIVITIES_KEY);</span>
		// extractValue(request, TO_POOL_FN, RequestFilter.TOPOOL_KEY);

<span class="nc" id="L511">		extractValue(request, SS_TYPE_FN, RequestFilter.SWAP_TYPE_KEY);</span>
<span class="nc" id="L512">		extractIDs(request, SS_SKILLS_FN, RequestFilter.SWAP_SKILLS_KEY);</span>
<span class="nc" id="L513">		extractIDs(request, SB_AUCTION_FN, RequestFilter.BID_AUCTIONS_KEY);</span>
<span class="nc" id="L514">		extractInteger(request, SB_PREF_FN, RequestFilter.BID_PREF_KEY);</span>
<span class="nc" id="L515">		extractInteger(request, SB_REQDAY_FN, RequestFilter.BID_REQUESTED_DAY_KEY);</span>
<span class="nc" id="L516">		Date date = extractDate(request, SB_DEADLINE_FN, RequestFilter.BID_DEADLINE_KEY);</span>
<span class="nc bnc" id="L517" title="All 2 branches missed.">		if (date != null) {</span>
<span class="nc" id="L518">			extractString(request, SB_DEADLINE_OP_FN, RequestFilter.BID_DEADLINE_OPERATOR_KEY);</span>
		}
<span class="nc" id="L520">		extractNumWithOperator(request, SB_RANK_FN, SB_RANK_OP_FN, RequestFilter.EMP_RANK_KEY, RequestFilter.EMP_RANK_OPERATOR_KEY);</span>
<span class="nc" id="L521">		extractNumWithOperator(request, SB_POINTS_FN, SB_POINTS_OP_FN, RequestFilter.BID_POINTS_KEY,</span>
				RequestFilter.BID_POINTS_OPERATOR_KEY);
<span class="nc" id="L523">		extractNumWithOperator(request, SB_BONUS_FN, SB_BONUS_OP_FN, RequestFilter.BID_BONUS_KEY,</span>
				RequestFilter.BID_BONUS_OPERATOR_KEY);
<span class="nc" id="L525">		extractNumWithOperator(request, SB_SCORE_FN, SB_SCORE_OP_FN, RequestFilter.BID_SCORE_KEY,</span>
				RequestFilter.BID_SCORE_OPERATOR_KEY);

<span class="nc" id="L528">		return success;</span>
	}

	/**
	 * Extract Value to Request Filter
	 */
	protected void extractValue(HttpServletRequest request, String fn, String key) {
<span class="nc" id="L535">		String value = request.getParameter(fn);</span>
<span class="nc bnc" id="L536" title="All 2 branches missed.">		if (!StringUtil.isEmpty(value)) {</span>
<span class="nc" id="L537">			m_rFilter.setKey(key, value);</span>
		}
<span class="nc" id="L539">	}</span>

	/**
	 * Extract Integer Value to Request Filter
	 */
	protected Integer extractInteger(HttpServletRequest request, String fn, String key) {
<span class="nc" id="L545">		Integer result = null;</span>
<span class="nc" id="L546">		String value = request.getParameter(fn);</span>
<span class="nc bnc" id="L547" title="All 2 branches missed.">		if (!StringUtil.isEmpty(value)) {</span>
<span class="nc" id="L548">			result = new Integer(value);</span>
<span class="nc" id="L549">			m_rFilter.setKey(key, result);</span>
		}

<span class="nc" id="L552">		return result;</span>
	}

	protected void extractNumWithOperator(HttpServletRequest request, String fn, String opFn, String key, String opKey) {
<span class="nc" id="L556">		Integer num = extractInteger(request, fn, key);</span>
<span class="nc bnc" id="L557" title="All 2 branches missed.">		if (num != null) {</span>
<span class="nc" id="L558">			extractString(request, opFn, opKey);</span>
		}
<span class="nc" id="L560">	}</span>

	protected void extractID(HttpServletRequest request, String fn, String key) {
<span class="nc" id="L563">		ID result = null;</span>
<span class="nc" id="L564">		String value = request.getParameter(fn);</span>
<span class="nc bnc" id="L565" title="All 2 branches missed.">		if (!StringUtil.isEmpty(value)) {</span>
<span class="nc" id="L566">			result = new ID(value);</span>
<span class="nc" id="L567">			m_rFilter.setKey(key, result);</span>
		}
<span class="nc" id="L569">	}</span>

	/**
	 * Extract Value to Request Filter
	 */
	protected void extractIDs(HttpServletRequest request, String fn, String key) {
<span class="nc" id="L575">		String[] value = request.getParameterValues(fn);</span>
<span class="nc bnc" id="L576" title="All 4 branches missed.">		if (value != null &amp;&amp; value.length &gt; 0) {</span>
<span class="nc" id="L577">			int size = value.length;</span>
<span class="nc" id="L578">			ArrayList ids = new ArrayList(size);</span>
<span class="nc bnc" id="L579" title="All 2 branches missed.">			for (int i = 0; i &lt; size; i++) {</span>
<span class="nc" id="L580">				String val = value[i];</span>
<span class="nc bnc" id="L581" title="All 2 branches missed.">				if (StringUtil.isEmpty(val)) {</span>
<span class="nc" id="L582">					continue;</span>
				}
<span class="nc" id="L584">				ids.add(new ID(val));</span>
			}
<span class="nc bnc" id="L586" title="All 2 branches missed.">			if (!ids.isEmpty()) {</span>
<span class="nc" id="L587">				m_rFilter.setKey(key, ids);</span>
			}
		}
<span class="nc" id="L590">	}</span>

	// ////////////////////////////////////////////////////////////////////////////
	// The following are just helper methods
	// ////////////////////////////////////////////////////////////////////////////
	/**
	 * Create Node Data
	 */
	protected MultiColumnNodeData createNodeData(String label, String value) {
<span class="nc" id="L599">		DefaultMultiColumnNodeData nodeData = new DefaultMultiColumnNodeData();</span>
<span class="nc" id="L600">		nodeData.add(label);</span>
<span class="nc" id="L601">		nodeData.add(value);</span>
<span class="nc" id="L602">		return nodeData;</span>
	}

	/**
	 * Create Drop Down for the specified Key and Options
	 */
	protected String createDD(String fn, String key, List options) {
<span class="nc" id="L609">		String selectedValue = (String) m_rFilter.getValueForKey(key);</span>
<span class="nc" id="L610">		return HtmlUtil.makeSelectInput(fn, selectedValue, JSUtil.ON_CHANGE, options, false, getComponentTitle());</span>
	}

	/**
	 * Set Supervisor ID
	 */
	public void setSupervisor(ID id) {
<span class="nc bnc" id="L617" title="All 2 branches missed.">		if (id != null) {</span>
<span class="nc" id="L618">			ArrayList&lt;ID&gt; ids = new ArrayList&lt;ID&gt;(1);</span>
<span class="nc" id="L619">			ids.add(id);</span>
<span class="nc" id="L620">			m_rFilter.setKey(RequestFilter.SUPERVISOR_KEY, ids);</span>
		}
<span class="nc" id="L622">	}</span>


	/**
	 * Set Time Off Pool ID
	 */
	public void setTopool(ID id) {
<span class="nc bnc" id="L629" title="All 2 branches missed.">		if (id != null) {</span>
<span class="nc" id="L630">			m_rFilter.setKey(RequestFilter.TOPOOL_KEY, id);</span>
		}
<span class="nc" id="L632">	}</span>

	/**
	 * Set Time Off Pool ID
	 */
	public void setTopool(String id) {
<span class="nc bnc" id="L638" title="All 2 branches missed.">		if (id != null) {</span>
<span class="nc" id="L639">			m_rFilter.setKey(RequestFilter.TOPOOL_KEY, new ID(id));</span>
		}
<span class="nc" id="L641">	}</span>

	/**
	 * Set Time Off Pool ID
	 */
	public void setToPoolName(String id) {
<span class="nc bnc" id="L647" title="All 2 branches missed.">		if (!StringUtil.isEmptyOrWhiteSpace(id)) {</span>
<span class="nc" id="L648">			m_rFilter.setKey(RequestFilter.TOPOOL_KEY, new ID(id));</span>
		}
<span class="nc" id="L650">	}</span>

	/**
	 * Sets the Time Off Bid value in the Request Filter.
	 *
	 * @param id ID of the selected filter.
	 */
	public void setToBid(ID id) {
<span class="nc bnc" id="L658" title="All 2 branches missed.">		if (id != null) {</span>
<span class="nc" id="L659">			m_rFilter.setKey(RequestFilter.TOBID_KEY, id);</span>
		}
<span class="nc" id="L661">	}</span>

	/**
	 * Sets the Time Off Bid value in the Request Filter.
	 *
	 * @param id ID of the selected filter.
	 */
	public void setToBid(String id) {
<span class="nc bnc" id="L669" title="All 2 branches missed.">		if (id != null) {</span>
<span class="nc" id="L670">			m_rFilter.setKey(RequestFilter.TOBID_KEY, new ID(id));</span>
		}
<span class="nc" id="L672">	}</span>

	/**
	 * Sets the Time Off Bid value in the Request Filter.
	 *
	 * @param id ID of the selected filter.
	 */
	public void setToBidName(String id) {
<span class="nc bnc" id="L680" title="All 2 branches missed.">		if (!StringUtil.isEmptyOrWhiteSpace(id)) {</span>
<span class="nc" id="L681">			m_rFilter.setKey(RequestFilter.TOBID_KEY, new ID(id));</span>
		}
<span class="nc" id="L683">	}</span>

	public void setCsSubType(String str) {
<span class="nc bnc" id="L686" title="All 2 branches missed.">		if (!StringUtil.isEmptyOrWhiteSpace(str)) {</span>
<span class="nc" id="L687">			m_rFilter.setKey(RequestFilter.CS_SUBTYPE_KEY, str);</span>
		}
<span class="nc" id="L689">	}</span>

	public void setCsCampaign(String id) {
<span class="nc bnc" id="L692" title="All 2 branches missed.">		if (!StringUtil.isEmptyOrWhiteSpace(id)) {</span>
<span class="nc" id="L693">			m_rFilter.setKey(RequestFilter.CS_CAMPAIGNID_KEY, new ID(id));</span>
		}
<span class="nc" id="L695">	}</span>

	public void setCsActivity(String id) {
<span class="nc bnc" id="L698" title="All 2 branches missed.">		if (!StringUtil.isEmptyOrWhiteSpace(id)) {</span>
<span class="nc" id="L699">			m_rFilter.setKey(RequestFilter.CS_ACTIVITYID_KEY, new ID(id));</span>
		}
<span class="nc" id="L701">	}</span>

	public void setCsShift(String id) {
<span class="nc bnc" id="L704" title="All 2 branches missed.">		if (!StringUtil.isEmptyOrWhiteSpace(id)) {</span>
<span class="nc" id="L705">			m_rFilter.setKey(RequestFilter.CS_SHIFTID_KEY, new ID(id));</span>
		}
<span class="nc" id="L707">	}</span>

	public void setCsExtension(String id) {
<span class="nc bnc" id="L710" title="All 2 branches missed.">		if (!StringUtil.isEmptyOrWhiteSpace(id)) {</span>
<span class="nc" id="L711">			m_rFilter.setKey(RequestFilter.CS_EXTID_KEY, new ID(id));</span>
		}
<span class="nc" id="L713">	}</span>

	public void setCsOvertime(String str) {
<span class="nc bnc" id="L716" title="All 2 branches missed.">		if (!StringUtil.isEmptyOrWhiteSpace(str)) {</span>
<span class="nc" id="L717">			m_rFilter.setKey(RequestFilter.CS_ISOT_KEY, str);</span>
		}
<span class="nc" id="L719">	}</span>

	/**
	 * Create Supervisor Drop Down
	 */
	@SuppressWarnings(&quot;unchecked&quot;)
	public String createSupervisorDD() {
<span class="nc" id="L726">		List&lt;ID&gt; supervisorIDs = (List&lt;ID&gt;) m_rFilter.getValueForKey(RequestFilter.SUPERVISOR_KEY);</span>
<span class="nc bnc" id="L727" title="All 2 branches missed.">		String selectedValue = supervisorIDs != null ? supervisorIDs.get(0).toString() : &quot;&quot;;</span>

<span class="nc" id="L729">		ArrayList&lt;StringsPair&gt; orderedNames = new ArrayList&lt;StringsPair&gt;();</span>
<span class="nc bnc" id="L730" title="All 2 branches missed.">		for (Iterator it1 = m_supervisorList.iterator(); it1.hasNext();) {</span>
<span class="nc" id="L731">			EmployeeName eName = (EmployeeName) it1.next();</span>
<span class="nc" id="L732">			String label = m_localizer.formatName(eName);</span>
<span class="nc" id="L733">			String value = eName.getID().toString();</span>
<span class="nc" id="L734">			orderedNames.add(new StringsPair(value, label));</span>
<span class="nc" id="L735">		}</span>
		// sort supervisor names ASC
<span class="nc" id="L737">		Collections.sort(orderedNames);</span>

<span class="nc" id="L739">		List&lt;StringsPair&gt; options = new ArrayList&lt;StringsPair&gt;();</span>
<span class="nc bnc" id="L740" title="All 2 branches missed.">		for (Iterator&lt;StringsPair&gt; it2 = orderedNames.iterator(); it2.hasNext();) {</span>
<span class="nc" id="L741">			StringsPair option = it2.next();</span>
<span class="nc" id="L742">			options.add(option);</span>
<span class="nc" id="L743">		}</span>

<span class="nc" id="L745">		insertAllToOptions(options);</span>
<span class="nc" id="L746">		return HtmlUtil.makeSelectInput(SUPERVISOR_FN, selectedValue, JSUtil.ON_CHANGE, options, false, getComponentTitle());</span>
	}

	/**
	 * Create Time Off Pool Drop Down
	 */
	public String createPoolDD() {
<span class="nc" id="L753">		ID poolID = (ID) m_rFilter.getValueForKey(RequestFilter.TOPOOL_KEY);</span>
<span class="nc bnc" id="L754" title="All 2 branches missed.">		String selectedValue = poolID != null ? poolID.toString() : &quot;&quot;;</span>

<span class="nc" id="L756">		ArrayList orderedNames = new ArrayList();</span>
<span class="nc bnc" id="L757" title="All 2 branches missed.">		for (Iterator it1 = m_poolList.iterator(); it1.hasNext();) {</span>
<span class="nc" id="L758">			TOPool pool = (TOPool) it1.next();</span>
<span class="nc" id="L759">			String label = pool.getName();</span>
<span class="nc" id="L760">			String value = pool.getID().toString();</span>
<span class="nc" id="L761">			orderedNames.add(new StringsPair(value, label));</span>
<span class="nc" id="L762">		}</span>
		// sort pool names ASC
<span class="nc" id="L764">		Collections.sort(orderedNames);</span>

<span class="nc" id="L766">		List options = new ArrayList();</span>
<span class="nc bnc" id="L767" title="All 2 branches missed.">		for (Iterator it2 = orderedNames.iterator(); it2.hasNext();) {</span>
<span class="nc" id="L768">			StringsPair option = (StringsPair) it2.next();</span>
<span class="nc" id="L769">			options.add(option);</span>
<span class="nc" id="L770">		}</span>

<span class="nc" id="L772">		insertAllToOptions(options);</span>
<span class="nc" id="L773">		return HtmlUtil.makeSelectInput(TO_POOL_FN, selectedValue, JSUtil.ON_CHANGE, options, false, getComponentTitle());</span>
	}

	/**
	 * Creates Time Off Bid Drop Down
	 *
	 * @return HTML create display the drop down
	 */
	public String createTimeOffBidDD() {
<span class="nc" id="L782">		ID bidID = (ID) m_rFilter.getValueForKey(RequestFilter.TOBID_KEY);</span>
<span class="nc bnc" id="L783" title="All 2 branches missed.">		String selectedValue = bidID != null ? bidID.toString() : &quot;&quot;;</span>

<span class="nc" id="L785">		List&lt;StringsPair&gt; orderedNames = new ArrayList&lt;StringsPair&gt;();</span>
<span class="nc bnc" id="L786" title="All 2 branches missed.">		for (Iterator it1 = bidList.iterator(); it1.hasNext();) {</span>
<span class="nc" id="L787">			TimeOffBid bid = (TimeOffBid) it1.next();</span>
<span class="nc" id="L788">			String label = bid.getName();</span>
<span class="nc" id="L789">			String value = bid.getID().toString();</span>
<span class="nc" id="L790">			orderedNames.add(new StringsPair(value, label));</span>
<span class="nc" id="L791">		}</span>

		// sort pool names ASC
<span class="nc" id="L794">		Collections.sort(orderedNames);</span>

<span class="nc" id="L796">		List&lt;StringsPair&gt; options = new ArrayList&lt;StringsPair&gt;();</span>
<span class="nc bnc" id="L797" title="All 2 branches missed.">		for (Iterator&lt;StringsPair&gt; it2 = orderedNames.iterator(); it2.hasNext();) {</span>
<span class="nc" id="L798">			StringsPair option = it2.next();</span>
<span class="nc" id="L799">			options.add(option);</span>
<span class="nc" id="L800">		}</span>

<span class="nc" id="L802">		insertAllToOptions(options);</span>
<span class="nc" id="L803">		return HtmlUtil.makeSelectInput(TO_BID_FN, selectedValue, JSUtil.ON_CHANGE, options, false, getComponentTitle());</span>
	}
	/**
	 * Set Time Off Types(Activities) IDs
	 */
	public void setToActivities(ID[] ids) {
<span class="nc bnc" id="L809" title="All 2 branches missed.">		if (ids != null) {</span>
<span class="nc" id="L810">			List idList = Arrays.asList(ids);</span>
<span class="nc" id="L811">			m_rFilter.setKey(RequestFilter.TO_ACTIVITIES_KEY, (Serializable) idList);</span>
		}
<span class="nc" id="L813">	}</span>
	/**
	 * Create Time Off Types(Activities) Drop Down
	 */
	public String createTimeOffActivitiesDD() {
<span class="nc" id="L818">		Collection toActivityIds = (Collection) m_rFilter.getValueForKey(RequestFilter.TO_ACTIVITIES_KEY);</span>
<span class="nc" id="L819">		String[] selectedValue = StringUtil.createStringArrayFromIDs(toActivityIds);</span>

<span class="nc" id="L821">		List&lt;StringsPair&gt; options = new ArrayList&lt;StringsPair&gt;();</span>
<span class="nc bnc" id="L822" title="All 2 branches missed.">		for (Iterator it = timeOffActivityList.iterator(); it.hasNext();) {</span>
<span class="nc" id="L823">			Activity activity = (Activity) it.next();</span>

<span class="nc" id="L825">			String label = activity.getName();</span>
<span class="nc" id="L826">			String value = activity.getID().toString();</span>
<span class="nc" id="L827">			options.add(new StringsPair(value, label));</span>
<span class="nc" id="L828">		}</span>

<span class="nc" id="L830">		boolean isMultiple = true;</span>
<span class="nc" id="L831">		insertAllToOptions(options);</span>
<span class="nc" id="L832">		return HtmlUtil.makeSelectInput(TO_ACTIVITIES_FN, selectedValue, JSUtil.ON_CHANGE, options, isMultiple, true);</span>
	}
	/**
	 * Create Campaign Drop Down for the Custom Shift request filter
	 */
	public String createCampaignDD() {
<span class="nc" id="L838">		ID id = (ID) m_rFilter.getValueForKey(RequestFilter.CS_CAMPAIGNID_KEY);</span>
<span class="nc bnc" id="L839" title="All 2 branches missed.">		String selectedValue = id != null ? id.toString() : &quot;&quot;;</span>

<span class="nc" id="L841">		ArrayList orderedNames = new ArrayList();</span>
<span class="nc bnc" id="L842" title="All 2 branches missed.">		for (Iterator it = m_campaignList.iterator(); it.hasNext();) {</span>
<span class="nc" id="L843">			Campaign item = (Campaign) it.next();</span>
<span class="nc" id="L844">			String label = item.getName();</span>
<span class="nc" id="L845">			String value = item.getID().toString();</span>
<span class="nc" id="L846">			orderedNames.add(new StringsPair(value, label));</span>
<span class="nc" id="L847">		}</span>
		// sort shift names ASC
<span class="nc" id="L849">		Collections.sort(orderedNames);</span>

<span class="nc" id="L851">		List options = new ArrayList();</span>
<span class="nc bnc" id="L852" title="All 2 branches missed.">		for (Iterator it = orderedNames.iterator(); it.hasNext();) {</span>
<span class="nc" id="L853">			StringsPair option = (StringsPair) it.next();</span>
<span class="nc" id="L854">			options.add(option);</span>
<span class="nc" id="L855">		}</span>

<span class="nc" id="L857">		insertAllToOptions(options);</span>
<span class="nc" id="L858">		return HtmlUtil.makeSelectInput(CS_CAMPAIGN_FN, selectedValue, JSUtil.ON_CHANGE, options, false, getComponentTitle());</span>
	}

	/**
	 * Create Shift Drop Down for the Custom Shift and Flex Time request filters
	 */
	public String createShiftDD() {
<span class="nc" id="L865">		ID id = (ID) m_rFilter.getValueForKey(RequestFilter.CS_SHIFTID_KEY);</span>
<span class="nc bnc" id="L866" title="All 2 branches missed.">		String selectedValue = id != null ? id.toString() : &quot;&quot;;</span>

<span class="nc" id="L868">		ArrayList orderedNames = new ArrayList();</span>
<span class="nc bnc" id="L869" title="All 2 branches missed.">		for (Iterator it = m_shiftIDNamesMap.entrySet().iterator(); it.hasNext();) {</span>
<span class="nc" id="L870">			Entry&lt;ID, String&gt; entry = (Entry&lt;ID, String&gt;) it.next();</span>
<span class="nc" id="L871">			String value = entry.getKey().toString();</span>
<span class="nc" id="L872">			String label = entry.getValue();</span>
<span class="nc" id="L873">			orderedNames.add(new StringsPair(value, label));</span>
<span class="nc" id="L874">		}</span>
		// sort shift names ASC
<span class="nc" id="L876">		Collections.sort(orderedNames);</span>

<span class="nc" id="L878">		List options = new ArrayList();</span>
<span class="nc bnc" id="L879" title="All 2 branches missed.">		for (Iterator it = orderedNames.iterator(); it.hasNext();) {</span>
<span class="nc" id="L880">			StringsPair option = (StringsPair) it.next();</span>
<span class="nc" id="L881">			options.add(option);</span>
<span class="nc" id="L882">		}</span>

<span class="nc" id="L884">		insertAllToOptions(options);</span>
<span class="nc" id="L885">		return HtmlUtil.makeSelectInput(CS_SHIFT_FN, selectedValue, JSUtil.ON_CHANGE, options, false, getComponentTitle());</span>
	}

	/**
	 * Create Activity Drop Down for the Custom Shift and Flex Time request filters
	 */
	public String createActivityDD() {
<span class="nc" id="L892">		ID id = (ID) m_rFilter.getValueForKey(RequestFilter.CS_ACTIVITYID_KEY);</span>
<span class="nc bnc" id="L893" title="All 2 branches missed.">		String selectedValue = id != null ? id.toString() : &quot;&quot;;</span>

<span class="nc" id="L895">		ArrayList orderedNames = new ArrayList();</span>
<span class="nc bnc" id="L896" title="All 2 branches missed.">		for (Iterator it = m_activityList.iterator(); it.hasNext();) {</span>
<span class="nc" id="L897">			Activity item = (Activity) it.next();</span>
<span class="nc" id="L898">			String label = item.getName();</span>
<span class="nc" id="L899">			String value = item.getID().toString();</span>
<span class="nc" id="L900">			orderedNames.add(new StringsPair(value, label));</span>
<span class="nc" id="L901">		}</span>
		// sort shift names ASC
<span class="nc" id="L903">		Collections.sort(orderedNames);</span>

<span class="nc" id="L905">		List options = new ArrayList();</span>
<span class="nc bnc" id="L906" title="All 2 branches missed.">		for (Iterator it = orderedNames.iterator(); it.hasNext();) {</span>
<span class="nc" id="L907">			StringsPair option = (StringsPair) it.next();</span>
<span class="nc" id="L908">			options.add(option);</span>
<span class="nc" id="L909">		}</span>

<span class="nc" id="L911">		insertAllToOptions(options);</span>
<span class="nc" id="L912">		return HtmlUtil.makeSelectInput(CS_ACTIVITY_FN, selectedValue, JSUtil.ON_CHANGE, options, false, getComponentTitle());</span>
	}

	/**
	 * Create Extensions Drop Down for the Custom Shift request filter
	 */
	public String createExtensionDD() {
<span class="nc" id="L919">		ID id = (ID) m_rFilter.getValueForKey(RequestFilter.CS_EXTID_KEY);</span>
<span class="nc bnc" id="L920" title="All 2 branches missed.">		String selectedValue = id != null ? id.toString() : &quot;&quot;;</span>

<span class="nc" id="L922">		ArrayList orderedNames = new ArrayList();</span>
<span class="nc bnc" id="L923" title="All 2 branches missed.">		for (Iterator it = m_extIDNamesMap.entrySet().iterator(); it.hasNext();) {</span>
<span class="nc" id="L924">			Entry&lt;ID, String&gt; entry = (Entry&lt;ID, String&gt;) it.next();</span>
<span class="nc" id="L925">			String value = entry.getKey().toString();</span>
<span class="nc" id="L926">			String label = entry.getValue();</span>
<span class="nc" id="L927">			orderedNames.add(new StringsPair(value, label));</span>
<span class="nc" id="L928">		}</span>

		// sort shift names ASC
<span class="nc" id="L931">		Collections.sort(orderedNames);</span>

<span class="nc" id="L933">		List options = new ArrayList();</span>
<span class="nc bnc" id="L934" title="All 2 branches missed.">		for (Iterator it = orderedNames.iterator(); it.hasNext();) {</span>
<span class="nc" id="L935">			StringsPair option = (StringsPair) it.next();</span>
<span class="nc" id="L936">			options.add(option);</span>
<span class="nc" id="L937">		}</span>

<span class="nc" id="L939">		insertAllToOptions(options);</span>
<span class="nc" id="L940">		return HtmlUtil.makeSelectInput(CS_EXTENSION_FN, selectedValue, JSUtil.ON_CHANGE, options, false, getComponentTitle());</span>
	}

	/**
	 * Create Status Drop Down
	 */
	public String createStatusDD() {
<span class="nc" id="L947">		List options = RequestsFilterUtil.createStatusOptions(m_reqStatusList, m_localizer);</span>
<span class="nc" id="L948">		insertAllToOptions(options);</span>
<span class="nc" id="L949">		return createDD(STATUS_FN, RequestFilter.STATUS_KEY, options);</span>
	}

	/**
	 * Create Time Off Length Drop Down
	 */
	public String createTimeOffChoiceDD() {
<span class="nc" id="L956">		List options = new ArrayList(2);</span>

<span class="nc" id="L958">		String allChoiceLabel = i18n(m_common_bundle, UIFWebBundleKey.ALL);</span>
<span class="nc" id="L959">		options.add(new StringsPair(RequestFilter.ALL_TO_CHOICES, allChoiceLabel));</span>

<span class="nc" id="L961">		String firstChoiceLabel = i18n(m_common_bundle, UIFWebBundleKey.FIRST_ONLY);</span>
<span class="nc" id="L962">		options.add(new StringsPair(RequestFilter.FIRST_ONLY_TO_CHOICE, firstChoiceLabel));</span>

<span class="nc" id="L964">		return createDD(TO_NUM_CHOICE_FN, RequestFilter.TO_NUMBER_OF_CHOICES_KEY, options);</span>
	}

	/**
	 * Create Shift Swap Type Drop Down
	 */
	public String createShiftSwapTypeDD() {
<span class="nc" id="L971">		List options = new ArrayList(2);</span>

<span class="nc" id="L973">		String twoWayLabel = i18n(m_bundle, RmWebBundleKey.SWAPTYPE_TWOWAY);</span>
<span class="nc" id="L974">		options.add(new StringsPair(ShiftSwapRequest.SHIFTSWAP_TYPE_TWOWAY, twoWayLabel));</span>

<span class="nc" id="L976">		String oneWayLabel = i18n(m_bundle, RmWebBundleKey.SWAPTYPE_ONEWAY);</span>
<span class="nc" id="L977">		options.add(new StringsPair(ShiftSwapRequest.SHIFTSWAP_TYPE_ONEWAY, oneWayLabel));</span>

<span class="nc" id="L979">		insertAllToOptions(options);</span>
<span class="nc" id="L980">		return createDD(SS_TYPE_FN, RequestFilter.SWAP_TYPE_KEY, options);</span>
	}

	/**
	 * Create Custom Shift sub-Type Drop Down (New Shift/Shift Change)
	 */
	public String createCustShiftTypeDD() {
<span class="nc" id="L987">		List options = new ArrayList(2);</span>

<span class="nc" id="L989">		String newShiftLabel = i18n(m_bundle, RmWebBundleKey.CSR_SUBTYPE_NEW_SHIFT);</span>
<span class="nc" id="L990">		options.add(new StringsPair(CustShiftReq.CS_SUBTYPE_NEW_SHIFT, newShiftLabel));</span>

<span class="nc" id="L992">		String shiftChangeLabel = i18n(m_bundle, RmWebBundleKey.CSR_SUBTYPE_SHIFT_CHANGE);</span>
<span class="nc" id="L993">		options.add(new StringsPair(CustShiftReq.CS_SUBTYPE_SHIFT_CHANGE, shiftChangeLabel));</span>

<span class="nc" id="L995">		insertAllToOptions(options);</span>
<span class="nc" id="L996">		return createDD(CS_SUBTYPE_FN, RequestFilter.CS_SUBTYPE_KEY, options);</span>
	}

	/**
	 * Create Overtime Drop Down (Yes/No)
	 */
	public String createOvertimeDD() {
<span class="nc" id="L1003">		List options = new ArrayList(2);</span>

<span class="nc" id="L1005">		String yesLabel = i18n(m_bundle, RmWebBundleKey.YES);</span>
<span class="nc" id="L1006">		options.add(new StringsPair(CustShiftReq.CS_OVERTIME_YES, yesLabel));</span>

<span class="nc" id="L1008">		String noLabel = i18n(m_bundle, RmWebBundleKey.NO);</span>
<span class="nc" id="L1009">		options.add(new StringsPair(CustShiftReq.CS_OVERTIME_NO, noLabel));</span>

<span class="nc" id="L1011">		insertAllToOptions(options);</span>
<span class="nc" id="L1012">		return createDD(CS_OVERTIME_FN, RequestFilter.CS_ISOT_KEY, options);</span>
	}

	/**
	 * Set Shif Swap Skills IDs
	 */
	public void setSsSkills(ID[] ids) {
<span class="nc bnc" id="L1019" title="All 2 branches missed.">		if (ids != null) {</span>
<span class="nc" id="L1020">			List idList = Arrays.asList(ids);</span>
<span class="nc" id="L1021">			m_rFilter.setKey(RequestFilter.SWAP_SKILLS_KEY, (Serializable) idList);</span>
		}
<span class="nc" id="L1023">	}</span>

	/**
	 * Create Shift Swap Skills Drop Down
	 */
	public String createShiftSwapSkillDD() {
<span class="nc" id="L1029">		Collection skillIDs = (Collection) m_rFilter.getValueForKey(RequestFilter.SWAP_SKILLS_KEY);</span>
<span class="nc" id="L1030">		String[] selectedValue = StringUtil.createStringArrayFromIDs(skillIDs);</span>

<span class="nc" id="L1032">		List options = new ArrayList();</span>
<span class="nc bnc" id="L1033" title="All 2 branches missed.">		for (Iterator it = m_skillList.iterator(); it.hasNext();) {</span>
<span class="nc" id="L1034">			Skill skill = (Skill) it.next();</span>

<span class="nc" id="L1036">			String label = skill.getName();</span>
<span class="nc" id="L1037">			String value = skill.getID().toString();</span>
<span class="nc" id="L1038">			options.add(new StringsPair(value, label));</span>
<span class="nc" id="L1039">		}</span>

<span class="nc" id="L1041">		boolean isMultiple = true;</span>
<span class="nc" id="L1042">		insertAllToOptions(options);</span>
<span class="nc" id="L1043">		String curCompTitle = getComponentTitle();</span>
<span class="nc" id="L1044">		return HtmlUtil.makeSelectInput(SS_SKILLS_FN, &quot;&quot;, selectedValue, JSUtil.ON_CHANGE, options, null, false, isMultiple,</span>
				true, false, curCompTitle, null, true, curCompTitle, null);
	}

	/**
	 * Insert All Option into Options List
	 */
	protected void insertAllToOptions(List options) {
<span class="nc" id="L1052">		options.add(0, m_allOption);</span>
<span class="nc" id="L1053">	}</span>

	// ////////////////////////////////////////////////////////////////////////////
	// The following are date helper methods
	// ////////////////////////////////////////////////////////////////////////////
	/**
	 * Initialize Date
	 */
	protected void initDate(String fn) {
<span class="nc" id="L1062">		m_datePC.reset();</span>
<span class="nc" id="L1063">		m_datePC.setDateInputFieldName(fn);</span>

<span class="nc" id="L1065">		m_datePC.setIsDateValueOptional(true);</span>
<span class="nc" id="L1066">		m_datePC.setIsTimeEnabled(true);</span>
<span class="nc" id="L1067">	}</span>

	/**
	 * Extract Date Parameter
	 */
	protected Date extractDate(HttpServletRequest request, String fn, String key) {
<span class="nc" id="L1073">		initDate(fn);</span>

<span class="nc" id="L1075">		m_datePC.extractParameters(request);</span>
<span class="nc" id="L1076">		Date date = m_datePC.getDate();</span>
<span class="nc bnc" id="L1077" title="All 2 branches missed.">		if (date != null) {</span>
<span class="nc" id="L1078">			m_rFilter.setKey(key, date);</span>
		}
<span class="nc" id="L1080">		return date;</span>
	}

	/**
	 * Extract String Parameter
	 */
	protected void extractString(HttpServletRequest request, String fn, String key) {
<span class="nc" id="L1087">		String value = request.getParameter(fn);</span>
<span class="nc bnc" id="L1088" title="All 2 branches missed.">		if (value != null) {</span>
<span class="nc" id="L1089">			m_rFilter.setKey(key, value);</span>
		}
<span class="nc" id="L1091">	}</span>

	/**
	 * Initialize Date Range
	 */
	protected void initDateRange(String fn) {
<span class="nc" id="L1097">		m_dateRangePC.reset();</span>
<span class="nc" id="L1098">		m_dateRangePC.setDateInputFieldName(fn);</span>

<span class="nc" id="L1100">		m_dateRangePC.getStartDatePickerPC().setIsDateValueOptional(true);</span>
<span class="nc" id="L1101">		m_dateRangePC.getStartDatePickerPC().setIsTimeEnabled(true);</span>

<span class="nc" id="L1103">		m_dateRangePC.getEndDatePickerPC().setIsDateValueOptional(true);</span>
<span class="nc" id="L1104">		m_dateRangePC.getEndDatePickerPC().setIsTimeEnabled(true);</span>

<span class="nc" id="L1106">		limitDateRangePicker(); // make selectable +/- 30years</span>
<span class="nc" id="L1107">	}</span>

	/**
	 * Extract Date Parameters
	 */
	protected void extractDateRange(HttpServletRequest request, String fn, String key) {
<span class="nc" id="L1113">		initDateRange(fn);</span>

<span class="nc" id="L1115">		m_dateRangePC.extractParameters(request);</span>
<span class="nc" id="L1116">		Date sDate = m_dateRangePC.getStartDatePickerPC().getDate();</span>
<span class="nc" id="L1117">		Date eDate = m_dateRangePC.getEndDatePickerPC().getDate();</span>
<span class="nc bnc" id="L1118" title="All 4 branches missed.">		if (sDate != null &amp;&amp; eDate != null) {</span>
<span class="nc" id="L1119">			List dates = new ArrayList(2);</span>
<span class="nc" id="L1120">			dates.add(sDate);</span>
<span class="nc" id="L1121">			dates.add(eDate);</span>
<span class="nc" id="L1122">			m_rFilter.setKey(key, (Serializable) dates);</span>
		}
<span class="nc" id="L1124">	}</span>

	/**
	 * Create Date Range with specified Field Name and Request Key
	 */
	protected String createDateRange(String fn, String key) {
<span class="nc" id="L1130">		initDateRange(fn);</span>
<span class="nc" id="L1131">		DatePickerPC startDatePicker = m_dateRangePC.getStartDatePickerPC();</span>
<span class="nc" id="L1132">		DatePickerPC endDatePicker = m_dateRangePC.getEndDatePickerPC();</span>

<span class="nc" id="L1134">		List dates = (List) m_rFilter.getValueForKey(key);</span>
<span class="nc bnc" id="L1135" title="All 4 branches missed.">		if (dates != null &amp;&amp; !dates.isEmpty()) {</span>
<span class="nc" id="L1136">			Date sDate = (Date) dates.get(0);</span>
<span class="nc" id="L1137">			Date eDate = (Date) dates.get(1);</span>
<span class="nc" id="L1138">			startDatePicker.setDate(sDate);</span>
<span class="nc" id="L1139">			endDatePicker.setDate(eDate);</span>
		}
<span class="nc" id="L1141">		String compTitle = getComponentTitle();</span>
<span class="nc" id="L1142">		startDatePicker.setAriaLabel(compTitle + &quot; &quot; + startDatePicker.getInputTitle());</span>
<span class="nc" id="L1143">		endDatePicker.setAriaLabel(compTitle + &quot; &quot; + endDatePicker.getInputTitle());</span>

<span class="nc" id="L1145">		m_dateRangePC.initForDisplay();</span>
<span class="nc" id="L1146">		return m_dateRangePC.getHtmlDisplay();</span>
	}
	/**
	 * Set ShiftBid AuctionNames() IDs , for fieldName SB_AUCTION_FN
	 */
	public void setSbAuctionNames(ID[] ids) {
<span class="nc bnc" id="L1152" title="All 2 branches missed.">		if (ids != null) {</span>
<span class="nc" id="L1153">			List idList = Arrays.asList(ids);</span>
<span class="nc" id="L1154">			m_rFilter.setKey(RequestFilter.BID_AUCTIONS_KEY, (Serializable) idList);</span>
		}
<span class="nc" id="L1156">	}</span>
	/**
	 * Create Shift Bid Auction Drop Down- allows multi-selection
	 */
	public String createShiftBidAuctionDD() {
<span class="nc" id="L1161">		Collection shiftBidAuctionIdIDs = (Collection) m_rFilter.getValueForKey(RequestFilter.BID_AUCTIONS_KEY);</span>
<span class="nc" id="L1162">		String[] selectedValue = StringUtil.createStringArrayFromIDs(shiftBidAuctionIdIDs);</span>
		
<span class="nc" id="L1164">		List options = new ArrayList();</span>
		
<span class="nc" id="L1166">		options.addAll(shiftBidList);</span>
		// sort auction names ASC
<span class="nc" id="L1168">		Collections.sort(options);</span>
<span class="nc" id="L1169">		insertAllToOptions(options);</span>
<span class="nc" id="L1170">		return HtmlUtil.makeSelectInput(SB_AUCTION_FN, selectedValue, JSUtil.ON_CHANGE, options, true, true);</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>