<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>RequestFilingRuleManagerEJB.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.ejb.rm.setup.filingrules.ejb</a> &gt; <span class="el_source">RequestFilingRuleManagerEJB.java</span></div><h1>RequestFilingRuleManagerEJB.java</h1><pre class="source lang-java linenums">/*
 * RequestFilingRuleManagerEJB.java
 * Copyright (c) 2002, Blue Pumpkin Software, Inc.
 * All rights reserved.
 */
package com.bluepumpkin.ejb.rm.setup.filingrules.ejb;

import java.util.Collection;
import java.util.Map;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.logging.Category;
import com.bluepumpkin.ejb.bbm.base.BbmCreateException;
import com.bluepumpkin.ejb.bbm.base.BbmFinderException;
import com.bluepumpkin.ejb.bbm.base.BbmRemoveException;
import com.bluepumpkin.ejb.bbm.base.BbmUpdateException;
import com.bluepumpkin.ejb.core.base.MultiUserException;
import com.bluepumpkin.ejb.core.base.SessionEJBBase; //OUTSIDE_CONTAINER
import com.bluepumpkin.ejb.rm.Log;
import com.bluepumpkin.ejb.rm.requests.common.ejb.RequestUtil;
//import com.bluepumpkin.ejb.rm.requests.common.ejb.SessionEjbBaseForTest; //OUTSIDE_CONTAINER
import com.bluepumpkin.ejb.rm.requests.common.model.Request;
import com.bluepumpkin.ejb.rm.setup.filingrules.model.RequestFilingRule;

/**
 * EJB for RequestFilingRule.
 * This class implements EJB for managing RequestFiling Rules.
 */
<span class="nc" id="L29">public class RequestFilingRuleManagerEJB extends SessionEJBBase { //OUTSIDE_CONTAINER</span>
//public class RequestFilingRuleManagerEJB extends SessionEjbBaseForTest implements RequestFilingRuleManager { //OUTSIDE_CONTAINER
    
<span class="nc" id="L32">    private static Category m_cat = Log.initCategory(</span>
<span class="nc" id="L33">    RequestFilingRuleManagerEJB.class.getName());</span>
    
    /** override the base class to provide the appropriate logging category */
    @Override
	protected Category getCategory() {
<span class="nc" id="L38">        return m_cat;</span>
    }
    
    {
<span class="nc" id="L42">        super.init( RequestFilingRuleManagerEJB.class.getName() );</span>
<span class="nc" id="L43">    }</span>
    
    
    /**
     * Find the RequestFilingRules for the all parent organization id including
     * OrganizationId passed as argument and returns a collection of
     * RequestFilingRule Object if found.
     * @param pOrganizationId - Organisation ID object.
     * @return Collection A collection of RequestFilingRule Object
     * @throws BbmFinderException if there is an error.
     */
	public Collection&lt;RequestFilingRule&gt; findFilingRulesByOrgId(ID pOrganizationId)
    throws BbmFinderException {
<span class="nc" id="L56">        final String methodName = &quot;findFilingRulesByOrgId&quot;;</span>
<span class="nc" id="L57">        methodStart(methodName, pOrganizationId);</span>
		Collection&lt;RequestFilingRule&gt; results;
        try {
<span class="nc" id="L60">            results = findFilingRulesByOrgId(pOrganizationId,</span>
            Request.REQUESTTYPE_ALL,
            false,
            null);
<span class="nc" id="L64">        } catch (BbmFinderException e) {</span>
<span class="nc" id="L65">            handleException(e);</span>
<span class="nc" id="L66">            m_cat.error(pOrganizationId, e);</span>
<span class="nc" id="L67">            throw e;</span>
        } finally {
<span class="nc" id="L69">            methodFinish();</span>
<span class="nc" id="L70">        }</span>
<span class="nc" id="L71">        return results;</span>
    }
    
    /**
     * Find the RequestFilingRules for the OrganizationId and request type
     * passed as argument and returns a collection of RequestFilingRule
     * Object if found.
     * @param pOrganizationId - Organisation ID object.
     * @param pRequestType - RequestType.
     * @return Collection A collection of RequestFilingRule Object
     * @throws BbmFinderException if there is an error.
     */
	public Collection&lt;RequestFilingRule&gt; findFilingRulesByOrgId(ID pOrganizationId,
    String pRequestType)
    throws BbmFinderException {
<span class="nc" id="L86">        final String methodName = &quot;findFilingRulesByOrgId&quot;;</span>
<span class="nc" id="L87">        methodStart(methodName, pOrganizationId, pRequestType);</span>
		Collection&lt;RequestFilingRule&gt; results;
        try {
<span class="nc" id="L90">            results = findFilingRulesByOrgId(pOrganizationId,</span>
            pRequestType,
            false,
            null);
<span class="nc" id="L94">        } catch (BbmFinderException e) {</span>
<span class="nc" id="L95">            handleException(e);</span>
<span class="nc" id="L96">            m_cat.error(pOrganizationId, e);</span>
<span class="nc" id="L97">            throw e;</span>
        } finally {
<span class="nc" id="L99">            methodFinish();</span>
<span class="nc" id="L100">        }</span>
<span class="nc" id="L101">        return results;</span>
    }
    
        /* Find the RequestFilingRules rules for the organization id.
         * @param pOrganizationId- ID object for  organization.
         * @param pRequestType - request type
         * @return Collection of RequestFilingRule objects.
         * @throw BbmFinderException.
         */
	public Collection&lt;RequestFilingRule&gt; findEnabledFilingRules(ID pOrganizationId,
    String pRequestType)
    throws BbmFinderException {
        
<span class="nc" id="L114">        final String l_MethodName = &quot;findEnabledFilingRules&quot;;</span>
<span class="nc" id="L115">        methodStart(l_MethodName, pOrganizationId, pRequestType);</span>
        try {
<span class="nc" id="L117">			Collection&lt;RequestFilingRule&gt; results = findFilingRulesByOrgId(pOrganizationId,</span>
            pRequestType,
            true,
            null);
<span class="nc" id="L121">            return results;</span>
<span class="nc" id="L122">        } catch (BbmFinderException e) {</span>
<span class="nc" id="L123">            handleException(e);</span>
<span class="nc" id="L124">            m_cat.error(pOrganizationId, e);</span>
<span class="nc" id="L125">            throw e;</span>
        } finally {
<span class="nc" id="L127">            methodFinish();</span>
        }
    }
    
        /* Find the RequestFilingRules rules for the organization id.
         * @param pOrganizatioId - ID object for organization.
         * @param pRequestType - request type
         * @param pActivityId - id of the activity type, can be null
         * @return Collection of RequestFilingRule objects.
         * @throw BbmFinderException.
         */
	public Collection&lt;RequestFilingRule&gt; findEnabledFilingRules(ID pOrganizationId,
    String pRequestType,
    ID pActivityId)
    throws BbmFinderException {
        
<span class="nc" id="L143">        final String l_MethodName = &quot;findEnabledFilingRules&quot;;</span>
<span class="nc" id="L144">        methodStart(l_MethodName, pOrganizationId, pRequestType);</span>
        try {
<span class="nc" id="L146">			Collection&lt;RequestFilingRule&gt; results = findFilingRulesByOrgId(pOrganizationId, pRequestType,</span>
                    true, pActivityId);
            
<span class="nc" id="L149">            return results;</span>
<span class="nc" id="L150">        } catch (BbmFinderException e) {</span>
<span class="nc" id="L151">            handleException(e);</span>
<span class="nc" id="L152">            m_cat.error(pOrganizationId, e);</span>
<span class="nc" id="L153">            throw e;</span>
        } finally {
<span class="nc" id="L155">            methodFinish();</span>
        }
    }
    
    
    /**
     * Find the RequestFilingRules for the OrganizationId and request type
     * passed as argument and returns a collection of RequestFilingRule
     * Object if found.
     * @param pOrganizationId - Organisation ID object.
     * @param pRequestType - RequestType.
     * @param onlyIfApplied - only returns applied rules if true
     * @param pActivityId - id of the activity type, can be null
     * @return Collection A collection of RequestFilingRule Object
     * @throws BbmFinderException if there is an error.
     */
	public Collection&lt;RequestFilingRule&gt; findFilingRulesByOrgId(ID pOrganizationId, String pRequestType,
            boolean onlyIfApplied, ID pActivityId) throws BbmFinderException {
<span class="nc" id="L173">        final String methodName = &quot;findFilingRulesByOrgId&quot;;</span>
<span class="nc" id="L174">        methodStart(methodName, pOrganizationId, pRequestType);</span>
		Collection&lt;RequestFilingRule&gt; results;
        
<span class="nc" id="L177">        RequestFilingRuleDAO dao = null;</span>
        try {
<span class="nc" id="L179">            dao = new RequestFilingRuleDAO();</span>
            
<span class="nc" id="L181">            results = dao.findFilingRules(pOrganizationId,</span>
            pRequestType,
            onlyIfApplied,
            pActivityId);
<span class="nc" id="L185">        } catch (Exception e) {</span>
<span class="nc" id="L186">            handleException(e);</span>
<span class="nc" id="L187">            throw RequestUtil.createBbmFinderExceptionWrapper(e, m_cat);</span>
        } finally {
<span class="nc bnc" id="L189" title="All 4 branches missed.">            if (dao != null) dao.cleanUp();</span>
<span class="nc" id="L190">            methodFinish();</span>
<span class="nc" id="L191">        }</span>
<span class="nc" id="L192">        return results;</span>
    }
    
    /**
     * Find the RequestFilingRules for the ID, RequestFilingRuleId passed as argument
     * and returns a RequestFilingRule Object if found.
     * @param pRequestFilingRuleId -  ID for RequestFilingRule object.
     * @return RequestFilingRule - A RequestFilingRule Object
     * @throws BbmFinderException if there is an error.
     */
    public RequestFilingRule findFilingRuleById( ID pRequestFilingRuleId )
    throws BbmFinderException {
<span class="nc" id="L204">        final String methodName = &quot;findFilingRuleById&quot;;</span>
<span class="nc" id="L205">        methodStart(methodName, pRequestFilingRuleId);</span>
        
<span class="nc" id="L207">        RequestFilingRule lRequestFilingRule = null;</span>
        
<span class="nc" id="L209">        RequestFilingRuleDAO dao = new RequestFilingRuleDAO();</span>
        try {
<span class="nc" id="L211">            lRequestFilingRule = dao.findFilingRuleById(pRequestFilingRuleId);</span>
<span class="nc" id="L212">        } catch (Exception e) {</span>
<span class="nc" id="L213">            handleException(e);</span>
<span class="nc" id="L214">            m_cat.error(pRequestFilingRuleId, e);</span>
<span class="nc" id="L215">            throw new BbmFinderException(e);</span>
        } finally {
<span class="nc" id="L217">            methodFinish();</span>
<span class="nc" id="L218">            dao.cleanUp();</span>
<span class="nc" id="L219">        }</span>
<span class="nc" id="L220">        return lRequestFilingRule;</span>
    }
    
    /**
     * update the  RequestFilingRule database with the RequestFilingRule object
     * values passed as argument.
     * @param pRequestFilingRule - RequestFilingRule object.
     * @throws BbmUpdateException if there is an error.
     * @throws MultiUserException if there is an error.
     */
    public void updateFilingRule(RequestFilingRule pRequestFilingRule)
    throws BbmUpdateException, MultiUserException {
<span class="nc" id="L232">        final String methodName = &quot;updateFilingRule&quot;;</span>
<span class="nc" id="L233">        methodStart(methodName, pRequestFilingRule);</span>
<span class="nc" id="L234">        RequestFilingRuleDAO dao = new RequestFilingRuleDAO();</span>
        try {
<span class="nc" id="L236">            dao.updateObject(pRequestFilingRule);</span>
<span class="nc" id="L237">        } catch (Exception e) {</span>
<span class="nc" id="L238">            handleException(e);</span>
<span class="nc" id="L239">            throw RequestUtil.createBbmUpdateExceptionWrapper(e, m_cat);</span>
        } finally {
<span class="nc" id="L241">            methodFinish();</span>
<span class="nc" id="L242">            dao.cleanUp();</span>
<span class="nc" id="L243">        }</span>
<span class="nc" id="L244">    }</span>
    
    /**
     * Delete the RequestFilingRule from database whose ID is passed as argument.
     * @param pRequestFilingRuleId - Id for RequestFilingRule.
     * @throws BbmRemoveException if there is an error.
     */
    public void deleteFilingRule(ID pRequestFilingRuleId)
    throws BbmRemoveException {
<span class="nc" id="L253">        final String methodName = &quot;deleteFilingRule&quot;;</span>
<span class="nc" id="L254">        methodStart(methodName, pRequestFilingRuleId);</span>
<span class="nc" id="L255">        RequestFilingRuleDAO dao = new RequestFilingRuleDAO();</span>
        try {
<span class="nc" id="L257">            dao.deleteObject(pRequestFilingRuleId);</span>
<span class="nc" id="L258">        } catch (BbmRemoveException e) {</span>
<span class="nc" id="L259">            m_cat.error(pRequestFilingRuleId, e);</span>
<span class="nc" id="L260">            handleException(e);</span>
<span class="nc" id="L261">            throw e;</span>
        }  finally {            
<span class="nc" id="L263">            methodFinish();</span>
<span class="nc" id="L264">            dao.cleanUp();</span>
<span class="nc" id="L265">        }</span>
<span class="nc" id="L266">    }</span>
    
    /**
     * creates a new RequestFilingRules from the  RequestFilingRules object
     * passed as argument.
     * @param pOrganizationId -  ID object for organization.
     * @throws BbmCreateException if there is an error.
     */
    public ID createFilingRule( RequestFilingRule pRequestFilingRule)
    throws BbmCreateException {
<span class="nc" id="L276">        final String methodName = &quot;createFilingRule&quot;;</span>
<span class="nc" id="L277">        methodStart(methodName, pRequestFilingRule);</span>
        ID lCreatedID;
<span class="nc" id="L279">        RequestFilingRuleDAO dao = new RequestFilingRuleDAO();</span>
        try {
            //insert record in filing rule table.
<span class="nc" id="L282">            lCreatedID = dao.createObject(pRequestFilingRule);</span>
<span class="nc" id="L283">        } catch (Exception e) {</span>
<span class="nc" id="L284">            handleException(e);</span>
<span class="nc" id="L285">            throw RequestUtil.createBbmCreateExceptionWrapper(e, m_cat);</span>
        } finally {
<span class="nc" id="L287">            methodFinish();</span>
<span class="nc" id="L288">            dao.cleanUp();</span>
<span class="nc" id="L289">        }</span>
<span class="nc" id="L290">        return lCreatedID;</span>
    }
    
    /**
     * Update the applied status for the for the RequestFilingRules
     * whose ids and status pair are passed as Map argument.
     * @param pOrganizationId -  ID object for organization.
     * @param pRequestFilingRuleIDStatus - Map of RequestFilingRuleID
     * (key) and apply status (true or false as value)
     * @throws BbmUpdateException if there is an error.
     * @throws MultiUserException if there is an error.
     * @throws RemoteException if there is an error.
     */
    
    public void saveApplied(ID pOrganizationId, Map pRequestFilingRuleIDStatus)
    throws BbmUpdateException  {
<span class="nc" id="L306">        final String methodName = &quot;saveApplied&quot;;</span>
<span class="nc" id="L307">        methodStart(methodName, pRequestFilingRuleIDStatus);</span>
<span class="nc" id="L308">        AppliedFilingRuleDAO dao = new AppliedFilingRuleDAO();</span>
        try {
<span class="nc" id="L310">            dao.saveAppliedStatus( pOrganizationId,</span>
            pRequestFilingRuleIDStatus);
<span class="nc" id="L312">        } catch (Exception e) {</span>
<span class="nc" id="L313">            handleException(e);</span>
<span class="nc" id="L314">            throw RequestUtil.createBbmUpdateExceptionWrapper(e, m_cat);</span>
        } finally {
<span class="nc" id="L316">            methodFinish();</span>
<span class="nc" id="L317">            dao.cleanUp();</span>
<span class="nc" id="L318">        }</span>
<span class="nc" id="L319">    }</span>
    
    /**
     * Copy an exisitng RequestFilingRule to the organization
     * whose id is passed as the argument.
     * @param pRequestFilingRuleId -  ID object for RequestFilingRule.
     * @param pOrganizationId -  ID object for organization.
     * @throws BbmCreateException if there is an error.
     * @throws BbmFinderException if there is an error.
     */
    public ID copyRequestFilingRule(ID pRequestFilingRuleId, ID OrganizationId)
    throws BbmCreateException, BbmFinderException {
        
<span class="nc" id="L332">        final String methodName = &quot;copyRequestFilingRule&quot;;</span>
<span class="nc" id="L333">        methodStart(methodName, pRequestFilingRuleId, OrganizationId);</span>
        try {
<span class="nc" id="L335">            RequestFilingRule rfr = findFilingRuleById(pRequestFilingRuleId);</span>
<span class="nc" id="L336">            rfr.setID(null);</span>
<span class="nc" id="L337">            rfr.setOrganizationId(OrganizationId);</span>
            // FIXME: this may not be correct. We should copy the applied flag
            // from the source but this data is not stored in the rule
            // so we don't know it. Since we don't know the correct value, we use
            // true as the default.
<span class="nc" id="L342">            rfr.setApplied(true);</span>
<span class="nc" id="L343">            return createFilingRule(rfr);</span>
<span class="nc" id="L344">        } catch (BbmCreateException e) {</span>
<span class="nc" id="L345">            handleException(e);</span>
<span class="nc" id="L346">            m_cat.error(pRequestFilingRuleId, e);</span>
<span class="nc" id="L347">            throw e;</span>
<span class="nc" id="L348">        } catch (Exception  e) {</span>
<span class="nc" id="L349">            handleException(e);</span>
<span class="nc" id="L350">            m_cat.error(pRequestFilingRuleId, e);</span>
<span class="nc" id="L351">            throw new BbmCreateException(e);</span>
        } finally {
<span class="nc" id="L353">            methodFinish();</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>