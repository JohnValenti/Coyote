<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>ReferenceScheduleAssignmentsDAO.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.ejb.rm.requests.timeoff.intervalallocation.ejb</a> &gt; <span class="el_source">ReferenceScheduleAssignmentsDAO.java</span></div><h1>ReferenceScheduleAssignmentsDAO.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.ejb.rm.requests.timeoff.intervalallocation.ejb;

import java.util.*;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.jdmo.Jdmo;
import com.bluepumpkin.common.jdmo.JdmoException;
import com.bluepumpkin.common.jdmo.JdmoQuery;
import com.bluepumpkin.common.jdmo.JdmoRowset;
import com.bluepumpkin.common.jdmo.JdmoUtil;
import com.bluepumpkin.common.util.TimeZoneUtil;
import com.bluepumpkin.ejb.bbm.base.BbmFinderException;
import com.bluepumpkin.ejb.bbm.schedule.model.ShiftAssignment;
import com.bluepumpkin.ejb.bbm.schedule.model.ShiftEventAssignment;
import com.bluepumpkin.ejb.bbm.schedule.util.ScheduleUtil;
import com.bluepumpkin.ejb.rm.util.DAOUtil;
import com.bluepumpkin.ejb.rm.util.JdmoBatchExecute;
import com.bluepumpkin.ejb.rm.util.JdmoPreparedStatement;
import com.bluepumpkin.ejb.rm.util.RmScheduleUtil;

/*
 * This class contains the database access code for back end time off calculation related to reference schedules
 * The setup  database access code is in  com.bluepumpkin.ejb.rm.setup.calendartimeoff.ejb.EmployeeReferenceScheduleAssignmentDAO
 */
public class ReferenceScheduleAssignmentsDAO {

<span class="nc" id="L27">	private Jdmo dmo = null;</span>

<span class="nc" id="L29">	public ReferenceScheduleAssignmentsDAO() {</span>
<span class="nc" id="L30">		dmo = new Jdmo(false);</span>
<span class="nc" id="L31">	}</span>

	public void cleanUp() {
<span class="nc bnc" id="L34" title="All 2 branches missed.">		if (dmo != null) {</span>
<span class="nc" id="L35">			dmo.cleanUp();</span>
<span class="nc" id="L36">			dmo = null;</span>
		}
<span class="nc" id="L38">	}</span>

	/**
	 * @return A list of time off request choice IDs that would be affected by a change in the employee's reference schedule on the 
	 * &quot;As Of&quot; date. This is the list of time off request choices that start in the effective date block for the employee's reference 
	 * schedule on the &quot;As Of&quot; date
	 */
	public List&lt;ID&gt; getAffectedRequestChoices(Collection&lt;ID&gt; employeeIDs, Date asOfDate) throws BbmFinderException {

<span class="nc bnc" id="L47" title="All 4 branches missed.">		if (employeeIDs == null || employeeIDs.isEmpty()) {</span>
<span class="nc" id="L48">			return Collections.emptyList();</span>
		}

		//@formatter:off
<span class="nc" id="L52">		String sql =&quot;select TRC.ID &quot; </span>
		+ &quot; from WORKRESOURCEREFSCHEDULE RefSch  &quot;
		+ &quot; inner join REQUEST R on R.EMPLOYEEID = RefSch.WORKRESOURCEID &quot;
		+ &quot; inner join TIMEOFFREQUESTCHOICE TRC on TRC.TIMEOFFREQUESTID = R.ID &quot;
		+ &quot; where TRC.STARTTIME &gt;= RefSch.STARTTIME and TRC.STARTTIME &lt; isNull(RefSch.ENDTIME,'20700101') &quot;
		+ &quot; and '%s' &gt;= RefSch.STARTTIME and '%s' &lt; isNull(RefSch.ENDTIME,'20700101') and RefSch.WORKRESOURCEID in %s&quot;;
		//@formatter:on

		try {
<span class="nc" id="L61">			String asOfDateSql = JdmoUtil.formatDBString(asOfDate);</span>
<span class="nc" id="L62">			sql = String.format(sql, asOfDateSql, asOfDateSql, dmo.createInClause(employeeIDs));</span>

<span class="nc" id="L64">			JdmoRowset res = dmo.createRowset(sql);</span>
<span class="nc" id="L65">			List&lt;ID&gt; result = new ArrayList&lt;ID&gt;();</span>
<span class="nc bnc" id="L66" title="All 2 branches missed.">			while (res.next()) {</span>
<span class="nc" id="L67">				ID choiceID = res.getID(&quot;ID&quot;);</span>
<span class="nc" id="L68">				result.add(choiceID);</span>
<span class="nc" id="L69">			}</span>
<span class="nc" id="L70">			return result;</span>
<span class="nc" id="L71">		} catch (JdmoException e) {</span>
<span class="nc" id="L72">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * 
	 * @param employeeDates A collection of (Employee id, As of date) pairs for which to find the reference schedule period id
	 * @return
	 * A map from (Employee Id, As of Date) to the reference schedule period DEID
	 */
	public Map&lt;EmployeeDate, ID&gt; getReferenceScheduleSPDEID(Collection&lt;EmployeeDate&gt; employeeDates) throws JdmoException {
<span class="nc bnc" id="L83" title="All 4 branches missed.">		if (employeeDates == null || employeeDates.isEmpty()) {</span>
<span class="nc" id="L84">			return Collections.emptyMap();</span>
		}

<span class="nc" id="L87">		Map&lt;EmployeeDate, ID&gt; result = new HashMap&lt;EmployeeDate, ID&gt;();</span>
		//@formatter:off
<span class="nc" id="L89">		String sql = &quot;select EmpDates.EmployeeID,EmpDates.asOfDate, RSCH.SPID &quot; +</span>
							&quot;from  WORKRESOURCEREFSCHEDULE RSCH  &quot; + 
							&quot;inner join #EmployeeDates EmpDates on EmpDates.employeeID = RSCH.WORKRESOURCEID and  &quot;+
							&quot;EmpDates.asOfDate  &gt;= RSCH.STARTTIME and  EmpDates.asOfDate &lt;  isNull(RSCH.ENDTIME,'20700101')&quot;;
		//@formatter:on

<span class="nc" id="L95">		insertIntoTempEmployeeDate(employeeDates);</span>

<span class="nc" id="L97">		JdmoRowset res = dmo.createRowset(sql);</span>
<span class="nc bnc" id="L98" title="All 2 branches missed.">		while (res.next()) {</span>
<span class="nc" id="L99">			int employeeID = res.getInt(&quot;EmployeeID&quot;);</span>
<span class="nc" id="L100">			Date asOfDate = TimeZoneUtil.toDate(res.getTimestamp(&quot;asOfDate&quot;));</span>
<span class="nc" id="L101">			ID spDEID = res.getID(&quot;SPID&quot;);</span>
<span class="nc" id="L102">			EmployeeDate key = new EmployeeDate(employeeID, asOfDate);</span>
<span class="nc" id="L103">			result.put(key, spDEID);</span>
<span class="nc" id="L104">		}</span>
<span class="nc" id="L105">		return result;</span>
	}

	public List&lt;EmployeeSPTimeZone&gt; getReferenceScheduleTimeZones(Collection&lt;EmployeeDate&gt; employeeDates) throws JdmoException {

<span class="nc bnc" id="L110" title="All 2 branches missed.">		if (employeeDates.isEmpty()) {</span>
<span class="nc" id="L111">			return Collections.emptyList();</span>
		}

<span class="nc bnc" id="L114" title="All 2 branches missed.">		if (employeeDates.size() == 1) {</span>
			//special case for singleton list for performance. 
<span class="nc" id="L116">			EmployeeDate employeeDate = employeeDates.iterator().next();</span>
<span class="nc" id="L117">			return getReferenceScheduleTimeZones(employeeDate.employeeID, employeeDate.date);</span>
		}

<span class="nc" id="L120">		insertIntoTempEmployeeDate(employeeDates);</span>

		//@formatter:off
<span class="nc" id="L123">		String sql = &quot;select EmpDates.EmployeeID, SP.SID,TIMEZONEMAP.JAVATZIDENT,WRO.ORGANIZATIONID,EmpDates.asOfDate &quot; +</span>
					&quot;from  WORKRESOURCEREFSCHEDULE RSCH  &quot; + 
					&quot;inner join SP on SP.ID = RSCH.SPID  &quot; + 
					&quot;inner join CAMPAIGN C on SP.CAMPAIGNID = C.ID &quot; +
					&quot;inner join TIMEZONE on TIMEZONE.ID = C.TIMEZONEID &quot;+
					&quot;inner join TIMEZONEMAP on TIMEZONEMAP.WINTZSTDNAME = TIMEZONE.STANDARDNAME &quot;+ 
					&quot;inner join #EmployeeDates EmpDates on EmpDates.employeeID = RSCH.WORKRESOURCEID and  &quot;+
					&quot;     EmpDates.asOfDate  &gt;= RSCH.STARTTIME and  EmpDates.asOfDate &lt;  isNull(RSCH.ENDTIME,'20700101') &quot;+
					&quot;inner join WORKRESOURCEORGANIZATION WRO on WRO.WORKRESOURCEID = EmpDates.EmployeeID and &quot;+
					&quot;     EmpDates.asOfDate  &gt;= WRO.STARTTIME and  EmpDates.asOfDate &lt;  isNull(WRO.ENDTIME,'20700101')&quot;;
		//@formatter:on

<span class="nc" id="L135">		JdmoRowset res = dmo.createRowset(sql);</span>

<span class="nc" id="L137">		return getEmployeeSPTimeZone(res, null, null);</span>
	}

	public List&lt;EmployeeSPTimeZone&gt; getReferenceScheduleTimeZones(int employeeID, Date dt) throws JdmoException {


		//@formatter:off
<span class="nc" id="L144">		String sql = </span>
				&quot;select SP.SID,TIMEZONEMAP.JAVATZIDENT,WRO.ORGANIZATIONID &quot; + 
				&quot;from  WORKRESOURCEREFSCHEDULE RSCH     &quot; + 
				&quot;inner join SP on SP.ID = RSCH.SPID     &quot; + 
				&quot;inner join CAMPAIGN C on SP.CAMPAIGNID = C.ID   &quot; + 
				&quot;inner join TIMEZONE on TIMEZONE.ID = C.TIMEZONEID  &quot; + 
				&quot;inner join TIMEZONEMAP on TIMEZONEMAP.WINTZSTDNAME = TIMEZONE.STANDARDNAME   &quot; + 
				&quot;inner join WORKRESOURCEORGANIZATION WRO on WRO.WORKRESOURCEID = RSCH.WORKRESOURCEID &quot; + 
				&quot;where 	RSCH.WORKRESOURCEID = ? and &quot; + 
				&quot;	?  &gt;= RSCH.STARTTIME and  ? &lt;  isNull(RSCH.ENDTIME,'20700101') and &quot; + 
				&quot;	?  &gt;= WRO.STARTTIME and  ? &lt;  isNull(WRO.ENDTIME,'20700101') &quot;;
		//@formatter:on

<span class="nc" id="L157">		JdmoRowset res = JdmoPreparedStatement.createRowset(dmo, sql, employeeID, dt, dt, dt, dt);</span>

<span class="nc" id="L159">		return getEmployeeSPTimeZone(res, employeeID, dt);</span>
	}

	private List&lt;EmployeeSPTimeZone&gt; getEmployeeSPTimeZone(JdmoRowset res, Integer singleEmployeeID, Date singleAsOfDate)
			throws JdmoException {
<span class="nc" id="L164">		List&lt;EmployeeSPTimeZone&gt; result = new ArrayList&lt;EmployeeSPTimeZone&gt;();</span>

<span class="nc bnc" id="L166" title="All 2 branches missed.">		while (res.next()) {</span>
<span class="nc bnc" id="L167" title="All 2 branches missed.">			int employeeID = singleEmployeeID == null ? res.getInt(&quot;EmployeeID&quot;) : singleEmployeeID;</span>
<span class="nc" id="L168">			int spID = res.getInt(&quot;SID&quot;);</span>
<span class="nc" id="L169">			String timezone = res.getString(&quot;JAVATZIDENT&quot;);</span>
<span class="nc" id="L170">			int orgID = res.getInt(&quot;ORGANIZATIONID&quot;);</span>
<span class="nc bnc" id="L171" title="All 2 branches missed.">			Date asOfDate = singleAsOfDate == null ? TimeZoneUtil.toDate(res.getTimestamp(&quot;asOfDate&quot;)) : singleAsOfDate;</span>
<span class="nc" id="L172">			EmployeeSPTimeZone spTimeZone = new EmployeeSPTimeZone(employeeID, spID, timezone, orgID, asOfDate);</span>
<span class="nc" id="L173">			result.add(spTimeZone);</span>
<span class="nc" id="L174">		}</span>

<span class="nc" id="L176">		return result;</span>
	}

	private void insertIntoTempEmployeeDate(Collection&lt;EmployeeDate&gt; employeeDates) throws JdmoException {
<span class="nc" id="L180">		DAOUtil.createTempTable(dmo, &quot;EmployeeDates&quot;, &quot;employeeId int, asOfDate datetime&quot;);</span>

<span class="nc" id="L182">		JdmoBatchExecute&lt;EmployeeDate&gt; batchExecute = new JdmoBatchExecute&lt;EmployeeDate&gt;(dmo) {</span>
			@Override
			public void set(Map&lt;Integer, Object&gt; param, EmployeeDate value) {
<span class="nc" id="L185">				param.put(1, value.employeeID);</span>
<span class="nc" id="L186">				param.put(2, value.date);</span>
<span class="nc" id="L187">			}</span>
		};

<span class="nc" id="L190">		batchExecute.executeBatch(&quot;insert into #EmployeeDates values (?,?)&quot;, employeeDates);</span>
<span class="nc" id="L191">	}</span>

	private void insertIntoTempEmployeeSpID(Collection&lt;EmployeeSpID&gt; employeeDates) throws JdmoException {
<span class="nc" id="L194">		DAOUtil.createTempTable(dmo, &quot;EmployeeSpID&quot;, &quot;employeeID int, spID int&quot;);</span>

<span class="nc" id="L196">		JdmoBatchExecute&lt;EmployeeSpID&gt; batchExecute = new JdmoBatchExecute&lt;EmployeeSpID&gt;(dmo) {</span>
			@Override
			public void set(Map&lt;Integer, Object&gt; param, EmployeeSpID value) {
<span class="nc" id="L199">				param.put(1, value.employeeID);</span>
<span class="nc" id="L200">				param.put(2, value.spID);</span>
<span class="nc" id="L201">			}</span>
		};

<span class="nc" id="L204">		batchExecute.executeBatch(&quot;insert into #EmployeeSpID values (?,?)&quot;, employeeDates);</span>
<span class="nc" id="L205">	}</span>

	public ReferenceScheduleAssignments getReferenceScheduleAssignmentForChoice(ID timeOffChoiceID) throws BbmFinderException {
		//@formatter:off
<span class="nc" id="L209">		String sql = &quot;select O.TIMEZONE as EmpTZ,  SPTZM.JAVATZIDENT as SpTZ, SAP.* &quot; </span>
				+ &quot;from TIMEOFFREQUESTCHOICE TOC &quot;
				+ &quot;inner join REQUEST R on TOC.TIMEOFFREQUESTID = R.ID &quot; 
				+ &quot;inner join SP on SP.SID = TOC.REFERENCESPID &quot;
				+ &quot;inner join CAMPAIGN C on C.ID = SP.CAMPAIGNID &quot;
				+ &quot;inner join TimeZone SPTZ on  SPTZ.ID = C.TIMEZONEID &quot;
				+ &quot;inner join TIMEZONEMAP SPTZM  on SPTZM.WINTZSTDNAME = SPTZ.STANDARDNAME &quot;
				+ &quot;inner join SHIFTASSIGNMENTPUB SAP on SAP.WORKRESOURCEID = R.EMPLOYEEID and SAP.SPID = TOC.REFERENCESPID &quot; 
				+ &quot;inner join WORKRESOURCEORGANIZATION EMPORG on EMPORG.WORKRESOURCEID = R.EMPLOYEEID  &quot;
				+  &quot;   and TOC.STARTTIME &gt;= EMPORG.STARTTIME and  TOC.STARTTIME &lt; isnull(EMPORG.ENDTIME,'20700101') &quot; 
				+ &quot;inner join ORGANIZATION O on O.ID = EMPORG.ORGANIZATIONID &quot;
				+ &quot;where TOC.ID = ?  &quot;; 

		//@formatter:on

		try {
<span class="nc" id="L225">			JdmoQuery query = dmo.createQuery(sql, Jdmo.PARAM_QUERY);</span>
<span class="nc" id="L226">			query.setParID(1, timeOffChoiceID);</span>

<span class="nc" id="L228">			JdmoRowset rs = dmo.createRowset(query, Jdmo.FORWARD_ONLY, Jdmo.READ_ONLY);</span>
<span class="nc" id="L229">			TimeZone empTZ = null;</span>
<span class="nc" id="L230">			TimeZone spTZ = null;</span>

<span class="nc" id="L232">			List&lt;ShiftAssignment&gt; shifts = new ArrayList&lt;ShiftAssignment&gt;();</span>

<span class="nc bnc" id="L234" title="All 2 branches missed.">			while (rs.next()) {</span>

<span class="nc bnc" id="L236" title="All 2 branches missed.">				if (empTZ == null) {</span>
<span class="nc" id="L237">					empTZ = TimeZone.getTimeZone(rs.getString(&quot;EmpTZ&quot;));</span>
<span class="nc" id="L238">					spTZ = TimeZone.getTimeZone(rs.getString(&quot;SpTZ&quot;));</span>
				}
<span class="nc" id="L240">				ShiftAssignment shift = RmScheduleUtil.shiftAssignmentFromRowset(rs);</span>
<span class="nc" id="L241">				shifts.add(shift);</span>
<span class="nc" id="L242">			}</span>

<span class="nc" id="L244">			return new ReferenceScheduleAssignments(shifts, spTZ, empTZ);</span>

<span class="nc" id="L246">		} catch (JdmoException e) {</span>
<span class="nc" id="L247">			throw new BbmFinderException(e);</span>
		}

	}
	

	/**
	 * @return ShiftAssignments (along with ShiftEventAssignment) from the specified employee's reference schedule grouped by employee id.  
	 * @throws JdmoException 
	 * @throws BbmFinderException 
	 */
	public Map&lt;EmployeeSpID, List&lt;ShiftAssignment&gt;&gt; getReferenceScheduleAssignments(Collection&lt;EmployeeSpID&gt; employeeSpIDs) throws BbmFinderException {

<span class="nc bnc" id="L260" title="All 2 branches missed.">		if (employeeSpIDs.isEmpty()) {</span>
<span class="nc" id="L261">			return Collections.emptyMap();</span>
		}

<span class="nc bnc" id="L264" title="All 2 branches missed.">		if (employeeSpIDs.size() == 1) {</span>
			//special case for singleton list for performance. 
<span class="nc" id="L266">			EmployeeSpID employeeSpID = employeeSpIDs.iterator().next();</span>
<span class="nc" id="L267">			return getReferenceScheduleAssignments(employeeSpID.employeeID, employeeSpID.spID);</span>
		}

<span class="nc" id="L270">		String sqlAssignments = &quot;select A.* from %s A inner join #EmployeeSpID EmpSP on EmpSP.SPID = A.SPID and EmpSP.employeeID = A.WORKRESOURCEID&quot;;</span>

		try {
<span class="nc" id="L273">			insertIntoTempEmployeeSpID(employeeSpIDs);</span>


			//get published shift events
<span class="nc" id="L277">			String sql = String.format(sqlAssignments, &quot;shifteventassignmentpub&quot;);</span>
<span class="nc" id="L278">			List&lt;ShiftEventAssignment&gt; shiftEvents = getShiftEvents(sql);</span>

			//get published shifts
<span class="nc" id="L281">			sql = String.format(sqlAssignments, &quot;shiftassignmentpub&quot;);</span>
<span class="nc" id="L282">			List&lt;ShiftAssignment&gt; shifts = getShifts(sql);</span>

			//associate the shift events with the shifts 
<span class="nc" id="L285">			ScheduleUtil.buildShiftAssignment(shifts, shiftEvents);</span>

<span class="nc" id="L287">			return buildMap(shifts);</span>

<span class="nc" id="L289">		} catch (JdmoException e) {</span>
<span class="nc" id="L290">			throw new BbmFinderException(e);</span>
		}
	}
	
	private Map&lt;EmployeeSpID, List&lt;ShiftAssignment&gt;&gt; getReferenceScheduleAssignments(int employeeID, int spID ) throws BbmFinderException{
		
<span class="nc" id="L296">		String sqlAssignments = &quot;select A.* from %s A where  A.WORKRESOURCEID = ? and  A.SPID = ? &quot;;</span>
		
		try {

			//get published shift events
<span class="nc" id="L301">			String sql = String.format(sqlAssignments, &quot;shifteventassignmentpub&quot;);</span>
<span class="nc" id="L302">			List&lt;ShiftEventAssignment&gt; shiftEvents = getShiftEvents(sql, employeeID, spID);</span>

			//get published shifts
<span class="nc" id="L305">			sql = String.format(sqlAssignments, &quot;shiftassignmentpub&quot;);</span>
<span class="nc" id="L306">			List&lt;ShiftAssignment&gt; shifts = getShifts(sql, employeeID, spID);</span>

			//associate the shift events with the shifts 
<span class="nc" id="L309">			ScheduleUtil.buildShiftAssignment(shifts, shiftEvents);</span>

<span class="nc" id="L311">			return buildMap(shifts);</span>

<span class="nc" id="L313">		} catch (JdmoException e) {</span>
<span class="nc" id="L314">			throw new BbmFinderException(e);</span>
		}
		
	}
	
	private List&lt;ShiftEventAssignment&gt; getShiftEvents(String sql, int employeeID, int spID) throws JdmoException {
<span class="nc" id="L320">		JdmoRowset res = JdmoPreparedStatement.createRowset(dmo, sql, employeeID, spID);</span>
<span class="nc" id="L321">		return getShiftEvents(res);</span>
	}

	private List&lt;ShiftAssignment&gt; getShifts(String sql, int employeeID, int spID) throws JdmoException {
<span class="nc" id="L325">		JdmoRowset res = JdmoPreparedStatement.createRowset(dmo, sql, employeeID, spID);</span>
<span class="nc" id="L326">		return getShifts(res);</span>
	}
	
	private static Map&lt;EmployeeSpID, List&lt;ShiftAssignment&gt;&gt; buildMap(List&lt;ShiftAssignment&gt; shifts) {

<span class="nc" id="L331">		Map&lt;EmployeeSpID, List&lt;ShiftAssignment&gt;&gt; map = new HashMap&lt;EmployeeSpID, List&lt;ShiftAssignment&gt;&gt;(shifts.size());</span>
<span class="nc bnc" id="L332" title="All 2 branches missed.">		for(ShiftAssignment shift: shifts ) {</span>
<span class="nc" id="L333">			int employeeID = shift.getWorkResourceID().toInt();</span>
<span class="nc" id="L334">			int spID = shift.getCampaignID().toInt();</span>
<span class="nc" id="L335">			EmployeeSpID key = new EmployeeSpID(employeeID, spID);</span>
<span class="nc" id="L336">			List&lt;ShiftAssignment&gt; value = map.get(key);</span>
<span class="nc bnc" id="L337" title="All 2 branches missed.">			if (value == null) {</span>
<span class="nc" id="L338">				value = new ArrayList&lt;ShiftAssignment&gt;();</span>
<span class="nc" id="L339">				map.put(key, value);</span>
			}
<span class="nc" id="L341">			value.add(shift);</span>
<span class="nc" id="L342">		}</span>
<span class="nc" id="L343">		return map;</span>
	}


	private List&lt;ShiftEventAssignment&gt; getShiftEvents(String sql) throws JdmoException {
<span class="nc" id="L348">		JdmoRowset res = dmo.createRowset(sql);</span>
<span class="nc" id="L349">		return getShiftEvents(res);</span>
	}

	private List&lt;ShiftEventAssignment&gt; getShiftEvents(JdmoRowset res) throws JdmoException {

<span class="nc" id="L354">		List&lt;ShiftEventAssignment&gt; events = new ArrayList&lt;ShiftEventAssignment&gt;();</span>

<span class="nc bnc" id="L356" title="All 2 branches missed.">		while (res.next()) {</span>
<span class="nc" id="L357">			ShiftEventAssignment event = RmScheduleUtil.shiftEventAssignmentFromRowset(res);</span>
<span class="nc" id="L358">			events.add(event);</span>
<span class="nc" id="L359">		}</span>

<span class="nc" id="L361">		return events;</span>
	}

	private List&lt;ShiftAssignment&gt; getShifts(String sql) throws JdmoException {
<span class="nc" id="L365">		JdmoRowset res = dmo.createRowset(sql);</span>
<span class="nc" id="L366">		return getShifts(res);</span>
	}

	private List&lt;ShiftAssignment&gt; getShifts(JdmoRowset res) throws JdmoException {

<span class="nc" id="L371">		List&lt;ShiftAssignment&gt; shifts = new ArrayList&lt;ShiftAssignment&gt;();</span>

<span class="nc bnc" id="L373" title="All 2 branches missed.">		while (res.next()) {</span>
<span class="nc" id="L374">			ShiftAssignment shift = RmScheduleUtil.shiftAssignmentFromRowset(res);</span>
<span class="nc" id="L375">			shifts.add(shift);</span>
<span class="nc" id="L376">		}</span>

<span class="nc" id="L378">		return shifts;</span>
	}



}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>