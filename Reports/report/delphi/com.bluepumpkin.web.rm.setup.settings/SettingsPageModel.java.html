<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>SettingsPageModel.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.rm.setup.settings</a> &gt; <span class="el_source">SettingsPageModel.java</span></div><h1>SettingsPageModel.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.rm.setup.settings;

import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collection;
import java.util.Date;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.ResourceBundle;
import java.util.TimeZone;

import javax.servlet.http.HttpServletRequest;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.StringsPair;
import com.bluepumpkin.common.localization.Localizer;
import com.bluepumpkin.common.logging.Category;
import com.bluepumpkin.common.util.StringUtil;
import com.bluepumpkin.ejb.bbm.workresource.OrganizationScopeManagerProxy;
import com.bluepumpkin.ejb.bbm.workresource.model.Organization;
import com.bluepumpkin.ejb.rm.l10n.RmSettingKey;
import com.bluepumpkin.ejb.rm.requests.timeoff.requiredpayperiodhours.RequiredPayPeriodHoursUtil;
import com.bluepumpkin.ejb.rm.setup.settings.model.OrganizationSetting;
import com.bluepumpkin.ejb.rm.util.LicenseUtil;
import com.bluepumpkin.web.bbm.l10n.BbmWebBundleKey;
import com.bluepumpkin.web.bbm.organization.OrgWorkpaneFormPageModel;
import com.bluepumpkin.web.bbm.organization.selection.OrganizationSelectorPC;
import com.bluepumpkin.web.rm.Log;
import com.bluepumpkin.web.rm.l10n.RmWebBundleKey;
import com.witness.ejb.core.security.PrivilegeKeys;
import com.witness.web.uif.base.Message;
import com.witness.web.uif.keys.JavaScriptFileID;
import com.witness.web.uif.keys.PageAction;
import com.witness.web.uif.l10n.CommonWebBundleKey;
import com.witness.web.uif.l10n.UIFWebBundleKey;
import com.witness.web.uif.pagecomponent.container.Collapsible2ColFormPC;
import com.witness.web.uif.pagecomponent.container.CollapsibleContainerPC;
import com.witness.web.uif.pagecomponent.container.ListContainerPC;
import com.witness.web.uif.pagecomponent.form.FormInputPC;
import com.witness.web.uif.pagecomponent.picker.date.DatePickerPC;
import com.witness.web.uif.pagecomponent.toolbar.ToolbarUtil;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.util.HtmlUtil;
import com.witness.web.uif.util.html.HtmlChoiceInput;
import com.witness.web.uif.util.html.HtmlDateDDUtil;
import com.witness.web.uif.util.js.JSUtil;
import com.witness.web.uif.validator.IsNonNegativeNumberFieldValidator;
import com.witness.web.uif.validator.IsPosIntegerFieldValidator;

/**
 * Title          SettingsPageModel
 * Description    Displays the Settings page
 * Copyright      Copyright (c) 2002
 * Company        Blue Pumpkin Software, Inc
 * @author        Shubhangi Chavan
 * @version       1.0
 */
public class SettingsPageModel extends OrgWorkpaneFormPageModel {
	/**
	 *
	 */
	private static final long serialVersionUID = 4005255559348081000L;

<span class="nc" id="L66">	private static final Category log =</span>
<span class="nc" id="L67">			Log.initCategory(SettingsPageModel.class.getName());</span>

	/**
	 * Set the characteristics of the ListContainerPC
	 */
	private static final String FWRAPPER = &quot;fWrapper&quot;;
	private static final String WIDTH = &quot;99%&quot;;

	//default time off calendar color
	private static final String DEFAULT_COLOR = &quot;#000000&quot;; // black

	private static final String DATE_FN  = &quot;date&quot;;





	//Time Off Management Activation Container
	private ListContainerPC m_activationContainerPC;

	//Time Off Rounding Container
	private ListContainerPC m_toOptionsContainerPC;


	//Agent Workflow Options Container
	private ListContainerPC m_workFlowContainerPC;

	//Shift Bidding Container
	private Collapsible2ColFormPC m_shiftBidContainerPC;

	//Shift Swap Container
	private ListContainerPC m_shiftSwapPC;

	//Shift Swap Org Selector
	private final OrganizationSelectorPC m_shiftSwapOrgSelectorPC;

	//Schedule Viewing Org Selector
	private final OrganizationSelectorPC m_groupViewOrgSelectorPC;

	//Time Off Accrual Container
	private ListContainerPC m_toYearContainerPC;

	//Time Off Calendar Colors Container
	private ColorGenericPC m_calendarColorPC;

	//Flex Time Container
	private ListContainerPC flexTimeContainerPC;

	//Custom Shift Container
	private ListContainerPC m_customShiftContainerPC;

	private final HtmlChoiceInput m_choiceInput;
	private final FormInputPC m_formInputPC;


	//Required Pay Period Hours
	private ListContainerPC requiredPayPeriodHoursContainerPC;
	private final DatePickerPC    datePickerPC;

	//Policy Containers
<span class="nc" id="L127">	private final Map&lt;String, CollapsibleContainerPC&gt; m_settingsPolicyContainerMap =</span>
			new HashMap&lt;String, CollapsibleContainerPC&gt;(5);
	private static final String POLICY_CONTAINER = &quot;policyContainer&quot;;
	public static final String TO_POLICY=&quot;TO_POLICY&quot;;
	public static final String SB_POLICY=&quot;SB_POLICY&quot;;
	public static final String SS_POLICY=&quot;SS_POLICY&quot;;
	public static final String CS_POLICY=&quot;CS_POLICY&quot;;
	public static final String FT_POLICY=&quot;FT_POLICY&quot;;

	public static final int TO_POLICY_INDEX = 0;
	public static final int SS_POLICY_INDEX = 1;
	public static final int SB_POLICY_INDEX = 2;
	public static final int CS_POLICY_INDEX = 3;
	public static final int FT_POLICY_INDEX = 4;

	private final ResourceBundle m_rmBundle;
	//Settings and inheritance variables
	private OrganizationSetting m_settings; //the settings for the selected org (includes inheritted settings)
    private Map m_ancestors; //maps each inheritted key to the ancestor orgName from which it was inheritted
<span class="nc" id="L146">    private boolean m_hasChildren = false; //tells us whether the current org has any children.</span>
    static final String _1MINUTE = &quot;1&quot;;
    static final String _15MINUTE = &quot;15&quot;;
    static final String HOUR = &quot;60&quot;;
    static final String DAY = &quot;1440&quot;;


	/**
	 * Constructor
	 */
	public SettingsPageModel(RequestContext context) {
<span class="nc" id="L157">		super(context);</span>

<span class="nc" id="L159">		m_rmBundle = m_localizer.getBundle(RmWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L160">		m_localizer.getBundle(UIFWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L161">		m_formInputPC = new FormInputPC(context);</span>
<span class="nc" id="L162">		addChildComponent(m_formInputPC);</span>


<span class="nc" id="L165">		datePickerPC = new DatePickerPC(m_context, DATE_FN);</span>
<span class="nc" id="L166">		datePickerPC.setIsTimeEnabled(false);</span>
<span class="nc" id="L167">		datePickerPC.setTimeZone(TimeZone.getTimeZone(&quot;GMT&quot;));</span>





		// Component specific required JavaScript Files
<span class="nc" id="L174">		addRequiredJavaScriptFile(JavaScriptFileID.MEDIATOR_WORKPANE);</span>
<span class="nc" id="L175">		setJSMediator(JavaScriptFileID.MEDIATOR_WORKPANE_GENERIC);</span>

<span class="nc" id="L177">		addRequiredJavaScriptFile(JavaScriptFileID.MODULE_POPUPBUTTON);</span>
<span class="nc" id="L178">		addRequiredJavaScriptFile(JavaScriptFileID.MEDIATOR_DIALOG);</span>
<span class="nc" id="L179">		addRequiredJavaScriptFile(JavaScriptFileID.MODULE_DIALOGBOX);</span>
<span class="nc" id="L180">		addRequiredJavaScriptFile(JavaScriptFileID.DIALOG_PICKERS);</span>
<span class="nc" id="L181">		addRequiredJavaScriptFile(JavaScriptFileID.JQUERY);</span>

<span class="nc" id="L183">		m_toolbar.setName(getName() + &quot;_toolbar&quot;);</span>
<span class="nc" id="L184">		m_shiftSwapOrgSelectorPC = createAndAddOrgSelectorPC(&quot;shiftSwapOrgSelectorPC&quot;);</span>
<span class="nc" id="L185">		m_groupViewOrgSelectorPC = createAndAddOrgSelectorPC(&quot;groupViewOrgSelectorPC&quot;);</span>
<span class="nc" id="L186">		m_choiceInput = new HtmlChoiceInput();</span>
<span class="nc" id="L187">	}</span>

	/**
	 * Create and Add OrganizationSelectorPC
	 *
	 * @param name - The Component Name
	 * @return OrganizationSelectorPC
	 */
	private OrganizationSelectorPC createAndAddOrgSelectorPC(String name) {
<span class="nc" id="L196">		OrganizationSelectorPC orgSelPC =</span>
				new OrganizationSelectorPC(m_context, m_toolbar);
<span class="nc" id="L198">		orgSelPC.setName(name);</span>
<span class="nc" id="L199">		addChildComponent(orgSelPC);</span>
<span class="nc" id="L200">		return orgSelPC;</span>
	}

	/**
	 * Return an instance of SettingsPageModel ready to be rendered in JSP
	 * @param   context RequestContext
	 * @return  SettingsPageModel  instance of SettingsPageModel
	 */
	public static SettingsPageModel getInstance(RequestContext context) {
<span class="nc" id="L209">		return (SettingsPageModel)getInstance(context, SettingsPageModel.class);</span>
	}

	/**
	 * Initialize the Toolbar
	 * Adds the Save and Revert button
	 */
	@Override
	protected void initToolbar() {
<span class="nc" id="L218">		m_toolbar.setName(getName() + &quot;_toolbar&quot;);</span>
<span class="nc" id="L219">		boolean isBtnEnabled = isAuthorizedToConfigure();</span>

        //Add &quot;Save&quot; button
<span class="nc" id="L222">        ToolbarUtil.addValidateSaveBtn(m_toolbar, isBtnEnabled); //CONFIRM_SUBMIT_TYPE</span>

        //Add &quot;Save and apply to sub-orgs&quot; button. When user clicks it, it will pop-up a JavaScript confirmation message.
<span class="nc" id="L225">        addJSVariable(&quot;CONFIRM_SAVE_AND_APPLY_MSG&quot;, m_rmBundle, RmWebBundleKey.ORG_RM_SETTINGS_CONFIRM_SAVE_AND_APPLY);</span>
<span class="nc" id="L226">        String lbl = i18n(m_rmBundle, CommonWebBundleKey.BUTTON_SAVE_APPLY_TO_SUB_ORGS);</span>
<span class="nc bnc" id="L227" title="All 4 branches missed.">        m_toolbar.addConfirmSubmitTextButton(PageAction.SAVE_AS, lbl, isBtnEnabled&amp;&amp;hasChildOrgs(), &quot;CONFIRM_SAVE_AND_APPLY_MSG&quot;);</span>

        //Add &quot;Revert&quot; button
<span class="nc" id="L230">		ToolbarUtil.addResetBtn(m_toolbar, isBtnEnabled);</span>
<span class="nc" id="L231">	}</span>

	/**
	 * Return the form title
	 * @return form title
	 */
	@Override
	public String getFormTitle() {
<span class="nc" id="L239">		return &quot;&quot;;</span>

	}

	@Override
	public String getJavaScriptInitCode(){
<span class="nc" id="L245">		return super.getJavaScriptInitCode();</span>

	}

	/**
	 * Gets entity name. Used for title.
	 * @return String Identifies the title entity
	 */
	@Override
	protected String getTitleEntityType() {
<span class="nc" id="L255">		return getEntityName();</span>
	}

	/**
	 * Returns an entity name. Used for title.
	 * @return String Identifies the entity name
	 */
	@Override
	protected String getEntityName() {
<span class="nc" id="L264">		return i18n(m_rmBundle, RmWebBundleKey.ORG_RM_SETTINGS_LABEL);</span>
	}

	/**
	 * Return URL for HTML Form Action
	 */
	@Override
	public String getFormAction() {
<span class="nc" id="L272">		return &quot;request_processing_settings&quot;;</span>
	}

	/**
	 * Create Form Model, loads the Settings data
	 */
	@Override
	protected void createFormModel() {
		try {
<span class="nc" id="L281">			ID selectedOrgID = getSelectedIDObject();</span>
<span class="nc bnc" id="L282" title="All 2 branches missed.">			if (selectedOrgID != null) {</span>
<span class="nc" id="L283">				m_settings = SettingsModelHandler.getSettings(selectedOrgID);</span>
<span class="nc" id="L284">				m_ancestors = m_settings.getAncestors();</span>
<span class="nc" id="L285">				m_hasChildren = SettingsModelHandler.getHasChildren(m_context, selectedOrgID);</span>
			} else {
<span class="nc" id="L287">				m_settings = new OrganizationSetting(new HashMap());</span>
			}
<span class="nc bnc" id="L289" title="All 2 branches missed.">			if (!isAuthorizedToConfigure()) {</span>
				String key;
<span class="nc" id="L291">				key = BbmWebBundleKey.NOT_AUTHORIZED_TO_CONFIG_SELECTED_ORG;</span>
<span class="nc" id="L292">				String msg = i18n(m_bbmBundle, key);</span>
<span class="nc" id="L293">				addPageMessage(Message.RESPONSE_TYPE, msg);</span>
			}
<span class="nc" id="L295">            m_workFlowContainerPC = new ListContainerPC(m_context);</span>
<span class="nc" id="L296">			m_activationContainerPC = new ListContainerPC(m_context);</span>
<span class="nc" id="L297">			m_toOptionsContainerPC = new ListContainerPC(m_context);</span>
<span class="nc" id="L298">			m_toYearContainerPC = new ListContainerPC(m_context);</span>
<span class="nc" id="L299">			m_calendarColorPC = new ColorGenericPC(m_context);</span>
<span class="nc" id="L300">			m_shiftBidContainerPC = new Collapsible2ColFormPC(m_context);</span>
<span class="nc" id="L301">			m_shiftSwapPC = new ListContainerPC(m_context);</span>
<span class="nc" id="L302">			m_customShiftContainerPC = new ListContainerPC(m_context);</span>
<span class="nc" id="L303">			flexTimeContainerPC = new ListContainerPC(m_context);</span>
<span class="nc" id="L304">			requiredPayPeriodHoursContainerPC = new ListContainerPC(m_context);</span>

<span class="nc" id="L306">		} catch (Exception ex) {</span>
<span class="nc" id="L307">			handleUnableToLoadDataError(log, ex);</span>
<span class="nc" id="L308">		}</span>
<span class="nc" id="L309">	}</span>

	public OrganizationSetting getConfiguration() {
<span class="nc" id="L312">		return m_settings;</span>
	}

	public void setConfiguration(OrganizationSetting setting) {
<span class="nc" id="L316">		m_settings = setting;</span>
<span class="nc" id="L317">	}</span>

	public String getGroupViewOrgIDs() {
<span class="nc" id="L320">		return m_groupViewOrgSelectorPC.getSelectedIDs();</span>
	}

	public String getShiftSwapOrgIDs() {
<span class="nc" id="L324">		return m_shiftSwapOrgSelectorPC.getSelectedIDs();</span>
	}

	/**
	 * Initialize Form Display, sets the form elements
	 */
	@Override
	protected void initForm() {
<span class="nc bnc" id="L332" title="All 2 branches missed.">		if (getSelectedIDObject() != null) {</span>
<span class="nc bnc" id="L333" title="All 2 branches missed.">			if (m_settings == null) {</span>
<span class="nc" id="L334">				createFormModel();</span>
			}
<span class="nc bnc" id="L336" title="All 2 branches missed.">			if (m_settings != null) {</span>

				//NOTE: Whenever adding or removing a container, you must also update settings.jsp.

<span class="nc" id="L340">				createWorkFlowForm();</span>
<span class="nc bnc" id="L341" title="All 2 branches missed.">				if (LicenseUtil.isAdvancedRMLicense()) {</span>
<span class="nc" id="L342">					createRequiredPayPeriodHoursForm();</span>
				}
<span class="nc" id="L344">				createTimeOffActivationForm();</span>
<span class="nc" id="L345">				createTimeOfOptionsForm();</span>
<span class="nc" id="L346">				createTimeOffYearForm();</span>
<span class="nc" id="L347">				createCalendarColorForm();</span>
<span class="nc" id="L348">				createTOPoliciesForm();</span>

<span class="nc bnc" id="L350" title="All 2 branches missed.">				if (LicenseUtil.isAdvancedRMLicense()) {</span>
<span class="nc" id="L351">					createFlexTimeForm();</span>
<span class="nc" id="L352">					createFTPoliciesForm();</span>
				}

<span class="nc" id="L355">				createShiftBidForm();</span>
<span class="nc" id="L356">				createSBPoliciesForm();</span>

<span class="nc" id="L358">				createShiftSwapForm();</span>
<span class="nc" id="L359">				createSSPoliciesForm();</span>

<span class="nc" id="L361">				createCustomShiftForm();</span>
<span class="nc" id="L362">				createCSPoliciesForm();</span>
			}
		}
<span class="nc" id="L365">	}</span>


	/**
	 * Creates the Flex Time Form
	 */
	private void createFlexTimeForm() {

<span class="nc" id="L373">		flexTimeContainerPC.setWidth(WIDTH);</span>
<span class="nc" id="L374">		flexTimeContainerPC.setWrapperCSSClass(FWRAPPER);</span>
<span class="nc" id="L375">		flexTimeContainerPC.setLastRowType(ListContainerPC.LAST_ROW_NONE);</span>
<span class="nc bnc" id="L376" title="All 2 branches missed.">		boolean disabled = !isAuthorizedToConfigureFlexTime();</span>
<span class="nc" id="L377">		String ancestor = null;</span>
<span class="nc" id="L378">		addJSVariable(&quot;ORG_RM_SETTINGS_FT_MUST_ENABLE_AT_LEAST_ONE_MAKEUP&quot;, m_rmBundle, RmWebBundleKey.ORG_RM_SETTINGS_FT_MUST_ENABLE_AT_LEAST_ONE_MAKEUP);</span>

		//Allow makeup extensions before shift
<span class="nc" id="L381">		String nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_ALLOW_MAKEUP_BEFORE_SHIFT);</span>
<span class="nc" id="L382">		String key = RmWebBundleKey.ORG_RM_SETTINGS_ALLOW_MAKEUP_BEFORE_SHIFT;</span>
<span class="nc" id="L383">		boolean checked = m_settings.getAllowMakeupBeforeShift();</span>
<span class="nc" id="L384">		String checkbox = makeChoiceInput(nameKey, &quot;true&quot;, checked, disabled, true);</span>
<span class="nc" id="L385">		String label = i18n(m_rmBundle, key);</span>
<span class="nc" id="L386">		flexTimeContainerPC.addRowData(checkbox + HtmlUtil.NBSP + label);</span>
<span class="nc bnc" id="L387" title="All 2 branches missed.">		ancestor = (ancestor != null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_ALLOW_MAKEUP_BEFORE_SHIFT);</span>

		//Allow makeup extensions after shift
<span class="nc" id="L390">		nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_ALLOW_MAKEUP_AFTER_SHIFT);</span>
<span class="nc" id="L391">		key = RmWebBundleKey.ORG_RM_SETTINGS_ALLOW_MAKEUP_AFTER_SHIFT;</span>
<span class="nc" id="L392">		checked = m_settings.getAllowMakeupAfterShift();</span>
<span class="nc" id="L393">		checkbox = makeChoiceInput(nameKey, &quot;true&quot;, checked, disabled, true);</span>
<span class="nc" id="L394">		label = i18n(m_rmBundle, key);</span>
<span class="nc" id="L395">		flexTimeContainerPC.addRowData(checkbox + HtmlUtil.NBSP  + label);</span>
<span class="nc bnc" id="L396" title="All 2 branches missed.">		ancestor = (ancestor != null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_ALLOW_MAKEUP_AFTER_SHIFT);</span>

		//Allow makeup in gaps
<span class="nc" id="L399">		nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_ALLOW_MAKEUP_IN_GAP);</span>
<span class="nc" id="L400">		key = RmWebBundleKey.ORG_RM_SETTINGS_ALLOW_MAKEUP_IN_GAP;</span>
<span class="nc" id="L401">		checked = m_settings.getAllowMakeupInGap();</span>
<span class="nc" id="L402">		checkbox = makeChoiceInput(nameKey, &quot;true&quot;, checked, disabled, true);</span>
<span class="nc" id="L403">		label = i18n(m_rmBundle, key);</span>
<span class="nc" id="L404">		flexTimeContainerPC.addRowData(checkbox + &quot; &amp;nbsp; &quot; + label);</span>
<span class="nc bnc" id="L405" title="All 2 branches missed.">		ancestor = (ancestor != null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_ALLOW_MAKEUP_IN_GAP);</span>

		//Limit time off request to beginning of shift block
<span class="nc" id="L408">		nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_LIMIT_FLEX_TIMEOFF_TO_START_SHIFT_BLOCK);</span>
<span class="nc" id="L409">		key = RmWebBundleKey.ORG_RM_SETTINGS_LIMIT_FLEX_TIMEOFF_TO_START_SHIFT_BLOCK;</span>
<span class="nc" id="L410">		checked = m_settings.getLimitFlexTimeOffToStartOfShiftBlock();</span>
<span class="nc" id="L411">		checkbox = makeChoiceInput(nameKey, &quot;true&quot;, checked, disabled, true);</span>
<span class="nc" id="L412">		label = i18n(m_rmBundle, key);</span>
<span class="nc" id="L413">		flexTimeContainerPC.addRowData(checkbox + &quot; &amp;nbsp; &quot; + label);</span>
<span class="nc bnc" id="L414" title="All 2 branches missed.">		ancestor = (ancestor != null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_LIMIT_FLEX_TIMEOFF_TO_START_SHIFT_BLOCK);</span>

		//Allow consecutive flex requests
<span class="nc" id="L417">		nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_ALLOW_CONSEC_FLEX);</span>
<span class="nc" id="L418">		key = RmWebBundleKey.ORG_RM_SETTINGS_ALLOW_CONSEC_FLEX;</span>
<span class="nc" id="L419">		checked = m_settings.getAllowConsecutiveFlex();</span>
<span class="nc" id="L420">		checkbox = makeChoiceInput(nameKey, &quot;true&quot;, checked, disabled, true);</span>
<span class="nc" id="L421">		label = i18n(m_rmBundle, key);</span>
<span class="nc" id="L422">		flexTimeContainerPC.addRowData(checkbox + &quot; &amp;nbsp; &quot; + label);</span>
<span class="nc bnc" id="L423" title="All 2 branches missed.">		ancestor = (ancestor != null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_ALLOW_CONSEC_FLEX);</span>

<span class="nc" id="L425">		flexTimeContainerPC.setTitle(getSectionTitle(i18n(m_rmBundle, RmWebBundleKey.REQUEST_TYPE_FLEX_TIME), ancestor));</span>

		// Add the Workflow Form
<span class="nc" id="L428">		addChildComponent(flexTimeContainerPC);</span>
<span class="nc" id="L429">	}</span>

	/**
	 * Creates the Activation Form
	 */
	private void createTimeOffActivationForm() {

<span class="nc" id="L436">		m_activationContainerPC.setWidth(WIDTH);</span>
<span class="nc" id="L437">		m_activationContainerPC.setWrapperCSSClass(FWRAPPER);</span>
<span class="nc" id="L438">		m_activationContainerPC.setLastRowType(ListContainerPC.LAST_ROW_NONE);</span>
<span class="nc bnc" id="L439" title="All 2 branches missed.">		boolean disabled = !isAuthorizedToConfigureTOMWorkflow();</span>
<span class="nc" id="L440">		String ancestor = null;</span>

		{
			//Activate Manager Workflow
<span class="nc" id="L444">			String nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_PROCESS_VACATION_REQUEST);</span>
<span class="nc" id="L445">			String key = RmWebBundleKey.ORG_RM_SETTINGS_ACTIVATE_MANAGER_ACTION;</span>
<span class="nc" id="L446">			boolean checked = m_settings.getManagerTimeOffWorkflowActive();</span>
<span class="nc" id="L447">			String checkbox = makeChoiceInput(nameKey, &quot;true&quot;, checked, disabled, true);</span>
<span class="nc" id="L448">			String label = i18n(m_rmBundle, key);</span>
<span class="nc" id="L449">			m_activationContainerPC.addRowData(checkbox + &quot; &quot; + label);</span>
<span class="nc bnc" id="L450" title="All 2 branches missed.">			ancestor = (ancestor != null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_PROCESS_VACATION_REQUEST);</span>
		}

		{
			//Activate Agent Workflow
<span class="nc" id="L455">			String nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_REQUEST_VACATION);</span>
<span class="nc" id="L456">			String key = RmWebBundleKey.ORG_RM_SETTINGS_ACTIVATE_AGENT_ACTION;</span>
<span class="nc" id="L457">			boolean checked = m_settings.getAgentTimeOffWorkflowActive();</span>
<span class="nc" id="L458">			String checkbox = makeChoiceInput(nameKey, &quot;true&quot;, checked, disabled, true);</span>
<span class="nc" id="L459">			String label = i18n(m_rmBundle, key);</span>
<span class="nc" id="L460">			m_activationContainerPC.addRowData(checkbox + &quot; &quot; + label);</span>
<span class="nc bnc" id="L461" title="All 2 branches missed.">			ancestor = (ancestor != null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_REQUEST_VACATION);</span>
		}

<span class="nc" id="L464">		m_activationContainerPC.setTitle(getSectionTitle(i18n(m_rmBundle,</span>
		        RmWebBundleKey.ORG_RM_SETTINGS_TO_ACTIVATION_TITLE), ancestor));

		// Add the Workflow Form
<span class="nc" id="L468">		addChildComponent(m_activationContainerPC);</span>
<span class="nc" id="L469">	}</span>



	/**
	 * Creates the TimeOfOptionsForm, 15.1.1, tpham
	 */
	private void createTimeOfOptionsForm(){
<span class="nc" id="L477">		m_toOptionsContainerPC.setWidth(WIDTH);</span>
<span class="nc" id="L478">		m_toOptionsContainerPC.setWrapperCSSClass(FWRAPPER);</span>
<span class="nc" id="L479">		m_toOptionsContainerPC.setLastRowType(ListContainerPC.LAST_ROW_NONE);</span>
<span class="nc" id="L480">		String ancestor = null;</span>
<span class="nc bnc" id="L481" title="All 2 branches missed.">		boolean disabled = !isAuthorizedToConfigureTORequestOptions();</span>
<span class="nc" id="L482">        String nameKey = getNameKey(RmSettingKey.ORG_RM_TIME_OFF_TIME_INTERVAL);</span>


<span class="nc" id="L485">        int valueRounding = m_settings.getTimeOffRoundingOption(); //Default</span>
<span class="nc" id="L486">		Collection&lt;StringsPair&gt; roundingOptions = getTimeOffRoundingOptionPairs(m_localizer);</span>
        //Round Options
<span class="nc" id="L488">        String roundingSelector = HtmlUtil.makeSelectInput(nameKey,</span>
<span class="nc" id="L489">		        new String[]{Integer.toString(valueRounding)},</span>
<span class="nc bnc" id="L490" title="All 2 branches missed.">		        getOnChangeJS(), roundingOptions, false, !disabled);</span>
<span class="nc" id="L491">		String roundingLabel = i18n(RmWebBundleKey.TIMEOFF_ROUNDING_OPTIONS);</span>
<span class="nc" id="L492">		m_toOptionsContainerPC.addRowData(roundingLabel + &quot; &quot; + roundingSelector);</span>
<span class="nc bnc" id="L493" title="All 2 branches missed.">		ancestor = (ancestor != null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_TIME_OFF_TIME_INTERVAL);</span>

        {
        	//Maximum Allowed Time Off Choice(s) Per Request
<span class="nc" id="L497">			nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_TIME_OFF_CHOICES_COUNT);</span>
<span class="nc" id="L498">			int value = m_settings.getTimeOffChoicesCount();</span>
<span class="nc" id="L499">			Collection options = new ArrayList();</span>
<span class="nc bnc" id="L500" title="All 2 branches missed.">			for (int i = 1; i &lt;= OrganizationSetting.MAX_TIME_OFF_CHOICES_COUNT; i++) {</span>
<span class="nc" id="L501">				String temp = Integer.toString(i);</span>
<span class="nc" id="L502">				options.add(new StringsPair(temp, temp));</span>
			}
<span class="nc" id="L504">			String selector = HtmlUtil.makeSelectInput(nameKey,</span>
<span class="nc" id="L505">			        new String[]{Integer.toString(value)},</span>
<span class="nc bnc" id="L506" title="All 2 branches missed.">			        getOnChangeJS(), options, false, !disabled);</span>
<span class="nc" id="L507">			String label = i18n(m_rmBundle, RmWebBundleKey.ORG_RM_SETTINGS_TIME_OFF_CHOICES_COUNT);</span>
<span class="nc" id="L508">			m_toOptionsContainerPC.addRowData(label + &quot; &quot; + selector);</span>
<span class="nc bnc" id="L509" title="All 2 branches missed.">			ancestor = (ancestor != null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_TIME_OFF_CHOICES_COUNT);</span>
		}
<span class="nc bnc" id="L511" title="All 2 branches missed.">        if( LicenseUtil.isAdvancedRMLicense())</span>
        //Allow Time Off Bid requests to be copied
        {
<span class="nc" id="L514">        	nameKey = getNameKey(RmSettingKey.ORG_RM_ALLOW_COPY_TIME_OFF_BID_REQUEST);</span>
<span class="nc" id="L515">			boolean checked = m_settings.getAllowCopyTimeOffBidRequest();</span>
<span class="nc" id="L516">			String checkbox = makeChoiceInput(nameKey, &quot;true&quot;, checked, disabled, true);</span>
<span class="nc" id="L517">			m_toOptionsContainerPC.addRowData(checkbox + &quot; &quot; + i18n(RmWebBundleKey.ALLOW_COPY_TOB_REQUEST));</span>
<span class="nc bnc" id="L518" title="All 2 branches missed.">			ancestor = (ancestor != null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_ALLOW_COPY_TIME_OFF_BID_REQUEST);</span>
        }
<span class="nc" id="L520">        m_toOptionsContainerPC.setTitle(getSectionTitle(i18n(RmWebBundleKey.TIMEOFF_REQUEST_OPTIONS), ancestor));</span>
<span class="nc" id="L521">	        addChildComponent(m_toOptionsContainerPC);</span>
<span class="nc" id="L522">	}</span>

	private String i18n(String key) {
<span class="nc" id="L525">		return i18n(m_rmBundle, key);</span>
	}


	/**
	 * Creates the WorkFlow Form
	 */
	private void createWorkFlowForm() {

<span class="nc" id="L534">		m_workFlowContainerPC.setWidth(WIDTH);</span>
<span class="nc" id="L535">		m_workFlowContainerPC.setWrapperCSSClass(FWRAPPER);</span>
<span class="nc" id="L536">		m_workFlowContainerPC.setLastRowType(ListContainerPC.LAST_ROW_NONE);</span>
<span class="nc" id="L537">        String ancestor = null;</span>

        //TODO:  The &quot;allow escalation of denied requests&quot; and &quot;show auto processing rules to employees&quot; checkboxes
        //should probably be removed from this screen.  When they were added (a long time ago) there were only time off
        //requests available.  Now there are at least 4 types of requests where these settings can apply (shift bidding,
        //shift swapping, shift requests, time off requests).  Escalations and autoprocessing for these types of requests
        //are each controlled by individual privileges for each of these request types, and so these checkboxes here are
        //somewhat redundant and confusing.  It's not clear from the UI which requests these checkboxes apply to, and they
        //are controlled with finer granularity by privileges anyways.

		// Fetch the workflow options
		{
<span class="nc" id="L549">			String nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_ALLOW_ESCALATION);</span>
<span class="nc" id="L550">			String key = RmWebBundleKey.ORG_RM_SETTINGS_ALLOW_ESCALATION;</span>
<span class="nc" id="L551">			boolean checked = m_settings.getAllowAgentEscalations();</span>
<span class="nc" id="L552">			String checkbox = makeChoiceInput(nameKey, &quot;true&quot;, checked, false, true);</span>
<span class="nc" id="L553">			String label = i18n(m_rmBundle,key);</span>
<span class="nc" id="L554">			m_workFlowContainerPC.addRowData(checkbox +&quot; &quot;+label);</span>
<span class="nc bnc" id="L555" title="All 2 branches missed.">            ancestor = (ancestor!=null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_ALLOW_ESCALATION);</span>
		}
		{
<span class="nc" id="L558">			String nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_SHOW_AUTOPROCESSING_RULES);</span>
<span class="nc" id="L559">			String key = RmWebBundleKey.ORG_RM_SETTINGS_SHOW_AUTOPROCESSING_RULES;</span>
<span class="nc" id="L560">			boolean checked = m_settings.getAllowAgentsViewAutoProcessingRules();</span>
<span class="nc" id="L561">			String checkbox = makeChoiceInput(nameKey, &quot;true&quot;, checked, false, true);</span>
<span class="nc" id="L562">			String label = i18n(m_rmBundle,key);</span>
<span class="nc" id="L563">			m_workFlowContainerPC.addRowData(checkbox +&quot; &quot;+label);</span>
<span class="nc bnc" id="L564" title="All 2 branches missed.">            ancestor = (ancestor!=null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_SHOW_AUTOPROCESSING_RULES);</span>
		}
		{
<span class="nc" id="L567">			String key = RmWebBundleKey.ORG_RM_SETTINGS_GROUP_VIEW_ORG_LIST;</span>
<span class="nc" id="L568">			String orgList =m_settings.getGroupViewOrgList();</span>

<span class="nc" id="L570">			Collection orgIdCollection = null;</span>
<span class="nc bnc" id="L571" title="All 2 branches missed.">			if (!StringUtil.isEmpty(orgList)) {</span>
<span class="nc" id="L572">				ID ids[] = StringUtil.parseIDString(orgList);</span>
<span class="nc bnc" id="L573" title="All 4 branches missed.">				if (ids != null &amp;&amp; ids.length != 0) {</span>
<span class="nc" id="L574">					orgIdCollection = Arrays.asList(ids);</span>
				}
			}

<span class="nc bnc" id="L578" title="All 2 branches missed.">			if (orgIdCollection != null) {</span>
				try {
<span class="nc" id="L580">					m_groupViewOrgSelectorPC.initIDs( orgIdCollection );</span>
<span class="nc" id="L581">				}	catch (Exception e) {</span>
<span class="nc" id="L582">					log.error(&quot;&quot;, e);</span>
<span class="nc" id="L583">				}</span>
			}

<span class="nc" id="L586">			String label = i18n(m_rmBundle, key);</span>
<span class="nc" id="L587">			m_workFlowContainerPC.addRowData(label+&quot; &quot;+m_groupViewOrgSelectorPC);</span>

<span class="nc bnc" id="L589" title="All 2 branches missed.">            ancestor = (ancestor!=null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_GROUP_VIEW_ORG_LIST);</span>
		}

<span class="nc" id="L592">        m_workFlowContainerPC.setTitle(getSectionTitle(i18n(m_rmBundle,</span>
                RmWebBundleKey.ORG_RM_SETTINGS_AGENT_WORKFLOW_TITLE), ancestor));

		// Add the Workflow Form
<span class="nc" id="L596">		addChildComponent(m_workFlowContainerPC);</span>
<span class="nc" id="L597">	}</span>

	private String getNumberInput(String name, String value, String desc, int type, boolean isEnabled, boolean isRequired) {
<span class="nc" id="L600">		m_formInputPC.reset();</span>
<span class="nc" id="L601">		m_formInputPC.setInputType(type);</span>
<span class="nc" id="L602">		m_formInputPC.setInputFN(name);</span>
<span class="nc" id="L603">		m_formInputPC.setInputValue(value);</span>
<span class="nc" id="L604">		m_formInputPC.setInputFieldDesc(desc);</span>
<span class="nc bnc" id="L605" title="All 2 branches missed.">		m_formInputPC.setIsReadOnly(!isEnabled);</span>
<span class="nc" id="L606">		m_formInputPC.setIsRequired(isRequired);</span>

<span class="nc" id="L608">		return m_formInputPC.getHtmlDisplay();</span>
	}

	/**
	 * Creates the WorkFlow Form
	 */
	private void createShiftBidForm() {

<span class="nc" id="L616">        m_shiftBidContainerPC.setWidth(WIDTH);</span>
<span class="nc" id="L617">		boolean enabled = isAuthorizedToConfigureShiftBid();</span>
		//90278- Null pointer exceptions occur when they try to empty the shiftbidding options
		// So making this required also when it is enabled.
<span class="nc" id="L620">		boolean required = enabled;</span>
<span class="nc" id="L621">        String ancestor = null;</span>

		// Fetch the shiftBid options
		{
<span class="nc" id="L625">			String nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_MAX_PREFERENCE_VALUE);</span>
<span class="nc" id="L626">			String key = RmWebBundleKey.ORG_RM_SETTINGS_MAX_PREFERENCE_VALUE;</span>
<span class="nc" id="L627">			int amount  = m_settings.getShiftBidMaxPref();</span>
<span class="nc" id="L628">			String label = i18n(m_rmBundle,key);</span>
<span class="nc" id="L629">			String editor   = getNumberInput(nameKey, Integer.toString(amount), label, FormInputPC.TYPE_INTEGER, enabled,required);</span>
<span class="nc" id="L630">			m_shiftBidContainerPC.addRow(label, editor);</span>
<span class="nc bnc" id="L631" title="All 2 branches missed.">            ancestor = (ancestor!=null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_MAX_PREFERENCE_VALUE);</span>
		}
<span class="nc bnc" id="L633" title="All 2 branches missed.">		if( LicenseUtil.isAdvancedRMLicense()) {</span>
			//Enforce Bid Preference to be unique
<span class="nc bnc" id="L635" title="All 2 branches missed.">			boolean disabled = !isAuthorizedToConfigureShiftBid();</span>
<span class="nc" id="L636">			String nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_ENFORCE_UNIQUE_PREFERENCE);</span>
<span class="nc" id="L637">			String key = RmWebBundleKey.ORG_RM_SETTINGS_ENFORCE_UNIQUE_PREFERENCES;</span>
<span class="nc" id="L638">			boolean checked = m_settings.getEnforceUniquePreferences();</span>
<span class="nc" id="L639">			String checkbox = makeChoiceInput(nameKey, &quot;true&quot;, checked, disabled, true);</span>
<span class="nc" id="L640">			String label = i18n(m_rmBundle, key);</span>
<span class="nc" id="L641">			m_shiftBidContainerPC.addRow(label, checkbox);</span>
<span class="nc bnc" id="L642" title="All 2 branches missed.">			ancestor = (ancestor != null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_ENFORCE_UNIQUE_PREFERENCE);</span>
		}
		{
<span class="nc" id="L645">			String nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_MAX_BIDS_PER_EMPLOYEE);</span>
<span class="nc" id="L646">			String key = RmWebBundleKey.ORG_RM_SETTINGS_MAX_BIDS_PER_EMPLOYEE;</span>
<span class="nc" id="L647">			int amount  = m_settings.getShiftBidMaxBidsPerEmployee();</span>
<span class="nc" id="L648">			String label = i18n(m_rmBundle,key);</span>
<span class="nc" id="L649">			String editor = getNumberInput(nameKey, Integer.toString(amount), label, FormInputPC.TYPE_INTEGER, enabled, required);</span>
<span class="nc" id="L650">			m_shiftBidContainerPC.addRow(label, editor);</span>
<span class="nc bnc" id="L651" title="All 2 branches missed.">            ancestor = (ancestor!=null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_MAX_BIDS_PER_EMPLOYEE);</span>
		}
		{
<span class="nc" id="L654">			String key = RmWebBundleKey.ORG_RM_SETTINGS_SHIFT_FACTOR_MESSAGE;</span>
<span class="nc" id="L655">			String message = i18n(m_rmBundle,key);</span>
<span class="nc" id="L656">			m_shiftBidContainerPC.addMessageRow(message);</span>
		}
		{
<span class="nc" id="L659">			String nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_SENIORITY_FACTOR);</span>
<span class="nc" id="L660">			String key1 = RmWebBundleKey.ORG_RM_SETTINGS_SENIORITY_FACTOR;</span>
<span class="nc" id="L661">			String key2 = RmWebBundleKey.ORG_RM_SETTINGS_SENIORITY_FACTOR_SUFFIX;</span>
<span class="nc" id="L662">			float factor  = m_settings.getShiftBidSeniorityFactor();</span>
<span class="nc" id="L663">			String label = i18n(m_rmBundle,key1);</span>
<span class="nc" id="L664">			String suffix = i18n(m_rmBundle,key2);</span>
<span class="nc" id="L665">			String editor = getNumberInput(nameKey, Float.toString(factor), label, FormInputPC.TYPE_NUMERIC, enabled, required);</span>
<span class="nc" id="L666">			m_shiftBidContainerPC.addRow(label, editor + suffix);</span>
<span class="nc bnc" id="L667" title="All 2 branches missed.">            ancestor = (ancestor!=null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_SENIORITY_FACTOR);</span>
		}

		{
<span class="nc" id="L671">			String nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_RANK_FACTOR);</span>
<span class="nc" id="L672">			String key1 = RmWebBundleKey.ORG_RM_SETTINGS_RANK_FACTOR;</span>
<span class="nc" id="L673">			String key2 = RmWebBundleKey.ORG_RM_SETTINGS_RANK_FACTOR_SUFFIX;</span>
<span class="nc" id="L674">			float factor  = m_settings.getShiftBidRankFactor();</span>
<span class="nc" id="L675">			String label = i18n(m_rmBundle,key1);</span>
<span class="nc" id="L676">			String suffix = i18n(m_rmBundle,key2);</span>
<span class="nc" id="L677">			String editor = getNumberInput(nameKey, Float.toString(factor), label, FormInputPC.TYPE_NUMERIC, enabled, required);</span>
<span class="nc" id="L678">			m_shiftBidContainerPC.addRow(label, editor + suffix);</span>
<span class="nc bnc" id="L679" title="All 2 branches missed.">            ancestor = (ancestor!=null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_RANK_FACTOR);</span>
		}
		{
<span class="nc" id="L682">			String nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_BONUSPOINT_FACTOR);</span>
<span class="nc" id="L683">			String key1 = RmWebBundleKey.ORG_RM_SETTINGS_BONUSPOINT_FACTOR;</span>
<span class="nc" id="L684">			String key2 = RmWebBundleKey.ORG_RM_SETTINGS_BONUSPOINT_FACTOR_SUFFIX;</span>
<span class="nc" id="L685">			float factor  = m_settings.getShiftBidBonusPointFactor();</span>
<span class="nc" id="L686">			String label = i18n(m_rmBundle,key1);</span>
<span class="nc" id="L687">			String suffix = i18n(m_rmBundle,key2);</span>
<span class="nc" id="L688">			String editor = getNumberInput(nameKey, Float.toString(factor), label, FormInputPC.TYPE_NUMERIC, enabled, required);</span>
<span class="nc" id="L689">			m_shiftBidContainerPC.addRow(label, editor + suffix);</span>
<span class="nc bnc" id="L690" title="All 2 branches missed.">            ancestor = (ancestor!=null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_BONUSPOINT_FACTOR);</span>
		}
<span class="nc bnc" id="L692" title="All 2 branches missed.">		if( LicenseUtil.isAdvancedRMLicense())</span>
		{
<span class="nc" id="L694">			String nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_FILTER_BID_OPTIONS_BY_EMPLOYEE_TYPE);</span>
<span class="nc" id="L695">			String key1 = RmWebBundleKey.RM_SA_FILTER_OPTIONS_BY_EMPLOYEE_TYPE;</span>
<span class="nc" id="L696">			String key2 = RmWebBundleKey.RM_SA_BID_OPTIONS;</span>
<span class="nc" id="L697">			String suffix = i18n(m_rmBundle,key1);</span>
<span class="nc" id="L698">			String label = i18n(m_rmBundle,key2);</span>
<span class="nc bnc" id="L699" title="All 2 branches missed.">			boolean disabled = !isAuthorizedToConfigureShiftBid();</span>
<span class="nc" id="L700">			boolean checked = m_settings.getFilterBidOptionsByEmpType();</span>

<span class="nc" id="L702">			String checkbox = makeChoiceInput(nameKey, &quot;true&quot;, checked, disabled, true);</span>
<span class="nc" id="L703">			m_shiftBidContainerPC.addRow(label,checkbox +&quot; &quot;+suffix);</span>
<span class="nc bnc" id="L704" title="All 2 branches missed.">            ancestor = (ancestor!=null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_FILTER_BID_OPTIONS_BY_EMPLOYEE_TYPE);</span>

<span class="nc" id="L706">            nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_DISPLAY_TEMPLATE_DESCRIPTION);</span>
<span class="nc" id="L707">			key1 = RmWebBundleKey.RM_SA_DISPLAY_TEMPLATE_DESCRIPTION;</span>
<span class="nc" id="L708">			suffix = i18n(m_rmBundle,key1);</span>
<span class="nc bnc" id="L709" title="All 2 branches missed.">			disabled = !isAuthorizedToConfigureShiftBid();</span>
<span class="nc" id="L710">			checked = m_settings.getDisplayBidTemplateDes();</span>

<span class="nc" id="L712">			checkbox = makeChoiceInput(nameKey, &quot;true&quot;, checked, disabled, true);</span>
<span class="nc" id="L713">			m_shiftBidContainerPC.addRow(&quot;&quot;,checkbox +&quot; &quot;+suffix);</span>
<span class="nc bnc" id="L714" title="All 2 branches missed.">            ancestor = (ancestor!=null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_DISPLAY_TEMPLATE_DESCRIPTION);</span>
		}

<span class="nc" id="L717">        m_shiftBidContainerPC.setTitle(getSectionTitle(i18n(m_rmBundle,</span>
                RmWebBundleKey.ORG_RM_SETTINGS_SHIFT_BIDDING_TITLE), ancestor));

		// Add the shiftBid Form
<span class="nc" id="L721">		addChildComponent(m_shiftBidContainerPC);</span>
<span class="nc" id="L722">	}</span>

	/**
	 * Creates the Time Off Accrual Form
	 */
	private void createTimeOffYearForm() {

<span class="nc" id="L729">		String ancestor = null;</span>
<span class="nc" id="L730">		String choiceNameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_ANIVERSARY_DATE);</span>
<span class="nc bnc" id="L731" title="All 2 branches missed.">		boolean disabled = !isAuthorizedToConfigureTOMEmployeeYear();</span>
		String anniversaryDateHtml;
		{
<span class="nc" id="L734">			String key = RmWebBundleKey.ORG_RM_SETTINGS_ANIVERSARY_DATE;</span>
<span class="nc" id="L735">			boolean checked = m_settings.getUseEmployeeAniversaryDate();</span>
<span class="nc" id="L736">			String radio = makeChoiceInput(choiceNameKey, &quot;true&quot;, checked, disabled, false);</span>
<span class="nc" id="L737">			String label = i18n(m_rmBundle, key);</span>
<span class="nc" id="L738">			anniversaryDateHtml = radio +&quot; &quot;+label;</span>
<span class="nc bnc" id="L739" title="All 2 branches missed.">            ancestor = (ancestor!=null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_ANIVERSARY_DATE);</span>
		}

		String fixedDateHtml;
		{
<span class="nc" id="L744">			String key = RmWebBundleKey.ORG_RM_SETTINGS_FIXED_DATE;</span>
<span class="nc bnc" id="L745" title="All 2 branches missed.">			boolean checked = !m_settings.getUseEmployeeAniversaryDate();</span>

<span class="nc" id="L747">			String radio = makeChoiceInput(choiceNameKey, &quot;false&quot;, checked, disabled, false);</span>
<span class="nc" id="L748">			String label = i18n(m_rmBundle, key);</span>

<span class="nc" id="L750">			int month = m_settings.getEmployeeFixedDateMonth();</span>
<span class="nc" id="L751">			int day = m_settings.getEmployeeFixedDateDay();</span>

<span class="nc" id="L753">			String monthKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_FIXED_DATE_MONTH);</span>
<span class="nc" id="L754">			String dayKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_FIXED_DATE_DAY);</span>

<span class="nc" id="L756">			String monthDay = HtmlDateDDUtil.makeMonthDayDD(monthKey,</span>
					dayKey,
					month,
					day,
<span class="nc" id="L760">					getOnChangeJS(),</span>
					&quot; &quot;,
					disabled,
					m_localizer);
<span class="nc" id="L764">			fixedDateHtml = radio+&quot; &quot;+label+&quot; &quot;+monthDay;</span>
<span class="nc bnc" id="L765" title="All 2 branches missed.">            ancestor = (ancestor!=null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_FIXED_DATE_MONTH);</span>
<span class="nc bnc" id="L766" title="All 2 branches missed.">            ancestor = (ancestor!=null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_FIXED_DATE_DAY);</span>
		}

		String accrualDayOfMonthHtml;
		{
<span class="nc" id="L771">			String label = i18n(m_rmBundle, RmWebBundleKey.ORG_RM_SETTINGS_ACCRUAL_DAY_OF_MONTH);</span>
<span class="nc" id="L772">			String monthdayKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_ACCRUAL_DAY_OF_MONTH);</span>
<span class="nc" id="L773">			int monthday = m_settings.getAccrualDayOfMonth();</span>
<span class="nc" id="L774">			String selector = HtmlDateDDUtil.makeDayDD(monthdayKey, null, monthday,</span>
<span class="nc" id="L775">					getOnChangeJS(), false, disabled, true, m_localizer);</span>
<span class="nc" id="L776">			accrualDayOfMonthHtml = label + &quot; &quot; + selector;</span>
<span class="nc bnc" id="L777" title="All 2 branches missed.">            ancestor = (ancestor!=null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_ACCRUAL_DAY_OF_MONTH);</span>
		}

		String accrualDayOfWeekHtml;
		{
<span class="nc" id="L782">			String label = i18n(m_rmBundle, RmWebBundleKey.ORG_RM_SETTINGS_ACCRUAL_DAY_OF_WEEK);</span>
<span class="nc" id="L783">			String weekdayKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_ACCRUAL_DAY_OF_WEEK);</span>
<span class="nc" id="L784">			int weekday = m_settings.getAccrualDayOfWeek();</span>
<span class="nc" id="L785">			String selector = HtmlUtil.getDayOfWeekDropDown(weekdayKey, weekday,</span>
<span class="nc" id="L786">					getOnChangeJS(), false, m_localizer);//TODO: unable to Disable this selector</span>
<span class="nc" id="L787">			accrualDayOfWeekHtml = label + &quot; &quot; + selector;</span>
<span class="nc bnc" id="L788" title="All 2 branches missed.">            ancestor = (ancestor!=null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_ACCRUAL_DAY_OF_WEEK);</span>
		}

<span class="nc" id="L791">		m_toYearContainerPC.setWidth(WIDTH);</span>
<span class="nc" id="L792">		m_toYearContainerPC.setWrapperCSSClass(FWRAPPER);</span>
<span class="nc" id="L793">		m_toYearContainerPC.setLastRowType(ListContainerPC.LAST_ROW_NONE);</span>
<span class="nc" id="L794">		m_toYearContainerPC.addRowData( i18n(m_rmBundle,</span>
				RmWebBundleKey.ORG_RM_SETTINGS_TO_YEAR_TITLE)
				+ HtmlUtil.NEW_LINE + anniversaryDateHtml
				+ HtmlUtil.NBSP + fixedDateHtml);
<span class="nc" id="L798">		m_toYearContainerPC.addRowData(accrualDayOfMonthHtml);</span>
<span class="nc" id="L799">		m_toYearContainerPC.addRowData(accrualDayOfWeekHtml);</span>

<span class="nc" id="L801">        m_toYearContainerPC.setTitle(getSectionTitle(i18n(m_rmBundle, RmWebBundleKey.TIME_OFF_ACCRUAL), ancestor));</span>

        // Add the TimeOff Year Form
<span class="nc" id="L804">		addChildComponent(m_toYearContainerPC);</span>
<span class="nc" id="L805">	}</span>

	/**
	 * Creates the ShiftSwap Form
	 */
	private void createShiftSwapForm() {

<span class="nc" id="L812">		m_shiftSwapPC.setWidth(WIDTH);</span>
<span class="nc" id="L813">		m_shiftSwapPC.setWrapperCSSClass(FWRAPPER);</span>
<span class="nc" id="L814">		m_shiftSwapPC.setLastRowType(ListContainerPC.LAST_ROW_NONE);</span>
<span class="nc" id="L815">        String ancestor = null;</span>

<span class="nc" id="L817">		String nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_ENABLE_SHIFT_SWAP);</span>
<span class="nc bnc" id="L818" title="All 2 branches missed.">		boolean disabled = !isAuthorizedToConfigureShiftSwap();</span>
		{
<span class="nc" id="L820">			String key = RmWebBundleKey.ORG_RM_SETTINGS_ENABLE_SHIFT_SWAP;</span>
<span class="nc" id="L821">			boolean checked = m_settings.getEnableShiftSwap();</span>
<span class="nc" id="L822">			String checkbox = makeChoiceInput(nameKey, &quot;true&quot;, checked, disabled, true);</span>
<span class="nc" id="L823">			String label = i18n(m_rmBundle, key);</span>
<span class="nc" id="L824">			m_shiftSwapPC.addRowData(checkbox +&quot; &quot;+label);</span>
<span class="nc bnc" id="L825" title="All 2 branches missed.">            ancestor = (ancestor!=null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_ENABLE_SHIFT_SWAP);</span>
		}
		{
<span class="nc" id="L828">			String key = RmWebBundleKey.ORG_RM_SETTINGS_SHIFT_SWAP_ORG_LIST;</span>
<span class="nc" id="L829">			String orgList = m_settings.getShiftSwapOrgList();</span>
<span class="nc" id="L830">			nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_SHIFT_SWAP_ORG_LIST);</span>
<span class="nc bnc" id="L831" title="All 2 branches missed.">			m_shiftSwapOrgSelectorPC.setEnabled(!disabled);</span>
<span class="nc bnc" id="L832" title="All 2 branches missed.">			m_shiftSwapOrgSelectorPC.setIsEditable(!disabled);</span>

<span class="nc" id="L834">			Collection orgIdCollection = null;</span>
<span class="nc bnc" id="L835" title="All 2 branches missed.">			if (!StringUtil.isEmpty(orgList)) {</span>
<span class="nc" id="L836">				ID ids[] = StringUtil.parseIDString(orgList);</span>
<span class="nc bnc" id="L837" title="All 4 branches missed.">				if (ids != null &amp;&amp; ids.length != 0) {</span>
<span class="nc" id="L838">					orgIdCollection = Arrays.asList(ids);</span>
				}
			}

<span class="nc bnc" id="L842" title="All 2 branches missed.">			if (orgIdCollection != null) {</span>
				try {
<span class="nc" id="L844">					m_shiftSwapOrgSelectorPC.initIDs( orgIdCollection );</span>
<span class="nc" id="L845">				}	catch (Exception e) {</span>
<span class="nc" id="L846">					log.error(&quot;&quot;, e);</span>
<span class="nc" id="L847">				}</span>
			}

<span class="nc" id="L850">			String label = i18n(m_rmBundle, key);</span>
<span class="nc" id="L851">			m_shiftSwapPC.addRowData(label+&quot; &quot;+m_shiftSwapOrgSelectorPC);</span>
<span class="nc bnc" id="L852" title="All 4 branches missed.">			if (orgIdCollection != null &amp;&amp; !orgIdCollection.isEmpty()) {</span>
<span class="nc" id="L853">				m_shiftSwapPC.addRowData(i18n(m_rmBundle, RmWebBundleKey.ORG_RM_SETTINGS_SHIFT_SWAP_ORG_LIST_WARNING));</span>
			}
<span class="nc bnc" id="L855" title="All 2 branches missed.">           ancestor = (ancestor!=null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_SHIFT_SWAP_ORG_LIST);</span>
		}
		{
<span class="nc" id="L858">			String key = RmWebBundleKey.ORG_RM_SETTINGS_DISABLE_ONE_WAY_SHIFT_SWAP;</span>
<span class="nc" id="L859">			boolean checked = m_settings.getDisableOneWayShiftSwap();</span>
<span class="nc" id="L860">			nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_DISABLE_ONE_WAY_SHIFT_SWAP);</span>
<span class="nc" id="L861">			String checkbox = makeChoiceInput(nameKey, &quot;true&quot;, checked, disabled, true);</span>
<span class="nc" id="L862">			String label = i18n(m_rmBundle, key);</span>
<span class="nc" id="L863">			m_shiftSwapPC.addRowData(checkbox +&quot; &quot;+label);</span>
<span class="nc bnc" id="L864" title="All 2 branches missed.">            ancestor = (ancestor!=null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_DISABLE_ONE_WAY_SHIFT_SWAP);</span>
		}

		{//Allow partial day shift swap requests
<span class="nc" id="L868">			String key = RmWebBundleKey.ORG_RM_SETTINGS_ALLOW_PARTIAL_SHIFT_SWAP;</span>
<span class="nc" id="L869">			boolean checked = m_settings.getAllowPartialShiftSwap();</span>
<span class="nc" id="L870">			nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_ALLOW_PARTIAL_SHIFT_SWAP);</span>
<span class="nc" id="L871">			String checkbox = makeChoiceInput(nameKey, &quot;true&quot;, checked, disabled, true);</span>
<span class="nc" id="L872">			String label = i18n(m_rmBundle, key);</span>
<span class="nc" id="L873">			m_shiftSwapPC.addRowData(checkbox +&quot; &quot;+label);</span>
<span class="nc bnc" id="L874" title="All 2 branches missed.">            ancestor = (ancestor!=null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_ALLOW_PARTIAL_SHIFT_SWAP);</span>
		}

		{//Allow pickup of a portion of a posted shift
<span class="nc" id="L878">			String key = RmWebBundleKey.ORG_RM_SETTINGS_ALLOW_PARTIAL_PICKUP;</span>
<span class="nc" id="L879">			boolean checked = m_settings.getAllowPartialShiftPickup();</span>
<span class="nc" id="L880">			nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_ALLOW_PARTIAL_SHIFT_PICKUP);</span>
<span class="nc" id="L881">			String checkbox = makeChoiceInput(nameKey, &quot;true&quot;, checked, disabled, true);</span>
<span class="nc" id="L882">			String label = i18n(m_rmBundle, key);</span>
<span class="nc" id="L883">			m_shiftSwapPC.addRowData(checkbox +&quot; &quot;+label);</span>
<span class="nc bnc" id="L884" title="All 2 branches missed.">            ancestor = (ancestor!=null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_ALLOW_PARTIAL_SHIFT_PICKUP);</span>
		}

        {
<span class="nc" id="L888">            nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_MAX_SWAP_NEGOTIATIONS);</span>
<span class="nc" id="L889">            String key = RmWebBundleKey.ORG_RM_SETTINGS_MAX_SWAP_NEGOTIATIONS;</span>
<span class="nc" id="L890">            int amount  = m_settings.getShiftSwapMaxNegotiationUpdates();</span>
<span class="nc" id="L891">            String label = i18n(m_rmBundle,key);</span>
<span class="nc bnc" id="L892" title="All 2 branches missed.">            String editor = getNumberInput(nameKey, Integer.toString(amount), label, FormInputPC.TYPE_INTEGER, !disabled, false);</span>
<span class="nc" id="L893">            m_shiftSwapPC.addRowData(label +&quot; &quot;+ editor);</span>
<span class="nc bnc" id="L894" title="All 2 branches missed.">            ancestor = (ancestor!=null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_MAX_SWAP_NEGOTIATIONS);</span>
        }

<span class="nc" id="L897">        m_shiftSwapPC.setTitle(getSectionTitle(i18n(m_rmBundle,</span>
                RmWebBundleKey.ORG_RM_SETTINGS_SHIFT_SWAP), ancestor));

		// Add the shift swap Form
<span class="nc" id="L901">		addChildComponent(m_shiftSwapPC);</span>
<span class="nc" id="L902">	}</span>

	/**
	 * Default hex color codes are being stored in the DB without the &quot;#&quot; character
	 * preceding them.  Make sure that this character is in place before the html is
	 * rendered, otherwise the color will not appear in standards mode.
	 */
	private String enforceHexColorStringStandards(String colorCode) {
<span class="nc bnc" id="L910" title="All 2 branches missed.">		if (StringUtil.isEmpty(colorCode)) {</span>
<span class="nc" id="L911">			return colorCode;</span>
		}
<span class="nc bnc" id="L913" title="All 2 branches missed.">		if (!colorCode.startsWith(&quot;#&quot;)) {</span>
<span class="nc" id="L914">			return &quot;#&quot; + colorCode;</span>
		}
<span class="nc" id="L916">		return colorCode;</span>
	}


	/**
	 * Creates the CalendarColor Form
	 */
	private void createCalendarColorForm() {

<span class="nc" id="L925">		m_calendarColorPC.setWidth(WIDTH);</span>
<span class="nc" id="L926">		String ancestor = null;</span>
<span class="nc" id="L927">		boolean enabled = isAuthorizedToConfigureTOMCalendarColors();</span>
		{
<span class="nc" id="L929">			String nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_TO_AVAILABLE_COLOR);</span>
<span class="nc" id="L930">			String key = RmWebBundleKey.ORG_RM_SETTINGS_TO_AVAILABLE_LABEL;</span>
<span class="nc" id="L931">			String value = enforceHexColorStringStandards(m_settings.getAvailableVactionColor());</span>
<span class="nc bnc" id="L932" title="All 2 branches missed.">			if (value == null) {</span>
<span class="nc" id="L933">				value = DEFAULT_COLOR;</span>
			}
<span class="nc" id="L935">			m_calendarColorPC.addColorFields(nameKey, key, value, enabled);</span>
<span class="nc bnc" id="L936" title="All 2 branches missed.">			ancestor = (ancestor != null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_TO_AVAILABLE_COLOR);</span>
		}
		{
<span class="nc" id="L939">			String nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_TO_BLACKOUT_COLOR);</span>
<span class="nc" id="L940">			String key = RmWebBundleKey.ORG_RM_SETTINGS_TO_BLACKOUT_LABEL;</span>
<span class="nc" id="L941">			String value = enforceHexColorStringStandards(m_settings.getBlackoutColor());</span>
<span class="nc bnc" id="L942" title="All 2 branches missed.">			if (value == null) {</span>
<span class="nc" id="L943">				value = DEFAULT_COLOR;</span>
			}
<span class="nc" id="L945">			m_calendarColorPC.addColorFields(nameKey, key, value, enabled);</span>
<span class="nc bnc" id="L946" title="All 2 branches missed.">			ancestor = (ancestor != null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_TO_BLACKOUT_COLOR);</span>
		}
		{
<span class="nc" id="L949">			String nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_TO_NON_OPERATION_COLOR);</span>
<span class="nc" id="L950">			String key = RmWebBundleKey.ORG_RM_SETTINGS_TO_NON_OPERATION_LABEL;</span>
<span class="nc" id="L951">			String value = enforceHexColorStringStandards(m_settings.getNonOperationDayColor());</span>
<span class="nc bnc" id="L952" title="All 2 branches missed.">			if (value == null) {</span>
<span class="nc" id="L953">				value = DEFAULT_COLOR;</span>
			}
<span class="nc" id="L955">			m_calendarColorPC.addColorFields(nameKey, key, value, enabled);</span>
<span class="nc bnc" id="L956" title="All 2 branches missed.">			ancestor = (ancestor != null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_TO_NON_OPERATION_COLOR);</span>
		}
		{
<span class="nc" id="L959">			String nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_TO_NON_WORKING_COLOR);</span>
<span class="nc" id="L960">			String key = RmWebBundleKey.ORG_RM_SETTINGS_TO_NON_WORKING_LABEL;</span>
<span class="nc" id="L961">			String value = enforceHexColorStringStandards(m_settings.getNonWorkingHolidayColor());</span>
<span class="nc bnc" id="L962" title="All 2 branches missed.">			if (value == null) {</span>
<span class="nc" id="L963">				value = DEFAULT_COLOR;</span>
			}
<span class="nc" id="L965">			m_calendarColorPC.addColorFields(nameKey, key, value, enabled);</span>
<span class="nc bnc" id="L966" title="All 2 branches missed.">			ancestor = (ancestor != null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_TO_NON_WORKING_COLOR);</span>
		}
		{
<span class="nc" id="L969">			String nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_TO_NO_AVAILABLE_COLOR);</span>
<span class="nc" id="L970">			String key = RmWebBundleKey.ORG_RM_SETTINGS_TO_NO_AVAILABLE_LABEL;</span>
<span class="nc" id="L971">			String value = enforceHexColorStringStandards(m_settings.getNoAvailableVacationColor());</span>
<span class="nc bnc" id="L972" title="All 2 branches missed.">			if (value == null) {</span>
<span class="nc" id="L973">				value = DEFAULT_COLOR;</span>
			}
<span class="nc" id="L975">			m_calendarColorPC.addColorFields(nameKey, key, value, enabled);</span>
<span class="nc bnc" id="L976" title="All 2 branches missed.">			ancestor = (ancestor != null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_TO_NO_AVAILABLE_COLOR);</span>
		}
		{
<span class="nc" id="L979">			String nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_TO_WORKING_COLOR);</span>
<span class="nc" id="L980">			String key = RmWebBundleKey.ORG_RM_SETTINGS_TO_WORKING_LABEL;</span>
<span class="nc" id="L981">			String value = enforceHexColorStringStandards(m_settings.getWorkingHolidayColor());</span>
<span class="nc bnc" id="L982" title="All 2 branches missed.">			if (value == null) {</span>
<span class="nc" id="L983">				value = DEFAULT_COLOR;</span>
			}
<span class="nc" id="L985">			m_calendarColorPC.addColorFields(nameKey, key, value, enabled);</span>
<span class="nc bnc" id="L986" title="All 2 branches missed.">			ancestor = (ancestor != null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_TO_WORKING_COLOR);</span>
		}
		{
<span class="nc" id="L989">			String nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_TO_PENDING_COLOR);</span>
<span class="nc" id="L990">			String key = RmWebBundleKey.ORG_RM_SETTINGS_TO_PENDING_LABEL;</span>
<span class="nc" id="L991">			String value = enforceHexColorStringStandards(m_settings.getPendingColor());</span>
<span class="nc bnc" id="L992" title="All 2 branches missed.">			if (value == null) {</span>
<span class="nc" id="L993">				value = DEFAULT_COLOR;</span>
			}
<span class="nc" id="L995">			m_calendarColorPC.addColorFields(nameKey, key, value, enabled);</span>
<span class="nc bnc" id="L996" title="All 2 branches missed.">			ancestor = (ancestor != null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_TO_PENDING_COLOR);</span>
		}
		{
<span class="nc" id="L999">			String nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_TO_SCHEDULED_COLOR);</span>
<span class="nc" id="L1000">			String key = RmWebBundleKey.ORG_RM_SETTINGS_TO_SCHEDULED_LABEL;</span>
<span class="nc" id="L1001">			String value = enforceHexColorStringStandards(m_settings.getScheduledColor());</span>
<span class="nc bnc" id="L1002" title="All 2 branches missed.">			if (value == null) {</span>
<span class="nc" id="L1003">				value = DEFAULT_COLOR;</span>
			}
<span class="nc" id="L1005">			m_calendarColorPC.addColorFields(nameKey, key, value, enabled);</span>
<span class="nc bnc" id="L1006" title="All 2 branches missed.">			ancestor = (ancestor != null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_TO_SCHEDULED_COLOR);</span>
		}

<span class="nc" id="L1009">		m_calendarColorPC.setTitle(getSectionTitle(i18n(m_rmBundle, RmWebBundleKey.ORG_RM_SETTINGS_TO_CALENDAR_COLOR_TITLE), ancestor));</span>

		// Add the CalendarColor Form
<span class="nc" id="L1012">		addChildComponent(m_calendarColorPC);</span>
<span class="nc" id="L1013">	}</span>



	/**
	 * Creates the Policies Form for TimeOff, Shift Swap and Shift Bid
	 */
	static final String POLICY_TEMPLATE = &quot;&lt;span style=\&quot;padding:5px;\&quot;&gt;{0}&lt;/span&gt;&quot;;
	private void createTOPoliciesForm() {
		CollapsibleContainerPC policiesPC;
<span class="nc" id="L1023">		String nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_TO_POLICY);</span>
<span class="nc" id="L1024">		String policy = m_settings.getTimeOffPolicy();</span>
<span class="nc bnc" id="L1025" title="All 2 branches missed.">		boolean disabled = !isAuthorizedToConfigureTOMPolicies();</span>
<span class="nc" id="L1026">		int idx = TO_POLICY_INDEX;</span>

<span class="nc bnc" id="L1028" title="All 2 branches missed.">		if (policy == null) {</span>
<span class="nc" id="L1029">			policy = &quot;&quot;;</span>
		}

<span class="nc" id="L1032">		policiesPC = new CollapsibleContainerPC(m_context);</span>
<span class="nc" id="L1033">		String title = (&quot; &quot; + i18n(m_rmBundle, RmWebBundleKey.ORG_RM_SETTINGS_TO_POLICY_TITLE));</span>
<span class="nc" id="L1034">		policiesPC.setName(POLICY_CONTAINER + idx);</span>
<span class="nc" id="L1035">		policiesPC.setWidth(WIDTH);</span>
<span class="nc" id="L1036">		policiesPC.setStyleClass(FWRAPPER);</span>

<span class="nc" id="L1038">		policiesPC.setTemplate(POLICY_TEMPLATE);</span>

<span class="nc" id="L1040">		String textArea = HtmlUtil.makeTextAreaInput(nameKey,</span>
		        135,
		        7,
<span class="nc" id="L1043">		        getOnChangeJS(),</span>
		        true,
		        disabled,
		        policy);
<span class="nc" id="L1047">		policiesPC.addComponent(textArea);</span>

<span class="nc" id="L1049">		String ancestor = getAncestor(RmSettingKey.ORG_RM_SETTINGS_TO_POLICY);</span>
<span class="nc" id="L1050">		policiesPC.setTitle(getSectionTitle(title, ancestor));</span>

<span class="nc" id="L1052">		m_settingsPolicyContainerMap.put(TO_POLICY,policiesPC);</span>
<span class="nc" id="L1053">		addChildComponent(policiesPC);</span>
<span class="nc" id="L1054">	}</span>

	private void createSSPoliciesForm() {
		CollapsibleContainerPC policiesPC;
<span class="nc" id="L1058">		String nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_SS_POLICY);</span>
<span class="nc" id="L1059">		String policy = m_settings.getShiftSwapPolicy();</span>
<span class="nc bnc" id="L1060" title="All 2 branches missed.">		boolean disabled = !isAuthorizedToConfigureSSPolicies();</span>
<span class="nc" id="L1061">		int idx = SS_POLICY_INDEX;</span>

<span class="nc bnc" id="L1063" title="All 2 branches missed.">		if (policy == null) {</span>
<span class="nc" id="L1064">			policy = &quot;&quot;;</span>
		}

<span class="nc" id="L1067">		policiesPC = new CollapsibleContainerPC(m_context);</span>
<span class="nc" id="L1068">		String title = (&quot; &quot; + i18n(m_rmBundle, RmWebBundleKey.ORG_RM_SETTINGS_SS_POLICY_TITLE));</span>
<span class="nc" id="L1069">		policiesPC.setName(POLICY_CONTAINER + idx);</span>
<span class="nc" id="L1070">		policiesPC.setWidth(WIDTH);</span>
<span class="nc" id="L1071">		policiesPC.setStyleClass(FWRAPPER);</span>

<span class="nc" id="L1073">		policiesPC.setTemplate(POLICY_TEMPLATE);</span>

<span class="nc" id="L1075">		String textArea = HtmlUtil.makeTextAreaInput(nameKey,</span>
		        135,
		        7,
<span class="nc" id="L1078">		        getOnChangeJS(),</span>
		        true,
		        disabled,
		        policy);
<span class="nc" id="L1082">		policiesPC.addComponent(textArea);</span>

<span class="nc" id="L1084">		String ancestor = getAncestor(RmSettingKey.ORG_RM_SETTINGS_SS_POLICY);</span>
<span class="nc" id="L1085">		policiesPC.setTitle(getSectionTitle(title, ancestor));</span>

<span class="nc" id="L1087">		m_settingsPolicyContainerMap.put(SS_POLICY,policiesPC);</span>
<span class="nc" id="L1088">		addChildComponent(policiesPC);</span>
<span class="nc" id="L1089">	}</span>

	private void createSBPoliciesForm() {
		CollapsibleContainerPC policiesPC;
<span class="nc" id="L1093">		String nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_SB_POLICY);</span>
<span class="nc" id="L1094">		String policy = m_settings.getShiftBidPolicy();</span>
<span class="nc bnc" id="L1095" title="All 2 branches missed.">		boolean disabled = !isAuthorizedToConfigureSBPolicies();</span>
<span class="nc" id="L1096">		int idx = SB_POLICY_INDEX;</span>

<span class="nc bnc" id="L1098" title="All 2 branches missed.">		if (policy == null) {</span>
<span class="nc" id="L1099">			policy = &quot;&quot;;</span>
		}

<span class="nc" id="L1102">		policiesPC = new CollapsibleContainerPC(m_context);</span>
<span class="nc" id="L1103">		String title = (&quot; &quot; + i18n(m_rmBundle, RmWebBundleKey.ORG_RM_SETTINGS_SB_POLICY_TITLE));</span>
<span class="nc" id="L1104">		policiesPC.setName(POLICY_CONTAINER + idx);</span>
<span class="nc" id="L1105">		policiesPC.setWidth(WIDTH);</span>
<span class="nc" id="L1106">		policiesPC.setStyleClass(FWRAPPER);</span>

<span class="nc" id="L1108">		policiesPC.setTemplate(POLICY_TEMPLATE);</span>

<span class="nc" id="L1110">		String textArea = HtmlUtil.makeTextAreaInput(nameKey,</span>
		        135,
		        7,
<span class="nc" id="L1113">		        getOnChangeJS(),</span>
		        true,
		        disabled,
		        policy);
<span class="nc" id="L1117">		policiesPC.addComponent(textArea);</span>

<span class="nc" id="L1119">		String ancestor = getAncestor(RmSettingKey.ORG_RM_SETTINGS_SB_POLICY);</span>
<span class="nc" id="L1120">		policiesPC.setTitle(getSectionTitle(title, ancestor));</span>

<span class="nc" id="L1122">		m_settingsPolicyContainerMap.put(SB_POLICY,policiesPC);</span>
<span class="nc" id="L1123">		addChildComponent(policiesPC);</span>
<span class="nc" id="L1124">	}</span>

	private void createFTPoliciesForm() {
		CollapsibleContainerPC policiesPC;
<span class="nc" id="L1128">		String nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_FT_POLICY);</span>
<span class="nc" id="L1129">		String policy = m_settings.getFlexTimePolicy();</span>
<span class="nc bnc" id="L1130" title="All 2 branches missed.">		boolean disabled = !isAuthorizedToConfigureFTPolicies();</span>
<span class="nc" id="L1131">		int idx = FT_POLICY_INDEX;</span>

<span class="nc bnc" id="L1133" title="All 2 branches missed.">		if (policy == null) {</span>
<span class="nc" id="L1134">			policy = &quot;&quot;;</span>
		}

<span class="nc" id="L1137">		policiesPC = new CollapsibleContainerPC(m_context);</span>
<span class="nc" id="L1138">		String title = (HtmlUtil.NBSP + i18n(m_rmBundle, RmWebBundleKey.ORG_RM_SETTINGS_FT_POLICY_TITLE));</span>
<span class="nc" id="L1139">		policiesPC.setName(POLICY_CONTAINER + idx);</span>
<span class="nc" id="L1140">		policiesPC.setWidth(WIDTH);</span>
<span class="nc" id="L1141">		policiesPC.setStyleClass(FWRAPPER);</span>

<span class="nc" id="L1143">		policiesPC.setTemplate(POLICY_TEMPLATE);</span>

<span class="nc" id="L1145">		String textArea = HtmlUtil.makeTextAreaInput(nameKey,</span>
		        135,
		        7,
<span class="nc" id="L1148">		        getOnChangeJS(),</span>
		        true,
		        disabled,
		        policy);
<span class="nc" id="L1152">		policiesPC.addComponent(textArea);</span>

<span class="nc" id="L1154">		String ancestor = getAncestor(RmSettingKey.ORG_RM_SETTINGS_FT_POLICY);</span>
<span class="nc" id="L1155">		policiesPC.setTitle(getSectionTitle(title, ancestor));</span>

<span class="nc" id="L1157">		m_settingsPolicyContainerMap.put(FT_POLICY, policiesPC);</span>
<span class="nc" id="L1158">		addChildComponent(policiesPC);</span>
<span class="nc" id="L1159">	}</span>

	// required by base class
	@Override
	protected void initFieldValidators() {
<span class="nc" id="L1164">		final String intKeys[][] = {</span>
			{RmSettingKey.ORG_RM_SETTINGS_MAX_PREFERENCE_VALUE,
			 RmWebBundleKey.ORG_RM_SETTINGS_MAX_PREFERENCE_VALUE},
			{RmSettingKey.ORG_RM_SETTINGS_MAX_BIDS_PER_EMPLOYEE,
			 RmWebBundleKey.ORG_RM_SETTINGS_MAX_BIDS_PER_EMPLOYEE},
            {RmSettingKey.ORG_RM_SETTINGS_MAX_SWAP_NEGOTIATIONS,
             RmWebBundleKey.ORG_RM_SETTINGS_MAX_SWAP_NEGOTIATIONS},
		};
		int l;
<span class="nc" id="L1173">		l = intKeys.length;</span>
<span class="nc bnc" id="L1174" title="All 2 branches missed.">		for (int i = 0; i &lt; l; i++) {</span>
<span class="nc" id="L1175">			String nameKey = getNameKey(intKeys[i][0]);</span>
<span class="nc" id="L1176">			String resKey = intKeys[i][1];</span>
<span class="nc" id="L1177">			addValidator(new IsPosIntegerFieldValidator(this,</span>
					nameKey,
					resKey,
					RmWebBundleKey.BUNDLE_NAME));
		}

<span class="nc" id="L1183">		final String floatKeys[][] = {</span>
			{RmSettingKey.ORG_RM_SETTINGS_BONUSPOINT_FACTOR,
			 RmWebBundleKey.ORG_RM_SETTINGS_BONUSPOINT_FACTOR},
			{RmSettingKey.ORG_RM_SETTINGS_SENIORITY_FACTOR,
			 RmWebBundleKey.ORG_RM_SETTINGS_SENIORITY_FACTOR},
			{RmSettingKey.ORG_RM_SETTINGS_RANK_FACTOR,
			 RmWebBundleKey.ORG_RM_SETTINGS_RANK_FACTOR},
		};
<span class="nc" id="L1191">		l = floatKeys.length;</span>
<span class="nc bnc" id="L1192" title="All 2 branches missed.">		for (int i = 0; i &lt; l; i++) {</span>
<span class="nc" id="L1193">			String nameKey = getNameKey(floatKeys[i][0]);</span>
<span class="nc" id="L1194">			String resKey = floatKeys[i][1];</span>
<span class="nc" id="L1195">			addValidator(new IsNonNegativeNumberFieldValidator(this,</span>
					nameKey,
					resKey,
					RmWebBundleKey.BUNDLE_NAME));
		}
<span class="nc" id="L1200">	}</span>

	/**
	 * Gets the Flex Time form
	 * @return	ListContainerPC	Instance of ListContainerPC
	 */
	public ListContainerPC getFlexTimeForm() {
<span class="nc" id="L1207">		return flexTimeContainerPC;</span>
	}

	/**
	 * Renders the ActivationForm
	 * @return	ListContainerPC	Instance of ListContainerPC
	 */
	public ListContainerPC getActivationForm() {
<span class="nc" id="L1215">		return m_activationContainerPC;</span>
	}
	/**
	 * Renders the ActivationForm
	 * @return	ListContainerPC	Instance of ListContainerPC
	 */
	public ListContainerPC getTOOptionsContainerForm() {
<span class="nc" id="L1222">		return m_toOptionsContainerPC;</span>
	}

	/**
	 * Renders the requiredPayPeriodHoursContainerPC
	 * @return	ListContainerPC	Instance of ListContainerPC
	 */
	public ListContainerPC getRequiredPayPeriodHoursForm() {
<span class="nc" id="L1230">		return requiredPayPeriodHoursContainerPC;</span>
	}

	/**
	 * Renders the TimeOffYear Form
	 * @return	ListContainerPC	Instance of ListContainerPC
	 */
	public ListContainerPC getTOYearForm() {
<span class="nc" id="L1238">		return m_toYearContainerPC;</span>
	}

	/**
	 * Renders the ShiftSwap Form
	 * @return	ListContainerPC	Instance of ListContainerPC
	 */
	public ListContainerPC getShiftSwapForm() {
<span class="nc" id="L1246">		return m_shiftSwapPC;</span>
	}

	/**
	 * Renders the ShiftBid Form
	 * @return	ListContainerPC	Instance of ListContainerPC
	 */
	public Collapsible2ColFormPC getShiftBidForm() {
<span class="nc" id="L1254">		return m_shiftBidContainerPC;</span>
	}
	/**
	 * Renders the CalendarColor Form
	 * @return	ColorGenericPC	Instance of ColorGenericPC
	 */
	public ColorGenericPC getCalendarColorForm() {
<span class="nc" id="L1261">		return m_calendarColorPC;</span>
	}

	/**
	 * Renders the CustomShiftRequest Form
	 * @return	ListContainerPC	Instance of ListContainerPC
	 */
	public ListContainerPC getCustomShiftForm() {
<span class="nc" id="L1269">		return m_customShiftContainerPC;</span>
	}

	public ListContainerPC getWorkFlowForm() {
<span class="nc" id="L1273">		return m_workFlowContainerPC;</span>
	}

	/**
	 * Renders the Policies Form
	 * @return	Collection	contains the policy forms for TimeOff,
	 *                      Shift Swap and Shift Bid
	 */
	public Map&lt;String, CollapsibleContainerPC&gt; getPoliciesForm() {
<span class="nc" id="L1282">		return m_settingsPolicyContainerMap;</span>
	}

    public CollapsibleContainerPC  getPolicyForm(String reqType) {
<span class="nc" id="L1286">		return m_settingsPolicyContainerMap.get(reqType);</span>
	}
	/**
	 * Javascript method to call when a control changes.
	 * @return String javascript expression
	 */
	private static String getOnChangeJS() {
<span class="nc" id="L1293">		return JSUtil.ON_CHANGE;</span>
	}

	/**
	 * Overrode this method to add the color picker to the
	 * html data.
	 */
	@Override
	public String getRequiredHTML() {
<span class="nc" id="L1302">		StringBuilder sb = new StringBuilder(128);</span>
<span class="nc" id="L1303">		sb.append(super.getRequiredHTML());</span>
<span class="nc" id="L1304">		sb.append(HtmlUtil.makeColorPicker());</span>
<span class="nc" id="L1305">		return sb.toString();</span>
	}

	/**
	 * Convert setting key name to form parameter name.
	 * Basically, form field names can't contain '/'. In addition,
	 * sometime the key name is used as the 'id' form attribute
	 * value.
	 *
	 * @param key - setting key name (with '/')
	 * @return String  form field name (with '/' replaced by '_')
	 */
	public static String getNameKey(String key) {
<span class="nc" id="L1318">		return key.replace('/', '_');</span>
	}

	@Override
	protected boolean isAuthorizedToConfigure() {
<span class="nc" id="L1323">		return</span>
<span class="nc bnc" id="L1324" title="All 2 branches missed.">				isAuthorizedToConfigureTOMWorkflow() ||</span>
<span class="nc bnc" id="L1325" title="All 2 branches missed.">				isAuthorizedToConfigureTORequestOptions()||</span>
<span class="nc bnc" id="L1326" title="All 2 branches missed.">				isAuthorizedToConfigureShiftSwap() ||</span>
<span class="nc bnc" id="L1327" title="All 2 branches missed.">				isAuthorizedToConfigureTOMEmployeeYear() ||</span>
<span class="nc bnc" id="L1328" title="All 2 branches missed.">				isAuthorizedToConfigureTOMCalendarColors() ||</span>
<span class="nc bnc" id="L1329" title="All 2 branches missed.">				isAuthorizedToConfigureTOMPolicies() ||</span>
<span class="nc bnc" id="L1330" title="All 2 branches missed.">				isAuthorizedToConfigureSSPolicies() ||</span>
<span class="nc bnc" id="L1331" title="All 2 branches missed.">				isAuthorizedToConfigureShiftBid() ||</span>
<span class="nc bnc" id="L1332" title="All 2 branches missed.">				isAuthorizedToConfigureSBPolicies() ||</span>
<span class="nc bnc" id="L1333" title="All 2 branches missed.">				isAuthorizedToConfigureCustomShift() ||</span>
<span class="nc bnc" id="L1334" title="All 2 branches missed.">				isAuthorizedToConfigureCSPolicies() ||</span>
<span class="nc bnc" id="L1335" title="All 2 branches missed.">				isAuthorizedToConfigureFlexTime() ||</span>
<span class="nc bnc" id="L1336" title="All 2 branches missed.">				isAuthorizedToConfigureFTPolicies();</span>
	}
	protected boolean isAuthorizedToConfigureTORequestOptions() {
<span class="nc bnc" id="L1339" title="All 2 branches missed.">		return isValidSelectedOrg() &amp;&amp;</span>
<span class="nc bnc" id="L1340" title="All 2 branches missed.">				m_context.getUser().isAuthorized(</span>
<span class="nc" id="L1341">						PrivilegeKeys.TOM_CONFIGURETIMEOFFOPTIONS, OrganizationScopeManagerProxy.getScopeID(getSelectedIDObject()));</span>
	}

	protected boolean isAuthorizedToConfigureTOMWorkflow() {
<span class="nc bnc" id="L1345" title="All 2 branches missed.">		return isValidSelectedOrg() &amp;&amp;</span>
<span class="nc bnc" id="L1346" title="All 2 branches missed.">				m_context.getUser().isAuthorized(</span>
<span class="nc" id="L1347">						PrivilegeKeys.TOM_ACTIVATETIMEOFFWORKFLOW, OrganizationScopeManagerProxy.getScopeID(getSelectedIDObject()));</span>
	}

	protected boolean isAuthorizedToConfigureFlexTime() {
<span class="nc bnc" id="L1351" title="All 2 branches missed.">		return isValidSelectedOrg() &amp;&amp;</span>
<span class="nc bnc" id="L1352" title="All 2 branches missed.">				m_context.getUser().isAuthorized(</span>
<span class="nc" id="L1353">						PrivilegeKeys.FT_SETTINGS, OrganizationScopeManagerProxy.getScopeID(getSelectedIDObject()));</span>
	}

	protected boolean isAuthorizedToConfigureShiftSwap() {
<span class="nc bnc" id="L1357" title="All 2 branches missed.">		return isValidSelectedOrg() &amp;&amp;</span>
<span class="nc bnc" id="L1358" title="All 2 branches missed.">				m_context.getUser().isAuthorized(</span>
<span class="nc" id="L1359">						PrivilegeKeys.SS_SETTINGS, OrganizationScopeManagerProxy.getScopeID(getSelectedIDObject()));</span>
	}

	protected boolean isAuthorizedToConfigureTOMEmployeeYear() {
<span class="nc bnc" id="L1363" title="All 2 branches missed.">		return isValidSelectedOrg() &amp;&amp;</span>
<span class="nc bnc" id="L1364" title="All 2 branches missed.">				m_context.getUser().isAuthorized(</span>
<span class="nc" id="L1365">						PrivilegeKeys.TOM_SETYEARFOREMPLOYEE, OrganizationScopeManagerProxy.getScopeID(getSelectedIDObject()));</span>
	}

	protected boolean isAuthorizedToConfigureTOMCalendarColors() {
<span class="nc bnc" id="L1369" title="All 2 branches missed.">		return isValidSelectedOrg() &amp;&amp;</span>
<span class="nc bnc" id="L1370" title="All 2 branches missed.">				m_context.getUser().isAuthorized(</span>
<span class="nc" id="L1371">						PrivilegeKeys.TOM_CONFIGURECALENDARCOLORS, OrganizationScopeManagerProxy.getScopeID(getSelectedIDObject()));</span>
	}

	protected boolean isAuthorizedToConfigureTOMPolicies() {
<span class="nc bnc" id="L1375" title="All 2 branches missed.">		return isValidSelectedOrg() &amp;&amp;</span>
<span class="nc bnc" id="L1376" title="All 2 branches missed.">				m_context.getUser().isAuthorized(</span>
<span class="nc" id="L1377">						PrivilegeKeys.TOM_SETPOLICIES, OrganizationScopeManagerProxy.getScopeID(getSelectedIDObject()));</span>
	}

	protected boolean isAuthorizedToConfigureFTPolicies() {
<span class="nc bnc" id="L1381" title="All 2 branches missed.">		return isValidSelectedOrg() &amp;&amp;</span>
<span class="nc bnc" id="L1382" title="All 2 branches missed.">				m_context.getUser().isAuthorized(</span>
<span class="nc" id="L1383">						PrivilegeKeys.FT_SETPOLICIES, OrganizationScopeManagerProxy.getScopeID(getSelectedIDObject()));</span>
	}

	protected boolean isAuthorizedToConfigureSSPolicies() {
<span class="nc bnc" id="L1387" title="All 2 branches missed.">		return isValidSelectedOrg() &amp;&amp;</span>
<span class="nc bnc" id="L1388" title="All 2 branches missed.">				m_context.getUser().isAuthorized(</span>
<span class="nc" id="L1389">						PrivilegeKeys.SS_SETPOLICIES, OrganizationScopeManagerProxy.getScopeID(getSelectedIDObject()));</span>
	}

	protected boolean isAuthorizedToConfigureSBPolicies() {
<span class="nc bnc" id="L1393" title="All 2 branches missed.">		return isValidSelectedOrg() &amp;&amp;</span>
<span class="nc bnc" id="L1394" title="All 2 branches missed.">				m_context.getUser().isAuthorized(</span>
<span class="nc" id="L1395">						PrivilegeKeys.SB_SETPOLICIES, OrganizationScopeManagerProxy.getScopeID(getSelectedIDObject()));</span>
	}

	protected boolean isAuthorizedToConfigureShiftBid() {
<span class="nc bnc" id="L1399" title="All 2 branches missed.">		return isValidSelectedOrg() &amp;&amp;</span>
<span class="nc bnc" id="L1400" title="All 2 branches missed.">				m_context.getUser().isAuthorized(</span>
<span class="nc" id="L1401">						PrivilegeKeys.SB_SETTINGS, OrganizationScopeManagerProxy.getScopeID(getSelectedIDObject()));</span>
	}

	protected boolean isAuthorizedToConfigureCSPolicies() {
<span class="nc bnc" id="L1405" title="All 2 branches missed.">		return isValidSelectedOrg() &amp;&amp;</span>
<span class="nc bnc" id="L1406" title="All 2 branches missed.">				m_context.getUser().isAuthorized(</span>
<span class="nc" id="L1407">						PrivilegeKeys.CS_SETPOLICIES, OrganizationScopeManagerProxy.getScopeID(getSelectedIDObject()));</span>
	}

	protected boolean isAuthorizedToConfigureCustomShift() {
<span class="nc bnc" id="L1411" title="All 2 branches missed.">		return isValidSelectedOrg() &amp;&amp;</span>
<span class="nc bnc" id="L1412" title="All 2 branches missed.">				m_context.getUser().isAuthorized(</span>
<span class="nc" id="L1413">						PrivilegeKeys.CS_SETTINGS, OrganizationScopeManagerProxy.getScopeID(getSelectedIDObject()));</span>
	}

	/*
	protected boolean isAuthorizedToConfigureNetStaffingColors() {
		return isValidSelectedOrg() &amp;&amp;
				m_context.getUser().isAuthorized(
						PrivilegeKeys.CS_SETTINGS, OrganizationScopeManagerProxy.getScopeID(getSelectedIDObject()));
	}
	 */

	private String makeChoiceInput(String name, String value, boolean checked,
			boolean disabled, boolean isMultiSelect) {
<span class="nc" id="L1426">		return makeChoiceInput(name, value, checked, disabled, isMultiSelect, JSUtil.ON_CHANGE);</span>
	}

	private String makeChoiceInput(String name, String value, boolean checked,
			boolean disabled, boolean isMultiSelect, String onClickJS) {
<span class="nc" id="L1431">		m_choiceInput.reset();</span>
<span class="nc" id="L1432">		m_choiceInput.setIsMultiSelect(isMultiSelect);</span>
<span class="nc" id="L1433">		m_choiceInput.setInputName(name);</span>
<span class="nc" id="L1434">		m_choiceInput.setValue(value);</span>
<span class="nc" id="L1435">		m_choiceInput.setIsChecked(checked);</span>
<span class="nc" id="L1436">		m_choiceInput.setIsDisabled(disabled);</span>
<span class="nc" id="L1437">		m_choiceInput.setOnClickJS(onClickJS);</span>
<span class="nc" id="L1438">		return m_choiceInput.getHtmlDisplay();</span>
	}


    /**
     * Get the complete title of a section.
     * @param mainTitle The main part of the title.
     * @param ancestorOrgName The name of the ancestor from which the settings of this section were inheritted.
     * @return The complete title of the section.
     */
	private String getSectionTitle(String mainTitle, String ancestorOrgName) {
<span class="nc" id="L1449">		ID myID = getSelectedIDObject();</span>

<span class="nc bnc" id="L1451" title="All 4 branches missed.">		if (myID.equals(Organization.ROOT_ORG_ID_OBJ) || myID.equals(Organization.YOUR_COMPANY_ID_OBJ)) {</span>
<span class="nc" id="L1452">			return (mainTitle);</span>
		}

<span class="nc bnc" id="L1455" title="All 2 branches missed.">		if (ancestorOrgName != null) {</span>
<span class="nc" id="L1456">			Object[] args = new Object[] { ancestorOrgName };</span>
<span class="nc" id="L1457">			return mainTitle + &quot; &quot; + m_localizer.i18n(m_rmBundle, RmWebBundleKey.ORG_RM_SETTINGS_INHERITED_FROM_ORG, args); //&quot;(Settings inherited from organization:&quot;</span>
		} else {
<span class="nc" id="L1459">			return (mainTitle + &quot; &quot; + i18n(m_rmBundle, RmWebBundleKey.ORG_RM_SETTINGS_OVERRIDE_PARENT_ORG)); //&quot;(Settings override parent org)&quot;</span>
		}

	}

    /**
     * Given a key, return the name of the ancestor org from which it was inheritted, or null if none.
     * You must have already set the m_ancestors variable.
     * @param key An RM settings key.
     * @return The name of the ancestor org from which it was inheritted, or null if none.
     */
	private String getAncestor(String key) {
<span class="nc bnc" id="L1471" title="All 2 branches missed.">		if (m_ancestors == null) {</span>
<span class="nc" id="L1472">			return null;</span>
		}
<span class="nc" id="L1474">		return (String) m_ancestors.get(key);</span>
	}

    /**
     * Determines whether the current org has any children.
     * @return True if the current org has any children, false otherwise.
     */
	private boolean hasChildOrgs() {
<span class="nc" id="L1482">		return m_hasChildren;</span>
	}

	/**
	 * Creates the Custom Shift Requests Form
	 */
	private void createCustomShiftForm() {

<span class="nc" id="L1490">		m_customShiftContainerPC.setWidth(WIDTH);</span>
<span class="nc" id="L1491">		m_customShiftContainerPC.setWrapperCSSClass(FWRAPPER);</span>
<span class="nc" id="L1492">		m_customShiftContainerPC.setLastRowType(ListContainerPC.LAST_ROW_NONE);</span>

<span class="nc bnc" id="L1494" title="All 2 branches missed.">		boolean disabled = !isAuthorizedToConfigureCustomShift();</span>
<span class="nc" id="L1495">		String ancestor = null;</span>
<span class="nc" id="L1496">		String TAB = &quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&quot;;</span>
<span class="nc" id="L1497">		addJSVariable(&quot;MUST_ENABLE_CS_SUB_SETTING&quot;, m_rmBundle, RmWebBundleKey.MUST_ENABLE_CS_SUB_SETTING);</span>
<span class="nc" id="L1498">		addJSVariable(&quot;MUST_ENABLE_NEW_SHIFT_SUB_SETTING&quot;, m_rmBundle, RmWebBundleKey.MUST_ENABLE_NEW_SHIFT_SUB_SETTING);</span>

		{
			//Allow requests for new shifts
<span class="nc" id="L1502">			String nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_ENABLE_CUSTOM_SHIFT_REQUESTS);</span>
<span class="nc" id="L1503">			String key = RmWebBundleKey.ORG_RM_SETTINGS_ENABLE_CUSTOM_SHIFT_REQUESTS;</span>
<span class="nc" id="L1504">			boolean checked = m_settings.getEnableCustomShiftRequests();</span>
<span class="nc" id="L1505">			String checkbox = makeChoiceInput(nameKey, &quot;true&quot;, checked, disabled, true, JSUtil.ON_CHANGE + &quot;;maybeEnableOrDisableAllCSSettings()&quot;);</span>
<span class="nc" id="L1506">			String label = i18n(m_rmBundle, key);</span>
<span class="nc bnc" id="L1507" title="All 2 branches missed.">			ancestor = (ancestor != null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_ENABLE_CUSTOM_SHIFT_REQUESTS);</span>

			//Allow requests for changes to existing shifts
<span class="nc" id="L1510">			String nameKey2 = getNameKey(RmSettingKey.ORG_RM_SETTINGS_ALLOW_SHIFT_CHANGE_REQUESTS);</span>
<span class="nc" id="L1511">			String key2 = RmWebBundleKey.ORG_RM_SETTINGS_ALLOW_SHIFT_CHANGE_REQUESTS;</span>
<span class="nc" id="L1512">			boolean checked2 = m_settings.getAllowShiftChangeRequests();</span>
<span class="nc" id="L1513">			String checkbox2 = makeChoiceInput(nameKey2, &quot;true&quot;, checked2, disabled, true, JSUtil.ON_CHANGE + &quot;;maybeEnableOrDisableAllCSSettings()&quot;);</span>
<span class="nc" id="L1514">			String label2 = i18n(m_rmBundle, key2);</span>

<span class="nc" id="L1516">			String enableString = i18n(m_rmBundle, RmWebBundleKey.ORG_RM_SETTINGS_ENABLE_ANY_SHIFT_REQUESTS); //&quot;Enable Shift Requests &amp; Changes&quot;</span>
<span class="nc" id="L1517">			m_customShiftContainerPC.addRowData(enableString + &quot;: &amp;nbsp;&amp;nbsp; &quot; + checkbox + &quot; &quot; + label + &quot; &amp;nbsp;&amp;nbsp; &quot; + checkbox2 + &quot; &quot; + label2);</span>
<span class="nc bnc" id="L1518" title="All 2 branches missed.">			ancestor = (ancestor != null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_ALLOW_SHIFT_CHANGE_REQUESTS);</span>

			//all the other settings are disabled if both of these are unchecked
<span class="nc bnc" id="L1521" title="All 6 branches missed.">			disabled = disabled || (!checked &amp;&amp; !checked2);</span>
		}

		{
			//Allow requests for regular (non-overtime) shifts
<span class="nc" id="L1526">			String nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_ALLOW_ENTIRE_REGULAR_SHIFT);</span>
<span class="nc" id="L1527">			String key = RmWebBundleKey.ORG_RM_SETTINGS_ALLOW_ENTIRE_REGULAR_SHIFT;</span>
<span class="nc" id="L1528">			boolean checked = m_settings.getAllowEntireRegularShift();</span>
<span class="nc" id="L1529">			String checkbox = makeChoiceInput(nameKey, &quot;true&quot;, checked, disabled, true);</span>
<span class="nc" id="L1530">			String label = i18n(m_rmBundle, key);</span>
<span class="nc" id="L1531">			m_customShiftContainerPC.addRowData(TAB + checkbox + &quot; &quot; + label);</span>
<span class="nc bnc" id="L1532" title="All 2 branches missed.">			ancestor = (ancestor != null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_ALLOW_ENTIRE_REGULAR_SHIFT);</span>
		}

		{
			//Allow requests for overtime shifts
<span class="nc" id="L1537">			String nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_ALLOW_ENTIRE_OT_SHIFT);</span>
<span class="nc" id="L1538">			String key = RmWebBundleKey.ORG_RM_SETTINGS_ALLOW_ENTIRE_OT_SHIFT;</span>
<span class="nc" id="L1539">			boolean checked = m_settings.getAllowEntireOTShift();</span>
<span class="nc" id="L1540">			String checkbox = makeChoiceInput(nameKey, &quot;true&quot;, checked, disabled, true);</span>
<span class="nc" id="L1541">			String label = i18n(m_rmBundle, key);</span>
<span class="nc" id="L1542">			m_customShiftContainerPC.addRowData(TAB + checkbox + &quot; &quot; + label);</span>
<span class="nc bnc" id="L1543" title="All 2 branches missed.">			ancestor = (ancestor != null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_ALLOW_ENTIRE_OT_SHIFT);</span>
		}

		{
			//Allow requests for regular (non-overtime) extensions before a shift
<span class="nc" id="L1548">			String nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_ALLOW_REGULAR_EXTENSION_BEFORE_SHIFT);</span>
<span class="nc" id="L1549">			String key = RmWebBundleKey.ORG_RM_SETTINGS_ALLOW_REGULAR_EXTENSION_BEFORE_SHIFT;</span>
<span class="nc" id="L1550">			boolean checked = m_settings.getAllowRegularExtensionBeforeShift();</span>
<span class="nc" id="L1551">			String checkbox = makeChoiceInput(nameKey, &quot;true&quot;, checked, disabled, true);</span>
<span class="nc" id="L1552">			String label = i18n(m_rmBundle, key);</span>
<span class="nc" id="L1553">			m_customShiftContainerPC.addRowData(TAB + checkbox + &quot; &quot; + label);</span>
<span class="nc bnc" id="L1554" title="All 2 branches missed.">			ancestor = (ancestor != null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_ALLOW_REGULAR_EXTENSION_BEFORE_SHIFT);</span>
		}

		{
			//Allow requests for regular (non-overtime) extensions after a shift
<span class="nc" id="L1559">			String nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_ALLOW_REGULAR_EXTENSION_AFTER_SHIFT);</span>
<span class="nc" id="L1560">			String key = RmWebBundleKey.ORG_RM_SETTINGS_ALLOW_REGULAR_EXTENSION_AFTER_SHIFT;</span>
<span class="nc" id="L1561">			boolean checked = m_settings.getAllowRegularExtensionAfterShift();</span>
<span class="nc" id="L1562">			String checkbox = makeChoiceInput(nameKey, &quot;true&quot;, checked, disabled, true);</span>
<span class="nc" id="L1563">			String label = i18n(m_rmBundle, key);</span>
<span class="nc" id="L1564">			m_customShiftContainerPC.addRowData(TAB + checkbox + &quot; &quot; + label);</span>
<span class="nc bnc" id="L1565" title="All 2 branches missed.">			ancestor = (ancestor != null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_ALLOW_REGULAR_EXTENSION_AFTER_SHIFT);</span>
		}
<span class="nc bnc" id="L1567" title="All 2 branches missed.">		if (LicenseUtil.isAdvancedRMLicense()) {</span>
			//Allow requests for extensions in gaps
<span class="nc" id="L1569">			String nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_ALLOW_REGULAR_EXTENSION_DURING_GAP);</span>
<span class="nc" id="L1570">			String key = RmWebBundleKey.ORG_RM_SETTINGS_ALLOW_REGULAR_EXTENSION_DURING_GAP;</span>
<span class="nc" id="L1571">			boolean checked = m_settings.getAllowRegularExtensionDuringGap();</span>
<span class="nc" id="L1572">			String checkbox = makeChoiceInput(nameKey, &quot;true&quot;, checked, disabled, true);</span>
<span class="nc" id="L1573">			String label = i18n(m_rmBundle, key);</span>
<span class="nc" id="L1574">			m_customShiftContainerPC.addRowData(TAB + checkbox + &quot; &quot; + label);</span>
<span class="nc bnc" id="L1575" title="All 2 branches missed.">			ancestor = (ancestor != null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_ALLOW_REGULAR_EXTENSION_DURING_GAP);</span>
		}
		{
			//Allow requests for overtime extensions before a shift
<span class="nc" id="L1579">			String nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_ALLOW_OT_BEFORE_SHIFT);</span>
<span class="nc" id="L1580">			String key = RmWebBundleKey.ORG_RM_SETTINGS_ALLOW_OT_BEFORE_SHIFT;</span>
<span class="nc" id="L1581">			boolean checked = m_settings.getAllowOTBeforeShift();</span>
<span class="nc" id="L1582">			String checkbox = makeChoiceInput(nameKey, &quot;true&quot;, checked, disabled, true);</span>
<span class="nc" id="L1583">			String label = i18n(m_rmBundle, key);</span>
<span class="nc" id="L1584">			m_customShiftContainerPC.addRowData(TAB + checkbox + &quot; &quot; + label);</span>
<span class="nc bnc" id="L1585" title="All 2 branches missed.">			ancestor = (ancestor != null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_ALLOW_OT_BEFORE_SHIFT);</span>
		}

		{
			//Allow requests for overtime extensions after a shift
<span class="nc" id="L1590">			String nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_ALLOW_OT_AFTER_SHIFT);</span>
<span class="nc" id="L1591">			String key = RmWebBundleKey.ORG_RM_SETTINGS_ALLOW_OT_AFTER_SHIFT;</span>
<span class="nc" id="L1592">			boolean checked = m_settings.getAllowOTAfterShift();</span>
<span class="nc" id="L1593">			String checkbox = makeChoiceInput(nameKey, &quot;true&quot;, checked, disabled, true);</span>
<span class="nc" id="L1594">			String label = i18n(m_rmBundle, key);</span>
<span class="nc" id="L1595">			m_customShiftContainerPC.addRowData(TAB + checkbox + &quot; &quot; + label);</span>
<span class="nc bnc" id="L1596" title="All 2 branches missed.">			ancestor = (ancestor != null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_ALLOW_OT_AFTER_SHIFT);</span>
		}
		{
			//Allow editing of duration for overtime extension requests
<span class="nc" id="L1600">			String nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_ALLOW_EDIT_OT_REQUESTS_DURATION);</span>
<span class="nc" id="L1601">			String key = RmWebBundleKey.ORG_RM_SETTINGS_ALLOW_EDIT_OT_REQUESTS_DURATION;</span>
<span class="nc" id="L1602">			boolean checked = m_settings.getAllowEditOvertimeDuration();</span>
<span class="nc" id="L1603">			String checkbox = makeChoiceInput(nameKey, &quot;true&quot;, checked, disabled, true);</span>
<span class="nc" id="L1604">			String label = i18n(m_rmBundle, key);</span>
<span class="nc" id="L1605">			m_customShiftContainerPC.addRowData(TAB + checkbox + &quot; &quot; + label);</span>
<span class="nc bnc" id="L1606" title="All 2 branches missed.">			ancestor = (ancestor != null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_ALLOW_EDIT_OT_REQUESTS_DURATION);</span>
		}
		{
			//Allow editing of gap for overtime extension requests
<span class="nc" id="L1610">			String nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_ALLOW_EDIT_OT_REQUESTS_GAP);</span>
<span class="nc" id="L1611">			String key = RmWebBundleKey.ORG_RM_SETTINGS_ALLOW_EDIT_OT_REQUESTS_GAP;</span>
<span class="nc" id="L1612">			boolean checked = m_settings.getAllowEditOvertimeGap();</span>
<span class="nc" id="L1613">			String checkbox = makeChoiceInput(nameKey, &quot;true&quot;, checked, disabled, true);</span>
<span class="nc" id="L1614">			String label = i18n(m_rmBundle, key);</span>
<span class="nc" id="L1615">			m_customShiftContainerPC.addRowData(TAB + checkbox + &quot; &quot; + label);</span>
<span class="nc bnc" id="L1616" title="All 2 branches missed.">			ancestor = (ancestor != null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_ALLOW_EDIT_OT_REQUESTS_GAP);</span>
		}


<span class="nc" id="L1620">		m_customShiftContainerPC.setTitle(getSectionTitle(i18n(m_rmBundle,</span>
		        RmWebBundleKey.ORG_RM_SETTINGS_CUSTOM_SHIFT_REQUESTS_TITLE), ancestor));

		// Add the Custom Shift Form
<span class="nc" id="L1624">		addChildComponent(m_customShiftContainerPC);</span>
<span class="nc" id="L1625">	}</span>

	/**
	 * Create the Custom Shift Request Policies form
	 */
	private void createCSPoliciesForm()
	{
		CollapsibleContainerPC policiesPC;
<span class="nc" id="L1633">		String nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_CS_POLICY);</span>
<span class="nc" id="L1634">		String policy = m_settings.getCustomShiftPolicy();</span>
<span class="nc bnc" id="L1635" title="All 2 branches missed.">		boolean disabled = !isAuthorizedToConfigureCSPolicies();</span>
<span class="nc" id="L1636">		int idx = CS_POLICY_INDEX;</span>

<span class="nc bnc" id="L1638" title="All 2 branches missed.">		if (policy == null) {</span>
<span class="nc" id="L1639">			policy = &quot;&quot;;</span>
		}

<span class="nc" id="L1642">		policiesPC = new CollapsibleContainerPC(m_context);</span>
<span class="nc" id="L1643">		String title = (&quot; &quot; + i18n(m_rmBundle, RmWebBundleKey.ORG_RM_SETTINGS_CS_POLICY_TITLE));</span>
<span class="nc" id="L1644">		policiesPC.setName(POLICY_CONTAINER + idx);</span>
<span class="nc" id="L1645">		policiesPC.setWidth(WIDTH);</span>
<span class="nc" id="L1646">		policiesPC.setStyleClass(FWRAPPER);</span>

<span class="nc" id="L1648">		policiesPC.setTemplate(POLICY_TEMPLATE);</span>

<span class="nc" id="L1650">		String textArea = HtmlUtil.makeTextAreaInput(nameKey,</span>
		        135,
		        7,
<span class="nc" id="L1653">		        getOnChangeJS(),</span>
		        true,
		        disabled,
		        policy);
<span class="nc" id="L1657">		policiesPC.addComponent(textArea);</span>

<span class="nc" id="L1659">		String ancestor = getAncestor(RmSettingKey.ORG_RM_SETTINGS_CS_POLICY);</span>
<span class="nc" id="L1660">		policiesPC.setTitle(getSectionTitle(title, ancestor));</span>

<span class="nc" id="L1662">		m_settingsPolicyContainerMap.put(CS_POLICY,policiesPC);</span>
<span class="nc" id="L1663">		addChildComponent(policiesPC);</span>
<span class="nc" id="L1664">	}</span>

	@Override
	public boolean extractParameters(HttpServletRequest request){
<span class="nc" id="L1668">		return super.extractParameters(request);</span>

	}

	@Override
	public boolean validate(){
<span class="nc" id="L1674">		return super.validate();</span>
	}


	/**
	 * Creates the Required Pay Period Hours Form
	 */

	private void createRequiredPayPeriodHoursForm(){


<span class="nc" id="L1685">		requiredPayPeriodHoursContainerPC.setWidth(WIDTH);</span>
<span class="nc" id="L1686">		requiredPayPeriodHoursContainerPC.setWrapperCSSClass(FWRAPPER);</span>
<span class="nc" id="L1687">		requiredPayPeriodHoursContainerPC.setLastRowType(ListContainerPC.LAST_ROW_NONE);</span>
<span class="nc" id="L1688">		String ancestor = null;</span>
<span class="nc" id="L1689">		boolean enabled = isAuthorizedToConfigureRequiredPayPeriodHours();</span>

<span class="nc" id="L1691">		boolean payPeriodHoursChecked = m_settings.getRequiredPayPeriodHoursTrack();</span>
		{
			//Track required hours checkbox
<span class="nc" id="L1694">			String nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_REQUIRED_PAY_PERIOD_TRACK);</span>
<span class="nc" id="L1695">			String key = RmWebBundleKey.REQUIRED_PAY_PERIOD_HOURS_TRACK;</span>

<span class="nc bnc" id="L1697" title="All 2 branches missed.">			String checkbox = makeChoiceInput(nameKey, &quot;true&quot;, payPeriodHoursChecked, !enabled, true, JSUtil.ON_CHANGE</span>
					+ &quot;;enableDisableAllRequiredPayPeriodSettings();&quot;);
<span class="nc" id="L1699">			String label = i18n(m_rmBundle, key);</span>
<span class="nc" id="L1700">			requiredPayPeriodHoursContainerPC.addRowData(checkbox + &quot; &quot; + label);</span>
<span class="nc bnc" id="L1701" title="All 2 branches missed.">			ancestor = (ancestor != null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_REQUIRED_PAY_PERIOD_TRACK);</span>
		}


<span class="nc" id="L1705">		String selectedPayPeriod = &quot;&quot;;</span>
		{
<span class="nc" id="L1707">			List&lt;StringsPair&gt; options = getRequiredPayPeriodOptions(m_localizer);</span>

<span class="nc" id="L1709">			selectedPayPeriod = m_settings.getRequiredPayPeriodHoursPeriod();</span>
<span class="nc bnc" id="L1710" title="All 4 branches missed.">			if(selectedPayPeriod==null || selectedPayPeriod.isEmpty()){</span>
<span class="nc" id="L1711">				selectedPayPeriod = i18n(m_rmBundle, RmWebBundleKey.REQUIRED_PAY_PERIOD_HOURS_PERIOD_WEEKLY);</span>
			}

<span class="nc" id="L1714">			String nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_REQUIRED_PAY_PERIOD_PERIOD);</span>
<span class="nc" id="L1715">            String payPeriodLabel = i18n(m_rmBundle, RmWebBundleKey.REQUIRED_PAY_PERIOD_HOURS_PERIOD);</span>
<span class="nc" id="L1716">			String dropDown = HtmlUtil.makeSelectInput(nameKey, options, null, selectedPayPeriod, payPeriodLabel, getOnChangeJS()</span>
					+ &quot; onChangeRequiredPayPeriodPeriod(this); &quot;, enabled);

<span class="nc" id="L1719">            requiredPayPeriodHoursContainerPC.addRowData(payPeriodLabel + &quot; &quot; + dropDown);</span>

<span class="nc bnc" id="L1721" title="All 2 branches missed.">            ancestor = (ancestor != null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_REQUIRED_PAY_PERIOD_PERIOD);</span>
		}

		//Start Date
		{
<span class="nc" id="L1726">			String dateLabel = i18n(m_rmBundle, RmWebBundleKey.REQUIRED_PAY_PERIOD_HOURS_STARTDATE);</span>
<span class="nc" id="L1727">			String nameKey = getNameKey(RmSettingKey.ORG_RM_SETTINGS_REQUIRED_PAY_PERIOD_STARTDATE);</span>
<span class="nc" id="L1728">			datePickerPC.setDateInputFieldName(nameKey);</span>
<span class="nc" id="L1729">			datePickerPC.setName(&quot;RequiredHoursPayPeriodDatePicker&quot;);</span>

<span class="nc" id="L1731">			datePickerPC.setIsTimeEnabled(false);</span>
<span class="nc" id="L1732">			Date startDate = m_settings.getRequiredPayPeriodHoursStartDate();</span>
<span class="nc" id="L1733">			datePickerPC.setDate(startDate);</span>
<span class="nc bnc" id="L1734" title="All 2 branches missed.">			if (selectedPayPeriod.equalsIgnoreCase(RequiredPayPeriodHoursUtil.PERIOD_MONTHLY)) {</span>
				//Fix after foundation
				//datePickerPC.setMaxDayOfMonth(28);
			}
<span class="nc bnc" id="L1738" title="All 2 branches missed.">			if (!enabled) {</span>
<span class="nc" id="L1739">				datePickerPC.setIsPickerEnabled(false);</span>
<span class="nc" id="L1740">				datePickerPC.setIsControlEnabled(false);</span>
<span class="nc" id="L1741">				datePickerPC.setInputType(DatePickerPC.INPUT_TYPE_READONLY);</span>
			}

<span class="nc" id="L1744">			datePickerPC.initForDisplay();</span>
<span class="nc" id="L1745">			addChildComponent(datePickerPC);</span>

<span class="nc" id="L1747">			requiredPayPeriodHoursContainerPC.addRowData(dateLabel + &quot; &quot; + datePickerPC.getHtmlDisplay());</span>

<span class="nc bnc" id="L1749" title="All 2 branches missed.">			ancestor = (ancestor != null) ? ancestor : getAncestor(RmSettingKey.ORG_RM_SETTINGS_REQUIRED_PAY_PERIOD_STARTDATE);</span>
		}

<span class="nc" id="L1752">		String title = getSectionTitle(i18n(RmWebBundleKey.REQUIRED_PAY_PERIOD_HOURS), ancestor);</span>
<span class="nc" id="L1753">		requiredPayPeriodHoursContainerPC.setTitle(title);</span>
<span class="nc" id="L1754">	    addChildComponent(requiredPayPeriodHoursContainerPC);</span>

<span class="nc" id="L1756">	}</span>
	String getStartDateString (String dateString){
<span class="nc" id="L1758">		Date dt = datePickerPC.convertStrToDate(dateString);</span>
<span class="nc bnc" id="L1759" title="All 2 branches missed.">		if(dt==null){</span>
<span class="nc" id="L1760">			return &quot;&quot;;</span>
		}
<span class="nc" id="L1762">		SimpleDateFormat simpleDateFormat = new SimpleDateFormat(</span>
				&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L1764">		simpleDateFormat.setTimeZone(TimeZone.getTimeZone(&quot;GMT&quot;));</span>
<span class="nc" id="L1765">		String formatted = simpleDateFormat.format(dt);</span>
<span class="nc" id="L1766">		return formatted;</span>
	}



	public boolean isAuthorizedToConfigureRequiredPayPeriodHours() {
<span class="nc bnc" id="L1772" title="All 2 branches missed.">		return isValidSelectedOrg()</span>
<span class="nc bnc" id="L1773" title="All 2 branches missed.">			&amp;&amp; m_context.getUser().isAuthorized(</span>
<span class="nc" id="L1774">					PrivilegeKeys.FS_CONFIGUREPREQUIREDPAYPERIOD, OrganizationScopeManagerProxy.getScopeID(getSelectedIDObject()));</span>
	}

	public boolean isAdvancedRMLicense(){
<span class="nc" id="L1778">		return LicenseUtil.isAdvancedRMLicense();</span>
	}



	// QC 201019: Adding getters for the validators.

	public String getBluepumpkin_rm_settings_shiftbiding_maxprefvalue() { // NOSONAR
<span class="nc" id="L1786">		return m_context.getParameter(getNameKey(RmSettingKey.ORG_RM_SETTINGS_MAX_PREFERENCE_VALUE));</span>
	}

	public String getBluepumpkin_rm_settings_shiftbiding_maxBidsPerEmployee() { // NOSONAR
<span class="nc" id="L1790">		return m_context.getParameter(getNameKey(RmSettingKey.ORG_RM_SETTINGS_MAX_BIDS_PER_EMPLOYEE));</span>
	}

	public String getBluepumpkin_rm_maxSwapNegotiations() { // NOSONAR
<span class="nc" id="L1794">		return m_context.getParameter(getNameKey(RmSettingKey.ORG_RM_SETTINGS_MAX_SWAP_NEGOTIATIONS));</span>
	}

	public String getBluepumpkin_rm_settings_shiftbiding_bonuspointfactor() { // NOSONAR
<span class="nc" id="L1798">		return m_context.getParameter(getNameKey(RmSettingKey.ORG_RM_SETTINGS_BONUSPOINT_FACTOR));</span>
	}

	public String getBluepumpkin_rm_settings_shiftbiding_seniorityfactor() { // NOSONAR
<span class="nc" id="L1802">		return m_context.getParameter(getNameKey(RmSettingKey.ORG_RM_SETTINGS_SENIORITY_FACTOR));</span>
	}

	public String getBluepumpkin_rm_settings_shiftbiding_rankfactor() { // NOSONAR
<span class="nc" id="L1806">		return m_context.getParameter(getNameKey(RmSettingKey.ORG_RM_SETTINGS_RANK_FACTOR));</span>
	}

	public static List&lt;StringsPair&gt; getRequiredPayPeriodOptions(Localizer localizer) {
<span class="nc" id="L1810">		List&lt;StringsPair&gt; options = new ArrayList&lt;StringsPair&gt;(3);</span>
<span class="nc" id="L1811">		options.add(new StringsPair(RequiredPayPeriodHoursUtil.PERIOD_WEEKLY,</span>
<span class="nc" id="L1812">				localizer.i18n(RmWebBundleKey.BUNDLE_NAME, RmWebBundleKey.REQUIRED_PAY_PERIOD_HOURS_PERIOD_WEEKLY)));</span>
<span class="nc" id="L1813">		options.add(new StringsPair(RequiredPayPeriodHoursUtil.PERIOD_BIWEEKLY,</span>
<span class="nc" id="L1814">				localizer.i18n(RmWebBundleKey.BUNDLE_NAME, RmWebBundleKey.REQUIRED_PAY_PERIOD_HOURS_PERIOD_BIWEEKLY)));</span>
<span class="nc" id="L1815">		options.add(new StringsPair(RequiredPayPeriodHoursUtil.PERIOD_MONTHLY,</span>
<span class="nc" id="L1816">				localizer.i18n(RmWebBundleKey.BUNDLE_NAME, RmWebBundleKey.REQUIRED_PAY_PERIOD_HOURS_PERIOD_MONTHLY)));</span>
<span class="nc" id="L1817">		return options;</span>
	}

	public static Collection&lt;StringsPair&gt; getTimeOffRoundingOptionPairs(Localizer localizer) {
<span class="nc" id="L1821">		Collection&lt;StringsPair&gt; roundingOptions = new ArrayList&lt;StringsPair&gt;();</span>
<span class="nc" id="L1822">		roundingOptions.add(new StringsPair(_1MINUTE, localizer.i18n(RmWebBundleKey.BUNDLE_NAME, RmWebBundleKey.TIMEOFF_ROUNDING_1MIN)));</span>
<span class="nc" id="L1823">		roundingOptions.add(new StringsPair(_15MINUTE, localizer.i18n(RmWebBundleKey.BUNDLE_NAME, RmWebBundleKey.TIMEOFF_ROUNDING_15MIN)));</span>
<span class="nc" id="L1824">		roundingOptions.add(new StringsPair(HOUR, localizer.i18n(RmWebBundleKey.BUNDLE_NAME, RmWebBundleKey.TIMEOFF_ROUNDING_HOUR)));</span>
<span class="nc" id="L1825">		roundingOptions.add(new StringsPair(DAY, localizer.i18n(RmWebBundleKey.BUNDLE_NAME, RmWebBundleKey.TIMEOFF_ROUNDING_DAY)));</span>
<span class="nc" id="L1826">		return roundingOptions;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>