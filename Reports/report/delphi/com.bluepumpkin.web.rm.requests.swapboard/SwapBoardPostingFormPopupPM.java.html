<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>SwapBoardPostingFormPopupPM.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.rm.requests.swapboard</a> &gt; <span class="el_source">SwapBoardPostingFormPopupPM.java</span></div><h1>SwapBoardPostingFormPopupPM.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.rm.requests.swapboard;

import java.util.ArrayList;
import java.util.Calendar;
import java.util.Collection;
import java.util.Date;
import java.util.Iterator;
import java.util.List;

import javax.servlet.http.HttpServletRequest;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.util.BPMessageFormat;
import com.bluepumpkin.common.util.DateTimeUtil;
import com.bluepumpkin.ejb.bbm.activity.model.Event;
import com.bluepumpkin.ejb.bbm.schedule.model.ShiftAssignment;
import com.bluepumpkin.ejb.rm.requests.swap.posting.model.ShiftSwapPosting;
import com.bluepumpkin.ejb.rm.requests.swap.shiftitem.model.ShiftSwapItem;
import com.bluepumpkin.web.bbm.l10n.BbmWebBundleKey;
import com.bluepumpkin.web.rm.IHavePageMessage;
import com.bluepumpkin.web.rm.keys.RmKeys;
import com.bluepumpkin.web.rm.l10n.RmWebBundleKey;
import com.bluepumpkin.web.rm.l10n.RmWebLogBundleKey;
import com.bluepumpkin.web.rm.requests.SwapFormPopupPM;
import com.bluepumpkin.web.rm.requests.SwapUtil;
import com.verint.ejb.wfm.WfmManagerFactory;
import com.witness.web.uif.base.Message;
import com.witness.web.uif.pagecomponent.picker.date.DatePickerPC;
import com.witness.web.uif.pagecomponent.picker.date.DateRangePickerPC;
import com.witness.web.uif.pagemodel.PageModel;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.system.manager.impl.DefaultVerticalizationManager;
import com.witness.web.uif.util.HtmlUtil;
import com.witness.web.uif.util.html.HtmlChoiceInput;
import com.witness.web.uif.validator.InLengthRangeFieldValidator;

/**
 * Title:		     SwapBoardPostingFormPopupPM
 * Description:  Swap Board Posting Form
 * Copyright:    Copyright (c) 2001
 * Company:      Blue Pumpkin Software, inc
 * @author       Zhibo Wang, David Su
 * @version      1.0
 */
public class SwapBoardPostingFormPopupPM extends SwapFormPopupPM implements IHavePageMessage {
	private static final String POSTING_ID_FN = &quot;postingID&quot;;
	private static final String TIMERANGE_FN  = &quot;timeRange&quot;;

	private ShiftSwapPosting m_posting;
	private Date m_shiftDate;
	private DateRangePickerPC m_dateRangePickerPC;

	/**
	 * Constructor
	 */
	public SwapBoardPostingFormPopupPM(RequestContext context) {
<span class="nc" id="L57">		super(context, RmKeys.RH_SWAPBOARD_FORM);</span>

<span class="nc" id="L59">		m_posting = new ShiftSwapPosting(ShiftSwapPosting.DL_BASIC);</span>
<span class="nc" id="L60">		initShiftSwapItem();</span>

		// Add Field Validator
<span class="nc" id="L63">		InLengthRangeFieldValidator fv = new InLengthRangeFieldValidator(this,</span>
				COMMENT_FN, RmWebBundleKey.SWAPBOARD_POSTING_COMMENT,
				RmWebBundleKey.BUNDLE_NAME, 0, 200);
<span class="nc" id="L66">		addValidator(fv);</span>

<span class="nc" id="L68">		initDateRangePickerPC();</span>
<span class="nc" id="L69">	}</span>

	protected void initDataPickersWithOrgWeekStartDay(int weekStartDay) {
<span class="nc" id="L72">		m_dateRangePickerPC.setFirstDayOfWeek(weekStartDay);</span>
<span class="nc" id="L73">	}</span>

	/**
	 * Create and add Date Range Picker as Child Component
	 */
	private void initDateRangePickerPC() {
<span class="nc" id="L79">		m_dateRangePickerPC = new DateRangePickerPC(m_context, TIMERANGE_FN);</span>
<span class="nc" id="L80">		m_dateRangePickerPC.setIsTimeEnabled(true);</span>
<span class="nc" id="L81">		m_dateRangePickerPC.getStartDatePickerPC().setTimeInterval(15);//</span>
<span class="nc" id="L82">		m_dateRangePickerPC.getEndDatePickerPC().setTimeInterval(15);</span>

		// initialize date pickers properties
<span class="nc" id="L85">		DatePickerPC startDatePC = m_dateRangePickerPC.getStartDatePickerPC();</span>
<span class="nc" id="L86">		DatePickerPC endDatePC = m_dateRangePickerPC.getEndDatePickerPC();</span>

		//date should be factor of 15
<span class="nc" id="L89">		Calendar startCal = Calendar.getInstance(m_context.getViewingTimeZone());</span>
<span class="nc" id="L90">		startCal.setTime(new Date());</span>
<span class="nc bnc" id="L91" title="All 2 branches missed.">		while ((startCal.get(Calendar.MINUTE)%15) != 0 ){</span>
<span class="nc" id="L92">			startCal.add(Calendar.MINUTE, 1);</span>
		}
<span class="nc" id="L94">		startDatePC.setLowerLimit(startCal.getTime());</span>
<span class="nc" id="L95">		m_dateRangePickerPC.getStartDatePickerPC().setDate(startCal.getTime());</span>

		//set upper date limit to 12/31/2078
<span class="nc" id="L98">		Calendar cal = Calendar.getInstance(m_context.getViewingTimeZone());</span>
<span class="nc" id="L99">		cal.set(2079,1,1,0,0,0);</span>
<span class="nc" id="L100">		endDatePC.setUpperLimit(cal.getTime());</span>
<span class="nc" id="L101">		addChildComponent(m_dateRangePickerPC);</span>

<span class="nc" id="L103">		cal.setTime(new Date());</span>
<span class="nc" id="L104">		cal.add(Calendar.DATE, 1);</span>
<span class="nc" id="L105">		cal.set(Calendar.HOUR_OF_DAY, 0);</span>
<span class="nc" id="L106">		cal.set(Calendar.MINUTE, 0);</span>
<span class="nc" id="L107">		endDatePC.setDate(cal.getTime());</span>
<span class="nc" id="L108">	}</span>

	/**
	 * Return an instance of the model that is ready for rendering
	 */
	public static PageModel getInstance(RequestContext context) throws Exception {
<span class="nc" id="L114">		return getInstance(context, SwapBoardPostingFormPopupPM.class);</span>
	}//getInstance

	/**
	 * Load Specific Data
	 */
	protected void loadSpecificData() throws Exception {
<span class="nc bnc" id="L121" title="All 2 branches missed.">		if (!isNew()) {</span>
<span class="nc" id="L122">			ID postingID = getPostingID();</span>
<span class="nc" id="L123">			m_posting = RequestsSwapBoardMH.getPostingByID(postingID);</span>
<span class="nc bnc" id="L124" title="All 2 branches missed.">			if(!m_posting.getShiftSwapItem().getEmployeeID().equals(m_context.getUser().getEmployeeID()))</span>
<span class="nc" id="L125">				throw new Exception();</span>
<span class="nc" id="L126">			m_shiftDate = m_posting.getShiftSwapItem().getStartDate();</span>
		}
<span class="nc" id="L128">	}</span>

	/**
	 * Prepare content title for rendering
	 */
	protected void initContentTitle() {
<span class="nc bnc" id="L134" title="All 2 branches missed.">		String rbKey = isNew()?</span>
				RmWebBundleKey.SWAPBOARD_POSTING_ENTRY:RmWebBundleKey.SWAPBOARD_POSTING_UPDATE;
<span class="nc" id="L136">		String pageTitle = i18n(m_bundle, rbKey);</span>

<span class="nc" id="L138">		m_contentTitlePC.setPageTitle(pageTitle);</span>
<span class="nc" id="L139">	}</span>

	/**
	 * Add List Content
	 */
	protected void addListContent(List listModel) {
<span class="nc" id="L145">		addPostSentence(listModel);</span>
<span class="nc bnc" id="L146" title="All 4 branches missed.">		if (m_orgSetting.getAllowPartialShiftSwap() &amp;&amp; getShiftType().equals(ShiftSwapItem.SWAPITEMTYPE_SHIFT)) {</span>
<span class="nc bnc" id="L147" title="All 2 branches missed.">			if (isNew()) {</span>
<span class="nc" id="L148">				addPartialOptionRow(listModel);</span>
			}
			
<span class="nc bnc" id="L151" title="All 2 branches missed.">			if (m_orgSetting.getAllowPartialShiftPickup()) {</span>
<span class="nc" id="L152">				addPickupOptionRow(listModel, getAllowPartial());</span>
			}
		}
<span class="nc" id="L155">		addExpireSentence(listModel);</span>
<span class="nc" id="L156">		addNegotiationOptionRow(listModel);</span>
<span class="nc" id="L157">		addCommentRow(listModel);</span>
<span class="nc" id="L158">	}</span>

	/**
	 * Add Post Sentence
	 */
	private void addPostSentence(List listModel) {
<span class="nc" id="L164">		resetAriaTitleArgs();</span>
<span class="nc" id="L165">		String sentence_template = null;</span>
<span class="nc" id="L166">		Date date = m_shiftDate;</span>
<span class="nc" id="L167">		Object[] args = null;</span>
<span class="nc bnc" id="L168" title="All 2 branches missed.">		if (isNew()) {</span>
<span class="nc bnc" id="L169" title="All 2 branches missed.">			if (m_orgSetting.getAllowPartialShiftSwap() &amp;&amp;</span>
<span class="nc bnc" id="L170" title="All 2 branches missed.">					getShiftType().equals(ShiftSwapItem.SWAPITEMTYPE_SHIFT)){</span>
<span class="nc" id="L171">				args = new Object[] {</span>
<span class="nc" id="L172">					createShiftTypeDD(),</span>
<span class="nc" id="L173">					createShiftSwapTypeDD(false)</span>
				};
<span class="nc" id="L175">				sentence_template = i18n(m_bundle, RmWebBundleKey.SWAPBOARD_NEW_PARTIAL_POSTING_SENTENCE);</span>
			} else {
<span class="nc" id="L177">				args = new Object[] {</span>
<span class="nc" id="L178">						createShiftTypeDD(),</span>
<span class="nc" id="L179">						getDatePickerHTML(SHIFT_DATE_FN, date, false, i18n(m_bbm_bundle, BbmWebBundleKey.MY_DATE), false),</span>
<span class="nc" id="L180">						createShiftSwapTypeDD(false)</span>
					};
<span class="nc" id="L182">				sentence_template = i18n(m_bundle, RmWebBundleKey.SWAPBOARD_POSTING_SENTENCE);</span>
			}
<span class="nc bnc" id="L184" title="All 2 branches missed.">		} else if (getIsPartial()){</span>
<span class="nc" id="L185">			args = new Object[] {</span>
<span class="nc" id="L186">				formatDateTime(m_posting.getShiftSwapItem().getStartDate()),</span>
<span class="nc" id="L187">				formatDateTime(m_posting.getShiftSwapItem().getEndDate()),</span>
<span class="nc" id="L188">				getShiftSwapTypeDisplay()</span>
			};
<span class="nc" id="L190">			initAriaTitleArgs(args);</span>
<span class="nc" id="L191">			sentence_template = i18n(m_bundle, RmWebBundleKey.SWAPBOARD_PARTIAL_POSTING_SENTENCE);</span>
		} else {
<span class="nc" id="L193">			args = new Object[] {</span>
<span class="nc" id="L194">					getShiftTypeDisplay(),</span>
<span class="nc" id="L195">					formatDate(date),</span>
<span class="nc" id="L196">					getShiftSwapTypeDisplay()</span>
				};
<span class="nc" id="L198">			initAriaTitleArgs(args);</span>
<span class="nc" id="L199">			sentence_template = i18n(m_bundle, RmWebBundleKey.SWAPBOARD_POSTING_SENTENCE);</span>
		}

<span class="nc" id="L202">		String sentence = BPMessageFormat.format(sentence_template, args);</span>
<span class="nc" id="L203">		setMainPCAriaTitle(BPMessageFormat.format(sentence_template, getAriaTitleArgs().toArray()));</span>
<span class="nc" id="L204">		addDataRow(sentence, listModel);</span>
<span class="nc" id="L205">	}</span>


	/**
	 * Add Expire Sentence
	 */
	private void addExpireSentence(List listModel) {
<span class="nc" id="L212">		String sentence_template = i18n(m_bundle, RmWebBundleKey.SWAPBOARD_POSTING_EXPIRATION_SENTENCE);</span>
<span class="nc" id="L213">		String ariaLabel = BPMessageFormat.format(sentence_template, new Object[] {&quot;&quot;});</span>

<span class="nc bnc" id="L215" title="All 4 branches missed.">		Date date = (isNew() &amp;&amp; !hasError())?createNewOfferExpDate():getShiftSwapItem().getExpirationDate();</span>
<span class="nc" id="L216">		DatePickerPC datePicker = getDatePicker(EXPIRATION_FN, date, true, ariaLabel, false);</span>
		//datePicker.setUpperLimitFieldID(SHIFT_DATE_FN); // Prevent Exp after Shift
<span class="nc" id="L218">		Object dateArg = datePicker.getHtmlDisplay();</span>
<span class="nc" id="L219">		Object[] args = new Object[] {dateArg};</span>
<span class="nc" id="L220">		String sentence = BPMessageFormat.format(sentence_template, args);</span>

<span class="nc" id="L222">		addDataRow(sentence, listModel);</span>
<span class="nc" id="L223">	}</span>

	/**
	 * Add Negotiation Option Row
	 */
	private void addNegotiationOptionRow(List listModel) {

<span class="nc" id="L230">		String[] args = new String[1];</span>
<span class="nc" id="L231">			args[0] = m_context.getSystemManagerFactory()</span>
<span class="nc" id="L232">			  .getVerticalizationManager().getVerticalizedString(m_context, DefaultVerticalizationManager.WORKERSMALL);</span>




<span class="nc" id="L237">		super.addNegotiationOptionRow(listModel, isNegotiable(),</span>
				RmWebBundleKey.SWAPBOARD_POSTING_NEED_FEEDBACK_FROM_AGENT,
				RmWebBundleKey.SWAPBOARD_POSTING_ALLOW_SUBMIT_TO_MGR, args);
<span class="nc" id="L240">	}</span>

	/**
	 * Add Negotiation Option Row
	 */
	protected void addPartialOptionRow(List listModel) {
<span class="nc" id="L246">		String label_toAgt = i18n(m_bundle, RmWebBundleKey.ENTIRE_SHIFT) ;</span>
<span class="nc" id="L247">		String myDateAriaLabel = i18n(m_bbm_bundle, BbmWebBundleKey.MY_DATE);</span>
<span class="nc bnc" id="L248" title="All 2 branches missed.">		String input_toAgt = HtmlChoiceInput.makeRadioInput(ISPARTIAL_FN, &quot;false&quot;, label_toAgt, !getIsPartial(), &quot;disableTab('partialShiftTab');enableTab('entireShiftTab');&quot;);</span>
<span class="nc" id="L249">		String datePickerEntireShift = getDatePickerHTML(SHIFT_DATE_FN, m_shiftDate, false, myDateAriaLabel, false);</span>
<span class="nc" id="L250">		String label_toMgr = i18n(m_bundle, RmWebBundleKey.PARTIAL_SHIFT);</span>
<span class="nc" id="L251">		String input_toMgr = HtmlChoiceInput.makeRadioInput(ISPARTIAL_FN, &quot;true&quot;, label_toMgr, getIsPartial(), &quot;disableTab('entireShiftTab');enableTab('partialShiftTab');&quot;);</span>

<span class="nc" id="L253">		StringBuffer sb = new StringBuffer(100);</span>

<span class="nc" id="L255">		sb.append(&quot;&lt;table id=\&quot;partialTable\&quot; border=\&quot;0\&quot; cellspacing=\&quot;0\&quot; cellpadding=\&quot;0\&quot;&gt;&lt;tr&gt;&lt;td&gt;&quot;);</span>
<span class="nc" id="L256">		sb.append(input_toAgt);</span>
<span class="nc" id="L257">		sb.append(&quot;&lt;/td&gt;&lt;td  id=\&quot;entireShiftTab\&quot;&quot;);</span>
<span class="nc bnc" id="L258" title="All 2 branches missed.">	 	if(getIsPartial()){</span>
<span class="nc" id="L259">       		sb.append(&quot; disabled&quot;);</span>
       	}
<span class="nc" id="L261">       	sb.append(&quot;&gt;&quot;);</span>
<span class="nc" id="L262">       	sb.append(datePickerEntireShift);</span>
<span class="nc" id="L263">       	sb.append(&quot;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&quot;);</span>
<span class="nc" id="L264">       	sb.append(input_toMgr);</span>
<span class="nc" id="L265">       	sb.append(&quot;&lt;/td&gt;&lt;td  id=\&quot;partialShiftTab\&quot;&quot;);</span>
<span class="nc bnc" id="L266" title="All 2 branches missed.">    	if(!getIsPartial()){</span>
<span class="nc" id="L267">       		sb.append(&quot; disabled&quot;);</span>
       	}
<span class="nc" id="L269">       	sb.append(&quot;&gt;&quot;);</span>

<span class="nc" id="L271">	    sb.append(m_dateRangePickerPC.toString());</span>
<span class="nc" id="L272">	    sb.append(&quot;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&quot;);</span>

<span class="nc" id="L274">		addDataRow(sb.toString(), listModel);</span>
<span class="nc" id="L275">	}</span>

	/**
	 * Add Comment Row
	 */
	private void addCommentRow(List listModel) {
<span class="nc" id="L281">		addCommentRow(listModel, m_bundle, RmWebBundleKey.SWAPBOARD_POSTING_COMMENT);</span>
<span class="nc" id="L282">	}</span>

	/**
	 * Validate Model
	 */
	public boolean validate() {
<span class="nc" id="L288">		boolean success = super.validate();</span>

<span class="nc" id="L290">		Date expirationDate = getExpiration();</span>
<span class="nc" id="L291">		String comment = getComment();</span>
<span class="nc" id="L292">		boolean isNegotiable = isNegotiable();</span>
<span class="nc" id="L293">		boolean allowPartial = getAllowPartial();</span>
<span class="nc bnc" id="L294" title="All 4 branches missed.">		if (isNew() &amp;&amp; !getIsPartial()) {</span>
<span class="nc" id="L295">			success = SwapUtil.adjustShiftSwapItemDates(getShiftSwapItem(), m_shiftDate, m_localizer, m_view_tz, this);</span>
<span class="nc bnc" id="L296" title="All 2 branches missed.">		} else if (!isNew()){</span>
			try {
<span class="nc" id="L298">				ID postingID = getPostingID();</span>
<span class="nc" id="L299">				m_posting = RequestsSwapBoardMH.getPostingByID(postingID);</span>
<span class="nc" id="L300">				m_posting.setComment(comment);</span>
<span class="nc" id="L301">				m_posting.setExpiration(expirationDate);</span>

<span class="nc" id="L303">				ShiftSwapItem ssItem = m_posting.getShiftSwapItem();</span>
<span class="nc" id="L304">				ssItem.setExpirationDate(expirationDate);</span>
<span class="nc" id="L305">				ssItem.setNegotiation(isNegotiable);</span>
<span class="nc" id="L306">				ssItem.setAllowPartial(allowPartial);</span>
<span class="nc" id="L307">				m_posting.updateShiftSwapItem(ssItem);</span>
<span class="nc" id="L308">				success = true;</span>
<span class="nc" id="L309">			} catch (Exception ex) {</span>
<span class="nc" id="L310">				success=false;</span>
<span class="nc" id="L311">				addPageMessage(Message.ERROR_TYPE, RmWebBundleKey.UNABLE_TO_VALIDATE_POSTING, RmWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L312">				log.l7dError(RmWebLogBundleKey.UNABLE_TO_VALIDATE_POSTING, ex);</span>
<span class="nc" id="L313">			}</span>
		}

<span class="nc bnc" id="L316" title="All 2 branches missed.">		if (!success)</span>
<span class="nc" id="L317">			return success;</span>

<span class="nc" id="L319">		Date shiftStartDate = getShiftSwapItem().getStartDate();</span>
<span class="nc bnc" id="L320" title="All 6 branches missed.">		if (shiftStartDate!=null &amp;&amp; expirationDate!=null &amp;&amp; expirationDate.after(shiftStartDate)) {</span>
<span class="nc" id="L321">			success=false;</span>
<span class="nc" id="L322">			addPageMessage(Message.ERROR_TYPE, RmWebBundleKey.EXP_AFTER_SHIFT_IS_NOT_ALLOWED, RmWebBundleKey.BUNDLE_NAME,</span>
<span class="nc" id="L323">					new String[] {m_localizer.formatDateTime(shiftStartDate, m_view_tz)});</span>
		}


<span class="nc" id="L327">		return success;</span>
	}

	/**
	 * Override extract Parameters to handle date input
	 */
	public boolean extractParameters(HttpServletRequest request) {
<span class="nc" id="L334">		boolean success = super.extractParameters(request);</span>
<span class="nc bnc" id="L335" title="All 2 branches missed.">		if (m_dateRangePickerPC.getStartDatePickerPC().getDate() == null){//init picker</span>
//			see if date is set, try to get the shift for that day
<span class="nc" id="L337">			Date shiftStart = null;</span>
<span class="nc" id="L338">			Date shiftEnd = null;</span>

			//get shift for current agent on this day
<span class="nc" id="L341">			ArrayList empList = new ArrayList();</span>
<span class="nc" id="L342">			empList.add(m_empID);</span>
<span class="nc" id="L343">			Date date = extractDate(SHIFT_DATE_FN, false);</span>
<span class="nc bnc" id="L344" title="All 2 branches missed.">			if (date != null){</span>
<span class="nc" id="L345">				Date endDate = DateTimeUtil.getDayEnd(date);</span>
				try {
<span class="nc" id="L347">					Collection saColl = WfmManagerFactory.getScheduleAccessManager()</span>
<span class="nc" id="L348">						.getPublishedEventsForWorkResourcesByType(Event.EVENT_TYPE_SHIFT_ASSIGNMENT, empList, date, endDate);</span>
<span class="nc bnc" id="L349" title="All 2 branches missed.">					if (!saColl.isEmpty()){</span>
<span class="nc bnc" id="L350" title="All 2 branches missed.">						for (Iterator it=saColl.iterator(); it.hasNext();){</span>
<span class="nc" id="L351">							ArrayList saList = (ArrayList) it.next();</span>

<span class="nc bnc" id="L353" title="All 2 branches missed.">							if (!saList.isEmpty()){</span>
<span class="nc" id="L354">								ShiftAssignment sa = (ShiftAssignment) saList.get(0);</span>
<span class="nc" id="L355">								shiftStart = sa.getStartTime();</span>
<span class="nc" id="L356">								shiftEnd = sa.getEndTime();</span>
<span class="nc" id="L357">								break;</span>
							}
<span class="nc" id="L359">						}</span>
					}
<span class="nc" id="L361">				} catch (Exception ex) {</span>
<span class="nc" id="L362">					log.l7dError(RmWebLogBundleKey.EXTRACT_PARAM_FAILED, ex);</span>
<span class="nc" id="L363">				}</span>
			}
<span class="nc bnc" id="L365" title="All 4 branches missed.">			if (shiftStart != null &amp;&amp; shiftEnd != null){</span>
<span class="nc" id="L366">				m_dateRangePickerPC.getStartDatePickerPC().setDate(shiftStart);</span>
<span class="nc" id="L367">				m_dateRangePickerPC.getEndDatePickerPC().setDate(shiftEnd);</span>
			} else
<span class="nc" id="L369">				setDateRangePickerStartAndEnd(m_dateRangePickerPC);</span>
		}
<span class="nc bnc" id="L371" title="All 2 branches missed.">		if (getIsPartial()){</span>
			//set the actual dates from the picker
<span class="nc" id="L373">			m_posting.getShiftSwapItem().setStartDate(m_dateRangePickerPC.getStartDatePickerPC().getDate());</span>
<span class="nc" id="L374">			m_posting.getShiftSwapItem().setEndDate(m_dateRangePickerPC.getEndDatePickerPC().getDate());</span>
		} //else {
<span class="nc" id="L376">			Date shiftDate = extractDate(SHIFT_DATE_FN, false);</span>
<span class="nc" id="L377">			setShiftDate(shiftDate);</span>
		//}
<span class="nc" id="L379">		Date expirationDate = extractDate(EXPIRATION_FN, true);</span>
<span class="nc" id="L380">		setExpiration(expirationDate);</span>

<span class="nc" id="L382">		return success;</span>
	}

	/**
	 * Initiailize new Shift Swap Item
	 */
	protected void initShiftSwapItem() {
<span class="nc" id="L389">		ShiftSwapItem item = new ShiftSwapItem();</span>
<span class="nc" id="L390">		item.setEmployeeID(m_empID);</span>
<span class="nc" id="L391">		item.setNegotiation(true);</span>
<span class="nc" id="L392">		item.setShiftType(ShiftSwapItem.SWAPITEMTYPE_SHIFT);</span>
<span class="nc" id="L393">		m_posting.setShiftSwapItem(item);</span>
<span class="nc" id="L394">	}</span>

	/**
	 * Return Shift Swap Item
	 */
	protected ShiftSwapItem getShiftSwapItem() {
<span class="nc" id="L400">		ShiftSwapItem item = m_posting.getShiftSwapItem();</span>
<span class="nc bnc" id="L401" title="All 2 branches missed.">		if (item==null) initShiftSwapItem();</span>
<span class="nc" id="L402">		return item;</span>
	}

	protected ShiftSwapPosting getShiftSwapPosting() {
<span class="nc" id="L406">		return m_posting;</span>
	}

	/**
	 * Return True if Posting is New
	 */
	public boolean isNew() {
<span class="nc bnc" id="L413" title="All 4 branches missed.">		return m_posting==null || m_posting.getID()==null;</span>
	}

	public void setPostingID(ID id) {
<span class="nc" id="L417">		m_posting.setID(id);</span>
<span class="nc" id="L418">	}</span>

	public ID getPostingID() {
<span class="nc" id="L421">		return m_posting.getID();</span>
	}

	public void setSwapType(String type) {
<span class="nc" id="L425">		m_posting.setSwapType(type);</span>
<span class="nc" id="L426">	}</span>

	public String getSwapType() {
<span class="nc" id="L429">		return m_posting.getSwapType();</span>
	}

	public void setShiftType(String type) {
<span class="nc" id="L433">		getShiftSwapItem().setShiftType(type);</span>
<span class="nc" id="L434">	}</span>

	public String getShiftType() {
<span class="nc" id="L437">		return getShiftSwapItem().getShiftType();</span>
	}

	public void setComment(String comment){
<span class="nc" id="L441">		m_posting.setComment(comment);</span>
<span class="nc" id="L442">	}</span>

	public String getComment() {
<span class="nc" id="L445">		return m_posting.getComment();</span>
	}

	public void setIsNegotiable(boolean bSwitch) {
<span class="nc" id="L449">		getShiftSwapItem().setNegotiation(bSwitch);</span>
<span class="nc" id="L450">	}</span>

	public boolean isNegotiable(){
<span class="nc" id="L453">		return m_posting.getNegotiation();</span>
	}

	public void setShiftDate(Date date) {
<span class="nc" id="L457">		m_shiftDate = date;</span>
<span class="nc" id="L458">	}</span>

	public Date getShiftDate(){
<span class="nc" id="L461">		return m_shiftDate;</span>
	}

	public void setExpiration(Date date) {
<span class="nc" id="L465">		getShiftSwapItem().setExpirationDate(date);</span>
<span class="nc" id="L466">	}</span>

	public Date getExpiration(){
<span class="nc" id="L469">		return m_posting.getExpirationDate();</span>
	}

	public void setIsPartial(boolean isPartial) {
<span class="nc" id="L473">		getShiftSwapItem().setIsPartial(isPartial);</span>
<span class="nc" id="L474">	}</span>

	public boolean getIsPartial(){
<span class="nc" id="L477">		return getShiftSwapItem().getIsPartial();</span>
	}

	public void setAllowPartial(boolean allowPartial) {
<span class="nc" id="L481">		getShiftSwapItem().setAllowPartial(allowPartial);</span>
<span class="nc" id="L482">	}</span>

	public boolean getAllowPartial(){
<span class="nc" id="L485">		return getShiftSwapItem().getAllowPartial();</span>
	}

	/**
	 * Return Required Html
	 */
	public String getRequiredHTML() {
<span class="nc" id="L492">		return super.getRequiredHTML() +</span>
<span class="nc" id="L493">				HtmlUtil.makeHiddenInput(POSTING_ID_FN, getPostingID() );</span>
	}

	/**
	 * Return Required HTML for Request Popups
	 */
<span class="nc" id="L499">	protected String getRequestRequiredHTML() { return &quot;&quot;; }</span>


}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>