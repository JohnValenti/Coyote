<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>ValidationRulePC.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.rm.setup.validation</a> &gt; <span class="el_source">ValidationRulePC.java</span></div><h1>ValidationRulePC.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.rm.setup.validation;

import java.util.ArrayList;
import java.util.Collection;
import java.util.Collections;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.ResourceBundle;

import javax.servlet.http.HttpServletRequest;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.StringsPair;
import com.bluepumpkin.common.util.StringUtil;
import com.bluepumpkin.ejb.bbm.workresource.model.Organization;
import com.bluepumpkin.ejb.rm.requests.flextime.validation.FlexRequestMustOccurASAPValidationRule;
import com.bluepumpkin.ejb.rm.requests.flextime.validation.FlexTimeComplyFilingRulesValidationRule;
import com.bluepumpkin.ejb.rm.requests.flextime.validation.FlexTimeMustAvoidSchedCalEventsValidationRule;
import com.bluepumpkin.ejb.rm.requests.flextime.validation.MakeupTimeComplyWithHOOValidationRule;
import com.bluepumpkin.ejb.rm.requests.flextime.validation.MaxNumberMakeupPerRequestValidationRule;
import com.bluepumpkin.ejb.rm.requests.flextime.validation.MaxNumberRequestsPerPeriodValidationRule;
import com.bluepumpkin.ejb.rm.requests.flextime.validation.MaxShiftDurationOfFlexRequestPerDayRule;
import com.bluepumpkin.ejb.rm.requests.flextime.validation.MaximumFlexRequestDurationValidationRule;
import com.bluepumpkin.ejb.rm.requests.flextime.validation.MinimumFlexRequestDurationValidationRule;
import com.bluepumpkin.ejb.rm.requests.flextime.validation.MinimumGapBetweenConsecutiveShiftsValidationRule;
import com.bluepumpkin.ejb.rm.requests.swap.request.validation.MaxHoursAndMaxAlternateHoursPerDayValidationRule;
import com.bluepumpkin.ejb.rm.requests.swap.request.validation.MaxNumberApprovedPartialSwapsPerShiftValidationRule;
import com.bluepumpkin.ejb.rm.requests.swap.request.validation.MaxNumberApprovedSwapPerShiftValidationRule;
import com.bluepumpkin.ejb.rm.requests.swap.request.validation.MaxNumberOneWaySwapPerPersonPeriodValidationRule;
import com.bluepumpkin.ejb.rm.requests.swap.request.validation.PSSMaxAllowableOverlap;
import com.bluepumpkin.ejb.rm.requests.swap.request.validation.PSSMaxSwapDurationPerDay;
import com.bluepumpkin.ejb.rm.requests.swap.request.validation.PSSMinRemainingShiftDuration;
import com.bluepumpkin.ejb.rm.requests.swap.request.validation.PSSMinShiftSwapDuration;
import com.bluepumpkin.ejb.rm.requests.swap.request.validation.PSSNonSwappableActivites;
import com.bluepumpkin.ejb.rm.requests.swap.request.validation.PSSShiftGapConditions;
import com.bluepumpkin.ejb.rm.requests.timeoff.validation.AvoidCalendarEventsValidationRule;
import com.bluepumpkin.ejb.rm.requests.timeoff.validation.MaximumRequestDurationValidationRule;
import com.bluepumpkin.ejb.rm.requests.timeoff.validation.MinimumRequestDurationValidationRule;
import com.bluepumpkin.ejb.rm.requests.timeoff.validation.TimeOffRequestsPerQuarterValidationRule;
import com.bluepumpkin.ejb.rm.setup.validation.model.ValidationRule;
import com.bluepumpkin.ejb.rm.util.LicenseUtil;
import com.bluepumpkin.web.rm.l10n.RmWebBundleKey;
import com.bluepumpkin.web.rm.setup.RmSetupUtil;
import com.bluepumpkin.web.rm.validation.ValidationResources;
import com.bluepumpkin.web.rm.validation.ValidationRulesMap;
import com.witness.web.uif.pagecomponent.CompositePC;
import com.witness.web.uif.pagecomponent.DefaultMultiColumnNodeData;
import com.witness.web.uif.pagecomponent.PageComponent;
import com.witness.web.uif.pagecomponent.list.MultiColListPC;
import com.witness.web.uif.pagecomponent.table.DefaultHeaderData;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.util.HtmlUtil;
import com.witness.web.uif.util.html.HtmlChoiceInput;
import com.witness.web.uif.util.js.JSUtil;
import com.witness.web.uif.util.reflection.ParameterUtil;

/**
 * Title:        ValidationRulePC
 * Description:  Includes collapsible section of the form with
 *               a) TimeOff validation rule
 *               b) Shift Swap validation rule
 * Copyright:    Copyright (c) 2002
 * Company:      Blue Pumpkin Software, Inc
 * @author       Howard Mullings
 * @version      1.0
 */

public class ValidationRulePC extends CompositePC {
    private final ResourceBundle rmBundle;

    private final ValidationRulesMap m_vrMap;

    private static final String PC_KEY = &quot;validation_rule_pc&quot;;
<span class="nc" id="L75">    private final String m_headerCssClass = &quot;tableHeaderLightLeft&quot;;</span>
    private static final String VALIDATIONBYTYPE_FN = &quot;VALIDATIONBYTYPE_FN&quot;;
    private static final String VTO_MIN_SURPLUS_DURATION_VALUE = &quot;VTO_MIN_SURPLUS_DURATION_VALUE&quot;;

	private Map&lt;String, ValidationRule&gt; validationRules;

    private Map m_ancestors; //maps each inheritted key to the ancestor orgName from which it was inheritted
    private ID m_orgID; //the ID of the currently selected organization

    private static final int SHIFT_SWAP = 1;
    private static final int TIME_OFF = 2;
    private static final int SHIFT_BID = 3;
    private static final int TIME_OFF_WITHDRAW = 4;
    private static final int CUSTOM_SHIFT = 5;
    private static final int FLEX_TIME = 6;
	private static final int SHIFT_SWAP_WITHDRAW = 7;
	private static final String DEFAULT_PARAM_VALUE = &quot;-1&quot;;


    private MultiColListPC approvedTOWithdrawValidationRule;
    private MultiColListPC flexTimeValidationRule;
    private MultiColListPC ssValidationRule;
	private MultiColListPC approvedSSWithdrawValidationRule;
    private MultiColListPC sbValidationRule;
    private MultiColListPC csValidationRule;
	private final TimeOffValidationRulePC toValidationRule;
	private transient ActivityDropdownCreator activityDDCreator;



    private final ValidationPageModel pageModel;

<span class="nc" id="L107">    private final HtmlChoiceInput htmlChoiceInput = new HtmlChoiceInput();</span>
<span class="nc" id="L108">    private final List&lt;PageComponent&gt; m_containerList = new ArrayList&lt;PageComponent&gt;(5);</span>

	public ValidationRulePC(RequestContext context, ValidationPageModel aPageModel) {
<span class="nc" id="L111">		super(context);</span>
<span class="nc" id="L112">		pageModel =  aPageModel;</span>
<span class="nc" id="L113">		rmBundle = m_localizer.getBundle(RmWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L114">		m_vrMap = ValidationRulesMap.getInstance();</span>
<span class="nc" id="L115">		toValidationRule = new TimeOffValidationRulePC(m_context, pageModel, rmBundle);</span>
<span class="nc" id="L116">		addChildContainer(toValidationRule);</span>
<span class="nc" id="L117">		setName(PC_KEY);</span>
<span class="nc" id="L118">	}</span>


	@Override
	public void initForDisplay() {

<span class="nc bnc" id="L124" title="All 2 branches missed.">		if (m_orgID == null) {</span>
			//m_orgID is null means that ValidationPageModel.createFormModel did not finish successfully.
<span class="nc" id="L126">			return;</span>
		}

		try {

<span class="nc" id="L131">			initTimeOffValidationRule();</span>
<span class="nc" id="L132">			initApprovedTimeOffWithdrawValidationRule();</span>

<span class="nc bnc" id="L134" title="All 2 branches missed.">			if (pageModel.isAuthorizedToConfigureFLexValidationRule()) {</span>
<span class="nc" id="L135">				initFlexTimeValidationRule();</span>
			}

<span class="nc" id="L138">			initShiftSwapValidationRule();</span>
<span class="nc bnc" id="L139" title="All 2 branches missed.">		if(pageModel.isAuthorizedToConfigureSSApprovedWithdrawal()) {</span>
<span class="nc" id="L140">			initApprovedShiftSwapWithdrawValidationRule();</span>
		}
<span class="nc" id="L142">			initShiftBidValidationRule();</span>
<span class="nc" id="L143">			initCustomShiftValidationRule();</span>
<span class="nc" id="L144">		} catch (Exception ex) {</span>
<span class="nc" id="L145">			handleUnableToLoadDataError(log, ex);</span>
<span class="nc" id="L146">		}</span>

<span class="nc" id="L148">	}</span>

    public void setRules(Map rules) {
<span class="nc" id="L151">    	validationRules = rules;</span>
<span class="nc" id="L152">    }</span>

	public Map getRules() {
<span class="nc" id="L155">		return validationRules;</span>
	}


    public void setAncestors(Map ancestors) {
<span class="nc" id="L160">        m_ancestors = ancestors;</span>
<span class="nc" id="L161">    }</span>

    public Map getAncestors() {
<span class="nc" id="L164">        return m_ancestors;</span>
    }

    private void addChildContainer(PageComponent pc) {
<span class="nc" id="L168">        m_containerList.add(pc);</span>
<span class="nc" id="L169">        addChildComponent(pc);</span>
<span class="nc" id="L170">    }</span>

    public Collection getContainers() {
<span class="nc" id="L173">        return m_containerList;</span>
    }

	public void setOrgID(ID orgID) {
<span class="nc" id="L177">		m_orgID = orgID;</span>
<span class="nc" id="L178">	}</span>

	public ID getOrgID() {
<span class="nc" id="L181">		return m_orgID;</span>
	}

	private MultiColListPC createContainer(String name, String title) {
<span class="nc" id="L185">        MultiColListPC container = new MultiColListPC(m_context);</span>
<span class="nc" id="L186">		setContainerAttributes(name, title, container);</span>
<span class="nc" id="L187">		addChildContainer(container);</span>
<span class="nc" id="L188">		return container;</span>
    }

	private MultiColListPC setContainerAttributes(String name, String title, MultiColListPC container) {
		//ESR4082546
<span class="nc" id="L193">        container.disableRepeatHeader();</span>
<span class="nc" id="L194">        container.setIsToggleable(true);</span>
<span class="nc" id="L195">        container.setName(name);</span>
<span class="nc" id="L196">        container.setRowDeselectable(false);</span>
<span class="nc" id="L197">        container.setIsBorderEnabled(true);</span>
<span class="nc" id="L198">		DefaultHeaderData header = new DefaultHeaderData(&quot;c1&quot;, title, null, m_headerCssClass, false);</span>
<span class="nc" id="L199">        container.getHeader().setHeaders(Collections.singletonList(header));</span>
<span class="nc" id="L200">        return container;</span>
	}

    /**
     * Get the title for a validation rule section.
     * @param mainTitle The main part of the title.
     * @param ancestorOrgName - the name of the org (Ex: &quot;Customer Service&quot;) from which this section's
     *                   settings were inherited. Pass null if none.
     * @return The full section title, such as: &quot;Time Off (Settings override parent org)&quot; or
     *         &quot;Shift Swap (Settings inheritted from Organization: Customer Service)&quot;
     */
    private String getSectionTitle(String aMainTitle, String ancestorOrgName) {
<span class="nc" id="L212">        String mainTitle = i18n(rmBundle, aMainTitle);</span>

<span class="nc bnc" id="L214" title="All 4 branches missed.">        if (m_orgID.equals(Organization.ROOT_ORG_ID_OBJ) || m_orgID.equals(Organization.YOUR_COMPANY_ID_OBJ)) {</span>
<span class="nc" id="L215">			return mainTitle;</span>
		}

<span class="nc bnc" id="L218" title="All 2 branches missed.">        if (ancestorOrgName != null)</span>
        {
<span class="nc" id="L220">            Object[] args = new Object[] {ancestorOrgName};</span>
<span class="nc" id="L221">            return mainTitle + &quot; &quot; + m_localizer.i18n(rmBundle,</span>
                    RmWebBundleKey.ORG_RM_SETTINGS_INHERITED_FROM_ORG, args);  //&quot;(Settings inherited from organization:&quot;
        }
        else
        {
<span class="nc" id="L226">            return (mainTitle + &quot; &quot; +</span>
<span class="nc" id="L227">                i18n(rmBundle, RmWebBundleKey.ORG_RM_SETTINGS_OVERRIDE_PARENT_ORG)); //&quot;(Settings override parent org)&quot;</span>
        }
    }

    /**
     * Given a key, return the name of the ancestor org from which it was inheritted, or null if none.
     * You must have already set the m_ancestors variable.
     * @param key An validation rule bundle key.
     * @return The name of the ancestor org from which it was inheritted, or null if none.
     */
    private String getAncestor(String key) {
<span class="nc bnc" id="L238" title="All 2 branches missed.">        if (m_ancestors == null) {</span>
<span class="nc" id="L239">			return null;</span>
		}
<span class="nc" id="L241">        return (String)m_ancestors.get(key);</span>
    }



    private void initTimeOffValidationRule() {
        //all rules in each section should have same ancestor, so we only check the first rule
<span class="nc" id="L248">        String title = getSectionTitle(RmWebBundleKey.ORG_RM_VALIDATION_TO_RULE_TITLE,</span>
<span class="nc" id="L249">                getAncestor(ValidationRulesMap.VALIDATION_AVAILABLE_TO_HRS));</span>


<span class="nc" id="L252">		setContainerAttributes(&quot;timeOff&quot;, title, toValidationRule);</span>

<span class="nc" id="L254">		createCheckBoxes(toValidationRule, TIME_OFF, pageModel.isAuthorizedToConfigureTOM());</span>
<span class="nc" id="L255">    }</span>

    private void initApprovedTimeOffWithdrawValidationRule() {
        //all rules in each section should have same ancestor, so we only check the first rule
<span class="nc" id="L259">        String title = getSectionTitle(RmWebBundleKey.ORG_RM_VALIDATION_ARRROVED_TO_WITHDRAW_RULE_TITLE,</span>
<span class="nc" id="L260">                getAncestor(ValidationRulesMap.VALIDATION_APPROVED_TO_WITHDRAW_COMPLY_FILINGRULE));</span>

<span class="nc" id="L262">        approvedTOWithdrawValidationRule = createContainer(&quot;timeOffWithdraw&quot;, title);</span>
<span class="nc" id="L263">        createCheckBoxes(approvedTOWithdrawValidationRule, TIME_OFF_WITHDRAW, pageModel</span>
<span class="nc" id="L264">                .isAuthorizedToConfigureTOM());</span>
<span class="nc" id="L265">    }</span>

    private void initFlexTimeValidationRule() {
        //all rules in each section should have same ancestor, so we only check the first rule
<span class="nc" id="L269">        String title = getSectionTitle(RmWebBundleKey.FLEX_TIME_VALIDATION_TO_RULE_TITLE,</span>
<span class="nc" id="L270">                getAncestor(ValidationRulesMap.VALIDATION_FT_MAX_DURATION));</span>

<span class="nc" id="L272">        flexTimeValidationRule = createContainer(&quot;flexTime&quot;, title);</span>
<span class="nc" id="L273">        createCheckBoxes(flexTimeValidationRule, FLEX_TIME, pageModel.isAuthorizedToConfigureFLexValidationRule());</span>
<span class="nc" id="L274">    }</span>

    private void initShiftSwapValidationRule() {
        //all rules in each section should have same ancestor, so we only check the first rule
<span class="nc" id="L278">        String title = getSectionTitle(RmWebBundleKey.ORG_RM_VALIDATION_SS_RULE_TITLE,</span>
<span class="nc" id="L279">                getAncestor(ValidationRulesMap.VALIDATION_SS_SAME_CALL_CENTER));</span>

<span class="nc" id="L281">        ssValidationRule = createContainer(&quot;shiftSwap&quot;, title);</span>
<span class="nc" id="L282">        createCheckBoxes(ssValidationRule, SHIFT_SWAP, pageModel</span>
<span class="nc" id="L283">                .isAuthorizedToConfigureSS());</span>
<span class="nc" id="L284">    }</span>


	private void initApprovedShiftSwapWithdrawValidationRule() {
		//all rules in each section should have same ancestor, so we only check the first rule
<span class="nc" id="L289">		String title = getSectionTitle(RmWebBundleKey.ORG_RM_VALIDATION_ARRROVED_SS_WITHDRAW_RULE_TITLE,</span>
<span class="nc" id="L290">				getAncestor(ValidationRulesMap.VALIDATION_APPROVED_SS_WITHDRAW_COMPLY_FILINGRULE));</span>

<span class="nc" id="L292">		approvedSSWithdrawValidationRule = createContainer(&quot;shidtSwapWithdraw&quot;, title);</span>
<span class="nc" id="L293">		createCheckBoxes(approvedSSWithdrawValidationRule, SHIFT_SWAP_WITHDRAW, pageModel</span>
<span class="nc" id="L294">				.isAuthorizedToConfigureSS());</span>
<span class="nc" id="L295">	}</span>

	private void initShiftBidValidationRule() {
        //all rules in each section should have same ancestor, so we only check the first rule
<span class="nc" id="L299">        String title = getSectionTitle(RmWebBundleKey.ORG_RM_VALIDATION_SB_RULE_TITLE,</span>
<span class="nc" id="L300">                getAncestor(ValidationRulesMap.VALIDATION_SB_COMPLY_RULES));</span>

<span class="nc" id="L302">        sbValidationRule = createContainer(&quot;shiftBid&quot;, title);</span>
<span class="nc" id="L303">        createCheckBoxes(sbValidationRule, SHIFT_BID, pageModel</span>
<span class="nc" id="L304">                .isAuthorizedToConfigureSB());</span>
<span class="nc" id="L305">    }</span>

    private void initCustomShiftValidationRule() {
        //all rules in each section should have same ancestor, so we only check the first rule
<span class="nc" id="L309">        String title = getSectionTitle(RmWebBundleKey.ORG_RM_VALIDATION_CS_RULE_TITLE,</span>
<span class="nc" id="L310">                getAncestor(ValidationRulesMap.VALIDATION_CS_FULFILLS_NET_STAFFING_SHORTAGE));</span>

<span class="nc" id="L312">        csValidationRule = createContainer(&quot;customShift&quot;, title);</span>
<span class="nc" id="L313">        createCheckBoxes(csValidationRule, CUSTOM_SHIFT, pageModel</span>
<span class="nc" id="L314">                .isAuthorizedToConfigureCS());</span>
<span class="nc" id="L315">    }</span>

	private void createCheckBoxes(MultiColListPC container, int which, boolean enabled) {
<span class="nc" id="L318">        String[] keys = getRuleKeys(which);</span>

<span class="nc" id="L320">        htmlChoiceInput.setIsValueSubmittedWhenDisabled(true);</span>
<span class="nc" id="L321">        htmlChoiceInput.setIsMultiSelect(true);</span>
<span class="nc bnc" id="L322" title="All 2 branches missed.">        htmlChoiceInput.setIsDisabled(!enabled);</span>
<span class="nc" id="L323">        htmlChoiceInput.setValue(&quot;true&quot;);</span>
<span class="nc" id="L324">		List&lt;DefaultMultiColumnNodeData&gt; listModel = new ArrayList&lt;DefaultMultiColumnNodeData&gt;();</span>

<span class="nc" id="L326">		boolean isAtLeastOneAdvancedVTOTypeSelected = false;</span>
<span class="nc" id="L327">		boolean isOnlyAdvancedVTOTypeSelected = false;</span>
<span class="nc" id="L328">		List&lt;String&gt; timeOffRulesAdvancedVTO  = Collections.emptyList();</span>
		
<span class="nc bnc" id="L330" title="All 2 branches missed.">		boolean isTimeOff = which == TIME_OFF;</span>
<span class="nc" id="L331">		List&lt;String&gt; timeOffRulesOnFlex = Collections.emptyList();</span>
<span class="nc" id="L332">		boolean isAtLeastOneFlexActivitySelected = false;</span>
<span class="nc" id="L333">		boolean isOnlyFlexTypeSelected = false;</span>
		
<span class="nc bnc" id="L335" title="All 4 branches missed.">		if (isTimeOff &amp;&amp; LicenseUtil.isAdvancedRMLicense()) {</span>
<span class="nc" id="L336">			listModel.add(toValidationRule.createValidateByTypeDropDown(enabled));</span>
<span class="nc" id="L337">	        timeOffRulesOnFlex = toValidationRule.getApplicableTimeOffValidatorsOnFlexRequests();</span>
<span class="nc" id="L338">	        isAtLeastOneFlexActivitySelected = toValidationRule.isSelectedActivitiesHasFlexActivity();</span>
<span class="nc" id="L339">	        isOnlyFlexTypeSelected = toValidationRule.isOnlyActivitiesFlexTypeSelected();</span>
	        		
	        		
<span class="nc" id="L342">	        timeOffRulesAdvancedVTO = toValidationRule.getApplicableTimeOffValidatorsAdvancedVTO();</span>
<span class="nc" id="L343">	        isAtLeastOneAdvancedVTOTypeSelected = toValidationRule.isSelectedActivitiesHasAdvancedVTOOptions();</span>
	        
<span class="nc" id="L345">	        isOnlyAdvancedVTOTypeSelected =  toValidationRule.isOnlyActivitiesHasAdvancedVTOOptionsSelected(); </span>
        }

<span class="nc" id="L348">		int i = 1;</span>
<span class="nc bnc" id="L349" title="All 2 branches missed.">		for (String key : keys) {</span>
<span class="nc" id="L350">            ValidationRule rule = validationRules.get(key);</span>

<span class="nc bnc" id="L352" title="All 2 branches missed.">			if (rule == null) {</span>
<span class="nc" id="L353">				continue;</span>
			}

<span class="nc" id="L356">            String label = getValidationRuleLabelHtml(key, rule);</span>
<span class="nc" id="L357">            htmlChoiceInput.setInputName(key);</span>

<span class="nc bnc" id="L359" title="All 2 branches missed.">			if (isParamRule(key)) {</span>
<span class="nc" id="L360">				htmlChoiceInput.setLabel(null);</span>
			} else {
<span class="nc" id="L362">				htmlChoiceInput.setLabel(label);</span>
			}

<span class="nc" id="L365">			boolean isChecked = rule.isEnabled();</span>
			
			// Do not check if only flex or only VTO advanced.
			// This may happen if they select &quot;all&quot; and check one that doesn't apply to flex or vto
<span class="nc bnc" id="L369" title="All 4 branches missed.">			if (isTimeOff &amp;&amp; isChecked) {</span>
<span class="nc bnc" id="L370" title="All 2 branches missed.">				if (isOnlyAdvancedVTOTypeSelected) {</span>
<span class="nc" id="L371">					isChecked = timeOffRulesAdvancedVTO.contains(key);</span>
<span class="nc bnc" id="L372" title="All 2 branches missed.">				} else if(isOnlyFlexTypeSelected) {</span>
<span class="nc" id="L373">					isChecked = timeOffRulesOnFlex.contains(key);</span>
				}
			}
			
<span class="nc" id="L377">			setCheckBoxState(enabled, isTimeOff, key, rule, isChecked);</span>
<span class="nc bnc" id="L378" title="All 2 branches missed.">			if (isTimeOff) {</span>
				//Time off rules will be disabled when no privileges to configure time off validation rules
				//Or Only some Time Off rules are disabled for selected flex activity/advanced VTO..
<span class="nc bnc" id="L381" title="All 6 branches missed.">				boolean disabled =!enabled||( (!timeOffRulesOnFlex.contains(key) &amp;&amp; isAtLeastOneFlexActivitySelected)</span>
<span class="nc bnc" id="L382" title="All 4 branches missed.">						|| (!timeOffRulesAdvancedVTO.contains(key) &amp;&amp; isAtLeastOneAdvancedVTOTypeSelected));</span>
<span class="nc" id="L383">				htmlChoiceInput.setIsDisabled(disabled);</span>
			}

<span class="nc" id="L386">			String html = htmlChoiceInput.getHtmlDisplay();</span>

<span class="nc bnc" id="L388" title="All 2 branches missed.">            if (isParamRule(key)) {</span>
<span class="nc" id="L389">				html += &quot; &quot; + label;</span>
			}

<span class="nc" id="L392">			html = addMultiValueIndicator(rule.isPartiallyEnabled(), key, html);</span>

<span class="nc" id="L394">			DefaultMultiColumnNodeData rowData = new DefaultMultiColumnNodeData(&quot;r&quot; + i);</span>
<span class="nc" id="L395">			rowData.add(html);</span>
<span class="nc" id="L396">            listModel.add(rowData);</span>
<span class="nc" id="L397">			i++;</span>
        }
<span class="nc" id="L399">        container.setListModel(listModel);</span>
<span class="nc" id="L400">    }</span>

	private static String addMultiValueIndicator(boolean isMultiValued, String key, String html) {
<span class="nc bnc" id="L403" title="All 2 branches missed.">		return String.format(&quot;&lt;span id='multivalueindicator-%s' style='display:inline-block; min-width:6px;'&gt;%s&lt;/span&gt;%s&quot;,</span>
				key, isMultiValued ? MULTI_VALUE_DATA : &quot;&quot;, html);
	}

	private void setCheckBoxState(boolean enabled, boolean isTimeOff, String key, ValidationRule rule, boolean isChecked) {
		
	
<span class="nc" id="L410">		htmlChoiceInput.setIsChecked(isChecked);</span>
<span class="nc bnc" id="L411" title="All 2 branches missed.">		if (!enabled) {</span>
<span class="nc" id="L412">			String value = String.valueOf(isChecked);</span>
<span class="nc" id="L413">		    htmlChoiceInput.setValue(value);</span>
		}

<span class="nc bnc" id="L416" title="All 4 branches missed.">		if (isTimeOff &amp;&amp; rule.isPartiallyEnabled()) {</span>
<span class="nc" id="L417">			this.toValidationRule.addMultiValuedRuleKey(key);</span>
		}
<span class="nc" id="L419">	}</span>

	private String getValidationRuleLabelHtml(String key, ValidationRule rule) {
<span class="nc" id="L422">		ValidationResources vResource = m_vrMap.getValResource(key);</span>
<span class="nc bnc" id="L423" title="All 2 branches missed.">		String message = vResource!=null? vResource.getMessage(m_localizer): &quot;&quot;;</span>
<span class="nc bnc" id="L424" title="All 2 branches missed.">		if (isParamRule(key)) {</span>
<span class="nc" id="L425">			message = getRuleString(key, rule, vResource);</span>
		}

<span class="nc bnc" id="L428" title="All 2 branches missed.">		return vResource != null ? HtmlUtil.imageTag(vResource.getIconPath(m_localizer)) + &quot; &quot; + message : &quot;&quot;;</span>
	}

	private String[] getRuleKeys(int which) {
		String[] keys;
<span class="nc" id="L433">        boolean hasAdvancedLicense = LicenseUtil.isAdvancedRMLicense();</span>
<span class="nc bnc" id="L434" title="All 7 branches missed.">        switch (which) {</span>
	        case SHIFT_SWAP:
<span class="nc" id="L436">	            keys = RmSetupUtil.getShiftSwapKeys(hasAdvancedLicense);</span>
<span class="nc" id="L437">	            break;</span>

	        case SHIFT_SWAP_WITHDRAW:
	        	//Adding License check for pulling shift swap withdraw validation key
<span class="nc" id="L441">	        	keys = RmSetupUtil.getShiftSwapWithdrawlKeys(hasAdvancedLicense);</span>
<span class="nc" id="L442">			break;</span>

	        case TIME_OFF:
<span class="nc" id="L445">	            keys = RmSetupUtil.getTimeOffKeys(hasAdvancedLicense);</span>
<span class="nc" id="L446">	            break;</span>

	        case TIME_OFF_WITHDRAW:
<span class="nc" id="L449">	            keys = RmSetupUtil.getTimeOffWithdrawKeys();</span>
<span class="nc" id="L450">	            break;</span>

	        case FLEX_TIME:
<span class="nc" id="L453">	        	keys = RmSetupUtil.getFlexTimeKeys();</span>
<span class="nc" id="L454">	            break;</span>

	        case SHIFT_BID:
<span class="nc" id="L457">	            keys = RmSetupUtil.getShiftBidKeys();</span>
<span class="nc" id="L458">	            break;</span>

	        case CUSTOM_SHIFT:
	        default: // NOSONAR
<span class="nc" id="L462">	            keys = RmSetupUtil.getCustShiftKeys(hasAdvancedLicense);</span>
	            break;
        }
<span class="nc" id="L465">		return keys;</span>
	}

	private boolean isParamRule(String key) {
<span class="nc" id="L469">		return RmSetupUtil.isParamRule(key);</span>
	}

	private String getRuleString(String key, ValidationRule rule, ValidationResources vResource) {
<span class="nc" id="L473">        String ruleStr = null;</span>
<span class="nc bnc" id="L474" title="All 2 branches missed.">        if (key.equals(ValidationRulesMap.VALIDATION_PSS_MIN_SHIFT_SWAP_DURATION)) {</span>
<span class="nc" id="L475">            Map paramMap = rule.getParamMap();</span>
<span class="nc" id="L476">            ruleStr = vResource.getMessage(m_localizer, new Object[] {</span>
<span class="nc" id="L477">                    createTextBox(PSSMinShiftSwapDuration.MIN_DURATION_VALUE,</span>
<span class="nc" id="L478">                            getParamValueStr(String.valueOf(paramMap.get(PSSMinShiftSwapDuration.MIN_DURATION_VALUE)))),</span>
<span class="nc" id="L479">                    createUnitTypeDD(PSSMinShiftSwapDuration.MIN_DURATION_UNIT,</span>
<span class="nc" id="L480">                            getParamValueStr(String.valueOf(paramMap.get(PSSMinShiftSwapDuration.MIN_DURATION_UNIT))))});</span>
<span class="nc bnc" id="L481" title="All 2 branches missed.">        } else if (key.equals(ValidationRulesMap.VALIDATION_PSS_MIN_REMAINING_SHIFT_DURATION)) {</span>
<span class="nc" id="L482">            Map paramMap = rule.getParamMap();</span>
<span class="nc" id="L483">            ruleStr = vResource</span>
<span class="nc" id="L484">                    .getMessage(m_localizer, new Object[] {</span>
<span class="nc" id="L485">                            createTextBox(PSSMinRemainingShiftDuration.MIN_SHIFT_DURATION_VALUE,</span>
<span class="nc" id="L486">                                    getParamValueStr(String.valueOf(paramMap</span>
<span class="nc" id="L487">                                            .get(PSSMinRemainingShiftDuration.MIN_SHIFT_DURATION_VALUE)))),</span>
<span class="nc" id="L488">                            createUnitTypeDD(PSSMinRemainingShiftDuration.MIN_SHIFT_DURATION_UNIT,</span>
<span class="nc" id="L489">                                    getParamValueStr(String.valueOf(paramMap</span>
<span class="nc" id="L490">                                            .get(PSSMinRemainingShiftDuration.MIN_SHIFT_DURATION_UNIT))))});</span>
<span class="nc bnc" id="L491" title="All 2 branches missed.">        } else if (key.equals(ValidationRulesMap.VALIDATION_PSS_MAX_SWAP_DURATION_PER_DAY)) {</span>
<span class="nc" id="L492">            Map paramMap = rule.getParamMap();</span>
<span class="nc" id="L493">            ruleStr = vResource.getMessage(m_localizer,</span>
<span class="nc" id="L494">                    new Object[] { createTextBox(PSSMaxSwapDurationPerDay.MAX_SHIFT_DURATION_VALUE,</span>
<span class="nc" id="L495">                            getParamValueStr(String.valueOf(paramMap</span>
<span class="nc" id="L496">                                    .get(PSSMaxSwapDurationPerDay.MAX_SHIFT_DURATION_VALUE)))),</span>
<span class="nc" id="L497">                                    createDayTypeDD(PSSMaxSwapDurationPerDay.MAX_SHIFT_DURATION_UNIT, String.valueOf(paramMap</span>
<span class="nc" id="L498">                                            .get(PSSMaxSwapDurationPerDay.MAX_SHIFT_DURATION_UNIT)))});</span>
<span class="nc bnc" id="L499" title="All 2 branches missed.">        } else if (key.equals(ValidationRulesMap.VALIDATION_PSS_NON_SWAPPABLE_ACTIVITIES)) {</span>
<span class="nc" id="L500">            Map paramMap = rule.getParamMap();</span>
<span class="nc" id="L501">            ruleStr = vResource.getMessage(m_localizer,</span>
<span class="nc" id="L502">                    new Object[] { createActivityDD(PSSNonSwappableActivites.ACTIVITY, paramMap, true, true, false) });</span>
<span class="nc bnc" id="L503" title="All 2 branches missed.">        } else if (key.equals(ValidationRulesMap.VALIDATION_PSS_SHIFT_GAP_CONDITIONS)) {</span>
<span class="nc" id="L504">            Map paramMap = rule.getParamMap();</span>
<span class="nc" id="L505">            ruleStr = vResource.getMessage(m_localizer,</span>
                    new Object[] {
<span class="nc" id="L507">                            createTextBox(PSSShiftGapConditions.RANGE_MIN_DURATION_VALUE,</span>
<span class="nc" id="L508">                                    getParamValueStr(String.valueOf(paramMap</span>
<span class="nc" id="L509">                                            .get(PSSShiftGapConditions.RANGE_MIN_DURATION_VALUE)))),</span>
<span class="nc" id="L510">                            createTextBox(PSSShiftGapConditions.RANGE_MAX_DURATION_VALUE,</span>
<span class="nc" id="L511">                                    getParamValueStr(String.valueOf(paramMap</span>
<span class="nc" id="L512">                                            .get(PSSShiftGapConditions.RANGE_MAX_DURATION_VALUE)))),</span>
<span class="nc" id="L513">                            createTextBox(PSSShiftGapConditions.MIN_GAP_DURATION_VALUE,</span>
<span class="nc" id="L514">                                    getParamValueStr(String.valueOf(paramMap</span>
<span class="nc" id="L515">                                            .get(PSSShiftGapConditions.MIN_GAP_DURATION_VALUE))))});</span>
<span class="nc bnc" id="L516" title="All 2 branches missed.">        } else if (key.equals(ValidationRulesMap.VALIDATION_PSS_MAX_ALLOWABLE_OVERLAP)) {</span>
<span class="nc" id="L517">            Map paramMap = rule.getParamMap();</span>
<span class="nc" id="L518">            ruleStr = vResource.getMessage(m_localizer,</span>
<span class="nc" id="L519">                    new Object[] { createTextBox(PSSMaxAllowableOverlap.MAX_OVERLAP_VALUE,</span>
<span class="nc" id="L520">                            getParamValueStr(String.valueOf(paramMap</span>
<span class="nc" id="L521">                                    .get(PSSMaxAllowableOverlap.MAX_OVERLAP_VALUE))))});</span>
<span class="nc bnc" id="L522" title="All 2 branches missed.">        } else if (key.equals(ValidationRulesMap.VALIDATION_PSS_MAX_APPROVED_PARTIAL_SWAPS_PER_SHIFT)) {</span>
<span class="nc" id="L523">	        Map paramMap = rule.getParamMap();</span>
<span class="nc" id="L524">	        ruleStr = vResource</span>
<span class="nc" id="L525">            .getMessage(m_localizer, new Object[] {</span>
<span class="nc" id="L526">                    createTextBox(MaxNumberApprovedPartialSwapsPerShiftValidationRule.MAX_APPROVED_PARTIAL_SWAPS_PER_SHIFT,</span>
<span class="nc" id="L527">                           getParamValueStr(String.valueOf(paramMap</span>
<span class="nc" id="L528">                                    .get(MaxNumberApprovedPartialSwapsPerShiftValidationRule.MAX_APPROVED_PARTIAL_SWAPS_PER_SHIFT))))});</span>
<span class="nc bnc" id="L529" title="All 2 branches missed.">	    } else if (key.equals(ValidationRulesMap.VALIDATION_REQ_MIN_DURATION)) {</span>
<span class="nc" id="L530">			ruleStr = getMinimumRequestDurationRuleString(rule, vResource);</span>
<span class="nc bnc" id="L531" title="All 2 branches missed.">        } else if (key.equals(ValidationRulesMap.VALIDATION_REQ_MAX_DURATION)) {</span>
<span class="nc" id="L532">            ruleStr = getMaximumRequestDurationRuleString(rule, vResource);</span>
        } 
        
<span class="nc bnc" id="L535" title="All 2 branches missed.">        else if (key.equals(ValidationRulesMap.VALIDATION_REQ_MAX_PER_QUARTER)) {</span>
<span class="nc" id="L536">            ruleStr = getRequestsPerQuarterRuleString(rule, vResource);</span>
        } 
        
        
<span class="nc bnc" id="L540" title="All 2 branches missed.">        else if (key.equals(ValidationRulesMap.VALIDATION_AVOID_CAL_EVENTS)) {</span>
<span class="nc" id="L541">			ruleStr = getAvoidCalendarEventsRuleString(rule, vResource);</span>
<span class="nc bnc" id="L542" title="All 2 branches missed.">        } else if (key.equals(ValidationRulesMap.VALIDATION_CS_MAX_SHIFT_DURATION_PER_DAY)) {</span>
<span class="nc" id="L543">	        Map paramMap = rule.getParamMap();</span>
<span class="nc" id="L544">	        ruleStr = vResource.getMessage(m_localizer,</span>
<span class="nc" id="L545">	                new Object[] { createTextBox(&quot;CS_MAX_SHIFT_DURATION_VALUE&quot;,</span>
<span class="nc" id="L546">	                        getParamValueStr(String.valueOf(paramMap</span>
<span class="nc" id="L547">	                                .get(&quot;CS_MAX_SHIFT_DURATION_VALUE&quot;)))),</span>
<span class="nc" id="L548">	                                createCSDayTypeDD(&quot;CS_MAX_SHIFT_DURATION_UNIT&quot;, String.valueOf(paramMap</span>
<span class="nc" id="L549">	                                        .get(&quot;CS_MAX_SHIFT_DURATION_UNIT&quot;)))});</span>

<span class="nc bnc" id="L551" title="All 2 branches missed.">        } else if (key.equals(ValidationRulesMap.VALIDATION_CS_MIN_SHIFT_DURATION_PER_DAY)) {</span>
<span class="nc" id="L552">	        Map paramMap = rule.getParamMap();</span>
<span class="nc" id="L553">	        ruleStr = vResource.getMessage(m_localizer,</span>
<span class="nc" id="L554">	                new Object[] { createTextBox(&quot;CS_MIN_SHIFT_DURATION_VALUE&quot;,</span>
<span class="nc" id="L555">	                        getParamValueStr(String.valueOf(paramMap</span>
<span class="nc" id="L556">	                                .get(&quot;CS_MIN_SHIFT_DURATION_VALUE&quot;)))),</span>
<span class="nc" id="L557">	                                createCSDayTypeDD(&quot;CS_MIN_SHIFT_DURATION_UNIT&quot;, String.valueOf(paramMap</span>
<span class="nc" id="L558">	                                        .get(&quot;CS_MIN_SHIFT_DURATION_UNIT&quot;)))});</span>

<span class="nc bnc" id="L560" title="All 2 branches missed.">        } else if (key.equals(ValidationRulesMap.VALIDATION_CS_FULFILLS_NET_STAFFING_SHORTAGE)) {</span>
<span class="nc" id="L561">	        Map paramMap = rule.getParamMap();</span>
<span class="nc" id="L562">	        ruleStr = vResource.getMessage(m_localizer,</span>
<span class="nc" id="L563">	                new Object[] { createTextBox(&quot;CS_MIN_SHORTAGE_DURATION_VALUE&quot;,</span>
<span class="nc" id="L564">	                        getParamValueStr(String.valueOf(paramMap</span>
<span class="nc" id="L565">	                                .get(&quot;CS_MIN_SHORTAGE_DURATION_VALUE&quot;)))) });</span>

<span class="nc bnc" id="L567" title="All 2 branches missed.">        } else if (key.equals(ValidationRulesMap.VALIDATION_VTO_REDUCE_NET_STAFFING_SURPLUS)) {</span>
<span class="nc" id="L568">	        ruleStr = getMinimumDurationNetStaffingSurplusRuleString(rule, vResource);</span>
<span class="nc bnc" id="L569" title="All 2 branches missed.">	    } else if (key.equals(ValidationRulesMap.VALIDATION_FT_MAX_DURATION)) {</span>
<span class="nc" id="L570">	        Map paramMap = rule.getParamMap();</span>
<span class="nc" id="L571">	        ruleStr = vResource</span>
<span class="nc" id="L572">	                .getMessage(m_localizer, new Object[] {</span>
<span class="nc" id="L573">	                        createTextBox(MaximumFlexRequestDurationValidationRule.MAX_FLEX_REQUEST_DURATION_VALUE,</span>
<span class="nc" id="L574">	                               getParamValueStr(String.valueOf(paramMap</span>
<span class="nc" id="L575">	                                        .get(MaximumFlexRequestDurationValidationRule.MAX_FLEX_REQUEST_DURATION_VALUE)))),</span>
<span class="nc" id="L576">	                        createDurationUnitTypeMinutesAndHours(MaximumFlexRequestDurationValidationRule.MAX_FLEX_REQUEST_DURATION_UNIT,</span>
<span class="nc" id="L577">	                                getParamValueStr(String.valueOf(paramMap</span>
<span class="nc" id="L578">	                                        .get(MaximumFlexRequestDurationValidationRule.MAX_FLEX_REQUEST_DURATION_UNIT))))});</span>
<span class="nc bnc" id="L579" title="All 2 branches missed.">	    } else if (key.equals(ValidationRulesMap.VALIDATION_FT_MIN_DURATION)) {</span>
<span class="nc" id="L580">	        Map paramMap = rule.getParamMap();</span>
<span class="nc" id="L581">	        ruleStr = vResource</span>
<span class="nc" id="L582">	                .getMessage(m_localizer, new Object[] {</span>
<span class="nc" id="L583">	                        createTextBox(MinimumFlexRequestDurationValidationRule.MIN_FLEX_REQUEST_DURATION_VALUE,</span>
<span class="nc" id="L584">	                               getParamValueStr(String.valueOf(paramMap</span>
<span class="nc" id="L585">	                                        .get(MinimumFlexRequestDurationValidationRule.MIN_FLEX_REQUEST_DURATION_VALUE)))),</span>
<span class="nc" id="L586">	                        createDurationUnitTypeMinutesAndHours(MinimumFlexRequestDurationValidationRule.MIN_FLEX_REQUEST_DURATION_UNIT,</span>
<span class="nc" id="L587">	                                getParamValueStr(String.valueOf(paramMap</span>
<span class="nc" id="L588">	                                        .get(MinimumFlexRequestDurationValidationRule.MIN_FLEX_REQUEST_DURATION_UNIT))))});</span>
<span class="nc bnc" id="L589" title="All 2 branches missed.">	    } else if (key.equals(ValidationRulesMap.VALIDATION_FT_MAX_NUMBER_FLEX_REQ_PER_PERIOD)) {</span>
<span class="nc" id="L590">	        Map paramMap = rule.getParamMap();</span>
<span class="nc" id="L591">	        ruleStr = vResource</span>
<span class="nc" id="L592">	                .getMessage(m_localizer, new Object[] {</span>
<span class="nc" id="L593">	                        createTextBox(MaxNumberRequestsPerPeriodValidationRule.MAX_FLEX_MAKEUP_PER_PERIOD,</span>
<span class="nc" id="L594">	                               getParamValueStr(String.valueOf(paramMap</span>
<span class="nc" id="L595">	                                        .get(MaxNumberRequestsPerPeriodValidationRule.MAX_FLEX_MAKEUP_PER_PERIOD)))),</span>
<span class="nc" id="L596">	                        createUnitTypeMonthAndQuater(MaxNumberRequestsPerPeriodValidationRule.MAX_FLEX_MAKEUP_PER_PERIOD_UNIT,</span>
<span class="nc" id="L597">	                                getParamValueStr(String.valueOf(paramMap</span>
<span class="nc" id="L598">	                                        .get(MaxNumberRequestsPerPeriodValidationRule.MAX_FLEX_MAKEUP_PER_PERIOD_UNIT))))</span>
	                        });
<span class="nc bnc" id="L600" title="All 2 branches missed.">	    } else if (key.equals(ValidationRulesMap.VALIDATION_FT_AVOID_SCHEDULED_CALENDAR_EVENTS)) {</span>
<span class="nc" id="L601">	        Map paramMap = rule.getParamMap();</span>
<span class="nc" id="L602">	        ruleStr = vResource</span>
<span class="nc" id="L603">	                .getMessage(m_localizer, new Object[] {</span>
<span class="nc" id="L604">	                		createActivityDD(FlexTimeMustAvoidSchedCalEventsValidationRule.FLEX_TIME_MUST_AVOID_SCHED_CALENDAR_EVENTS, paramMap, false, false, true)});</span>
<span class="nc bnc" id="L605" title="All 2 branches missed.">        } else if (key.equals(ValidationRulesMap.VALIDATION_FT_MUST_OCCUR_ASAP)) {</span>
<span class="nc" id="L606">	        Map paramMap = rule.getParamMap();</span>
<span class="nc" id="L607">	        ruleStr = vResource.getMessage(m_localizer,</span>
<span class="nc" id="L608">	                new Object[] { createTextBox(FlexRequestMustOccurASAPValidationRule.MUST_OCCUR_ASAP_MAX_DAYS,</span>
<span class="nc" id="L609">	                        getParamValueStr(String.valueOf(paramMap</span>
<span class="nc" id="L610">	                                .get(FlexRequestMustOccurASAPValidationRule.MUST_OCCUR_ASAP_MAX_DAYS)))) });</span>

<span class="nc bnc" id="L612" title="All 2 branches missed.">	    } else if (key.equals(ValidationRulesMap.VALIDATION_FT_MAX_NUMBER_MAKEUP_PER_REQUEST)) {</span>
<span class="nc" id="L613">	        Map paramMap = rule.getParamMap();</span>
<span class="nc" id="L614">	        ruleStr = vResource</span>
<span class="nc" id="L615">	                .getMessage(m_localizer, new Object[] {</span>
<span class="nc" id="L616">	                        createTextBox(MaxNumberMakeupPerRequestValidationRule.MAX_FLEX_MAKEUP_PER_REQUEST,</span>
<span class="nc" id="L617">	                               getParamValueStr(String.valueOf(paramMap</span>
<span class="nc" id="L618">	                                        .get(MaxNumberMakeupPerRequestValidationRule.MAX_FLEX_MAKEUP_PER_REQUEST))))});</span>
<span class="nc bnc" id="L619" title="All 2 branches missed.">		} else if (key.equals(ValidationRulesMap.VALIDATION_FT_MAX_SHIFT_DURATION)) {</span>

<span class="nc" id="L621">			Map paramMap = rule.getParamMap();</span>
<span class="nc" id="L622">			ruleStr = vResource.getMessage(m_localizer, new Object[] {</span>
<span class="nc" id="L623">					createTextBox(</span>
							MaxShiftDurationOfFlexRequestPerDayRule.FT_MAX_SHIFT_DURATION_VALUE,
<span class="nc" id="L625">							getParamValueStr(String.valueOf(paramMap</span>
<span class="nc" id="L626">									.get(MaxShiftDurationOfFlexRequestPerDayRule.FT_MAX_SHIFT_DURATION_VALUE)))),</span>
<span class="nc" id="L627">					createDayTypeDD(MaxShiftDurationOfFlexRequestPerDayRule.FT_MAX_SHIFT_DURATION_UNIT,</span>
<span class="nc" id="L628">							getParamValueStr(String.valueOf(paramMap</span>
<span class="nc" id="L629">									.get(MaxShiftDurationOfFlexRequestPerDayRule.FT_MAX_SHIFT_DURATION_UNIT)))) });</span>

<span class="nc bnc" id="L631" title="All 2 branches missed.">	    } else if (key.equals(ValidationRulesMap.VALIDATION_SS_MAX_ONE_WAY_SWAP_PER_PERSON_PERIOD)) {</span>
<span class="nc" id="L632">	        Map paramMap = rule.getParamMap();</span>
<span class="nc" id="L633">	        ruleStr = vResource</span>
<span class="nc" id="L634">	                .getMessage(m_localizer, new Object[] {</span>
<span class="nc" id="L635">	                        createTextBox(MaxNumberOneWaySwapPerPersonPeriodValidationRule.MAX_ONE_WAY_SWAP_PER_PERSON_PERIOD,</span>
<span class="nc" id="L636">	                               getParamValueStr(String.valueOf(paramMap</span>
<span class="nc" id="L637">	                                        .get(MaxNumberOneWaySwapPerPersonPeriodValidationRule.MAX_ONE_WAY_SWAP_PER_PERSON_PERIOD)))),</span>
<span class="nc" id="L638">	                        createUnitTypeMonthAndQuater(MaxNumberOneWaySwapPerPersonPeriodValidationRule.MAX_ONE_WAY_SWAP_PER_PERSON_PERIOD_UNIT,</span>
<span class="nc" id="L639">	                                getParamValueStr(String.valueOf(paramMap</span>
<span class="nc" id="L640">	                                        .get(MaxNumberOneWaySwapPerPersonPeriodValidationRule.MAX_ONE_WAY_SWAP_PER_PERSON_PERIOD_UNIT))))</span>
	                        });
<span class="nc bnc" id="L642" title="All 2 branches missed.">	    } else if (key.equals(ValidationRulesMap.VALIDATION_SS_MAX_APPROVED_SWAP_PER_SHIFT)) {</span>
<span class="nc" id="L643">	        Map paramMap = rule.getParamMap();</span>
<span class="nc" id="L644">	        ruleStr = vResource</span>
<span class="nc" id="L645">	                .getMessage(m_localizer, new Object[] {</span>
<span class="nc" id="L646">	                        createTextBox(MaxNumberApprovedSwapPerShiftValidationRule.MAX_APPROVED_SWAP_PER_SHIFT,</span>
<span class="nc" id="L647">	                               getParamValueStr(String.valueOf(paramMap</span>
<span class="nc" id="L648">	                                        .get(MaxNumberApprovedSwapPerShiftValidationRule.MAX_APPROVED_SWAP_PER_SHIFT))))});</span>
<span class="nc bnc" id="L649" title="All 2 branches missed.">	    } else if (key.equals(ValidationRulesMap.VALIDATION_SS_MAX_HOURS_ALTERNATE_MAX_HOURS_PER_DAY)) {</span>
<span class="nc" id="L650">	        Map paramMap = rule.getParamMap();</span>
<span class="nc" id="L651">	        ruleStr = vResource</span>
<span class="nc" id="L652">	                .getMessage(m_localizer, new Object[] {</span>
<span class="nc" id="L653">	                        createTextBox(MaxHoursAndMaxAlternateHoursPerDayValidationRule.MAX_HOURS_PER_DAY,</span>
<span class="nc" id="L654">	                               getParamValueStr(String.valueOf(paramMap</span>
<span class="nc" id="L655">	                                        .get(MaxHoursAndMaxAlternateHoursPerDayValidationRule.MAX_HOURS_PER_DAY)))),</span>
<span class="nc" id="L656">                            createTextBox(MaxHoursAndMaxAlternateHoursPerDayValidationRule.MAX_ALTERNATIVE_HOURS_PER_DAY,</span>
<span class="nc" id="L657"> 	                               getParamValueStr(String.valueOf(paramMap</span>
<span class="nc" id="L658"> 	                                        .get(MaxHoursAndMaxAlternateHoursPerDayValidationRule.MAX_ALTERNATIVE_HOURS_PER_DAY))))</span>
	                });
	    }

<span class="nc" id="L662">        return ruleStr;</span>
    }


	private String getMinimumDurationNetStaffingSurplusRuleString(ValidationRule rule, ValidationResources vResource) {
<span class="nc" id="L667">		return vResource.getMessage(m_localizer, createTextBox(rule, VTO_MIN_SURPLUS_DURATION_VALUE));</span>
	}

	private String getMaximumRequestDurationRuleString(ValidationRule rule, ValidationResources vResource) {
<span class="nc" id="L671">		return vResource.getMessage(m_localizer,</span>
<span class="nc" id="L672">				createTextBox(rule, MaximumRequestDurationValidationRule.MAX_REQUEST_DURATION_VALUE),</span>
<span class="nc" id="L673">				createDurationUnitTypeDD(rule, MaximumRequestDurationValidationRule.MAX_REQUEST_DURATION_UNIT));</span>
	}

	private String getMinimumRequestDurationRuleString(ValidationRule rule, ValidationResources vResource) {
<span class="nc" id="L677">		return vResource.getMessage(m_localizer,</span>
<span class="nc" id="L678">						createTextBox(rule, MinimumRequestDurationValidationRule.MIN_REQUEST_DURATION_VALUE),</span>
<span class="nc" id="L679">						createDurationUnitTypeDD(rule, MinimumRequestDurationValidationRule.MIN_REQUEST_DURATION_UNIT));</span>
	}
	
	
	private String getRequestsPerQuarterRuleString(ValidationRule rule, ValidationResources vResource) {
<span class="nc" id="L684">		return vResource.getMessage(m_localizer, createTextBox(rule, TimeOffRequestsPerQuarterValidationRule.TIMEOFF_PER_QUARTER_VALUE));</span>
	}

	private String getAvoidCalendarEventsRuleString(ValidationRule rule, ValidationResources vResource) {
<span class="nc" id="L688">		Map paramMap = rule.getParamMap();</span>
<span class="nc" id="L689">		boolean isSelectionMulitValued = rule.isAnyParamValuesMultipleValue();</span>
<span class="nc" id="L690">		String activityDDHtml = createActivityDD(AvoidCalendarEventsValidationRule.CALENDAR_EVENT_ACTIVITY, paramMap, false, false, true,</span>
				isSelectionMulitValued);
<span class="nc" id="L692">		return vResource.getMessage(m_localizer, activityDDHtml);</span>
	}

	protected String createUnitTypeDD(String key, String value) {
<span class="nc" id="L696">        ArrayList&lt;StringsPair&gt; options = new ArrayList&lt;StringsPair&gt;(2);</span>
<span class="nc" id="L697">        options.add(new StringsPair(String.valueOf(PSSMinRemainingShiftDuration.DURATION_UNIT_PERCENT), i18n(rmBundle, RmWebBundleKey.VALIDATION_PERCENT)));</span>
<span class="nc" id="L698">        options.add(new StringsPair(String.valueOf(PSSMinRemainingShiftDuration.DURATION_UNIT_MINUTES), i18n(rmBundle, RmWebBundleKey.VALIDATION_MINUTES)));</span>
<span class="nc" id="L699">        return HtmlUtil.makeSelectInput(key, value, JSUtil.ON_CHANGE, options);</span>
    }

	protected String createTextBox(ValidationRule rule, String key) {
<span class="nc" id="L703">		String value = getAdjustedValue(rule, key);</span>
<span class="nc" id="L704">		return createTextBox(key, value);</span>
	}

	protected String createDurationUnitTypeDD(ValidationRule rule, String key) {
<span class="nc" id="L708">		String value = getAdjustedValue(rule, key);</span>
<span class="nc" id="L709">		return createDurationUnitTypeDD(key, value);</span>
	}

	protected String getAdjustedValue(ValidationRule rule, String key) {
<span class="nc" id="L713">		Map paramMap = rule.getParamMap();</span>
<span class="nc" id="L714">		boolean isMultiValue = rule.isParamValueMultipleValue(key);</span>
<span class="nc bnc" id="L715" title="All 2 branches missed.">		return isMultiValue ? MULTI_VALUE_DATA : getParamValueStr(String.valueOf(paramMap.get(key)));</span>
	}


    protected String createDurationUnitTypeDD(String key, String value) {
<span class="nc" id="L720">    	ArrayList&lt;StringsPair&gt; options = new ArrayList&lt;StringsPair&gt;(2);</span>
<span class="nc" id="L721">        options.add(new StringsPair(&quot;0&quot;, i18n(RmWebBundleKey.VALIDATION_MINUTES)));</span>
<span class="nc" id="L722">        options.add(new StringsPair(&quot;1&quot;, i18n(RmWebBundleKey.VALIDATION_HOURS)));</span>
<span class="nc" id="L723">        options.add(new StringsPair(&quot;2&quot;, i18n(RmWebBundleKey.VALIDATION_DAYS)));</span>
<span class="nc" id="L724">		return makeSelectedInputMultiValue(key, value, options);</span>
    }

    protected String createDurationUnitTypeMinutesAndHours(String key, String value) {
<span class="nc" id="L728">    	ArrayList&lt;StringsPair&gt; options = new ArrayList&lt;StringsPair&gt;(2);</span>
<span class="nc" id="L729">        options.add(new StringsPair(&quot;0&quot;, i18n(RmWebBundleKey.VALIDATION_MINUTES)));</span>
<span class="nc" id="L730">        options.add(new StringsPair(&quot;1&quot;, i18n(RmWebBundleKey.VALIDATION_HOURS)));</span>
<span class="nc" id="L731">        return HtmlUtil.makeSelectInput(key, value, JSUtil.ON_CHANGE, options);</span>
    }

    protected String createUnitTypeMonthAndQuater(String key, String value) {
<span class="nc" id="L735">    	ArrayList&lt;StringsPair&gt; options = new ArrayList&lt;StringsPair&gt;(2);</span>
<span class="nc" id="L736">        options.add(new StringsPair(&quot;0&quot;, i18n(RmWebBundleKey.VALIDATION_MONTH)));</span>
<span class="nc" id="L737">        options.add(new StringsPair(&quot;1&quot;, i18n(RmWebBundleKey.VALIDATION_QUARTER)));</span>
<span class="nc" id="L738">        return HtmlUtil.makeSelectInput(key, value, JSUtil.ON_CHANGE, options);</span>
    }

    protected String createDayTypeDD(String key, String value) {
<span class="nc" id="L742">    	ArrayList&lt;StringsPair&gt; options = new ArrayList&lt;StringsPair&gt;(2);</span>
<span class="nc" id="L743">        options.add(new StringsPair(String.valueOf(PSSMaxSwapDurationPerDay.MAX_SHIFT_DURATION_UNIT_ORGHOO), i18n(RmWebBundleKey.VALIDATION_ORG_DAY)));</span>
<span class="nc" id="L744">        options.add(new StringsPair(String.valueOf(PSSMaxSwapDurationPerDay.MAX_SHIFT_DURATION_UNIT_24HOURS), i18n(RmWebBundleKey.VALIDATION_24_HR_PERIOD)));</span>
<span class="nc" id="L745">        return HtmlUtil.makeSelectInput(key, value, JSUtil.ON_CHANGE, options);</span>
    }

    /**
     * Create the day type drop down for the Custom Shift rules
     * @param key
     * @param value
     * @return
     */
    protected String createCSDayTypeDD(String key, String value) {
<span class="nc" id="L755">    	ArrayList&lt;StringsPair&gt; options = new ArrayList&lt;StringsPair&gt;(2);</span>
<span class="nc" id="L756">        options.add(new StringsPair(String.valueOf(PSSMaxSwapDurationPerDay.MAX_SHIFT_DURATION_UNIT_ORGHOO), i18n(RmWebBundleKey.VALIDATION_ORG_DAY)));</span>
<span class="nc" id="L757">        options.add(new StringsPair(String.valueOf(PSSMaxSwapDurationPerDay.MAX_SHIFT_DURATION_UNIT_24HOURS), i18n(RmWebBundleKey.VALIDATION_24_HR_PERIOD)));</span>
<span class="nc" id="L758">        return HtmlUtil.makeSelectInput(key, value, JSUtil.ON_CHANGE, options);</span>
    }

	private static String makeSelectedInputMultiValue(String key, String value, List&lt;StringsPair&gt; options) {
<span class="nc bnc" id="L762" title="All 2 branches missed.">		if (MULTI_VALUE_DATA.equalsIgnoreCase(value)) {</span>
<span class="nc" id="L763">			options.add(0, new StringsPair(MULTI_VALUE_DATA, MULTI_VALUE_DATA));</span>
		}
<span class="nc" id="L765">		return HtmlUtil.makeSelectInput(key, value, JSUtil.ON_CHANGE, options);</span>
	}

    protected String createTextBox(String key, String value) {
<span class="nc" id="L769">        return HtmlUtil.makeTextInput(key, 10, 10, value);</span>
    }

	protected String createActivityDD(String key, Map map, boolean usedInShift, boolean includeNone, boolean includeAll) {
<span class="nc" id="L773">		return createActivityDD(key, map, usedInShift, includeNone, includeAll, false);</span>
	}

	protected String createActivityDD(String key, Map map, boolean usedInShift, boolean includeNone, boolean includeAll,
			boolean selctionIsMultiValued) {
<span class="nc bnc" id="L778" title="All 2 branches missed.">		if (activityDDCreator == null) {</span>
<span class="nc" id="L779">			activityDDCreator = new ActivityDropdownCreator(getLocalizer(), rmBundle);</span>
<span class="nc" id="L780">			activityDDCreator.intialize(pageModel.getSelectedID(), m_context);</span>
		}
<span class="nc" id="L782">		return activityDDCreator.getHtml(key, map.values(), usedInShift, includeNone, includeAll, selctionIsMultiValued);</span>
	}


    @Override
	public boolean extractParameters(HttpServletRequest request) {
<span class="nc" id="L788">        boolean success = super.extractParameters(request);</span>

<span class="nc" id="L790">		toValidationRule.extractActivityIDs(request);</span>

<span class="nc bnc" id="L792" title="All 2 branches missed.">		if (validationRules != null) {</span>
<span class="nc bnc" id="L793" title="All 2 branches missed.">			for (Map.Entry&lt;String, ValidationRule&gt; entry : validationRules.entrySet()) {</span>

<span class="nc" id="L795">				ValidationRule rule = entry.getValue();</span>
<span class="nc" id="L796">				String key = entry.getKey();</span>

<span class="nc" id="L798">				String checked = request.getParameter(key);</span>
<span class="nc bnc" id="L799" title="All 2 branches missed.">				int enabledState = &quot;true&quot;.equals(checked) ? ValidationRule.VALIDATION_ENABLED : ValidationRule.VALIDATION_NOT_ENABLED;</span>

<span class="nc bnc" id="L801" title="All 2 branches missed.">				if (toValidationRule.isKeyMulitValued(key)) {</span>
<span class="nc" id="L802">					enabledState = ValidationRule.VALIDATION_PARTIALLY_ENABLED;</span>
				}

<span class="nc" id="L805">				rule.setEnabledState(enabledState);</span>

<span class="nc bnc" id="L807" title="All 2 branches missed.">				if (isParamRule(key)) {</span>
<span class="nc" id="L808">					rule = extractParamMap(key, rule, request);</span>
				}

<span class="nc" id="L811">				entry.setValue(rule);</span>
<span class="nc" id="L812">			}</span>

		}
<span class="nc" id="L815">		return success;</span>
	}

	private boolean extractFlexTimeParamMap(HttpServletRequest request, String key, ValidationRule rule, Map paramMap) {
<span class="nc bnc" id="L819" title="All 2 branches missed.">		if (key.equals(ValidationRulesMap.VALIDATION_FT_MAX_DURATION)) {</span>
<span class="nc" id="L820">			paramMap.put(MaximumFlexRequestDurationValidationRule.MAX_FLEX_REQUEST_DURATION_VALUE,</span>
<span class="nc" id="L821">					getParamValue(request.getParameter(MaximumFlexRequestDurationValidationRule.MAX_FLEX_REQUEST_DURATION_VALUE)));</span>
<span class="nc" id="L822">			paramMap.put(MaximumFlexRequestDurationValidationRule.MAX_FLEX_REQUEST_DURATION_UNIT,</span>
<span class="nc" id="L823">					getParamValue(request.getParameter(MaximumFlexRequestDurationValidationRule.MAX_FLEX_REQUEST_DURATION_UNIT)));</span>
<span class="nc bnc" id="L824" title="All 2 branches missed.">		} else if (key.equals(ValidationRulesMap.VALIDATION_FT_MIN_DURATION)) {</span>
<span class="nc" id="L825">			paramMap.put(MinimumFlexRequestDurationValidationRule.MIN_FLEX_REQUEST_DURATION_VALUE,</span>
<span class="nc" id="L826">					getParamValue(request.getParameter(MinimumFlexRequestDurationValidationRule.MIN_FLEX_REQUEST_DURATION_VALUE)));</span>
<span class="nc" id="L827">			paramMap.put(MinimumFlexRequestDurationValidationRule.MIN_FLEX_REQUEST_DURATION_UNIT,</span>
<span class="nc" id="L828">					getParamValue(request.getParameter(MinimumFlexRequestDurationValidationRule.MIN_FLEX_REQUEST_DURATION_UNIT)));</span>
<span class="nc bnc" id="L829" title="All 2 branches missed.">		} else if (key.equals(ValidationRulesMap.VALIDATION_FT_MAX_NUMBER_FLEX_REQ_PER_PERIOD)) {</span>
<span class="nc" id="L830">			paramMap.put(MaxNumberRequestsPerPeriodValidationRule.MAX_FLEX_MAKEUP_PER_PERIOD,</span>
<span class="nc" id="L831">					getParamValue(request.getParameter(MaxNumberRequestsPerPeriodValidationRule.MAX_FLEX_MAKEUP_PER_PERIOD)));</span>
<span class="nc" id="L832">			paramMap.put(MaxNumberRequestsPerPeriodValidationRule.MAX_FLEX_MAKEUP_PER_PERIOD_UNIT,</span>
<span class="nc" id="L833">					getParamValue(request.getParameter(MaxNumberRequestsPerPeriodValidationRule.MAX_FLEX_MAKEUP_PER_PERIOD_UNIT)));</span>
<span class="nc bnc" id="L834" title="All 2 branches missed.">		} else if (key.equals(ValidationRulesMap.VALIDATION_FT_MAX_NUMBER_MAKEUP_PER_REQUEST)) {</span>
<span class="nc" id="L835">			paramMap.put(MaxNumberMakeupPerRequestValidationRule.MAX_FLEX_MAKEUP_PER_REQUEST,</span>
<span class="nc" id="L836">					getParamValue(request.getParameter(MaxNumberMakeupPerRequestValidationRule.MAX_FLEX_MAKEUP_PER_REQUEST)));</span>
<span class="nc bnc" id="L837" title="All 2 branches missed.">		} else if (key.equals(ValidationRulesMap.VALIDATION_FT_AVOID_SCHEDULED_CALENDAR_EVENTS)) {</span>

<span class="nc" id="L839">			String activities[] = ParameterUtil.getParameters(request,</span>
					FlexTimeMustAvoidSchedCalEventsValidationRule.FLEX_TIME_MUST_AVOID_SCHED_CALENDAR_EVENTS);
<span class="nc bnc" id="L841" title="All 2 branches missed.">			if (activities != null) {</span>
<span class="nc bnc" id="L842" title="All 2 branches missed.">				for (int i = 0; i &lt; activities.length; i++) {</span>
<span class="nc" id="L843">					paramMap.put(FlexTimeMustAvoidSchedCalEventsValidationRule.FLEX_TIME_MUST_AVOID_SCHED_CALENDAR_EVENTS + i, new ID(activities[i]));</span>
				}
			}
<span class="nc bnc" id="L846" title="All 2 branches missed.">		} else if (key.equals(ValidationRulesMap.VALIDATION_FT_MUST_OCCUR_ASAP)){</span>
<span class="nc" id="L847">			paramMap.put(FlexRequestMustOccurASAPValidationRule.MUST_OCCUR_ASAP_MAX_DAYS,</span>
<span class="nc" id="L848">					getParamValue(request.getParameter(FlexRequestMustOccurASAPValidationRule.MUST_OCCUR_ASAP_MAX_DAYS)));</span>
<span class="nc bnc" id="L849" title="All 2 branches missed.">		} else if (key.equals(ValidationRulesMap.VALIDATION_FT_COMPLYING_FILING_RULES)){</span>
<span class="nc" id="L850">			paramMap.put(FlexTimeComplyFilingRulesValidationRule.FLEX_TIME_COMPLY_FILING_RULES,</span>
<span class="nc" id="L851">					getParamValue(request.getParameter(FlexTimeComplyFilingRulesValidationRule.FLEX_TIME_COMPLY_FILING_RULES)));</span>
<span class="nc bnc" id="L852" title="All 2 branches missed.">		} else if (key.equals(ValidationRulesMap.VALIDATION_FT_MAKEUP_COMPLYING_HOO)){</span>
<span class="nc" id="L853">			paramMap.put(MakeupTimeComplyWithHOOValidationRule.MAKEUP_TIME_COMPLY_HOO,</span>
<span class="nc" id="L854">					getParamValue(request.getParameter(MakeupTimeComplyWithHOOValidationRule.MAKEUP_TIME_COMPLY_HOO)));</span>
<span class="nc bnc" id="L855" title="All 2 branches missed.">		} else if (key.equals(ValidationRulesMap.VALIDATION_FT_MIN_GAP_BETWEEN_CONSECUTIVE_SHIFTS)){</span>
<span class="nc" id="L856">			paramMap.put(MinimumGapBetweenConsecutiveShiftsValidationRule.MIN_GAP_BETWEEN_CONSECUTIVE_SHIFTS,</span>
<span class="nc" id="L857">					getParamValue(request.getParameter(</span>
							MinimumGapBetweenConsecutiveShiftsValidationRule.MIN_GAP_BETWEEN_CONSECUTIVE_SHIFTS)));
<span class="nc bnc" id="L859" title="All 2 branches missed.">		} else if (key.equals(ValidationRulesMap.VALIDATION_FT_MAX_SHIFT_DURATION)) {</span>
<span class="nc" id="L860">			paramMap.put(MaxShiftDurationOfFlexRequestPerDayRule.FT_MAX_SHIFT_DURATION_VALUE, getParamValue(</span>
<span class="nc" id="L861">					request.getParameter(MaxShiftDurationOfFlexRequestPerDayRule.FT_MAX_SHIFT_DURATION_VALUE)));</span>
<span class="nc" id="L862">			paramMap.put(MaxShiftDurationOfFlexRequestPerDayRule.FT_MAX_SHIFT_DURATION_UNIT, getParamValue(</span>
<span class="nc" id="L863">					request.getParameter(MaxShiftDurationOfFlexRequestPerDayRule.FT_MAX_SHIFT_DURATION_UNIT)));</span>
		} else {
<span class="nc" id="L865">			return false;</span>
		}
<span class="nc" id="L867">		return true;</span>
	}

    @SuppressWarnings({ &quot;unchecked&quot; })
	private ValidationRule extractParamMap(String key, ValidationRule rule,
            HttpServletRequest request) {
<span class="nc" id="L873">        HashMap paramMap = new HashMap(2);</span>
<span class="nc" id="L874">		rule.setParamMap(paramMap);</span>

<span class="nc bnc" id="L876" title="All 2 branches missed.">		if (extractFlexTimeParamMap(request, key, rule, paramMap)) {</span>
<span class="nc" id="L877">			return rule;</span>
		}

<span class="nc bnc" id="L880" title="All 2 branches missed.">        if (key.equals(ValidationRulesMap.VALIDATION_PSS_MIN_SHIFT_SWAP_DURATION)) {</span>
<span class="nc" id="L881">            paramMap.put(PSSMinShiftSwapDuration.MIN_DURATION_VALUE,</span>
<span class="nc" id="L882">                    getParamValue(request.getParameter(PSSMinShiftSwapDuration.MIN_DURATION_VALUE)));</span>
<span class="nc" id="L883">            paramMap.put(PSSMinShiftSwapDuration.MIN_DURATION_UNIT,</span>
<span class="nc" id="L884">                    getParamValue(request.getParameter(PSSMinShiftSwapDuration.MIN_DURATION_UNIT)));</span>
<span class="nc bnc" id="L885" title="All 2 branches missed.">        } else if (key.equals(ValidationRulesMap.VALIDATION_PSS_MIN_REMAINING_SHIFT_DURATION)) {</span>
<span class="nc" id="L886">            paramMap.put(PSSMinRemainingShiftDuration.MIN_SHIFT_DURATION_VALUE,</span>
<span class="nc" id="L887">                    getParamValue(request.getParameter(PSSMinRemainingShiftDuration.MIN_SHIFT_DURATION_VALUE)));</span>
<span class="nc" id="L888">            paramMap.put(PSSMinRemainingShiftDuration.MIN_SHIFT_DURATION_UNIT,</span>
<span class="nc" id="L889">                    getParamValue(request.getParameter(PSSMinRemainingShiftDuration.MIN_SHIFT_DURATION_UNIT)));</span>
<span class="nc bnc" id="L890" title="All 2 branches missed.">        } else if (key.equals(ValidationRulesMap.VALIDATION_PSS_MAX_SWAP_DURATION_PER_DAY)){</span>
<span class="nc" id="L891">            paramMap.put(PSSMaxSwapDurationPerDay.MAX_SHIFT_DURATION_VALUE,</span>
<span class="nc" id="L892">                    getParamValue(request.getParameter(PSSMaxSwapDurationPerDay.MAX_SHIFT_DURATION_VALUE)));</span>
<span class="nc" id="L893">            paramMap.put(PSSMaxSwapDurationPerDay.MAX_SHIFT_DURATION_UNIT,</span>
<span class="nc" id="L894">                    getParamValue(request.getParameter(PSSMaxSwapDurationPerDay.MAX_SHIFT_DURATION_UNIT)));</span>
<span class="nc bnc" id="L895" title="All 2 branches missed.">        } else if (key.equals(ValidationRulesMap.VALIDATION_PSS_NON_SWAPPABLE_ACTIVITIES)) {</span>
<span class="nc" id="L896">            String activities[] = ParameterUtil.getParameters(request,</span>
                    PSSNonSwappableActivites.ACTIVITY);
<span class="nc bnc" id="L898" title="All 2 branches missed.">            if (activities != null) {</span>
<span class="nc bnc" id="L899" title="All 2 branches missed.">                for (int i = 0; i &lt; activities.length; i++) {</span>
<span class="nc" id="L900">					paramMap.put(PSSNonSwappableActivites.ACTIVITY + i, new ID(activities[i]));</span>
				}

            }
<span class="nc bnc" id="L904" title="All 2 branches missed.">        } else if (key.equals(ValidationRulesMap.VALIDATION_PSS_SHIFT_GAP_CONDITIONS)) {</span>
<span class="nc" id="L905">            paramMap.put(PSSShiftGapConditions.RANGE_MIN_DURATION_VALUE,</span>
<span class="nc" id="L906">                    getParamValue(request.getParameter(PSSShiftGapConditions.RANGE_MIN_DURATION_VALUE)));</span>
<span class="nc" id="L907">            paramMap.put(PSSShiftGapConditions.RANGE_MAX_DURATION_VALUE,</span>
<span class="nc" id="L908">                    getParamValue(request.getParameter(PSSShiftGapConditions.RANGE_MAX_DURATION_VALUE)));</span>
<span class="nc" id="L909">            paramMap.put(PSSShiftGapConditions.MIN_GAP_DURATION_VALUE,</span>
<span class="nc" id="L910">                    getParamValue(request.getParameter(PSSShiftGapConditions.MIN_GAP_DURATION_VALUE)));</span>
<span class="nc bnc" id="L911" title="All 2 branches missed.">        } else if (key.equals(ValidationRulesMap.VALIDATION_PSS_MAX_ALLOWABLE_OVERLAP)){</span>
<span class="nc" id="L912">            paramMap.put(PSSMaxAllowableOverlap.MAX_OVERLAP_VALUE,</span>
<span class="nc" id="L913">                    getParamValue(request.getParameter(PSSMaxAllowableOverlap.MAX_OVERLAP_VALUE)));</span>
<span class="nc bnc" id="L914" title="All 2 branches missed.">        } else if (key.equals(ValidationRulesMap.VALIDATION_PSS_MAX_APPROVED_PARTIAL_SWAPS_PER_SHIFT)) {</span>
<span class="nc" id="L915">            paramMap.put(MaxNumberApprovedPartialSwapsPerShiftValidationRule.MAX_APPROVED_PARTIAL_SWAPS_PER_SHIFT,</span>
<span class="nc" id="L916">                    getParamValue(request.getParameter(MaxNumberApprovedPartialSwapsPerShiftValidationRule.MAX_APPROVED_PARTIAL_SWAPS_PER_SHIFT)));</span>
<span class="nc bnc" id="L917" title="All 2 branches missed.">        } else if (key.equals(ValidationRulesMap.VALIDATION_REQ_MIN_DURATION)){</span>
<span class="nc" id="L918">            paramMap.put(MinimumRequestDurationValidationRule.MIN_REQUEST_DURATION_VALUE,</span>
<span class="nc" id="L919">                    getParamValue(request.getParameter(MinimumRequestDurationValidationRule.MIN_REQUEST_DURATION_VALUE)));</span>
<span class="nc" id="L920">            paramMap.put(MinimumRequestDurationValidationRule.MIN_REQUEST_DURATION_UNIT,</span>
<span class="nc" id="L921">                    getParamValue(request.getParameter(MinimumRequestDurationValidationRule.MIN_REQUEST_DURATION_UNIT)));</span>
        } 
        
<span class="nc bnc" id="L924" title="All 2 branches missed.">        else if (key.equals(ValidationRulesMap.VALIDATION_REQ_MAX_PER_QUARTER)){</span>
<span class="nc" id="L925">            paramMap.put(TimeOffRequestsPerQuarterValidationRule.TIMEOFF_PER_QUARTER_VALUE,</span>
<span class="nc" id="L926">                    getParamValue(request.getParameter(TimeOffRequestsPerQuarterValidationRule.TIMEOFF_PER_QUARTER_VALUE)));</span>
           
        }
        
<span class="nc bnc" id="L930" title="All 2 branches missed.">        else if (key.equals(ValidationRulesMap.VALIDATION_REQ_MAX_DURATION)){</span>
<span class="nc" id="L931">            paramMap.put(MaximumRequestDurationValidationRule.MAX_REQUEST_DURATION_VALUE,</span>
<span class="nc" id="L932">                    getParamValue(request.getParameter(MaximumRequestDurationValidationRule.MAX_REQUEST_DURATION_VALUE)));</span>
<span class="nc" id="L933">            paramMap.put(MaximumRequestDurationValidationRule.MAX_REQUEST_DURATION_UNIT,</span>
<span class="nc" id="L934">                    getParamValue(request.getParameter(MaximumRequestDurationValidationRule.MAX_REQUEST_DURATION_UNIT)));</span>
<span class="nc bnc" id="L935" title="All 2 branches missed.">        } else if (key.equals(ValidationRulesMap.VALIDATION_SS_MAX_ONE_WAY_SWAP_PER_PERSON_PERIOD)){</span>
<span class="nc" id="L936">            paramMap.put(MaxNumberOneWaySwapPerPersonPeriodValidationRule.MAX_ONE_WAY_SWAP_PER_PERSON_PERIOD,</span>
<span class="nc" id="L937">                    getParamValue(request.getParameter(MaxNumberOneWaySwapPerPersonPeriodValidationRule.MAX_ONE_WAY_SWAP_PER_PERSON_PERIOD)));</span>
<span class="nc" id="L938">            paramMap.put(MaxNumberOneWaySwapPerPersonPeriodValidationRule.MAX_ONE_WAY_SWAP_PER_PERSON_PERIOD_UNIT,</span>
<span class="nc" id="L939">                    getParamValue(request.getParameter(MaxNumberOneWaySwapPerPersonPeriodValidationRule.MAX_ONE_WAY_SWAP_PER_PERSON_PERIOD_UNIT)));</span>
<span class="nc bnc" id="L940" title="All 2 branches missed.">        } else if (key.equals(ValidationRulesMap.VALIDATION_SS_MAX_APPROVED_SWAP_PER_SHIFT)) {</span>
<span class="nc" id="L941">            paramMap.put(MaxNumberApprovedSwapPerShiftValidationRule.MAX_APPROVED_SWAP_PER_SHIFT,</span>
<span class="nc" id="L942">                    getParamValue(request.getParameter(MaxNumberApprovedSwapPerShiftValidationRule.MAX_APPROVED_SWAP_PER_SHIFT)));</span>
<span class="nc bnc" id="L943" title="All 2 branches missed.">        } else if (key.equals(ValidationRulesMap.VALIDATION_SS_MAX_HOURS_ALTERNATE_MAX_HOURS_PER_DAY)) {</span>
<span class="nc" id="L944">            paramMap.put(MaxHoursAndMaxAlternateHoursPerDayValidationRule.MAX_HOURS_PER_DAY,</span>
<span class="nc" id="L945">                    getParamValue(request.getParameter(MaxHoursAndMaxAlternateHoursPerDayValidationRule.MAX_HOURS_PER_DAY)));</span>
<span class="nc" id="L946">            paramMap.put(MaxHoursAndMaxAlternateHoursPerDayValidationRule.MAX_ALTERNATIVE_HOURS_PER_DAY,</span>
<span class="nc" id="L947">                    getParamValue(request.getParameter(MaxHoursAndMaxAlternateHoursPerDayValidationRule.MAX_ALTERNATIVE_HOURS_PER_DAY)));</span>
<span class="nc bnc" id="L948" title="All 2 branches missed.">        } else if (key.equals(ValidationRulesMap.VALIDATION_AVOID_CAL_EVENTS)) {</span>
<span class="nc" id="L949">            String activities[] = ParameterUtil.getParameters(request,</span>
                    AvoidCalendarEventsValidationRule.CALENDAR_EVENT_ACTIVITY);
<span class="nc bnc" id="L951" title="All 2 branches missed.">            if (activities != null) {</span>
<span class="nc bnc" id="L952" title="All 2 branches missed.">                for (int i = 0; i &lt; activities.length; i++) {</span>
<span class="nc" id="L953">					paramMap.put(AvoidCalendarEventsValidationRule.CALENDAR_EVENT_ACTIVITY + i, new ID(activities[i]));</span>
				}

            }
<span class="nc bnc" id="L957" title="All 2 branches missed.">        } else if (key.equals(ValidationRulesMap.VALIDATION_CS_MAX_SHIFT_DURATION_PER_DAY)) {</span>
<span class="nc" id="L958">	        paramMap.put(&quot;CS_MAX_SHIFT_DURATION_VALUE&quot;,</span>
<span class="nc" id="L959">	                getParamValue(request.getParameter(&quot;CS_MAX_SHIFT_DURATION_VALUE&quot;)));</span>
<span class="nc" id="L960">	        paramMap.put(&quot;CS_MAX_SHIFT_DURATION_UNIT&quot;,</span>
<span class="nc" id="L961">	                getParamValue(request.getParameter(&quot;CS_MAX_SHIFT_DURATION_UNIT&quot;)));</span>
<span class="nc bnc" id="L962" title="All 2 branches missed.">	    } else if (key.equals(ValidationRulesMap.VALIDATION_CS_MIN_SHIFT_DURATION_PER_DAY)) {</span>
<span class="nc" id="L963">	        paramMap.put(&quot;CS_MIN_SHIFT_DURATION_VALUE&quot;,</span>
<span class="nc" id="L964">	                getParamValue(request.getParameter(&quot;CS_MIN_SHIFT_DURATION_VALUE&quot;)));</span>
<span class="nc" id="L965">	        paramMap.put(&quot;CS_MIN_SHIFT_DURATION_UNIT&quot;,</span>
<span class="nc" id="L966">	                getParamValue(request.getParameter(&quot;CS_MIN_SHIFT_DURATION_UNIT&quot;)));</span>
<span class="nc bnc" id="L967" title="All 2 branches missed.">	    } else if (key.equals(ValidationRulesMap.VALIDATION_CS_FULFILLS_NET_STAFFING_SHORTAGE)) {</span>
<span class="nc" id="L968">	        paramMap.put(&quot;CS_MIN_SHORTAGE_DURATION_VALUE&quot;,</span>
<span class="nc" id="L969">	                getParamValue(request.getParameter(&quot;CS_MIN_SHORTAGE_DURATION_VALUE&quot;)));</span>
<span class="nc bnc" id="L970" title="All 2 branches missed.">	    } else if (key.equals(ValidationRulesMap.VALIDATION_VTO_REDUCE_NET_STAFFING_SURPLUS)) {</span>
<span class="nc" id="L971">	        paramMap.put(&quot;VTO_MIN_SURPLUS_DURATION_VALUE&quot;,</span>
<span class="nc" id="L972">	                getParamValue(request.getParameter(&quot;VTO_MIN_SURPLUS_DURATION_VALUE&quot;)));</span>
	    }

<span class="nc" id="L975">        return rule;</span>
    }

	private String getParamValue(String paramValue) {
<span class="nc bnc" id="L979" title="All 2 branches missed.">		return StringUtil.isEmpty(paramValue) ? DEFAULT_PARAM_VALUE : paramValue;</span>
    }

    private String getParamValueStr(String paramValue){
<span class="nc bnc" id="L983" title="All 4 branches missed.">		return DEFAULT_PARAM_VALUE.equals(paramValue) || &quot;null&quot;.equals(paramValue) ? &quot;&quot; : paramValue;</span>
    }
    private String i18n(String key) {
<span class="nc" id="L986">		return i18n(rmBundle, key);</span>
	}
    @Override
	public String getHtmlDisplay() {
<span class="nc" id="L990">        return &quot;&quot;;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>