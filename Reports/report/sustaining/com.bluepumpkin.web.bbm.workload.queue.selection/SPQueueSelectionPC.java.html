<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>SPQueueSelectionPC.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.bbm.workload.queue.selection</a> &gt; <span class="el_source">SPQueueSelectionPC.java</span></div><h1>SPQueueSelectionPC.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.bbm.workload.queue.selection;

import java.text.MessageFormat;
import java.util.Collection;
import java.util.Collections;
import java.util.HashMap;
import java.util.Map;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.ejb.bbm.campaign.model.SchedulingPeriod;
import com.bluepumpkin.ejb.bbm.workload.model.Media;
import com.bluepumpkin.ejb.bbm.workload.model.Queue;
import com.bluepumpkin.ejb.bbm.workload.model.queueattribute.QueueAttributeFilter;
import com.bluepumpkin.web.bbm.campaign.CampaignModelHandler;
import com.bluepumpkin.web.bbm.l10n.BbmWebBundleKey;
import com.bluepumpkin.web.bbm.workload.queue.QueueUtil;
import com.bluepumpkin.web.bbm.workload.queue.selection.queueattribute.filter.QueueAttributeFilterModelHandler;
import com.verint.web.wfm.keys.WfmJavaScriptFileID;
import com.witness.web.uif.pagecomponent.tree.MultiColInputTreePC;
import com.witness.web.uif.pagecomponent.tree.util.TreeNodeHelper;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.system.manager.impl.DefaultVerticalizationManager;
import com.witness.web.uif.util.HtmlUtil;

public class SPQueueSelectionPC extends MultiColInputTreePC {
	private static final long serialVersionUID = 3657622399236230430L;
	public static final String CHECKED_ID_FN = &quot;checkedQueueID&quot;;
	public static final String FN_IGNORE_PAGE_DIRTY = &quot;ignorePageDirty&quot;;
	public static final String FN_SELECTION_BEHAVIOR_TYPE = &quot;selectionBehaviorType&quot;;
	
<span class="nc" id="L31">	private boolean m_isShowSubQueues = false;</span>
<span class="nc" id="L32">	private boolean m_isComplexIDs = false;</span>
	
<span class="nc" id="L34">	private Map&lt;ID, Media&gt; m_mediaFilter = Collections.emptyMap();</span>
<span class="nc" id="L35">	private Collection&lt;ID&gt; m_rootLinkQueues = Collections.emptyList();</span>
<span class="nc" id="L36">	private Map&lt;ID,ID&gt; m_queueMediaLink = null;</span>
	
<span class="nc" id="L38">	private ID m_queueAttribFilterID = null;</span>
<span class="nc" id="L39">	private ID m_campaignID = null;</span>
<span class="nc" id="L40">	private ID m_schedulingPeriodID = null;</span>
<span class="nc" id="L41">	private boolean m_ignorePageDirty = false;</span>
<span class="nc" id="L42">	private String m_selectionBehaviorType = null;</span>
<span class="nc" id="L43">	private boolean m_isHideProcessQueues = false;;</span>
	
	/**
	 * Constructor
	 */
	public SPQueueSelectionPC(RequestContext context) {
<span class="nc" id="L49">		super(context, CHECKED_ID_FN, BbmWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L50">		setJSMediator(WfmJavaScriptFileID.SPQUEUESELECTION_PC);</span>
<span class="nc" id="L51">		setJavaScriptFileName(getMediatorName());</span>
		
	    // header
<span class="nc" id="L54">		Object[] args = new Object[1];</span>
<span class="nc" id="L55">	    args[0] = m_context.getSystemManagerFactory().getVerticalizationManager().getVerticalizedString(m_context, DefaultVerticalizationManager.QUEUE);</span>
<span class="nc" id="L56">	    setHeaderTitle( MessageFormat.format( i18n(m_bundle, BbmWebBundleKey.QUEUE_NAME), args) );</span>
	    
<span class="nc" id="L58">	    setName(&quot;spQueueTree&quot;);</span>
<span class="nc" id="L59">	}</span>

	
	public boolean isIgnorePageDirty() {
<span class="nc" id="L63">		return m_ignorePageDirty;</span>
	}
	
	/**
	 * Sets the behavior of the selection tree around displaying / selecting sp queue nodes.
	 * @param behaviorType SERVICE_GOALS or FORECASTING or FTE_REQUIREMENTS
	 */
	public void setSelectionBehaviorType(String behaviorType)
	{
<span class="nc" id="L72">		m_selectionBehaviorType = behaviorType;</span>
<span class="nc" id="L73">	}</span>

	public String getSelectionBehaviorType()
	{
<span class="nc" id="L77">		return m_selectionBehaviorType;</span>
	}
	
	@Override
	public String getHtmlDisplay() {
<span class="nc" id="L82">		String html = super.getHtmlDisplay();</span>
<span class="nc" id="L83">		html += HtmlUtil.makeHiddenInput(FN_IGNORE_PAGE_DIRTY, isIgnorePageDirty());</span>
<span class="nc" id="L84">		html += HtmlUtil.makeHiddenInput(FN_SELECTION_BEHAVIOR_TYPE, getSelectionBehaviorType());</span>
<span class="nc" id="L85">		return html;</span>
	}

	public void setIgnorePageDirty(boolean pageDirtyCheck) {
<span class="nc" id="L89">		m_ignorePageDirty = pageDirtyCheck;</span>
<span class="nc" id="L90">	}</span>


	@Override
	public String getJavaScriptInitCode() {
<span class="nc" id="L95">		String js = super.getJavaScriptInitCode();</span>
<span class="nc bnc" id="L96" title="All 2 branches missed.">		if (m_ignorePageDirty) js +=</span>
<span class="nc" id="L97">		 &quot;\n&quot;+ getName() + &quot;.isIgnorePageDirty = true;\n&quot;;</span>
<span class="nc" id="L98">		return js;</span>
	}

	@Override
	protected void setJavaScriptFileName() {
<span class="nc" id="L103">		super.setJavaScriptFileName(getMediatorName());</span>
<span class="nc" id="L104">	}</span>


	public void setIsShowSubQueues(boolean bValue)
	{
<span class="nc" id="L109">		m_isShowSubQueues = bValue;</span>
<span class="nc" id="L110">	}</span>
	
	public boolean getIsShowSubQueues()
	{
<span class="nc" id="L114">		return m_isShowSubQueues;</span>
	}
	
	
	public void setIsHideProcessQueues(boolean bValue)
	{
<span class="nc" id="L120">		m_isHideProcessQueues = bValue;</span>
<span class="nc" id="L121">	}</span>
	
	public boolean getIsHideProcessQueues()
	{
<span class="nc" id="L125">		return m_isHideProcessQueues;</span>
	}
	
	public void setIsComplexIDs(boolean bValue) {
<span class="nc" id="L129">		m_isComplexIDs = bValue;</span>
<span class="nc" id="L130">	}</span>
	
	public boolean getIsComplexIDs() {
<span class="nc" id="L133">		return m_isComplexIDs;</span>
	}
	
	public void bind(ID campaignID, ID schedulingPeriodID, ID queueAttributeFilterID, Map&lt;ID, Media&gt; mediaFilter, Collection&lt;ID&gt; rootLinkQueues) {
<span class="nc" id="L137">		m_queueAttribFilterID = queueAttributeFilterID;</span>
<span class="nc" id="L138">		bind(campaignID, schedulingPeriodID, mediaFilter, rootLinkQueues);</span>
<span class="nc" id="L139">	}</span>
	public void bind(ID campaignID, ID schedulingPeriodID, Map&lt;ID, Media&gt; mediaFilter, Collection&lt;ID&gt; rootLinkQueues)
	{
<span class="nc" id="L142">		m_campaignID = campaignID;</span>
<span class="nc" id="L143">		m_schedulingPeriodID = schedulingPeriodID;</span>
<span class="nc" id="L144">		m_mediaFilter = mediaFilter;</span>
<span class="nc" id="L145">		m_rootLinkQueues = rootLinkQueues;</span>
<span class="nc" id="L146">	}</span>
	
    protected Collection retrieveTreeObjects() throws Exception {
<span class="nc" id="L149">    	Collection queues = Collections.emptyList();</span>
     	
<span class="nc bnc" id="L151" title="All 4 branches missed.">        if (m_campaignID != null &amp;&amp; m_schedulingPeriodID != null) {</span>
        	
<span class="nc bnc" id="L153" title="All 4 branches missed.">        	if(m_queueAttribFilterID != null &amp;&amp; !QueueAttributeFilter.BLANK_ID.equals(m_queueAttribFilterID)) {</span>
<span class="nc" id="L154">            	queues = QueueAttributeFilterModelHandler.getQueuesAssociatedToFilter(m_context, m_queueAttribFilterID, m_campaignID, m_schedulingPeriodID, m_isShowSubQueues, null, null);</span>
<span class="nc bnc" id="L155" title="All 4 branches missed.">            	if(queues == null || queues.size() &lt; 1)</span>
<span class="nc" id="L156">            		return Collections.emptyList();</span>
            	
<span class="nc" id="L158">            	queues = filterQueueByMediaAndProcessType(queues);</span>
            	 
<span class="nc" id="L160">            	m_queueMediaLink = new HashMap&lt;ID, ID&gt;();</span>
<span class="nc bnc" id="L161" title="All 2 branches missed.">            	for(Object o:queues) {</span>
<span class="nc" id="L162">            		Queue q = (Queue)o;</span>
<span class="nc" id="L163">            		m_queueMediaLink.put(q.getID(), q.getMediaID());</span>
<span class="nc" id="L164">            	}</span>
<span class="nc" id="L165">            	return queues;</span>
            }
        	
<span class="nc" id="L168">        	SchedulingPeriod sp = CampaignModelHandler.getSchedulingPeriodByID(m_context, </span>
        			m_schedulingPeriodID);
<span class="nc" id="L170">            queues = CampaignModelHandler.getQueuesAssignedToCampaign(m_context, </span>
<span class="nc" id="L171">            		m_campaignID, sp.getStartTime(), sp.getEndTime(),</span>
                    m_isShowSubQueues);
        }

<span class="nc" id="L175">        return filterQueueByMediaAndProcessType(queues);</span>
    }
    
    private Collection filterQueueByMediaAndProcessType(Collection queues) {
<span class="nc bnc" id="L179" title="All 2 branches missed.">    	if (m_mediaFilter!=null) </span>
<span class="nc" id="L180">            queues = QueueUtil.filterQueuesByMediaMap(queues, m_mediaFilter);</span>

<span class="nc bnc" id="L182" title="All 2 branches missed.">        if (m_isHideProcessQueues)</span>
<span class="nc" id="L183">        	queues = QueueUtil.filterQueuesByProcessType(queues);</span>
        
<span class="nc" id="L185">        return queues;</span>
    }

	/**
	 * Sets selected ID. It invokes setCheckedID internally and it is meant
	 * mainly for auto extract parameters
	 */
	public void setCheckedQueueID(ID[] checkedID) {
<span class="nc" id="L193">		setCheckedID(checkedID);</span>
<span class="nc" id="L194">	}</span>

	protected Object getTreeRootData() {
<span class="nc" id="L197">		return QueueUtil.ROOT_OBJ;</span>
	}
	
	/**
	 * Identifies whether the queue id is contained in the current list.
	 * @param queueID
	 * @return boolean	true|false
	 */
	public boolean containsId(ID queueID) {
<span class="nc" id="L206">		boolean result = false;</span>
		try {
<span class="nc" id="L208">			Collection treeObjects = retrieveTreeObjects();</span>
<span class="nc bnc" id="L209" title="All 2 branches missed.">			for(Object o : treeObjects) {</span>
<span class="nc" id="L210">				Queue q = (Queue)o;</span>
<span class="nc bnc" id="L211" title="All 2 branches missed.">				if(q.getID().compareTo(queueID) == 0) </span>
<span class="nc" id="L212">					return true;</span>
<span class="nc" id="L213">			}</span>
<span class="nc" id="L214">		} catch (Exception ex) {</span>
<span class="nc" id="L215">			handleUnableToLoadDataError(log, ex);</span>
<span class="nc" id="L216">		}</span>
<span class="nc" id="L217">		return result;</span>
	}

	protected TreeNodeHelper getTreeNodeHelper(Collection treeObjects) {
<span class="nc" id="L221">		boolean isSpSkillBased = false;</span>
<span class="nc" id="L222">		SchedulingPeriod sp = null;</span>
		try {
<span class="nc bnc" id="L224" title="All 2 branches missed.">			if(m_schedulingPeriodID != null) {</span>
<span class="nc" id="L225">				sp = CampaignModelHandler.getSchedulingPeriodByID(m_context, </span>
						m_schedulingPeriodID);	
<span class="nc" id="L227">				isSpSkillBased = sp.getSkillBased();</span>
			}
<span class="nc" id="L229">		} catch (Exception e) {</span>
<span class="nc" id="L230">			this.handleUnableToLoadDataError</span>
<span class="nc" id="L231">			(log, e);</span>
<span class="nc" id="L232">		}</span>
		
<span class="nc" id="L234">		ISPQueueSelectionStrategy selectionStrategy =</span>
<span class="nc" id="L235">			SPQueueSelectionStrategyFactory.getSPQueueSelectionStrategy(m_selectionBehaviorType);</span>

<span class="nc" id="L237">		SPQueueTreeNodeHelper nodeHelper = new SPQueueTreeNodeHelper(m_context, treeObjects, </span>
				m_mediaFilter, m_campaignID, sp, m_localizer, 
				true, false, true, selectionStrategy, m_rootLinkQueues, m_queueAttribFilterID, m_queueMediaLink);
		
<span class="nc bnc" id="L241" title="All 4 branches missed.">		setIsTreeRootShown(selectionStrategy.isCombinedMediaRootNodeVisible() &amp;&amp; !nodeHelper.isEmptyRoot());</span>
<span class="nc" id="L242">		return nodeHelper;</span>
		
		
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>