<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>QueueSelectorFormPopupPM.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.bbm.workload.queue.selection</a> &gt; <span class="el_source">QueueSelectorFormPopupPM.java</span></div><h1>QueueSelectorFormPopupPM.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.bbm.workload.queue.selection;

import java.text.MessageFormat;
import java.util.Collection;
import java.util.Date;
import java.util.ResourceBundle;

import javax.servlet.http.HttpServletRequest;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.logging.Category;
import com.bluepumpkin.common.util.StringUtil;
import com.bluepumpkin.ejb.bbm.workload.model.Media;
import com.bluepumpkin.web.bbm.Log;
import com.bluepumpkin.web.bbm.l10n.BbmWebBundleKey;
import com.bluepumpkin.web.bbm.workload.WorkloadModelHandler;
import com.verint.web.wfm.keys.WfmJavaScriptFileID;
import com.witness.web.uif.keys.PageAction;
import com.witness.web.uif.l10n.UIFWebBundleKey;
import com.witness.web.uif.pagemodel.ContainersInColumnsPM;
import com.witness.web.uif.pagemodel.PageModel;
import com.witness.web.uif.pagemodel.PopupWindowPM;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.system.manager.impl.DefaultVerticalizationManager;
import com.witness.web.uif.util.ContainerList;
import com.witness.web.uif.util.HtmlUtil;

/**
 * Title: QueueSelectorFormPopupPM
 * Description: Queue Selector Form Popup Page
 * Copyright: Copyright (c) 2002
 * Company: Blue Pumpkin Software, Inc
 * @author David Su, dsu
 * @version 1.0
 *
 * Created on January 6, 2003, 10:45 AM
 */
public class QueueSelectorFormPopupPM
		extends PopupWindowPM
		implements ContainersInColumnsPM {
<span class="nc" id="L41">	protected static final Category m_log = Log.initCategory(QueueSelectorFormPopupPM.class.getName());</span>
	protected ContainerList m_containerList;
	protected CampaignFilterPC m_camFilterPC;
	protected ResourceBundle m_bundle;
	protected ID m_campaignID;
	protected boolean m_isCombined;
<span class="nc" id="L47">	protected boolean m_isDisplayQueueOnly = false;</span>
	protected Date m_tpSDate;
	protected Date m_tpEDate;

	private ID m_mediaID;
	private Media m_media;

	/** 
	 * Creates a new instance of QueueSelectorFormPopupPM
	 */
	public QueueSelectorFormPopupPM(RequestContext context) {
<span class="nc" id="L58">		super(context);</span>

<span class="nc" id="L60">		m_bundle = m_localizer.getBundle(BbmWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L61">		m_containerList = new ContainerList(this, 2);</span>

<span class="nc" id="L63">		m_camFilterPC = new CampaignFilterPC(context);</span>
<span class="nc" id="L64">		m_containerList.add(0, m_camFilterPC);</span>

<span class="nc" id="L66">		setJSMediator(WfmJavaScriptFileID.MEDIATOR_QUEUE_SELECTOR);</span>
<span class="nc" id="L67">		setIsCloseAfterLoad(false);</span>
<span class="nc" id="L68">		setIsRefreshOpenerOnClose(false);</span>
<span class="nc" id="L69">	}</span>

	/**
	 * Return an instance of Page Model
	 */
	public static PageModel getInstance(RequestContext context) {
<span class="nc" id="L75">		return getInstance(context, QueueSelectorFormPopupPM.class);</span>
	}

	/**
	 * Initialize Model with Data
	 */
	@Override
	protected void initializeModel() {
<span class="nc bnc" id="L83" title="All 2 branches missed.">		if (m_isInitialized) {</span>
<span class="nc" id="L84">			return;</span>
		} else {
<span class="nc" id="L86">			m_isInitialized = true;</span>
		}

		try {
<span class="nc" id="L90">			m_camFilterPC.init();</span>
<span class="nc bnc" id="L91" title="All 2 branches missed.">			if (m_mediaID != null) {</span>
<span class="nc" id="L92">				m_media = WorkloadModelHandler.getMedia(m_context, m_mediaID);</span>
			}
<span class="nc" id="L94">		} catch (Exception ex) {</span>
<span class="nc" id="L95">			handleUnableToLoadDataError(m_log, ex);</span>
		} finally {
<span class="nc" id="L97">			initContentTitle();</span>
<span class="nc" id="L98">			initContent();</span>
<span class="nc" id="L99">			initToolbar();</span>
<span class="nc" id="L100">		}</span>
<span class="nc" id="L101">	}</span>

	/**
	 * Initialize Content
	 */
	protected void initContent() {
<span class="nc" id="L107">		m_camFilterPC.setCampaignID(m_campaignID);</span>
<span class="nc" id="L108">		m_camFilterPC.setIsDisplayQueueOnly(m_isDisplayQueueOnly);</span>
<span class="nc" id="L109">		m_camFilterPC.setIsCombined(m_isCombined);</span>
<span class="nc" id="L110">		m_camFilterPC.setStartDate(m_tpSDate);</span>
<span class="nc" id="L111">		m_camFilterPC.setEndDate(m_tpEDate);</span>
<span class="nc" id="L112">	}</span>

	/**
	 * Extract parameter using current Request Context
	 */
	@Override
	public boolean extractParameters(HttpServletRequest request) {
<span class="nc" id="L119">		boolean success = super.extractParameters(request);</span>

<span class="nc" id="L121">		m_campaignID = m_camFilterPC.getCampaignID();</span>
<span class="nc" id="L122">		m_isDisplayQueueOnly = m_camFilterPC.isDisplayQueueOnly();</span>
<span class="nc" id="L123">		m_isCombined = m_camFilterPC.isCombined();</span>
<span class="nc" id="L124">		m_tpSDate = m_camFilterPC.getStartDate();</span>
<span class="nc" id="L125">		m_tpEDate = m_camFilterPC.getEndDate();</span>

		// Try to see if mediaID is spelled MediaID;
<span class="nc bnc" id="L128" title="All 2 branches missed.">		if (m_mediaID == null) {</span>
<span class="nc" id="L129">			String val = request.getParameter(&quot;MediaID&quot;);</span>
<span class="nc bnc" id="L130" title="All 2 branches missed.">			if (!StringUtil.isEmpty(val)) {</span>
<span class="nc" id="L131">				m_mediaID = new ID(val);</span>
			}
		}
<span class="nc" id="L134">		return success;</span>
	}

	String filterMedia;
	public void setFilterMedia(String filter) {
<span class="nc" id="L139">		filterMedia = filter;</span>
<span class="nc" id="L140">		m_camFilterPC.setFilterMedia(filter);</span>
<span class="nc" id="L141">	}</span>

	public void setCampaignID(ID campaignID) {
<span class="nc" id="L144">		m_campaignID = campaignID;</span>
<span class="nc" id="L145">	}</span>

	public ID getCampaignID() {
<span class="nc" id="L148">		return m_campaignID;</span>
	}

	public void setIsDisplayQueueOnly(boolean bSwitch) {
<span class="nc" id="L152">		m_isDisplayQueueOnly = bSwitch;</span>
<span class="nc" id="L153">	}</span>

	public boolean isDisplayQueueOnly() {
<span class="nc" id="L156">		return m_isDisplayQueueOnly;</span>
	}

	public boolean isCombined() {
<span class="nc" id="L160">		return m_isCombined;</span>
	}

	public Date getStartDate() {
<span class="nc" id="L164">		return m_tpSDate;</span>
	}

	public Date getEndDate() {
<span class="nc" id="L168">		return m_tpEDate;</span>
	}

	public void setMediaID(ID id) {
<span class="nc" id="L172">		m_mediaID = id;</span>
<span class="nc" id="L173">	}</span>

	public ID getMediaID() {
<span class="nc" id="L176">		return m_mediaID;</span>
	}

	/**
	 * Prepare content title for rendering
	 */
	protected void initContentTitle() {
<span class="nc bnc" id="L183" title="All 2 branches missed.">		String vTemp = (m_media != null)</span>
				? BbmWebBundleKey.QUEUE_SELECTOR_WITH_MEDIA
				: BbmWebBundleKey.QUEUE_SELECTOR;

		// verticalise queue
<span class="nc" id="L188">		Object[] args = new Object[1];</span>
<span class="nc" id="L189">		args[0] = m_context.</span>
<span class="nc" id="L190">				getSystemManagerFactory().getVerticalizationManager().getVerticalizedString(m_context, DefaultVerticalizationManager.QUEUE);</span>
<span class="nc" id="L191">		String itemRbKey = MessageFormat.format(i18n(m_bundle, vTemp), args);</span>

<span class="nc" id="L193">		m_contentTitlePC.setPageTitle(itemRbKey);</span>
<span class="nc bnc" id="L194" title="All 2 branches missed.">		if (m_media != null) {</span>
<span class="nc" id="L195">			m_contentTitlePC.setItemName(m_media.getName());</span>
		}
<span class="nc" id="L197">	}</span>

	/**
	 * Prepare toolbar for rendering
	 */
	@Override
	protected void initToolbar() {
<span class="nc" id="L204">		String setLabel = i18n(m_common_bundle, UIFWebBundleKey.TOOLBAR_SET);</span>

<span class="nc" id="L206">		String setBtnOnClickJS = &quot;pageMediator.handleSetAction();&quot;;</span>
<span class="nc" id="L207">		m_toolbar.addJSTextButton(PageAction.SET, setLabel, false, setBtnOnClickJS).setIsListButton(true);</span>

<span class="nc" id="L209">		m_toolbar.addCloseWindowTextButton(PageAction.CANCEL, i18n(m_common_bundle, UIFWebBundleKey.TOOLBAR_CANCEL), true);</span>
<span class="nc" id="L210">	}</span>

	/**
	 * Return List of Containers
	 */
	@Override
	public Collection getContainers() {
<span class="nc" id="L217">		return m_containerList;</span>
	}

	/**
	 * Return URL for HTML Form Action
	 */
	@Override
	public String getFormAction() {
<span class="nc" id="L225">		return QueueSelectorPC.QUEUE_SELECTOR_POPUP_REQUEST_HANDLER;</span>
	}

	/**
	 * Return Required Html
	 */
	@Override
	public String getRequiredHTML() {
<span class="nc" id="L233">		return super.getRequiredHTML() +</span>
<span class="nc" id="L234">				HtmlUtil.makeHiddenInput(&quot;mediaID&quot;, m_mediaID) +</span>
<span class="nc" id="L235">				HtmlUtil.makeHiddenInput(&quot;filterMedia&quot;, filterMedia) +</span>
<span class="nc" id="L236">				HtmlUtil.makeHiddenInput(&quot;isDisplayQueueOnly&quot;, m_isDisplayQueueOnly);</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>