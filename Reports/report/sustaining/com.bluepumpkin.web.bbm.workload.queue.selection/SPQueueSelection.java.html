<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>SPQueueSelection.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.bbm.workload.queue.selection</a> &gt; <span class="el_source">SPQueueSelection.java</span></div><h1>SPQueueSelection.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.bbm.workload.queue.selection;

import java.util.ArrayList;
import java.util.Collection;
import java.util.Iterator;
import java.util.Map;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.util.StringUtil;

/**
 * Selection object to abstract the serialization/deserialization of the complex id of the selection
 * Copyright:  	Copyright (c) 2010
 * Company:    	Verint, Inc
 * @author 		Larry Chase
 * @version		1.0
 */
public class SPQueueSelection {
	private final static String ID_TOKEN = &quot;;&quot;;
	private final static String IDSET_TOKEN = &quot;,&quot;;
	private ID m_campaignID;
	private ID m_schedulingPeriodID;
	private ID m_mediaID;
	private ID m_queueID;
	private boolean m_isSchedulingPeriodSkilled;
	private int m_schedulingPeriodQueueCount;
	
	private ID m_queueAttributeFilterID;
	private Map&lt;ID,ID&gt; m_queueMediaMap;
	/**
	 * Constructor accepting campaign ID, scheduling period ID, media ID,
	 * and queue ID. (A little messy because there are some inconsistent 
	 * use cases around skilled vs. unskilled as well as the number of 
	 * queues that we need information to deal with).
	 * 
	 * @param campaignID					Campaign ID
	 * @param spID							Scheduling Period ID
	 * @param mediaID						Media ID
	 * @param queueID						Queue ID
	 * @param isSchedulingPeriodSkilled		Skill Base Scheduling Period (true/false)
	 * @param schedulingPeriodQueueCount	Number of Queues in the scheduling period.
	 */
	private SPQueueSelection(ID campaignID, ID spID, ID mediaID, ID queueID, 
<span class="nc" id="L44">			boolean isSchedulingPeriodSkilled, int schedulingPeriodQueueCount) {</span>
<span class="nc" id="L45">		m_campaignID = campaignID;</span>
<span class="nc" id="L46">		m_schedulingPeriodID = spID;</span>
<span class="nc" id="L47">		m_mediaID = mediaID;</span>
<span class="nc" id="L48">		m_queueID = queueID;</span>
<span class="nc" id="L49">		m_isSchedulingPeriodSkilled = isSchedulingPeriodSkilled;</span>
<span class="nc" id="L50">		m_schedulingPeriodQueueCount = schedulingPeriodQueueCount;</span>
<span class="nc" id="L51">	}</span>
	
	public SPQueueSelection(ID campaignID, ID spID, ID mediaID, ID queueID, boolean isSchedulingPeriodSkilled, int schedulingPeriodQueueCount, ID queueAttribFilterID, Map&lt;ID, ID&gt; queueMediaMap) {
<span class="nc" id="L54">		this(campaignID, spID, mediaID, queueID, isSchedulingPeriodSkilled, schedulingPeriodQueueCount);</span>
<span class="nc" id="L55">		m_queueAttributeFilterID = queueAttribFilterID;</span>
<span class="nc" id="L56">		m_queueMediaMap = queueMediaMap;</span>
<span class="nc" id="L57">	}</span>
	
	/**
	 * Returns the campaign ID of the selection.
	 * 
	 * @return Campaign ID
	 * @see ID
	 */
	public ID getCampaignID() {
<span class="nc" id="L66">		return m_campaignID;</span>
	}
	
	/**
	 * Sets the campaign ID of the selection.
	 */
	public void setCampaignID(ID campaignID) {
<span class="nc" id="L73">		m_campaignID = campaignID;</span>
<span class="nc" id="L74">	}</span>
	
	/**
	 * Returns the scheduling period ID of the selection.
	 * 
	 * @return Scheduling Period ID
	 * @see ID
	 */
	public ID getSchedulingPeriodID() {
<span class="nc" id="L83">		return m_schedulingPeriodID;</span>
	}
	
	/**
	 * Returns the media ID of the selection.
	 * 
	 * @return Media ID
	 * @see ID
	 */
	public ID getMediaID() {
<span class="nc" id="L93">		return m_mediaID;</span>
	}
	
	/**
	 * Returns the queue ID of the selection.
	 * 
	 * @return Queue ID
	 * @see ID
	 */
	public ID getQueueID() {
<span class="nc" id="L103">		return m_queueID;</span>
	}
	
	/**
	 * Returns whether the selection is a combined selection.
	 */
	public boolean isCombinedSelection()
	{
<span class="nc bnc" id="L111" title="All 2 branches missed.">		return (m_queueID == null);</span>
	}
	
	/**
	 * Skill configuration of the scheduling period.
	 * @return
	 */
	public boolean getIsSchedulingPeriodSkilled() {
<span class="nc" id="L119">		return m_isSchedulingPeriodSkilled;</span>
	}
	
	/**
	 * Scheduling period queue count.
	 * @return
	 */
	public int getSchedulingPeriodQueueCount() {
<span class="nc" id="L127">		return m_schedulingPeriodQueueCount;</span>
	}
	
	public ID getQueueAttributeFilterID() {
<span class="nc" id="L131">		return m_queueAttributeFilterID;</span>
	}
	
	private String getIDValue(ID id) {
<span class="nc bnc" id="L135" title="All 2 branches missed.">		if (id==null) return &quot;&quot;;</span>
<span class="nc" id="L136">		else return id.toString();</span>
	}
	
	/**
	 * Returns id string in the format campaignID;schedulingPeriodID;mediaID;queueID;isSchedulingPeriodSkilled;schedulingPeriodQueueCount
	 */
	public String toIDString() {
		//Using new ID(0) instead of QueueAttributeFilter.BLANK_ID to avoid the build issues in WFM\fs applet build folder
<span class="nc bnc" id="L144" title="All 6 branches missed.">		if(m_queueID != null || m_queueAttributeFilterID == null || new ID(0).equals(m_queueAttributeFilterID)) {</span>
		//if(m_queueID != null || m_queueAttributeFilterID == null || QueueAttributeFilter.BLANK_ID.equals(m_queueAttributeFilterID)) {
<span class="nc" id="L146">			return defaultIDString();</span>
<span class="nc bnc" id="L147" title="All 2 branches missed.">		} else if (m_mediaID != null){</span>
<span class="nc bnc" id="L148" title="All 2 branches missed.">			if(m_queueMediaMap != null) {</span>
<span class="nc" id="L149">				Collection&lt;SPQueueSelection&gt; selection = new ArrayList&lt;SPQueueSelection&gt;();</span>
				
<span class="nc" id="L151">				Iterator&lt;ID&gt; iter = m_queueMediaMap.keySet().iterator();</span>
<span class="nc bnc" id="L152" title="All 2 branches missed.">				while(iter.hasNext()) {</span>
<span class="nc" id="L153">					ID queueID = iter.next();</span>
<span class="nc bnc" id="L154" title="All 2 branches missed.">					if(m_mediaID.equals(m_queueMediaMap.get(queueID))) {</span>
<span class="nc" id="L155">						selection.add(new SPQueueSelection(getCampaignID(), getSchedulingPeriodID(), m_queueMediaMap.get(queueID), queueID, getIsSchedulingPeriodSkilled(), getSchedulingPeriodQueueCount()));</span>
					}
<span class="nc" id="L157">				}</span>
<span class="nc" id="L158">				return toIDString(selection);</span>
			} else {
<span class="nc" id="L160">				return defaultIDString();</span>
			}
			
		} else {
<span class="nc bnc" id="L164" title="All 2 branches missed.">			if(m_queueMediaMap != null) {</span>
<span class="nc" id="L165">				Collection&lt;SPQueueSelection&gt; selection = new ArrayList&lt;SPQueueSelection&gt;();</span>
				
<span class="nc" id="L167">				Iterator&lt;ID&gt; iter = m_queueMediaMap.keySet().iterator();</span>
<span class="nc bnc" id="L168" title="All 2 branches missed.">				while(iter.hasNext()) {</span>
<span class="nc" id="L169">					ID queueID = iter.next();</span>
<span class="nc" id="L170">					selection.add(new SPQueueSelection(getCampaignID(), getSchedulingPeriodID(), m_queueMediaMap.get(queueID), queueID, getIsSchedulingPeriodSkilled(), getSchedulingPeriodQueueCount()));</span>
<span class="nc" id="L171">				}</span>
<span class="nc" id="L172">				return toIDString(selection);</span>
			} else {
<span class="nc" id="L174">				return defaultIDString();</span>
			}
		}
	}
	
	private String generateID(ID queueID) {
<span class="nc" id="L180">		return getIDValue(getCampaignID()) + ID_TOKEN </span>
<span class="nc" id="L181">				+ getIDValue(getSchedulingPeriodID()) + ID_TOKEN</span>
<span class="nc" id="L182">				+ getIDValue(getMediaID()) + ID_TOKEN</span>
<span class="nc" id="L183">				+ getIDValue(queueID) + ID_TOKEN</span>
<span class="nc" id="L184">				+ getIsSchedulingPeriodSkilled() + ID_TOKEN</span>
<span class="nc" id="L185">				+ getSchedulingPeriodQueueCount();</span>
	}

	private String defaultIDString() {
<span class="nc" id="L189">		return getIDValue(getCampaignID()) + ID_TOKEN </span>
<span class="nc" id="L190">				+ getIDValue(getSchedulingPeriodID()) + ID_TOKEN</span>
<span class="nc" id="L191">				+ getIDValue(getMediaID()) + ID_TOKEN</span>
<span class="nc" id="L192">				+ getIDValue(getQueueID()) + ID_TOKEN</span>
<span class="nc" id="L193">				+ getIsSchedulingPeriodSkilled() + ID_TOKEN</span>
<span class="nc" id="L194">				+ getSchedulingPeriodQueueCount();</span>
	}
	
	/**
	 * Returns id string in the format campaignID;schedulingPeriodID;mediaID;queueID, 
	 * campaignID;schedulingPeriodID;mediaID;queueID, ...
	 * 
	 * @param spQueues	Collection of SPQueueSelections.
	 * @see SPQueueSelection 
	 */
	public static String toIDString(Collection&lt;SPQueueSelection&gt; spQueues) {
<span class="nc bnc" id="L205" title="All 2 branches missed.">		if (spQueues == null) return null;</span>
				
<span class="nc" id="L207">		StringBuilder collectionObjects = new StringBuilder();</span>
<span class="nc bnc" id="L208" title="All 2 branches missed.">		for (Iterator&lt;SPQueueSelection&gt; it = spQueues.iterator(); it.hasNext();) {</span>
<span class="nc" id="L209">			SPQueueSelection spQueueSelection = (SPQueueSelection) it.next();</span>
<span class="nc bnc" id="L210" title="All 2 branches missed.">			if(collectionObjects.length() &gt; 0) collectionObjects.append(IDSET_TOKEN);</span>
<span class="nc" id="L211">			collectionObjects.append(spQueueSelection.toIDString());</span>
<span class="nc" id="L212">		}</span>
		
<span class="nc" id="L214">		return collectionObjects.toString();</span>
	}
	
	/**
	 * Parses id string in the format campaignID;schedulingPeriodID;mediaID;queueID, 
	 * campaignID;schedulingPeriodID;mediaID;queueID, ... to collection of SPQueueSelection
	 * objects.
	 * 
	 * @return SPQueueSelection
	 * @see	SPQueueSelection
	 */
	public static ArrayList&lt;SPQueueSelection&gt; parseFromIDString(String idString) {
<span class="nc" id="L226">		ArrayList&lt;SPQueueSelection&gt; results = new ArrayList&lt;SPQueueSelection&gt;();</span>
<span class="nc bnc" id="L227" title="All 2 branches missed.">		if (!StringUtil.isEmpty(idString)) {</span>
<span class="nc" id="L228">			String[] idSets = idString.split(IDSET_TOKEN);</span>
<span class="nc bnc" id="L229" title="All 2 branches missed.">			for(int i = 0; i&lt;idSets.length; i++) {</span>
<span class="nc" id="L230">				String[] ids = idSets[i].split(ID_TOKEN);</span>
<span class="nc bnc" id="L231" title="All 2 branches missed.">				if (ids.length &gt;= 3) {</span>
<span class="nc" id="L232">					ID campaignID = null;</span>
<span class="nc bnc" id="L233" title="All 2 branches missed.">					if (StringUtil.isEmpty(ids[0]) == false) {</span>
<span class="nc" id="L234">						campaignID = new ID(ids[0]);</span>
					}
<span class="nc" id="L236">					ID schedulingPeriodID = null;</span>
<span class="nc bnc" id="L237" title="All 2 branches missed.">					if (StringUtil.isEmpty(ids[1]) == false) {</span>
<span class="nc" id="L238">						schedulingPeriodID = new ID(ids[1]);</span>
					}
<span class="nc" id="L240">					ID mediaID = null;			</span>
<span class="nc bnc" id="L241" title="All 2 branches missed.">					if (StringUtil.isEmpty(ids[2]) == false) {</span>
<span class="nc" id="L242">						mediaID = new ID(ids[2]);</span>
					}
					
<span class="nc" id="L245">					ID queueID = null;</span>
<span class="nc" id="L246">					boolean isSkilledSchedulingPeriod = Boolean.parseBoolean(ids[4]);</span>
<span class="nc" id="L247">					int schedulingPeriodQueueCount = Integer.parseInt(ids[5]);</span>
					
<span class="nc bnc" id="L249" title="All 2 branches missed.">					if (ids.length &gt; 3) {</span>
<span class="nc" id="L250">						String rawQueueId = ids[3];</span>
<span class="nc bnc" id="L251" title="All 4 branches missed.">						if(rawQueueId != null &amp;&amp; rawQueueId.compareTo(&quot;&quot;) != 0)</span>
<span class="nc" id="L252">							queueID = new ID(ids[3]);</span>
					}
					
<span class="nc" id="L255">					results.add(new SPQueueSelection(campaignID, schedulingPeriodID, mediaID, queueID, </span>
							isSkilledSchedulingPeriod, schedulingPeriodQueueCount));
				}
			}
		}
<span class="nc" id="L260">		return results;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>