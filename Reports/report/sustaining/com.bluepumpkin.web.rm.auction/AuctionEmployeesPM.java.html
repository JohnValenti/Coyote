<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>AuctionEmployeesPM.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.rm.auction</a> &gt; <span class="el_source">AuctionEmployeesPM.java</span></div><h1>AuctionEmployeesPM.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.rm.auction;

import java.util.ArrayList;
import java.util.Collection;
import java.util.Collections;
import java.util.Date;
import java.util.HashSet;
import java.util.Iterator;
import java.util.Map;

import javax.servlet.http.HttpServletRequest;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.Pair;
import com.bluepumpkin.common.util.BPMessageFormat;
import com.bluepumpkin.common.util.NumberFactory;
import com.bluepumpkin.common.util.StringUtil;
import com.bluepumpkin.ejb.bbm.workresource.model.Employee;
import com.bluepumpkin.ejb.rm.base.RmHardValidationException;
import com.bluepumpkin.ejb.rm.requests.shiftbid.shiftbidauction.model.SerializedAuction;
import com.bluepumpkin.ejb.rm.requests.shiftbid.shiftbidrequest.model.ShiftBidder;
import com.bluepumpkin.web.rm.keys.RmJavaScriptFileID;
import com.bluepumpkin.web.rm.keys.RmPageAction;
import com.bluepumpkin.web.rm.l10n.RmWebBundleKey;
import com.bluepumpkin.web.rm.requests.shiftbidding.ShiftBidUtil;
import com.witness.web.uif.base.Message;
import com.witness.web.uif.data.wrapper.DataWrapper;
import com.witness.web.uif.data.wrapper.NumberWrapper;
import com.witness.web.uif.data.wrapper.PersonNameWrapper;
import com.witness.web.uif.keys.PageAction;
import com.witness.web.uif.l10n.UIFWebBundleKey;
import com.witness.web.uif.pagecomponent.DefaultMultiColumnNodeData;
import com.witness.web.uif.pagecomponent.form.FormInputPC;
import com.witness.web.uif.pagecomponent.picker.date.DatePickerPC;
import com.witness.web.uif.pagecomponent.table.TableHeaderPC;
import com.witness.web.uif.pagemodel.PageModel;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.util.HtmlUtil;
import com.witness.web.uif.util.html.CSSUtil;

/**
 * File:         AuctionEmployeesPM
 * Description:  Page model for the list of employees in shift bidding auctions
 * Copyright:    Copyright (c) 2002
 * Company:      Blue Pumpkin Software, inc
 * @author       pbosin, David Su
 * @version      1.0
 * Created on July 29, 2002, 1:08 PM
 */
public class AuctionEmployeesPM extends AuctionBonusListPM {
	private static final String FORM_ACTION = &quot;rm_sa_employees&quot;;

	private static final String IS_BID_READY = &quot;isBidReady&quot;;
	private static final String IS_SCHEDULED = &quot;isScheduled&quot;;
	private static final String DEADLINE_PREFIX = &quot;dl_&quot;;
	private static final String WAITING_IDS_FN = &quot;waitingIDs&quot;;
	private static final String BID_ACTION_ENABLED_FN = &quot;bidActionEnabled&quot;;
	private static final String WITHDRAW_ACTION_ENABLED_FN = &quot;withdrawActionEnabled&quot;;
	private static final String ORG_ID_FN = &quot;orgID&quot;;

<span class="nc" id="L61">	private Map m_deadlineMap = Collections.emptyMap();</span>
<span class="nc" id="L62">	private Collection m_waitingIDs = Collections.emptyList();</span>
<span class="nc" id="L63">	private String m_waitingIDsStr = &quot;&quot;;</span>
<span class="nc" id="L64">	private boolean m_hasEditableFields=false;</span>
	private DatePickerPC m_datePickerPC;
	private SerializedAuction m_serializedAuction;
<span class="nc" id="L67">	private Date m_now = new Date();</span>
	private boolean m_bidActionEnabled;
	private boolean m_withdrawActionEnabled;
<span class="nc" id="L70">	private boolean m_isUseScoring=false;</span>

	/**
	 * Constructor
	 */
	public AuctionEmployeesPM(RequestContext context) {
<span class="nc" id="L76">		super(context, FORM_ACTION, RmWebBundleKey.RM_SA_EMPLOYEES);</span>

<span class="nc" id="L78">		m_datePickerPC = new DatePickerPC(context, DEADLINE_PREFIX);</span>
<span class="nc" id="L79">		m_datePickerPC.setIsTimeEnabled(true);</span>
<span class="nc" id="L80">		m_datePickerPC.setTimeZone(m_tz);</span>
<span class="nc" id="L81">		addChildComponent(m_datePickerPC);</span>

<span class="nc" id="L83">		setJSMediator(RmJavaScriptFileID.MEDIATOR_AUCTION_EMP);</span>
<span class="nc" id="L84">		setDefaultPageIDSize(10);</span>
<span class="nc" id="L85">		setIsPaginatingSelectedIDs(false);</span>
<span class="nc" id="L86">	}</span>

	/**
	 * Return an instance of the model that is ready for rendering
	 */
	public static PageModel getInstance(RequestContext context) throws Exception {
<span class="nc" id="L92">		return getInstance(context, AuctionEmployeesPM.class);</span>
	}

	/**
	 * Load Data
	 * @throws Exception
	 */
	@Override
	protected void loadData() throws Exception {
		try {
<span class="nc bnc" id="L102" title="All 2 branches missed.">			if (hasSelectedID()) {</span>
<span class="nc" id="L103">				ID auctionID = getSelectedIDObject();</span>
<span class="nc" id="L104">				m_auction = AuctionUtil.getAuctionAndValidate(auctionID, m_context, this);</span>
<span class="nc" id="L105">				m_isUseScoring = m_auction.getUsesScoring();</span>

<span class="nc" id="L107">				ShiftBidderFormPopupPM.addPopupArgs(this, RmPageAction.ADD_TO_AUCTION);</span>
<span class="nc" id="L108">				ShiftBidderFormPopupPM.addPopupArgsForOneByOne(this, RmPageAction.ADD_SERIALLY_TO_AUCTION);</span>
<span class="nc bnc" id="L109" title="All 2 branches missed.">				if (isPaginationNavPressed()){</span>
<span class="nc" id="L110">					m_listData = AuctionMH.getNextShiftBidders(auctionID, getPageIDs());</span>
				} else {
<span class="nc" id="L112">					m_serializedAuction = AuctionMH.getSerializedAuction(auctionID);</span>
<span class="nc" id="L113">					Pair shiftBidPair = (Pair)AuctionMH.getBidders(auctionID, m_orgID, getSortColumn(),</span>
<span class="nc" id="L114">							isSortAscending(),</span>
<span class="nc" id="L115">							getPageIDSize());</span>
<span class="nc" id="L116">					m_listData = (Collection)shiftBidPair.getSecond();</span>

<span class="nc" id="L118">					m_orgList = AuctionBonusListPM.getOrgList(m_context, m_auction);</span>
<span class="nc" id="L119">					initPaginationIDs((Collection)shiftBidPair.getFirst());</span>
				}
<span class="nc" id="L121">			} else {</span>
<span class="nc" id="L122">				addSelectAuctionMsg();</span>
			}
<span class="nc" id="L124">		} catch(RmHardValidationException ex) {</span>
<span class="nc" id="L125">			Message msg = handleUnableToLoadDataErrorAndLogAsDebug(log, ex);</span>
<span class="nc" id="L126">			msg.setAssociatedMessage(ex.getLocalizedMessage(m_localizer, m_context.getViewingTimeZone()));</span>
<span class="nc" id="L127">		}</span>
<span class="nc" id="L128">	}</span>

	/**
	 * Initialize Header
	 */
	@Override
	protected void initHeader() {
<span class="nc" id="L135">		TableHeaderPC header = m_list.getHeader();</span>

<span class="nc" id="L137">		header.setDefaultSortColumn(String.valueOf(ShiftBidder.SORTBY_NONE));</span>
<span class="nc" id="L138">		header.addColumnHeaderData(String.valueOf(ShiftBidder.SORTBY_NAME),</span>
<span class="nc" id="L139">                i18n(m_common_bundle, UIFWebBundleKey.NAME));</span>

<span class="nc" id="L141">		header.addColumnHeaderData(String.valueOf(ShiftBidder.SORTBY_STATUS),</span>
<span class="nc" id="L142">                i18n(m_common_bundle, UIFWebBundleKey.STATUS));</span>

<span class="nc" id="L144">		header.addColumnHeaderData(String.valueOf(ShiftBidder.SORTBY_SENIORITY),</span>
<span class="nc" id="L145">                i18n(m_common_bundle, UIFWebBundleKey.SENIORITY));</span>

<span class="nc" id="L147">		header.addColumnHeaderData(String.valueOf(ShiftBidder.SORTBY_RANK),</span>
<span class="nc" id="L148">                i18n(m_common_bundle, UIFWebBundleKey.RANK), CSSUtil.CLASS_HEADER_RIGHT); //.setIsForNumeric(true);</span>

<span class="nc" id="L150">		header.addColumnHeaderData(String.valueOf(ShiftBidder.SORTBY_POINTS),</span>
<span class="nc" id="L151">                i18n(m_common_bundle, UIFWebBundleKey.POINTS), CSSUtil.CLASS_HEADER_RIGHT); //.setIsForNumeric(true);</span>

<span class="nc" id="L153">		header.addColumnHeaderData(String.valueOf(ShiftBidder.SORTBY_BONUS),</span>
<span class="nc" id="L154">                i18n(m_common_bundle, UIFWebBundleKey.BONUS));</span>

<span class="nc bnc" id="L156" title="All 2 branches missed.">		if (m_isUseScoring) {</span>
<span class="nc" id="L157">			header.addColumnHeaderData(String.valueOf(ShiftBidder.SORTBY_SCORE),</span>
<span class="nc" id="L158">                    i18n(m_common_bundle, UIFWebBundleKey.SCORE), CSSUtil.CLASS_HEADER_RIGHT); //.setIsForNumeric(true);</span>
		}

<span class="nc" id="L161">		header.addColumnHeaderData(String.valueOf(ShiftBidder.SORTBY_DEADLINE),</span>
<span class="nc" id="L162">                i18n(m_common_bundle, UIFWebBundleKey.DEADLINE));</span>
<span class="nc" id="L163">	}</span>

	/**
	 * Initialize List
	 */
	@Override
	protected void initSelectableItems() {
<span class="nc bnc" id="L170" title="All 4 branches missed.">		if (m_listData.isEmpty() || !m_isPageEnabled) {</span>
<span class="nc" id="L171">			return;</span>
		}

<span class="nc" id="L174">		HashSet selectedIDSet = new HashSet( getPerfromActionOnIDsAsCollection() );</span>

<span class="nc" id="L176">		StringBuffer waitingIDsSB = new StringBuffer(20);</span>
<span class="nc" id="L177">		ArrayList listModel = new ArrayList(m_listData.size());</span>
<span class="nc" id="L178">		boolean isEditable = isEditActionEnabled();</span>
<span class="nc bnc" id="L179" title="All 2 branches missed.">		for(Iterator it=m_listData.iterator(); it.hasNext(); ) {</span>
<span class="nc" id="L180">			ShiftBidder bidder = (ShiftBidder)it.next();</span>
<span class="nc" id="L181">			ID bidderID = bidder.getID();</span>
<span class="nc" id="L182">			String rowID = bidderID.toString();</span>

<span class="nc" id="L184">			addRowData(bidder, rowID, isEditable, listModel);</span>

			// keep track of waiting IDs
<span class="nc bnc" id="L187" title="All 2 branches missed.">			if (ShiftBidder.STATUS_NOT_ADDED == bidder.getStatus()) {</span>
<span class="nc" id="L188">				waitingIDsSB.append(rowID).append(&quot;,&quot;);</span>
<span class="nc bnc" id="L189" title="All 2 branches missed.">			} else if (isBidReady(bidder)) {</span>
<span class="nc" id="L190">				m_hasEditableFields = true;</span>
			}

			// Mark selected IDs
<span class="nc bnc" id="L194" title="All 4 branches missed.">			if (isEditable &amp;&amp; selectedIDSet.contains(bidderID)) {</span>
<span class="nc" id="L195">				m_list.addSelectedRowID(rowID);</span>
			}
<span class="nc" id="L197">		}</span>

<span class="nc" id="L199">		m_waitingIDsStr = waitingIDsSB.toString();</span>
<span class="nc" id="L200">		m_list.setListModel(listModel);</span>
<span class="nc" id="L201">	}</span>

	@Override
	protected boolean hasEditableField() {
<span class="nc" id="L205">		return m_hasEditableFields;</span>
	}

	/**
	 * Initialize Toolbar
	 */
	@Override
	protected void initToolbar() {
<span class="nc" id="L213">		int itemCount = m_list.getSelectedRowIDCount();</span>
<span class="nc bnc" id="L214" title="All 2 branches missed.">		boolean hasSelectedRows = this.getPerformActionOnIDSize()&gt;0;</span>
<span class="nc" id="L215">		boolean isEditable = isEditActionEnabled();</span>

<span class="nc" id="L217">		String bidForEmpLbl = i18n(m_bundle, RmWebBundleKey.BID_FOR_EMP);</span>
<span class="nc" id="L218">		String removeLbl = i18n(m_bundle, RmWebBundleKey.REMOVE_FROM_AUCTION);</span>
<span class="nc" id="L219">		String unsched = i18n(m_bundle, RmWebBundleKey.WITHDRAW_APPROVED);</span>

		// Button related to Opening/Closing Auction
<span class="nc bnc" id="L222" title="All 2 branches missed.">		if (m_auction!=null) {</span>
<span class="nc" id="L223">			boolean isAuctionOpen = m_auction.isStatusOpen();</span>
<span class="nc" id="L224">			AuctionUtil.addOpenOrCloseAuctionBtn(this, m_context, m_toolbar,</span>
					isEditable, isAuctionOpen, m_bundle);
		}

<span class="nc bnc" id="L228" title="All 2 branches missed.">		m_toolbar.addSubmitTextButton(RmPageAction.BID_FOR_EMP, bidForEmpLbl, itemCount==1).setListButtonItems(1, 1);</span>

		//Unschedule employee
<span class="nc bnc" id="L231" title="All 2 branches missed.">		m_toolbar.addSubmitTextButton(RmPageAction.WITHDRAW_APPROVED_BID, unsched, itemCount==1).setListButtonItems(1, 1);</span>
<span class="nc" id="L232">		m_toolbar.addDivider();</span>

		// Add Buttons
<span class="nc" id="L235">		boolean isAddEnabled = isEditable;</span>
<span class="nc" id="L236">		String addLbl = i18n(m_bundle, RmWebBundleKey.ADD_TO_AUCTION);</span>
<span class="nc" id="L237">		m_toolbar.addPopupWindowTextButton(RmPageAction.ADD_TO_AUCTION, addLbl, isAddEnabled);</span>
<span class="nc bnc" id="L238" title="All 4 branches missed.">		if (m_serializedAuction==null || !m_serializedAuction.getIsEnabled()) {</span>
<span class="nc" id="L239">			String addSeriallyLbl = i18n(m_bundle, RmWebBundleKey.ADD_SERIALLY_TO_AUCTION);</span>
<span class="nc" id="L240">			m_toolbar.addPopupWindowTextButton(RmPageAction.ADD_SERIALLY_TO_AUCTION, addSeriallyLbl, isAddEnabled);</span>
<span class="nc" id="L241">		} else {</span>
<span class="nc" id="L242">			boolean isStopSerializedEnabled = isEditable;</span>
<span class="nc" id="L243">			String addOnebyOneLbl = i18n(m_bundle, RmWebBundleKey.STOP_SERIALIZED_ADD_TO_AUCTION);</span>
<span class="nc" id="L244">			m_toolbar.addSubmitTextButton(RmPageAction.STOP_ONE_BY_ONE_ADD_TO_AUCTION, addOnebyOneLbl, isStopSerializedEnabled);</span>
		}

<span class="nc" id="L247">		m_toolbar.addSubmitTextButton(PageAction.REMOVE, removeLbl, hasSelectedRows).setIsListButton(isEditable);</span>
<span class="nc" id="L248">		m_toolbar.addDivider();</span>

<span class="nc" id="L250">		super.initToolbar();</span>
<span class="nc" id="L251">		enableToolbarPagination();</span>
<span class="nc" id="L252">	}</span>

	/**
	 * Retrieve request parameters from request object to the page model object.
	 */
	@Override
	public boolean extractParameters(HttpServletRequest request) {
<span class="nc" id="L259">		boolean success =  super.extractParameters(request);</span>

		// need to convert String to Date
<span class="nc" id="L262">		m_deadlineMap = FormInputPC.extractIDKeyParamMap(request, DEADLINE_PREFIX);</span>
<span class="nc bnc" id="L263" title="All 2 branches missed.">		for(Iterator it=m_deadlineMap.entrySet().iterator(); it.hasNext();) {</span>
<span class="nc" id="L264">			Map.Entry entry = (Map.Entry)it.next();</span>
<span class="nc" id="L265">			String dateStr = (String)entry.getValue();</span>
<span class="nc" id="L266">			Date date = m_datePickerPC.convertStrToDate(dateStr);</span>
<span class="nc" id="L267">			entry.setValue(date);</span>
<span class="nc" id="L268">		}</span>

<span class="nc" id="L270">		return success;</span>
	}

	/**
	 * Return Required HTML for this component
	 */
	@Override
	public String getRequiredHTML() {
<span class="nc" id="L278">		return super.getRequiredHTML() +</span>
<span class="nc" id="L279">				HtmlUtil.makeHiddenInput(WAITING_IDS_FN, m_waitingIDsStr) +</span>
<span class="nc" id="L280">				HtmlUtil.makeHiddenInput(BID_ACTION_ENABLED_FN, m_bidActionEnabled) +</span>
<span class="nc" id="L281">				HtmlUtil.makeHiddenInput(WITHDRAW_ACTION_ENABLED_FN, m_withdrawActionEnabled) +</span>
<span class="nc" id="L282">				HtmlUtil.makeHiddenInput(ORG_ID_FN, m_orgID);</span>
	}

	public void setWaitingIDs(String value) {
<span class="nc" id="L286">		m_waitingIDsStr = value;</span>
<span class="nc" id="L287">		m_waitingIDs = StringUtil.parseIDStringToCollection(value);</span>
<span class="nc" id="L288">	}</span>
<span class="nc" id="L289">	public Collection getWaitingIDs() { return m_waitingIDs; }</span>


	public void setBidActionEnabled(boolean value) {
<span class="nc" id="L293">		m_bidActionEnabled = value;</span>
<span class="nc" id="L294">	}</span>
<span class="nc" id="L295">	public boolean getBidActionEnabled() { return m_bidActionEnabled; }</span>

	public void setWithdrawActionEnabled(boolean value) {
<span class="nc" id="L298">		m_withdrawActionEnabled = value;</span>
<span class="nc" id="L299">	}</span>
<span class="nc" id="L300">	public boolean getWithdrawActionEnabled() { return m_withdrawActionEnabled; }</span>

<span class="nc" id="L302">	public Map getDeadlineMap() { return m_deadlineMap; }</span>


	//////////////////////////////////////////////////////////////////////////////
	// Helper methods
	//////////////////////////////////////////////////////////////////////////////
	private void addRowData(ShiftBidder bidder, String rowID, boolean isEditable,
													Collection listModel) {
<span class="nc" id="L310">		Employee emp = bidder.getOptMethods().getEmployee();</span>
<span class="nc" id="L311">		boolean isBidReady = isBidReady(bidder);</span>
<span class="nc bnc" id="L312" title="All 4 branches missed.">		boolean isBonusEditable = isBidderBonusEditable(bidder) &amp;&amp; isEditable;</span>
<span class="nc bnc" id="L313" title="All 2 branches missed.">		if (isBonusEditable) {</span>
<span class="nc" id="L314">			m_hasEditableFields = true;</span>
		}

<span class="nc" id="L317">		int rank = emp.getRank();</span>
<span class="nc" id="L318">		int accumatedBonus = bidder.getOptMethods().getAccumulatedBonus();</span>

<span class="nc" id="L320">		DefaultMultiColumnNodeData node = new DefaultMultiColumnNodeData(rowID);</span>
<span class="nc" id="L321">		node.add( new PersonNameWrapper(emp, m_localizer), CSSUtil.STYLE_NORMAL_LEFT ); //508</span>
<span class="nc" id="L322">		node.add( getStatus( bidder ) );</span>
<span class="nc" id="L323">		node.add( ShiftBidUtil.getSeniority(emp, m_tz, m_localizer) );</span>
<span class="nc" id="L324">		node.add( new NumberWrapper(rank, m_localizer), CSSUtil.STYLE_NUMERIC );</span>
<span class="nc" id="L325">		node.add( new NumberWrapper(accumatedBonus, m_localizer), CSSUtil.STYLE_NUMERIC );</span>
<span class="nc" id="L326">		node.add( getBonusUI(rowID, bidder.getBonusThisAuction(), isBonusEditable) );</span>
<span class="nc bnc" id="L327" title="All 2 branches missed.">		if (m_isUseScoring) {</span>
<span class="nc" id="L328">			int scoreWithBonus = bidder.getOptMethods().getScoreWithBonus();</span>
<span class="nc" id="L329">			node.add( new NumberWrapper(scoreWithBonus, m_localizer), CSSUtil.STYLE_NUMERIC );</span>
		}
<span class="nc" id="L331">		node.add( getDeadline(bidder, isEditable) );</span>

		// Mark Bidders who are ready to bid
<span class="nc" id="L334">		node.getNodeAttributes().put(IS_BID_READY, String.valueOf(isBidReady));</span>

		// Mark Bidders who are already scheduled to enable Withdraw
<span class="nc" id="L337">		node.getNodeAttributes().put(IS_SCHEDULED, String.valueOf(isBidderScheduled(bidder)));</span>

<span class="nc" id="L339">		node.setSelectable(isEditable);</span>
<span class="nc" id="L340">		listModel.add( node );</span>
<span class="nc" id="L341">	}</span>


	private StatusWrapper getStatus(ShiftBidder shiftBidder) {
<span class="nc" id="L345">		int status = shiftBidder.getStatus();</span>
<span class="nc" id="L346">		int bidsSubmitted = -1;</span>
<span class="nc" id="L347">		String sStatus = &quot;&quot;;</span>

<span class="nc bnc" id="L349" title="All 3 branches missed.">		switch(shiftBidder.getStatus()) {</span>
			case ShiftBidder.STATUS_NOT_ADDED :
<span class="nc" id="L351">				sStatus = i18n(m_common_bundle, UIFWebBundleKey.STATUS_WAITING);</span>
<span class="nc" id="L352">				break;</span>
			case ShiftBidder.STATUS_UNAVAILABLE :
				// &quot;Unavailable&quot; would be a better name, but legacy code already uses &quot;Scheduled&quot; to indicate unavailable status so we don't want to change the label
<span class="nc" id="L355">				sStatus = i18n(m_bundle, RmWebBundleKey.STATUS_SCHEDULED);</span>
<span class="nc" id="L356">				break;</span>
			default:
<span class="nc" id="L358">				String msgFormat = i18n(m_bundle, RmWebBundleKey.STATUS_BID_SUMMITTED);</span>
<span class="nc" id="L359">				bidsSubmitted = shiftBidder.getOptMethods().getNumOfShiftBidRequests();</span>
<span class="nc" id="L360">				Object[] args = new Object[] { m_localizer.formatNumber(bidsSubmitted) };</span>
<span class="nc" id="L361">				sStatus = BPMessageFormat.format(msgFormat, args);</span>
		}

<span class="nc" id="L364">		return new StatusWrapper(status, bidsSubmitted, sStatus);</span>
	}

	private DealineWrapper getDeadline(ShiftBidder shiftBidder, boolean isEditable) {
<span class="nc" id="L368">		String deadline=&quot;&quot;;</span>

<span class="nc" id="L370">		Date date = null;</span>
<span class="nc" id="L371">		Date auctionDeadline = m_auction.getAuctionDeadLine();</span>
<span class="nc bnc" id="L372" title="All 2 branches missed.">		if (isBidReady(shiftBidder)) {</span>
<span class="nc" id="L373">			date=shiftBidder.getDeadlineDate();</span>
<span class="nc bnc" id="L374" title="All 2 branches missed.">			if (date==null) {</span>
<span class="nc" id="L375">				date=auctionDeadline;</span>
			}

<span class="nc bnc" id="L378" title="All 2 branches missed.">			if (isEditable) {</span>
<span class="nc" id="L379">				String fn = DEADLINE_PREFIX + shiftBidder.getID();</span>
<span class="nc" id="L380">				m_datePickerPC.setDateInputFieldName(fn);</span>
<span class="nc" id="L381">				m_datePickerPC.setDate(date);</span>
<span class="nc" id="L382">				m_datePickerPC.setInputFieldDesc(UIFWebBundleKey.DEADLINE, UIFWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L383">				adjustDateLimits(m_datePickerPC, date, m_now, auctionDeadline);</span>
<span class="nc" id="L384">				m_datePickerPC.initForDisplay();</span>
<span class="nc" id="L385">				deadline = m_datePickerPC.getHtmlDisplay();</span>
<span class="nc" id="L386">			} else {</span>
<span class="nc" id="L387">				deadline = AuctionUtil.columnCellFormatForAlignment(AuctionUtil.COLUMN_CELL_ALIGNMENT, m_localizer.formatDateTime(date, m_tz));</span>
			}
		}

<span class="nc" id="L391">		return new DealineWrapper(date, deadline);</span>
	}

	private static void adjustDateLimits(DatePickerPC datePickerPC, Date date, Date lowerDate, Date upperDate) {
<span class="nc bnc" id="L395" title="All 2 branches missed.">		Date lowerLimit = date.before(lowerDate) ? date : lowerDate;</span>
<span class="nc bnc" id="L396" title="All 2 branches missed.">		Date upperLimit = date.after(upperDate) ? date : upperDate;</span>
<span class="nc" id="L397">		datePickerPC.setLowerLimit(lowerLimit);</span>
<span class="nc" id="L398">		datePickerPC.setUpperLimit(upperLimit);</span>
<span class="nc" id="L399">	}</span>

	private boolean isBidReady(ShiftBidder shiftBidder) {
<span class="nc" id="L402">		int status = shiftBidder.getStatus();</span>
<span class="nc bnc" id="L403" title="All 4 branches missed.">		return status==ShiftBidder.STATUS_ADDED || status==ShiftBidder.STATUS_BIDSUBMITTED;</span>
	}

	private boolean isBidderBonusEditable(ShiftBidder shiftBidder) {
<span class="nc" id="L407">		int status = shiftBidder.getStatus();</span>
<span class="nc bnc" id="L408" title="All 6 branches missed.">		return</span>
				status==ShiftBidder.STATUS_NOT_ADDED ||
				status==ShiftBidder.STATUS_ADDED ||
				status==ShiftBidder.STATUS_BIDSUBMITTED;
	}

	private boolean isBidderScheduled(ShiftBidder shiftBidder) {
<span class="nc" id="L415">		int status = shiftBidder.getStatus();</span>
<span class="nc bnc" id="L416" title="All 2 branches missed.">		return</span>
				status==ShiftBidder.STATUS_UNAVAILABLE;
	}

	//////////////////////////////////////////////////////////////////////////////
	// Helper Classes
	//////////////////////////////////////////////////////////////////////////////
	private static class StatusWrapper extends DataWrapper {
		private int _status;
		private int _submittedBids;
		private String _display;

<span class="nc" id="L428">		public StatusWrapper(int status, int submittedBids, String display) {</span>
<span class="nc" id="L429">			_status = status;</span>
<span class="nc" id="L430">			_submittedBids = submittedBids;</span>
<span class="nc" id="L431">			_display = display;</span>
<span class="nc" id="L432">		}</span>

		@Override
		public int compareTo(Object o) {
<span class="nc bnc" id="L436" title="All 2 branches missed.">			if (o==null) {</span>
<span class="nc" id="L437">				return -1;</span>
			}
<span class="nc" id="L439">			StatusWrapper other = (StatusWrapper)o;</span>

<span class="nc" id="L441">			Comparable comp1 = null;</span>
<span class="nc" id="L442">			Comparable comp2 = null;</span>
<span class="nc bnc" id="L443" title="All 8 branches missed.">			if ((_status==ShiftBidder.STATUS_BIDSUBMITTED || _status==ShiftBidder.STATUS_ADDED) &amp;&amp;</span>
					(other._status==ShiftBidder.STATUS_BIDSUBMITTED || other._status==ShiftBidder.STATUS_ADDED)) {
<span class="nc" id="L445">				comp1 = NumberFactory.newInteger(_submittedBids);</span>
<span class="nc" id="L446">				comp2 = NumberFactory.newInteger(other._submittedBids);</span>
			} else {
<span class="nc" id="L448">				comp1 = NumberFactory.newInteger(_status);</span>
<span class="nc" id="L449">				comp2 = NumberFactory.newInteger(other._status);</span>
			}
<span class="nc" id="L451">			return comp1.compareTo(comp2);</span>
		}

		/**
		 * Return String Representation of Data.
		 */
		@Override
<span class="nc" id="L458">		public String getDisplay() { return _display;	}</span>
	}

	/**
	 * Return JavaScript Init Code
	 */
	@Override
	public String getJavaScriptInitCode() {
<span class="nc" id="L466">		String superJS = super.getJavaScriptInitCode();</span>
<span class="nc bnc" id="L467" title="All 2 branches missed.">		if (!this.hasPerformActionOnID()) {</span>
<span class="nc" id="L468">			return superJS;</span>
		} else {
<span class="nc" id="L470">			return superJS + &quot;\n&quot; + &quot;top.workpaneMediator.handleCustomTableSelection();\n&quot;;</span>
		}
	}

	private static class DealineWrapper extends DataWrapper {
		private Date _date;
		private String _display;

<span class="nc" id="L478">		public DealineWrapper(Date date, String display) {</span>
<span class="nc" id="L479">			_date = date;</span>
<span class="nc" id="L480">			_display = display;</span>
<span class="nc" id="L481">		}</span>

		@Override
		public int compareTo(Object o) {
<span class="nc" id="L485">			DealineWrapper other = (DealineWrapper)o;</span>
<span class="nc" id="L486">			return compare(_date, other._date);</span>
		}

		/**
		 * Return String Representation of Data.
		 */
		@Override
<span class="nc" id="L493">		public String getDisplay() { return _display; }</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>