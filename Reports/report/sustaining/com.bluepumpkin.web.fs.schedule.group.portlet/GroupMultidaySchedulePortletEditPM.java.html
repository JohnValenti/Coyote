<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>GroupMultidaySchedulePortletEditPM.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.fs.schedule.group.portlet</a> &gt; <span class="el_source">GroupMultidaySchedulePortletEditPM.java</span></div><h1>GroupMultidaySchedulePortletEditPM.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.fs.schedule.group.portlet;

import java.util.ArrayList;
import java.util.ResourceBundle;

import javax.portlet.PortletPreferences;

import weblogic.wsee.util.StringUtil;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.IDStringPair;
import com.bluepumpkin.common.datatypes.StringsPair;
import com.bluepumpkin.ejb.bbm.campaign.model.Campaign;
import com.bluepumpkin.ejb.bbm.workresource.model.Organization;
import com.bluepumpkin.web.bbm.campaign.CampaignModelHandler;
import com.bluepumpkin.web.bbm.organization.OrganizationModelHandler;
import com.bluepumpkin.web.bbm.people.groupselector.GroupSelectorPC;
import com.bluepumpkin.web.core.keys.CoreJavaScriptFileID;
import com.bluepumpkin.web.core.l10n.CoreWebBundleKey;
import com.bluepumpkin.web.fs.l10n.FsWebBundleKey;
import com.bluepumpkin.web.fs.schedule.group.GroupSchedulePM;
import com.verint.web.core.dashboard.pluto.PlutoPreferencesUtil;
import com.verint.web.core.dashboard.portlets.MultiIFramePortlet;
import com.witness.ejb.core.security.PrivilegeKeys;
import com.witness.web.uif.keys.PageAction;
import com.witness.web.uif.l10n.UIFWebBundleKey;
import com.witness.web.uif.pagecomponent.PageComponent;
import com.witness.web.uif.pagecomponent.form.FormInputPC;
import com.witness.web.uif.pagecomponent.form.FormTwoColumnPC;
import com.witness.web.uif.pagemodel.PageModel;
import com.witness.web.uif.pagemodel.WorkpaneFormPM;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.util.HtmlUtil;
import com.witness.web.uif.util.js.JSUtil;

@SuppressWarnings(&quot;serial&quot;)
public class GroupMultidaySchedulePortletEditPM extends WorkpaneFormPM {
	public static final String SORT_BY_FNAME = &quot;fname&quot;;
	public static final String SORT_BY_LNAME = &quot;lname&quot;;
	public static final String SORT_BY_START = &quot;start&quot;;
	public static final String SORT_BY_END = &quot;end&quot;;
	public static final String SORT_BY_LENGTH = &quot;length&quot;;
	
	public static final int DEFAULT_NUM_OF_DAYS = 7;
	
	protected static final String FN_NUM_DAYS = &quot;numDays&quot;;
	protected static final String FN_SORT_BY = &quot;sortBy&quot;;
	private static final String FN_TEMPLATE_ID = &quot;templateID&quot;;
	private static final String FN_INSTANCE_ID = &quot;instanceID&quot;;
	private static final String INITIAL_LOAD = &quot;initialLoad&quot;;
	
<span class="nc" id="L52">	private boolean savePressed = false;</span>

	protected FormTwoColumnPC m_form;
	protected FormInputPC m_numDaysPC;
	protected GroupSelectorPC m_groupSelector;
	
	private String m_instanceID, m_templateID;
	private boolean m_editComplete;
<span class="nc" id="L60">	private boolean m_initialLoad = true;</span>
	// Form Fields
<span class="nc" id="L62">	protected int m_numDays = DEFAULT_NUM_OF_DAYS;</span>
<span class="nc" id="L63">	protected String m_sortBy = SORT_BY_LNAME;</span>
<span class="nc" id="L64">	private String m_errorMessageId = null;</span>
	
	protected ResourceBundle m_bundle;

	public GroupMultidaySchedulePortletEditPM(RequestContext context) {
<span class="nc" id="L69">		super(context, PageModel.BASIC_MODEL);</span>
		
<span class="nc" id="L71">		m_bodyStyle = &quot;margin: 0px; overflow: auto;&quot;;</span>
<span class="nc" id="L72">		m_workAreaStyle = &quot;height: expression(document.body.clientHeight-28);&quot;;</span>
<span class="nc" id="L73">		m_workContentStyle = &quot;margin: 0px; border: 0px;&quot;;</span>
<span class="nc" id="L74">		m_workPaneStyle = &quot;height: 100%;&quot;;</span>

<span class="nc" id="L76">		this.setIsAutoResizeEnabled(false);</span>

<span class="nc" id="L78">		m_bundle = m_localizer.getBundle(FsWebBundleKey.BUNDLE_NAME);</span>
	
<span class="nc" id="L80">		m_form = new FormTwoColumnPC(context);</span>
<span class="nc" id="L81">		addChildComponent(m_form);</span>

<span class="nc" id="L83">		m_groupSelector = new GroupSelectorPC(context,m_toolbar);</span>
<span class="nc" id="L84">		addChildComponent(m_groupSelector);</span>
		
<span class="nc" id="L86">		addRequiredJavaScriptFile(CoreJavaScriptFileID.PORTLET_POPUP_UTIL);</span>
		
<span class="nc" id="L88">		m_numDaysPC = new FormInputPC(context);</span>
<span class="nc" id="L89">		m_numDaysPC.setInputFN(FN_NUM_DAYS);</span>
<span class="nc" id="L90">		m_numDaysPC.setInputType(FormInputPC.TYPE_INTEGER);</span>
<span class="nc" id="L91">		addChildComponent(m_numDaysPC);		</span>

<span class="nc" id="L93">		setIsIgnorePageDirty(true);		//TODO: this currently prevents is dirty dialog from popping up on group selector popup close</span>
<span class="nc" id="L94">	}</span>
	
	public String getScreenTitle() {
<span class="nc" id="L97">		return m_localizer.i18n(CoreWebBundleKey.BUNDLE_NAME, CoreWebBundleKey.EDIT_PORTLET);</span>
	}
	
	/**
	 * Initialize Toolbar
	 */
	protected void initToolbar() {
<span class="nc" id="L104">		m_toolbar.addValidateSubmitTextButton(PageAction.SAVE,</span>
<span class="nc bnc" id="L105" title="All 2 branches missed.">			i18n(m_common_bundle, UIFWebBundleKey.TOOLBAR_SAVE), !m_initFailure);</span>
<span class="nc" id="L106">		m_toolbar.addConfirmSubmitTextButton(PageAction.CANCEL,</span>
<span class="nc" id="L107">				i18n(m_common_bundle, UIFWebBundleKey.TOOLBAR_CANCEL), true);</span>
<span class="nc" id="L108">	}</span>

	/**
	 * @param setSavePressed The savePressed to set
	 */
	public void setSavePressed(boolean savePressed) {
<span class="nc" id="L114">		this.savePressed = savePressed;</span>
<span class="nc" id="L115">	}	</span>
	
	public String getHtmlDisplay() {
<span class="nc" id="L118">		StringBuffer html = new StringBuffer();</span>

<span class="nc bnc" id="L120" title="All 2 branches missed.">		if (m_editComplete) {</span>
<span class="nc bnc" id="L121" title="All 4 branches missed.">			if (this.getSaveErrMsgID() != null &amp;&amp; this.getSaveErrMsgID().length() &gt; 0) { //if there is error messageID, then call setErrorMsg() on the JS like below.</span>
<span class="nc" id="L122">				html.append(&quot;&lt;script type='text/javascript'&gt;setErrorMsg('&quot; + this.getSaveErrMsgID() + &quot;')&lt;/script&gt;&quot;);</span>
			}
<span class="nc bnc" id="L124" title="All 2 branches missed.">			if (savePressed) {</span>
<span class="nc" id="L125">				html.append(MultiIFramePortlet.getPortletModeSwitchJavascriptTag(m_templateID, &quot;view&quot;, &quot;save&quot;));</span>
			} else {
<span class="nc" id="L127">				html.append(MultiIFramePortlet.getPortletModeSwitchJavascriptTag(m_templateID, &quot;view&quot;, &quot;cancel&quot;));	</span>
			}
		}

<span class="nc bnc" id="L131" title="All 2 branches missed.">		if (this.getPageMessageList().size() &gt; 0)  html.append(this.displayAllMessages(m_context));</span>

<span class="nc" id="L133">		html.append(m_form.getHtmlDisplay());</span>
<span class="nc" id="L134">		html.append(HtmlUtil.makeHiddenInput(FN_TEMPLATE_ID, m_templateID));</span>
<span class="nc" id="L135">		html.append(HtmlUtil.makeHiddenInput(FN_INSTANCE_ID, m_instanceID));</span>
<span class="nc" id="L136">		html.append(HtmlUtil.makeHiddenInput(INITIAL_LOAD, m_initialLoad));</span>

<span class="nc" id="L138">		return html.append(super.getHtmlDisplay()).toString();</span>
	}

	/**
	 * make sort selector html string
	 */
	protected String makeSortSelector(){
<span class="nc" id="L145">		ArrayList&lt;StringsPair&gt; options = new ArrayList&lt;StringsPair&gt;(5);</span>
<span class="nc" id="L146">		options.add(new StringsPair(SORT_BY_LNAME,</span>
<span class="nc" id="L147">				i18n(m_bundle, FsWebBundleKey.SV_SORT_BY_LNAME)));</span>
<span class="nc" id="L148">		options.add(new StringsPair(SORT_BY_FNAME,</span>
<span class="nc" id="L149">				i18n(m_bundle, FsWebBundleKey.SV_SORT_BY_FNAME)));</span>
<span class="nc" id="L150">		options.add(new StringsPair(SORT_BY_START,</span>
<span class="nc" id="L151">				i18n(m_bundle, FsWebBundleKey.SV_SORT_BY_START)));</span>
<span class="nc" id="L152">		options.add(new StringsPair(SORT_BY_END,</span>
<span class="nc" id="L153">				i18n(m_bundle, FsWebBundleKey.SV_SORT_BY_END)));</span>
<span class="nc" id="L154">		options.add(new StringsPair(SORT_BY_LENGTH,</span>
<span class="nc" id="L155">				i18n(m_bundle, FsWebBundleKey.SV_SORT_BY_LENGTH)));</span>
<span class="nc" id="L156">		String sDD = HtmlUtil.makeSelectInput(FN_SORT_BY, &quot;0&quot;, new String[]{ getSortBy() }, JSUtil.ON_CHANGE, options,</span>
				null /*width*/, true, false);
<span class="nc" id="L158">		return sDD;</span>
	}//makeSortSelector
	
<span class="nc" id="L161">	private boolean initialized = false;</span>
	protected void initializeModel() {
<span class="nc bnc" id="L163" title="All 2 branches missed.">		if ( ! initialized ) {</span>
<span class="nc" id="L164">			initialized = true;</span>

<span class="nc" id="L166">			super.initializeModel();</span>
			
			try {
<span class="nc" id="L169">				setForm(m_form);</span>
				//On first load, we want to pull the values that may be stored in portlet prefs first
<span class="nc bnc" id="L171" title="All 2 branches missed.">				if (m_initialLoad) {</span>
<span class="nc" id="L172">					m_initialLoad = false;</span>
<span class="nc" id="L173">					PortletPreferences prefs = PlutoPreferencesUtil.getPortletPreferences(m_context, m_templateID, m_instanceID);</span>
<span class="nc" id="L174">					String orgIdStr = prefs.getValue(GroupMultidaySchedulePortletRH.EDIT_PARAM_ORG_ID, null);</span>
<span class="nc bnc" id="L175" title="All 2 branches missed.">					if (StringUtil.isEmpty(orgIdStr) == false) {</span>
<span class="nc" id="L176">						m_groupSelector.setOrgID(new ID(orgIdStr));</span>
					} else {

					}
					
<span class="nc" id="L181">					String campaignIdStr = prefs.getValue(GroupMultidaySchedulePortletRH.EDIT_PARAM_CAMPAIGN_ID, null);</span>
<span class="nc bnc" id="L182" title="All 2 branches missed.">					if (StringUtil.isEmpty(campaignIdStr) == false) {</span>
<span class="nc" id="L183">						m_groupSelector.setCampaignID(new ID(campaignIdStr));</span>
					}
					
<span class="nc bnc" id="L186" title="All 4 branches missed.">					if (StringUtil.isEmpty(orgIdStr) &amp;&amp; StringUtil.isEmpty(campaignIdStr)) {</span>
						//We'll set either the org the dashboard was defined at (if employee has privileges),
						//or the employee's current org as a reasonable default if the edit mode has not been configured yet.
<span class="nc" id="L189">						Organization userOrg = PlutoPreferencesUtil.getUsersDefaultOrganizationForDashboard(m_context, m_instanceID,</span>
								PrivilegeKeys.FS_VIEWORGSCHEDULES_ID);
<span class="nc bnc" id="L191" title="All 2 branches missed.">						if (userOrg != null) {</span>
<span class="nc" id="L192">							m_groupSelector.setOrgID(userOrg.getID());</span>
						}
					}

<span class="nc" id="L196">					String numDaysStr = prefs.getValue(GroupMultidaySchedulePortletRH.EDIT_PARAM_NUM_DAYS, null);</span>
<span class="nc bnc" id="L197" title="All 4 branches missed.">					if (numDaysStr != null &amp;&amp; numDaysStr.length() &gt; 0) {</span>
<span class="nc" id="L198">						setNumDays(Integer.parseInt(numDaysStr));</span>
					} else {
						//We'll set 7 days as a reasonable default if the edit mode has not been configured yet.
<span class="nc" id="L201">						setNumDays(DEFAULT_NUM_OF_DAYS);</span>
					}
					
<span class="nc" id="L204">					setSortBy(prefs.getValue(GroupMultidaySchedulePortletRH.EDIT_PARAM_SORT_BY, null));</span>
<span class="nc bnc" id="L205" title="All 4 branches missed.">					if (getSortBy() == null || getSortBy().length() == 0) {</span>
						//We'll set sort by last name as a reasonable default if the edit mode has not been configured yet.
<span class="nc" id="L207">						setSortBy(SORT_BY_LNAME);</span>
					}
				}
				
<span class="nc" id="L211">				ID orgID = m_groupSelector.getOrgID();</span>
<span class="nc" id="L212">				ID campaignID = m_groupSelector.getCampaignID();</span>

<span class="nc" id="L214">				IDStringPair orgData = new IDStringPair(null, &quot;&quot;);</span>
<span class="nc" id="L215">				IDStringPair campaignData = new IDStringPair(null, &quot;&quot;);</span>
<span class="nc bnc" id="L216" title="All 2 branches missed.">				if (orgID != null) {</span>
<span class="nc" id="L217">					String orgName = OrganizationModelHandler.getOrganizationName(m_context, orgID);</span>
<span class="nc" id="L218">					orgData = new IDStringPair(orgID, orgName);</span>
				}
<span class="nc bnc" id="L220" title="All 2 branches missed.">				if (campaignID != null) {</span>
<span class="nc" id="L221">					Campaign campaign = CampaignModelHandler.getCampaign(m_context, campaignID);</span>
<span class="nc bnc" id="L222" title="All 2 branches missed.">					if (campaign != null) {</span>
<span class="nc" id="L223">						campaignData = new IDStringPair(campaignID, campaign.getName());</span>
					}	
				}
<span class="nc" id="L226">				m_groupSelector.initGroup(orgData,campaignData);</span>
				//The list of user's available orgs and campaigns for the group selector popup are now stored
				//  in session variables.  getOrgsAndCampsForGroupScheduleView populates those variables.
<span class="nc" id="L229">				GroupSchedulePM.getOrgsAndCampsForGroupScheduleView(m_context);</span>
		
<span class="nc" id="L231">				m_form.addRow(m_localizer.i18n(FsWebBundleKey.BUNDLE_NAME, FsWebBundleKey.FS_MYSCHEDULE_GROUP), m_groupSelector);</span>
<span class="nc" id="L232">				m_numDaysPC.setInputValue(&quot;&quot; + this.m_numDays);</span>
<span class="nc" id="L233">				m_numDaysPC.setIsRequired(true);</span>
<span class="nc" id="L234">				m_numDaysPC.setInputType(FormInputPC.TYPE_INTEGER);</span>
<span class="nc" id="L235">				m_form.addRow(m_localizer.i18n(FsWebBundleKey.BUNDLE_NAME, FsWebBundleKey.NUMBER_OF_DAYS), m_numDaysPC);	</span>
<span class="nc" id="L236">				m_form.addRow(i18n(m_common_bundle, UIFWebBundleKey.SORT_BY), makeSortSelector());</span>
<span class="nc" id="L237">			} catch (Exception ex) {</span>
<span class="nc" id="L238">				handleUnableToLoadDataError(log, ex);</span>
<span class="nc" id="L239">			}</span>
		}
<span class="nc" id="L241">	}</span>

	protected void initForm() {
<span class="nc" id="L244">	}</span>

	public static PageComponent getInstance(RequestContext context) {
<span class="nc" id="L247">		return PageModel.getInstance(context, GroupMultidaySchedulePortletEditPM.class);</span>
	}
	
	/////////////
	///Getters and Setters
	/////////////
<span class="nc" id="L253">	public int getNumDays() { return m_numDays; }</span>
<span class="nc" id="L254">	public void setNumDays(int numDays) { this.m_numDays = numDays; }</span>
	
<span class="nc" id="L256">	public String getSortBy() { return m_sortBy; }</span>
<span class="nc" id="L257">	public void setSortBy(String sortBy) { m_sortBy = sortBy; }</span>
	
<span class="nc" id="L259">	public String getInstanceID() { return m_instanceID; }</span>
<span class="nc" id="L260">	public void setInstanceID(String instanceID) { m_instanceID = instanceID; }</span>

<span class="nc" id="L262">	public String getTemplateID() { return m_templateID; }</span>
<span class="nc" id="L263">	public void setTemplateID(String templateID) { m_templateID = templateID; }</span>
	
<span class="nc" id="L265">	public ID getOrgID() { return m_groupSelector.getOrgID(); }</span>
	
<span class="nc" id="L267">	public ID getCampaignID() { return m_groupSelector.getCampaignID(); }</span>
	
<span class="nc" id="L269">	public void setEditComplete(boolean editComplete) { m_editComplete = editComplete; }</span>
	
<span class="nc" id="L271">	public void setInitialLoad(boolean initialLoad) { m_initialLoad = initialLoad; }</span>

	public void setSaveErrMsgID(String msgID) {
<span class="nc" id="L274">		m_errorMessageId = msgID;	</span>
<span class="nc" id="L275">	}</span>
	
	public String getSaveErrMsgID() {
<span class="nc" id="L278">		return m_errorMessageId;	</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>