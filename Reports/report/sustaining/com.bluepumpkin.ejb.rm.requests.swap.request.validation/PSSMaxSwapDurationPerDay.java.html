<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>PSSMaxSwapDurationPerDay.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.ejb.rm.requests.swap.request.validation</a> &gt; <span class="el_source">PSSMaxSwapDurationPerDay.java</span></div><h1>PSSMaxSwapDurationPerDay.java</h1><pre class="source lang-java linenums">/*
 * Created on Oct 26, 2005
 */
package com.bluepumpkin.ejb.rm.requests.swap.request.validation;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.Calendar;
import java.util.Collection;
import java.util.Collections;
import java.util.Date;
import java.util.HashMap;
import java.util.Iterator;
import java.util.Map;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.TimeRange;
import com.bluepumpkin.common.logging.Category;
import com.bluepumpkin.ejb.bbm.activity.model.Event;
import com.bluepumpkin.ejb.bbm.effectivity.TimePeriodUtil;
import com.bluepumpkin.ejb.bbm.schedule.ejb.ScheduleAccessManager;
import com.bluepumpkin.ejb.bbm.schedule.model.ShiftAssignment;
import com.bluepumpkin.ejb.bbm.schedule.model.ShiftEventAssignment;
import com.bluepumpkin.ejb.bbm.workresource.model.Organization;
import com.bluepumpkin.ejb.rm.Log;
import com.bluepumpkin.ejb.rm.RmManagerFactory;
import com.bluepumpkin.ejb.rm.l10n.RmEjbBundleKey;
import com.bluepumpkin.ejb.rm.requests.common.ejb.RequestUtil;
import com.bluepumpkin.ejb.rm.requests.common.validation.Validatable;
import com.bluepumpkin.ejb.rm.requests.common.validation.ValidationCache;
import com.bluepumpkin.ejb.rm.requests.common.validation.ValidationResult;
import com.bluepumpkin.ejb.rm.requests.common.validation.ValidationUtil;
import com.bluepumpkin.ejb.rm.requests.common.validation.Validator;
import com.bluepumpkin.ejb.rm.requests.swap.request.model.ShiftSwapRequest;
import com.bluepumpkin.ejb.rm.requests.swap.shiftitem.model.ShiftSwapItem;
import com.bluepumpkin.ejb.rm.setup.validation.ejb.ValidationRuleManager;
import com.bluepumpkin.ejb.rm.util.DateUtil;
import com.bluepumpkin.ejb.rm.util.RmUtil;
import com.bluepumpkin.ejb.rm.util.ShiftSwapRequestUtil;

/**
 *
 * &lt;b&gt;Soft Validation: applies for both partial and full shift swap requests&lt;/b&gt;
 * &lt;p&gt;
 *    Validates that the shift hours after the swap are less than the specified value (check the receiving shifts only)
 *    The period can be specified in two ways:
 *    - Org HOO
 *    - Rolling 24 hour period (this will check that the shift duration is less than
 *    the specified amount for every time increment[15 min period] within 24 hours of the shift)
 * &lt;p&gt;
 *    Checks for both the shifts for a two way swap
 */
<span class="nc" id="L53">public class PSSMaxSwapDurationPerDay  implements Validator</span>
{
<span class="nc" id="L55">	private static final String m_className = PSSMaxSwapDurationPerDay.class.getName();</span>
<span class="nc" id="L56">	private static final Category m_cat = Log.initCategory(m_className);</span>

	public static final String MAX_SHIFT_DURATION_VALUE = &quot;MAX_SHIFT_DURATION_VALUE&quot;;
	public static final String MAX_SHIFT_DURATION_UNIT = &quot;MAX_SHIFT_DURATION_UNIT&quot;;
	public static final int MAX_SHIFT_DURATION_UNIT_24HOURS = 1;
	public static final int MAX_SHIFT_DURATION_UNIT_ORGHOO = 0;
<span class="nc" id="L62">	public static final ID RULE_ID = new ID(-194034);</span>

	/* (non-Javadoc)
	 * @see com.bluepumpkin.ejb.rm.requests.common.validation.Validator#validate(com.bluepumpkin.ejb.rm.requests.common.validation.Validatable)
	 */
	@Override
	public ValidationResult validate(Validatable validatable) throws Exception
	{

<span class="nc" id="L71">		ValidationResult result = null;</span>

<span class="nc" id="L73">		String methodName = &quot;validate&quot;;</span>
<span class="nc bnc" id="L74" title="All 2 branches missed.">		if (m_cat.isDebugEnabled()){</span>
<span class="nc" id="L75">			m_cat.debug(RmUtil.dumpEnterMethod(methodName, validatable));</span>
		}

<span class="nc" id="L78">		ShiftSwapRequest ssr = (ShiftSwapRequest) validatable;</span>
<span class="nc" id="L79">		ShiftSwapValidationCache valCache = getValidationCache(ssr);</span>
<span class="nc" id="L80">		ScheduleAccessManager sam = RequestUtil.getScheduleAccessManager();</span>

<span class="nc" id="L82">		ShiftSwapItem ssItem1 =  ssr.getShiftSwapItems().get(0);</span>
<span class="nc" id="L83">		ShiftSwapItem ssItem2 =  ssr.getShiftSwapItems().get(1);</span>

		//find the item that has the shift; make sure that the first item is always the shift
		//so that the returned shifts from getShiftsAfterSwap(ssr) method matches
<span class="nc bnc" id="L87" title="All 2 branches missed.">		if (ssItem1.getShiftType().equals(ShiftSwapItem.SWAPITEMTYPE_TIMEOFF)) {</span>
<span class="nc" id="L88">			ssItem1 =  ssr.getShiftSwapItems().get(1);</span>
<span class="nc" id="L89">			ssItem2 =  ssr.getShiftSwapItems().get(0);</span>
		}

		// map the shift swap items with the receiving shifts for the agents on the days swapped
<span class="nc" id="L93">		ShiftAssignment[] saArray = getShiftsAfterSwap(ssr);</span>
<span class="nc" id="L94">		Map&lt;ShiftSwapItem, ShiftAssignment&gt; swapItemToReceivingSAMap = new HashMap&lt;ShiftSwapItem, ShiftAssignment&gt;();</span>
<span class="nc bnc" id="L95" title="All 2 branches missed.">		swapItemToReceivingSAMap.put(ssItem1, ssItem2.getEmployeeID().equals(saArray[0].getWorkResourceID()) ? saArray[0] : saArray[1]);</span>
<span class="nc bnc" id="L96" title="All 2 branches missed.">		if (!ssItem2.getShiftType().equals(ShiftSwapItem.SWAPITEMTYPE_TIMEOFF)) {</span>
<span class="nc bnc" id="L97" title="All 2 branches missed.">			ShiftAssignment sa = ssItem1.getEmployeeID().equals(saArray[2].getWorkResourceID()) ? saArray[2] : saArray[3];</span>
			// If the swap is on same day, the resultant saArray contains duplicate records. So checking to avoid those records
<span class="nc bnc" id="L99" title="All 2 branches missed.">			if (!swapItemToReceivingSAMap.containsValue(sa)) {</span>
<span class="nc" id="L100">				swapItemToReceivingSAMap.put(ssItem2, sa);</span>
			}
		}

<span class="nc bnc" id="L104" title="All 2 branches missed.">		for (ShiftSwapItem ssItem : swapItemToReceivingSAMap.keySet()) {</span>
<span class="nc" id="L105">			ShiftAssignment receivingShift = swapItemToReceivingSAMap.get(ssItem);</span>
<span class="nc bnc" id="L106" title="All 2 branches missed.">			if (isValidShift(receivingShift)) {</span>
<span class="nc" id="L107">				ID orgID = (ID) valCache.getEmpIDToOrgIDMap().get(receivingShift.getWorkResourceID());</span>
<span class="nc bnc" id="L108" title="All 2 branches missed.">				if (valCache.isValidationRequiredForOrg(orgID, &quot;shift-swap&quot;, m_className)) {</span>
					//get the rule params
<span class="nc" id="L110">					ValidationRuleManager valMan = RmManagerFactory.getInstance().getValidationRuleManager();</span>
<span class="nc" id="L111">					Map&lt;String, Integer&gt; ruleParams = valMan.getValidationRuleParams(orgID, RULE_ID);</span>
<span class="nc" id="L112">					int maxDuration = ruleParams.get(MAX_SHIFT_DURATION_VALUE);</span>
<span class="nc" id="L113">					int unit = ruleParams.get(MAX_SHIFT_DURATION_UNIT).intValue();</span>

					//validate based on day type
<span class="nc bnc" id="L116" title="All 2 branches missed.">					if (unit == MAX_SHIFT_DURATION_UNIT_ORGHOO){</span>
<span class="nc" id="L117">						result = verifyOrgDayShiftDurationForItem(ssItem, maxDuration, sam, ssr, receivingShift);</span>
					} else {
<span class="nc" id="L119">						result = verify24HourShiftDurationForItem(ssItem, maxDuration, sam, ssr, receivingShift);</span>
					}
				}
			}
<span class="nc" id="L123">		}</span>
<span class="nc bnc" id="L124" title="All 2 branches missed.">		if (m_cat.isDebugEnabled()) {</span>
<span class="nc" id="L125">			m_cat.debug(RmUtil.dumpExitMethod(methodName));</span>
		}

<span class="nc" id="L128">		return result;</span>
	}

	

	protected ShiftAssignment[] getShiftsAfterSwap(ShiftSwapRequest ssr) throws Exception {
<span class="nc" id="L134">		return ShiftSwapRequestUtil.getShiftsAfterSwap(ssr, ssr.isTentative());</span>
	}

	private boolean isValidShift(ShiftAssignment shift) throws Exception {
<span class="nc bnc" id="L138" title="All 4 branches missed.">		return shift != null &amp;&amp; !ValidationCache.getAllGaps(shift, Collections.emptyList()).equals(Arrays.asList(</span>
<span class="nc" id="L139">				new TimeRange(shift.getStartTime(), shift.getEndTime())));</span>
	}

	protected ShiftSwapValidationCache getValidationCache(ShiftSwapRequest ssr) {
<span class="nc" id="L143">		return (ShiftSwapValidationCache) ssr.getValidationCache();</span>
	}


	private ValidationResult verifyOrgDayShiftDurationForItem(ShiftSwapItem ssItem, int maxDuration,
			ScheduleAccessManager sam, ShiftSwapRequest ssr, ShiftAssignment receivingShift) throws Exception{
<span class="nc" id="L149">		ValidationResult result = null;</span>

		//    	get calendar for employee's org
<span class="nc" id="L152">		ShiftSwapValidationCache cache = getValidationCache(ssr);</span>
<span class="nc" id="L153">		Organization org = cache.getOrganizationForEmployeeDuringPeriod(receivingShift.getWorkResourceID(),</span>
<span class="nc" id="L154">				ssItem.getStartDate(), ssItem.getEndDate());</span>
<span class="nc" id="L155">		Calendar startCal = Calendar.getInstance(org.getTimeZone());</span>
<span class="nc" id="L156">		startCal.setTime(ssItem.getStartDate());</span>
<span class="nc" id="L157">		startCal.set(Calendar.HOUR_OF_DAY, 0);</span>
<span class="nc" id="L158">		startCal.set(Calendar.MINUTE, 0);</span>
<span class="nc" id="L159">		startCal.set(Calendar.SECOND, 0);</span>
<span class="nc" id="L160">		startCal.add(Calendar.MINUTE, org.getDayBoundaryOffset());</span>

<span class="nc" id="L162">		Calendar endCal = Calendar.getInstance(org.getTimeZone());</span>
<span class="nc" id="L163">		endCal.setTime(startCal.getTime());</span>
<span class="nc" id="L164">		endCal.add(Calendar.HOUR, 24);</span>

		//get all shifts for the agent on the day of the item
<span class="nc" id="L167">		Collection origSaColl = sam.getPublishedEventsForWorkResourceByType(Event.EVENT_TYPE_SHIFT_ASSIGNMENT,</span>
<span class="nc" id="L168">				receivingShift.getWorkResourceID(), startCal.getTime(), endCal.getTime());</span>

		//defualt duration
<span class="nc" id="L171">		int shiftDuration = 0;</span>
<span class="nc" id="L172">		Collection saColl = getCollWithoutShiftStartingOnDay(origSaColl, startCal.getTime(), endCal.getTime());</span>

		//now add the newly created shift if valid
<span class="nc bnc" id="L175" title="All 2 branches missed.">		if (receivingShift != null){</span>
<span class="nc" id="L176">			saColl.add(receivingShift);</span>
		}

		//itearte through the collection
<span class="nc bnc" id="L180" title="All 2 branches missed.">		for (Iterator it = saColl.iterator(); it.hasNext();){</span>
<span class="nc" id="L181">			ShiftAssignment sAssgn = (ShiftAssignment)it.next();</span>
<span class="nc bnc" id="L182" title="All 2 branches missed.">			if (TimePeriodUtil.overlap(sAssgn.getStartTime(), sAssgn.getEndTime(),</span>
<span class="nc" id="L183">					startCal.getTime(), endCal.getTime())){</span>
				//found shift within org day, will append item to this if not completely within sa
<span class="nc" id="L185">				shiftDuration += getPaidDurationForSegment(sAssgn, startCal.getTime(), endCal.getTime());</span>
			}
<span class="nc" id="L187">		}</span>
<span class="nc bnc" id="L188" title="All 2 branches missed.">		if (shiftDuration &gt; maxDuration){</span>
<span class="nc" id="L189">			result = ValidationUtil.setSoftValidationResult(ssr,</span>
					RmEjbBundleKey.PSS_SHIFT_MAX_DURATION_ORG_DAY,
<span class="nc" id="L191">					String.valueOf(shiftDuration),</span>
<span class="nc" id="L192">					String.valueOf(maxDuration),</span>
<span class="nc" id="L193">					ssItem.getStartDate(),</span>
<span class="nc" id="L194">					cache.getEmployeeNameByID(receivingShift.getWorkResourceID()),</span>
					m_className);
		}
<span class="nc" id="L197">		return result;</span>
	}

	private Collection getCollWithoutShiftStartingOnDay(Collection saColl, Date start, Date end){
<span class="nc" id="L201">		Collection col = new ArrayList();</span>
		//    	iterate through the collection
<span class="nc bnc" id="L203" title="All 2 branches missed.">		for (Iterator it = saColl.iterator(); it.hasNext();){</span>
<span class="nc" id="L204">			ShiftAssignment sAssgn = (ShiftAssignment)it.next();</span>
<span class="nc bnc" id="L205" title="All 2 branches missed.">			if(!DateUtil.isInRange(start, end, sAssgn.getStartTime())){</span>
<span class="nc" id="L206">				col.add(sAssgn);</span>
			}

<span class="nc" id="L209">		}</span>
<span class="nc" id="L210">		return col;</span>
	}



	private ValidationResult verify24HourShiftDurationForItem(ShiftSwapItem ssItem, int maxDuration,
			ScheduleAccessManager sam, ShiftSwapRequest ssr, ShiftAssignment receivingShift) throws Exception{
<span class="nc" id="L217">		ValidationResult result = null;</span>

		//    	get calendar for employee's org
<span class="nc" id="L220">		ShiftSwapValidationCache cache = getValidationCache(ssr);</span>
<span class="nc" id="L221">		Organization org = cache.getOrganizationForEmployeeDuringPeriod(receivingShift.getWorkResourceID(),</span>
<span class="nc" id="L222">				ssItem.getStartDate(), ssItem.getEndDate());</span>
<span class="nc" id="L223">		Calendar startCal = Calendar.getInstance(org.getTimeZone());</span>
<span class="nc" id="L224">		startCal.setTime(ssItem.getStartDate());</span>
<span class="nc" id="L225">		startCal.set(Calendar.HOUR_OF_DAY, 0);</span>
<span class="nc" id="L226">		startCal.set(Calendar.MINUTE, 0);</span>
<span class="nc" id="L227">		startCal.set(Calendar.SECOND, 0);</span>
<span class="nc" id="L228">		Date orgDayStart = startCal.getTime();</span>
<span class="nc" id="L229">		Calendar orgDayEnd = Calendar.getInstance(org.getTimeZone());</span>
<span class="nc" id="L230">		orgDayEnd.setTime(orgDayStart);</span>

<span class="nc" id="L232">		orgDayEnd.add(Calendar.HOUR, 24);</span>
<span class="nc" id="L233">		startCal.add(Calendar.HOUR, -24);</span>
<span class="nc" id="L234">		Calendar endCal = Calendar.getInstance(org.getTimeZone());</span>
<span class="nc" id="L235">		endCal.setTime(ssItem.getEndDate());</span>
<span class="nc" id="L236">		endCal.add(Calendar.HOUR, 24);</span>

		//get all shifts for the agent on the day of the item
<span class="nc" id="L239">		Collection origSaColl = sam.getPublishedEventsForWorkResourceByType(Event.EVENT_TYPE_SHIFT_ASSIGNMENT, receivingShift.getWorkResourceID(),</span>
<span class="nc" id="L240">				startCal.getTime(), endCal.getTime());</span>

<span class="nc" id="L242">		startCal.setTime(getPeriodStartDate(origSaColl, ssItem));</span>
		//now subtract 24
<span class="nc" id="L244">		startCal.add(Calendar.HOUR, -24);</span>
<span class="nc" id="L245">		Calendar iterCal = Calendar.getInstance(org.getTimeZone());</span>
<span class="nc" id="L246">		iterCal.setTime(startCal.getTime());</span>
<span class="nc" id="L247">		iterCal.add(Calendar.HOUR, 24);</span>
<span class="nc" id="L248">		Date endPeriod = getPeriodEndDate(origSaColl, ssItem);</span>

		// Default duration
<span class="nc" id="L251">		Collection saColl = getCollWithoutShiftStartingOnDay(origSaColl, orgDayStart, orgDayEnd.getTime());</span>

		//now add the newly created shift if valid
<span class="nc bnc" id="L254" title="All 2 branches missed.">		if (receivingShift != null){</span>
<span class="nc" id="L255">			saColl.add(receivingShift);</span>
		}
		//itearte through the time period for each 15 minute interval
<span class="nc bnc" id="L258" title="All 2 branches missed.">		while (startCal.getTime().before(endPeriod)){</span>
			// Default duration
<span class="nc" id="L260">			int shiftDuration = 0;</span>

			// iterate through the collection
<span class="nc bnc" id="L263" title="All 2 branches missed.">			for (Iterator it = saColl.iterator(); it.hasNext();){</span>
<span class="nc" id="L264">				ShiftAssignment sAssgn = (ShiftAssignment)it.next();</span>
<span class="nc" id="L265">				shiftDuration += getPaidDurationForSegment(sAssgn, startCal.getTime(), iterCal.getTime());</span>
<span class="nc" id="L266">			}</span>

<span class="nc bnc" id="L268" title="All 2 branches missed.">			if (shiftDuration &gt; maxDuration){</span>
<span class="nc" id="L269">				return ValidationUtil.setSoftValidationResult(ssr,</span>
						RmEjbBundleKey.PSS_SHIFT_MAX_DURATION,
<span class="nc" id="L271">						String.valueOf(maxDuration),</span>
<span class="nc" id="L272">						cache.getEmployeeNameByID(receivingShift.getWorkResourceID()),</span>
						m_className);
			}
<span class="nc" id="L275">			startCal.add(Calendar.MINUTE, 15);</span>
<span class="nc" id="L276">			iterCal.add(Calendar.MINUTE, 15);</span>
<span class="nc" id="L277">			shiftDuration = 0;</span>
<span class="nc" id="L278">		}</span>
<span class="nc" id="L279">		return result;</span>
	}

	private Date getPeriodEndDate(Collection saColl, ShiftSwapItem ssItem){
<span class="nc bnc" id="L283" title="All 2 branches missed.">		for (Iterator it = saColl.iterator(); it.hasNext();){</span>
<span class="nc" id="L284">			ShiftAssignment sAssgn = (ShiftAssignment)it.next();</span>
<span class="nc bnc" id="L285" title="All 2 branches missed.">			if (sAssgn.getStartTime().after(ssItem.getStartDate()) &amp;&amp;</span>
<span class="nc bnc" id="L286" title="All 2 branches missed.">					sAssgn.getStartTime().before(ssItem.getEndDate())){</span>
<span class="nc" id="L287">				return sAssgn.getEndTime();</span>
			}
<span class="nc" id="L289">		}</span>
<span class="nc" id="L290">		return ssItem.getEndDate();</span>
	}

	private Date getPeriodStartDate(Collection saColl, ShiftSwapItem ssItem){
<span class="nc bnc" id="L294" title="All 2 branches missed.">		for (Iterator it = saColl.iterator(); it.hasNext();){</span>
<span class="nc" id="L295">			ShiftAssignment sAssgn = (ShiftAssignment)it.next();</span>
<span class="nc bnc" id="L296" title="All 2 branches missed.">			if (sAssgn.getEndTime().after(ssItem.getStartDate()) &amp;&amp;</span>
<span class="nc bnc" id="L297" title="All 2 branches missed.">					sAssgn.getEndTime().before(ssItem.getEndDate())){</span>
<span class="nc" id="L298">				return sAssgn.getStartTime();</span>
			}
<span class="nc" id="L300">		}</span>
<span class="nc" id="L301">		return ssItem.getStartDate();</span>
	}

	private int getPaidDurationForSegment(ShiftAssignment sa, Date startPeriod, Date endPeriod){
<span class="nc" id="L305">		int paidDuration = 0;</span>

<span class="nc bnc" id="L307" title="All 2 branches missed.">		if (TimePeriodUtil.inside(sa.getStartTime(), sa.getEndTime(),</span>
				startPeriod, endPeriod)){//event completely within period
<span class="nc" id="L309">			paidDuration = sa.getDuration();</span>
<span class="nc bnc" id="L310" title="All 2 branches missed.">		} else if (sa.getStartTime().before(startPeriod)</span>
<span class="nc bnc" id="L311" title="All 2 branches missed.">				&amp;&amp; sa.getEndTime().after(endPeriod)){</span>
<span class="nc" id="L312">			paidDuration = (int)(endPeriod.getTime() - startPeriod.getTime())/(1000*60);</span>
<span class="nc bnc" id="L313" title="All 2 branches missed.">		} else if (sa.getStartTime().after(startPeriod)</span>
<span class="nc bnc" id="L314" title="All 4 branches missed.">				&amp;&amp; sa.getStartTime().before(endPeriod) &amp;&amp; sa.getEndTime().after(endPeriod)){</span>
<span class="nc" id="L315">			paidDuration = (int)(endPeriod.getTime() - sa.getStartTime().getTime())/(1000*60);</span>
<span class="nc bnc" id="L316" title="All 2 branches missed.">		} else if (sa.getEndTime().after(startPeriod)</span>
<span class="nc bnc" id="L317" title="All 4 branches missed.">				&amp;&amp; sa.getEndTime().before(endPeriod) &amp;&amp; sa.getStartTime().before(startPeriod)){</span>
<span class="nc" id="L318">			paidDuration = (int)(sa.getEndTime().getTime() - startPeriod.getTime())/(1000*60);</span>
		}

		//iterate through all the shift events
<span class="nc bnc" id="L322" title="All 2 branches missed.">		for (Iterator itr = sa.getChildren().iterator(); itr.hasNext(); ) {</span>
<span class="nc" id="L323">			ShiftEventAssignment shiftEventAssn = (ShiftEventAssignment) itr.next();</span>

			//if overlaps with period, and paid: add to duration
<span class="nc bnc" id="L326" title="All 2 branches missed.">			if (TimePeriodUtil.overlap(startPeriod, endPeriod, shiftEventAssn.getStartTime(), shiftEventAssn.getEndTime())){</span>
<span class="nc bnc" id="L327" title="All 2 branches missed.">				if (!shiftEventAssn.getPaid()){</span>
					//get exact period that overlaps
<span class="nc bnc" id="L329" title="All 2 branches missed.">					if (TimePeriodUtil.inside(shiftEventAssn.getStartTime(), shiftEventAssn.getEndTime(),</span>
							startPeriod, endPeriod)){//event completely within period
<span class="nc" id="L331">						paidDuration -= shiftEventAssn.getDuration();</span>
<span class="nc bnc" id="L332" title="All 2 branches missed.">					} else if (shiftEventAssn.getStartTime().before(startPeriod)</span>
<span class="nc bnc" id="L333" title="All 2 branches missed.">							&amp;&amp; shiftEventAssn.getEndTime().after(endPeriod)){</span>
<span class="nc" id="L334">						paidDuration -= (int)(endPeriod.getTime() - startPeriod.getTime())/(1000*60);</span>
<span class="nc bnc" id="L335" title="All 2 branches missed.">					} else if (shiftEventAssn.getStartTime().after(startPeriod)</span>
<span class="nc bnc" id="L336" title="All 4 branches missed.">							&amp;&amp; shiftEventAssn.getStartTime().before(endPeriod) &amp;&amp; shiftEventAssn.getEndTime().after(endPeriod)){</span>
<span class="nc" id="L337">						paidDuration -= (int)(endPeriod.getTime() - shiftEventAssn.getStartTime().getTime())/(1000*60);</span>
<span class="nc bnc" id="L338" title="All 2 branches missed.">					} else if (shiftEventAssn.getEndTime().after(startPeriod)</span>
<span class="nc bnc" id="L339" title="All 4 branches missed.">							&amp;&amp; shiftEventAssn.getEndTime().before(endPeriod) &amp;&amp; shiftEventAssn.getStartTime().before(startPeriod)){</span>
<span class="nc" id="L340">						paidDuration -= (int)(shiftEventAssn.getEndTime().getTime() - startPeriod.getTime())/(1000*60);</span>
					}
				}
			}
<span class="nc" id="L344">		}</span>
<span class="nc" id="L345">		return paidDuration;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>