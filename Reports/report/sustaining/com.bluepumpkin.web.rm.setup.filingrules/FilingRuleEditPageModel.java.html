<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>FilingRuleEditPageModel.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.rm.setup.filingrules</a> &gt; <span class="el_source">FilingRuleEditPageModel.java</span></div><h1>FilingRuleEditPageModel.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.rm.setup.filingrules;

import java.util.ArrayList;
import java.util.Collection;
import java.util.Date;
import java.util.ResourceBundle;

import javax.servlet.http.HttpServletRequest;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.StringsPair;
import com.bluepumpkin.common.logging.Category;
import com.bluepumpkin.ejb.rm.l10n.RmEjbBundleKey;
import com.bluepumpkin.ejb.rm.requests.common.ejb.RequestUtil;
import com.bluepumpkin.ejb.rm.requests.common.model.Request;
import com.bluepumpkin.ejb.rm.setup.filingrules.model.RequestFilingRule;
import com.bluepumpkin.web.bbm.organization.OrgWorkpaneFormPageModel;
import com.bluepumpkin.web.rm.Log;
import com.bluepumpkin.web.rm.l10n.RmWebBundleKey;
import com.bluepumpkin.web.rm.l10n.RmWebLogBundleKey;
import com.bluepumpkin.web.rm.setup.RmSetupUtil;
import com.witness.web.uif.keys.JavaScriptFileID;
import com.witness.web.uif.keys.PageAction;
import com.witness.web.uif.pagecomponent.toolbar.ToolbarUtil;
import com.witness.web.uif.pagemodel.WorkpanePageModel;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.validator.IsNonNegativeIntegerFieldValidator;

/**
 * Title          FilingRuleEditPageModel
 * Description    Used to display the Create/Edit filing Rule page
 * Copyright      Copyright (c) 2002
 * Company        Blue Pumpkin Software, Inc
 * @author        Shubhangi Chavan
 * @version       1.0
 */
public class FilingRuleEditPageModel extends OrgWorkpaneFormPageModel {
<span class="nc" id="L38">	private static final Category log =</span>
<span class="nc" id="L39">		Log.initCategory(FilingRuleEditPageModel.class.getName());</span>

	private static final String NEW_TIMEOFF   = &quot;NEW_TIME_OFF&quot;;
	private static final String NEW_TIMEOFF_WITHDRAW = &quot;NEW_TIMEOFF_WITHDRAW&quot;;
	private static final String NEW_SHIFTSWAP_WITHDRAW = &quot;NEW_SHIFTSWAP_WITHDRAW&quot;;
	private static final String NEW_SHIFTSWAP = &quot;NEW_SHIFT_SWAP&quot;;
	private static final String NEW_SHIFTBID  = &quot;NEW_SHIFT_BID&quot;;
	private static final String NEW_CUSTOMSHIFT  = &quot;NEW_CUSTOM_SHIFT&quot;;
	private static final String NEW_FLEXTIME  = &quot;NEW_FLEX_TIME&quot;;
	private static final String INTERVAL_COUNT_FN     = FilingRulePC.INTERVAL_COUNT_FN;
	private static final int MINUTES_IN_DAY = 1440;

	private ResourceBundle m_rmBundle;
	private ResourceBundle rmEjbBundle;
	private RequestFilingRule m_filingRule;
	private FilingRulePC m_filingRulePC;
	private Collection m_timeOffTypeList;
	private Collection m_dayTypeList;
	private Collection m_dateComparisonList;
	private Collection m_intervalTypeList;
	private Collection m_intervalUnitList;
	private Collection&lt;StringsPair&gt; flexBeforeAfterList;

	/**
	 * Constructor
	 */
	public FilingRuleEditPageModel(RequestContext context) {
<span class="nc" id="L66">		super(context);</span>
<span class="nc" id="L67">		m_rmBundle = m_localizer.getBundle(RmWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L68">		rmEjbBundle = m_localizer.getBundle(RmEjbBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L69">		extractParameters(context.getRequest(), WorkpanePageModel.SELECTED_ID_FN);</span>

		// Component specific required JavaScript Files
<span class="nc" id="L72">		addRequiredJavaScriptFile(JavaScriptFileID.MEDIATOR_WORKPANE);</span>
<span class="nc" id="L73">		addRequiredJavaScriptFile(JavaScriptFileID.DIALOG_PICKERS);</span>
<span class="nc" id="L74">		setJSMediator(JavaScriptFileID.MEDIATOR_WORKPANE_GENERIC);</span>

<span class="nc" id="L76">		m_dayTypeList = RequestUtil.getDayTypeList(m_rmBundle, m_localizer);</span>
<span class="nc" id="L77">		m_dateComparisonList = RequestUtil.getDateComparisonList(m_localizer);</span>
<span class="nc" id="L78">		m_intervalTypeList = RequestUtil.getIntervalTypeList(m_localizer);</span>
<span class="nc" id="L79">		flexBeforeAfterList = FilingRuleModelHandler.getFlexBeforeAfterList(rmEjbBundle, m_localizer);</span>
<span class="nc" id="L80">		m_filingRule = new RequestFilingRule();</span>
<span class="nc" id="L81">		m_filingRulePC = new FilingRulePC(m_context, m_filingRule, RmSetupUtil.getOrgTimeZone(m_context, this.getSelectedIDObject()));</span>
<span class="nc" id="L82">		addChildComponent(m_filingRulePC);</span>
<span class="nc" id="L83">		addValidator(new IsNonNegativeIntegerFieldValidator(this,</span>
				INTERVAL_COUNT_FN,
				RmWebBundleKey.REQUEST_LABEL_INTERVAL_COUNT,
				RmWebBundleKey.BUNDLE_NAME));
<span class="nc" id="L87">	}</span>

	/**
	 * Initialize the request type when creating a new filing rule (as opposed to editing an existing filing rule).
	 */
	private void initRequestTypeForNewRuleCreation(RequestContext context) {
<span class="nc" id="L93">		String createRuleType = (String)context.getAttribute(RequestContext.REQUEST_SCOPE, &quot;createRuleType&quot;);</span>
<span class="nc bnc" id="L94" title="All 2 branches missed.">		if (createRuleType != null) {</span>
<span class="nc" id="L95">			m_filingRule.setRequestType(createRuleType);</span>

<span class="nc bnc" id="L97" title="All 2 branches missed.">			if (createRuleType.equals(Request.REQUESTTYPE_FLEXTIME)) {</span>
				//set default interval count for flex time requests
<span class="nc" id="L99">				m_filingRule.setIntervalDays(MINUTES_IN_DAY);</span>
			}
		}
		else {
<span class="nc" id="L103">			m_filingRule.setRequestType(Request.REQUESTTYPE_TIMEOFF);</span>
		}

<span class="nc" id="L106">	}</span>

	/**
	 * These initializations require the requestType to have been set.
	 * @param context RequestContext
	 */
	private void initializeSettingsThatDependOnRequestType(RequestContext context) {
<span class="nc" id="L113">		initIntervalUnitList();</span>
<span class="nc" id="L114">		initTimeOffTypeList();</span>
<span class="nc" id="L115">		initForm();</span>
<span class="nc" id="L116">	}</span>

	/**
	 * Initialize the filing rule's m_intervalUnitList member.
	 */
	private void initIntervalUnitList() {
<span class="nc" id="L122">		boolean includeMinutes = m_filingRule.getRequestType().equals(Request.REQUESTTYPE_FLEXTIME);</span>
<span class="nc" id="L123">		m_intervalUnitList = FilingRuleModelHandler.getIntervalUnitList(m_localizer, includeMinutes);</span>
<span class="nc" id="L124">	}</span>

	/**
	 * Get the time off types, filtered by isFlex or not.
	 */
	private void initTimeOffTypeList() {
		try {
<span class="nc bnc" id="L131" title="All 2 branches missed.">			if (getSelectedIDObject() != null) {</span>
<span class="nc" id="L132">				boolean isFlex = m_filingRule.getRequestType().equals(Request.REQUESTTYPE_FLEXTIME);</span>
<span class="nc" id="L133">				m_timeOffTypeList = FilingRuleModelHandler.getTimeOffTypes(</span>
<span class="nc" id="L134">					getSelectedIDObject(), isFlex);</span>
			}
		}
<span class="nc" id="L137">		catch (Exception e) {</span>
<span class="nc" id="L138">			log.l7dError(RmWebLogBundleKey.UNABLE_TO_LOAD_DATA, e);</span>
<span class="nc" id="L139">		}</span>

<span class="nc bnc" id="L141" title="All 2 branches missed.">		if (m_timeOffTypeList == null) {</span>
<span class="nc" id="L142">			m_timeOffTypeList = new ArrayList();</span>
		}
<span class="nc" id="L144">	}</span>

	/**
	 * Return an instance of FilingRuleEditPageModel ready to be rendered in JSP
	 * @param   context RequestContext
	 * @return  FilingRuleEditPageModel  instance of FilingRuleEditPageModel
	 */
	public static FilingRuleEditPageModel getInstance(RequestContext context) {
<span class="nc" id="L152">		return (FilingRuleEditPageModel)getInstance(context, FilingRuleEditPageModel.class);</span>
	}

	/**
	 * Initialize Form Display
	 */
	@Override
	protected void initForm() {
		//invoke the methods that create the PC
<span class="nc" id="L161">		m_filingRulePC.setPageType(getCreateRuleType());</span>
<span class="nc" id="L162">		m_filingRulePC.setRequestFilingRule(m_filingRule);</span>
<span class="nc" id="L163">		m_filingRulePC.setDayTypeList(m_dayTypeList);</span>
<span class="nc" id="L164">		m_filingRulePC.setComparisonTypeList(m_dateComparisonList);</span>
<span class="nc" id="L165">		m_filingRulePC.setIntervalTypeList(m_intervalTypeList);</span>
<span class="nc" id="L166">		m_filingRulePC.setIntervalUnitList(m_intervalUnitList);</span>
<span class="nc" id="L167">		m_filingRulePC.setTimeOffTypeList(m_timeOffTypeList);</span>
<span class="nc" id="L168">		m_filingRulePC.setFlexBeforeAfterList(flexBeforeAfterList);</span>

<span class="nc" id="L170">	}</span>

	/**
	 * Create Form Model
	 */
	@Override
	protected void createFormModel() {
		try {
<span class="nc bnc" id="L178" title="All 4 branches missed.">			if (getRuleID()!=null &amp;&amp; !hasError()) {</span>
				//we are editing an existing filing rule. Read it from the DB.
<span class="nc" id="L180">				m_filingRule = FilingRuleModelHandler.getFilingRule(getRuleID());</span>

			} else {
<span class="nc" id="L183">				initRequestTypeForNewRuleCreation(m_context);</span>
			}


<span class="nc" id="L187">			initializeSettingsThatDependOnRequestType(m_context);</span>
<span class="nc" id="L188">		} catch (Exception ex) {</span>
<span class="nc" id="L189">			handleUnableToLoadDataError(log, ex);</span>
<span class="nc" id="L190">		}</span>
<span class="nc" id="L191">	}</span>

	/**
	 * Initialize the Toolbar
	 * Adds the Save, Cancel and Revert button
	 */
	@Override
	protected void initToolbar() {
<span class="nc" id="L199">		m_toolbar.setName(getName() + &quot;_toolbar&quot;);</span>
<span class="nc" id="L200">		ToolbarUtil.addValidateSaveBtn(m_toolbar, true);</span>
<span class="nc" id="L201">		ToolbarUtil.addConfirmDoneBtn(m_toolbar, true);</span>
<span class="nc" id="L202">		ToolbarUtil.addResetBtn(m_toolbar, true);</span>
<span class="nc" id="L203">	}</span>

	/**
	 * Return the form title
	 * @return String Identifies the form title
	 */
		@Override
	public String getFormTitle() {

		String strType;
<span class="nc bnc" id="L213" title="All 2 branches missed.">		if(getCreateRuleType().equals(Request.REQUESTTYPE_TIMEOFF)) {</span>
<span class="nc" id="L214">			strType = i18n(m_rmBundle,RmWebBundleKey.REQUEST_TYPE_TIME_OFF);</span>
<span class="nc bnc" id="L215" title="All 2 branches missed.">		} else if(getCreateRuleType().equals(Request.REQUESTTYPE_SHIFTSWAP)) {</span>
<span class="nc" id="L216">			strType = i18n(m_rmBundle,RmWebBundleKey.REQUEST_TYPE_SHIFT_SWAP);</span>
<span class="nc bnc" id="L217" title="All 2 branches missed.">		} else if(getCreateRuleType().equals(Request.REQUESTTYPE_SHIFTSWAP_WITHDRAW)) {</span>
<span class="nc" id="L218">			strType = i18n(m_rmBundle,RmWebBundleKey.REQUEST_TYPE_SHIFT_SWAP_WITHDRAW);</span>
<span class="nc bnc" id="L219" title="All 2 branches missed.">		}else if(getCreateRuleType().equals(Request.REQUESTTYPE_SHIFTBID)) {</span>
<span class="nc" id="L220">			strType = i18n(m_rmBundle,RmWebBundleKey.REQUEST_TYPE_SHIFT_BIDDING);</span>
<span class="nc bnc" id="L221" title="All 2 branches missed.">		} else if(getCreateRuleType().equals(Request.REQUESTTYPE_CUSTSHIFT)) {</span>
<span class="nc" id="L222">			strType = i18n(m_rmBundle,RmWebBundleKey.REQUEST_TYPE_CUSTOM_SHIFT);</span>
<span class="nc bnc" id="L223" title="All 2 branches missed.">		} else if(getCreateRuleType().equals(Request.REQUESTTYPE_FLEXTIME)) {</span>
<span class="nc" id="L224">			strType = i18n(m_rmBundle,RmWebBundleKey.REQUEST_TYPE_FLEX_TIME);</span>
		} else {
<span class="nc" id="L226">			strType = i18n(m_rmBundle,RmWebBundleKey.REQUEST_TYPE_TIME_OFF_WITHDRAW);</span>
		}
<span class="nc" id="L228">		Object[] args = new Object[] {strType};</span>

<span class="nc bnc" id="L230" title="All 2 branches missed.">		if (isNew()) {</span>
<span class="nc" id="L231">			return m_localizer.i18n(m_rmBundle,RmWebBundleKey.ORG_RM_CREATE_RULE_TEMPLATE,args);</span>
		} else {
<span class="nc" id="L233">			return m_localizer.i18n(m_rmBundle,RmWebBundleKey.ORG_RM_EDIT_RULE_TEMPLATE,args);</span>
		}
	}

	/**
	 * Gets entity name. Used for title.
	 * @return String Identifies the title entity
	 */
	@Override
	protected String getTitleEntityType() {
<span class="nc" id="L243">		return i18n(m_rmBundle, RmWebBundleKey.ORG_RM_FILING_RULE_LABEL);</span>
	}

	/**
	 * Returns an entity name. Used for title.
	 * @return String Identifies the entity name
	 */
	@Override
	protected String getEntityName() {
<span class="nc" id="L252">		return &quot;&quot;;</span>
	}

	/**
	 * Return URL for HTML Form Action
	 * @return 	String	Identifies the URL
	 */
	@Override
	public String getFormAction() {
<span class="nc" id="L261">		return &quot;request_processing_filingrulelist&quot;;</span>
	}

	/**
	 * @return ID	Identifies the Filing Rule ID
	 */
	public ID getRuleID() {
<span class="nc bnc" id="L268" title="All 2 branches missed.">		if (isAction(m_context, NEW_TIMEOFF) ||</span>
<span class="nc bnc" id="L269" title="All 2 branches missed.">			isAction(m_context, NEW_TIMEOFF_WITHDRAW) ||</span>
<span class="nc bnc" id="L270" title="All 2 branches missed.">			isAction(m_context, NEW_SHIFTBID) ||</span>
<span class="nc bnc" id="L271" title="All 2 branches missed.">			isAction(m_context, NEW_SHIFTSWAP) ||</span>
<span class="nc bnc" id="L272" title="All 2 branches missed.">			isAction(m_context, NEW_SHIFTSWAP_WITHDRAW) ||</span>
<span class="nc bnc" id="L273" title="All 2 branches missed.">			isAction(m_context, NEW_CUSTOMSHIFT) ||</span>
<span class="nc bnc" id="L274" title="All 2 branches missed.">			isAction(m_context, NEW_FLEXTIME)) {</span>
<span class="nc" id="L275">			setPerformActionOnID(null);</span>
<span class="nc" id="L276">			return null;</span>
		}
<span class="nc bnc" id="L278" title="All 2 branches missed.">		if (m_performActionOnIDs==null) {</span>
<span class="nc" id="L279">			return null;</span>
		}
<span class="nc" id="L281">		return m_performActionOnIDs[getEditIndex()];</span>
	}

    /**
     * Return true if request action is the same the specified action
     */
	public boolean isAction(RequestContext context, String action){
<span class="nc" id="L288">		String pageAction = getPageAction(context);</span>
<span class="nc bnc" id="L289" title="All 4 branches missed.">		if (pageAction==null || action==null) {</span>
<span class="nc" id="L290">			return false;</span>
		}

<span class="nc" id="L293">		return pageAction.equals(action);</span>
	}

	/**
	 * Return Page Action passed to Request Handler
	 */
	public String getPageAction(RequestContext context) {
<span class="nc" id="L300">	  return context.getRequest().getParameter(PageAction.PAGE_ACTION);</span>
	}
	/**
	 * Displays the page Header
	 * @return Identifies the page Header
	 */
	public String getHeaderText() {
<span class="nc" id="L307">		return getFormTitle();</span>
	}

	/**
	 * set and get Methods
	 */
	public void setCreateRuleType(String requestType) {
<span class="nc" id="L314">		m_filingRule.setRequestType(requestType);</span>
<span class="nc" id="L315">	}</span>

	public String getCreateRuleType() {
<span class="nc" id="L318">		return m_filingRule.getRequestType();</span>
	}

	public FilingRulePC getFilingRuleForm() {
<span class="nc" id="L322">		return m_filingRulePC;</span>
	}

	public RequestFilingRule getFilingRule() {
<span class="nc" id="L326">		return m_filingRule;</span>
	}

	public void setDateRangeStart(Date startDate) {
<span class="nc" id="L330">		m_filingRule.setStartDate(startDate);</span>
<span class="nc" id="L331">	}</span>

	public void setDateRangeEnd(Date endDate) {
<span class="nc" id="L334">		m_filingRule.setEndDate(endDate);</span>
<span class="nc" id="L335">	}</span>

	public void setDate(Date date) {
<span class="nc" id="L338">		m_filingRule.setFileByDate(date);</span>
<span class="nc" id="L339">	}</span>

	public Date getDate() {
<span class="nc" id="L342">		return m_filingRule.getFileByDate();</span>
	}

	public void setIntervalCount(int intervalInHours){
<span class="nc" id="L346">		m_filingRule.setIntervalDays(intervalInHours);	//@TODO rename setter to reflect hrs</span>
<span class="nc" id="L347">	}</span>

	@Override
	public boolean extractParameters(HttpServletRequest request) {
<span class="nc" id="L351">		boolean success=super.extractParameters(request);</span>

<span class="nc bnc" id="L353" title="All 2 branches missed.">		if (m_filingRulePC != null) {</span>
<span class="nc" id="L354">			setDate(m_filingRulePC.getExtractedDate());</span>
<span class="nc" id="L355">			setDateRangeStart(m_filingRulePC.getExtractedDateRangeStart());</span>
<span class="nc" id="L356">			setDateRangeEnd(m_filingRulePC.getExtractedDateRangeEnd());</span>
<span class="nc" id="L357">			setIntervalCount(m_filingRulePC.getExtractedIntervalCount());</span>
		}

<span class="nc" id="L360">		return success;</span>
	}


}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>