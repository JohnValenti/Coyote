<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>CorbaFacadeManagerEJB.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.ejb.bbm.corbafacade.ejb</a> &gt; <span class="el_source">CorbaFacadeManagerEJB.java</span></div><h1>CorbaFacadeManagerEJB.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.ejb.bbm.corbafacade.ejb;

import java.rmi.RemoteException;
import java.util.ArrayList;
import java.util.Collection;
import java.util.Date;
import java.util.HashMap;
import java.util.HashSet;
import java.util.Iterator;
import java.util.List;
import java.util.Locale;
import java.util.Map;
import java.util.TimeZone;

import javax.naming.Context;
import javax.naming.InitialContext;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.LocalDate;
import com.bluepumpkin.common.datatypes.ScopeID;
import com.bluepumpkin.common.localization.LocaleContext;
import com.bluepumpkin.common.logging.Category;
import com.bluepumpkin.common.util.NumberFactory;
import com.bluepumpkin.common.version.Version;
import com.bluepumpkin.ejb.am.ops.gcr.LSGInfoExtractor;
import com.bluepumpkin.ejb.bbm.BbmManagerFactory;
import com.bluepumpkin.ejb.bbm.Log;
import com.bluepumpkin.ejb.bbm.activity.ejb.ActivityManager;
import com.bluepumpkin.ejb.bbm.audit.ejb.EventAuditTrailManager;
import com.bluepumpkin.ejb.bbm.audit.model.AuditTrailEntry;
import com.bluepumpkin.ejb.bbm.base.BbmCreateDuplicateAgentIDException;
import com.bluepumpkin.ejb.bbm.base.BbmCreateDuplicateKeyException;
import com.bluepumpkin.ejb.bbm.base.BbmCreateException;
import com.bluepumpkin.ejb.bbm.base.BbmFinderException;
import com.bluepumpkin.ejb.bbm.base.BbmRemoveException;
import com.bluepumpkin.ejb.bbm.base.BbmUpdateDuplicateAgentIDException;
import com.bluepumpkin.ejb.bbm.base.BbmUpdateDuplicateKeyException;
import com.bluepumpkin.ejb.bbm.base.BbmUpdateException;
import com.bluepumpkin.ejb.bbm.base.BbmUpdateLoopSupervisorException;
import com.bluepumpkin.ejb.bbm.base.BbmUpdateNoOperationException;
import com.bluepumpkin.ejb.bbm.campaign.ejb.CampaignManager;
import com.bluepumpkin.ejb.bbm.campaign.model.Campaign;
import com.bluepumpkin.ejb.bbm.campaign.model.SPQueue;
import com.bluepumpkin.ejb.bbm.campaign.model.SchedulingPeriod;
import com.bluepumpkin.ejb.bbm.coaching.BbmCoachingBridgeInterface;
import com.bluepumpkin.ejb.bbm.coaching.model.CoachingAssignmentInt;
import com.bluepumpkin.ejb.bbm.config.ejb.DBConfigManager;
import com.bluepumpkin.ejb.bbm.corbafacade.model.CFActivity;
import com.bluepumpkin.ejb.bbm.corbafacade.model.CFActivityCategory;
import com.bluepumpkin.ejb.bbm.corbafacade.model.CFActivityCategoryFilter;
import com.bluepumpkin.ejb.bbm.corbafacade.model.CFActivityFilter;
import com.bluepumpkin.ejb.bbm.corbafacade.model.CFActivityMedia;
import com.bluepumpkin.ejb.bbm.corbafacade.model.CFBbmScheduleConflict;
import com.bluepumpkin.ejb.bbm.corbafacade.model.CFBbmScheduleConflictException;
import com.bluepumpkin.ejb.bbm.corbafacade.model.CFBbmScheduleConflictResolutions;
import com.bluepumpkin.ejb.bbm.corbafacade.model.CFCalendarEventAssignment;
import com.bluepumpkin.ejb.bbm.corbafacade.model.CFCalendarEventTemplate;
import com.bluepumpkin.ejb.bbm.corbafacade.model.CFDBConfiguration;
import com.bluepumpkin.ejb.bbm.corbafacade.model.CFEmployee;
import com.bluepumpkin.ejb.bbm.corbafacade.model.CFEmployeeSkill;
import com.bluepumpkin.ejb.bbm.corbafacade.model.CFEmployeeSkillHistory;
import com.bluepumpkin.ejb.bbm.corbafacade.model.CFEmployeeTimeBank;
import com.bluepumpkin.ejb.bbm.corbafacade.model.CFEmployeeTimeBankAdjust;
import com.bluepumpkin.ejb.bbm.corbafacade.model.CFEmployeeTimeBankAdjustCollection;
import com.bluepumpkin.ejb.bbm.corbafacade.model.CFEmployeeTimeBankHistory;
import com.bluepumpkin.ejb.bbm.corbafacade.model.CFEmployeeWorkPattern;
import com.bluepumpkin.ejb.bbm.corbafacade.model.CFEmployeeWorkPatternHistory;
import com.bluepumpkin.ejb.bbm.corbafacade.model.CFEventCollection;
import com.bluepumpkin.ejb.bbm.corbafacade.model.CFEventTemplateCollection;
import com.bluepumpkin.ejb.bbm.corbafacade.model.CFIDPersonNamePair;
import com.bluepumpkin.ejb.bbm.corbafacade.model.CFIDStringPair;
import com.bluepumpkin.ejb.bbm.corbafacade.model.CFLSGAgeBucketHashMap;
import com.bluepumpkin.ejb.bbm.corbafacade.model.CFLearningAssignment;
import com.bluepumpkin.ejb.bbm.corbafacade.model.CFLicensedItem;
import com.bluepumpkin.ejb.bbm.corbafacade.model.CFLsgAgeBucket;
import com.bluepumpkin.ejb.bbm.corbafacade.model.CFMultiUserException;
import com.bluepumpkin.ejb.bbm.corbafacade.model.CFOrganization;
import com.bluepumpkin.ejb.bbm.corbafacade.model.CFOrganizationHOO;
import com.bluepumpkin.ejb.bbm.corbafacade.model.CFPhantom;
import com.bluepumpkin.ejb.bbm.corbafacade.model.CFPublishingPeriod;
import com.bluepumpkin.ejb.bbm.corbafacade.model.CFRecurringEventTemplate;
import com.bluepumpkin.ejb.bbm.corbafacade.model.CFShiftAssignment;
import com.bluepumpkin.ejb.bbm.corbafacade.model.CFSystemType;
import com.bluepumpkin.ejb.bbm.corbafacade.model.CFTimeBank;
import com.bluepumpkin.ejb.bbm.corbafacade.model.CFUDFDefinition;
import com.bluepumpkin.ejb.bbm.corbafacade.model.CFUser;
import com.bluepumpkin.ejb.bbm.elearning.BbmELearningBridgeInterface;
import com.bluepumpkin.ejb.bbm.elearning.model.LearningAssignmentInt;
import com.bluepumpkin.ejb.bbm.empworkrule.ejb.EmpWorkRuleManager;
import com.bluepumpkin.ejb.bbm.localization.DefaultLocalizationManager;
import com.bluepumpkin.ejb.bbm.schedule.ejb.ScheduleAccessManager;
import com.bluepumpkin.ejb.bbm.schedule.model.BbmScheduleConflictException;
import com.bluepumpkin.ejb.bbm.schedule.model.BbmSchedulePublishingException;
import com.bluepumpkin.ejb.bbm.schedule.model.CalendarEvent;
import com.bluepumpkin.ejb.bbm.schedule.model.PublishingPeriod;
import com.bluepumpkin.ejb.bbm.schedule.model.ScheduleRunStatus;
import com.bluepumpkin.ejb.bbm.skill.ejb.SkillManager;
import com.bluepumpkin.ejb.bbm.timeoffcalculator.TONotifyMessage;
import com.bluepumpkin.ejb.bbm.timeseries.ejb.TimeSeriesAuditManager;
import com.bluepumpkin.ejb.bbm.workload.ejb.WorkloadManager;
import com.bluepumpkin.ejb.bbm.workload.model.queueattribute.QueueAttributeDefintion;
import com.bluepumpkin.ejb.bbm.workresource.ejb.WorkResourceManager;
import com.bluepumpkin.ejb.bbm.workresource.model.Employee;
import com.bluepumpkin.ejb.bbm.workresource.model.EmployeeName;
import com.bluepumpkin.ejb.bbm.workresource.model.Organization;
import com.bluepumpkin.ejb.bbm.workresource.model.OrganizationHOO;
import com.bluepumpkin.ejb.bbm.workrules.ejb.WorkRuleManager;
import com.bluepumpkin.ejb.core.CoreEJBCreateException;
import com.bluepumpkin.ejb.core.CoreManagerFactory;
import com.bluepumpkin.ejb.core.base.MultiUserException;
import com.bluepumpkin.ejb.core.base.SessionEJBBase;
import com.bluepumpkin.ejb.core.profile.UserProfileKeys;
import com.bluepumpkin.ejb.core.profile.model.UserProfile;
import com.verint.ejb.wfm.WfmManagerFactory;
import com.witness.ejb.core.base.CoreFinderException;
import com.witness.ejb.core.gcr.ejb.GCRManager;
import com.witness.ejb.core.gcr.model.GCREntry;
import com.witness.ejb.core.licensing.ejb.LicenseManager;
import com.witness.ejb.core.security.UserManager;
import com.witness.ejb.core.security.ejb.SecurityPolicyManagerRemote;
import com.witness.ejb.core.security.model.User;

/**
 * Title:        CorbaFacadeManagerEJB
 * Description:  A collection of methods used by the FS thick-client application via Corba.
 * Copyright:    Copyright (c) 2003, 2017
 * Company:      Verint Systems, Inc.
 */
<span class="nc" id="L129">public class CorbaFacadeManagerEJB extends SessionEJBBase {</span>
	/**
	 *
	 */
	private static final long serialVersionUID = 1L;

<span class="nc" id="L135">	private static final Category m_cat = Log.initCategory(CorbaFacadeManagerEJB.class.getName());</span>

	/**
	 * references to other EJBs used by the Schedule Access Manager EJB
	 */
	private ScheduleAccessManager m_scheduleAccessManager;
	private UserManager m_userManager;
	private WorkResourceManager m_workResourceManager;
	private WorkRuleManager m_workRulesManager;
	private ActivityManager m_activityManager;
	private DBConfigManager m_dbConfigManager;
	private LicenseManager m_licenseManager;
	private TimeSeriesAuditManager m_timeSeriesAuditManager;
	private BbmELearningBridgeInterface m_bbmELearningBridge;
	private BbmCoachingBridgeInterface m_bbmCoachingBridge;
	private SkillManager m_skillManager;
	private EmpWorkRuleManager m_empWorkRuleManager;
	private SecurityPolicyManagerRemote m_securityManager;
	private EventAuditTrailManager m_auditManager;
	private WorkloadManager m_workloadManager;
	private CampaignManager m_campaignManager;
	private LSGInfoExtractor m_lsgManagerExtractor;

	/*
	 * a flag that indicates whether or not this instance is running in what if
	 * mode
	 */
<span class="nc" id="L162">	private boolean m_isWhatIf = false;</span>

	{
<span class="nc" id="L165">		super.init(CorbaFacadeManagerEJB.class.getName());</span>
<span class="nc" id="L166">	}</span>

	/**
	 * Perform one-time initialization of this EJB instance
	 */
	@Override
	public void onEjbCreate() {
		try {
			// First query environment to get WIF setting from DD
<span class="nc" id="L175">			final Context initialContext = new InitialContext();</span>
<span class="nc" id="L176">			final Boolean WIF = (Boolean) initialContext.lookup(&quot;java:comp/env/WIF&quot;);</span>
<span class="nc bnc" id="L177" title="All 2 branches missed.">			if (WIF != null) {</span>
<span class="nc" id="L178">				m_isWhatIf = WIF.booleanValue();</span>
			}

<span class="nc" id="L181">			m_scheduleAccessManager = WfmManagerFactory.getScheduleAccessManager(m_isWhatIf);</span>
<span class="nc" id="L182">			m_workResourceManager = BbmManagerFactory.getWorkResourceManager(m_isWhatIf);</span>
<span class="nc" id="L183">			m_workRulesManager = WfmManagerFactory.getWorkRuleManager(m_isWhatIf);</span>
<span class="nc" id="L184">			m_activityManager = WfmManagerFactory.getActivityManager(m_isWhatIf);</span>
<span class="nc" id="L185">			m_dbConfigManager = BbmManagerFactory.getDBConfigManager(m_isWhatIf);</span>
<span class="nc" id="L186">			m_timeSeriesAuditManager = WfmManagerFactory.getTimeSeriesAuditManager(m_isWhatIf);</span>
<span class="nc" id="L187">			m_skillManager = WfmManagerFactory.getSkillManager(m_isWhatIf);</span>
<span class="nc" id="L188">			m_empWorkRuleManager = WfmManagerFactory.getEmpWorkRuleManager(m_isWhatIf);</span>
			// m_licenseManager doesn't have whatif mode. but sounds nobody use
			// it from corba facade now.- will fix it later.
<span class="nc" id="L191">			m_licenseManager = CoreManagerFactory.getLicenseManager();</span>

<span class="nc" id="L193">			m_userManager = CoreManagerFactory.getUserManager(m_isWhatIf);</span>

<span class="nc" id="L195">			m_bbmELearningBridge = getELearningBridge();</span>

<span class="nc" id="L197">			m_bbmCoachingBridge = getCoachingBridgeInterface();</span>

<span class="nc" id="L199">			m_securityManager = CoreManagerFactory.getSecurityPolicyManager(m_isWhatIf);</span>

<span class="nc" id="L201">			m_auditManager = BbmManagerFactory.getEventAuditTrailManager(m_isWhatIf);</span>

<span class="nc" id="L203">			m_workloadManager = WfmManagerFactory.getWorkloadManager(m_isWhatIf);</span>

<span class="nc" id="L205">			m_campaignManager = WfmManagerFactory.getCampaignManager(m_isWhatIf);</span>
<span class="nc" id="L206">		} catch (final Exception e) {</span>
<span class="nc" id="L207">			handleException(&quot;onEjbCreate&quot;, e, false);</span>
<span class="nc" id="L208">		}</span>
<span class="nc" id="L209">	}</span>

	/**
	 * override the base class to provide the appropriate logging category
	 */
	@Override
	protected Category getCategory() {
<span class="nc" id="L216">		return m_cat;</span>
	}

    /*
	 * Implementation of abstract methods
     */

	public String getIdlVersion() {
<span class="nc" id="L224">		return com.bluepumpkin.ejb.bbm.corbafacade.model.Version.idlVersion;</span>
	}

	public String getMarketingVersion() throws RemoteException {
<span class="nc" id="L228">		methodStart(&quot;getMarketingVersion&quot;);</span>
<span class="nc" id="L229">		final Version ver = new Version(CorbaFacadeManagerEJB.class);</span>
<span class="nc" id="L230">		methodFinish();</span>
<span class="nc" id="L231">		return ver.getSubsystemVersion();</span>
	}

	public String getLanguageLocaleStringForUser(String userId) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L235">		return getLocaleString(getLocaleContext(userId).getLanguageLocale().getLanguage(), getLocaleContext(userId).getLanguageLocale().getCountry());</span>
	}

	public String getRegionalLocaleStringForUser(String userId) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L239">		return getLocaleString(getLocaleContext(userId).getRegionalFormatLocale().getLanguage(), getLocaleContext(userId).getRegionalFormatLocale().getCountry());</span>
	}

	private String getLocaleString(String language, String country) {
<span class="nc" id="L243">		String locale = language;</span>
<span class="nc bnc" id="L244" title="All 4 branches missed.">		if ((country != null) &amp;&amp; (country.trim().length() &gt; 0)) {</span>
<span class="nc" id="L245">			locale += (&quot;_&quot; + country);</span>
		}
<span class="nc" id="L247">		return locale;</span>
	}

	public CFPublishingPeriod[] getPublishedPeriods(Collection workResourceIDs, Date dtStart, Date dtEnd) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L251">		methodStart(&quot;getPublishedPeriods&quot;, workResourceIDs, dtStart, dtEnd);</span>
		try {
<span class="nc" id="L253">			final ArrayList retVal = new ArrayList();</span>
<span class="nc" id="L254">			final List lst = m_scheduleAccessManager.getPublishedPeriods(workResourceIDs, dtStart, dtEnd);</span>
<span class="nc bnc" id="L255" title="All 4 branches missed.">			final int size = (lst != null) &amp;&amp; (lst.size() &gt; 0) ? lst.size() : 0;</span>

<span class="nc bnc" id="L257" title="All 2 branches missed.">			for (int i = 0; i &lt; size; ++i) {</span>
<span class="nc" id="L258">				final Collection coll = (Collection) lst.get(i);</span>
<span class="nc bnc" id="L259" title="All 2 branches missed.">				if (coll != null) {</span>
<span class="nc" id="L260">					final Iterator iter = coll.iterator();</span>

<span class="nc bnc" id="L262" title="All 2 branches missed.">					while (iter.hasNext()) {</span>
<span class="nc" id="L263">						final PublishingPeriod pp = (PublishingPeriod) iter.next();</span>
<span class="nc" id="L264">						retVal.add(CFPublishingPeriod.toObject(pp));</span>
<span class="nc" id="L265">					}</span>
				}
			}

<span class="nc" id="L269">			methodFinish();</span>
<span class="nc" id="L270">			return (CFPublishingPeriod[]) retVal.toArray(new CFPublishingPeriod[retVal.size()]);</span>
<span class="nc" id="L271">		} catch (final Exception ex) {</span>
<span class="nc" id="L272">			handleException(ex);</span>
<span class="nc" id="L273">			methodFinish();</span>
<span class="nc" id="L274">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		}
	}

	/*
	 * private methods
	 */
	private LocaleContext getLocaleContext(String userId) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L282">		methodStart(&quot;getLocaleContext&quot;, userId);</span>
		try {
			// TODO: needs to be fixed return
			// m_userManager.getLocaleContext(userId);
<span class="nc" id="L286">			final User user = this.m_userManager.getUserByName(userId);</span>

<span class="nc" id="L288">			final UserProfile userProf = new UserProfile(user.getID());</span>
<span class="nc" id="L289">			final String sLangLocale = userProf.loadProperty(UserProfileKeys.USER_LANGUAGE);</span>
<span class="nc" id="L290">			final String sRegLocale = userProf.loadProperty(UserProfileKeys.USER_REGIONAL_FORMAT);</span>

<span class="nc" id="L292">			final DefaultLocalizationManager locMgr = DefaultLocalizationManager.getDefaultInstance();</span>
<span class="nc" id="L293">			final LocaleContext defaultLC = locMgr.getLocaleContext();</span>
<span class="nc" id="L294">			Locale langLocale = locMgr.getLocale(sLangLocale);</span>
<span class="nc" id="L295">			Locale regLocale = locMgr.getLocale(sRegLocale);</span>

<span class="nc" id="L297">			final Locale currencyLocale = defaultLC.getCurrencyLocale();</span>
<span class="nc bnc" id="L298" title="All 2 branches missed.">			if (langLocale == null) {</span>
<span class="nc" id="L299">				langLocale = defaultLC.getLanguageLocale();</span>
			}
<span class="nc bnc" id="L301" title="All 2 branches missed.">			if (regLocale == null) {</span>
<span class="nc" id="L302">				regLocale = defaultLC.getRegionalFormatLocale();</span>
			}

<span class="nc" id="L305">			return locMgr.getLocaleContext(langLocale, regLocale, currencyLocale);</span>
<span class="nc" id="L306">		} catch (final Exception ex) {</span>
<span class="nc" id="L307">			handleException(ex);</span>
<span class="nc" id="L308">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L310">			methodFinish();</span>
		}
	}

	// ================ Schedule Access Manager ===============
	public ID createCalendarEventAssignment(CFCalendarEventAssignment cfEvent) throws RemoteException, CorbaFacadeException, CFMultiUserException, CFBbmScheduleConflictException {
<span class="nc" id="L316">		return createCalendarEventAssignmentWithLock(null, cfEvent);</span>
	}

	public ID createCalendarEventAssignmentWithLock(String lockID, CFCalendarEventAssignment cfEvent) throws RemoteException, CorbaFacadeException, CFMultiUserException, CFBbmScheduleConflictException {
<span class="nc" id="L320">		methodStart(&quot;createCalendarEventAssignment&quot;, cfEvent);</span>
		try {
<span class="nc" id="L322">			return m_scheduleAccessManager.createCalendarEventAssignmentWithLock(lockID, CFCalendarEventAssignment.convert(cfEvent));</span>
<span class="nc" id="L323">		} catch (final MultiUserException ex) {</span>
<span class="nc" id="L324">			handleException(ex, true);</span>
<span class="nc" id="L325">			throw CFMultiUserException.convert(ex);</span>
<span class="nc" id="L326">		} catch (final BbmScheduleConflictException ex) {</span>
<span class="nc" id="L327">			handleException(ex, true);</span>
<span class="nc" id="L328">			throw CFBbmScheduleConflictException.convert(ex);</span>
<span class="nc" id="L329">		} catch (final BbmCreateException ex) {</span>
<span class="nc" id="L330">			handleException(ex, true);</span>
<span class="nc" id="L331">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_CREATE_EXCEPTION);</span>
<span class="nc" id="L332">		} catch (final Exception ex) {</span>
<span class="nc" id="L333">			handleException(ex, true);</span>
<span class="nc" id="L334">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L336">			methodFinish();</span>
		}
	}

	public void deleteCalendarEventAssignments(Collection eventAssignmentIDs) throws RemoteException, CorbaFacadeException, CFMultiUserException {
<span class="nc" id="L341">		deleteCalendarEventAssignmentsWithLock(null, eventAssignmentIDs);</span>
<span class="nc" id="L342">	}</span>

	public void deleteCalendarEventAssignmentsWithLock(String lockID, Collection eventAssignmentIDs) throws RemoteException, CorbaFacadeException, CFMultiUserException {
<span class="nc" id="L345">		methodStart(&quot;deleteCalendarEventAssignmentsWithLock&quot;, lockID, eventAssignmentIDs);</span>
		try {
<span class="nc" id="L347">			m_scheduleAccessManager.deleteCalendarEventAssignmentsWithLock(lockID, eventAssignmentIDs);</span>
<span class="nc" id="L348">		} catch (final MultiUserException ex) {</span>
<span class="nc" id="L349">			handleException(ex, true);</span>
<span class="nc" id="L350">			throw CFMultiUserException.convert(ex);</span>
<span class="nc" id="L351">		} catch (final BbmRemoveException ex) {</span>
<span class="nc" id="L352">			handleException(ex, true);</span>
<span class="nc" id="L353">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_REMOVE_EXCEPTION);</span>
<span class="nc" id="L354">		} catch (final Exception ex) {</span>
<span class="nc" id="L355">			handleException(ex, true);</span>
<span class="nc" id="L356">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L358">			methodFinish();</span>
<span class="nc" id="L359">		}</span>
<span class="nc" id="L360">	}</span>

	public CFCalendarEventAssignment getCalendarEventAssignmentByID(ID eventID) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L363">		methodStart(&quot;getCalendarEventAssignmentByID&quot;, eventID);</span>
		try {
<span class="nc" id="L365">			return CFCalendarEventAssignment.convert(m_scheduleAccessManager.getCalendarEventAssignmentByID(eventID));</span>
<span class="nc" id="L366">		} catch (final BbmFinderException ex) {</span>
<span class="nc" id="L367">			handleException(ex, true);</span>
<span class="nc" id="L368">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
<span class="nc" id="L369">		} catch (final Exception ex) {</span>
<span class="nc" id="L370">			handleException(ex, true);</span>
<span class="nc" id="L371">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L373">			methodFinish();</span>
		}
	}

	public void updateCalendarEventAssignment(CFCalendarEventAssignment cfEvent) throws RemoteException, CorbaFacadeException, CFMultiUserException, CFBbmScheduleConflictException {
<span class="nc" id="L378">		updateCalendarEventAssignmentWithLock(null, cfEvent);</span>
<span class="nc" id="L379">	}</span>

	public void updateCalendarEventAssignmentWithLock(String lockID, CFCalendarEventAssignment cfEvent) throws RemoteException, CorbaFacadeException, CFMultiUserException, CFBbmScheduleConflictException {
<span class="nc" id="L382">		methodStart(&quot;updateCalendarEventAssignmentWithLock&quot;, lockID, cfEvent);</span>
		try {
<span class="nc" id="L384">			m_scheduleAccessManager.updateCalendarEventAssignmentWithLock(lockID, CFCalendarEventAssignment.convert(cfEvent));</span>
<span class="nc" id="L385">		} catch (final MultiUserException ex) {</span>
<span class="nc" id="L386">			handleException(ex, true);</span>
<span class="nc" id="L387">			throw CFMultiUserException.convert(ex);</span>
<span class="nc" id="L388">		} catch (final BbmScheduleConflictException ex) {</span>
<span class="nc" id="L389">			handleException(ex, true);</span>
<span class="nc" id="L390">			throw CFBbmScheduleConflictException.convert(ex);</span>
<span class="nc" id="L391">		} catch (final BbmUpdateException ex) {</span>
<span class="nc" id="L392">			handleException(ex, true);</span>
<span class="nc" id="L393">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_UPDATE_EXCEPTION);</span>
<span class="nc" id="L394">		} catch (final Exception ex) {</span>
<span class="nc" id="L395">			handleException(ex, true);</span>
<span class="nc" id="L396">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L398">			methodFinish();</span>
<span class="nc" id="L399">		}</span>
<span class="nc" id="L400">	}</span>

	public ID createEventTemplateWithInstances(CFCalendarEventTemplate cfEventTemplate, CFBbmScheduleConflictResolutions cfConflictResolutions) throws RemoteException, CorbaFacadeException, CFMultiUserException, CFBbmScheduleConflictException {
<span class="nc" id="L403">		methodStart(&quot;createEventTemplateWithInstances&quot;, cfEventTemplate, cfConflictResolutions);</span>
		try {
<span class="nc" id="L405">			return m_scheduleAccessManager.createEventTemplateWithInstances(CFCalendarEventTemplate.convert(cfEventTemplate), CFBbmScheduleConflictResolutions.convert(cfConflictResolutions));</span>
<span class="nc" id="L406">		} catch (final MultiUserException ex) {</span>
<span class="nc" id="L407">			handleException(ex, true);</span>
<span class="nc" id="L408">			throw CFMultiUserException.convert(ex);</span>
<span class="nc" id="L409">		} catch (final BbmScheduleConflictException ex) {</span>
<span class="nc" id="L410">			handleException(ex, true);</span>
<span class="nc" id="L411">			throw CFBbmScheduleConflictException.convert(ex);</span>
<span class="nc" id="L412">		} catch (final BbmCreateException ex) {</span>
<span class="nc" id="L413">			handleException(ex, true);</span>
<span class="nc" id="L414">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_CREATE_EXCEPTION);</span>
<span class="nc" id="L415">		} catch (final Exception ex) {</span>
<span class="nc" id="L416">			handleException(ex, true);</span>
<span class="nc" id="L417">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L419">			methodFinish();</span>
		}
	}

	public CFCalendarEventAssignment createRecurringEventException(ID templateID, Collection workResourceIDs, Date exceptionDate) throws RemoteException, CorbaFacadeException, CFMultiUserException {
<span class="nc" id="L424">		methodStart(&quot;createRecurringEventException&quot;, templateID, workResourceIDs, exceptionDate);</span>
		try {
<span class="nc" id="L426">			return CFCalendarEventAssignment.convert(m_scheduleAccessManager.createRecurringEventException(templateID, workResourceIDs, exceptionDate));</span>
<span class="nc" id="L427">		} catch (final MultiUserException ex) {</span>
<span class="nc" id="L428">			handleException(ex, true);</span>
<span class="nc" id="L429">			throw CFMultiUserException.convert(ex);</span>
<span class="nc" id="L430">		} catch (final BbmCreateException ex) {</span>
<span class="nc" id="L431">			handleException(ex, true);</span>
<span class="nc" id="L432">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_CREATE_EXCEPTION);</span>
<span class="nc" id="L433">		} catch (final Exception ex) {</span>
<span class="nc" id="L434">			handleException(ex, true);</span>
<span class="nc" id="L435">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L437">			methodFinish();</span>
		}
	}

	public void deleteRecurringEventInstance(ID templateID, Collection workResourceIDs, Date exceptionDate) throws RemoteException, CorbaFacadeException, CFMultiUserException {
<span class="nc" id="L442">		methodStart(&quot;deleteRecurringEventInstance&quot;, templateID, workResourceIDs, exceptionDate);</span>
		try {
<span class="nc" id="L444">			m_scheduleAccessManager.deleteRecurringEventInstance(templateID, workResourceIDs, exceptionDate);</span>
<span class="nc" id="L445">		} catch (final MultiUserException ex) {</span>
<span class="nc" id="L446">			handleException(ex, true);</span>
<span class="nc" id="L447">			throw CFMultiUserException.convert(ex);</span>
<span class="nc" id="L448">		} catch (final Exception ex) {</span>
<span class="nc" id="L449">			handleException(ex, true);</span>
<span class="nc" id="L450">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L452">			methodFinish();</span>
<span class="nc" id="L453">		}</span>
<span class="nc" id="L454">	}</span>

	public CFCalendarEventTemplate getCalendarEventTemplateByID(ID templateID) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L457">		methodStart(&quot;getCalendarEventTemplateByID&quot;, templateID);</span>
		try {
<span class="nc" id="L459">			return CFCalendarEventTemplate.convert(m_scheduleAccessManager.getCalendarEventTemplateByID(templateID));</span>
<span class="nc" id="L460">		} catch (final BbmFinderException ex) {</span>
<span class="nc" id="L461">			handleException(ex, true);</span>
<span class="nc" id="L462">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
<span class="nc" id="L463">		} catch (final Exception ex) {</span>
<span class="nc" id="L464">			handleException(ex, true);</span>
<span class="nc" id="L465">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L467">			methodFinish();</span>
		}
	}

	public CFRecurringEventTemplate[] getAllRecurringEventTemplatesForPostMigration(Collection workResourceIDs, Date dtStart, Date dtEnd) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L472">		methodStart(&quot;getAllRecurringEventTemplatesForPostMigration&quot;, workResourceIDs, dtStart, dtEnd);</span>
		try {
<span class="nc" id="L474">			return CFRecurringEventTemplate.convert(m_scheduleAccessManager.getAllRecurringEventTemplatesForPostMigration(workResourceIDs, dtStart, dtEnd));</span>
<span class="nc" id="L475">		} catch (final BbmFinderException ex) {</span>
<span class="nc" id="L476">			handleException(ex, true);</span>
<span class="nc" id="L477">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
<span class="nc" id="L478">		} catch (final Exception ex) {</span>
<span class="nc" id="L479">			handleException(ex, true);</span>
<span class="nc" id="L480">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L482">			methodFinish();</span>
		}
	}

	public void updateEventTemplateWithInstances(CFCalendarEventTemplate cfEventTemplate, CFBbmScheduleConflictResolutions cfConflictResolutions) throws RemoteException, CorbaFacadeException, CFMultiUserException, CFBbmScheduleConflictException {
<span class="nc" id="L487">		methodStart(&quot;updateEventTemplateWithInstances&quot;, cfEventTemplate, cfConflictResolutions);</span>
		try {
<span class="nc" id="L489">			m_scheduleAccessManager.updateEventTemplateWithInstances(CFCalendarEventTemplate.convert(cfEventTemplate), CFBbmScheduleConflictResolutions.convert(cfConflictResolutions));</span>
<span class="nc" id="L490">		} catch (final MultiUserException ex) {</span>
<span class="nc" id="L491">			handleException(ex, true);</span>
<span class="nc" id="L492">			throw CFMultiUserException.convert(ex);</span>
<span class="nc" id="L493">		} catch (final BbmScheduleConflictException ex) {</span>
<span class="nc" id="L494">			handleException(ex, true);</span>
<span class="nc" id="L495">			throw CFBbmScheduleConflictException.convert(ex);</span>
<span class="nc" id="L496">		} catch (final BbmUpdateException ex) {</span>
<span class="nc" id="L497">			handleException(ex, true);</span>
<span class="nc" id="L498">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_UPDATE_EXCEPTION);</span>
<span class="nc" id="L499">		} catch (final Exception ex) {</span>
<span class="nc" id="L500">			handleException(ex, true);</span>
<span class="nc" id="L501">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L503">			methodFinish();</span>
<span class="nc" id="L504">		}</span>
<span class="nc" id="L505">	}</span>

	public void deleteEventTemplateWithInstances(ID templateID) throws RemoteException, CorbaFacadeException, CFMultiUserException {
<span class="nc" id="L508">		methodStart(&quot;deleteEventTemplateWithInstances&quot;, templateID);</span>
		try {
<span class="nc" id="L510">			m_scheduleAccessManager.deleteEventTemplateWithInstances(templateID);</span>
<span class="nc" id="L511">		} catch (final MultiUserException ex) {</span>
<span class="nc" id="L512">			handleException(ex, true);</span>
<span class="nc" id="L513">			throw CFMultiUserException.convert(ex);</span>
<span class="nc" id="L514">		} catch (final BbmRemoveException ex) {</span>
<span class="nc" id="L515">			handleException(ex, true);</span>
<span class="nc" id="L516">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_REMOVE_EXCEPTION);</span>
<span class="nc" id="L517">		} catch (final Exception ex) {</span>
<span class="nc" id="L518">			handleException(ex, true);</span>
<span class="nc" id="L519">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L521">			methodFinish();</span>
<span class="nc" id="L522">		}</span>
<span class="nc" id="L523">	}</span>

	public ID createClassSession(ID templateID, CFCalendarEventAssignment cfEvent) throws RemoteException, CorbaFacadeException, CFMultiUserException, CFBbmScheduleConflictException {
<span class="nc" id="L526">		return createClassSessionWithLock(null, templateID, cfEvent);</span>
	}

	public ID createClassSessionWithLock(String sLock, ID templateID, CFCalendarEventAssignment cfEvent) throws RemoteException, CorbaFacadeException, CFMultiUserException, CFBbmScheduleConflictException {
<span class="nc" id="L530">		methodStart(&quot;createClassSessionWithLock&quot;, sLock, templateID, cfEvent);</span>
		try {
<span class="nc" id="L532">			return m_scheduleAccessManager.createClassSessionWithLock(sLock, templateID, (CalendarEvent) (CFCalendarEventAssignment.convert(cfEvent)));</span>
<span class="nc" id="L533">		} catch (final MultiUserException ex) {</span>
<span class="nc" id="L534">			handleException(ex, true);</span>
<span class="nc" id="L535">			throw CFMultiUserException.convert(ex);</span>
<span class="nc" id="L536">		} catch (final BbmScheduleConflictException ex) {</span>
<span class="nc" id="L537">			handleException(ex, true);</span>
<span class="nc" id="L538">			throw CFBbmScheduleConflictException.convert(ex);</span>
<span class="nc" id="L539">		} catch (final BbmCreateException ex) {</span>
<span class="nc" id="L540">			handleException(ex, true);</span>
<span class="nc" id="L541">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_CREATE_EXCEPTION);</span>
<span class="nc" id="L542">		} catch (final Exception ex) {</span>
<span class="nc" id="L543">			handleException(ex, true);</span>
<span class="nc" id="L544">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L546">			methodFinish();</span>
		}
	}

	public ID createShiftAssignment(CFShiftAssignment cfShiftAssignment) throws RemoteException, CorbaFacadeException, CFMultiUserException, CFBbmScheduleConflictException {
<span class="nc" id="L551">		methodStart(&quot;createShiftAssignment&quot;, cfShiftAssignment);</span>
		try {
<span class="nc" id="L553">			return m_scheduleAccessManager.createShiftAssignment(CFShiftAssignment.convert(cfShiftAssignment));</span>
<span class="nc" id="L554">		} catch (final MultiUserException ex) {</span>
<span class="nc" id="L555">			handleException(ex, true);</span>
<span class="nc" id="L556">			throw CFMultiUserException.convert(ex);</span>
<span class="nc" id="L557">		} catch (final BbmScheduleConflictException ex) {</span>
<span class="nc" id="L558">			handleException(ex, true);</span>
<span class="nc" id="L559">			throw CFBbmScheduleConflictException.convert(ex);</span>
<span class="nc" id="L560">		} catch (final BbmCreateException ex) {</span>
<span class="nc" id="L561">			handleException(ex, true);</span>
<span class="nc" id="L562">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_CREATE_EXCEPTION);</span>
<span class="nc" id="L563">		} catch (final Exception ex) {</span>
<span class="nc" id="L564">			handleException(ex, true);</span>
<span class="nc" id="L565">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L567">			methodFinish();</span>
		}
	}

	public Collection createShiftAssignments(CFShiftAssignment[] cfShiftAssignments) throws RemoteException, CorbaFacadeException, CFMultiUserException, CFBbmScheduleConflictException {
<span class="nc" id="L572">		return createShiftAssignmentsWithLock(null, cfShiftAssignments);</span>
	}

	public Collection createShiftAssignmentsWithLock(String lockID, CFShiftAssignment[] cfShiftAssignments) throws RemoteException, CorbaFacadeException, CFMultiUserException, CFBbmScheduleConflictException {
<span class="nc" id="L576">		methodStart(&quot;createShiftAssignment&quot;, lockID, cfShiftAssignments);</span>
		try {
<span class="nc" id="L578">			return m_scheduleAccessManager.createShiftAssignmentsWithLock(lockID, CFShiftAssignment.convert(cfShiftAssignments));</span>
<span class="nc" id="L579">		} catch (final MultiUserException ex) {</span>
<span class="nc" id="L580">			handleException(ex, true);</span>
<span class="nc" id="L581">			throw CFMultiUserException.convert(ex);</span>
<span class="nc" id="L582">		} catch (final BbmScheduleConflictException ex) {</span>
<span class="nc" id="L583">			handleException(ex, true);</span>
<span class="nc" id="L584">			throw CFBbmScheduleConflictException.convert(ex);</span>
<span class="nc" id="L585">		} catch (final BbmCreateException ex) {</span>
<span class="nc" id="L586">			handleException(ex, true);</span>
<span class="nc" id="L587">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_CREATE_EXCEPTION);</span>
<span class="nc" id="L588">		} catch (final Exception ex) {</span>
<span class="nc" id="L589">			handleException(ex, true);</span>
<span class="nc" id="L590">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L592">			methodFinish();</span>
		}
	}

	public void copyShiftAssignments(ID idSourceSP, ID idDestinationSP, boolean bClearDestinationSP) throws RemoteException, CorbaFacadeException, CFBbmScheduleConflictException {
<span class="nc" id="L597">		methodStart(&quot;copyShiftAssignments&quot;, idSourceSP, idDestinationSP, new Boolean(bClearDestinationSP));</span>
		try {
<span class="nc" id="L599">			m_scheduleAccessManager.copyShiftAssignments(idSourceSP, idDestinationSP, bClearDestinationSP);</span>
<span class="nc" id="L600">		} catch (final BbmScheduleConflictException ex) {</span>
<span class="nc" id="L601">			handleException(ex, true);</span>
<span class="nc" id="L602">			throw CFBbmScheduleConflictException.convert(ex);</span>
<span class="nc" id="L603">		} catch (final BbmFinderException ex) {</span>
<span class="nc" id="L604">			handleException(ex, true);</span>
<span class="nc" id="L605">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
<span class="nc" id="L606">		} catch (final Exception ex) {</span>
<span class="nc" id="L607">			handleException(ex, true);</span>
<span class="nc" id="L608">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L610">			methodFinish();</span>
<span class="nc" id="L611">		}</span>
<span class="nc" id="L612">	}</span>

	public void copyShiftAssignments(ID idSourceSP, Date sourceWeekStart, ID idDestinationSP, Date targetWeekStart, boolean bClearDestinationSP) throws RemoteException, CorbaFacadeException, CFBbmScheduleConflictException {
<span class="nc" id="L615">		methodStart(&quot;copyShiftAssignments&quot;, idSourceSP, sourceWeekStart, idDestinationSP, targetWeekStart, new Boolean(bClearDestinationSP));</span>
		try {
<span class="nc" id="L617">			m_scheduleAccessManager.copyShiftAssignments(idSourceSP, sourceWeekStart, idDestinationSP, targetWeekStart, bClearDestinationSP);</span>
<span class="nc" id="L618">		} catch (final BbmScheduleConflictException ex) {</span>
<span class="nc" id="L619">			handleException(ex, true);</span>
<span class="nc" id="L620">			throw CFBbmScheduleConflictException.convert(ex);</span>
<span class="nc" id="L621">		} catch (final BbmFinderException ex) {</span>
<span class="nc" id="L622">			handleException(ex, true);</span>
<span class="nc" id="L623">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
<span class="nc" id="L624">		} catch (final Exception ex) {</span>
<span class="nc" id="L625">			handleException(ex, true);</span>
<span class="nc" id="L626">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L628">			methodFinish();</span>
<span class="nc" id="L629">		}</span>
<span class="nc" id="L630">	}</span>

	public void deleteShiftAssignments(Collection shiftAssignmentIDs) throws RemoteException, CorbaFacadeException, CFMultiUserException {
<span class="nc" id="L633">		deleteShiftAssignmentsWithLock(null, shiftAssignmentIDs);</span>
<span class="nc" id="L634">	}</span>

	public void deleteShiftAssignmentsWithLock(String lockID, Collection shiftAssignmentIDs) throws RemoteException, CorbaFacadeException, CFMultiUserException {
<span class="nc" id="L637">		methodStart(&quot;deleteShiftAssignmentsWithLock&quot;, lockID, shiftAssignmentIDs);</span>
		try {
<span class="nc" id="L639">			m_scheduleAccessManager.deleteShiftAssignmentsWithLock(lockID, shiftAssignmentIDs);</span>
<span class="nc" id="L640">		} catch (final MultiUserException ex) {</span>
<span class="nc" id="L641">			handleException(ex, true);</span>
<span class="nc" id="L642">			throw CFMultiUserException.convert(ex);</span>
<span class="nc" id="L643">		} catch (final BbmRemoveException ex) {</span>
<span class="nc" id="L644">			handleException(ex, true);</span>
<span class="nc" id="L645">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_REMOVE_EXCEPTION);</span>
<span class="nc" id="L646">		} catch (final Exception ex) {</span>
<span class="nc" id="L647">			handleException(ex, true);</span>
<span class="nc" id="L648">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L650">			methodFinish();</span>
<span class="nc" id="L651">		}</span>
<span class="nc" id="L652">	}</span>

	public void deleteShiftAssignmentsWithLockString(String lockID, Collection workResourceIDs, Date startTime, Date endTime, ID campaignID, boolean unlockedOnly) throws RemoteException, CorbaFacadeException, CFMultiUserException {
<span class="nc" id="L655">		methodStart(&quot;deleteShiftAssignments&quot;, workResourceIDs, startTime, endTime, campaignID, new Boolean(unlockedOnly));</span>
		try {
<span class="nc" id="L657">			m_scheduleAccessManager.deleteShiftAssignments(workResourceIDs, startTime, endTime, campaignID, unlockedOnly);</span>
<span class="nc" id="L658">		} catch (final MultiUserException ex) {</span>
<span class="nc" id="L659">			handleException(ex, true);</span>
<span class="nc" id="L660">			throw CFMultiUserException.convert(ex);</span>
<span class="nc" id="L661">		} catch (final BbmRemoveException ex) {</span>
<span class="nc" id="L662">			handleException(ex, true);</span>
<span class="nc" id="L663">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_REMOVE_EXCEPTION);</span>
<span class="nc" id="L664">		} catch (final Exception ex) {</span>
<span class="nc" id="L665">			handleException(ex, true);</span>
<span class="nc" id="L666">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L668">			methodFinish();</span>
<span class="nc" id="L669">		}</span>
<span class="nc" id="L670">	}</span>

	public CFShiftAssignment getShiftAssignmentByID(ID shiftAssignmentID) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L673">		methodStart(&quot;getShiftAssignmentByID&quot;, shiftAssignmentID);</span>
		try {
<span class="nc" id="L675">			return CFShiftAssignment.convert(m_scheduleAccessManager.getShiftAssignmentByID(shiftAssignmentID));</span>
<span class="nc" id="L676">		} catch (final BbmFinderException ex) {</span>
<span class="nc" id="L677">			handleException(ex, true);</span>
<span class="nc" id="L678">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
<span class="nc" id="L679">		} catch (final Exception ex) {</span>
<span class="nc" id="L680">			handleException(ex, true);</span>
<span class="nc" id="L681">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L683">			methodFinish();</span>
		}
	}

	public void unlockShiftAssignmentsByIDs(Collection cShiftAssignmentIDs, Collection cWorkResourceIDs, Date dtStart, Date dtEnd, boolean bUnlockShiftEventsOnly) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L688">		methodStart(&quot;unlockShiftAssignmentsByIDs&quot;, cShiftAssignmentIDs, cWorkResourceIDs, dtStart, dtEnd, new Boolean(bUnlockShiftEventsOnly));</span>
		try {
<span class="nc" id="L690">			m_scheduleAccessManager.unlockShiftAssignmentsByIDs(cShiftAssignmentIDs, cWorkResourceIDs, dtStart, dtEnd, bUnlockShiftEventsOnly);</span>
<span class="nc" id="L691">		} catch (final BbmUpdateException ex) {</span>
<span class="nc" id="L692">			handleException(ex, true);</span>
<span class="nc" id="L693">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_UPDATE_EXCEPTION);</span>
<span class="nc" id="L694">		} catch (final Exception ex) {</span>
<span class="nc" id="L695">			handleException(ex, true);</span>
<span class="nc" id="L696">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L698">			methodFinish();</span>
<span class="nc" id="L699">		}</span>
<span class="nc" id="L700">	}</span>

	public CFEventCollection getEventsForWorkResource(ID workResourceID, Date dtStart, Date dtEnd) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L703">		methodStart(&quot;getEventsForWorkResource&quot;, workResourceID, dtStart, dtEnd);</span>
		try {
<span class="nc" id="L705">			return CFEventCollection.convert(m_scheduleAccessManager.getEventsForWorkResource(workResourceID, dtStart, dtEnd));</span>
<span class="nc" id="L706">		} catch (final BbmFinderException ex) {</span>
<span class="nc" id="L707">			handleException(ex, true);</span>
<span class="nc" id="L708">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
<span class="nc" id="L709">		} catch (final Exception ex) {</span>
<span class="nc" id="L710">			handleException(ex, true);</span>
<span class="nc" id="L711">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L713">			methodFinish();</span>
		}
	}

	public CFEventCollection getEventsForWorkResourceByType(int eventTypeMask, ID workResourceID, Date dtStart, Date dtEnd) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L718">		methodStart(&quot;getEventsForWorkResourceByType&quot;, new Integer(eventTypeMask), workResourceID, dtStart, dtEnd);</span>
		try {
<span class="nc" id="L720">			return CFEventCollection.convert(m_scheduleAccessManager.getEventsForWorkResourceByType(eventTypeMask, workResourceID, dtStart, dtEnd));</span>
<span class="nc" id="L721">		} catch (final BbmFinderException ex) {</span>
<span class="nc" id="L722">			handleException(ex, true);</span>
<span class="nc" id="L723">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
<span class="nc" id="L724">		} catch (final Exception ex) {</span>
<span class="nc" id="L725">			handleException(ex, true);</span>
<span class="nc" id="L726">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L728">			methodFinish();</span>
		}
	}

	public CFEventCollection[] getEventsForWorkResources(Collection workResourceIDs, Date dtStart, Date dtEnd) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L733">		methodStart(&quot;getEventsForWorkResources&quot;, workResourceIDs, dtStart, dtEnd);</span>
		try {
<span class="nc" id="L735">			return CFEventCollection.convertListGroup(m_scheduleAccessManager.getEventsForWorkResources(workResourceIDs, dtStart, dtEnd));</span>
<span class="nc" id="L736">		} catch (final BbmFinderException ex) {</span>
<span class="nc" id="L737">			handleException(ex, true);</span>
<span class="nc" id="L738">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
<span class="nc" id="L739">		} catch (final Exception ex) {</span>
<span class="nc" id="L740">			handleException(ex, true);</span>
<span class="nc" id="L741">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L743">			methodFinish();</span>
		}
	}

	public CFLearningAssignment[] getLearningAndCoachingAssignmentsForWorkResource(Collection workResourceIDs, Date dtStart, Date dtEnd) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L748">		methodStart(&quot;getLearningAssignmentsForWorkResource&quot;, workResourceIDs, dtStart, dtEnd);</span>
		try {
			CFLearningAssignment[] retVal;

<span class="nc" id="L752">			final Collection coll = this.m_bbmELearningBridge.getLearningAssignmentsForWorkResourceWithFSAttributes(workResourceIDs, dtStart, dtEnd);</span>
<span class="nc" id="L753">			final Collection colc = this.m_bbmCoachingBridge.getCoachingAssignmentsForWorkResource(workResourceIDs, dtStart, dtEnd);</span>
<span class="nc" id="L754">			int returnSize = 0;</span>
<span class="nc bnc" id="L755" title="All 2 branches missed.">			returnSize += coll != null ? coll.size() : 0;</span>
<span class="nc bnc" id="L756" title="All 2 branches missed.">			returnSize += colc != null ? colc.size() : 0;</span>
<span class="nc bnc" id="L757" title="All 2 branches missed.">			if (returnSize &gt; 0) {</span>
<span class="nc" id="L758">				retVal = new CFLearningAssignment[returnSize];</span>
<span class="nc" id="L759">				int i = 0;</span>
<span class="nc bnc" id="L760" title="All 2 branches missed.">				if (coll != null) {</span>
<span class="nc" id="L761">					final Iterator iter = coll.iterator();</span>
<span class="nc bnc" id="L762" title="All 2 branches missed.">					for (; iter.hasNext(); ) {</span>
<span class="nc" id="L763">						final LearningAssignmentInt assign = (LearningAssignmentInt) iter.next();</span>
<span class="nc" id="L764">						final CFLearningAssignment cfl = new CFLearningAssignment();</span>
<span class="nc" id="L765">						cfl.isCoaching = false;</span>
<span class="nc bnc" id="L766" title="All 2 branches missed.">						if (assign.getID() == null) {</span>
<span class="nc" id="L767">							cfl.id = new ID(0);</span>
						} else {
<span class="nc" id="L769">							cfl.id = assign.getID();</span>
						}
<span class="nc" id="L771">						cfl.workResourceID = assign.getWorkResourceID();</span>
<span class="nc" id="L772">						cfl.length = assign.getLessonDuration();</span>
<span class="nc" id="L773">						cfl.lessonID = assign.getLessonID();</span>
<span class="nc" id="L774">						cfl.lessonName = assign.getLessonName();</span>
<span class="nc" id="L775">						cfl.timeToScheduleThisWeek = assign.getTimeToScheduleThisWeek();</span>
<span class="nc" id="L776">						cfl.maximumSessionLength = assign.getMaximumSessionLength();</span>
<span class="nc" id="L777">						cfl.status = assign.getStatus();</span>
						// Corba layer has problem handling NULL pointer
<span class="nc bnc" id="L779" title="All 2 branches missed.">						if (assign.getDueDate() == null) {</span>
<span class="nc" id="L780">							cfl.due = new Date(0);</span>
						} else {
<span class="nc" id="L782">							cfl.due = assign.getDueDate();</span>
						}
<span class="nc" id="L784">						cfl.available = assign.getAvailableDate();</span>
<span class="nc" id="L785">						cfl.statusDate = assign.getStatusDate();</span>
<span class="nc" id="L786">						cfl.priority = assign.getPriority();</span>
<span class="nc" id="L787">						retVal[i++] = cfl;</span>
<span class="nc" id="L788">					}</span>
				}
<span class="nc bnc" id="L790" title="All 2 branches missed.">				if (colc != null) {</span>
<span class="nc" id="L791">					final Iterator iter = colc.iterator();</span>
<span class="nc bnc" id="L792" title="All 2 branches missed.">					for (; iter.hasNext(); ) {</span>
<span class="nc" id="L793">						final CoachingAssignmentInt assign = (CoachingAssignmentInt) iter.next();</span>
<span class="nc" id="L794">						final CFLearningAssignment cfl = new CFLearningAssignment();</span>
<span class="nc" id="L795">						cfl.isCoaching = true;</span>
<span class="nc bnc" id="L796" title="All 2 branches missed.">						if (assign.getID() == null) {</span>
<span class="nc" id="L797">							cfl.id = new ID(0);</span>
						} else {
<span class="nc" id="L799">							cfl.id = assign.getID();</span>
						}
<span class="nc" id="L801">						cfl.workResourceID = assign.getWorkResourceID();</span>
<span class="nc" id="L802">						cfl.length = assign.getDuration();</span>
<span class="nc" id="L803">						cfl.lessonID = assign.getCoachingSessionID();</span>
<span class="nc" id="L804">						cfl.lessonName = assign.getDescription();</span>
<span class="nc" id="L805">						cfl.timeToScheduleThisWeek = assign.getTimeToScheduleThisWeek();</span>
<span class="nc" id="L806">						cfl.maximumSessionLength = assign.getMaximumSessionLength();</span>
						// cfl.status = assign.getStatus();
						// Corba layer has problem handling NULL pointer
<span class="nc bnc" id="L809" title="All 2 branches missed.">						if (assign.getDueDate() == null) {</span>
<span class="nc" id="L810">							cfl.due = new Date(0);</span>
						} else {
<span class="nc" id="L812">							cfl.due = assign.getDueDate();</span>
						}
<span class="nc" id="L814">						cfl.available = assign.getAvailableDate();</span>
<span class="nc" id="L815">						cfl.statusDate = new Date();</span>
						// cfl.priority = assign.getPriority();
<span class="nc" id="L817">						retVal[i++] = cfl;</span>
<span class="nc" id="L818">					}</span>
				}
<span class="nc" id="L820">			} else {</span>
<span class="nc" id="L821">				return new CFLearningAssignment[0];</span>
			}
<span class="nc" id="L823">			return retVal;</span>

<span class="nc" id="L825">		} catch (final Exception ex) {</span>
<span class="nc" id="L826">			handleException(ex, true);</span>
<span class="nc" id="L827">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L829">			methodFinish();</span>
		}
	}

	/**
	 * @param lessonIDs
	 * @throws RemoteException
	 * @throws CorbaFacadeException
	 */
	public HashMap getFloatingEventIDsForLesson(Collection workResourceIDs, Collection lessonIDs) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L839">		methodStart(&quot;getFloatingEventIDsForLesson&quot;, lessonIDs);</span>
		try {
<span class="nc" id="L841">			return this.m_bbmELearningBridge.getFloatingEventIDsForLesson(workResourceIDs, lessonIDs);</span>
<span class="nc" id="L842">		} catch (final Exception ex) {</span>
<span class="nc" id="L843">			handleException(ex, true);</span>
<span class="nc" id="L844">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L846">			methodFinish();</span>
		}

	}

	public HashMap getFloatingEventIDsForCoachingSession(Collection workResourceIDs, Collection coachingSessionIDs) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L852">		methodStart(&quot;getFloatingEventIDsForCoachingSession&quot;, coachingSessionIDs);</span>
		try {
<span class="nc" id="L854">			return this.m_bbmCoachingBridge.getFloatingEventIDsForCoachingSession(workResourceIDs, coachingSessionIDs);</span>
<span class="nc" id="L855">		} catch (final Exception ex) {</span>
<span class="nc" id="L856">			handleException(ex, true);</span>
<span class="nc" id="L857">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L859">			methodFinish();</span>
		}
	}

	public void saveLearningOrCoachingAssignment(CFLearningAssignment cfl, Collection floatingEventTemplateIDs) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L864">		methodStart(&quot;saveLearningOrCoachingAssignment&quot;, cfl, floatingEventTemplateIDs);</span>
		try {
<span class="nc bnc" id="L866" title="All 2 branches missed.">			if (cfl.isCoaching()) {</span>
<span class="nc" id="L867">				m_bbmCoachingBridge.saveCoachingAssignment(cfl.id, cfl.workResourceID, cfl.lessonID, cfl.timeToScheduleThisWeek, cfl.maximumSessionLength, floatingEventTemplateIDs);</span>
			} else {
<span class="nc" id="L869">				final LearningAssignmentInt assign = this.m_bbmELearningBridge.createLearningAssignment();</span>
<span class="nc" id="L870">				assign.setID(cfl.id);</span>
<span class="nc" id="L871">				assign.setWorkResourceID(cfl.workResourceID);</span>
<span class="nc" id="L872">				assign.setLessonID(cfl.lessonID);</span>
<span class="nc" id="L873">				assign.setTimeToScheduleThisWeek(cfl.timeToScheduleThisWeek);</span>
<span class="nc" id="L874">				assign.setMaximumSessionLength(cfl.maximumSessionLength);</span>
<span class="nc" id="L875">				this.m_bbmELearningBridge.saveLearningAssignment(assign, floatingEventTemplateIDs);</span>
			}
<span class="nc" id="L877">		} catch (final MultiUserException ex) {</span>
<span class="nc" id="L878">			handleException(ex, true);</span>
<span class="nc" id="L879">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_MULTI_USER_UPDATE_EXCEPTION);</span>
<span class="nc" id="L880">		} catch (final Exception ex) {</span>
<span class="nc" id="L881">			handleException(ex, true);</span>
<span class="nc" id="L882">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L884">			methodFinish();</span>
<span class="nc" id="L885">		}</span>
<span class="nc" id="L886">	}</span>

	public CFEventCollection[] getEventsForWorkResourcesByType(int eventTypeMask, Collection workResourceIDs, Date dtStart, Date dtEnd) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L889">		methodStart(&quot;getEventsForWorkResourcesByType&quot;, new Integer(eventTypeMask), workResourceIDs, dtStart, dtEnd);</span>
		try {
<span class="nc" id="L891">			return CFEventCollection.convertListGroup(m_scheduleAccessManager.getEventsForWorkResourcesByType(eventTypeMask, workResourceIDs, dtStart, dtEnd));</span>
<span class="nc" id="L892">		} catch (final BbmFinderException ex) {</span>
<span class="nc" id="L893">			handleException(ex, true);</span>
<span class="nc" id="L894">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
<span class="nc" id="L895">		} catch (final Exception ex) {</span>
<span class="nc" id="L896">			handleException(ex, true);</span>
<span class="nc" id="L897">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L899">			methodFinish();</span>
		}
	}

	public CFEventTemplateCollection[] getEventTemplatesForWorkResourceIDs(Collection workResourceIDs, Date dtStart, Date dtEnd) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L904">		methodStart(&quot;getEventTemplatesForWorkResourceIDs&quot;, workResourceIDs, dtStart, dtEnd);</span>
		try {
<span class="nc" id="L906">			return CFEventTemplateCollection.convertListGroup(m_scheduleAccessManager.getEventTemplatesForWorkResourceIDs(workResourceIDs, dtStart, dtEnd));</span>
<span class="nc" id="L907">		} catch (final BbmFinderException ex) {</span>
<span class="nc" id="L908">			handleException(ex, true);</span>
<span class="nc" id="L909">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
<span class="nc" id="L910">		} catch (final Exception ex) {</span>
<span class="nc" id="L911">			handleException(ex, true);</span>
<span class="nc" id="L912">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L914">			methodFinish();</span>
		}
	}

	/**
	 * Returns a list (an ordered collection) of collections of calendar event
	 * assignments for multiple event templates. For each calendar event
	 * template ID in the method argument, there will be a corresponding
	 * collection of calendar event assignments in the return collection -
	 * maybe, empty, if there is no assignment associated with that ID. The
	 * returned collections of events will be in the same order as the calendar
	 * event template IDs in the method argument.
	 *
	 * @param cidEventTemplates IDs of the calendar event templates
	 * @return collection of ArrayLists of calendar event assignments
	 * @throws RemoteException
	 * @throws CorbaFacadeException if there is an error while executing DB query
	 */
	public CFEventCollection[] getCalendarEventAssignmentsForCalendarEventTemplate(Collection cidEventTemplates) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L933">		methodStart(&quot;getCalendarEventAssignmentsForCalendarEventTemplate&quot;, cidEventTemplates);</span>
		try {
<span class="nc bnc" id="L935" title="All 4 branches missed.">			if ((cidEventTemplates == null) || cidEventTemplates.isEmpty()) {</span>
<span class="nc" id="L936">				return null;</span>
			}
<span class="nc" id="L938">			return CFEventCollection.convertListGroup(m_scheduleAccessManager.getCalendarEventAssignmentsForCalendarEventTemplate(cidEventTemplates));</span>
<span class="nc" id="L939">		} catch (final BbmFinderException ex) {</span>
<span class="nc" id="L940">			handleException(ex, true);</span>
<span class="nc" id="L941">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
<span class="nc" id="L942">		} catch (final Exception ex) {</span>
<span class="nc" id="L943">			handleException(ex, true);</span>
<span class="nc" id="L944">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L946">			methodFinish();</span>
		}
	}

	public void updateShiftAssignment(CFShiftAssignment cfShiftAssignment) throws RemoteException, CorbaFacadeException, CFMultiUserException, CFBbmScheduleConflictException {
<span class="nc" id="L951">		methodStart(&quot;updateShiftAssignment&quot;, cfShiftAssignment);</span>
		try {
<span class="nc" id="L953">			m_scheduleAccessManager.updateShiftAssignment(CFShiftAssignment.convert(cfShiftAssignment));</span>
<span class="nc" id="L954">		} catch (final MultiUserException ex) {</span>
<span class="nc" id="L955">			handleException(ex, true);</span>
<span class="nc" id="L956">			throw CFMultiUserException.convert(ex);</span>
<span class="nc" id="L957">		} catch (final BbmScheduleConflictException ex) {</span>
<span class="nc" id="L958">			handleException(ex, true);</span>
<span class="nc" id="L959">			throw CFBbmScheduleConflictException.convert(ex);</span>
<span class="nc" id="L960">		} catch (final BbmUpdateException ex) {</span>
<span class="nc" id="L961">			handleException(ex, true);</span>
<span class="nc" id="L962">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_UPDATE_EXCEPTION);</span>
<span class="nc" id="L963">		} catch (final Exception ex) {</span>
<span class="nc" id="L964">			handleException(ex, true);</span>
<span class="nc" id="L965">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L967">			methodFinish();</span>
<span class="nc" id="L968">		}</span>
<span class="nc" id="L969">	}</span>

	public void publishSchedule(Collection workResourceIDs, Date dtStart, Date dtEnd) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L972">		methodStart(&quot;publishSchedule&quot;, workResourceIDs, dtStart, dtEnd);</span>
		try {
<span class="nc" id="L974">			m_scheduleAccessManager.publishSchedule(workResourceIDs, dtStart, dtEnd);</span>
<span class="nc" id="L975">		} catch (final BbmSchedulePublishingException ex) {</span>
<span class="nc" id="L976">			handleException(ex, true);</span>
<span class="nc" id="L977">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_SCHEDULE_UPDATE_EXCEPTION);</span>
<span class="nc" id="L978">		} catch (final Exception ex) {</span>
<span class="nc" id="L979">			handleException(ex, true);</span>
<span class="nc" id="L980">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L982">			methodFinish();</span>
<span class="nc" id="L983">		}</span>
<span class="nc" id="L984">	}</span>

	public void updatePublishedSchedule(Collection workResourceIDs, Date dtStart, Date dtEnd) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L987">		methodStart(&quot;updatePublishedSchedule&quot;, workResourceIDs, dtStart, dtEnd);</span>
		try {
<span class="nc" id="L989">			m_scheduleAccessManager.updatePublishedSchedule(workResourceIDs, dtStart, dtEnd);</span>
<span class="nc" id="L990">		} catch (final BbmSchedulePublishingException ex) {</span>
<span class="nc" id="L991">			handleException(ex, true);</span>
<span class="nc" id="L992">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_SCHEDULE_UPDATE_EXCEPTION);</span>
<span class="nc" id="L993">		} catch (final Exception ex) {</span>
<span class="nc" id="L994">			handleException(ex, true);</span>
<span class="nc" id="L995">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L997">			methodFinish();</span>
<span class="nc" id="L998">		}</span>
<span class="nc" id="L999">	}</span>

	public void unPublishSchedule(Collection workResourceIDs, Date dtStart, Date dtEnd) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1002">		methodStart(&quot;unPublishSchedule&quot;, workResourceIDs, dtStart, dtEnd);</span>
		try {
<span class="nc" id="L1004">			m_scheduleAccessManager.unPublishSchedule(workResourceIDs, dtStart, dtEnd);</span>
<span class="nc" id="L1005">		} catch (final BbmSchedulePublishingException ex) {</span>
<span class="nc" id="L1006">			handleException(ex, true);</span>
<span class="nc" id="L1007">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_SCHEDULE_UPDATE_EXCEPTION);</span>
<span class="nc" id="L1008">		} catch (final Exception ex) {</span>
<span class="nc" id="L1009">			handleException(ex, true);</span>
<span class="nc" id="L1010">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1012">			methodFinish();</span>
<span class="nc" id="L1013">		}</span>
<span class="nc" id="L1014">	}</span>

	public void revertToPublishedSchedule(Collection workResourceIDs, Date dtStart, Date dtEnd) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1017">		methodStart(&quot;revertToPublishedSchedule&quot;, workResourceIDs, dtStart, dtEnd);</span>
		try {
<span class="nc" id="L1019">			m_scheduleAccessManager.revertToPublishedSchedule(workResourceIDs, dtStart, dtEnd);</span>
<span class="nc" id="L1020">		} catch (final BbmSchedulePublishingException ex) {</span>
<span class="nc" id="L1021">			handleException(ex, true);</span>
<span class="nc" id="L1022">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_SCHEDULE_UPDATE_EXCEPTION);</span>
<span class="nc" id="L1023">		} catch (final Exception ex) {</span>
<span class="nc" id="L1024">			handleException(ex, true);</span>
<span class="nc" id="L1025">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1027">			methodFinish();</span>
<span class="nc" id="L1028">		}</span>
<span class="nc" id="L1029">	}</span>

	public Collection getWorkResourcesOutOfSyncWithPublishedSchedule(Collection workResourceIDs, Date dtStart, Date dtEnd) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1032">		methodStart(&quot;getWorkResourcesOutOfSyncWithPublishedSchedule&quot;, workResourceIDs, dtStart, dtEnd);</span>
		try {
<span class="nc" id="L1034">			return m_scheduleAccessManager.getWorkResourcesOutOfSyncWithPublishedSchedule(workResourceIDs, dtStart, dtEnd);</span>
<span class="nc" id="L1035">		} catch (final BbmSchedulePublishingException ex) {</span>
<span class="nc" id="L1036">			handleException(ex, true);</span>
<span class="nc" id="L1037">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_SCHEDULE_UPDATE_EXCEPTION);</span>
<span class="nc" id="L1038">		} catch (final Exception ex) {</span>
<span class="nc" id="L1039">			handleException(ex, true);</span>
<span class="nc" id="L1040">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1042">			methodFinish();</span>
		}
	}

	public void lockEvents(int eventTypeMask, Collection workResourceIDs, Date dtStart, Date dtEnd) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1047">		methodStart(&quot;lockEvents&quot;, new Integer(eventTypeMask), workResourceIDs, dtStart, dtEnd);</span>
		try {
<span class="nc" id="L1049">			m_scheduleAccessManager.lockEvents(eventTypeMask, workResourceIDs, dtStart, dtEnd);</span>
<span class="nc" id="L1050">		} catch (final BbmUpdateException ex) {</span>
<span class="nc" id="L1051">			handleException(ex, true);</span>
<span class="nc" id="L1052">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_UPDATE_EXCEPTION);</span>
<span class="nc" id="L1053">		} catch (final Exception ex) {</span>
<span class="nc" id="L1054">			handleException(ex, true);</span>
<span class="nc" id="L1055">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1057">			methodFinish();</span>
<span class="nc" id="L1058">		}</span>
<span class="nc" id="L1059">	}</span>

	public void unlockEvents(int eventTypeMask, Collection workResourceIDs, Date dtStart, Date dtEnd) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1062">		methodStart(&quot;unlockEvents&quot;, new Integer(eventTypeMask), workResourceIDs, dtStart, dtEnd);</span>
		try {
<span class="nc" id="L1064">			m_scheduleAccessManager.unlockEvents(eventTypeMask, workResourceIDs, dtStart, dtEnd);</span>
<span class="nc" id="L1065">		} catch (final BbmUpdateException ex) {</span>
<span class="nc" id="L1066">			handleException(ex, true);</span>
<span class="nc" id="L1067">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_UPDATE_EXCEPTION);</span>
<span class="nc" id="L1068">		} catch (final Exception ex) {</span>
<span class="nc" id="L1069">			handleException(ex, true);</span>
<span class="nc" id="L1070">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1072">			methodFinish();</span>
<span class="nc" id="L1073">		}</span>
<span class="nc" id="L1074">	}</span>

	public CFBbmScheduleConflict[] getConflictsForCalendarEventTemplate(CFCalendarEventTemplate cfEventTemplate) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1077">		methodStart(&quot;getConflictsForCalendarEventTemplate&quot;, cfEventTemplate);</span>
		try {
<span class="nc" id="L1079">			return CFBbmScheduleConflict.convert(m_scheduleAccessManager.getConflictsForCalendarEventTemplate(CFCalendarEventTemplate.convert(cfEventTemplate)));</span>
<span class="nc" id="L1080">		} catch (final BbmFinderException ex) {</span>
<span class="nc" id="L1081">			handleException(ex, true);</span>
<span class="nc" id="L1082">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
<span class="nc" id="L1083">		} catch (final Exception ex) {</span>
<span class="nc" id="L1084">			handleException(ex, true);</span>
<span class="nc" id="L1085">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1087">			methodFinish();</span>
		}
	}

    /*
     * public Collection getConflictsForNewCalendarEventTemplate(
     * CFCalendarEventTemplate cfEventTemplate) throws RemoteException,
     * CorbaFacadeException {
     * methodStart(&quot;getConflictsForNewCalendarEventTemplate&quot;, cfEventTemplate);
     * try { ScheduleAccessManager mgr =
     * BbmManagerFactory.getScheduleAccessManager(); Collection col =
     * mgr.getConflictsForNewCalendarEventTemplate
     * (CFCalendarEventTemplate.convert(cfEventTemplate)); if (col == null ||
     * col.isEmpty()) return col; ArrayList returnList = new
     * ArrayList(col.size()); for (Iterator i = col.iterator(); i.hasNext(); ) {
     * returnList
     * .add(CFBbmScheduleConflict.convert((BbmScheduleConflict)i.next())); }
     * return returnList; } catch(BbmFinderException ex) { handleException(ex,
     * true); throw new CorbaFacadeException( ex.getMessage(),
     * CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION ); } catch(Exception ex) {
     * handleException(ex, true); throw new CorbaFacadeException(
     * ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION ); } finally
     * { methodFinish(); } }
     *
     * public Collection getConflictsForUpdatedCalendarEventTemplate(
     * CFCalendarEventTemplate cfEventTemplate) throws RemoteException,
     * CorbaFacadeException {
     * methodStart(&quot;getConflictsForUpdatedCalendarEventTemplate&quot;,
     * cfEventTemplate); try { ScheduleAccessManager mgr =
     * BbmManagerFactory.getScheduleAccessManager(); Collection col =
     * mgr.getConflictsForUpdatedCalendarEventTemplate
     * (CFCalendarEventTemplate.convert(cfEventTemplate)); if (col == null ||
     * col.isEmpty()) return col; ArrayList returnList = new
     * ArrayList(col.size()); for (Iterator i = col.iterator(); i.hasNext(); ) {
     * returnList
     * .add(CFBbmScheduleConflict.convert((BbmScheduleConflict)i.next())); }
     * return returnList; } catch(BbmFinderException ex) { handleException(ex,
     * true); throw new CorbaFacadeException( ex.getMessage(),
     * CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION ); } catch(Exception ex) {
     * handleException(ex, true); throw new CorbaFacadeException(
     * ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION ); } finally
     * { methodFinish(); } }
     */

	public Collection getConflictMessagesWithLocaleStrings(CFBbmScheduleConflict[] cfListConflicts, String langLocaleID, String regionalLocaleID, String timeZoneID) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1132">		methodStart(&quot;getConflictMessagesWithLocaleStrings&quot;, cfListConflicts, langLocaleID, regionalLocaleID, timeZoneID);</span>
		try {
<span class="nc" id="L1134">			return m_scheduleAccessManager.getConflictMessagesWithLocaleStrings(CFBbmScheduleConflict.convert(cfListConflicts), langLocaleID, regionalLocaleID, timeZoneID);</span>
<span class="nc" id="L1135">		} catch (final Exception ex) {</span>
<span class="nc" id="L1136">			handleException(ex, true);</span>
<span class="nc" id="L1137">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1139">			methodFinish();</span>
		}
	}

	// ================ LSG Manager ====================
	@SuppressWarnings(&quot;deprecation&quot;)
	public CFLsgAgeBucket[] getAgeBucketsForSPQueue(ID spQueueShortID) throws RemoteException, CorbaFacadeException, CoreEJBCreateException, CoreFinderException, ClassNotFoundException, InstantiationException, IllegalAccessException {
		try {
<span class="nc bnc" id="L1147" title="All 2 branches missed.">			if (m_campaignManager == null) {</span>
<span class="nc" id="L1148">				throw new CorbaFacadeException(&quot;CampaignManager is null&quot;, CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
			}
<span class="nc" id="L1150">			final SPQueue spQueue = m_campaignManager.getSPQueue(spQueueShortID);</span>
<span class="nc bnc" id="L1151" title="All 2 branches missed.">			if (spQueue == null) {</span>
<span class="nc" id="L1152">				throw new CorbaFacadeException(&quot;SpQueue is null&quot;, CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
			}
<span class="nc" id="L1154">			final SchedulingPeriod schedulingPeriod = m_campaignManager.getSchedulingPeriodByID(spQueue.getSpID());</span>
<span class="nc bnc" id="L1155" title="All 2 branches missed.">			if (schedulingPeriod == null) {</span>
<span class="nc" id="L1156">				throw new CorbaFacadeException(&quot;schedulingPeriod is null&quot;, CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
			}
<span class="nc" id="L1158">			final TimeZone timeZone = m_campaignManager.getTimeZoneByCampaignID(schedulingPeriod.getCampaignID());</span>
<span class="nc" id="L1159">			return CFLsgAgeBucket.convertToCFLSGAgeBucket(getLSInfoExtractor().getAgeBucketsForSPQueue(spQueue.getDEID(), timeZone, schedulingPeriod.getStartTime()));</span>
<span class="nc" id="L1160">		} catch (final BbmFinderException ex) {</span>
<span class="nc" id="L1161">			handleException(ex, true);</span>
<span class="nc" id="L1162">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
		}
	}

	public CFLSGAgeBucketHashMap[] getAgeBucketsForSPQueuesInSP(ID spID) throws RemoteException, CorbaFacadeException, CoreEJBCreateException, CoreFinderException, ClassNotFoundException, InstantiationException, IllegalAccessException {
		try {
<span class="nc bnc" id="L1168" title="All 2 branches missed.">			if (m_campaignManager == null) {</span>
<span class="nc" id="L1169">				throw new CorbaFacadeException(&quot;CampaignManager is null&quot;, CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
			}
<span class="nc" id="L1171">			final SchedulingPeriod schedulingPeriod = m_campaignManager.getSchedulingPeriodByID(spID);</span>
<span class="nc bnc" id="L1172" title="All 2 branches missed.">			if (schedulingPeriod == null) {</span>
<span class="nc" id="L1173">				throw new CorbaFacadeException(&quot;schedulingPeriod is null&quot;, CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
			}
<span class="nc" id="L1175">			final TimeZone timeZone = m_campaignManager.getTimeZoneByCampaignID(schedulingPeriod.getCampaignID());</span>
<span class="nc" id="L1176">			Collection&lt;SPQueue&gt; spQueues = m_campaignManager.getSPQueuesBySPID(spID);</span>
<span class="nc" id="L1177">			return CFLSGAgeBucketHashMap.convertToCFAgeBucketHashMap(getLSInfoExtractor().getAgeBucketsForSPQueuesInSP(spID, timeZone, schedulingPeriod.getStartTime()), spQueues);</span>
<span class="nc" id="L1178">		} catch (final BbmFinderException ex) {</span>
<span class="nc" id="L1179">			handleException(ex, true);</span>
<span class="nc" id="L1180">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
		}
	}

	private LSGInfoExtractor getLSInfoExtractor() throws CoreEJBCreateException, CoreFinderException, RemoteException, ClassNotFoundException, InstantiationException, IllegalAccessException {
<span class="nc bnc" id="L1185" title="All 2 branches missed.">		if (m_lsgManagerExtractor == null) {</span>
<span class="nc" id="L1186">			final GCRManager m_gcrManager = CoreManagerFactory.getGCRManagerRemote(m_isWhatIf);</span>
<span class="nc" id="L1187">			final String gcrType = &quot;OPERATIONS_LSG_MANAGER&quot;;</span>
<span class="nc" id="L1188">			final Collection entries = m_gcrManager.getGCREntryOfType(gcrType);</span>

<span class="nc" id="L1190">			final Class clazz = Class.forName(((GCREntry) (entries.iterator().next())).getHook());</span>
<span class="nc" id="L1191">			m_lsgManagerExtractor = (LSGInfoExtractor) clazz.newInstance();</span>
		}
<span class="nc" id="L1193">		return m_lsgManagerExtractor;</span>
	}

	// ================ Activity Manager ================

	public ID createActivity(CFActivity cfActivity) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1199">		return createActivity(cfActivity, null);</span>
	}

	public ID createActivity(CFActivity cfActivity, Collection mediasIds) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1203">		methodStart(&quot;createActivity&quot;, cfActivity, mediasIds);</span>
		try {
<span class="nc" id="L1205">			return m_activityManager.createActivity(CFActivity.convert(cfActivity), mediasIds);</span>
<span class="nc" id="L1206">		} catch (final Exception ex) {</span>
<span class="nc" id="L1207">			handleException(ex, true);</span>
<span class="nc" id="L1208">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1210">			methodFinish();</span>
		}
	}

	public ID createActivity(CFActivity cfActivity, Collection mediasIds, CFSystemType cfExternalSystemType) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1215">		methodStart(&quot;createActivity&quot;, cfActivity, mediasIds, cfExternalSystemType);</span>
		try {
<span class="nc" id="L1217">			return m_activityManager.createActivity(CFActivity.convert(cfActivity), mediasIds, CFSystemType.convert(cfExternalSystemType));</span>
<span class="nc" id="L1218">		} catch (final Exception ex) {</span>
<span class="nc" id="L1219">			handleException(ex, true);</span>
<span class="nc" id="L1220">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1222">			methodFinish();</span>
		}
	}

	public ID createActivityCategory(CFActivityCategory cfActivityCategory) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1227">		methodStart(&quot;createActivityCategory&quot;, cfActivityCategory);</span>
		try {
<span class="nc" id="L1229">			return m_activityManager.createActivityCategory(CFActivityCategory.convert(cfActivityCategory));</span>
<span class="nc" id="L1230">		} catch (final Exception ex) {</span>
<span class="nc" id="L1231">			handleException(ex, true);</span>
<span class="nc" id="L1232">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1234">			methodFinish();</span>
		}
	}

	public ID createActivityMedia(CFActivityMedia cfActivityMedia) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1239">		methodStart(&quot;createActivityMedia&quot;, cfActivityMedia);</span>
		try {
<span class="nc" id="L1241">			return m_activityManager.createActivityMedia(CFActivityMedia.convert(cfActivityMedia));</span>
<span class="nc" id="L1242">		} catch (final Exception ex) {</span>
<span class="nc" id="L1243">			handleException(ex, true);</span>
<span class="nc" id="L1244">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1246">			methodFinish();</span>
		}
	}

	public Collection createActivityMedia(ID activityId, Collection mediaIds) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1251">		methodStart(&quot;createActivityMedia&quot;, activityId, mediaIds);</span>
		try {
<span class="nc" id="L1253">			return m_activityManager.createActivityMedia(activityId, mediaIds);</span>
<span class="nc" id="L1254">		} catch (final Exception ex) {</span>
<span class="nc" id="L1255">			handleException(ex, true);</span>
<span class="nc" id="L1256">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1258">			methodFinish();</span>
		}
	}

	public CFActivity findActivityById(ID id) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1263">		methodStart(&quot;findActivityById&quot;, id);</span>
		try {
<span class="nc" id="L1265">			return CFActivity.convert(m_activityManager.findActivityById(id));</span>
<span class="nc" id="L1266">		} catch (final Exception ex) {</span>
<span class="nc" id="L1267">			handleException(ex, true);</span>
<span class="nc" id="L1268">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1270">			methodFinish();</span>
		}
	}

	public CFActivity[] findOrganizationActivities(ID organizationId, CFActivityFilter cfActivityFilter) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1275">		final ArrayList ids = new ArrayList(1);</span>
<span class="nc" id="L1276">		ids.add(organizationId);</span>
<span class="nc" id="L1277">		return findOrganizationActivities(ids, cfActivityFilter, false);</span>
	}

	public CFActivity[] findOrganizationActivities(Collection orgIds, boolean findParentOrgs) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1281">		return findOrganizationActivities(orgIds, null, findParentOrgs);</span>
	}

	public CFActivity[] findOrganizationActivities(Collection orgIds, CFActivityFilter cfActivityFilter, boolean findParentOrgs) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1285">		methodStart(&quot;findOrganizationActivities&quot;, orgIds, cfActivityFilter, new Boolean(findParentOrgs));</span>
		try {
<span class="nc" id="L1287">			return CFActivity.convert(m_activityManager.findOrganizationActivities(orgIds, CFActivityFilter.convert(cfActivityFilter), findParentOrgs));</span>
<span class="nc" id="L1288">		} catch (final Exception ex) {</span>
<span class="nc" id="L1289">			handleException(ex, true);</span>
<span class="nc" id="L1290">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1292">			methodFinish();</span>
		}
	}

	public CFActivity[] findActivities(Collection ids) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1297">		methodStart(&quot;findActivities&quot;, ids);</span>
		try {
<span class="nc" id="L1299">			return CFActivity.convert(m_activityManager.findActivities(ids));</span>
<span class="nc" id="L1300">		} catch (final Exception ex) {</span>
<span class="nc" id="L1301">			handleException(ex, true);</span>
<span class="nc" id="L1302">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1304">			methodFinish();</span>
		}
	}

	public CFActivity[] findActivities(CFActivityFilter cfActivityFilter) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1309">		methodStart(&quot;findActivities&quot;, cfActivityFilter);</span>
		try {
<span class="nc" id="L1311">			return CFActivity.convert(m_activityManager.findActivities(CFActivityFilter.convert(cfActivityFilter)));</span>
<span class="nc" id="L1312">		} catch (final Exception ex) {</span>
<span class="nc" id="L1313">			handleException(ex, true);</span>
<span class="nc" id="L1314">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1316">			methodFinish();</span>
		}
	}

	public CFActivityCategory findActivityCategoryById(ID id) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1321">		methodStart(&quot;findActivityCategoryById&quot;, id);</span>
		try {
<span class="nc" id="L1323">			return CFActivityCategory.convert(m_activityManager.findActivityCategoryById(id));</span>
<span class="nc" id="L1324">		} catch (final Exception ex) {</span>
<span class="nc" id="L1325">			handleException(ex, true);</span>
<span class="nc" id="L1326">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1328">			methodFinish();</span>
		}
	}

	public CFActivityCategory[] findOrganizationActivityCategories(Collection orgIdCol, CFActivityCategoryFilter cfActivityCategoryFilter, boolean needParent) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1333">		methodStart(&quot;findOrganizationActivityCategories&quot;, orgIdCol, cfActivityCategoryFilter, new Boolean(needParent));</span>
		try {
<span class="nc" id="L1335">			return CFActivityCategory.convert(m_activityManager.findOrganizationActivityCategories(orgIdCol, CFActivityCategoryFilter.convert(cfActivityCategoryFilter), needParent));</span>
<span class="nc" id="L1336">		} catch (final Exception ex) {</span>
<span class="nc" id="L1337">			handleException(ex, true);</span>
<span class="nc" id="L1338">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1340">			methodFinish();</span>
		}
	}

	public CFActivityCategory[] findOrganizationActivityCategories(ID organizationId, CFActivityCategoryFilter cfActivityCategoryFilter) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1345">		final ArrayList orgIds = new ArrayList(1);</span>
<span class="nc" id="L1346">		orgIds.add(organizationId);</span>
<span class="nc" id="L1347">		return findOrganizationActivityCategories(orgIds, cfActivityCategoryFilter, false);</span>
	}

	public CFActivityMedia[] findMediaForActivity(ID activityId) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1351">		methodStart(&quot;findMediaForActivity&quot;, activityId);</span>
		try {
<span class="nc" id="L1353">			return CFActivityMedia.convert(m_activityManager.findMediaForActivity(activityId));</span>
<span class="nc" id="L1354">		} catch (final Exception ex) {</span>
<span class="nc" id="L1355">			handleException(ex, true);</span>
<span class="nc" id="L1356">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1358">			methodFinish();</span>
		}
	}

	public Map findMediaForActivities(Collection activityIds) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1363">		methodStart(&quot;findMediaForActivities&quot;, activityIds);</span>
		try {
<span class="nc" id="L1365">			return m_activityManager.findMediaForActivities(activityIds);</span>
<span class="nc" id="L1366">		} catch (final Exception ex) {</span>
<span class="nc" id="L1367">			handleException(ex, true);</span>
<span class="nc" id="L1368">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1370">			methodFinish();</span>
		}
	}

	public void updateActivity(CFActivity cfActivity, Collection mediaIds) throws RemoteException, CorbaFacadeException, CFMultiUserException {
<span class="nc" id="L1375">		methodStart(&quot;updateActivity&quot;, cfActivity, mediaIds);</span>
		try {
<span class="nc" id="L1377">			m_activityManager.updateActivity(CFActivity.convert(cfActivity), mediaIds);</span>
<span class="nc" id="L1378">		} catch (final MultiUserException ex) {</span>
<span class="nc" id="L1379">			handleException(ex, true);</span>
<span class="nc" id="L1380">			throw CFMultiUserException.convert(ex);</span>
<span class="nc" id="L1381">		} catch (final Exception ex) {</span>
<span class="nc" id="L1382">			handleException(ex, true);</span>
<span class="nc" id="L1383">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1385">			methodFinish();</span>
<span class="nc" id="L1386">		}</span>
<span class="nc" id="L1387">	}</span>

	public void updateActivity(CFActivity cfActivity) throws RemoteException, CorbaFacadeException, CFMultiUserException {
<span class="nc" id="L1390">		methodStart(&quot;updateActivity&quot;, cfActivity);</span>
		try {
<span class="nc" id="L1392">			m_activityManager.updateActivity(CFActivity.convert(cfActivity));</span>
<span class="nc" id="L1393">		} catch (final MultiUserException ex) {</span>
<span class="nc" id="L1394">			handleException(ex, true);</span>
<span class="nc" id="L1395">			throw CFMultiUserException.convert(ex);</span>
<span class="nc" id="L1396">		} catch (final Exception ex) {</span>
<span class="nc" id="L1397">			handleException(ex, true);</span>
<span class="nc" id="L1398">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1400">			methodFinish();</span>
<span class="nc" id="L1401">		}</span>
<span class="nc" id="L1402">	}</span>

	public void updateActivityCategory(CFActivityCategory cfActivityCategory) throws RemoteException, CorbaFacadeException, CFMultiUserException {
<span class="nc" id="L1405">		methodStart(&quot;updateActivity&quot;, cfActivityCategory);</span>
		try {
<span class="nc" id="L1407">			m_activityManager.updateActivityCategory(CFActivityCategory.convert(cfActivityCategory));</span>
<span class="nc" id="L1408">		} catch (final MultiUserException ex) {</span>
<span class="nc" id="L1409">			handleException(ex, true);</span>
<span class="nc" id="L1410">			throw CFMultiUserException.convert(ex);</span>
<span class="nc" id="L1411">		} catch (final Exception ex) {</span>
<span class="nc" id="L1412">			handleException(ex, true);</span>
<span class="nc" id="L1413">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1415">			methodFinish();</span>
<span class="nc" id="L1416">		}</span>
<span class="nc" id="L1417">	}</span>

	// ================ User Manager ================
	private User getUser(CFUser cfuser) throws Exception {
<span class="nc" id="L1421">		return this.m_userManager.getUserByID(cfuser.id);</span>
	}

	public void addScope(CFUser cfuser, int type, ID scopeID) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1425">		methodStart(&quot;addScope&quot;, cfuser, new Integer(type), scopeID);</span>
		try {
<span class="nc" id="L1427">			final ScopeID id = new ScopeID(scopeID, (short) type);</span>
<span class="nc" id="L1428">			final ID userID = cfuser.id;</span>
<span class="nc" id="L1429">			this.m_userManager.addUserScope(userID, id);</span>
<span class="nc" id="L1430">		} catch (final Exception ex) {</span>
<span class="nc" id="L1431">			handleException(ex, true);</span>
<span class="nc" id="L1432">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1434">			methodFinish();</span>
<span class="nc" id="L1435">		}</span>
<span class="nc" id="L1436">	}</span>

	public boolean isAuthorized(CFUser cfuser, ID privilegeID) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1439">		methodStart(&quot;isAuthorized&quot;, cfuser, privilegeID);</span>
		try {
<span class="nc" id="L1441">			final User user = this.getUser(cfuser);</span>
<span class="nc" id="L1442">			return user.isAuthorized(privilegeID);</span>
<span class="nc" id="L1443">		} catch (final Exception ex) {</span>
<span class="nc" id="L1444">			handleException(ex, true);</span>
<span class="nc" id="L1445">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1447">			methodFinish();</span>
		}
	}

	public boolean isAuthorizedForOrg(CFUser cfuser, ID orgID, ID privilegeID) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1452">		methodStart(&quot;isAuthorizedForOrg&quot;, cfuser, orgID, privilegeID);</span>
		try {
<span class="nc" id="L1454">			final User user = this.getUser(cfuser);</span>
<span class="nc" id="L1455">			final ScopeID scopeID = new ScopeID(orgID, Organization.SCOPE_TYPE);</span>

<span class="nc" id="L1457">			return user.isAuthorized(privilegeID, scopeID);</span>
<span class="nc" id="L1458">		} catch (final Exception ex) {</span>
<span class="nc" id="L1459">			handleException(ex, true);</span>
<span class="nc" id="L1460">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1462">			methodFinish();</span>
		}
	}

	public boolean isAuthorizedForCampaign(CFUser cfuser, ID campaignID, ID privilegeID) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1467">		methodStart(&quot;isAuthorizedForCampaign&quot;, cfuser, campaignID, privilegeID);</span>
		try {
<span class="nc" id="L1469">			final User user = this.getUser(cfuser);</span>
<span class="nc" id="L1470">			final ScopeID scopeID = new ScopeID(campaignID, Campaign.SCOPE_TYPE);</span>

<span class="nc" id="L1472">			return user.isAuthorized(privilegeID, scopeID);</span>
<span class="nc" id="L1473">		} catch (final Exception ex) {</span>
<span class="nc" id="L1474">			handleException(ex, true);</span>
<span class="nc" id="L1475">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1477">			methodFinish();</span>
		}
	}

	public boolean isAuthorizedForSecureField(CFUser cfuser, int fieldKey, ID orgID, ID privilegeID) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1482">		methodStart(&quot;isAuthorizedForSecureField&quot;, cfuser, new Integer(fieldKey), orgID, privilegeID);</span>
		try {
<span class="nc" id="L1484">			final User user = this.getUser(cfuser);</span>
<span class="nc" id="L1485">			final ScopeID scopeID = new ScopeID(orgID, Organization.SCOPE_TYPE);</span>
<span class="nc" id="L1486">			return user.isAuthorizedForSecureField(fieldKey, scopeID, privilegeID);</span>
<span class="nc" id="L1487">		} catch (final Exception ex) {</span>
<span class="nc" id="L1488">			handleException(ex, true);</span>
<span class="nc" id="L1489">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1491">			methodFinish();</span>
		}
	}

	public CFUser getUserByName(String userName) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1496">		methodStart(&quot;getUserByName&quot;, userName);</span>
		try {
<span class="nc" id="L1498">			final User user = m_userManager.getUserByName(userName);</span>
<span class="nc" id="L1499">			return CFUser.convert(user);</span>
<span class="nc" id="L1500">		} catch (final Exception ex) {</span>
<span class="nc" id="L1501">			handleException(ex, true);</span>
<span class="nc" id="L1502">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1504">			methodFinish();</span>
		}
	}

	public void updateUser(CFUser cfUser) throws RemoteException, CorbaFacadeException, CFMultiUserException {
<span class="nc" id="L1509">		methodStart(&quot;updateUser&quot;, cfUser);</span>
		try {
			// nothing to do here, CFUser does not have
			// enough info to update
		} finally {
<span class="nc" id="L1514">			methodFinish();</span>
		}
<span class="nc" id="L1516">	}</span>

	public String generateToken(String seal) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1519">		methodStart(&quot;generateToken&quot;, seal);</span>
		try {
<span class="nc" id="L1521">			return m_userManager.generateToken(seal);</span>
<span class="nc" id="L1522">		} catch (final Exception ex) {</span>
<span class="nc" id="L1523">			handleException(ex, true);</span>
<span class="nc" id="L1524">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1526">			methodFinish();</span>
		}
	}

	public boolean validateToken(String userName, String token) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1531">		methodStart(&quot;validateToken&quot;, userName, token);</span>
		try {
<span class="nc" id="L1533">			return m_userManager.validateToken(userName, token);</span>
<span class="nc" id="L1534">		} catch (final Exception ex) {</span>
<span class="nc" id="L1535">			handleException(ex, true);</span>
<span class="nc" id="L1536">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1538">			methodFinish();</span>
		}
	}

	public String getSeal(String userName, String token) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1543">		methodStart(&quot;getSeal&quot;, userName, token);</span>
		try {
<span class="nc" id="L1545">			return m_userManager.getSeal(userName, token);</span>
<span class="nc" id="L1546">		} catch (final Exception ex) {</span>
<span class="nc" id="L1547">			handleException(ex, true);</span>
<span class="nc" id="L1548">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1550">			methodFinish();</span>
		}
	}

	// ================ License Manager ================

	public CFLicensedItem[] getValidLicensedItems() throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1557">		methodStart(&quot;getValidLicensedItems&quot;);</span>
		try {
<span class="nc" id="L1559">			final Collection col = m_licenseManager.getValidLicensedItems();</span>
<span class="nc" id="L1560">			return CFLicensedItem.convert(col);</span>
<span class="nc" id="L1561">		} catch (final Exception ex) {</span>
<span class="nc" id="L1562">			handleException(ex, true);</span>
<span class="nc" id="L1563">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1565">			methodFinish();</span>
		}
	}

	// ================ DBConfig Manager ================

	public String getSuiteVersion() throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1572">		methodStart(&quot;getSuiteVersion&quot;);</span>
		try {
<span class="nc" id="L1574">			return m_dbConfigManager.getSuiteVersion();</span>
<span class="nc" id="L1575">		} catch (final Exception ex) {</span>
<span class="nc" id="L1576">			handleException(ex, true);</span>
<span class="nc" id="L1577">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1579">			methodFinish();</span>
		}
	}

	public CFDBConfiguration getDbConfiguration() throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1584">		methodStart(&quot;getDbConfiguration&quot;);</span>
		try {
<span class="nc" id="L1586">			return CFDBConfiguration.convert(m_dbConfigManager.getDbConfiguration());</span>
<span class="nc" id="L1587">		} catch (final Exception ex) {</span>
<span class="nc" id="L1588">			handleException(ex, true);</span>
<span class="nc" id="L1589">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1591">			methodFinish();</span>
		}
	}

	// ================ WorkResource Manager ================

	public ID createOrganization(CFOrganization objValue) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1598">		methodStart(&quot;createOrganization&quot;, objValue);</span>
		try {
<span class="nc" id="L1600">			return m_workResourceManager.createOrganization(CFOrganization.convert(objValue));</span>
<span class="nc" id="L1601">		} catch (final BbmCreateException ex) {</span>
<span class="nc" id="L1602">			handleException(ex, true);</span>
<span class="nc" id="L1603">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_CREATE_EXCEPTION);</span>
<span class="nc" id="L1604">		} catch (final Exception ex) {</span>
<span class="nc" id="L1605">			handleException(ex, true);</span>
<span class="nc" id="L1606">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1608">			methodFinish();</span>
		}
	}

	public void createOrganizationHOO(CFOrganizationHOO objValue) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1613">		methodStart(&quot;createOrganizationHOO&quot;, objValue);</span>
		try {
<span class="nc" id="L1615">			m_workResourceManager.createOrganizationHOOAssignment(CFOrganizationHOO.convert(objValue));</span>
<span class="nc" id="L1616">		} catch (final BbmCreateException ex) {</span>
<span class="nc" id="L1617">			handleException(ex, true);</span>
<span class="nc" id="L1618">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_CREATE_EXCEPTION);</span>
<span class="nc" id="L1619">		} catch (final Exception ex) {</span>
<span class="nc" id="L1620">			handleException(ex, true);</span>
<span class="nc" id="L1621">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1623">			methodFinish();</span>
<span class="nc" id="L1624">		}</span>
<span class="nc" id="L1625">	}</span>

	public void makeSubOrganizationAdvancedOptionInherited(ID parentOrgID) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1628">		methodStart(&quot;makeSubOrganizationAdvancedOptionInherited&quot;, parentOrgID);</span>
		try {
<span class="nc" id="L1630">			m_workResourceManager.makeSubOrganizationAdvancedOptionInherited(parentOrgID);</span>
<span class="nc" id="L1631">		} catch (final Exception ex) {</span>
<span class="nc" id="L1632">			handleException(ex, true);</span>
<span class="nc" id="L1633">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1635">			methodFinish();</span>
<span class="nc" id="L1636">		}</span>
<span class="nc" id="L1637">	}</span>

	public void makeSubOrganizationHOOInherited(ID parentOrgID) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1640">		methodStart(&quot;makeSubOrganizationHOOInherited&quot;, parentOrgID);</span>
		try {
<span class="nc" id="L1642">			m_workResourceManager.makeSubOrganizationHOOInherited(parentOrgID);</span>
<span class="nc" id="L1643">		} catch (final Exception ex) {</span>
<span class="nc" id="L1644">			handleException(ex, true);</span>
<span class="nc" id="L1645">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1647">			methodFinish();</span>
<span class="nc" id="L1648">		}</span>
<span class="nc" id="L1649">	}</span>

	public void deleteOrganizations(Collection orgIDs) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1652">		methodStart(&quot;deleteOrganizations&quot;, orgIDs);</span>
		try {
<span class="nc" id="L1654">			m_workResourceManager.deleteOrganizations(orgIDs);</span>
<span class="nc" id="L1655">		} catch (final BbmRemoveException ex) {</span>
<span class="nc" id="L1656">			handleException(ex, true);</span>
<span class="nc" id="L1657">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_REMOVE_EXCEPTION);</span>
<span class="nc" id="L1658">		} catch (final Exception ex) {</span>
<span class="nc" id="L1659">			handleException(ex, true);</span>
<span class="nc" id="L1660">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1662">			methodFinish();</span>
<span class="nc" id="L1663">		}</span>
<span class="nc" id="L1664">	}</span>

	public CFOrganization getOrganizationByID(ID id) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1667">		methodStart(&quot;getOrganizationByID&quot;, id);</span>
		try {
<span class="nc" id="L1669">			return CFOrganization.convert(m_workResourceManager.getOrganizationByID(id));</span>
<span class="nc" id="L1670">		} catch (final BbmFinderException ex) {</span>
<span class="nc" id="L1671">			handleException(ex, true);</span>
<span class="nc" id="L1672">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
<span class="nc" id="L1673">		} catch (final Exception ex) {</span>
<span class="nc" id="L1674">			handleException(ex, true);</span>
<span class="nc" id="L1675">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1677">			methodFinish();</span>
		}
	}

	public CFOrganizationHOO getOrganizationHOOByOrgID(ID id) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1682">		methodStart(&quot;getOrganizationHOOByOrgID&quot;, id);</span>
		try {
<span class="nc" id="L1684">			final Collection hoos = m_workResourceManager.getOrganizationHOOAssignments(id, null, null);</span>
<span class="nc" id="L1685">			final Iterator i = hoos.iterator();</span>
<span class="nc bnc" id="L1686" title="All 2 branches missed.">			if (i.hasNext()) {</span>
<span class="nc" id="L1687">				return CFOrganizationHOO.convert((OrganizationHOO) (i.next()));</span>
			} else {
<span class="nc" id="L1689">				final OrganizationHOO org = new OrganizationHOO();</span>
<span class="nc" id="L1690">				return CFOrganizationHOO.convert(org);</span>
			}

<span class="nc" id="L1693">		} catch (final BbmFinderException ex) {</span>
<span class="nc" id="L1694">			handleException(ex, true);</span>
<span class="nc" id="L1695">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
<span class="nc" id="L1696">		} catch (final Exception ex) {</span>
<span class="nc" id="L1697">			handleException(ex, true);</span>
<span class="nc" id="L1698">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1700">			methodFinish();</span>
		}
	}

	public CFOrganization[] getOrganizationsByIDs(Collection orgIDs) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1705">		methodStart(&quot;getOrganizations&quot;, orgIDs);</span>
		try {
<span class="nc" id="L1707">			return CFOrganization.convert(m_workResourceManager.getOrganizationsByIDs(orgIDs));</span>
<span class="nc" id="L1708">		} catch (final BbmFinderException ex) {</span>
<span class="nc" id="L1709">			handleException(ex, true);</span>
<span class="nc" id="L1710">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
<span class="nc" id="L1711">		} catch (final Exception ex) {</span>
<span class="nc" id="L1712">			handleException(ex, true);</span>
<span class="nc" id="L1713">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1715">			methodFinish();</span>
		}
	}

	public Collection getOrganizationsChildrenByIDs(Collection colIDs) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1720">		methodStart(&quot;getOrganizationsChildrenByIDs&quot;, colIDs);</span>
		try {
<span class="nc" id="L1722">			return m_workResourceManager.getOrganizationsChildrenByIDs(colIDs);</span>
<span class="nc" id="L1723">		} catch (final BbmFinderException ex) {</span>
<span class="nc" id="L1724">			handleException(ex, true);</span>
<span class="nc" id="L1725">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
<span class="nc" id="L1726">		} catch (final Exception ex) {</span>
<span class="nc" id="L1727">			handleException(ex, true);</span>
<span class="nc" id="L1728">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1730">			methodFinish();</span>
		}
	}

	public Collection getOrganizationsParentsByIDs(Collection colIDs) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1735">		methodStart(&quot;getOrganizationsParentsByIDs&quot;, colIDs);</span>
		try {
<span class="nc" id="L1737">			return m_workResourceManager.getOrganizationsParentsByIDs(colIDs);</span>
<span class="nc" id="L1738">		} catch (final BbmFinderException ex) {</span>
<span class="nc" id="L1739">			handleException(ex, true);</span>
<span class="nc" id="L1740">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
<span class="nc" id="L1741">		} catch (final Exception ex) {</span>
<span class="nc" id="L1742">			handleException(ex, true);</span>
<span class="nc" id="L1743">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1745">			methodFinish();</span>
		}
	}

	public void updateOrganization(CFOrganization objValue) throws RemoteException, CorbaFacadeException, CFMultiUserException {
<span class="nc" id="L1750">		methodStart(&quot;updateOrganization&quot;, objValue);</span>
		try {
<span class="nc" id="L1752">			m_workResourceManager.updateOrganization(CFOrganization.convert(objValue));</span>
<span class="nc" id="L1753">		} catch (final MultiUserException ex) {</span>
<span class="nc" id="L1754">			handleException(ex, true);</span>
<span class="nc" id="L1755">			throw CFMultiUserException.convert(ex);</span>
<span class="nc" id="L1756">		} catch (final BbmUpdateException ex) {</span>
<span class="nc" id="L1757">			handleException(ex, true);</span>
<span class="nc" id="L1758">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_UPDATE_EXCEPTION);</span>
<span class="nc" id="L1759">		} catch (final Exception ex) {</span>
<span class="nc" id="L1760">			handleException(ex, true);</span>
<span class="nc" id="L1761">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1763">			methodFinish();</span>
<span class="nc" id="L1764">		}</span>
<span class="nc" id="L1765">	}</span>

	public void updateOrganizationHOO(CFOrganizationHOO objValue) throws RemoteException, CorbaFacadeException, CFMultiUserException {
<span class="nc" id="L1768">		methodStart(&quot;updateOrganizationHOO&quot;, objValue);</span>
		try {
<span class="nc" id="L1770">			m_workResourceManager.updateOrganizationHOOAssignment(CFOrganizationHOO.convert(objValue));</span>
<span class="nc" id="L1771">		} catch (final MultiUserException ex) {</span>
<span class="nc" id="L1772">			handleException(ex, true);</span>
<span class="nc" id="L1773">			throw CFMultiUserException.convert(ex);</span>
<span class="nc" id="L1774">		} catch (final BbmUpdateException ex) {</span>
<span class="nc" id="L1775">			handleException(ex, true);</span>
<span class="nc" id="L1776">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_UPDATE_EXCEPTION);</span>
<span class="nc" id="L1777">		} catch (final Exception ex) {</span>
<span class="nc" id="L1778">			handleException(ex, true);</span>
<span class="nc" id="L1779">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1781">			methodFinish();</span>
<span class="nc" id="L1782">		}</span>
<span class="nc" id="L1783">	}</span>

	// ================ Employee related =================
	public ID createEmployee(CFEmployee objValue) throws RemoteException, CorbaFacadeException, BbmCreateDuplicateKeyException {
<span class="nc" id="L1787">		methodStart(&quot;createEmployee&quot;, objValue);</span>
		try {
<span class="nc" id="L1789">			return m_workResourceManager.createEmployee(CFEmployee.convert(objValue));</span>
<span class="nc" id="L1790">		} catch (final BbmCreateException ex) {</span>
<span class="nc" id="L1791">			handleException(ex, true);</span>
<span class="nc bnc" id="L1792" title="All 2 branches missed.">			if (ex instanceof BbmCreateDuplicateKeyException) {</span>
<span class="nc" id="L1793">				throw (BbmCreateDuplicateKeyException) ex;</span>
			} else {
<span class="nc" id="L1795">				throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_CREATE_EXCEPTION);</span>
			}
<span class="nc" id="L1797">		} catch (final Exception ex) {</span>
<span class="nc" id="L1798">			handleException(ex, true);</span>
<span class="nc bnc" id="L1799" title="All 2 branches missed.">			if (ex instanceof BbmCreateDuplicateAgentIDException) {</span>
<span class="nc" id="L1800">				throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_CREATE_DUPLICATE_AGENT_ID_EXCEPTION);</span>
			} else {
<span class="nc" id="L1802">				throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
			}
		} finally {
<span class="nc" id="L1805">			methodFinish();</span>
		}
	}

	public CFEmployee[] getEmployees(ID idOrg, Date dtNow, long lDetailLevel) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1810">		methodStart(&quot;getEmployees&quot;, idOrg, dtNow, new Long(lDetailLevel));</span>
		try {
<span class="nc" id="L1812">			final Collection employees = m_workResourceManager.getEmployees(idOrg, dtNow, lDetailLevel);</span>
<span class="nc" id="L1813">			final Collection&lt;ID&gt; orgIDs = new HashSet&lt;ID&gt;();</span>
<span class="nc bnc" id="L1814" title="All 2 branches missed.">			for (final Iterator i = employees.iterator(); i.hasNext(); ) {</span>
<span class="nc" id="L1815">				orgIDs.add(((Employee) i.next()).getOrganizationID());</span>
			}
<span class="nc" id="L1817">			final Collection&lt;QueueAttributeDefintion&gt; queueAttriDefs = m_workloadManager.getUserDefinedFieldDefinitions(orgIDs);</span>
<span class="nc" id="L1818">			return CFEmployee.convert(employees, queueAttriDefs);</span>
			// return
			// CFEmployee.convert(m_workResourceManager.getEmployees(idOrg,
			// dtNow, lDetailLevel));
<span class="nc" id="L1822">		} catch (final BbmFinderException ex) {</span>
<span class="nc" id="L1823">			handleException(ex, true);</span>
<span class="nc" id="L1824">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
<span class="nc" id="L1825">		} catch (final Exception ex) {</span>
<span class="nc" id="L1826">			handleException(ex, true);</span>
<span class="nc" id="L1827">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1829">			methodFinish();</span>
		}
	}

	public CFEmployee[] getEmployees(Collection colOrgIDs, Date dtNow, long lDetailLevel) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1834">		methodStart(&quot;getEmployees&quot;, colOrgIDs, dtNow, new Long(lDetailLevel));</span>
		try {
<span class="nc" id="L1836">			final Collection employees = m_workResourceManager.getEmployees(colOrgIDs, dtNow, lDetailLevel);</span>
<span class="nc" id="L1837">			final Collection&lt;ID&gt; orgIDs = new HashSet&lt;ID&gt;();</span>
<span class="nc bnc" id="L1838" title="All 2 branches missed.">			for (final Iterator i = employees.iterator(); i.hasNext(); ) {</span>
<span class="nc" id="L1839">				orgIDs.add(((Employee) i.next()).getOrganizationID());</span>
			}
<span class="nc" id="L1841">			final Collection&lt;QueueAttributeDefintion&gt; queueAttriDefs = m_workloadManager.getUserDefinedFieldDefinitions(orgIDs);</span>
<span class="nc" id="L1842">			return CFEmployee.convert(employees, queueAttriDefs);</span>
			// return
			// CFEmployee.convert(m_workResourceManager.getEmployees(colOrgIDs,
			// dtNow, lDetailLevel));
<span class="nc" id="L1846">		} catch (final BbmFinderException ex) {</span>
<span class="nc" id="L1847">			handleException(ex, true);</span>
<span class="nc" id="L1848">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
<span class="nc" id="L1849">		} catch (final Exception ex) {</span>
<span class="nc" id="L1850">			handleException(ex, true);</span>
<span class="nc" id="L1851">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1853">			methodFinish();</span>
		}
	}

	public CFEmployee[] getEmployeesFromIDs(Collection empIDs, Date dtNow, long lDetailLevel) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1858">		methodStart(&quot;getEmployeesFromIDs&quot;, empIDs, new Long(lDetailLevel));</span>
		try {
<span class="nc" id="L1860">			final Collection employees = m_workResourceManager.getEmployeesByIDs(empIDs, dtNow, lDetailLevel);</span>
<span class="nc" id="L1861">			final Collection&lt;ID&gt; orgIDs = new HashSet&lt;ID&gt;();</span>
<span class="nc bnc" id="L1862" title="All 2 branches missed.">			for (final Iterator i = employees.iterator(); i.hasNext(); ) {</span>
<span class="nc" id="L1863">				orgIDs.add(((Employee) i.next()).getOrganizationID());</span>
			}
<span class="nc" id="L1865">			final Collection&lt;QueueAttributeDefintion&gt; queueAttriDefs = m_workloadManager.getUserDefinedFieldDefinitions(orgIDs);</span>
<span class="nc" id="L1866">			return CFEmployee.convert(employees, queueAttriDefs);</span>
<span class="nc" id="L1867">		} catch (final BbmFinderException ex) {</span>
<span class="nc" id="L1868">			handleException(ex, true);</span>
<span class="nc" id="L1869">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
<span class="nc" id="L1870">		} catch (final Exception ex) {</span>
<span class="nc" id="L1871">			handleException(ex, true);</span>
<span class="nc" id="L1872">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1874">			methodFinish();</span>
		}
	}

	public void updateEmployee(CFEmployee objValue) throws RemoteException, CorbaFacadeException, CFMultiUserException, BbmUpdateDuplicateKeyException {
<span class="nc" id="L1879">		methodStart(&quot;updateEmployee&quot;, objValue);</span>
		try {
<span class="nc" id="L1881">			m_workResourceManager.updateEmployee(CFEmployee.convert(objValue));</span>
<span class="nc" id="L1882">		} catch (final MultiUserException ex) {</span>
<span class="nc" id="L1883">			handleException(ex, true);</span>
<span class="nc" id="L1884">			throw CFMultiUserException.convert(ex);</span>
<span class="nc" id="L1885">		} catch (final BbmUpdateException ex) {</span>
<span class="nc" id="L1886">			handleException(ex, true);</span>
<span class="nc bnc" id="L1887" title="All 2 branches missed.">			if (ex instanceof BbmUpdateDuplicateKeyException) {</span>
<span class="nc" id="L1888">				throw (BbmUpdateDuplicateKeyException) ex;</span>
<span class="nc bnc" id="L1889" title="All 2 branches missed.">			} else if (ex instanceof BbmUpdateNoOperationException) {</span>
<span class="nc" id="L1890">				throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_UPDATE_NO_OPERATION_EXCEPTION);</span>
<span class="nc bnc" id="L1891" title="All 2 branches missed.">			} else if (ex instanceof BbmUpdateLoopSupervisorException) {</span>
<span class="nc" id="L1892">				throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_UPDATE_LOOP_SUPERVISOR_EXCEPTION);</span>
			} else {
<span class="nc" id="L1894">				throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_UPDATE_EXCEPTION);</span>
			}
<span class="nc" id="L1896">		} catch (final Exception ex) {</span>
<span class="nc" id="L1897">			handleException(ex, true);</span>
<span class="nc bnc" id="L1898" title="All 2 branches missed.">			if (ex instanceof BbmUpdateDuplicateAgentIDException) {</span>
<span class="nc" id="L1899">				throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_UPDATE_DUPLICATE_AGENT_ID_EXCEPTION);</span>
			} else {
<span class="nc" id="L1901">				throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
			}
		} finally {
<span class="nc" id="L1904">			methodFinish();</span>
<span class="nc" id="L1905">		}</span>
<span class="nc" id="L1906">	}</span>

	public void updateEmployees(CFEmployee[] arrEmployees) throws RemoteException, CorbaFacadeException, CFMultiUserException, BbmUpdateDuplicateKeyException {
<span class="nc" id="L1909">		methodStart(&quot;updateEmployees&quot;, arrEmployees);</span>
		try {
<span class="nc" id="L1911">			m_workResourceManager.updateEmployees(CFEmployee.convert(arrEmployees));</span>
<span class="nc" id="L1912">		} catch (final MultiUserException ex) {</span>
<span class="nc" id="L1913">			handleException(ex, true);</span>
<span class="nc" id="L1914">			throw CFMultiUserException.convert(ex);</span>
<span class="nc" id="L1915">		} catch (final BbmUpdateException ex) {</span>
<span class="nc" id="L1916">			handleException(ex, true);</span>
<span class="nc bnc" id="L1917" title="All 2 branches missed.">			if (ex instanceof BbmUpdateDuplicateKeyException) {</span>
<span class="nc" id="L1918">				throw (BbmUpdateDuplicateKeyException) ex;</span>
<span class="nc bnc" id="L1919" title="All 2 branches missed.">			} else if (ex instanceof BbmUpdateNoOperationException) {</span>
<span class="nc" id="L1920">				throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_UPDATE_NO_OPERATION_EXCEPTION);</span>
			} else {
<span class="nc" id="L1922">				throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_UPDATE_EXCEPTION);</span>
			}
<span class="nc" id="L1924">		} catch (final Exception ex) {</span>
<span class="nc" id="L1925">			handleException(ex, true);</span>
<span class="nc bnc" id="L1926" title="All 2 branches missed.">			if (ex instanceof BbmUpdateDuplicateAgentIDException) {</span>
<span class="nc" id="L1927">				throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_UPDATE_DUPLICATE_AGENT_ID_EXCEPTION);</span>
			} else {
<span class="nc" id="L1929">				throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
			}
		} finally {
<span class="nc" id="L1932">			methodFinish();</span>
<span class="nc" id="L1933">		}</span>
<span class="nc" id="L1934">	}</span>

	public void terminateEmployee(ID idEmployee, Date tDate, String timezoneID) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1937">		methodStart(&quot;terminateEmployee&quot;, idEmployee, tDate, timezoneID);</span>
		try {
<span class="nc" id="L1939">			final TimeZone timezone = TimeZone.getTimeZone(timezoneID);</span>
<span class="nc" id="L1940">			final LocalDate localDate = new LocalDate(tDate, timezone);</span>
<span class="nc" id="L1941">			m_workResourceManager.terminateEmployee(idEmployee, localDate);</span>
<span class="nc" id="L1942">		} catch (final Exception ex) {</span>
<span class="nc" id="L1943">			handleException(ex, true);</span>
<span class="nc" id="L1944">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1946">			methodFinish();</span>
<span class="nc" id="L1947">		}</span>
<span class="nc" id="L1948">	}</span>

	public CFIDPersonNamePair[] getSupervisorIDNamesByOrgIDs(Collection colOrgIDs) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1951">		methodStart(&quot;getSupervisorIDNamesByOrgIDs&quot;, colOrgIDs);</span>
		try {
<span class="nc" id="L1953">			return CFIDPersonNamePair.convert(m_workResourceManager.getSupervisorIDNamesByOrgIDs(colOrgIDs, null));</span>
<span class="nc" id="L1954">		} catch (final BbmFinderException ex) {</span>
<span class="nc" id="L1955">			handleException(ex, true);</span>
<span class="nc" id="L1956">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
<span class="nc" id="L1957">		} catch (final Exception ex) {</span>
<span class="nc" id="L1958">			handleException(ex, true);</span>
<span class="nc" id="L1959">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1961">			methodFinish();</span>
		}
	}

	public CFIDPersonNamePair[] getTeamLeadIDNamesByOrgIDs(Collection colOrgIDs) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1966">		methodStart(&quot;getTeamLeadIDNamesByOrgIDs&quot;, colOrgIDs);</span>
		try {
<span class="nc" id="L1968">			return CFIDPersonNamePair.convert(m_workResourceManager.getTeamLeadIDNamesByOrgIDs(colOrgIDs, null));</span>
<span class="nc" id="L1969">		} catch (final BbmFinderException ex) {</span>
<span class="nc" id="L1970">			handleException(ex, true);</span>
<span class="nc" id="L1971">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
<span class="nc" id="L1972">		} catch (final Exception ex) {</span>
<span class="nc" id="L1973">			handleException(ex, true);</span>
<span class="nc" id="L1974">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1976">			methodFinish();</span>
		}
	}

	public CFIDStringPair[] getJobTitleIDNamePairsByOrgIDs(Collection colOrgIDs) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1981">		methodStart(&quot;getJobTitleIDNamePairsByOrgIDs&quot;, colOrgIDs);</span>
		try {
<span class="nc" id="L1983">			return CFIDStringPair.convert(m_workResourceManager.getJobTitleIDNamePairsByOrgIDs(colOrgIDs));</span>
<span class="nc" id="L1984">		} catch (final BbmFinderException ex) {</span>
<span class="nc" id="L1985">			handleException(ex, true);</span>
<span class="nc" id="L1986">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
<span class="nc" id="L1987">		} catch (final Exception ex) {</span>
<span class="nc" id="L1988">			handleException(ex, true);</span>
<span class="nc" id="L1989">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L1991">			methodFinish();</span>
		}
	}

	// ================ Phantom related =================
	public ID createPhantom(CFPhantom objValue) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L1997">		methodStart(&quot;createPhantom&quot;, objValue);</span>
		try {
<span class="nc" id="L1999">			return m_scheduleAccessManager.createPhantom(CFPhantom.convert(objValue));</span>
<span class="nc" id="L2000">		} catch (final BbmCreateException ex) {</span>
<span class="nc" id="L2001">			handleException(ex, true);</span>
<span class="nc" id="L2002">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_CREATE_EXCEPTION);</span>
<span class="nc" id="L2003">		} catch (final Exception ex) {</span>
<span class="nc" id="L2004">			handleException(ex, true);</span>
<span class="nc" id="L2005">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L2007">			methodFinish();</span>
		}
	}

	public Collection createPhantoms(CFPhantom[] objValues) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L2012">		methodStart(&quot;createPhantoms&quot;, objValues);</span>
		try {
<span class="nc" id="L2014">			return m_scheduleAccessManager.createPhantoms(CFPhantom.convert(objValues));</span>
<span class="nc" id="L2015">		} catch (final BbmCreateException ex) {</span>
<span class="nc" id="L2016">			handleException(ex, true);</span>
<span class="nc" id="L2017">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_CREATE_EXCEPTION);</span>
<span class="nc" id="L2018">		} catch (final Exception ex) {</span>
<span class="nc" id="L2019">			handleException(ex, true);</span>
<span class="nc" id="L2020">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L2022">			methodFinish();</span>
		}
	}

	public void deletePhantoms(Collection colIDs) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L2027">		methodStart(&quot;deletePhantoms&quot;, colIDs);</span>
		try {
<span class="nc" id="L2029">			m_scheduleAccessManager.deletePhantoms(colIDs);</span>
<span class="nc" id="L2030">		} catch (final BbmRemoveException ex) {</span>
<span class="nc" id="L2031">			handleException(ex, true);</span>
<span class="nc" id="L2032">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_REMOVE_EXCEPTION);</span>
<span class="nc" id="L2033">		} catch (final Exception ex) {</span>
<span class="nc" id="L2034">			handleException(ex, true);</span>
<span class="nc" id="L2035">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L2037">			methodFinish();</span>
<span class="nc" id="L2038">		}</span>
<span class="nc" id="L2039">	}</span>

	public void deletePhantomsByEmployeeTemplateID(ID empTemplateID) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L2042">		methodStart(&quot;deletePhantomsByEmployeeTemplateID&quot;, empTemplateID);</span>
		try {
<span class="nc" id="L2044">			m_scheduleAccessManager.deletePhantomsByEmployeeTemplateID(empTemplateID);</span>
<span class="nc" id="L2045">		} catch (final BbmRemoveException ex) {</span>
<span class="nc" id="L2046">			handleException(ex, true);</span>
<span class="nc" id="L2047">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_REMOVE_EXCEPTION);</span>
<span class="nc" id="L2048">		} catch (final Exception ex) {</span>
<span class="nc" id="L2049">			handleException(ex, true);</span>
<span class="nc" id="L2050">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L2052">			methodFinish();</span>
<span class="nc" id="L2053">		}</span>
<span class="nc" id="L2054">	}</span>

	public void deletePhantomsBySchedulingPeriod(ID idSchedulingPeriod) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L2057">		methodStart(&quot;deletePhantomsBySchedulingPeriod&quot;, idSchedulingPeriod);</span>
		try {
<span class="nc" id="L2059">			m_scheduleAccessManager.deletePhantomsBySchedulingPeriod(idSchedulingPeriod);</span>
<span class="nc" id="L2060">		} catch (final BbmRemoveException ex) {</span>
<span class="nc" id="L2061">			handleException(ex, true);</span>
<span class="nc" id="L2062">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_REMOVE_EXCEPTION);</span>
<span class="nc" id="L2063">		} catch (final Exception ex) {</span>
<span class="nc" id="L2064">			handleException(ex, true);</span>
<span class="nc" id="L2065">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L2067">			methodFinish();</span>
<span class="nc" id="L2068">		}</span>
<span class="nc" id="L2069">	}</span>

	public CFPhantom getPhantomByID(ID idPhantom) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L2072">		methodStart(&quot;getPhantomByID&quot;, idPhantom);</span>
		try {
<span class="nc" id="L2074">			return CFPhantom.convert(m_scheduleAccessManager.getPhantomByID(idPhantom));</span>
<span class="nc" id="L2075">		} catch (final BbmFinderException ex) {</span>
<span class="nc" id="L2076">			handleException(ex, true);</span>
<span class="nc" id="L2077">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
<span class="nc" id="L2078">		} catch (final Exception ex) {</span>
<span class="nc" id="L2079">			handleException(ex, true);</span>
<span class="nc" id="L2080">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L2082">			methodFinish();</span>
		}
	}

	public CFPhantom[] getPhantoms(ID idSchedulingPeriod) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L2087">		methodStart(&quot;getPhantoms&quot;, idSchedulingPeriod);</span>
		try {
<span class="nc" id="L2089">			return CFPhantom.convert(m_scheduleAccessManager.getPhantoms(idSchedulingPeriod));</span>
<span class="nc" id="L2090">		} catch (final BbmFinderException ex) {</span>
<span class="nc" id="L2091">			handleException(ex, true);</span>
<span class="nc" id="L2092">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
<span class="nc" id="L2093">		} catch (final Exception ex) {</span>
<span class="nc" id="L2094">			handleException(ex, true);</span>
<span class="nc" id="L2095">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L2097">			methodFinish();</span>
		}
	}

	public CFPhantom[] getPhantomsByIDs(Collection colIDs) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L2102">		methodStart(&quot;getPhantomsByIDs&quot;, colIDs);</span>
		try {
<span class="nc" id="L2104">			return CFPhantom.convert(m_scheduleAccessManager.getPhantomsByIDs(colIDs));</span>
<span class="nc" id="L2105">		} catch (final BbmFinderException ex) {</span>
<span class="nc" id="L2106">			handleException(ex, true);</span>
<span class="nc" id="L2107">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
<span class="nc" id="L2108">		} catch (final Exception ex) {</span>
<span class="nc" id="L2109">			handleException(ex, true);</span>
<span class="nc" id="L2110">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L2112">			methodFinish();</span>
		}
	}

	// return phantom name string only for FS
	public HashMap getPhantomEmployeeNamesByIDs(Collection colIDs) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L2118">		methodStart(&quot;getPhantomEmployeeNamesByIDs&quot;, colIDs);</span>
		try {
			// return
			// m_workResourceManager.getPhantomEmployeeNamesByIDs(colIDs);
			// workresource manager returns id/EmployeeName map now to support
			// web calendar,
			// have to convert to ID/String for FS here to make FS work without
			// any change
<span class="nc" id="L2126">			final HashMap empNames = m_scheduleAccessManager.getPhantomEmployeeNamesByIDs(colIDs);</span>
<span class="nc bnc" id="L2127" title="All 4 branches missed.">			if ((empNames != null) &amp;&amp; (empNames.size() &gt; 0)) {</span>
<span class="nc" id="L2128">				Map.Entry entry = null;</span>
<span class="nc" id="L2129">				EmployeeName name = null;</span>
<span class="nc bnc" id="L2130" title="All 2 branches missed.">				for (final Iterator i = empNames.entrySet().iterator(); i.hasNext(); ) {</span>
<span class="nc" id="L2131">					entry = (Map.Entry) i.next();</span>
<span class="nc" id="L2132">					name = (EmployeeName) entry.getValue();</span>
<span class="nc" id="L2133">					entry.setValue(name.getFirstName());</span>
				}
			}
<span class="nc" id="L2136">			return empNames;</span>
<span class="nc" id="L2137">		} catch (final BbmFinderException ex) {</span>
<span class="nc" id="L2138">			handleException(ex, true);</span>
<span class="nc" id="L2139">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
<span class="nc" id="L2140">		} catch (final Exception ex) {</span>
<span class="nc" id="L2141">			handleException(ex, true);</span>
<span class="nc" id="L2142">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L2144">			methodFinish();</span>
		}
	}

	public void updatePhantom(CFPhantom cfPhantom) throws RemoteException, CorbaFacadeException, CFMultiUserException {
<span class="nc" id="L2149">		methodStart(&quot;updatePhantom&quot;, cfPhantom);</span>
		try {
<span class="nc" id="L2151">			m_scheduleAccessManager.updatePhantom(CFPhantom.convert(cfPhantom));</span>
<span class="nc" id="L2152">		} catch (final MultiUserException ex) {</span>
<span class="nc" id="L2153">			handleException(ex, true);</span>
<span class="nc" id="L2154">			throw CFMultiUserException.convert(ex);</span>
<span class="nc" id="L2155">		} catch (final BbmUpdateException ex) {</span>
<span class="nc" id="L2156">			handleException(ex, true);</span>
<span class="nc" id="L2157">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_UPDATE_EXCEPTION);</span>
<span class="nc" id="L2158">		} catch (final Exception ex) {</span>
<span class="nc" id="L2159">			handleException(ex, true);</span>
<span class="nc" id="L2160">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L2162">			methodFinish();</span>
<span class="nc" id="L2163">		}</span>
<span class="nc" id="L2164">	}</span>

	public void updatePhantoms(CFPhantom[] cfPhantoms) throws RemoteException, CorbaFacadeException, CFMultiUserException {
<span class="nc" id="L2167">		methodStart(&quot;updatePhantoms&quot;, cfPhantoms);</span>
		try {
<span class="nc" id="L2169">			m_scheduleAccessManager.updatePhantoms(CFPhantom.convert(cfPhantoms));</span>
<span class="nc" id="L2170">		} catch (final MultiUserException ex) {</span>
<span class="nc" id="L2171">			handleException(ex, true);</span>
<span class="nc" id="L2172">			throw CFMultiUserException.convert(ex);</span>
<span class="nc" id="L2173">		} catch (final BbmUpdateException ex) {</span>
<span class="nc" id="L2174">			handleException(ex, true);</span>
<span class="nc" id="L2175">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_UPDATE_EXCEPTION);</span>
<span class="nc" id="L2176">		} catch (final Exception ex) {</span>
<span class="nc" id="L2177">			handleException(ex, true);</span>
<span class="nc" id="L2178">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L2180">			methodFinish();</span>
<span class="nc" id="L2181">		}</span>
<span class="nc" id="L2182">	}</span>

	// ============== TimeSeriesAuditManager ==================
	public void createTimeSeriesAudit(ID campaignID, ID mediaID, ID queueID, short areaType, Date start, Date end) throws RemoteException, CorbaFacadeException {
<span class="nc bnc" id="L2186" title="All 2 branches missed.">		if (queueID == null) {</span>
<span class="nc" id="L2187">			methodStart(&quot;createTimeSeriesAudit&quot;, campaignID, mediaID, start, end, NumberFactory.newInteger(areaType));</span>
		} else {
<span class="nc" id="L2189">			methodStart(&quot;createTimeSeriesAudit&quot;, queueID, start, end, NumberFactory.newInteger(areaType));</span>
		}
		try {
<span class="nc" id="L2192">			m_timeSeriesAuditManager.createTimeSeriesAudit(campaignID, mediaID, queueID, areaType, start, end);</span>
<span class="nc" id="L2193">		} catch (final BbmCreateException ex) {</span>
<span class="nc" id="L2194">			handleException(ex, true);</span>
<span class="nc" id="L2195">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_CREATE_EXCEPTION);</span>
<span class="nc" id="L2196">		} catch (final Exception ex) {</span>
<span class="nc" id="L2197">			handleException(ex, true);</span>
<span class="nc" id="L2198">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L2200">			methodFinish();</span>
<span class="nc" id="L2201">		}</span>
<span class="nc" id="L2202">	}</span>

	// ============== Utility API ===============
	public Date getCurrentTime() {
<span class="nc" id="L2206">		methodStart(&quot;getCurrentTime&quot;);</span>
		try {
<span class="nc" id="L2208">			final Date now = new Date();</span>
<span class="nc" id="L2209">			return now;</span>
		} finally {
<span class="nc" id="L2211">			methodFinish();</span>
		}
	}

	// ================ Skill Assignment ================
	public ID createSkillAssignment(CFEmployeeSkill objValue) throws RemoteException, CorbaFacadeException, BbmCreateDuplicateKeyException {
<span class="nc" id="L2217">		methodStart(&quot;createSkillAssignment&quot;, objValue);</span>
		try {
<span class="nc" id="L2219">			return m_skillManager.createSkillAssignment(CFEmployeeSkill.convert(objValue));</span>
<span class="nc" id="L2220">		} catch (final BbmCreateException ex) {</span>
<span class="nc" id="L2221">			handleException(ex, true);</span>
<span class="nc bnc" id="L2222" title="All 2 branches missed.">			if (ex instanceof BbmCreateDuplicateKeyException) {</span>
<span class="nc" id="L2223">				throw (BbmCreateDuplicateKeyException) ex;</span>
			} else {
<span class="nc" id="L2225">				throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_CREATE_EXCEPTION);</span>
			}
<span class="nc" id="L2227">		} catch (final Exception ex) {</span>
<span class="nc" id="L2228">			handleException(ex, true);</span>
<span class="nc" id="L2229">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L2231">			methodFinish();</span>
		}
	}

	public void updateSkillAssignment(CFEmployeeSkill objValue) throws RemoteException, CorbaFacadeException, CFMultiUserException {
<span class="nc" id="L2236">		methodStart(&quot;updateSkillAssignment&quot;, objValue);</span>
		try {
<span class="nc" id="L2238">			m_skillManager.updateSkillAssignment(CFEmployeeSkill.convert(objValue), true);</span>
<span class="nc" id="L2239">		} catch (final MultiUserException ex) {</span>
<span class="nc" id="L2240">			handleException(ex, true);</span>
<span class="nc" id="L2241">			throw CFMultiUserException.convert(ex);</span>
<span class="nc" id="L2242">		} catch (final BbmUpdateException ex) {</span>
<span class="nc" id="L2243">			handleException(ex, true);</span>
<span class="nc" id="L2244">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_UPDATE_EXCEPTION);</span>
<span class="nc" id="L2245">		} catch (final Exception ex) {</span>
<span class="nc" id="L2246">			handleException(ex, true);</span>
<span class="nc" id="L2247">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L2249">			methodFinish();</span>
<span class="nc" id="L2250">		}</span>
<span class="nc" id="L2251">	}</span>

	public CFEmployeeSkillHistory[] getSkillAssignments(Collection colWorkResourceIDs, Date start, Date end) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L2254">		methodStart(&quot;getSkillAssignments&quot;, colWorkResourceIDs, start, end);</span>
		try {
<span class="nc" id="L2256">			return CFEmployeeSkillHistory.convert(m_skillManager.getSkillAssignments(colWorkResourceIDs, start, end));</span>
<span class="nc" id="L2257">		} catch (final BbmFinderException ex) {</span>
<span class="nc" id="L2258">			handleException(ex, true);</span>
<span class="nc" id="L2259">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
<span class="nc" id="L2260">		} catch (final Exception ex) {</span>
<span class="nc" id="L2261">			handleException(ex, true);</span>
<span class="nc" id="L2262">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L2264">			methodFinish();</span>
		}
	}

	// ================ TimeBank Assignment ================
	public ID createTimeBankAssignment(CFEmployeeTimeBank objValue) throws RemoteException, CorbaFacadeException, BbmCreateDuplicateKeyException {
<span class="nc" id="L2270">		methodStart(&quot;createTimeBankAssignment&quot;, objValue);</span>
		try {
<span class="nc" id="L2272">			return m_empWorkRuleManager.createTimeBankAssignment(CFEmployeeTimeBank.convert(objValue));</span>
<span class="nc" id="L2273">		} catch (final BbmCreateException ex) {</span>
<span class="nc" id="L2274">			handleException(ex, true);</span>
<span class="nc bnc" id="L2275" title="All 2 branches missed.">			if (ex instanceof BbmCreateDuplicateKeyException) {</span>
<span class="nc" id="L2276">				throw (BbmCreateDuplicateKeyException) ex;</span>
			} else {
<span class="nc" id="L2278">				throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_CREATE_EXCEPTION);</span>
			}
<span class="nc" id="L2280">		} catch (final Exception ex) {</span>
<span class="nc" id="L2281">			handleException(ex, true);</span>
<span class="nc" id="L2282">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L2284">			methodFinish();</span>
		}
	}

	public void updateTimeBankAssignment(CFEmployeeTimeBank objValue) throws RemoteException, CorbaFacadeException, CFMultiUserException {
<span class="nc" id="L2289">		methodStart(&quot;updateTimeBankAssignment&quot;, objValue);</span>
		try {
<span class="nc" id="L2291">			m_empWorkRuleManager.updateTimeBankAssignment(CFEmployeeTimeBank.convert(objValue), true);</span>
<span class="nc" id="L2292">		} catch (final MultiUserException ex) {</span>
<span class="nc" id="L2293">			handleException(ex, true);</span>
<span class="nc" id="L2294">			throw CFMultiUserException.convert(ex);</span>
<span class="nc" id="L2295">		} catch (final BbmUpdateException ex) {</span>
<span class="nc" id="L2296">			handleException(ex, true);</span>
<span class="nc" id="L2297">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_UPDATE_EXCEPTION);</span>
<span class="nc" id="L2298">		} catch (final Exception ex) {</span>
<span class="nc" id="L2299">			handleException(ex, true);</span>
<span class="nc" id="L2300">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L2302">			methodFinish();</span>
<span class="nc" id="L2303">		}</span>
<span class="nc" id="L2304">	}</span>

	public CFEmployeeTimeBankHistory[] getTimeBankAssignments(Collection colEmployeeIDs, Date start, Date end) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L2307">		methodStart(&quot;getTimeBankAssignments&quot;, colEmployeeIDs, start, end);</span>
		try {
<span class="nc" id="L2309">			return CFEmployeeTimeBankHistory.convert(m_empWorkRuleManager.getTimeBankAssignments(colEmployeeIDs, start, end));</span>
<span class="nc" id="L2310">		} catch (final BbmFinderException ex) {</span>
<span class="nc" id="L2311">			handleException(ex, true);</span>
<span class="nc" id="L2312">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
<span class="nc" id="L2313">		} catch (final Exception ex) {</span>
<span class="nc" id="L2314">			handleException(ex, true);</span>
<span class="nc" id="L2315">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L2317">			methodFinish();</span>
		}
	}

	// ========== workpatter(shiftpattern) assignment =============
	public ID createWorkPatternAssignment(CFEmployeeWorkPattern objValue) throws RemoteException, CorbaFacadeException, BbmCreateDuplicateKeyException {
<span class="nc" id="L2323">		methodStart(&quot;createWorkPatternAssignment&quot;, objValue);</span>
		try {
<span class="nc" id="L2325">			return m_empWorkRuleManager.createWorkPatternAssignment(CFEmployeeWorkPattern.convert(objValue));</span>
<span class="nc" id="L2326">		} catch (final BbmCreateException ex) {</span>
<span class="nc" id="L2327">			handleException(ex, true);</span>
<span class="nc bnc" id="L2328" title="All 2 branches missed.">			if (ex instanceof BbmCreateDuplicateKeyException) {</span>
<span class="nc" id="L2329">				throw (BbmCreateDuplicateKeyException) ex;</span>
			} else {
<span class="nc" id="L2331">				throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_CREATE_EXCEPTION);</span>
			}
<span class="nc" id="L2333">		} catch (final Exception ex) {</span>
<span class="nc" id="L2334">			handleException(ex, true);</span>
<span class="nc" id="L2335">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L2337">			methodFinish();</span>
		}
	}

	public void updateWorkPatternAssignment(CFEmployeeWorkPattern objValue) throws RemoteException, CorbaFacadeException, CFMultiUserException {
<span class="nc" id="L2342">		methodStart(&quot;updateWorkPatternAssignment&quot;, objValue);</span>
		try {
<span class="nc" id="L2344">			m_empWorkRuleManager.updateWorkPatternAssignment(CFEmployeeWorkPattern.convert(objValue), true);</span>
<span class="nc" id="L2345">		} catch (final MultiUserException ex) {</span>
<span class="nc" id="L2346">			handleException(ex, true);</span>
<span class="nc" id="L2347">			throw CFMultiUserException.convert(ex);</span>
<span class="nc" id="L2348">		} catch (final BbmUpdateException ex) {</span>
<span class="nc" id="L2349">			handleException(ex, true);</span>
<span class="nc" id="L2350">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_UPDATE_EXCEPTION);</span>
<span class="nc" id="L2351">		} catch (final Exception ex) {</span>
<span class="nc" id="L2352">			handleException(ex, true);</span>
<span class="nc" id="L2353">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L2355">			methodFinish();</span>
<span class="nc" id="L2356">		}</span>
<span class="nc" id="L2357">	}</span>

	public CFEmployeeWorkPatternHistory[] getWorkPatternAssignments(Collection colWorkResourceIDs, Date start, Date end) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L2360">		methodStart(&quot;getWorkPatternAssignments&quot;, colWorkResourceIDs, start, end);</span>
		try {
<span class="nc" id="L2362">			return CFEmployeeWorkPatternHistory.convert(m_empWorkRuleManager.getWorkPatternAssignments(colWorkResourceIDs, start, end));</span>
<span class="nc" id="L2363">		} catch (final BbmFinderException ex) {</span>
<span class="nc" id="L2364">			handleException(ex, true);</span>
<span class="nc" id="L2365">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
<span class="nc" id="L2366">		} catch (final Exception ex) {</span>
<span class="nc" id="L2367">			handleException(ex, true);</span>
<span class="nc" id="L2368">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L2370">			methodFinish();</span>
		}
	}

	public short validateAccountPolicy(ID uid) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L2375">		methodStart(&quot;validateAccountPolicy&quot;, uid);</span>
		try {
<span class="nc" id="L2377">			final User user = m_userManager.getUserByID(uid);</span>
<span class="nc bnc" id="L2378" title="All 2 branches missed.">			if (m_workResourceManager.isEmployeeTerminated(user.getEmployeeID(), null)) {</span>
<span class="nc" id="L2379">				return 6;</span>
			}
<span class="nc" id="L2381">			return m_securityManager.validateAccountPolicy(uid);</span>
<span class="nc" id="L2382">		} catch (final Exception ex) {</span>
<span class="nc" id="L2383">			handleException(ex, true);</span>
<span class="nc" id="L2384">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L2386">			methodFinish();</span>
		}
	}

	public short validatePasswordPolicy(ID uid, String password) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L2391">		methodStart(&quot;validatePasswordPolicy&quot;, uid, password);</span>
		try {
<span class="nc" id="L2393">			final DefaultLocalizationManager locMgr = DefaultLocalizationManager.getDefaultInstance();</span>
<span class="nc" id="L2394">			final LocaleContext defaultLC = locMgr.getLocaleContext();</span>
<span class="nc" id="L2395">			final List list = m_securityManager.validatePasswordPolicy(uid, password, true, defaultLC);</span>
<span class="nc bnc" id="L2396" title="All 4 branches missed.">			if ((list == null) || list.isEmpty()) {</span>
<span class="nc" id="L2397">				return 1;</span>
			}
<span class="nc" id="L2399">			return 0;</span>
<span class="nc" id="L2400">		} catch (final Exception ex) {</span>
<span class="nc" id="L2401">			handleException(ex, true);</span>
<span class="nc" id="L2402">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L2404">			methodFinish();</span>
		}
	}

	public boolean notifyLoginFailure(String userName) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L2409">		methodStart(&quot;notifyLoginFailure&quot;, userName);</span>
		try {
<span class="nc" id="L2411">			return m_securityManager.notifyLoginFailure(userName);</span>
<span class="nc" id="L2412">		} catch (final Exception ex) {</span>
<span class="nc" id="L2413">			handleException(ex, true);</span>
<span class="nc" id="L2414">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L2416">			methodFinish();</span>
		}
	}

	public void notifyLoginSuccess(String userName) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L2421">		methodStart(&quot;notifyLoginSuccess&quot;, userName);</span>
		try {
<span class="nc" id="L2423">			m_securityManager.notifyLoginSuccess(userName);</span>
<span class="nc" id="L2424">		} catch (final Exception ex) {</span>
<span class="nc" id="L2425">			handleException(ex, true);</span>
<span class="nc" id="L2426">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L2428">			methodFinish();</span>
<span class="nc" id="L2429">		}</span>
<span class="nc" id="L2430">	}</span>

	public void notifyLogout(String userName) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L2433">		methodStart(&quot;notifyLogout&quot;, userName);</span>
		try {
<span class="nc bnc" id="L2435" title="All 2 branches missed.">			if (userName == null) {</span>
<span class="nc" id="L2436">				return;</span>
			}
<span class="nc" id="L2438">			final User user = m_userManager.getUserByName(userName);</span>
<span class="nc bnc" id="L2439" title="All 2 branches missed.">			if (user == null) {</span>
<span class="nc" id="L2440">				return;</span>
			}
<span class="nc" id="L2442">			final AuditTrailEntry entry = new AuditTrailEntry(AuditTrailEntry.MODULE_SECURITY, AuditTrailEntry.ACTION_LOGOUT, user.getID(), userName, null, null);</span>
<span class="nc" id="L2443">			entry.setWho(userName);</span>
<span class="nc" id="L2444">			m_auditManager.createAuditEntry(entry);</span>
<span class="nc" id="L2445">		} catch (final Exception ex) {</span>
<span class="nc" id="L2446">			handleException(ex, true);</span>
<span class="nc" id="L2447">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L2449">			methodFinish();</span>
<span class="nc" id="L2450">		}</span>
<span class="nc" id="L2451">	}</span>

	public void updateTOHoursPerDayForOrgAfterLastPublishedDate(ID orgID) throws CorbaFacadeException {
<span class="nc" id="L2454">		methodStart(&quot;updateTOHoursPerDayForOrgAfterLastPublishedDate&quot;, orgID);</span>
		try {
<span class="nc" id="L2456">			final TONotifyMessage msg = new TONotifyMessage(TONotifyMessage.TO_NOTIFY_ORG_HOO_CHANGE);</span>
<span class="nc" id="L2457">			msg.setOrgId(orgID);</span>
<span class="nc" id="L2458">			msg.sendMessage();</span>
<span class="nc" id="L2459">		} catch (final Exception ex) {</span>
<span class="nc" id="L2460">			handleException(ex, true);</span>
<span class="nc" id="L2461">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L2463">			methodFinish();</span>
<span class="nc" id="L2464">		}</span>
<span class="nc" id="L2465">	}</span>

	// new API created for FS in 7.8.2
	public String getBPConfigValue(String key) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L2469">		methodStart(&quot;getBPConfigValue&quot;);</span>
		try {
<span class="nc" id="L2471">			return m_dbConfigManager.getValue(key);</span>
<span class="nc" id="L2472">		} catch (final Exception ex) {</span>
<span class="nc" id="L2473">			handleException(ex, true);</span>
<span class="nc" id="L2474">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L2476">			methodFinish();</span>
		}
	}

	public Collection getScheduleChangedWorkResource(Collection workResourceIDs, Date dtStart, Date dtEnd, Date changeDateFrom) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L2481">		methodStart(&quot;getScheduleChangedWorkResource&quot;, workResourceIDs, dtStart, dtEnd, changeDateFrom);</span>
		try {
<span class="nc" id="L2483">			return m_auditManager.getScheduleChangedWorkResource(workResourceIDs, dtStart, dtEnd, changeDateFrom);</span>
<span class="nc" id="L2484">		} catch (final BbmFinderException ex) {</span>
<span class="nc" id="L2485">			handleException(ex, true);</span>
<span class="nc" id="L2486">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_SCHEDULE_UPDATE_EXCEPTION);</span>
<span class="nc" id="L2487">		} catch (final Exception ex) {</span>
<span class="nc" id="L2488">			handleException(ex, true);</span>
<span class="nc" id="L2489">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L2491">			methodFinish();</span>
		}
	}

	public CFTimeBank[] getAllTimeBanks() throws CorbaFacadeException, RemoteException {
<span class="nc" id="L2496">		methodStart(&quot;getAllTimeBanks&quot;);</span>
		try {
<span class="nc" id="L2498">			return CFTimeBank.convert(m_workRulesManager.getAllTimeBanks());</span>
<span class="nc" id="L2499">		} catch (final BbmFinderException ex) {</span>
<span class="nc" id="L2500">			handleException(ex, true);</span>
<span class="nc" id="L2501">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
<span class="nc" id="L2502">		} catch (final Exception ex) {</span>
<span class="nc" id="L2503">			handleException(ex, true);</span>
<span class="nc" id="L2504">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L2506">			methodFinish();</span>
		}
	}

	public CFTimeBank getTimeBank(ID idTimeBank) throws CorbaFacadeException, RemoteException {
<span class="nc" id="L2511">		methodStart(&quot;getTimeBank&quot;, idTimeBank);</span>
		try {
<span class="nc" id="L2513">			return CFTimeBank.convert(m_workRulesManager.getTimeBank(idTimeBank));</span>
<span class="nc" id="L2514">		} catch (final BbmFinderException ex) {</span>
<span class="nc" id="L2515">			handleException(ex, true);</span>
<span class="nc" id="L2516">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
<span class="nc" id="L2517">		} catch (final Exception ex) {</span>
<span class="nc" id="L2518">			handleException(ex, true);</span>
<span class="nc" id="L2519">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L2521">			methodFinish();</span>
		}
	}

	public ID createTimeBank(CFTimeBank pTimeBank) throws CorbaFacadeException, RemoteException {
<span class="nc" id="L2526">		methodStart(&quot;createTimeBank&quot;, pTimeBank);</span>
		try {
			// return
			// m_workResourceManager.createPhantom(CFPhantom.convert(objValue));
<span class="nc" id="L2530">			return m_workRulesManager.createTimeBank(CFTimeBank.convert(pTimeBank));</span>
<span class="nc" id="L2531">		} catch (final BbmCreateException ex) {</span>
<span class="nc" id="L2532">			handleException(ex, true);</span>
<span class="nc" id="L2533">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_CREATE_EXCEPTION);</span>
<span class="nc" id="L2534">		} catch (final Exception ex) {</span>
<span class="nc" id="L2535">			handleException(ex, true);</span>
<span class="nc" id="L2536">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L2538">			methodFinish();</span>
		}
	}

	public void updateTimeBank(CFTimeBank pTimeBank) throws CorbaFacadeException, CFMultiUserException, RemoteException {
<span class="nc" id="L2543">		methodStart(&quot;updateTimeBank&quot;, pTimeBank);</span>
		try {
<span class="nc" id="L2545">			m_workRulesManager.updateTimeBank(CFTimeBank.convert(pTimeBank));</span>
<span class="nc" id="L2546">		} catch (final MultiUserException ex) {</span>
<span class="nc" id="L2547">			handleException(ex, true);</span>
<span class="nc" id="L2548">			throw CFMultiUserException.convert(ex);</span>
<span class="nc" id="L2549">		} catch (final BbmUpdateException ex) {</span>
<span class="nc" id="L2550">			handleException(ex, true);</span>
<span class="nc" id="L2551">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_UPDATE_EXCEPTION);</span>
<span class="nc" id="L2552">		} catch (final Exception ex) {</span>
<span class="nc" id="L2553">			handleException(ex, true);</span>
<span class="nc" id="L2554">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L2556">			methodFinish();</span>
<span class="nc" id="L2557">		}</span>
<span class="nc" id="L2558">	}</span>

	public void deleteTimeBank(ID idTimeBank) throws CorbaFacadeException, RemoteException {
<span class="nc" id="L2561">		methodStart(&quot;deleteTimeBank&quot;, idTimeBank);</span>
		try {
<span class="nc" id="L2563">			m_workRulesManager.deleteTimeBank(idTimeBank);</span>
<span class="nc" id="L2564">		} catch (final BbmRemoveException ex) {</span>
<span class="nc" id="L2565">			handleException(ex, true);</span>
<span class="nc" id="L2566">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_REMOVE_EXCEPTION);</span>
<span class="nc" id="L2567">		} catch (final Exception ex) {</span>
<span class="nc" id="L2568">			handleException(ex, true);</span>
<span class="nc" id="L2569">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L2571">			methodFinish();</span>
<span class="nc" id="L2572">		}</span>
<span class="nc" id="L2573">	}</span>

	public CFTimeBank[] getTimeBanksForOrganization(ID orgID) throws CorbaFacadeException, RemoteException {
<span class="nc" id="L2576">		methodStart(&quot;getTimeBanksForOrganization&quot;, orgID);</span>
		try {
<span class="nc" id="L2578">			return CFTimeBank.convert(m_workRulesManager.getTimeBanksForOrganization(orgID));</span>
<span class="nc" id="L2579">		} catch (final BbmFinderException ex) {</span>
<span class="nc" id="L2580">			handleException(ex, true);</span>
<span class="nc" id="L2581">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
<span class="nc" id="L2582">		} catch (final Exception ex) {</span>
<span class="nc" id="L2583">			handleException(ex, true);</span>
<span class="nc" id="L2584">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L2586">			methodFinish();</span>
		}
	}

	public CFTimeBank[] getTimeBanksForOrganizations(Collection orgIds, boolean findParentOrgs) throws CorbaFacadeException, RemoteException {
<span class="nc" id="L2591">		methodStart(&quot;getTimeBanksForOrganizations&quot;, orgIds, new Boolean(findParentOrgs));</span>
		try {
<span class="nc" id="L2593">			return CFTimeBank.convert(m_workRulesManager.getTimeBanksForOrganizations(orgIds, findParentOrgs));</span>
<span class="nc" id="L2594">		} catch (final BbmFinderException ex) {</span>
<span class="nc" id="L2595">			handleException(ex, true);</span>
<span class="nc" id="L2596">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
<span class="nc" id="L2597">		} catch (final Exception ex) {</span>
<span class="nc" id="L2598">			handleException(ex, true);</span>
<span class="nc" id="L2599">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L2601">			methodFinish();</span>
		}
	}

	// ========= time bank adjust related API ===========
	public CFEmployeeTimeBankAdjustCollection[] getTimeBankAdjustments(Collection empIDs, Date startDate, Date endDate) throws CorbaFacadeException, RemoteException {
<span class="nc" id="L2607">		methodStart(&quot;getTimeBankAdjustments&quot;, empIDs, startDate, endDate);</span>
		try {
<span class="nc" id="L2609">			return CFEmployeeTimeBankAdjustCollection.convert(m_empWorkRuleManager.getTimeBankAdjustments(empIDs, startDate, endDate));</span>
<span class="nc" id="L2610">		} catch (final BbmFinderException ex) {</span>
<span class="nc" id="L2611">			handleException(ex, true);</span>
<span class="nc" id="L2612">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
<span class="nc" id="L2613">		} catch (final Exception ex) {</span>
<span class="nc" id="L2614">			handleException(ex, true);</span>
<span class="nc" id="L2615">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L2617">			methodFinish();</span>
		}
	}

	public ID createTimeBankAdjustments(CFEmployeeTimeBankAdjust adjust) throws CorbaFacadeException, RemoteException {
<span class="nc" id="L2622">		methodStart(&quot;createTimeBankAdjustments&quot;, adjust);</span>
		try {
<span class="nc" id="L2624">			return m_empWorkRuleManager.createTimeBankAdjustments(CFEmployeeTimeBankAdjust.convert(adjust));</span>
<span class="nc" id="L2625">		} catch (final BbmCreateException ex) {</span>
<span class="nc" id="L2626">			handleException(ex, true);</span>
<span class="nc" id="L2627">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_CREATE_EXCEPTION);</span>
<span class="nc" id="L2628">		} catch (final Exception ex) {</span>
<span class="nc" id="L2629">			handleException(ex, true);</span>
<span class="nc" id="L2630">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L2632">			methodFinish();</span>
		}
	}

	public void deleteTimeBankAdjustments(ID empID, Date startDate, Date endDate) throws CorbaFacadeException, RemoteException {
<span class="nc" id="L2637">		methodStart(&quot;deleteTimeBankAdjustments&quot;, empID, startDate, endDate);</span>
		try {
<span class="nc" id="L2639">			m_empWorkRuleManager.deleteTimeBankAdjustments(empID, startDate, endDate);</span>
<span class="nc" id="L2640">		} catch (final BbmRemoveException ex) {</span>
<span class="nc" id="L2641">			handleException(ex, true);</span>
<span class="nc" id="L2642">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_REMOVE_EXCEPTION);</span>
<span class="nc" id="L2643">		} catch (final Exception ex) {</span>
<span class="nc" id="L2644">			handleException(ex, true);</span>
<span class="nc" id="L2645">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L2647">			methodFinish();</span>
<span class="nc" id="L2648">		}</span>
<span class="nc" id="L2649">	}</span>

	public void fixTimeBankAssignmentsForOrgChange(ID empID, ID newOrgID, Date newOrgStart, Date newOrgEnd) throws CorbaFacadeException, RemoteException {
<span class="nc" id="L2652">		methodStart(&quot;fixTimeBankAssignmentsForOrgChange&quot;, empID, newOrgID, newOrgStart, newOrgEnd);</span>
		try {
<span class="nc" id="L2654">			m_empWorkRuleManager.fixTimeBankAssignmentsForOrgChange(empID, newOrgID, newOrgStart, newOrgEnd);</span>
<span class="nc" id="L2655">		} catch (final BbmRemoveException ex) {</span>
<span class="nc" id="L2656">			handleException(ex, true);</span>
<span class="nc" id="L2657">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_REMOVE_EXCEPTION);</span>
<span class="nc" id="L2658">		} catch (final BbmFinderException ex) {</span>
<span class="nc" id="L2659">			handleException(ex, true);</span>
<span class="nc" id="L2660">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
<span class="nc" id="L2661">		} catch (final Exception ex) {</span>
<span class="nc" id="L2662">			handleException(ex, true);</span>
<span class="nc" id="L2663">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L2665">			methodFinish();</span>
<span class="nc" id="L2666">		}</span>
<span class="nc" id="L2667">	}</span>

	public CFUDFDefinition[] getUserDefinedFieldDefinitions(Collection orgIds) throws CorbaFacadeException, RemoteException {
<span class="nc" id="L2670">		methodStart(&quot;getUserDefinedFieldDefinitions&quot;, orgIds);</span>
		try {
<span class="nc" id="L2672">			return CFUDFDefinition.convert(m_workloadManager.getUserDefinedFieldDefinitions(orgIds));</span>
<span class="nc" id="L2673">		} catch (final BbmFinderException ex) {</span>
<span class="nc" id="L2674">			handleException(ex, true);</span>
<span class="nc" id="L2675">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
<span class="nc" id="L2676">		} catch (final Exception ex) {</span>
<span class="nc" id="L2677">			handleException(ex, true);</span>
<span class="nc" id="L2678">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L2680">			methodFinish();</span>
		}
	}

	/**
	 * return BbmELearningBridgeInterface object
	 *
	 * @return
	 * @throws RemoteException
	 * @throws BbmFinderException
	 */
	private BbmELearningBridgeInterface getELearningBridge() throws RemoteException, BbmFinderException {
		try {

<span class="nc" id="L2694">			final GCRManager gcrManager = CoreManagerFactory.getGCRManagerRemote(false);</span>
<span class="nc" id="L2695">			final Collection entries = gcrManager.getGCREntryOfType(BbmELearningBridgeInterface.GCR_NAME);</span>
<span class="nc bnc" id="L2696" title="All 4 branches missed.">			if ((entries == null) || entries.isEmpty()) {</span>
<span class="nc" id="L2697">				return null;</span>
			}
<span class="nc" id="L2699">			final GCREntry entry = (GCREntry) entries.iterator().next();</span>
<span class="nc" id="L2700">			final Class bridgeClass = Class.forName(entry.getHook());</span>
<span class="nc" id="L2701">			return (BbmELearningBridgeInterface) bridgeClass.newInstance();</span>

<span class="nc" id="L2703">		} catch (final Exception ex) {</span>
<span class="nc" id="L2704">			this.handleException(ex);</span>
<span class="nc" id="L2705">			throw new BbmFinderException(ex);</span>
		}
	}

	public BbmCoachingBridgeInterface getCoachingBridgeInterface() throws CoreEJBCreateException, CoreFinderException, RemoteException, ClassNotFoundException, InstantiationException, IllegalAccessException {
		// get the implementation class of the BBM-Coaching bridge from the
		// global code registry
<span class="nc" id="L2712">		final GCRManager gcrManager = CoreManagerFactory.getGCRManagerRemote(false);</span>
<span class="nc" id="L2713">		final Collection entries = gcrManager.getGCREntryOfType(BbmCoachingBridgeInterface.GCR_NAME);</span>
<span class="nc bnc" id="L2714" title="All 4 branches missed.">		if ((entries == null) || entries.isEmpty()) {</span>
<span class="nc" id="L2715">			return null;</span>
		}

		// should only have one entry if the customer has the license of
		// coaching
<span class="nc" id="L2720">		final GCREntry entry = (GCREntry) entries.iterator().next();</span>
<span class="nc" id="L2721">		final Class bridgeClass = Class.forName(entry.getHook());</span>

<span class="nc" id="L2723">		return (BbmCoachingBridgeInterface) bridgeClass.newInstance();</span>
	}

	public void createSchedulerAuditEntry(String action, ID spID, HashMap properties) throws CorbaFacadeException, RemoteException {
<span class="nc" id="L2727">		methodStart(&quot;createSchedulerAuditEntry&quot;, action, spID, properties);</span>
		try {
<span class="nc" id="L2729">			final AuditTrailEntry entry = new AuditTrailEntry();</span>

<span class="nc" id="L2731">			entry.setModuleID(AuditTrailEntry.MODULE_SCHEDULING);</span>

<span class="nc bnc" id="L2733" title="All 2 branches missed.">			if (action.equalsIgnoreCase(&quot;START&quot;)) {</span>
<span class="nc" id="L2734">				entry.setActionType(AuditTrailEntry.ACTION_SCHEDULER_START);</span>
<span class="nc bnc" id="L2735" title="All 2 branches missed.">			} else if (action.equalsIgnoreCase(&quot;COMPLETE&quot;)) {</span>
<span class="nc" id="L2736">				entry.setActionType(AuditTrailEntry.ACTION_SCHEDULER_COMPLETE);</span>
			} else {
<span class="nc" id="L2738">				throw new Exception(&quot;Invalid action&quot;);</span>
			}

<span class="nc" id="L2741">			final SchedulingPeriod sp = m_campaignManager.getSchedulingPeriodByID(spID);</span>
<span class="nc" id="L2742">			final Campaign camp = m_campaignManager.getCampaignByID(sp.getCampaignID());</span>

<span class="nc" id="L2744">			entry.setPrimaryObjectID(spID);</span>
<span class="nc" id="L2745">			entry.setPrimaryObjectName(camp.getName() + &quot;: &quot; + sp.getName());</span>
<span class="nc" id="L2746">			entry.setTimeStamp(new java.util.Date());</span>

<span class="nc bnc" id="L2748" title="All 2 branches missed.">			for (final Object prop : properties.keySet()) {</span>
<span class="nc" id="L2749">				entry.addProperty(prop.toString(), properties.get(prop).toString(), &quot;SCHEDULEPARAMS&quot;, false);</span>
<span class="nc" id="L2750">			}</span>
<span class="nc" id="L2751">			m_auditManager.createAuditEntry(entry);</span>

			// For SFP: Update the ScheduleRunStatus table to view last status
			// of scheduling period

<span class="nc" id="L2756">			String userRunSchedule = &quot;&quot;;</span>
<span class="nc bnc" id="L2757" title="All 2 branches missed.">			if (action.equalsIgnoreCase(&quot;START&quot;)) {</span>
				// For SFP: Update the ScheduleRunStatus table to view last
				// status of scheduling period
<span class="nc" id="L2760">				userRunSchedule = properties.get(&quot;UserName&quot;).toString();</span>
<span class="nc" id="L2761">				final String mode = properties.get(&quot;Scheduling Mode&quot;).toString();</span>
<span class="nc bnc" id="L2762" title="All 2 branches missed.">				if (mode.equals(&quot;SCHEDULENOUI&quot;)) {</span>
<span class="nc" id="L2763">					m_scheduleAccessManager.updateStatusForScheduleRun(spID, ScheduleRunStatus.STATUS_START, userRunSchedule);</span>
					// End For SFP
				}
<span class="nc bnc" id="L2766" title="All 2 branches missed.">			} else if (action.equalsIgnoreCase(&quot;COMPLETE&quot;)) {</span>
<span class="nc" id="L2767">				m_scheduleAccessManager.updateStatusForScheduleRun(spID, ScheduleRunStatus.getStatusByString(properties.get(&quot;Status&quot;).toString()), null);</span>
				// End For SFP
			} else {
<span class="nc" id="L2770">				throw new Exception(&quot;Invalid action&quot;);</span>
			}

<span class="nc" id="L2773">		} catch (final BbmFinderException ex) {</span>
<span class="nc" id="L2774">			handleException(ex, true);</span>
<span class="nc" id="L2775">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_BBM_FINDER_EXCEPTION);</span>
<span class="nc" id="L2776">		} catch (final Exception ex) {</span>
<span class="nc" id="L2777">			handleException(ex, true);</span>
<span class="nc" id="L2778">			throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
		} finally {
<span class="nc" id="L2780">			methodFinish();</span>
<span class="nc" id="L2781">		}</span>
<span class="nc" id="L2782">	}</span>

	public void linkWorkResourcesToSchedulingPeriod(ID sid, Collection employeeIds) throws BbmCreateException {
<span class="nc" id="L2785">		methodStart(&quot;linkWorkResourcesToSchedulingPeriod&quot;, sid, employeeIds);</span>
		try {
<span class="nc" id="L2787">			m_scheduleAccessManager.linkWorkResourcesToSchedulingPeriod(sid, employeeIds);</span>
<span class="nc" id="L2788">		} catch (Exception e) {</span>
<span class="nc" id="L2789">			handleException(e);</span>
<span class="nc" id="L2790">			throw new BbmCreateException(e);</span>
		} finally {
<span class="nc" id="L2792">			methodFinish();</span>
<span class="nc" id="L2793">		}</span>
<span class="nc" id="L2794">	}</span>
    public void linkShiftAssignmentsToSchedulingPeriod(ID spID) throws RemoteException, CorbaFacadeException {
<span class="nc" id="L2796">        methodStart(&quot;linkShiftAssignmentsToSchedulingPeriod&quot;, spID);</span>
        try {
<span class="nc" id="L2798">            m_scheduleAccessManager.linkShiftAssignmentsToSchedulingPeriod(spID);</span>
<span class="nc" id="L2799">        } catch (final Exception ex) {</span>
<span class="nc" id="L2800">            handleException(ex, true);</span>
<span class="nc" id="L2801">            throw new CorbaFacadeException(ex.getMessage(), CorbaFacadeException.TYPE_SYSTEM_EXCEPTION);</span>
        } finally {
<span class="nc" id="L2803">            methodFinish();</span>
<span class="nc" id="L2804">        }</span>
<span class="nc" id="L2805">    }</span>
		
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>