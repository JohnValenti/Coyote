<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>AgentsRequestsPM.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.rm.requests</a> &gt; <span class="el_source">AgentsRequestsPM.java</span></div><h1>AgentsRequestsPM.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.rm.requests;

import java.text.MessageFormat;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.Collection;
import java.util.Collections;
import java.util.Date;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Map;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.IDStringPair;
import com.bluepumpkin.common.l10n.RegionalFormatBundleKey;
import com.bluepumpkin.common.util.StringUtil;
import com.bluepumpkin.ejb.bbm.BbmManagerFactory;
import com.bluepumpkin.ejb.bbm.config.ConfigKey;
import com.bluepumpkin.ejb.bbm.timeoffcalculator.TOCalcUtil;
import com.bluepumpkin.ejb.bbm.workresource.OrganizationScopeManagerProxy;
import com.bluepumpkin.ejb.bbm.workresource.model.Employee;
import com.bluepumpkin.ejb.bbm.workresource.model.EmployeeName;
import com.bluepumpkin.ejb.rm.base.RmHardValidationException;
import com.bluepumpkin.ejb.rm.config.RequestManagementConfigKey;
import com.bluepumpkin.ejb.rm.requests.common.model.Request;
import com.bluepumpkin.ejb.rm.requests.common.model.RequestAggregate;
import com.bluepumpkin.ejb.rm.requests.common.model.RequestAuditTrail;
import com.bluepumpkin.ejb.rm.requests.common.validation.ValidationUtil;
import com.bluepumpkin.ejb.rm.requests.commonrequestmanager.model.RequestCollection;
import com.bluepumpkin.ejb.rm.requests.commonrequestmanager.model.RequestFilter;
import com.bluepumpkin.ejb.rm.requests.custshift.model.CustShiftReq;
import com.bluepumpkin.ejb.rm.requests.shiftbid.shiftbidrequest.model.ShiftBidRequest;
import com.bluepumpkin.ejb.rm.requests.swap.request.model.ShiftSwapRequest;
import com.bluepumpkin.ejb.rm.requests.timeoff.model.TORequest;
import com.bluepumpkin.ejb.rm.util.LicenseUtil;
import com.bluepumpkin.ejb.rm.util.TORequestUtil;
import com.bluepumpkin.web.core.pagecomponent.CheckBoxPC;
import com.bluepumpkin.web.rm.keys.RmKeys;
import com.bluepumpkin.web.rm.keys.RmPageAction;
import com.bluepumpkin.web.rm.l10n.RmWebBundleKey;
import com.bluepumpkin.web.rm.requests.filter.RequestsFilterBoxPC;
import com.witness.ejb.core.security.PrivilegeKeys;
import com.witness.web.uif.base.Message;
import com.witness.web.uif.data.wrapper.DateWrapper;
import com.witness.web.uif.data.wrapper.NumberWrapper;
import com.witness.web.uif.keys.ImageFileID;
import com.witness.web.uif.keys.JavaScriptFileID;
import com.witness.web.uif.keys.PageAction;
import com.witness.web.uif.keys.PageKeys;
import com.witness.web.uif.l10n.UIFWebBundleKey;
import com.witness.web.uif.listconfig.ListConfig;
import com.witness.web.uif.listconfig.ListConfigFP;
import com.witness.web.uif.listconfig.ListConfigSelectorPC;
import com.witness.web.uif.pagecomponent.DefaultMultiColumnNodeData;
import com.witness.web.uif.pagecomponent.MultiColumnNodeData;
import com.witness.web.uif.pagecomponent.dialog.DialogToolbarMenuPC;
import com.witness.web.uif.pagecomponent.list.MultiColListPC;
import com.witness.web.uif.pagecomponent.picker.date.DatePickerPC;
import com.witness.web.uif.pagecomponent.picker.date.DateRangePickerPC;
import com.witness.web.uif.pagecomponent.table.GenericHeaderData;
import com.witness.web.uif.pagecomponent.table.TableHeaderPC;
import com.witness.web.uif.pagecomponent.toolbar.ToolbarTextButton;
import com.witness.web.uif.pagemodel.PageModel;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.system.manager.impl.DefaultVerticalizationManager;
import com.witness.web.uif.util.HtmlUtil;
import com.witness.web.uif.util.MultiColPCFactory;
import com.witness.web.uif.util.js.JSUtil;
import com.witness.web.uif.util.reflection.ParameterUtil;

/**
 * Title:        AgentsRequestsPM
 * Description:  Handle Agents Requests
 * Copyright:    Copyright (c) 2002
 * Company:      Blue Pumpkin Software, inc
 * @author       David Su
 * @version      1.0
 */
public class AgentsRequestsPM extends RequestsPM {
	protected static final String GROUP_ACTION_MENU_NAME = &quot;DIALOG_GROUP_ACTIONS&quot;;
	protected static final String GROUP_ACTION_WARN_JS_VAR = &quot;GRP_ACTION_WARN&quot;;
	protected static final String GROUP_ACTION_WARN_FOR_VTO_JS_VAR = &quot;GRP_ACTION_WARN_FOR_VTO&quot;;
	private static final String DATE_CHOICE_FN = &quot;dateChoice&quot;;
	private static final String ALERTS_CHECKBOX_STATE = &quot;isAlertsCheckedOnPage&quot;;
	private static final String ALERTS_TOGGLED_STATE = &quot;isAlertsToggledOnPage&quot;;
	public static final String IS_ON_SAME_PAGE_FN = &quot;isOnSamePage&quot;;
	public static final String IS_ON_SAME_PAGE_FOR_EDIT_FN = &quot;isOnSamePageForEdit&quot;;

	protected DialogToolbarMenuPC m_groupActionDialogMenuPC;
	protected DialogToolbarMenuPC m_newRequestMenuPC;

	protected RequestsFilterBoxPC m_rfilterBoxPC;
	protected ListConfigSelectorPC m_lcSelectorPC;
	protected RequestCollection m_reqCollection;
<span class="nc" id="L96">	protected Map m_eOrgMap = Collections.emptyMap();</span>
<span class="nc" id="L97">	protected Map m_eNameMap = Collections.emptyMap();</span>
<span class="nc" id="L98">	protected Collection m_pageRequestsObjVer = Collections.emptyList();</span>
<span class="nc" id="L99">	protected boolean m_isReqCollectionLoaded = false;</span>
<span class="nc" id="L100">	protected boolean m_isBlankFilterSelected = false;</span>
<span class="nc" id="L101">	private Map&lt;ID, Boolean&gt; m_auctionMap = new HashMap&lt;ID, Boolean&gt;();</span>
	protected RequestFilter m_requestFilter;
	protected DateRangePickerPC m_dateRangePickerPC;
	protected CheckBoxPC m_checkBoxPC;

	private boolean m_isDPAction;

<span class="nc" id="L108">	protected boolean m_isConfigNetStaffingValidationEnabled = true; // flag to indicate if the Net staffing validation is to be run on requests;</span>
																		// by default, this rule is enabled to run on requests	as they load
<span class="nc" id="L110">	protected String m_alertsCheckedOnPage = &quot;&quot;; // records alert checkbox's checked state via actions on page</span>
<span class="nc" id="L111">	protected boolean m_configuredCheckboxState = true; // records alert checkbox's checked state via database configuration;</span>
														// by default, alerts are enabled, so all validations will be run on requests as they load

<span class="nc" id="L114">	protected String m_alertsToggledOnPage = Boolean.FALSE.toString(); // records if the alerts checkbox was toggled on page; by default, its toggle state is false.</span>
	private boolean shouldBeOnSamePage;
	private boolean shouldBeOnSamePageForEdit;
	private static final String ONCHANGE_PAGE_REFRESH = &quot;var refreshPage = true;&quot;;
	protected RequestCollection allReqCollection;
<span class="nc" id="L119">	private boolean hasAdvancedVTORequest = false;</span>

	private static final String APPROVE_ALL_REQUESTS_PROCESSING_MSG=&quot;APPROVE_ALL_REQUESTS_PROCESSING_MSG&quot;;
	private static final String INTERUPT_APPROVE_ALL_REQUESTS_MSG=&quot;INTERUPT_APPROVE_ALL_REQUESTS_MSG&quot;;
	private static final String APPROVE_ALL_REQUESTS_DONE_ALL_CONFIRMATION_MSG=&quot;APPROVE_ALL_REQUESTS_DONE_ALL_CONFIRMATION_MSG&quot;;
	private static final String APPROVE_ALL_REQUESTS_DONE_NONE_CONFIRMATION_MSG=&quot;APPROVE_ALL_REQUESTS_DONE_NONE_CONFIRMATION_MSG&quot;;
	private static final String APPROVE_ALL_REQUESTS_HAS_ERROR_MSG=&quot;APPROVE_ALL_REQUESTS_HAS_ERROR_MSG&quot;;
	private static final String APPROVE_ALL_REQUESTS_MSG=&quot;APPROVE_ALL_REQUESTS_MSG&quot;;
	private static final String APPROVE_ALL_REQUESTS_NO_PENDING_MSG=&quot;APPROVE_ALL_REQUESTS_NO_PENDING_MSG&quot;;
	private static final String APPROVE_ALL_REQUESTS_CANCEL_CONFIRMATION_MSG=&quot;APPROVE_ALL_REQUESTS_CANCEL_CONFIRMATION_MSG&quot;;
	private static final String INTERRUP_ALL_REQUESTS_INFO_MSG=&quot;INTERRUP_ALL_REQUESTS_INFO_MSG&quot;;
	private static final String CANCELLING_ALL_REQUESTS_PROCESS=&quot;CANCELLING_ALL_REQUESTS_PROCESS&quot;;

	/**
	 * Constructor
	 */
	public AgentsRequestsPM(RequestContext context) {
<span class="nc" id="L136">		this(context, Request.REQUESTTYPE_ALL, true);</span>
<span class="nc" id="L137">	}</span>

	/**
	 * Constructor
	 */
	public AgentsRequestsPM(RequestContext context, String requestType) {
<span class="nc" id="L143">		this(context, requestType, true);</span>
<span class="nc" id="L144">	}</span>

	/**
	 * Constructor
	 */
	public AgentsRequestsPM(RequestContext context, String requestType, boolean showFilter) {
<span class="nc" id="L150">		super(context, requestType, showFilter);</span>

<span class="nc" id="L152">		m_lcSelectorPC = createListConfigSelectorPC();</span>
<span class="nc bnc" id="L153" title="All 2 branches missed.">		if (showFilter) {</span>
<span class="nc" id="L154">			m_rfilterBoxPC = new RequestsFilterBoxPC(context);</span>
<span class="nc" id="L155">			m_filterBoxPC = m_rfilterBoxPC;</span>
<span class="nc bnc" id="L156" title="All 2 branches missed.">			if (isAccessibilityComplianceMode()) {</span>
<span class="nc" id="L157">				m_rfilterBoxPC.setUseWrapper(true);</span>
<span class="nc" id="L158">				m_rfilterBoxPC.setWrapperRegion(true);</span>
<span class="nc" id="L159">				m_rfilterBoxPC.getListbox().setOnChange(ONCHANGE_PAGE_REFRESH);</span>
<span class="nc" id="L160">				m_lcSelectorPC.setOnChange(ONCHANGE_PAGE_REFRESH);</span>
<span class="nc" id="L161">				m_list.setUseWrapper(true);</span>
			}
<span class="nc" id="L163">			addChildComponent(m_filterBoxPC);</span>
<span class="nc" id="L164">			addChildComponent(m_lcSelectorPC);</span>
		}
		// Create the alert check-box and set its checked state to enable or disable all validations on requests as they load.

		// Alerts check-box checked/unchecked state is always driven by what configured in BPCONFIG for first time page loads.
		// Configured check box state is overridden for page action changes to the check-box state.
<span class="nc" id="L170">		readAlertsCheckboxConfig(); // read configured alerts check-box state</span>

<span class="nc" id="L172">		String pageAlertCheckBoxAction = ParameterUtil.getParameter(context.getRequest(), ALERTS_CHECKBOX_STATE); // page action's alert check-box state</span>
<span class="nc" id="L173">		String sessionAlertCheckBoxAction = (String) context.getAttribute(RequestContext.SESSION_SCOPE, ALERTS_CHECKBOX_STATE); // session scope alert checkbox state</span>

		// if check-box state is passed as a request parameter, use that and store in session.
		// if check-box state is not a request parameter, check session and use value in session if present;
		// else use the BPCONFIG value.
<span class="nc bnc" id="L178" title="All 4 branches missed.">		if (StringUtil.isEmpty(pageAlertCheckBoxAction) &amp;&amp; StringUtil.isEmpty(sessionAlertCheckBoxAction)) {</span>
<span class="nc" id="L179">			m_alertsCheckedOnPage = String.valueOf(m_configuredCheckboxState);</span>
<span class="nc bnc" id="L180" title="All 4 branches missed.">		} else if (StringUtil.isEmpty(pageAlertCheckBoxAction) &amp;&amp; !StringUtil.isEmpty(sessionAlertCheckBoxAction)) {</span>
<span class="nc" id="L181">			m_alertsCheckedOnPage = sessionAlertCheckBoxAction;</span>
		} else {
<span class="nc" id="L183">			m_alertsCheckedOnPage = pageAlertCheckBoxAction;</span>
<span class="nc" id="L184">			context.setAttribute(RequestContext.SESSION_SCOPE, ALERTS_CHECKBOX_STATE, pageAlertCheckBoxAction);</span>
		}

<span class="nc" id="L187">		m_checkBoxPC = new CheckBoxPC(m_context, getName() + &quot;_checkboxPC&quot;, Boolean.parseBoolean(m_alertsCheckedOnPage),</span>
<span class="nc" id="L188">				getCheckboxCheckedJS(), getCheckboxUncheckedJS());</span>
<span class="nc bnc" id="L189" title="All 2 branches missed.">		for (String js : m_checkBoxPC.getRequireJavaScriptFiles()) {</span>
<span class="nc" id="L190">			addRequiredJavaScriptFile(js);</span>
<span class="nc" id="L191">		}</span>
<span class="nc" id="L192">		addRequiredJavaScriptFile(JavaScriptFileID.JQUERY);</span>
<span class="nc" id="L193">		String checkBoxLabel = m_context.getLocalizer().i18n(m_bundle, RmWebBundleKey.ALERTS);</span>

<span class="nc" id="L195">		m_checkBoxPC.setEnabled(true);</span>
<span class="nc" id="L196">		m_checkBoxPC.setLabel(checkBoxLabel);</span>
<span class="nc bnc" id="L197" title="All 2 branches missed.">		if(!isAccessibilityComplianceMode()) {</span>
<span class="nc" id="L198">			m_checkBoxPC.setTitle(checkBoxLabel);</span>
		} else {
<span class="nc" id="L200">			m_checkBoxPC.setTitle(checkBoxLabel + &quot;, &quot; +i18n(m_common_bundle, UIFWebBundleKey.CHECKBOX_CHECK_CAUTION_MESSAGE));</span>
		}

<span class="nc" id="L203">		addChildComponent(m_checkBoxPC);</span>

<span class="nc" id="L205">		m_dateRangePickerPC = new DateRangePickerPC(m_context, DATE_CHOICE_FN);</span>
<span class="nc" id="L206">		m_dateRangePickerPC.setOnChangeJS(JSUtil.REFRESH_PAGE);</span>
<span class="nc" id="L207">		addChildComponent(m_dateRangePickerPC);</span>

<span class="nc" id="L209">		setDefaultPageIDSize(10);</span>
<span class="nc" id="L210">		readNetStaffingValidationConfig();</span>
<span class="nc" id="L211">		addJSVariable(APPROVE_ALL_REQUESTS_MSG, m_bundle, RmWebBundleKey.APPROVE_ALL_REQUESTS_MSG);</span>
<span class="nc" id="L212">		addJSVariable(APPROVE_ALL_REQUESTS_PROCESSING_MSG, m_bundle, RmWebBundleKey.APPROVE_ALL_REQUESTS_PROCESSING_MSG);</span>
<span class="nc" id="L213">		addJSVariable(INTERUPT_APPROVE_ALL_REQUESTS_MSG, m_bundle, RmWebBundleKey.INTERUPT_APPROVE_ALL_REQUESTS_MSG);</span>
<span class="nc" id="L214">		addJSVariable(APPROVE_ALL_REQUESTS_DONE_ALL_CONFIRMATION_MSG, m_bundle, RmWebBundleKey.APPROVE_ALL_REQUESTS_DONE_ALL_CONFIRMATION_MSG);</span>
<span class="nc" id="L215">		addJSVariable(APPROVE_ALL_REQUESTS_DONE_NONE_CONFIRMATION_MSG, m_bundle, RmWebBundleKey.APPROVE_ALL_REQUESTS_DONE_NONE_CONFIRMATION_MSG);</span>
<span class="nc" id="L216">		addJSVariable(APPROVE_ALL_REQUESTS_HAS_ERROR_MSG, m_bundle, RmWebBundleKey.APPROVE_ALL_REQUESTS_HAS_ERROR_MSG);</span>
<span class="nc" id="L217">		addJSVariable(APPROVE_ALL_REQUESTS_MSG,m_bundle, RmWebBundleKey.APPROVE_ALL_REQUESTS_MSG);</span>
<span class="nc" id="L218">		addJSVariable(APPROVE_ALL_REQUESTS_NO_PENDING_MSG,m_bundle, RmWebBundleKey.APPROVE_ALL_REQUESTS_NO_PENDING_MSG);</span>
<span class="nc" id="L219">		addJSVariable(APPROVE_ALL_REQUESTS_CANCEL_CONFIRMATION_MSG,m_bundle,RmWebBundleKey.APPROVE_ALL_REQUESTS_CANCEL_CONFIRMATION_MSG);</span>
<span class="nc" id="L220">		addJSVariable(INTERRUP_ALL_REQUESTS_INFO_MSG,m_bundle,RmWebBundleKey.INTERRUP_ALL_REQUESTS_INFO_MSG);</span>
<span class="nc" id="L221">		addJSVariable(CANCELLING_ALL_REQUESTS_PROCESS,m_bundle,RmWebBundleKey.CANCELLING_ALL_REQUESTS_PROCESS);</span>
<span class="nc" id="L222">	}</span>

	/**
	 * Initialize JavaScript Variables
	 */
	@Override
	public void initJSVariables() {
<span class="nc" id="L229">		super.initJSVariables();</span>
<span class="nc" id="L230">		addJSVariableAsString(RmKeys.PAGE_MODE_FN, RmKeys.RP_MODE_MGR);</span>
<span class="nc bnc" id="L231" title="All 2 branches missed.">		if(hasAdvancedVTORequest) {</span>
<span class="nc" id="L232">			addJSVariable(GROUP_ACTION_WARN_JS_VAR, m_bundle, RmWebBundleKey.GROUP_ACTION_WARNING_WITH_VTO);</span>
		} else {
<span class="nc" id="L234">			addJSVariable(GROUP_ACTION_WARN_JS_VAR, m_bundle, RmWebBundleKey.GROUP_ACTION_WARNING);</span>
		}
<span class="nc" id="L236">		addJSVariable(GROUP_ACTION_WARN_FOR_VTO_JS_VAR, m_bundle, RmWebBundleKey.GROUP_ACTION_WARNING);</span>

<span class="nc" id="L238">		m_context.addGenericHTML(HtmlUtil.makeHiddenInput(&quot;isDPAction&quot;, &quot;false&quot;));</span>
<span class="nc" id="L239">		m_context.addGenericHTML(HtmlUtil.makeHiddenInput(ALERTS_CHECKBOX_STATE, m_alertsCheckedOnPage));</span>

<span class="nc" id="L241">		m_context.addGenericHTML(HtmlUtil.makeHiddenInput(ALERTS_TOGGLED_STATE, m_alertsToggledOnPage));</span>
<span class="nc" id="L242">		m_context.addGenericHTML(HtmlUtil.makeHiddenInput(IS_ON_SAME_PAGE_FN, false));</span>
<span class="nc" id="L243">		m_context.addGenericHTML(HtmlUtil.makeHiddenInput(IS_ON_SAME_PAGE_FOR_EDIT_FN, false));</span>

<span class="nc" id="L245">	}</span>

	/**
	 * Return an instance of AgentsRequestsPM ready to be rendered in JSP
	 */
	public static PageModel getInstance(RequestContext context) throws Exception {
<span class="nc" id="L251">		return getInstance(context, AgentsRequestsPM.class);</span>
	}


	@Override
	protected MultiColListPC getMultiColListPC(RequestContext context) {
<span class="nc" id="L257">		MultiColListPC mListPC = MultiColPCFactory.getMultiColListPC(context,</span>
<span class="nc" id="L258">				getLocalizer().i18n(RmWebBundleKey.BUNDLE_NAME, RmWebBundleKey.EMPLOYEE_REQUESTS_GRID), true, true);</span>
<span class="nc" id="L259">		return MultiColPCFactory.addAriaToMultiColListPC(mListPC, context, true, true, true, true, true);</span>
	}

	/**
	 * Populate Model
	 */
	@Override
	protected void loadData() throws Exception {
<span class="nc" id="L267">		m_lcSelectorPC.init();</span>
<span class="nc bnc" id="L268" title="All 2 branches missed.">		if (m_empID == null) {</span>
<span class="nc" id="L269">			return;</span>
		}

<span class="nc" id="L272">		m_orgSetting = RequestsMH.getOrgSettingForEmployee(m_context, m_empID);</span>

<span class="nc" id="L274">		initRequestFilter();</span>
<span class="nc" id="L275">		initDateRangePickerPC();</span>

<span class="nc" id="L277">		loadSpecifyData();</span>
<span class="nc" id="L278">		initRequestCollection();</span>
<span class="nc" id="L279">		loadOrgMap();</span>
<span class="nc" id="L280">	}</span>

	/**
	 * Initialize Model with specified Data
	 */
	public void init(RequestCollection reqCollection) {
<span class="nc" id="L286">		m_reqCollection = reqCollection;</span>
<span class="nc" id="L287">		m_eNameMap = reqCollection.getNameMap();</span>
<span class="nc" id="L288">		m_isReqCollectionLoaded = true;</span>
<span class="nc" id="L289">		hasAdvancedVTORequest = checkIfListRequestHasVTORequests();</span>
		//Port for QA 84438:The list of requestID of a page is
		//not set value when view the pending request from the TO calendar
<span class="nc bnc" id="L292" title="All 2 branches missed.">		if (getPageIDs().isEmpty()) {</span>
<span class="nc" id="L293">			initPaginationIDs(reqCollection.getIds());</span>
		}
<span class="nc" id="L295">	}</span>

	/**
	 * JS onClick handler for alert checkbox's checked state
	 * @return js
	 */
	private String getCheckboxCheckedJS() {
<span class="nc" id="L302">		StringBuilder sb = new StringBuilder();</span>
<span class="nc" id="L303">		sb.append(&quot;var prevToggle = document.oFormMain.isAlertsCheckedOnPage.value;&quot;)</span>
<span class="nc" id="L304">				.append(&quot;if (prevToggle != \'true\') document.oFormMain.&quot;).append(ALERTS_TOGGLED_STATE).append(&quot;.value = \'true\';&quot;)</span>
<span class="nc" id="L305">				.append(&quot;document.oFormMain.&quot;).append(ALERTS_CHECKBOX_STATE).append(&quot;.value = \'true\';&quot;)</span>
<span class="nc" id="L306">				.append(JSUtil.RESET_PAGEDIRTY)</span>
<span class="nc" id="L307">				.append(JSUtil.REFRESH_RESET_PAGEDIRTY);</span>

<span class="nc" id="L309">		return sb.toString();</span>
	}

	/**
	 * JS onClick handler for alert checkbox's unchecked state
	 * @return js
	 */
	private String getCheckboxUncheckedJS() {
<span class="nc" id="L317">		StringBuilder sb = new StringBuilder();</span>
<span class="nc" id="L318">		sb.append(&quot;var prevToggle = document.oFormMain.isAlertsCheckedOnPage.value;&quot;)</span>
<span class="nc" id="L319">				.append(&quot;if (prevToggle != \'false\') document.oFormMain.&quot;).append(ALERTS_TOGGLED_STATE).append(&quot;.value = \'true\';&quot;)</span>
<span class="nc" id="L320">				.append(&quot;document.oFormMain.&quot;).append(ALERTS_CHECKBOX_STATE).append(&quot;.value = \'false\';&quot;)</span>
<span class="nc" id="L321">				.append(JSUtil.RESET_PAGEDIRTY)</span>
<span class="nc" id="L322">				.append(JSUtil.REFRESH_RESET_PAGEDIRTY);</span>

<span class="nc" id="L324">		return sb.toString();</span>
	}

	/**
	 * Create and add Date Range Picker as Child Component
	 */
	private void initDateRangePickerPC() {
		// initialize date pickers properties
<span class="nc" id="L332">		DatePickerPC startDatePC = m_dateRangePickerPC.getStartDatePickerPC();</span>
<span class="nc" id="L333">		DatePickerPC endDatePC = m_dateRangePickerPC.getEndDatePickerPC();</span>

		// set upper date limit to 12/31/2078
<span class="nc" id="L336">		Calendar cal = Calendar.getInstance(m_context.getViewingTimeZone());</span>
<span class="nc" id="L337">		cal.set(2078, 11, 31, 23, 59, 59);</span>
<span class="nc" id="L338">		endDatePC.setUpperLimit(cal.getTime());</span>
<span class="nc" id="L339">		addChildComponent(m_dateRangePickerPC);</span>
<span class="nc" id="L340">		m_dateRangePickerPC.setOnChangeJS(&quot;document.oFormMain.isDPAction.value = \'true\';&quot;</span>
				 + JSUtil.RESET_PAGEDIRTY
					+  JSUtil.REFRESH_RESET_PAGEDIRTY);

<span class="nc bnc" id="L344" title="All 2 branches missed.">		Date sDate = startDatePC.getDate() != null ? startDatePC.getDate() : null;</span>
<span class="nc bnc" id="L345" title="All 2 branches missed.">		Date eDate = endDatePC.getDate() != null ? endDatePC.getDate() : null;</span>
<span class="nc bnc" id="L346" title="All 2 branches missed.">		if (!m_isDPAction) {</span>
<span class="nc" id="L347">			List dates = null;</span>
<span class="nc bnc" id="L348" title="All 2 branches missed.">			if (m_requestFilter != null) {</span>
<span class="nc" id="L349">				dates = (List) m_requestFilter.getValueForKey(RequestFilter.REQUEST_DATE_RANGE_KEY);</span>
<span class="nc bnc" id="L350" title="All 4 branches missed.">				if (dates != null &amp;&amp; !dates.isEmpty()) {</span>
<span class="nc" id="L351">					sDate = (Date) dates.get(0);</span>
<span class="nc" id="L352">					eDate = (Date) dates.get(1);</span>
				}
			}

<span class="nc bnc" id="L356" title="All 2 branches missed.">			if (sDate == null) {</span>
				//get from profile
<span class="nc" id="L358">				String sDateDtr = m_context.getUserProperty(RmKeys.REQUEST_FILTER_START_DATE);</span>
<span class="nc" id="L359">				String eDateDtr = m_context.getUserProperty(RmKeys.REQUEST_FILTER_END_DATE);</span>

<span class="nc bnc" id="L361" title="All 2 branches missed.">				if (sDateDtr != null) {</span>
<span class="nc" id="L362">					sDate = new Date(Long.valueOf(sDateDtr).longValue());</span>
				} else {
<span class="nc" id="L364">					sDate = new Date();</span>
				}

<span class="nc bnc" id="L367" title="All 2 branches missed.">				if (eDateDtr != null) {</span>
<span class="nc" id="L368">					eDate = new Date(Long.valueOf(eDateDtr).longValue());</span>
				} else {
<span class="nc" id="L370">					eDate = new Date();</span>
					//set to current date + 30 days
<span class="nc" id="L372">					Calendar aCal = Calendar.getInstance();</span>
<span class="nc" id="L373">					aCal.setTime(sDate);</span>
					//add 30 days
<span class="nc" id="L375">					TOCalcUtil.addDaysToCalendar(aCal, 30);</span>
					//aCal.add(Calendar.DAY_OF_MONTH, 30);
<span class="nc" id="L377">					eDate.setTime(aCal.getTime().getTime());</span>
				}
			}
		}

		//now save the user properties
<span class="nc" id="L383">		m_dateRangePickerPC.getStartDatePickerPC().setDate(sDate);</span>
<span class="nc" id="L384">		m_dateRangePickerPC.getEndDatePickerPC().setDate(eDate);</span>

<span class="nc" id="L386">		HashMap propMap = new HashMap(2);</span>
<span class="nc bnc" id="L387" title="All 2 branches missed.">		if (sDate != null) {</span>
<span class="nc" id="L388">			propMap.put(RmKeys.REQUEST_FILTER_START_DATE, String.valueOf(sDate.getTime()));</span>
		}
<span class="nc bnc" id="L390" title="All 2 branches missed.">		if (eDate != null) {</span>
<span class="nc" id="L391">			propMap.put(RmKeys.REQUEST_FILTER_END_DATE, String.valueOf(eDate.getTime()));</span>
		}

		//set dates to the profile
<span class="nc" id="L395">		m_context.setUserProperties(propMap);</span>
<span class="nc" id="L396">	}</span>

	/**
	 * Return true if no Requests are available
	 */
	protected boolean isEmptyRequests() {
<span class="nc bnc" id="L402" title="All 4 branches missed.">		return m_reqCollection == null || m_reqCollection.isEmpty();</span>
	}

	/**
	 * Initialize Request Collection
	 */
	protected void initRequestCollection() throws Exception {
<span class="nc bnc" id="L409" title="All 6 branches missed.">		if (m_empID != null &amp;&amp; !m_isReqCollectionLoaded &amp;&amp; m_isPageEnabled) {</span>
<span class="nc" id="L410">			init(getRequestCollection());</span>
		}
<span class="nc" id="L412">	}</span>

	/**
	 * Return Request Collection
	 */
	protected RequestCollection getRequestCollection() throws Exception {
<span class="nc" id="L418">		boolean isSoftValEnabled = isSoftValEanbled();</span>
<span class="nc" id="L419">		boolean isNetStaffingSoftValEnabled = isNetStaffingSoftValEnabled();</span>
<span class="nc" id="L420">		RequestCollection result = null;</span>
		try {
<span class="nc bnc" id="L422" title="All 2 branches missed.">			ID reqFilterID = m_rfilterBoxPC != null ? m_rfilterBoxPC.getSelectedFilterID() : null;</span>

<span class="nc bnc" id="L424" title="All 8 branches missed.">			if (isPaginationNavPressed() || (isAlertsToggledOnPage() &amp;&amp; getEditIndex() &gt; 0) || checkIfShouldStandOnSamePage()) {</span>
<span class="nc" id="L425">				result = RequestsMH.getNextRequestsForManager(m_empID, reqFilterID, getPageIDs(), isSoftValEnabled,</span>
						isNetStaffingSoftValEnabled);
			} else {
<span class="nc" id="L428">				String requestIDStr = m_context.getRequest().getParameter(&quot;reqID&quot;);</span>
<span class="nc" id="L429">				ID requestID = null;</span>
<span class="nc bnc" id="L430" title="All 2 branches missed.">				if (!StringUtil.isEmpty(requestIDStr)) {</span>
<span class="nc" id="L431">					requestID = new ID(requestIDStr);</span>
				}

<span class="nc" id="L434">				String requestTypeStr = m_context.getRequest().getParameter(&quot;requestType&quot;);</span>

<span class="nc bnc" id="L436" title="All 2 branches missed.">				if (requestID != null) {</span>
<span class="nc" id="L437">					result = RequestsMH.getRequestCollectionForRequest(requestID, requestTypeStr, m_context);</span>
					//request not found
<span class="nc bnc" id="L439" title="All 2 branches missed.">					if (result.isEmpty()) {</span>
<span class="nc" id="L440">						addPageMessage(Message.INFO_TYPE, RmWebBundleKey.REQUEST_NOT_FOUND_ERROR, RmWebBundleKey.BUNDLE_NAME);</span>
					} else {
<span class="nc" id="L442">						addPageMessage(Message.INFO_TYPE, RmWebBundleKey.REQUEST_FROM_DRILLTHROUGH_VIEW, RmWebBundleKey.BUNDLE_NAME);</span>
					}
				} else {
					//get the start and end date range
<span class="nc bnc" id="L446" title="All 2 branches missed.">					Date sDate = m_dateRangePickerPC != null ? m_dateRangePickerPC.getStartDatePickerPC().getDate() : null;</span>
<span class="nc bnc" id="L447" title="All 2 branches missed.">					Date eDate = m_dateRangePickerPC != null ? m_dateRangePickerPC.getEndDatePickerPC().getDate() : null;</span>
<span class="nc bnc" id="L448" title="All 2 branches missed.">					String allFilterName = reqFilterID == null ? m_context.getUserProperty(RmKeys.REQUEST_FILTER_NAME) : &quot;&quot;;</span>
<span class="nc" id="L449">					result = RequestsMH.getRequestsForManager(m_empID, reqFilterID, getFindName(), getSortColumn(), isSortAscending(),</span>
<span class="nc" id="L450">							getPageIDSize(), isSoftValEnabled, isNetStaffingSoftValEnabled, sDate, eDate, allFilterName);</span>
<span class="nc" id="L451">					setAllReqCollection(result);</span>
<span class="nc" id="L452">					initPaginationIDs(result.getIds());</span>
				}
			}
<span class="nc bnc" id="L455" title="All 2 branches missed.">			if (isAlertsToggledOnPage()) { // reset toggle state once the request ids to load are known</span>
<span class="nc" id="L456">				m_alertsToggledOnPage = Boolean.FALSE.toString();</span>
			}

<span class="nc" id="L459">		} catch (RmHardValidationException ex) {</span>
<span class="nc" id="L460">			Message msg = handleUnableToLoadDataError(log, ex);</span>
<span class="nc" id="L461">			msg.setAssociatedMessage(ex.getLocalizedMessage(m_localizer, m_context.getViewingTimeZone()));</span>
<span class="nc" id="L462">		}</span>
<span class="nc" id="L463">		return result;</span>
	}

	/**
	 * Returns True if Soft validation is enabled
	 * @return
	 */
	protected boolean isSoftValEanbled() {
<span class="nc" id="L471">		ListConfig lc = m_lcSelectorPC.getListConfig();</span>
<span class="nc" id="L472">		ListConfigFP fp = lc.getListConfigFP(UIFWebBundleKey.ALERTS);</span>
<span class="nc" id="L473">		boolean isSelected = lc.getSelectedFPs().contains(fp);</span>

<span class="nc bnc" id="L475" title="All 4 branches missed.">		return Boolean.parseBoolean(getIsAlertsCheckedOnPage()) &amp;&amp; isSelected;</span>
	}

	/**
	 * Returns true if either the page action is a group action, or if
	 * the configured BPCONFIG value enables net staffing validation.
	 * @return
	 */
	protected boolean isNetStaffingSoftValEnabled() {
<span class="nc" id="L484">		boolean netStaffingValEnabled = false;</span>

<span class="nc bnc" id="L486" title="All 2 branches missed.">		if (isPageActionGroupAction()) {</span>
<span class="nc" id="L487">			netStaffingValEnabled = true;</span>
<span class="nc bnc" id="L488" title="All 2 branches missed.">		} else if (m_isConfigNetStaffingValidationEnabled) {</span>
<span class="nc" id="L489">			netStaffingValEnabled = true;</span>
		}
<span class="nc" id="L491">		return netStaffingValEnabled;</span>
	}

	protected void readNetStaffingValidationConfig() {
		try {
<span class="nc" id="L496">			String config = BbmManagerFactory.getDBConfigManager().getValue(ConfigKey.RM_NETSTAFFING_VALIDATION_ENABLED);</span>
<span class="nc bnc" id="L497" title="All 4 branches missed.">			if (config != null &amp;&amp; StringUtil.isEqual(config, &quot;false&quot;)) {</span>
<span class="nc" id="L498">				m_isConfigNetStaffingValidationEnabled = false;</span>
			}
<span class="nc" id="L500">		} catch (Exception ex) {</span>
<span class="nc" id="L501">		}</span>
<span class="nc" id="L502">	}</span>

	protected void readAlertsCheckboxConfig() {
		try {
<span class="nc" id="L506">			String config = BbmManagerFactory.getDBConfigManager().getValue(ConfigKey.RM_ALERTSCHECKBOX_CHECKED);</span>
<span class="nc bnc" id="L507" title="All 4 branches missed.">			if (config != null &amp;&amp; StringUtil.isEqual(config, &quot;false&quot;)) {</span>
<span class="nc" id="L508">				m_configuredCheckboxState = false;</span>
			}
<span class="nc" id="L510">		} catch (Exception ex) {</span>
<span class="nc" id="L511">		}</span>
<span class="nc" id="L512">	}</span>

	private boolean isPageActionGroupAction() {
<span class="nc bnc" id="L515" title="All 2 branches missed.">		if (pageAction != null</span>
<span class="nc bnc" id="L516" title="All 2 branches missed.">				&amp;&amp; (pageAction.equals(RmPageAction.APPROVE_ALL_WO_VIOLATIONS_ACTION)</span>
<span class="nc bnc" id="L517" title="All 2 branches missed.">						|| pageAction.equals(RmPageAction.CONFIRM_ALL_TNTV_APPROVALS_ACTION)</span>
<span class="nc bnc" id="L518" title="All 2 branches missed.">						|| pageAction.equals(RmPageAction.DENY_ANY_W_VIOLATIONS_ACTION)</span>
<span class="nc bnc" id="L519" title="All 2 branches missed.">						|| pageAction.equals(RmPageAction.REMOVE_ALL_TNTV_APPROVALS_ACTION)</span>
<span class="nc bnc" id="L520" title="All 2 branches missed.">						|| pageAction.equals(RmPageAction.TENTV_APPROVE_ALL_WO_VIOLATIONS_ACTION)</span>
<span class="nc bnc" id="L521" title="All 2 branches missed.">						|| pageAction.equals(RmPageAction.APPROVE_TO_CHOICE_WO_VIOLATIONS_ACTION)</span>
<span class="nc bnc" id="L522" title="All 2 branches missed.">						|| pageAction.equals(RmPageAction.PROCESS_VTO_OPTIONS_REQUESTS_ACTION))) {</span>
<span class="nc" id="L523">			return true;</span>
		}
<span class="nc" id="L525">		return false;</span>
	}

	/**
	 * Load Organiation Map
	 */
	protected void loadOrgMap() throws Exception {
<span class="nc bnc" id="L532" title="All 2 branches missed.">		if (isEmptyRequests()) {</span>
<span class="nc" id="L533">			return;</span>
		}

<span class="nc" id="L536">		Collection requests = m_reqCollection.getRequests();</span>
<span class="nc" id="L537">		Collection empIDList = getUniqueEmpIDs(requests);</span>
<span class="nc" id="L538">		m_eOrgMap = RequestsMH.getEmpOrgMap(m_context, empIDList);</span>
<span class="nc" id="L539">	}</span>
	
	/**
	 * Return Unique Employee IDs for the specified Requests
	 */
	protected Collection getUniqueEmpIDs(Collection requests) {
<span class="nc" id="L545">		return RequestsMH.getUniqueEmpIDs(requests);</span>
	}

	/**
	 * To be overwritten to load Page specific data
	 */
	protected void loadSpecifyData() throws Exception {
<span class="nc" id="L552">	}</span>

	/**
	 * Create Instanse of ListConfigSelectedPC
	 */
	protected ListConfigSelectorPC createListConfigSelectorPC() {
<span class="nc" id="L558">		return new ListConfigSelectorPC(m_context, AgentsRequestsListConfig.class);</span>
	}

	/**
	 * Initialize Request Filter
	 */
	protected void initRequestFilter() throws Exception {
<span class="nc" id="L565">		ID userID = m_context.getUser().getID();</span>
<span class="nc bnc" id="L566" title="All 4 branches missed.">		if (m_rfilterBoxPC != null &amp;&amp; m_rfilterBoxPC.getSelectedFilterID() != null) {</span>

			try {
<span class="nc" id="L569">				m_requestFilter = RequestsMH.getRequestFilterById(m_rfilterBoxPC.getSelectedFilterID()); //ESR3001270 fix -- catch the exception if filter doesn't exists</span>

<span class="nc" id="L571">			} catch (Exception e) {</span>
<span class="nc" id="L572">				log.info(&quot;unable to load the request filter because filter has been deleted&quot;);</span>
<span class="nc" id="L573">			}</span>
		}

<span class="nc" id="L576">		IDStringPair[] filterNames = RequestsMH.getRequestFilterNamesByUserID(userID);</span>
<span class="nc bnc" id="L577" title="All 2 branches missed.">		if (m_showFilterAndActiveComponent) {</span>
<span class="nc" id="L578">			String selectedFilterName = getSelectedFilterName();</span>
<span class="nc" id="L579">			m_rfilterBoxPC.initFilter(filterNames, selectedFilterName, m_isBlankFilterSelected);</span>
		}
<span class="nc" id="L581">	}</span>

	/**
	 * Get Selected Filter. To be overridden by subclasses.
	 * Subclasses should return m_rfilterBoxPC.getSelectedFilterName().
	 * @return One of the following values. Subclasses may return an actual filter ID.
	 * &quot;All Active&quot; = PageKeys.DEFAULT_ALL
	 * &quot;No Filter&quot; = RequestUtil.ALL_FILTER
	 * or some other filter ID which is a user-created &quot;all&quot; filter (request type is Request.REQUESTTYPE_ALL)
	 */
	public String getSelectedFilterName() {
<span class="nc" id="L592">		String filterName = m_rfilterBoxPC.getSelectedFilterName();</span>

<span class="nc bnc" id="L594" title="All 4 branches missed.">		if (filterName == null || filterName.isEmpty()) {</span>
<span class="nc" id="L595">			filterName = PageKeys.DEFAULT_ALL;</span>
<span class="nc bnc" id="L596" title="All 2 branches missed.">		} else if (filterName.equals(PageKeys.DEFAULT_ALL)</span>
<span class="nc bnc" id="L597" title="All 2 branches missed.">				|| filterName.equals(com.bluepumpkin.ejb.rm.requests.common.ejb.RequestUtil.ALL_FILTER)) {</span>
			; //keep filterName as it is because this page can handle it
<span class="nc bnc" id="L599" title="All 4 branches missed.">		} else if (m_requestFilter == null || m_requestFilter.getValueForKey(RequestFilter.REQUEST_TYPE_KEY) == null) {</span>
<span class="nc" id="L600">			filterName = PageKeys.DEFAULT_ALL;</span>
<span class="nc bnc" id="L601" title="All 2 branches missed.">		} else if (m_requestFilter.getValueForKey(RequestFilter.REQUEST_TYPE_KEY).equals(Request.REQUESTTYPE_ALL)) {</span>
			; //keep filterName as it is because this page can handle it
		} else {
<span class="nc" id="L604">			filterName = PageKeys.DEFAULT_ALL;</span>
		}

<span class="nc" id="L607">		m_rfilterBoxPC.setSelectedFilterName(filterName);</span>
<span class="nc" id="L608">		return filterName;</span>
	}

	/**
	 * Enable Blank Filter to be Selected, used by adhoc filter
	 */
	public void setIsBlankFilterSelected(boolean bSwitch) {
<span class="nc" id="L615">		m_isBlankFilterSelected = bSwitch;</span>
<span class="nc" id="L616">	}</span>

	/**
	 * Return true if Blank Filter is Selected, used by adhoc filter
	 */
	public boolean isBlankFilterSelected() {
<span class="nc" id="L622">		return m_isBlankFilterSelected;</span>
	}

	/**
	 * Return Filter Box Find Name
	 */
	public String getFindName() {
<span class="nc bnc" id="L629" title="All 2 branches missed.">		return m_rfilterBoxPC != null ? m_rfilterBoxPC.getFindName() : null;</span>
	}

	/**
	 * Initialize content title
	 */
	@Override
	protected void initContentTitle() {
		// Initialize Content Title
<span class="nc" id="L638">		String title = getPreparedContentTitleName();</span>

<span class="nc" id="L640">		m_contentTitlePC.setPageTitle(title);</span>

<span class="nc" id="L642">		String itemName = getContentTitleItemName();</span>
<span class="nc" id="L643">		m_contentTitlePC.setItemNameHtml(itemName);</span>
<span class="nc" id="L644">		m_contentTitlePC.setAriaRegion(true);</span>

<span class="nc bnc" id="L646" title="All 2 branches missed.">		if (m_showFilterAndActiveComponent) {</span>
			// compare the state of alert checkbox at this point to display state
			// change accurately if there's been a page action change to it.
<span class="nc bnc" id="L649" title="All 2 branches missed.">			if (m_checkBoxPC.isChecked() != new Boolean(getIsAlertsCheckedOnPage())) {</span>
<span class="nc" id="L650">				m_checkBoxPC.setIsChecked(new Boolean(getIsAlertsCheckedOnPage()));</span>
			}
<span class="nc" id="L652">			m_contentTitlePC.addActiveComponent(m_checkBoxPC.getLabel(), m_checkBoxPC, true);</span>
<span class="nc" id="L653">			m_contentTitlePC.addActiveComponent(m_lcSelectorPC.getLabel(), m_lcSelectorPC, true);</span>
<span class="nc" id="L654">			m_contentTitlePC.addActiveComponent(m_dateRangePickerPC.getLabel(), m_dateRangePickerPC, true); //ESR#4234460</span>
<span class="nc" id="L655">			m_contentTitlePC.getHtmlDisplay();</span>
		}
<span class="nc" id="L657">	}</span>
	private String getPreparedContentTitleName() {
<span class="nc" id="L659">		String title = i18n(m_bundle, RmWebBundleKey.RM_AGENTS_REQUESTS);</span>

<span class="nc" id="L661">		Object[] args = new Object[1];</span>
<span class="nc" id="L662">		args[0] = m_context.getSystemManagerFactory().getVerticalizationManager()</span>
<span class="nc" id="L663">			.getVerticalizedString(m_context, DefaultVerticalizationManager.WORKER);</span>
<span class="nc" id="L664">		return MessageFormat.format(title, args);</span>
	}
	/**
	 * Return Content Title Item Name
	 */
	protected String getContentTitleItemName() {
<span class="nc" id="L670">		return i18n(m_bundle, RmWebBundleKey.REQUEST_TYPE_ALL);</span>
	}

	/**
	 * Initialize Selectable Items
	 */
	@Override
	protected void initSelectableItems() {
		// Handle case where there are no requests found
<span class="nc bnc" id="L679" title="All 2 branches missed.">		if (isEmptyRequests()) {</span>
<span class="nc" id="L680">			return;</span>
		}

<span class="nc" id="L683">		initPageRequestObjVer();</span>
<span class="nc" id="L684">		initGroupActionMenu();</span>

<span class="nc" id="L686">		ArrayList listModel = new ArrayList();</span>
<span class="nc" id="L687">		List selectedFPs = m_lcSelectorPC.getListConfig().getSelectedFPs();</span>
<span class="nc bnc" id="L688" title="All 2 branches missed.">		for (Iterator it = m_reqCollection.iterator(); it.hasNext();) {</span>
<span class="nc" id="L689">			RequestAggregate request = (RequestAggregate) it.next();</span>

			// Create and Add row data
<span class="nc" id="L692">			MultiColumnNodeData row_data = createRowData(request, selectedFPs);</span>
<span class="nc" id="L693">			listModel.add(row_data);</span>
<span class="nc" id="L694">		}</span>

<span class="nc" id="L696">		m_list.setListModel(listModel);</span>
<span class="nc" id="L697">	}</span>

	/**
	 * Initialize List Header
	 */
	@Override
	protected void initHeader() {
<span class="nc" id="L704">		TableHeaderPC header = m_list.getHeader();</span>
<span class="nc" id="L705">		header.setPartialSortable(true);</span>
<span class="nc bnc" id="L706" title="All 2 branches missed.">		if(m_lcSelectorPC.getListConfig()!=null) {</span>
<span class="nc" id="L707">			List selectedFPs = m_lcSelectorPC.getListConfig().getSelectedFPs();</span>
<span class="nc bnc" id="L708" title="All 2 branches missed.">			for (Iterator it = selectedFPs.iterator(); it.hasNext();) {</span>
<span class="nc" id="L709">				ListConfigFP fp = (ListConfigFP) it.next();</span>
<span class="nc" id="L710">				addHeaderData(fp, header);</span>
<span class="nc" id="L711">			}</span>
		}

<span class="nc" id="L714">	}</span>

	/**
	 * Convenient method to add Header Data for specified List Config
	 * Field Property
	 */
	protected void addHeaderData(ListConfigFP fp, TableHeaderPC header) {
<span class="nc" id="L721">		GenericHeaderData hdrData = header.addColumnHeaderData(fp);</span>
<span class="nc bnc" id="L722" title="All 2 branches missed.">		if (hdrData.getSortable()) {</span>
			// 508: Table header page component handles focus behavior for sortable columns,
			// removed user injection of anchor tag around display name here.
<span class="nc" id="L725">			String displayName = hdrData.getDisplayName();</span>
<span class="nc" id="L726">			hdrData.setDisplayName(displayName);</span>
		}
<span class="nc" id="L728">	}</span>

	/**
	 * Create Row Data From Request
	 */
	protected MultiColumnNodeData createRowData(RequestAggregate request, List selectedFPs) {
<span class="nc" id="L734">		String rowID = request.getID().toString();</span>
<span class="nc" id="L735">		DefaultMultiColumnNodeData row_data = new DefaultMultiColumnNodeData(rowID);</span>

<span class="nc bnc" id="L737" title="All 2 branches missed.">		for (Iterator it = selectedFPs.iterator(); it.hasNext();) {</span>
<span class="nc" id="L738">			ListConfigFP fp = (ListConfigFP) it.next();</span>
<span class="nc" id="L739">			addCellData(rowID, request, fp, row_data);</span>
<span class="nc" id="L740">		}</span>

<span class="nc" id="L742">		return row_data;</span>
	}

	/**
	 * Add Cell Data for the specified List Config Field Property
	 */
	protected void addCellData(String rowID, RequestAggregate request, ListConfigFP fp, DefaultMultiColumnNodeData row_data) {
<span class="nc bnc" id="L749" title="All 2 branches missed.">		if (fp.hasFieldName(Request.SORT_LAST_NAME_FIRST)) {</span>
<span class="nc" id="L750">			row_data.add(createAgentName(request));</span>
<span class="nc bnc" id="L751" title="All 2 branches missed.">		} else if (fp.hasFieldName(Request.SORT_STATUS)) {</span>
<span class="nc" id="L752">			row_data.add(createStatusIcon(request, false));</span>
<span class="nc bnc" id="L753" title="All 2 branches missed.">		} else if (fp.hasFieldName(Request.SORT_TYPE)) {</span>
<span class="nc" id="L754">			row_data.add(getLocalizedRequestType(request));</span>
<span class="nc bnc" id="L755" title="All 2 branches missed.">		} else if (fp.hasFieldName(Request.SORT_CREATED)) {</span>
<span class="nc" id="L756">			row_data.add(createDataWrapper(request.getSubmittedOn()));</span>
<span class="nc bnc" id="L757" title="All 2 branches missed.">		} else if (fp.hasFieldName(Request.SORT_MODIFIED)) {</span>
<span class="nc" id="L758">			row_data.add(createDataWrapper(request.getLastModifiedAt()));</span>
<span class="nc bnc" id="L759" title="All 2 branches missed.">		} else if (fp.hasFieldName(Request.SORT_TO_SENIORITY)) {</span>
<span class="nc" id="L760">			Date date = null;</span>
<span class="nc bnc" id="L761" title="All 2 branches missed.">			if (request.isTimeOffRequest()) {</span>
<span class="nc" id="L762">				date = ((TORequest) request).getEmployeeStartDate(); //DL_EMPLOYEE_REQUEST_CHILD</span>
			} else {
<span class="nc" id="L764">				Employee emp = getEmployee(request);</span>
<span class="nc bnc" id="L765" title="All 2 branches missed.">				date = (emp == null) ? new Date() : emp.getStartTime();</span>
			}
<span class="nc" id="L767">			row_data.add(new DateWrapper(date, m_localizer, m_view_tz, RegionalFormatBundleKey.DATE_FORMAT));</span>

<span class="nc bnc" id="L769" title="All 2 branches missed.">		} else if (fp.hasFieldName(Request.SORT_EMP_RANK)) {</span>
<span class="nc" id="L770">			int rank = 1;</span>
<span class="nc bnc" id="L771" title="All 2 branches missed.">			if (request.isTimeOffRequest()) {</span>
<span class="nc" id="L772">				rank = ((TORequest) request).getEmployeeRank();</span>
			} else {
<span class="nc" id="L774">				Employee emp = getEmployee(request);</span>
<span class="nc bnc" id="L775" title="All 2 branches missed.">				rank = (emp == null) ? rank : emp.getRank();</span>
			}
<span class="nc" id="L777">			row_data.add(new NumberWrapper(rank, m_localizer));</span>
<span class="nc bnc" id="L778" title="All 2 branches missed.">		} else if (fp.hasFieldName(UIFWebBundleKey.EXPIRED)) {</span>
<span class="nc" id="L779">			row_data.add(m_localizer.formatYesNo(request.hasExpired()));</span>
<span class="nc bnc" id="L780" title="All 2 branches missed.">		} else if (fp.hasFieldName(UIFWebBundleKey.COMMENTS)) {</span>
<span class="nc" id="L781">			row_data.add(renderComments(request));</span>
<span class="nc bnc" id="L782" title="All 2 branches missed.">		} else if (fp.hasFieldName(UIFWebBundleKey.ALERTS)) {</span>
<span class="nc" id="L783">			String alerts = RequestUtil.createUniqueAlertIcons(request, m_localizer, true, true);</span>
<span class="nc" id="L784">			row_data.add(alerts);</span>
<span class="nc bnc" id="L785" title="All 2 branches missed.">		} else if (fp.hasFieldName(UIFWebBundleKey.ACTIONS)) {</span>
<span class="nc" id="L786">			row_data.add(createItemActions(request, rowID));</span>
		}
<span class="nc" id="L788">	}</span>

	/**
	 * Get an employee using a detail Level of Employee.DETAIL_LEVEL_EMPLOYEE_TIMEBASEDPROPERTY
	 * @param request
	 * @return
	 */
	protected Employee getEmployee(RequestAggregate request) {
<span class="nc" id="L796">		Employee emp = null;</span>
<span class="nc bnc" id="L797" title="All 2 branches missed.">		if (request.isShiftBidRequest()) {</span>
<span class="nc" id="L798">			ShiftBidRequest sbRequest = (ShiftBidRequest) request;</span>
<span class="nc" id="L799">			emp = sbRequest.getOptMethods().getEmployee();</span>
<span class="nc" id="L800">		} else {</span>
<span class="nc" id="L801">			ID empID = request.getEmployeeID();</span>
			try {
<span class="nc" id="L803">				emp = ValidationUtil.getEmployeeByID(empID, null, Employee.DETAIL_LEVEL_EMPLOYEE_TIMEBASEDPROPERTY);</span>
<span class="nc" id="L804">			} catch (Exception ex) {</span>
<span class="nc" id="L805">			}</span>
		}
<span class="nc" id="L807">		return emp;</span>
	}

	/**
	 * Return Agent name for specified Request
	 */
	protected String createAgentName(RequestAggregate request) {
<span class="nc" id="L814">		String name = &quot;&quot;;</span>

<span class="nc bnc" id="L816" title="All 2 branches missed.">		if (!isEmptyRequests()) {</span>
<span class="nc" id="L817">			ID empID = request.getEmployeeID();</span>
<span class="nc" id="L818">			EmployeeName eName = m_reqCollection.get(empID);</span>
<span class="nc bnc" id="L819" title="All 2 branches missed.">			name = eName == null ? empID.toString() : m_localizer.formatName(eName);</span>
		}

<span class="nc" id="L822">		return name;</span>
	}

	/**
	 * Append Item Action if enabled
	 */
	@Override
	protected void appendItemAction(RequestAggregate request, String action, String rowID, StringBuffer sb) {
<span class="nc" id="L830">		String itemAction = &quot;&quot;;</span>

<span class="nc bnc" id="L832" title="All 2 branches missed.">		if (isItemActionEnabled(request, action)) {</span>
<span class="nc" id="L833">			itemAction = createActionIcon(action, request, rowID);</span>
<span class="nc bnc" id="L834" title="All 4 branches missed.">		} else if (RmPageAction.ADD_TO_WAITLIST_ACTION.equals(action) || RmPageAction.ADD_TO_MAN_WAITLIST_ACTION.equals(action)) {</span>
<span class="nc bnc" id="L835" title="All 2 branches missed.">			if (!isItemActionEnabled(request, RmPageAction.ADD_TO_WAITLIST_ACTION)</span>
<span class="nc bnc" id="L836" title="All 2 branches missed.">					&amp;&amp; !isItemActionEnabled(request, RmPageAction.ADD_TO_MAN_WAITLIST_ACTION)) {</span>
<span class="nc" id="L837">				itemAction = createIconButton(ImageFileID.BLANK_SPACER, null, null);</span>
			}
		} else {
<span class="nc" id="L840">			itemAction = createIconButton(ImageFileID.BLANK_SPACER, null, null);</span>
		}
<span class="nc" id="L842">		sb.append(itemAction);</span>
<span class="nc" id="L843">	}</span>

	/**
	 * Return true if the Action is valid for the specified Request
	 */
	@Override
	protected boolean isValidAction(String action, RequestAggregate request) {
<span class="nc" id="L850">		String rType = request.getRequestType();</span>
<span class="nc" id="L851">		String status = request.getRequestStatus();</span>

		// Prevent Manager from tentatively approving Shift Bid or Custom Shift or Flex Time Requests
<span class="nc bnc" id="L854" title="All 2 branches missed.">		if (PageAction.TENTATIVELY_APPROVE.equals(action)</span>
<span class="nc bnc" id="L855" title="All 4 branches missed.">				&amp;&amp; (Request.REQUESTTYPE_SHIFTBID.equals(rType) || Request.REQUESTTYPE_CUSTSHIFT.equals(rType) || Request.REQUESTTYPE_FLEXTIME</span>
<span class="nc bnc" id="L856" title="All 2 branches missed.">						.equals(rType))) {</span>
<span class="nc" id="L857">			return false;</span>
		}

		//see if it withdraw for an approved shiftbidrequest after auction is closed
<span class="nc bnc" id="L861" title="All 2 branches missed.">		if (request.getRequestType().equals(Request.REQUESTTYPE_SHIFTBID)</span>
<span class="nc bnc" id="L862" title="All 2 branches missed.">				&amp;&amp; request.getRequestStatus().equals(RequestAuditTrail.STATUS_APPROVED)) {</span>
<span class="nc bnc" id="L863" title="All 4 branches missed.">			if (m_auctionMap != null &amp;&amp; m_auctionMap.size() == 0) {</span>
				//get the auctionlist for approved requests to get auction
				try {
<span class="nc" id="L866">					m_auctionMap = RequestUtil.getAuctionmapForApprovedSBRequests(m_reqCollection.getRequests());</span>
<span class="nc" id="L867">				} catch (Exception ex) {</span>
<span class="nc" id="L868">				}</span>
			}
<span class="nc bnc" id="L870" title="All 2 branches missed.">			boolean isClosed = !m_auctionMap.get(((ShiftBidRequest) request).getShiftBidAuctionID()).booleanValue();</span>
<span class="nc bnc" id="L871" title="All 6 branches missed.">			if (RequestAuditTrail.STATUS_APPROVED.equals(status) &amp;&amp; PageAction.WITHDRAW.equals(action) &amp;&amp; isClosed) {</span>
<span class="nc" id="L872">				return false;</span>
			}
		}

<span class="nc bnc" id="L876" title="All 2 branches missed.">		return super.isValidAction(action, request)</span>
<span class="nc bnc" id="L877" title="All 2 branches missed.">				|| !request.hasExpired()</span>
<span class="nc bnc" id="L878" title="All 4 branches missed.">				&amp;&amp; (((RequestAuditTrail.STATUS_WAITLIST.equals(status) || RequestAuditTrail.STATUS_PENDING.equals(status)</span>
<span class="nc bnc" id="L879" title="All 4 branches missed.">						|| RequestAuditTrail.STATUS_TENTATIVE.equals(status) || RequestAuditTrail.STATUS_ESCALATED.equals(status)) &amp;&amp; (PageAction.APPROVE</span>
<span class="nc bnc" id="L880" title="All 4 branches missed.">						.equals(action) || PageAction.DENY.equals(action)))</span>
<span class="nc bnc" id="L881" title="All 4 branches missed.">						|| ((RequestAuditTrail.STATUS_WAITLIST.equals(status) || RequestAuditTrail.STATUS_PENDING.equals(status) || RequestAuditTrail.STATUS_ESCALATED</span>
<span class="nc bnc" id="L882" title="All 4 branches missed.">								.equals(status)) &amp;&amp; PageAction.TENTATIVELY_APPROVE.equals(action))</span>

<span class="nc bnc" id="L884" title="All 4 branches missed.">						|| (request.isTimeOffRequest() &amp;&amp; !request.isFlexTimeRequest()</span>
<span class="nc bnc" id="L885" title="All 4 branches missed.">								&amp;&amp; RmPageAction.ADD_TO_WAITLIST_ACTION.equals(action) &amp;&amp; ((TORequest) request).isEligibleForWaitlist())</span>

<span class="nc bnc" id="L887" title="All 6 branches missed.">						|| (request.isTimeOffRequest() &amp;&amp; !request.isFlexTimeRequest() &amp;&amp; !request.isAdvancedVTORequest()</span>
<span class="nc bnc" id="L888" title="All 4 branches missed.">								&amp;&amp; RmPageAction.ADD_TO_MAN_WAITLIST_ACTION.equals(action) &amp;&amp; ((TORequest) request).isWaitlistEnabled()</span>
<span class="nc bnc" id="L889" title="All 2 branches missed.">								&amp;&amp; RequestAuditTrail.WAITLIST_ELIGIBLE_STATES.contains(request.getRequestStatus())</span>
<span class="nc bnc" id="L890" title="All 2 branches missed.">								&amp;&amp; !((TORequest) request).isEligibleForWaitlist() &amp;&amp; !TORequestUtil</span>
<span class="nc bnc" id="L891" title="All 2 branches missed.">									.isAnyTimeOffChoiceForPastDate((TORequest) request))</span>

<span class="nc bnc" id="L893" title="All 6 branches missed.">						|| (request.isTimeOffRequest() &amp;&amp; !request.isFlexTimeRequest() &amp;&amp; PageAction.REJECT_WITHDRAW_ACTION.equals(action) &amp;&amp; ((TORequest) request)</span>
<span class="nc bnc" id="L894" title="All 2 branches missed.">								.isEligibleForRejectWithdrawAction())</span>
<span class="nc bnc" id="L895" title="All 6 branches missed.">						|| (request.isTimeOffRequest() &amp;&amp; !request.isFlexTimeRequest() &amp;&amp; PageAction.ACCEPT_WITHDRAW_ACTION.equals(action) &amp;&amp; ((TORequest) request)</span>
<span class="nc bnc" id="L896" title="All 2 branches missed.">								.isEligibleForAcceptWithdrawAction())</span>
<span class="nc bnc" id="L897" title="All 6 branches missed.">						|| (request.isTimeOffRequest() &amp;&amp; !request.isFlexTimeRequest() &amp;&amp; PageAction.CANCEL_WITHDRAW_ACTION.equals(action) &amp;&amp; ((TORequest) request)</span>
<span class="nc bnc" id="L898" title="All 2 branches missed.">								.isEligibleForCancelWithdrawAction())</span>
<span class="nc bnc" id="L899" title="All 6 branches missed.">						|| (request.isTimeOffRequest() &amp;&amp; !request.isFlexTimeRequest() &amp;&amp; PageAction.WITHDRAW.equals(action) &amp;&amp; ((TORequest) request)</span>
<span class="nc bnc" id="L900" title="All 2 branches missed.">								.isEligibleForWithdraw())</span>

<span class="nc bnc" id="L902" title="All 4 branches missed.">						|| (request.isShiftSwapRequest() &amp;&amp; PageAction.REJECT_WITHDRAW_ACTION.equals(action) &amp;&amp; ((ShiftSwapRequest) request)</span>
<span class="nc bnc" id="L903" title="All 2 branches missed.">								.isEligibleForRejectWithdrawAction())</span>
<span class="nc bnc" id="L904" title="All 4 branches missed.">						|| (request.isShiftSwapRequest() &amp;&amp; PageAction.ACCEPT_WITHDRAW_ACTION.equals(action) &amp;&amp; ((ShiftSwapRequest) request)</span>
<span class="nc bnc" id="L905" title="All 2 branches missed.">								.isEligibleForAcceptWithdrawAction())</span>
<span class="nc bnc" id="L906" title="All 4 branches missed.">						|| (request.isShiftSwapRequest() &amp;&amp; PageAction.CANCEL_WITHDRAW_ACTION.equals(action) &amp;&amp; ((ShiftSwapRequest) request)</span>
<span class="nc bnc" id="L907" title="All 2 branches missed.">								.isEligibleForCancelWithdrawAction())</span>
<span class="nc bnc" id="L908" title="All 6 branches missed.">						|| (request.isShiftSwapRequest() &amp;&amp; PageAction.WITHDRAW.equals(action) &amp;&amp; ((ShiftSwapRequest) request).isEligibleForWithdraw()));</span>
	}

	/**
	 * Add Refresh Toolbar Button
	 */
	protected void addRefreshToolbarButton() {
<span class="nc" id="L915">		String refreshLabel = i18n(m_common_bundle, UIFWebBundleKey.TOOLBAR_REFRESH);</span>
<span class="nc" id="L916">		m_toolbar.addSubmitTextButton(PageAction.FORCE_REFRESH, refreshLabel, isCommonButtonsEnabled());</span>
<span class="nc" id="L917">	}</span>

	/**
	 * Initialize Toolbar
	 */
	@Override
	protected void initToolbar() {
<span class="nc bnc" id="L924" title="All 6 branches missed.">		boolean isBtnEnabled = isCommonButtonsEnabled() &amp;&amp; isAuthToEditAnyRqts() &amp;&amp; !isEmptyRequests();</span>
<span class="nc" id="L925">		String grpActionLabel = i18n(m_common_bundle, UIFWebBundleKey.TOOLBAR_GROUP_ACTIONS);</span>
<span class="nc" id="L926">		ToolbarTextButton groupButton = m_toolbar.createPopupDialogButton(GROUP_ACTION_MENU_NAME, grpActionLabel, isBtnEnabled);</span>


<span class="nc" id="L929">		String jsPrefix = &quot; if (!pageMediator.isPageDirty()|| (pageMediator.isPageDirty()&amp;&amp;confirm(LOSE_CHANGES_WARNING)) ) if (typeof(&quot; + m_toolbar.getName() + &quot;)!='undefined') &quot; + m_toolbar.getName();</span>
<span class="nc" id="L930">		groupButton.setAttribute(&quot;onClick&quot;, jsPrefix + &quot;.onSelect('&quot; + groupButton.getActionName() + &quot;', this)&quot;);</span>
<span class="nc" id="L931">		groupButton.setAttribute(&quot;onDblClick&quot;, jsPrefix + &quot;.onSelect('&quot; + groupButton.getActionName() + &quot;', this)&quot;);</span>
<span class="nc" id="L932">		m_toolbar.addToolbarElement(groupButton);</span>

<span class="nc" id="L934">		addCommonToolbarButtons();</span>
<span class="nc" id="L935">		enableToolbarPagination();</span>
<span class="nc" id="L936">		m_toolbar.setLimitingPageSize(m_limitingPageSize);</span>
<span class="nc" id="L937">	}</span>

	/**
	 * Add Create Request Button
	 */
	@Override
	protected void addCreateRequestButton() {
<span class="nc bnc" id="L944" title="All 6 branches missed.">		boolean isTimeOffCreateEnabled = m_orgSetting != null &amp;&amp; m_orgSetting.getManagerTimeOffWorkflowActive() &amp;&amp; isAuthToEditTORqts();</span>
<span class="nc bnc" id="L945" title="All 4 branches missed.">		boolean isFlexTimeCreateEnabled = LicenseUtil.isAdvancedRMLicense() &amp;&amp; m_orgSetting != null</span>
<span class="nc bnc" id="L946" title="All 4 branches missed.">				&amp;&amp; m_orgSetting.getManagerTimeOffWorkflowActive() &amp;&amp; isAuthToEditFTRqts();</span>
<span class="nc bnc" id="L947" title="All 4 branches missed.">		boolean isCustShiftCreateEnabled = m_orgSetting != null &amp;&amp; isAuthToEditCSRqts()</span>
<span class="nc bnc" id="L948" title="All 4 branches missed.">				&amp;&amp; (m_orgSetting.getEnableCustomShiftRequests() || m_orgSetting.getAllowShiftChangeRequests());</span>

<span class="nc" id="L950">		String newRequestLabel = i18n(m_bundle, RmWebBundleKey.CREATE_NEW_REQUEST);</span>

<span class="nc bnc" id="L952" title="All 12 branches missed.">		if (isTimeOffCreateEnabled &amp;&amp; isCustShiftCreateEnabled || isTimeOffCreateEnabled &amp;&amp; isFlexTimeCreateEnabled</span>
				|| isCustShiftCreateEnabled &amp;&amp; isFlexTimeCreateEnabled) {
<span class="nc" id="L954">			m_toolbar.addPopupDialogTextButton(CREATE_NEW_REQUEST, newRequestLabel, isAuthToEditAnyRqts());</span>
<span class="nc bnc" id="L955" title="All 2 branches missed.">		} else if (isTimeOffCreateEnabled) {</span>
<span class="nc" id="L956">			m_toolbar.addPopupWindowTextButton(RmPageAction.POPUP_TIMEOFF_REQUEST_FORM_ACTION, newRequestLabel, isTimeOffCreateEnabled);</span>
<span class="nc bnc" id="L957" title="All 2 branches missed.">		} else if (isFlexTimeCreateEnabled) {</span>
<span class="nc" id="L958">			m_toolbar.addPopupWindowTextButton(RmPageAction.POPUP_FLEXTIME_REQUEST_FORM_ACTION, newRequestLabel, isFlexTimeCreateEnabled);</span>
<span class="nc bnc" id="L959" title="All 2 branches missed.">		} else if (isCustShiftCreateEnabled) {</span>
<span class="nc" id="L960">			m_toolbar.addPopupWindowTextButton(RmPageAction.POPUP_CUSTSHIFT_REQUEST_FORM_ACTION, newRequestLabel, isCustShiftCreateEnabled);</span>
		}
<span class="nc" id="L962">	}</span>

	/**
	 * Initialize Group Action Menu
	 */
	protected void initGroupActionMenu() {
<span class="nc" id="L968">		m_groupActionDialogMenuPC = new DialogToolbarMenuPC(m_context, m_toolbar);</span>
<span class="nc" id="L969">		m_groupActionDialogMenuPC.setName(GROUP_ACTION_MENU_NAME);</span>
<span class="nc" id="L970">		addChildComponent(m_groupActionDialogMenuPC);</span>
		// Initialize Title
<span class="nc" id="L972">		String title = i18n(m_common_bundle, UIFWebBundleKey.GROUP_ACTIONS);</span>
<span class="nc" id="L973">		m_groupActionDialogMenuPC.setHeader(title);</span>

<span class="nc" id="L975">		boolean isTentvActionEnabled = isTentativeActionEnabled();</span>

		// Initialize Menu Buttons
<span class="nc" id="L978">		m_groupActionDialogMenuPC.addSubmitButton(RmPageAction.APPROVE_ALL_WO_VIOLATIONS_ACTION,</span>
<span class="nc" id="L979">						i18n(m_bundle, RmWebBundleKey.APPROVE_ALL_WO_VIOLATIONS), true);</span>

<span class="nc bnc" id="L981" title="All 2 branches missed.">		if (isTentvActionEnabled) {</span>
<span class="nc" id="L982">			m_groupActionDialogMenuPC.addSubmitButton(RmPageAction.TENTV_APPROVE_ALL_WO_VIOLATIONS_ACTION,</span>
<span class="nc" id="L983">					i18n(m_bundle, RmWebBundleKey.TENTV_APPROVE_ALL_WO_VIOLATIONS), true);</span>
		}
<span class="nc bnc" id="L985" title="All 4 branches missed.">		if (LicenseUtil.isAdvancedRMLicense() &amp;&amp; hasGroupActionForTimeOffChoice()) {</span>
<span class="nc" id="L986">			m_groupActionDialogMenuPC.addSubmitButton(RmPageAction.APPROVE_TO_CHOICE_WO_VIOLATIONS_ACTION,</span>
<span class="nc" id="L987">					i18n(m_bundle, RmWebBundleKey.APPROVE_TO_CHOICE_WO_VIOLATIONS_ACTION), true);</span>
		}
<span class="nc bnc" id="L989" title="All 4 branches missed.">		if (LicenseUtil.isAdvancedRMLicense() &amp;&amp; hasGroupActionForAdvancedVTOOptions()) {</span>
<span class="nc" id="L990">			m_groupActionDialogMenuPC.addSubmitButton(RmPageAction.PROCESS_VTO_OPTIONS_REQUESTS_ACTION,</span>
<span class="nc" id="L991">					i18n(m_bundle, RmWebBundleKey.PROCESS_VTO_OPTIONS_REQUESTS_ACTION), true);</span>
		}

<span class="nc" id="L994">		m_groupActionDialogMenuPC.addSubmitButton(RmPageAction.DENY_ANY_W_VIOLATIONS_ACTION,</span>
<span class="nc" id="L995">				i18n(m_bundle, RmWebBundleKey.DENY_ANY_W_VIOLATIONS), true);</span>

<span class="nc bnc" id="L997" title="All 2 branches missed.">		if (isTentvActionEnabled) {</span>
<span class="nc" id="L998">			m_groupActionDialogMenuPC.addSubmitButton(RmPageAction.CONFIRM_ALL_TNTV_APPROVALS_ACTION,</span>
<span class="nc" id="L999">					i18n(m_bundle, RmWebBundleKey.CONFIRM_ALL_TNTV_APPROVALS), true);</span>

<span class="nc" id="L1001">			m_groupActionDialogMenuPC.addSubmitButton(RmPageAction.REMOVE_ALL_TNTV_APPROVALS_ACTION,</span>
<span class="nc" id="L1002">					i18n(m_bundle, RmWebBundleKey.REMOVE_ALL_TNTV_APPROVALS), true);</span>
		}
<span class="nc" id="L1004">	}</span>

	/**
	 * Initialize New Request Menu
	 */
	@Override
	protected void initNewRequestMenu() {
<span class="nc" id="L1011">		m_newRequestMenuPC = new DialogToolbarMenuPC(m_context, m_toolbar);</span>
<span class="nc" id="L1012">		m_newRequestMenuPC.setName(CREATE_NEW_REQUEST);</span>
<span class="nc" id="L1013">		addChildComponent(m_newRequestMenuPC);</span>

		// Initialize Title
<span class="nc" id="L1016">		String title = i18n(m_bundle, RmWebBundleKey.CREATE_NEW_REQUEST);</span>
<span class="nc" id="L1017">		m_newRequestMenuPC.setHeader(title);</span>

		// Initialize Menu Buttons
<span class="nc" id="L1020">		m_newRequestMenuPC.addPopupWindowButton(RmPageAction.POPUP_TIMEOFF_REQUEST_FORM_ACTION,</span>
<span class="nc" id="L1021">				i18n(m_bundle, RmWebBundleKey.REQUEST_TYPE_TIME_OFF), isAuthToEditTORqts());</span>

<span class="nc bnc" id="L1023" title="All 2 branches missed.">		if (LicenseUtil.isAdvancedRMLicense()) {</span>
<span class="nc" id="L1024">			m_newRequestMenuPC.addPopupWindowButton(RmPageAction.POPUP_FLEXTIME_REQUEST_FORM_ACTION,</span>
<span class="nc" id="L1025">					i18n(m_bundle, RmWebBundleKey.REQUEST_TYPE_FLEX_TIME), isAuthToEditFTRqts());</span>
		}

<span class="nc" id="L1028">		m_newRequestMenuPC.addPopupWindowButton(RmPageAction.POPUP_CUSTSHIFT_REQUEST_FORM_ACTION,</span>
<span class="nc" id="L1029">				i18n(m_bundle, RmWebBundleKey.REQUEST_TYPE_CUSTOM_SHIFT), isAuthToEditCSRqts());</span>
<span class="nc" id="L1030">	}</span>

	/**
	 * Return true if Tentative Actions are enabled
	 */
	protected boolean isTentativeActionEnabled() {
<span class="nc" id="L1036">		return true;</span>
	}

	/**
	 * Return URL for HTML Form Action
	 */
	@Override
	public String getFormAction() {
<span class="nc" id="L1044">		return RmKeys.RH_AG_REQUEST_ALL_LIST;</span>
	}

	private void initPageRequestObjVer() {
<span class="nc" id="L1048">		StringBuffer objVerSB = new StringBuffer(100);</span>
<span class="nc bnc" id="L1049" title="All 2 branches missed.">		for (Iterator it = m_reqCollection.getRequests().iterator(); it.hasNext();) {</span>
<span class="nc" id="L1050">			RequestAggregate request = (RequestAggregate) it.next();</span>
<span class="nc bnc" id="L1051" title="All 2 branches missed.">			if (objVerSB.length() != 0) {</span>
<span class="nc" id="L1052">				objVerSB.append(&quot;,&quot;);</span>
			}
<span class="nc" id="L1054">			objVerSB.append(request.getObjectVersionNumber());</span>
<span class="nc" id="L1055">		}</span>
<span class="nc" id="L1056">		m_context.addGenericHTML(HtmlUtil.makeHiddenInput(&quot;pageRequestsObjVer&quot;, objVerSB.toString()));</span>
<span class="nc" id="L1057">	}</span>

	public void setPageRequestsObjVer(String ver) {
<span class="nc" id="L1060">		m_pageRequestsObjVer = StringUtil.parseStringToCollection(ver, &quot;,&quot;);</span>
<span class="nc" id="L1061">	}</span>

	public Collection getPageRequestsObjVer() {
<span class="nc" id="L1064">		return m_pageRequestsObjVer;</span>
	}

	public void setIsDPAction(boolean isDPAction) {
<span class="nc" id="L1068">		m_isDPAction = isDPAction;</span>
<span class="nc" id="L1069">	}</span>

	public boolean getIsDPActionr() {
<span class="nc" id="L1072">		return m_isDPAction;</span>
	}

	public void setIsAlertsCheckedOnPage(String isAlertsCheckedOnPage) {
<span class="nc" id="L1076">		m_alertsCheckedOnPage = isAlertsCheckedOnPage;</span>
<span class="nc" id="L1077">	}</span>

	public String getIsAlertsCheckedOnPage() {
<span class="nc" id="L1080">		return m_alertsCheckedOnPage;</span>
	}

	public void setIsAlertsToggledOnPage(String isAlertsToggledOnPage) {
<span class="nc" id="L1084">		m_alertsToggledOnPage = isAlertsToggledOnPage;</span>

<span class="nc" id="L1086">	}</span>

	public String getIsAlertsToggledOnPage() {
<span class="nc" id="L1089">		return m_alertsToggledOnPage;</span>
	}

	public boolean isAlertsToggledOnPage() {
<span class="nc bnc" id="L1093" title="All 2 branches missed.">		if (!StringUtil.isEmpty(getIsAlertsToggledOnPage())) {</span>
<span class="nc" id="L1094">			return Boolean.parseBoolean(getIsAlertsToggledOnPage());</span>
		} else {
<span class="nc" id="L1096">			return false;</span>
		}
	}

	public void setIsOnSamePage(boolean value) {
<span class="nc" id="L1101">		shouldBeOnSamePage = value;</span>
<span class="nc" id="L1102">	}</span>
	public void setIsOnSamePageForEdit(boolean value) {
<span class="nc" id="L1104">		shouldBeOnSamePageForEdit = value;</span>
<span class="nc" id="L1105">	}</span>


	//////////////////////////////////////////////////////////////////////////////
	// Privilege helpers
	//////////////////////////////////////////////////////////////////////////////
	/**
	 * Return true if the Action is allowed for the specified Request
	 */
	@Override
	protected boolean isAllowedAction(String action, RequestAggregate request) {
<span class="nc" id="L1116">		String status = request.getRequestStatus();</span>
<span class="nc" id="L1117">		boolean isApproved = RequestAuditTrail.STATUS_APPROVED.equals(status);</span>
<span class="nc bnc" id="L1118" title="All 6 branches missed.">		return ((PageAction.EDIT.equals(action) &amp;&amp; isAuthToUpdateRqt(request))</span>

<span class="nc bnc" id="L1120" title="All 6 branches missed.">				|| (!isApproved &amp;&amp; PageAction.WITHDRAW.equals(action) &amp;&amp; isAuthToUpdateRqt(request))</span>

<span class="nc bnc" id="L1122" title="All 6 branches missed.">				|| (isApproved &amp;&amp; (PageAction.WITHDRAW.equals(action) || PageAction.CANCEL_WITHDRAW_ACTION.equals(action)) &amp;&amp; isAuthToWithdrawApprovedRequest(request))</span>

<span class="nc bnc" id="L1124" title="All 4 branches missed.">				|| ((RmPageAction.ADD_TO_WAITLIST_ACTION.equals(action) || RmPageAction.ADD_TO_MAN_WAITLIST_ACTION.equals(action))</span>
<span class="nc bnc" id="L1125" title="All 4 branches missed.">						&amp;&amp; isAuthToViewRqt(request) &amp;&amp; isAuthToWaitlistRqt(request))</span>

<span class="nc bnc" id="L1127" title="All 4 branches missed.">				|| (PageAction.VIEW_DETAIL.equals(action) &amp;&amp; isAuthToViewRqt(request))</span>

<span class="nc bnc" id="L1129" title="All 2 branches missed.">				|| handleDenyAndApproval(action, request)</span>

<span class="nc bnc" id="L1131" title="All 4 branches missed.">				|| (PageAction.REJECT_WITHDRAW_ACTION.equals(action) &amp;&amp; isAuthToProcessRejectWithdrawRequest(request))</span>

<span class="nc bnc" id="L1133" title="All 6 branches missed.">				|| (PageAction.ACCEPT_WITHDRAW_ACTION.equals(action) &amp;&amp; isAuthToProcessAcceptWithdrawRequest(request))</span>

<span class="nc bnc" id="L1135" title="All 4 branches missed.">				|| (!isApproved &amp;&amp; PageAction.CANCEL_WITHDRAW_ACTION.equals(action) &amp;&amp; isAuthToProcessCancelWithdrawRequest(request)));</span>
	}

	private boolean handleDenyAndApproval(String action, RequestAggregate request) {

<span class="nc bnc" id="L1140" title="All 6 branches missed.">		if (!PageAction.DENY.equals(action) &amp;&amp; !PageAction.APPROVE.equals(action) &amp;&amp; !PageAction.TENTATIVELY_APPROVE.equals(action)) {</span>
<span class="nc" id="L1141">			return false;</span>
		}

<span class="nc bnc" id="L1144" title="All 2 branches missed.">		if (Request.REQUESTTYPE_TIMEOFF.equals(request.getRequestType())) {</span>
<span class="nc" id="L1145">			TORequest toReq = (TORequest) request;</span>
<span class="nc bnc" id="L1146" title="All 2 branches missed.">			if (!handleAdvancedVto(action, toReq)) {</span>
<span class="nc" id="L1147">				return false;</span>
			}
		}
<span class="nc" id="L1150">		return isAuthToApproveRqt(request);</span>
	}

	//if false the action is not allowed, if true continue with checks
	private boolean handleAdvancedVto(String action, TORequest toReq) {

		//deny is allowed for advanced vto with or without the BPConfig setting
<span class="nc bnc" id="L1157" title="All 4 branches missed.">		if (!toReq.isAdvancedVTORequest() || PageAction.DENY.equals(action)) {</span>
<span class="nc" id="L1158">			return true;</span>
		}

<span class="nc bnc" id="L1161" title="All 2 branches missed.">		if (PageAction.TENTATIVELY_APPROVE.equals(action)) {</span>
			//tentatively approve is not allowed advanced vto
<span class="nc" id="L1163">			return false;</span>
		}

		//for manual approve look at the BPConfig key
<span class="nc" id="L1167">		return RequestManagementConfigKey.getAllowManualApprovalForAdvancedVto();</span>
	}

	@Override
	public boolean isAuthToViewTORqts() {
<span class="nc bnc" id="L1172" title="All 4 branches missed.">		return super.isAuthToViewTORqts() &amp;&amp; m_user.isAuthorized(PrivilegeKeys.TOM_VIEWREQUESTSFOREMPLOYEE_ID);</span>
	}

	@Override
	public boolean isAuthToViewFTRqts() {
<span class="nc bnc" id="L1177" title="All 4 branches missed.">		return super.isAuthToViewFTRqts() &amp;&amp; m_user.isAuthorized(PrivilegeKeys.FT_VIEWREQUESTSFOREMPLOYEE_ID);</span>
	}

	@Override
	public boolean isAuthToViewSSRqts() {
<span class="nc bnc" id="L1182" title="All 4 branches missed.">		return super.isAuthToViewSSRqts() &amp;&amp; m_user.isAuthorized(PrivilegeKeys.SS_VIEWREQUESTSFOREMPLOYEE_ID);</span>
	}

	@Override
	public boolean isAuthToViewSBRqts() {
<span class="nc bnc" id="L1187" title="All 4 branches missed.">		return super.isAuthToViewSBRqts() &amp;&amp; m_user.isAuthorized(PrivilegeKeys.SB_VIEWSHIFTBIDSFOREMP_ID);</span>
	}

	@Override
	public boolean isAuthToEditTORqts() {
<span class="nc bnc" id="L1192" title="All 4 branches missed.">		return super.isAuthToEditTORqts() &amp;&amp; m_user.isAuthorized(PrivilegeKeys.TOM_MODIFYREQUESTSFOREMPLOYEE_ID);</span>
	}

	@Override
	public boolean isAuthToEditFTRqts() {
<span class="nc bnc" id="L1197" title="All 4 branches missed.">		return super.isAuthToEditFTRqts() &amp;&amp; m_user.isAuthorized(PrivilegeKeys.FT_MODIFYREQUESTSFOREMPLOYEE_ID);</span>
	}

	@Override
	public boolean isAuthToEditSSRqts() {
<span class="nc bnc" id="L1202" title="All 4 branches missed.">		return super.isAuthToEditSSRqts() &amp;&amp; m_user.isAuthorized(PrivilegeKeys.SS_MODIFYREQUESTSFOREMPLOYEE_ID);</span>
	}

	@Override
	public boolean isAuthToEditSBRqts() {
<span class="nc bnc" id="L1207" title="All 4 branches missed.">		return super.isAuthToEditSBRqts() &amp;&amp; m_user.isAuthorized(PrivilegeKeys.SB_MODIFYSHIFTBIDSFOREMP_ID);</span>
	}

	@Override
	public boolean isAuthToViewCSRqts() {
<span class="nc bnc" id="L1212" title="All 4 branches missed.">		return super.isAuthToViewCSRqts() &amp;&amp; m_user.isAuthorized(PrivilegeKeys.CS_VIEWREQUESTSFOREMPLOYEE_ID);</span>
	}

	@Override
	public boolean isAuthToEditCSRqts() {
<span class="nc bnc" id="L1217" title="All 4 branches missed.">		return super.isAuthToEditCSRqts() &amp;&amp; m_user.isAuthorized(PrivilegeKeys.CS_MODIFYREQUESTSFOREMPLOYEE_ID);</span>
	}

	/**
	 * Return true if User is authorize to view specified Request
	 */
	protected boolean isAuthToViewRqt(RequestAggregate request) {
<span class="nc" id="L1224">		String rType = request.getRequestType();</span>

<span class="nc" id="L1226">		boolean result = false;</span>
<span class="nc bnc" id="L1227" title="All 2 branches missed.">		if (Request.REQUESTTYPE_TIMEOFF.equals(rType)) {</span>
<span class="nc" id="L1228">			ID privID = PrivilegeKeys.TOM_VIEWREQUESTSFOREMPLOYEE_ID;</span>
<span class="nc" id="L1229">			result = isTOAuthPriv(request, privID);</span>
<span class="nc bnc" id="L1230" title="All 2 branches missed.">		} else if (Request.REQUESTTYPE_FLEXTIME.equals(rType)) {</span>
<span class="nc" id="L1231">			ID privID = PrivilegeKeys.FT_VIEWREQUESTSFOREMPLOYEE_ID;</span>
<span class="nc" id="L1232">			result = isFTAuthPriv(request, privID);</span>
<span class="nc bnc" id="L1233" title="All 2 branches missed.">		} else if (Request.REQUESTTYPE_SHIFTSWAP.equals(rType)) {</span>
<span class="nc" id="L1234">			ID privID = PrivilegeKeys.SS_VIEWREQUESTSFOREMPLOYEE_ID;</span>
<span class="nc" id="L1235">			result = isSSAuthPriv(request, privID);</span>
<span class="nc bnc" id="L1236" title="All 2 branches missed.">		} else if (Request.REQUESTTYPE_SHIFTBID.equals(rType)) {</span>
<span class="nc" id="L1237">			ID privID = PrivilegeKeys.SB_VIEWSHIFTBIDSFOREMP_ID;</span>
<span class="nc" id="L1238">			result = isSBAuthPriv(request, privID);</span>
<span class="nc bnc" id="L1239" title="All 2 branches missed.">		} else if (Request.REQUESTTYPE_CUSTSHIFT.equals(rType)) {</span>
<span class="nc" id="L1240">			ID privID = PrivilegeKeys.CS_VIEWREQUESTSFOREMPLOYEE_ID;</span>
<span class="nc" id="L1241">			result = isCSAuthPriv(request, privID);</span>
		}

<span class="nc" id="L1244">		return result;</span>
	}

	/**
	 * Return true if User is authorize to update specified Request
	 */
	@Override
	protected boolean isAuthToUpdateRqt(RequestAggregate request) {
<span class="nc" id="L1252">		String rType = request.getRequestType();</span>

<span class="nc" id="L1254">		boolean result = false;</span>
<span class="nc bnc" id="L1255" title="All 2 branches missed.">		if (Request.REQUESTTYPE_TIMEOFF.equals(rType)) {</span>
<span class="nc" id="L1256">			ID privID = PrivilegeKeys.TOM_MODIFYREQUESTSFOREMPLOYEE_ID;</span>
<span class="nc" id="L1257">			result = isTOAuthPriv(request, privID);</span>
<span class="nc bnc" id="L1258" title="All 2 branches missed.">		} else if (Request.REQUESTTYPE_FLEXTIME.equals(rType)) {</span>
<span class="nc" id="L1259">			ID privID = PrivilegeKeys.FT_MODIFYREQUESTSFOREMPLOYEE_ID;</span>
<span class="nc" id="L1260">			result = isFTAuthPriv(request, privID);</span>
<span class="nc bnc" id="L1261" title="All 2 branches missed.">		} else if (Request.REQUESTTYPE_SHIFTSWAP.equals(rType)) {</span>
<span class="nc" id="L1262">			ID privID = PrivilegeKeys.SS_MODIFYREQUESTSFOREMPLOYEE_ID;</span>
<span class="nc" id="L1263">			result = isSSAuthPriv(request, privID);</span>
<span class="nc bnc" id="L1264" title="All 2 branches missed.">		} else if (Request.REQUESTTYPE_SHIFTBID.equals(rType)) {</span>
<span class="nc" id="L1265">			ID privID = PrivilegeKeys.SB_MODIFYSHIFTBIDSFOREMP_ID;</span>
<span class="nc" id="L1266">			result = isSBAuthPriv(request, privID);</span>
<span class="nc bnc" id="L1267" title="All 2 branches missed.">		} else if (Request.REQUESTTYPE_CUSTSHIFT.equals(rType)) {</span>
<span class="nc" id="L1268">			ID privID = PrivilegeKeys.CS_MODIFYREQUESTSFOREMPLOYEE_ID;</span>
<span class="nc" id="L1269">			result = isCSAuthPriv(request, privID);</span>
		}

<span class="nc" id="L1272">		return result;</span>
	}

	/**
	 * Return true if User is authorize to approve specified Request
	 */
	protected boolean isAuthToApproveRqt(RequestAggregate request) {
<span class="nc" id="L1279">		String rType = request.getRequestType();</span>
<span class="nc" id="L1280">		String status = request.getRequestStatus();</span>
<span class="nc" id="L1281">		boolean isEscalated = RequestAuditTrail.STATUS_ESCALATED.equals(status);</span>

<span class="nc" id="L1283">		boolean result = false;</span>
<span class="nc bnc" id="L1284" title="All 2 branches missed.">		if (Request.REQUESTTYPE_TIMEOFF.equals(rType)) {</span>
<span class="nc bnc" id="L1285" title="All 2 branches missed.">			ID privID = isEscalated ? PrivilegeKeys.TOM_APPROVEESCALATEDREQUESTS_ID : PrivilegeKeys.TOM_APPROVEPENDINGREQUESTS_ID;</span>
<span class="nc" id="L1286">			result = isTOAuthPriv(request, privID);</span>
<span class="nc bnc" id="L1287" title="All 2 branches missed.">		} else if (Request.REQUESTTYPE_FLEXTIME.equals(rType)) {</span>
<span class="nc" id="L1288">			ID privID = PrivilegeKeys.FT_APPROVEPENDINGREQUESTS_ID;</span>
<span class="nc" id="L1289">			result = isFTAuthPriv(request, privID);</span>
<span class="nc bnc" id="L1290" title="All 2 branches missed.">		} else if (Request.REQUESTTYPE_SHIFTSWAP.equals(rType)) {</span>
<span class="nc bnc" id="L1291" title="All 2 branches missed.">			ID privID = isEscalated ? PrivilegeKeys.SS_APPROVEESCALATEDREQUESTS_ID : PrivilegeKeys.SS_APPROVEPENDINGREQUESTS_ID;</span>
<span class="nc" id="L1292">			result = isSSAuthPriv(request, privID);</span>
<span class="nc bnc" id="L1293" title="All 2 branches missed.">		} else if (Request.REQUESTTYPE_SHIFTBID.equals(rType)) {</span>
<span class="nc bnc" id="L1294" title="All 2 branches missed.">			ID privID = isEscalated ? PrivilegeKeys.SB_APPROVEESCALATEDBIDS_ID : PrivilegeKeys.SB_APPROVEPENDINGBIDS_ID;</span>
<span class="nc" id="L1295">			result = isSBAuthPriv(request, privID);</span>
<span class="nc bnc" id="L1296" title="All 2 branches missed.">		} else if (Request.REQUESTTYPE_CUSTSHIFT.equals(rType)) {</span>
<span class="nc bnc" id="L1297" title="All 2 branches missed.">			ID privID = isEscalated ? PrivilegeKeys.CS_APPROVEESCALATEDREQUESTS_ID : PrivilegeKeys.CS_APPROVEPENDINGREQUESTS_ID;</span>
<span class="nc" id="L1298">			result = isCSAuthPriv(request, privID);</span>
		}

<span class="nc" id="L1301">		return result;</span>
	}

	protected boolean isAuthToProcessAcceptWithdrawRequest(RequestAggregate request) {
<span class="nc" id="L1305">		String rType = request.getRequestType();</span>
<span class="nc" id="L1306">		boolean result = false;</span>
<span class="nc bnc" id="L1307" title="All 4 branches missed.">		if (Request.REQUESTTYPE_TIMEOFF.equals(rType) &amp;&amp; ((TORequest) request).isEligibleForAcceptWithdrawAction()) {</span>
<span class="nc" id="L1308">			result = isTOAuthPriv(request, PrivilegeKeys.TOM_ACCEPT_REJECT_WITHDRAW_REQUESTS_ID);</span>
		}
<span class="nc bnc" id="L1310" title="All 4 branches missed.">		if (Request.REQUESTTYPE_SHIFTSWAP.equals(rType) &amp;&amp; ((ShiftSwapRequest) request).isEligibleForRejectWithdrawAction()) {</span>
<span class="nc" id="L1311">			result = isSSAuthPriv(request, PrivilegeKeys.SS_APPROVEPENDINGREQUESTS_ID);</span>
		}
<span class="nc" id="L1313">		return result;</span>
	}

	protected boolean isAuthToProcessRejectWithdrawRequest(RequestAggregate request) {
<span class="nc" id="L1317">		String rType = request.getRequestType();</span>
<span class="nc" id="L1318">		boolean result = false;</span>
<span class="nc bnc" id="L1319" title="All 4 branches missed.">		if (Request.REQUESTTYPE_TIMEOFF.equals(rType) &amp;&amp; ((TORequest) request).isEligibleForRejectWithdrawAction()) {</span>
<span class="nc" id="L1320">			result = isTOAuthPriv(request, PrivilegeKeys.TOM_ACCEPT_REJECT_WITHDRAW_REQUESTS_ID);</span>
		}
<span class="nc bnc" id="L1322" title="All 4 branches missed.">		if (Request.REQUESTTYPE_SHIFTSWAP.equals(rType) &amp;&amp; ((ShiftSwapRequest) request).isEligibleForRejectWithdrawAction()) {</span>
<span class="nc" id="L1323">			result = isSSAuthPriv(request, PrivilegeKeys.SS_APPROVEPENDINGREQUESTS_ID);</span>
		}
<span class="nc" id="L1325">		return result;</span>
	}

	/**
	 * Return true if User is authorize to approve specified Time Off Request
	 */
	@Override
	protected boolean isTOAuthPriv(RequestAggregate request, ID privID) {
<span class="nc" id="L1333">		TORequest toReq = (TORequest) request;</span>
<span class="nc" id="L1334">		ID orgID = (ID) m_eOrgMap.get(toReq.getEmployeeID());</span>
<span class="nc" id="L1335">		return m_user.isAuthorized(privID, OrganizationScopeManagerProxy.getScopeID(orgID));</span>
	}

	@Override
	protected boolean isFTAuthPriv(RequestAggregate request, ID privID) {
<span class="nc" id="L1340">		TORequest toReq = (TORequest) request;</span>
<span class="nc" id="L1341">		ID orgID = (ID) m_eOrgMap.get(toReq.getEmployeeID());</span>
<span class="nc" id="L1342">		return m_user.isAuthorized(privID, OrganizationScopeManagerProxy.getScopeID(orgID));</span>
	}

	protected boolean isSSAuthPriv(RequestAggregate request, ID privID) {
<span class="nc" id="L1346">		ShiftSwapRequest ssReq = (ShiftSwapRequest) request;</span>
<span class="nc" id="L1347">		List empIDList = ssReq.getEmployees();</span>
<span class="nc" id="L1348">		ID orgID1 = (ID) m_eOrgMap.get(empIDList.get(0));</span>
<span class="nc" id="L1349">		ID orgID2 = (ID) m_eOrgMap.get(empIDList.get(1));</span>

<span class="nc bnc" id="L1351" title="All 2 branches missed.">		return m_user.isAuthorized(privID, OrganizationScopeManagerProxy.getScopeID(orgID1))</span>
<span class="nc bnc" id="L1352" title="All 2 branches missed.">				|| m_user.isAuthorized(privID, OrganizationScopeManagerProxy.getScopeID(orgID2));</span>
	}

	protected boolean isSBAuthPriv(RequestAggregate request, ID privID) {
<span class="nc" id="L1356">		ShiftBidRequest sbReq = (ShiftBidRequest) request;</span>
<span class="nc" id="L1357">		ID orgID = (ID) m_eOrgMap.get(sbReq.getEmployeeID());</span>
<span class="nc" id="L1358">		return m_user.isAuthorized(privID, OrganizationScopeManagerProxy.getScopeID(orgID));</span>
	}

	protected boolean isCSAuthPriv(RequestAggregate request, ID privID) {
<span class="nc" id="L1362">		CustShiftReq csReq = (CustShiftReq) request;</span>
<span class="nc" id="L1363">		ID orgID = (ID) m_eOrgMap.get(csReq.getEmployeeID());</span>
<span class="nc" id="L1364">		return m_user.isAuthorized(privID, OrganizationScopeManagerProxy.getScopeID(orgID));</span>
	}

	protected boolean isAuthToWithdrawApprovedRequest(RequestAggregate request) {
<span class="nc" id="L1368">		String rType = request.getRequestType();</span>

<span class="nc" id="L1370">		boolean result = false;</span>
<span class="nc bnc" id="L1371" title="All 2 branches missed.">		if (Request.REQUESTTYPE_SHIFTSWAP.equals(rType)) {</span>
<span class="nc" id="L1372">			result = isSSAuthPriv(request, PrivilegeKeys.SS_WITHDRAWREQUESTS_ID);</span>
		} else {
<span class="nc" id="L1374">			result = isAuthToUpdateRqt(request); // all other types</span>
		}
<span class="nc" id="L1376">		return result;</span>
	}

	/**
	 * Return false for other requests, true only for Time Off Requests
	 */
	protected boolean hasGroupActionForTimeOffChoice() {
<span class="nc" id="L1383">		return false;</span>
	}
	protected boolean hasGroupActionForAdvancedVTOOptions() {
<span class="nc" id="L1386">		return false;</span>
	}
	protected boolean hasGroupActionForShiftBid() {
<span class="nc" id="L1389">		return false;</span>
	}
	//QC 176957:When approving a time off the page selector jumps back to page 1 in request management- ESR#4663410-Cloned QC 177450
	//Fix for Edit action (not change status of requests)- shouldBeOnSamePageForEdit =true
	//and all actions that refresh the page after change status of requests -
	//if there is no filter or filter does not depend on status
	private boolean checkIfShouldStandOnSamePage() {
<span class="nc bnc" id="L1396" title="All 8 branches missed.">		boolean result = shouldBeOnSamePageForEdit || ((shouldBeOnSamePage || isPageActionGroupAction()) &amp;&amp; !isFilterDependOnStatus());</span>
<span class="nc" id="L1397">		return result;</span>
	}
	@SuppressWarnings(&quot;unchecked&quot;)
	private boolean checkIfListRequestHasVTORequests(){
<span class="nc bnc" id="L1401" title="All 2 branches missed.">		if(!isEmptyRequests()){</span>
<span class="nc" id="L1402">			List&lt;RequestAggregate&gt; requests= m_reqCollection.getRequests();</span>
<span class="nc bnc" id="L1403" title="All 2 branches missed.">			for(RequestAggregate request:requests){</span>
<span class="nc bnc" id="L1404" title="All 2 branches missed.">				if(request.isAdvancedVTORequest()) {</span>
<span class="nc" id="L1405">					return true;</span>
				}
<span class="nc" id="L1407">			}</span>
		}

<span class="nc" id="L1410">		return false;</span>
	}
	/**
	 * The method checks if there is a filter which depends on status.
	 * It serves for getting the current list after change status of requests.
	 * Without filter or filter which is not based on status, once request is approved/denied
	 * users should stand the same page.
	 * But if the filter depends on status, after change status, under the filter, the request with changed status should on on the page
	 */
	protected boolean isFilterDependOnStatus(){
<span class="nc" id="L1420">		boolean result = false;</span>
<span class="nc bnc" id="L1421" title="All 4 branches missed.">		if(m_rfilterBoxPC != null &amp;&amp; m_rfilterBoxPC.getSelectedFilterID()!=null){</span>
<span class="nc" id="L1422">			ID filerID = m_rfilterBoxPC.getSelectedFilterID();</span>
<span class="nc" id="L1423">			result =RequestsMH.filterDependOnStatus(filerID);</span>
		}
<span class="nc" id="L1425">		return result;</span>
	}
	//Only set when get all requests from m_reqCollection for first time/first page
	public RequestCollection getAllReqCollection() {
<span class="nc" id="L1429">		return allReqCollection;</span>
	}

	public void setAllReqCollection(RequestCollection allReqCollection) {
<span class="nc" id="L1433">		this.allReqCollection = allReqCollection;</span>
<span class="nc" id="L1434">	}</span>

	@Override
	public String getCustomJavaScript() {
<span class="nc" id="L1438">		return new StringBuilder(super.getCustomJavaScript())</span>
<span class="nc" id="L1439">			.append(getJSChangeWorkspaceAriaLabel(</span>
<span class="nc" id="L1440">				m_localizer.i18n(UIFWebBundleKey.BUNDLE_NAME, </span>
<span class="nc" id="L1441">					UIFWebBundleKey.WORK_PANE_DESCRIPTION, getPreparedContentTitleName(), &quot;&quot;)))</span>
<span class="nc" id="L1442">			.toString();</span>

	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>