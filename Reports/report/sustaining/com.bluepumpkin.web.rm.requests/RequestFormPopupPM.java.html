<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>RequestFormPopupPM.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.rm.requests</a> &gt; <span class="el_source">RequestFormPopupPM.java</span></div><h1>RequestFormPopupPM.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.rm.requests;

import java.util.*;

import com.bluepumpkin.common.datatypes.*;
import com.bluepumpkin.common.util.*;
import com.bluepumpkin.common.l10n.RegionalFormatBundleKey;
import com.bluepumpkin.web.bbm.l10n.BbmWebBundleKey;
import com.witness.web.uif.util.HtmlUtil;
import com.witness.web.uif.jsp.HtmlDiv;
import com.witness.web.uif.jsp.HtmlSpan;
import com.witness.web.uif.jsp.HtmlTableCell;
import com.witness.web.uif.l10n.UIFWebBundleKey;
import com.witness.web.uif.pagemodel.*;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.pagecomponent.*;
import com.witness.web.uif.pagecomponent.list.MultiColListPC;
import com.witness.web.uif.pagecomponent.table.TableHeaderPC;
import com.witness.web.uif.pagecomponent.toolbar.*;

import com.bluepumpkin.ejb.bbm.workresource.model.EmployeeName;
import com.bluepumpkin.ejb.rm.requests.common.model.RequestAggregate;
import com.bluepumpkin.ejb.rm.requests.common.model.RequestAggregateDummy;
import com.bluepumpkin.ejb.rm.requests.common.model.Request;
import com.bluepumpkin.ejb.rm.requests.common.validation.ValidationResult;
import com.bluepumpkin.web.rm.keys.*;
import com.bluepumpkin.web.rm.l10n.RmWebBundleKey;
import com.witness.web.uif.pagecomponent.container.MultiColCollapsibleContainerPC;

/**
 * Title:		     RequestFormPopupPM
 * Description:  Base class for Request relate popup Forms
 * Copyright:    Copyright (c) 2001
 * Company:      Blue Pumpkin Software, inc
 * @author       David Su
 * @version      1.0
 */
public abstract class RequestFormPopupPM extends PopupWindowPM {
	private static final String ALERTS_INNER_TABLE = &quot;AlertsInnerTable&quot;;
	
	protected static final String INDENT_STYLE = &quot;padding-left:20px;&quot;;
	protected static final String REQUEST_ID_FN   = &quot;requestID&quot;;
	protected static final String COMMENT_FN      = &quot;comment&quot;;
	protected static final String REQUEST_VERSION_FN = &quot;requestVersion&quot;;
	protected static final String REQUEST_TYPE_FN = &quot;requestType&quot;;
	protected static final String ORG_REQUEST_ID_FN = &quot;orgRequestID&quot;;
	public static final String READABLE_STATE_INFO_ID = &quot;readableRowStateInfo&quot;;

<span class="nc" id="L49">	protected String m_pageMode = RmKeys.RP_MODE_AGENT;</span>
	protected ID m_empID;
	protected String m_formAction;
	protected String m_comment;
	protected String m_requestType;
	protected ResourceBundle m_bundle;
	protected ResourceBundle m_bbm_bundle;
	protected RequestAggregate m_request;
	protected TimeZone m_view_tz;
<span class="nc" id="L58">	protected boolean m_isShowDoneInsteadOfCancelBtn = false;</span>
	protected ID m_orgRequestID;

	//for validation alerts (optional in request forms, but should usually be in details forms).
	protected MultiColCollapsibleContainerPC m_alertListPC;
<span class="nc" id="L63">	protected Collection m_valResults = Collections.emptyList();</span>

	/**
	 * Constructor
	 */
	public RequestFormPopupPM(RequestContext context, String formAction) {
<span class="nc" id="L69">		super(context);</span>
<span class="nc" id="L70">		m_bundle = m_localizer.getBundle(RmWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L71">		m_bbm_bundle = m_localizer.getBundle(BbmWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L72">		m_view_tz = m_context.getViewingTimeZone();</span>
<span class="nc" id="L73">		m_formAction = formAction;</span>

<span class="nc" id="L75">		m_empID = RequestUtil.getEmpIDAndAddMsgIfNotAvailable(m_context, this);</span>

<span class="nc" id="L77">		m_request = new RequestAggregateDummy();</span>
<span class="nc bnc" id="L78" title="All 2 branches missed.">		if (isAccessibilityComplianceMode()) {</span>
<span class="nc" id="L79">			addJSVariableAsString(UIFWebBundleKey.CHECKED, i18n(m_common_bundle, UIFWebBundleKey.CHECKED));</span>
<span class="nc" id="L80">			addJSVariableAsString(UIFWebBundleKey.UNCHECKED, i18n(m_common_bundle, UIFWebBundleKey.UNCHECKED));</span>
		}
<span class="nc" id="L82">	}</span>

	/**
	 * Return Employee Name
	 */
	protected String getEmployeeName(ID empID, Map eNameMap) {
<span class="nc bnc" id="L88" title="All 4 branches missed.">		if (eNameMap==null || eNameMap.isEmpty()) {</span>
<span class="nc" id="L89">			return &quot;&quot;;</span>
		}
<span class="nc" id="L91">		EmployeeName eName = (EmployeeName)eNameMap.get(empID);</span>
<span class="nc bnc" id="L92" title="All 2 branches missed.">		return (eName!=null)?m_localizer.formatName(eName):empID.toString();</span>
	}

	/**
	 * Add Row Data to List Model
	 */
	protected void addDataRow(String content, List listModel) {
<span class="nc" id="L99">		DefaultMultiColumnNodeData node = new DefaultMultiColumnNodeData();</span>
<span class="nc" id="L100">		node.add(content + &quot;&lt;br&gt;&lt;br&gt;&quot;, INDENT_STYLE);</span>
<span class="nc" id="L101">		listModel.add(node);</span>
<span class="nc" id="L102">	}</span>

	/**
	 * Create View Option
	 */
	protected StringsPair createViewOption(String value, String rbKey) {
<span class="nc" id="L108">		return new StringsPair(value, i18n(m_bundle, rbKey));</span>
	}

	/**
	 * Format Date
	 */
	protected String formatDate(Date date) {
<span class="nc" id="L115">		return m_localizer.formatDate(date, m_view_tz, RegionalFormatBundleKey.DATE_FORMAT);</span>
	}

	/**
	 * Format Date Time
	 */
	protected String formatDateTime(Date date) {
<span class="nc" id="L122">		return m_localizer.formatDateTime(date, m_view_tz);</span>
	}
	
	protected String formatDateTime(Date date, TimeZone tz) {
<span class="nc" id="L126">		return m_localizer.formatDateTime(date, tz);</span>
	}

	/**
	 * Return URL for HTML Form Action
	 */
	@Override
	public String getFormAction() {
<span class="nc" id="L134">		return m_formAction;</span>
	}

<span class="nc" id="L137">	protected boolean isSaveButtonEnabled() { return true; }</span>

	/**
	 * Prepare toolbar for rendering
	 */
	@Override
	protected void initToolbar(){
<span class="nc" id="L144">		ToolbarUtil.addValidateSaveBtn(m_toolbar, isSaveButtonEnabled());</span>
<span class="nc bnc" id="L145" title="All 2 branches missed.">		if (m_isShowDoneInsteadOfCancelBtn) {</span>
<span class="nc" id="L146">			ToolbarUtil.addCloseWindowDoneBtn(m_toolbar, true);</span>
		} else {
<span class="nc" id="L148">			ToolbarUtil.addCloseWindowCancelBtn(m_toolbar, true);</span>
		}
<span class="nc" id="L150">		ToolbarUtil.addResetBtn(m_toolbar, true);</span>
<span class="nc" id="L151">	}</span>

	/**
	 * Initialize Toolbar
	 */
	protected void initToolbar(boolean isNormal) {
<span class="nc bnc" id="L157" title="All 2 branches missed.">		if (isNormal) {</span>
<span class="nc" id="L158">			initToolbar();</span>
		} else {
<span class="nc" id="L160">			super.initToolbar();</span>
		}
<span class="nc" id="L162">	}</span>

	/**
	 * Specify the ID of the request that was just saved.
	 * It specify to the popup to show the 'Done' button instead of Cancel
	 * and refresh Opener on Close.
	 *
	 * @param requestID
	 */
	public void setSavedRequestID(ID requestID) {
<span class="nc" id="L172">		setRequestID(requestID);</span>
<span class="nc" id="L173">		setIsRefreshOpenerOnClose(true);</span>
<span class="nc" id="L174">		m_isShowDoneInsteadOfCancelBtn = true;</span>
<span class="nc" id="L175">	}</span>

	/**
	 * Set Request ID
	 */
	public void setRequestID(ID id) {
<span class="nc" id="L181">        m_orgRequestID = id;</span>
<span class="nc bnc" id="L182" title="All 2 branches missed.">		if (m_request!=null) {</span>
<span class="nc" id="L183">			m_request.setID(id);</span>
		}
<span class="nc" id="L185">	}</span>

	/**
	 * Return Request ID
	 */
	public ID getRequestID() {
<span class="nc bnc" id="L191" title="All 2 branches missed.">		return (m_request!=null)?m_request.getID():null;</span>
	}

	/**
	 * Set Request ID
	 */
	public void setOrgRequestID(ID id) {
<span class="nc" id="L198">        m_orgRequestID = id;</span>
<span class="nc" id="L199">	}</span>

	/**
	 * Return Request ID
	 */
	public ID getOrgRequestID() {
<span class="nc" id="L205">		return m_orgRequestID;</span>
	}

	/**
	 * Set Request Value Object Version
	 */
	public void setRequestVersion(String version) {
<span class="nc bnc" id="L212" title="All 2 branches missed.">		if (m_request!=null) {</span>
<span class="nc" id="L213">			m_request.setObjectVersionNumber(version);</span>
		}
<span class="nc" id="L215">	}</span>

	/**
	 * Return Request Value Object Version
	 */
	public String getRequestVersion() {
<span class="nc bnc" id="L221" title="All 2 branches missed.">		return (m_request!=null)?m_request.getObjectVersionNumber():&quot;&quot;;</span>
	}

	/**
	 * Specify the REquest Type
	 */
	public void setRequestType(String type) {
<span class="nc" id="L228">		m_requestType = type;</span>
<span class="nc" id="L229">	}</span>

	/**
	 * Return Request Type
	 */
	public String getRequestType() {
<span class="nc bnc" id="L235" title="All 2 branches missed.">		if (m_request!=null) {</span>
<span class="nc" id="L236">			String rType = m_request.getRequestType();</span>
<span class="nc bnc" id="L237" title="All 4 branches missed.">			if (!StringUtil.isEmpty(rType) &amp;&amp; !Request.REQUESTTYPE_ALL.equals(rType)) {</span>
<span class="nc" id="L238">				m_requestType = rType;</span>
			}
		}

<span class="nc" id="L242">		return m_requestType;</span>
	}

	/**
	 * Set Comment
	 */
	public void setComment(String comment) {
<span class="nc" id="L249">		m_comment = comment;</span>
<span class="nc" id="L250">	}</span>

	/**
	 * Return Comment
	 */
	public String getComment() {
<span class="nc" id="L256">		return m_comment;</span>
	}

	/**
	 * Return True if Request is New
	 */
	public boolean isNew() {
<span class="nc bnc" id="L263" title="All 2 branches missed.">		return m_orgRequestID == null;</span>
	}

	/**
	 * return true if it is in manager mode
	 */
	public boolean isManagerMode() {
<span class="nc" id="L270">		return RmKeys.RP_MODE_MGR.equals(m_pageMode);</span>
	}

	/**
	 * Set Page Mode whether to render page for Agent or Manager
	 */
	public void setPageMode(String mode) {
<span class="nc" id="L277">		m_pageMode = mode;</span>
<span class="nc" id="L278">	}</span>

	/**
	 * Return Page Mode whether to render page for Agent or Manager
	 */
	public String getPageMode() {
<span class="nc" id="L284">		return m_pageMode;</span>
	}



	/**
	 * Return Required HTML
	 */
	@Override
	public String getRequiredHTML() {
<span class="nc" id="L294">		return super.getRequiredHTML() + getRequestRequiredHTML();</span>
	}

	/**
	 * Return Required HTML for Request Popups
	 */
	protected String getRequestRequiredHTML() {
<span class="nc" id="L301">		String rID = &quot;&quot;;</span>
<span class="nc bnc" id="L302" title="All 4 branches missed.">		if (!isNew() &amp;&amp; m_request != null) {</span>
			//For Copy request form, when the request !=null but getRequestID can be null if it violates hard validation rules
<span class="nc bnc" id="L304" title="All 2 branches missed.">			rID = getRequestID()==null? null:getRequestID().toString();</span>
		}

<span class="nc" id="L307">		return HtmlUtil.makeHiddenInput(REQUEST_ID_FN, rID) +</span>
<span class="nc" id="L308">				HtmlUtil.makeHiddenInput(REQUEST_VERSION_FN, getRequestVersion()) +</span>
<span class="nc" id="L309">				HtmlUtil.makeHiddenInput(REQUEST_TYPE_FN, getRequestType()) +</span>
<span class="nc" id="L310">				HtmlUtil.makeHiddenInput(ORG_REQUEST_ID_FN, getOrgRequestID()) +</span>
<span class="nc" id="L311">				HtmlUtil.makeHiddenInput(RmKeys.PAGE_MODE_FN, m_pageMode);</span>
	}

	/**
	 * Initialize Alert List
	 */
	protected void initAlertList() {
<span class="nc" id="L318">		m_alertListPC = createAlertsList();</span>
<span class="nc" id="L319">		m_alertListPC.getMultiColListPC().setHeightInPixels(150);</span>
<span class="nc" id="L320">		TableHeaderPC header = m_alertListPC.getMultiColListPC().getHeader();</span>
<span class="nc" id="L321">		header.addColumnHeaderData(&quot;&quot;, i18n(m_common_bundle, UIFWebBundleKey.ALERTS));</span>
<span class="nc" id="L322">		header.addColumnHeaderData(&quot;&quot;, i18n(m_common_bundle, UIFWebBundleKey.DESCRIPTION));</span>
<span class="nc" id="L323">		m_alertListPC.setIsBorderEnabled(true);</span>
<span class="nc" id="L324">		m_alertListPC.setEnabled(true);</span>

<span class="nc bnc" id="L326" title="All 2 branches missed.">		if (!m_valResults.isEmpty()) {</span>
<span class="nc" id="L327">			ArrayList listModel = new ArrayList(m_valResults.size());</span>
<span class="nc bnc" id="L328" title="All 2 branches missed.">			for(Iterator it=m_valResults.iterator(); it.hasNext(); ) {</span>
<span class="nc" id="L329">				ValidationResult vr = (ValidationResult)it.next();</span>
<span class="nc" id="L330">				DefaultMultiColumnNodeData node = new DefaultMultiColumnNodeData();</span>
<span class="nc" id="L331">				node.add( RequestUtil.createAlertIcon(vr, m_localizer, true, true) );</span>
<span class="nc" id="L332">				node.add( vr.getLocalizedMessage(m_localizer, m_view_tz) );</span>
<span class="nc" id="L333">				listModel.add(node);</span>
<span class="nc" id="L334">			}</span>
<span class="nc" id="L335">			m_alertListPC.getMultiColListPC().setListModel(listModel);</span>
		}
<span class="nc" id="L337">	}</span>

	/**
	 * Create New List PC. To be overridden in interested implementations.
	 */
	protected MultiColListPC createNewList() {
<span class="nc" id="L343">		return null;</span>
	}

	/**
	 * Create the collapsible Alert List PC. Overrides parent class.
	 */
	protected MultiColCollapsibleContainerPC createAlertsList() {
<span class="nc" id="L350">		MultiColCollapsibleContainerPC listPC = null;</span>
<span class="nc bnc" id="L351" title="All 2 branches missed.">		if (isAccessibilityComplianceMode()) {</span>
<span class="nc" id="L352">			MultiColListPC innerListPC = new MultiColListPC(m_context) {</span>
				
				@Override
				protected boolean skipEncloseForKeyboardAccess(BaseNodeData nodeData){
<span class="nc" id="L356">					return false;</span>
				}
				
				@Override
				protected HtmlDiv getNewHtmlDiv() {
<span class="nc" id="L361">					HtmlDiv wrapper = super.getNewHtmlDiv();</span>
<span class="nc" id="L362">					wrapper.setAttribute(ATTR_ARIA_LABEL, i18n(m_common_bundle, UIFWebBundleKey.ALERTS));</span>
<span class="nc" id="L363">					return wrapper;</span>
				}

				@Override
				protected String getCellData(HtmlTableCell cell) {
<span class="nc" id="L368">					String cellData = super.getCellData(cell);</span>
<span class="nc" id="L369">					cellData = HtmlUtil.createHiddenReadableText(getInnerTextFromImg(cellData)) + cellData;</span>
<span class="nc" id="L370">					return cellData;</span>
				}
			};
<span class="nc" id="L373">			innerListPC.setReadableRowInfoEnabled(true);</span>
<span class="nc" id="L374">			innerListPC.setWrapperRegion(true);</span>
<span class="nc" id="L375">			innerListPC.disableRepeatHeader();</span>
<span class="nc" id="L376">			innerListPC.addTableArrowNavigation();</span>
<span class="nc" id="L377">			innerListPC.setRenderJavaScriptIfDisabled(true);</span>
<span class="nc" id="L378">			innerListPC.setName(ALERTS_INNER_TABLE);</span>

<span class="nc" id="L380">			listPC = new MultiColCollapsibleContainerPC(m_context, innerListPC) {</span>
				
				@Override
				public String getJavaScriptInitCode() {
<span class="nc" id="L384">					StringBuilder jsInitCode = new StringBuilder(super.getJavaScriptInitCode());</span>
<span class="nc" id="L385">					jsInitCode.append(this.getMultiColListPC().getJavaScriptInitCode());</span>
<span class="nc" id="L386">					return jsInitCode.toString();</span>
				}
			};
<span class="nc" id="L389">			listPC.setWrapperRegion(false);</span>
<span class="nc" id="L390">			listPC.setUseWrapper(false);</span>
<span class="nc" id="L391">		} else {</span>
<span class="nc" id="L392">			listPC = new MultiColCollapsibleContainerPC(m_context);</span>
		}
<span class="nc" id="L394">		listPC.setTitle(i18n(m_common_bundle, UIFWebBundleKey.ALERTS));</span>
<span class="nc" id="L395">		listPC.setEnabled(true);</span>
<span class="nc" id="L396">		listPC.setIsBorderEnabled(true);</span>
<span class="nc" id="L397">		listPC.getMultiColListPC().setTableAttribute(&quot;summary&quot;, i18n(m_bundle, RmWebBundleKey.ALERTS_TABLE));</span>
<span class="nc" id="L398">		return listPC;</span>
	}
	protected String i18n(String rmBundleKey){
<span class="nc" id="L401">		return i18n(m_bundle,rmBundleKey);</span>
	}

	private String getHiddenChoiceStateIfPresent(String content) {
<span class="nc" id="L405">		String resultText = &quot;&quot;;</span>
<span class="nc" id="L406">		String inputOpenTag = &quot;&lt;input&quot;;</span>
<span class="nc" id="L407">		String closeTag = &quot;&gt;&quot;;</span>
<span class="nc bnc" id="L408" title="All 2 branches missed.">		if (content.contains(inputOpenTag)) {</span>
<span class="nc" id="L409">			int inputOpenTagIdx = content.indexOf(inputOpenTag);</span>
<span class="nc" id="L410">			int inputCloseTagIdx = content.indexOf(closeTag, inputOpenTagIdx) + 1;</span>
<span class="nc" id="L411">			String inputTagText = content.substring(inputOpenTagIdx, inputCloseTagIdx);</span>
<span class="nc" id="L412">			final String typeAttr = &quot;type=\&quot;&quot;;</span>
<span class="nc" id="L413">			final String radioType = &quot;radio&quot;;</span>
<span class="nc" id="L414">			final String checkboxType = &quot;checkbox&quot;;</span>
<span class="nc" id="L415">			final String checkedAttr = &quot;checked&quot;;</span>
<span class="nc" id="L416">			int typeAttrIdx = inputTagText.indexOf(typeAttr);</span>
<span class="nc bnc" id="L417" title="All 2 branches missed.">			if (inputTagText.contains(typeAttr)) {</span>
<span class="nc" id="L418">				typeAttrIdx = typeAttrIdx + typeAttr.length();</span>
<span class="nc" id="L419">				String inputType = inputTagText.substring(typeAttrIdx, inputTagText.indexOf('\&quot;', typeAttrIdx));</span>
<span class="nc bnc" id="L420" title="All 4 branches missed.">				if (radioType.equals(inputType) || checkboxType.equals(inputType)) {</span>
<span class="nc" id="L421">					String choiceState = i18n(m_common_bundle, UIFWebBundleKey.UNCHECKED);</span>
<span class="nc bnc" id="L422" title="All 2 branches missed.">					if (inputTagText.contains(checkedAttr)) {</span>
<span class="nc" id="L423">						choiceState = i18n(m_common_bundle, UIFWebBundleKey.CHECKED);</span>
					}
<span class="nc" id="L425">					HtmlSpan hiddenSpanWState = new HtmlSpan();</span>
<span class="nc" id="L426">					hiddenSpanWState.setAttribute(&quot;class&quot;, &quot;hidden-label &quot; + READABLE_STATE_INFO_ID);</span>
<span class="nc" id="L427">					hiddenSpanWState.setInnerHtml(choiceState);</span>
<span class="nc" id="L428">					resultText = hiddenSpanWState.toString();</span>
				}
			}
		}
<span class="nc" id="L432">		return resultText;</span>
	}
	
	/** 
	 * Create New List PC with WCAG support. Overrides parent class.
	 */
	protected MultiColListPC createComplianceModeList(final String title) {
<span class="nc" id="L439">		MultiColListPC listPC = null;</span>
<span class="nc" id="L440">		boolean isChoiceTablePC = i18n(m_bundle, RmWebBundleKey.TIMEOFF_CHOICES_GRID).equals(title); </span>
		
<span class="nc bnc" id="L442" title="All 2 branches missed.">		if (isChoiceTablePC) {</span>
<span class="nc" id="L443">			listPC = new MultiColListPC(m_context) {</span>
<span class="nc" id="L444">				private String originCellData = &quot;&quot;;</span>
				
				@Override
				protected HtmlDiv getNewHtmlDiv() {
<span class="nc" id="L448">					HtmlDiv htmlDiv = super.getNewHtmlDiv();</span>
<span class="nc" id="L449">					htmlDiv.setAttribute(&quot;aria-label&quot;, title);</span>
<span class="nc" id="L450">					return htmlDiv;</span>
				}
				
				@Override
				protected boolean skipEncloseForKeyboardAccess(BaseNodeData nodeData){
<span class="nc bnc" id="L455" title="All 4 branches missed.">					return !this.isKeyboardAccessible() || !nodeData.isSelectable();</span>
				}
				
				@Override
				protected String addAdditionalCellText(HtmlTableCell cell) {
<span class="nc" id="L460">					return originCellData;</span>
				}
				
				@Override
				protected String getCellData(HtmlTableCell cell) {
<span class="nc" id="L465">					originCellData = cell.getInnerHtml().toString();</span>
<span class="nc" id="L466">					String timeOffDate = getTimeOffDateText(originCellData) + &quot;\n&quot; + getHiddenChoiceStateIfPresent(originCellData);</span>
<span class="nc" id="L467">					return StringUtil.NBSP + HtmlUtil.createHiddenReadableText(timeOffDate);</span>
				}
				
				private String getTimeOffDateText(String cellData) {
<span class="nc" id="L471">					String text =  &quot; &quot; + cellData;</span>
<span class="nc bnc" id="L472" title="All 2 branches missed.">					if (!StringUtil.isEmpty(cellData)) {</span>
<span class="nc" id="L473">						String linkCloseTag = &quot;&lt;/a&gt;&quot;;</span>
<span class="nc" id="L474">						String spanRegex = &quot;&lt;span(.*?)span&gt;&quot;;</span>
<span class="nc" id="L475">						String checkBoxIdent = &quot;CHOICE_INPUT&quot;;</span>
<span class="nc bnc" id="L476" title="All 2 branches missed.">						if (cellData.indexOf(linkCloseTag) &gt; -1) {</span>
<span class="nc" id="L477">							int startIndex = cellData.indexOf(linkCloseTag) + linkCloseTag.length();</span>
<span class="nc" id="L478">							text = cellData.substring(startIndex);</span>
<span class="nc bnc" id="L479" title="All 2 branches missed.">						} else if (cellData.indexOf(checkBoxIdent) &gt; -1) {</span>
<span class="nc" id="L480">							text = cellData.replaceAll(spanRegex, &quot;&quot;);</span>
						}
					}
<span class="nc" id="L483">					return text;</span>
				}
				
				@Override
				protected String getCustomCellTemplate() {
<span class="nc" id="L488">					return &quot;\n&lt;a class=\&quot;focusableNode\&quot; href=\&quot;#{1}\&quot; onClick=\&quot;return false;\&quot; &quot; +</span>
							&quot;onKeyDown=\&quot;{0}.onKeyDown(this);\&quot;&gt;{2}&lt;/a&gt;&quot;;
				}
			};
		} else {
<span class="nc" id="L493">			listPC = new MultiColListPC(m_context) {</span>
				@Override
				protected HtmlDiv getNewHtmlDiv() {
<span class="nc" id="L496">					HtmlDiv htmlDiv = super.getNewHtmlDiv();</span>
<span class="nc" id="L497">					htmlDiv.setAttribute(ATTR_ARIA_LABEL, title);</span>
<span class="nc" id="L498">					return htmlDiv;</span>
				}
				
				@Override
				protected boolean skipEncloseForKeyboardAccess(BaseNodeData nodeData){
<span class="nc bnc" id="L503" title="All 4 branches missed.">					return !this.isKeyboardAccessible() || !nodeData.isSelectable();</span>
				}
			};
		}
		
<span class="nc" id="L508">		listPC.addTableArrowNavigation();</span>
<span class="nc" id="L509">		listPC.setUseWrapper(true);</span>
<span class="nc" id="L510">		listPC.setWrapperRegion(true);</span>
<span class="nc" id="L511">		listPC.disableRepeatHeader();</span>
<span class="nc" id="L512">		listPC.setReadableRowInfoEnabled(true);</span>
<span class="nc" id="L513">		listPC.setRenderJavaScriptIfDisabled(true);</span>
		
<span class="nc" id="L515">		listPC.setEnabled(false);</span>
<span class="nc" id="L516">		listPC.setIsBorderEnabled(true);</span>

<span class="nc" id="L518">		return listPC;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>