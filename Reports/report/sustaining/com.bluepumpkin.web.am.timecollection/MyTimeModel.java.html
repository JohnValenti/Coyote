<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>MyTimeModel.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.am.timecollection</a> &gt; <span class="el_source">MyTimeModel.java</span></div><h1>MyTimeModel.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.am.timecollection;

import java.rmi.RemoteException;
import java.text.DateFormat;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.Collection;
import java.util.Date;
import java.util.HashMap;
import java.util.Iterator;
import java.util.ResourceBundle;
import java.util.TimeZone;

import javax.servlet.http.HttpServletRequest;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.StringsPair;
import com.bluepumpkin.common.util.StringUtil;
import com.bluepumpkin.ejb.am.AmEJBCreateException;
import com.bluepumpkin.ejb.bbm.activity.model.Activity;
import com.bluepumpkin.ejb.bbm.activity.model.ActivityCategory;
import com.bluepumpkin.ejb.bbm.activity.model.ActivityGroup;
import com.bluepumpkin.ejb.bbm.workresource.model.Organization;
import com.bluepumpkin.ejb.core.profile.model.UserProfile;
import com.bluepumpkin.web.am.keys.AmJavaScriptFileID;
import com.bluepumpkin.web.am.l10n.AmWebBundleKey;
import com.bluepumpkin.web.am.l10n.AmWebLogBundleKey;
import com.bluepumpkin.web.bbm.activity.ActivityModelHandler;
import com.bluepumpkin.web.core.user.profile.UserProfileManager;
import com.witness.ejb.core.security.model.User;
import com.witness.web.uif.base.Message;
import com.witness.web.uif.keys.JavaScriptFileID;
import com.witness.web.uif.keys.UserPreferenceKeys;
import com.witness.web.uif.pagecomponent.picker.date.DatePickerPC;
import com.witness.web.uif.pagemodel.PageModel;
import com.witness.web.uif.system.RequestContext;

/**
 * Title:        Blue Pumpkin Software Activity Management
 * Description:  My Time page model
 * Copyright:    Copyright (c) 2001
 * Company:      Blue Pumpkin Software, inc
 * @author       Swati Tewari
 * @version      1.0
 */

public abstract class MyTimeModel extends PageModel{
<span class="nc" id="L48">	public static int GET_STATUS_MODEL = 1;</span>
<span class="nc" id="L49">	public static int TIME_RECORD_MODEL = 2;</span>
<span class="nc" id="L50">	public static int SCHEDULE_MODEL = 3;</span>

	// error codes
	protected static final int NO_START_SHIFT = 1;
	protected static final int ERROR_ENDING_SHIFT = 2;
	protected static final int ERROR_CHANGING_SHIFT = 3;
	protected static final int SHIFT_ENDED = 4;
	protected static final int NO_ACTIVITY = 5;
	protected static final int ACTIVITY_DELETED = 6;
	protected static final int ACTIVITY_CHANGED = 7;
	protected static final int ACTIVITY_STARTED = 8;

	public static final String MODEL_KEY = &quot;MyTimeModel&quot;;
	/** input submit: the pageAction value for Start Shift */
	public static final String START_ACTIVITY = &quot;START_ACTIVITY&quot;;
	/** input submit: the pageAction value for End Shift */
	public static final String END_SHIFT = &quot;END_SHIFT&quot;;
	/** input submit: the pageAction value for get status */
	public static final String GET_STATUS = &quot;GET_STATUS&quot;;

	public static final String SHOW_LOG_INT = &quot;SHOW_LOG_INT&quot;;
	public static final String HIDE_LOG_INT = &quot;HIDE_LOG_INT&quot;;

	protected static final String MYTIME_SN = &quot;mytimSN&quot;;
	protected static final String MYTIME_DEVICEID_FROMCOOKIE = &quot;mytimeDeviceIDFromCookie&quot;;
	protected static final String MYTIME_DEVICEID_FILEPATH = &quot;mytimeDeviceIDFilePath&quot;;
	protected static final String MYTIME_ENCRYPT_DEVICEID = &quot;mytimeEncryptDeviceID&quot;;
	protected static final String MYTIME_DEVICEID_AUTOINSTALL = &quot;mytimeAutoInstallDeviceID&quot;;

	// Field names
	public static final String DEVICE_ID = &quot;deviceID&quot;;
	public static final String PUNCH_ID = &quot;punchID&quot;;
	public static final String PAGE_ACTION = &quot;pageAction&quot;;
	public static final String PULL_COUNT = &quot;pullCount&quot;;
	public static final String PUNCH_CODE = &quot;punchCode&quot;;
	public static final String ACTIVITY_FN = &quot;activity&quot;;
	// request name
	public static final String STATUS_REQUEST = &quot;/hiddenform&quot;;
	public static final String CHANGE_REQUEST = &quot;/processchangeshift&quot;;
	public static final String SCHEDULE_REQUEST = &quot;/showschedule&quot;;

	private ID activityCategory;
	private ID activity;
	private String notes;
	private ID state;
<span class="nc" id="L95">	private String stateStr = &quot;none&quot;;</span>
<span class="nc" id="L96">	private boolean enableDeviceId = true;</span>
<span class="nc" id="L97">	protected ArrayList myTimeEvent = new ArrayList();</span>
<span class="nc" id="L98">	private ArrayList allActivities = new ArrayList();</span>
<span class="nc" id="L99">	private boolean showLog = true;</span>
<span class="nc" id="L100">	protected ID empId = null;</span>
<span class="nc" id="L101">	private ID orgId = null;</span>
<span class="nc" id="L102">	protected int m_punchID = -1;</span>
<span class="nc" id="L103">	private boolean endShiftDisabled = false;</span>
<span class="nc" id="L104">	private String deviceID=&quot;&quot;;</span>
	protected ResourceBundle m_bundle;
	private int startYear;
	private int startMonth;
	private int startDay;
<span class="nc" id="L109">	private String firstName = &quot;test&quot;;</span>
<span class="nc" id="L110">	private String lastName = &quot;test&quot;;</span>
<span class="nc" id="L111">	protected int m_iTimeoutLength = 0;</span>
<span class="nc" id="L112">	protected String m_sStatusMessages = &quot;&quot;;</span>
<span class="nc" id="L113">	protected int m_iPullCount = 0;</span>
	protected static final int initialTimeoutLength = 3000;
<span class="nc" id="L115">	protected boolean m_sortAscend = true;</span>
<span class="nc" id="L116">	protected ArrayList m_sortOptions = null;</span>
	private DatePickerPC m_datePicker;
	protected UserProfile aProfile;
<span class="nc" id="L119">	protected int punchCode = -1;</span>
<span class="nc" id="L120">	protected int m_errorCode = 0;</span>
<span class="nc" id="L121">	protected int m_pageSN = 0;</span>
<span class="nc" id="L122">	protected boolean m_validSN = true;</span>
	private HashMap m_activityColorMap;
<span class="nc" id="L124">	private String m_activityDisplayName = &quot;-1&quot;;</span>

	//[Swati] London: no support for agent control
	/*private boolean m_useDeviceIDFromCookie = true;
	private static DBConfigManager m_configMgr = null;
	private String m_deviceIDFilePath = null;
	private int m_encryptDeviceID = 0;
	protected boolean m_bCanEditDevice = false;
	private boolean m_autoInstallDeviceID = false; */

	public MyTimeModel(RequestContext context,int type) throws Exception {
<span class="nc" id="L135">		super(context, PageModel.BASIC_MODEL);</span>
<span class="nc" id="L136">		m_context = context;</span>
<span class="nc" id="L137">		m_bundle = m_localizer.getBundle(AmWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L138">		getContentTitle().setVisible(false);</span>
        
<span class="nc" id="L140">        stateStr = m_localizer.i18n(AmWebBundleKey.BUNDLE_NAME, AmWebBundleKey.ADHERENCE_SORT_NONE);</span>

<span class="nc" id="L142">        stateStr = m_localizer.i18n(AmWebBundleKey.BUNDLE_NAME, AmWebBundleKey.ADHERENCE_SORT_NONE);</span>
        
		//Presentation
<span class="nc" id="L145">		this.setWorkAreaId(&quot;myTimeWrapper&quot;);</span>
<span class="nc" id="L146">		this.setTemplateStyle(&quot;&quot;, &quot;margin:5px 15px 0px 15px;&quot;, &quot;background-color:#f4f4f4; border:none;&quot;,</span>
		 &quot;border-bottom:none; margin-bottom:20px; overflow:visible;&quot;, &quot;&quot;);
<span class="nc" id="L148">		this.setMinWorkAreaHeight(365);</span>

		//add javascript variables
<span class="nc" id="L151">		addJSVariable(&quot;notesLength&quot;, m_bundle, AmWebBundleKey.MSG_JS_NOTES_LENGTH);</span>

<span class="nc bnc" id="L153" title="All 2 branches missed.">		if ( type == SCHEDULE_MODEL ) {</span>
<span class="nc" id="L154">			m_datePicker = new DatePickerPC(context, &quot;start&quot;);</span>
<span class="nc" id="L155">			addChildComponent(m_datePicker);</span>
		}

<span class="nc bnc" id="L158" title="All 2 branches missed.">		if ( type != GET_STATUS_MODEL ) {</span>
			// Initialize date - it will replace by extractParameeters if it existed in the
			// parameters
<span class="nc" id="L161">			Calendar calendar = getCalendar();</span>
<span class="nc" id="L162">			calendar.setTime(new Date(System.currentTimeMillis()));</span>
<span class="nc" id="L163">			startYear = calendar.get(Calendar.YEAR);</span>
<span class="nc" id="L164">			startMonth = calendar.get(Calendar.MONTH);</span>
<span class="nc" id="L165">			startDay = calendar.get(Calendar.DATE);</span>
		}
<span class="nc" id="L167">		extractParameters(context.getRequest());</span>
<span class="nc" id="L168">		User aUser = context.getUser();</span>

		try {
<span class="nc" id="L171">			empId = aUser.getEmployeeID();</span>
<span class="nc" id="L172">		} catch (Exception e){</span>
			// error message will be handle in the next line.
<span class="nc" id="L174">		}</span>
<span class="nc bnc" id="L175" title="All 4 branches missed.">		if ( empId == null &amp;&amp; type != GET_STATUS_MODEL ) {</span>
<span class="nc" id="L176">				addPageMessage(Message.ERROR_TYPE,</span>
					AmWebBundleKey.MSG_NEEDEMPID, AmWebBundleKey.BUNDLE_NAME);
		}
<span class="nc" id="L179">		aProfile = UserProfileManager.getUserProfile(context,aUser.getID());</span>
<span class="nc" id="L180">		setValuesFromProfile(aProfile);</span>
		//[Swati] London: no support for agent control
		/*if (m_useDeviceIDFromCookie)
			deviceID = checkDeviceID(context, &quot;DEVICE_ID&quot;);
		else
			deviceID = checkDeviceID(context, &quot;DEVICE_ID_CONTROL&quot;);   */
<span class="nc" id="L186">		processActivityGroup(context);</span>
<span class="nc bnc" id="L187" title="All 2 branches missed.">		if ( empId != null)</span>
<span class="nc" id="L188">			processCurrentActivity();</span>
<span class="nc bnc" id="L189" title="All 2 branches missed.">		if ( type != GET_STATUS_MODEL ) {</span>
			// Make sure Notes length is valid
			//this.addValidator(
			//new InLengthRangeFieldValidator(this, &quot;myNotes&quot;,
			//AmWebBundleKey.MY_NOTES, AmWebBundleKey.BUNDLE_NAME, 0, 199));
			//[Swati] London: no support for agent control
			/*addPopupArgs(&quot;POPUP_DEVICEID&quot;, &quot;setid&quot;, DEVICE_ID, null,
									&quot;350,220,ctr,ctr&quot;, true, 0);*/

<span class="nc" id="L198">			addRequiredJavaScriptFile(AmJavaScriptFileID.MODULE_ACTIVITY_MEDIATOR);</span>
<span class="nc" id="L199">			addRequiredJavaScriptFile(AmJavaScriptFileID.MODULE_LISTBOX_PRIMARY);</span>
<span class="nc" id="L200">			addRequiredJavaScriptFile(AmJavaScriptFileID.MODULE_LISTBOX_SECONDARY);</span>
<span class="nc" id="L201">			addRequiredJavaScriptFile(JavaScriptFileID.MODULE_TOOLBAR);</span>
<span class="nc" id="L202">			addRequiredJavaScriptFile(AmJavaScriptFileID.MODULE_SCHEDULE_ITEM);</span>
<span class="nc" id="L203">			addRequiredJavaScriptFile(JavaScriptFileID.MODULE_TABLE);</span>
<span class="nc" id="L204">			addRequiredJavaScriptFile(JavaScriptFileID.MODULE_LISTBOX);</span>
<span class="nc" id="L205">			addRequiredJavaScriptFile(AmJavaScriptFileID.UTIL_COOKIE);</span>
<span class="nc" id="L206">			setName(&quot;activityMediator&quot;);</span>
			//--- add a DatePicker Dialog Box
			// It is enclosed in a DialogBoxPageModel to provide DialogMediator support.
<span class="nc" id="L209">			setJSMediator(AmJavaScriptFileID.MODULE_ACTIVITY_MEDIATOR);</span>
<span class="nc" id="L210">			addJSVariable(&quot;noActivity&quot;, m_bundle, AmWebBundleKey.MSG_NEEDS_ACTIVITY);</span>

			//save the profile
<span class="nc" id="L213">			aProfile.loadProperty(UserPreferenceKeys.USER_MYTIME_SORT_ORDER);</span>
<span class="nc" id="L214">			String sort = aProfile.getProperty(UserPreferenceKeys.USER_MYTIME_SORT_ORDER);</span>
<span class="nc bnc" id="L215" title="All 4 branches missed.">			if ( sort != null &amp;&amp; sort.equals(&quot;0&quot;) ) {</span>
<span class="nc" id="L216">				m_sortAscend = false;</span>
			}
			//[Swati] London: no support for agent control
			/*if ( empId != null )
				m_bCanEditDevice = aUser.isAuthorized(PrivilegeKeys.AM_MYTIMECHANGEDEVICEID);*/
		}
<span class="nc" id="L222">		UserProfileManager.setUserProfile(context, aProfile);</span>
<span class="nc" id="L223">	}</span>

	/**
	 * Override extract Parameters to handle date input
	 */
	public boolean extractParameters(HttpServletRequest request) {
<span class="nc" id="L229">		boolean success = super.extractParameters(request);</span>
<span class="nc bnc" id="L230" title="All 2 branches missed.">		if (m_datePicker == null) {</span>
<span class="nc" id="L231">			m_datePicker = new DatePickerPC(m_context, &quot;start&quot;);</span>
		}
<span class="nc" id="L233">		TimeZone tz = m_context.getViewingTimeZone();</span>
<span class="nc bnc" id="L234" title="All 2 branches missed.">		if (tz != null) {</span>
<span class="nc" id="L235">			m_datePicker.setTimeZone(tz);</span>
		}
<span class="nc" id="L237">		boolean success2 = m_datePicker.extractParameters(request);</span>
<span class="nc" id="L238">		Date date = m_datePicker.getDate();</span>
		// need to set these variables, which are used in the timerecords modules
<span class="nc bnc" id="L240" title="All 2 branches missed.">		if (date != null) {</span>
<span class="nc" id="L241">			Calendar cal = Calendar.getInstance(tz);</span>
<span class="nc" id="L242">			cal.setTime(date);</span>
<span class="nc" id="L243">			startYear = cal.get(Calendar.YEAR);</span>
<span class="nc" id="L244">			startMonth = cal.get(Calendar.MONTH);</span>
<span class="nc" id="L245">			startDay = cal.get(Calendar.DAY_OF_MONTH);</span>
		}
<span class="nc bnc" id="L247" title="All 4 branches missed.">		return success &amp;&amp; success2;</span>
	}

	/**
	 * Return the resource bundle associated with the page model
	 */
	public ResourceBundle getBundle() {
<span class="nc" id="L254">		return m_bundle;</span>
	}
	public UserProfile getUserProfile() {
<span class="nc" id="L257">		return aProfile;</span>
	}
	public Collection getSortOptions() {
<span class="nc" id="L260">		return m_sortOptions;</span>
	}


	public String getSortOption() {
<span class="nc bnc" id="L265" title="All 2 branches missed.">		return m_sortAscend ? &quot;1&quot; : &quot;0&quot;;</span>
	}

	//[Swati] London: no support for agent control
	/*
	public String getDeviceIDFilePath(){
		return m_deviceIDFilePath;
	}

	public int getEncryptDeviceID(){
		return m_encryptDeviceID;
	}

	public boolean getAutoInstallDeviceID(){
		return m_autoInstallDeviceID;
	}  */

	/**
	* Get empId
	*/
	public ID getEmpId(){
<span class="nc" id="L286">		return this.empId;</span>
	}


	/**
	* Get orgId
	*/
	public ID getOrgId(){
<span class="nc" id="L294">		return this.orgId;</span>
	}

	/**
	* Get orgId
	*/
	public int getPageSN(){
<span class="nc" id="L301">		return this.m_pageSN;</span>
	}

	/**
	* Get orgId
	*/
	public void setPageSN(int sn){
<span class="nc" id="L308">		this.m_pageSN = sn;</span>
<span class="nc" id="L309">	}</span>

	/**
	* Get valid SN
	*/
	public boolean isValidSN(){
<span class="nc" id="L315">		return this.m_validSN;</span>
	}
	/**
	* Set activityType
	*/
	public void setActivityCategory(ID activityCategory){
<span class="nc" id="L321">		this.activityCategory = activityCategory;</span>
<span class="nc" id="L322">	}</span>

	/**
	* Get activityType
	*/
	public ID getActivityCategory(){
<span class="nc" id="L328">		return this.activityCategory;</span>
	}

	/**
	* Set activity
	*/
	public void setActivity(ID activity){
<span class="nc" id="L335">		this.activity = activity;</span>
<span class="nc" id="L336">	}</span>

	/**
	* Get activity
	*/
	public ID getActivity(){
<span class="nc" id="L342">		return this.activity;</span>
	}

	/**
	* Get activityName
	*/
	public String getActivityName(){
		ArrayList act;
<span class="nc" id="L350">		Iterator iter = allActivities.iterator();</span>
<span class="nc" id="L351">		String id = activity.toString();</span>
<span class="nc bnc" id="L352" title="All 2 branches missed.">		while( iter.hasNext() ) {</span>
<span class="nc" id="L353">			act = (ArrayList)iter.next();</span>
<span class="nc" id="L354">			act = (ArrayList)act.get(2);</span>
<span class="nc" id="L355">			Iterator iter2 = act.iterator();</span>
<span class="nc bnc" id="L356" title="All 2 branches missed.">			while( iter2.hasNext()) {</span>
<span class="nc" id="L357">				act = (ArrayList)iter2.next();</span>
<span class="nc bnc" id="L358" title="All 2 branches missed.">				if ( id.equals(act.get(0)) )</span>
<span class="nc" id="L359">					return (String)act.get(1);</span>
			}
<span class="nc" id="L361">		}</span>
<span class="nc" id="L362">		return &quot;&quot;;</span>
	}

	/**
	* Set notes
	*/
	public void setNotes(String notes){
<span class="nc" id="L369">		this.notes = notes;</span>
<span class="nc" id="L370">	}</span>

	/**
	* Get notes
	*/
	public String getNotes(){
<span class="nc" id="L376">		return this.notes;</span>
	}

	/**
	* Set state
	*/
	public void setState(ID state){
<span class="nc" id="L383">		this.state = state;</span>
<span class="nc" id="L384">	}</span>

	/**
	* Get state
	*/
	public ID getState(){
<span class="nc" id="L390">		return this.state;</span>
	}

	/**
	* Set stateStr
	*/
	public void setStateStr(String stateStr){
<span class="nc" id="L397">		this.stateStr = stateStr;</span>
<span class="nc" id="L398">	}</span>

	/**
	* Get stateStr
	*/
	public String getStateStr(){
<span class="nc" id="L404">		return this.stateStr;</span>
	}

	/**
	* Get enableDeviceId
	*/
	public boolean getEnableDeviceId(){
<span class="nc bnc" id="L411" title="All 4 branches missed.">		return this.empId != null &amp;&amp; this.enableDeviceId;</span>
	}

	/**
	* Get enableDeviceId
	*/
	public boolean getEnableDevicePopup(){
<span class="nc" id="L418">		return false;//[Swati] London: no support for agent control</span>
		//return getEnableDeviceId() &amp;&amp; m_bCanEditDevice;
	}

	/**
	 * Get punch id.
	 */
	public String getPunchID() {
<span class="nc bnc" id="L426" title="All 2 branches missed.">		return m_punchID &lt; 1 ? &quot;&quot; : Integer.toString(m_punchID);</span>
	}

	/**
	 * Get punch id.
	 */
	public void setPunchID(String sId) {
		try {
<span class="nc" id="L434">			m_punchID = Integer.parseInt(sId);</span>
<span class="nc" id="L435">		} catch (NumberFormatException ne) {</span>
<span class="nc" id="L436">			m_punchID = -1;</span>
<span class="nc" id="L437">		}</span>
<span class="nc" id="L438">	}</span>

	/**
	* Get MyTimeEvent
	*/
	public ArrayList getMyTimeEvent(){
<span class="nc" id="L444">		return this.myTimeEvent;</span>
	}

	/**
	* Get allActivities
	*/
	public ArrayList getAllActivities(){
<span class="nc" id="L451">		return this.allActivities;</span>
	}



	/**
	* getNeedNotes()
	* return boolean
	*/
	public boolean getNeedNotes(){
<span class="nc" id="L461">		return true;</span>
	}


	/**
	* getDeviceID()
	* return String
	*/
	public String getDeviceID(){
<span class="nc bnc" id="L470" title="All 2 branches missed.">		return this.deviceID != null ? this.deviceID : &quot;&quot;;</span>
	}

	/**
	* Set startYear
	*/
	public void setStartYear(int startYear) {
<span class="nc" id="L477">		this.startYear = startYear;</span>
<span class="nc" id="L478">	}</span>

	/**
	* Get startYear
	*/
	public int getStartYear(){
<span class="nc" id="L484">		return this.startYear;</span>
	}

	/**
	* Set startMonth
	*/
	public void setStartMonth(int startMonth){
<span class="nc" id="L491">		this.startMonth = startMonth;</span>
<span class="nc" id="L492">	}</span>

	/**
	* Get startMonth
	*/
	public int getStartMonth(){
<span class="nc" id="L498">		return this.startMonth;</span>
	}

	/**
	* Set startDay
	*/
	public void setStartDay(int startDay){
<span class="nc" id="L505">		this.startDay = startDay;</span>
<span class="nc" id="L506">	}</span>

	/**
	* Get startDay
	*/
	public int getStartDay(){
<span class="nc" id="L512">		return this.startDay;</span>
	}

	/**
	 * Set punch code
	 */
	public void setPunchCode(int code) {
<span class="nc" id="L519">		this.punchCode = code;</span>
<span class="nc" id="L520">	}</span>

	/**
	 * Get punch code
	 */
	public int getPunchCode() {
<span class="nc" id="L526">		return this.punchCode;</span>
	}

	/**
	 * processActivityGroup()
	 */
	protected void processActivityGroup(RequestContext context)
	throws AmEJBCreateException, RemoteException, Exception{
<span class="nc" id="L534">		allActivities = new ArrayList();</span>
<span class="nc" id="L535">		ArrayList activityCategories = null;</span>
<span class="nc bnc" id="L536" title="All 2 branches missed.">		if ( this.getOrgId() != null ) {</span>
<span class="nc" id="L537">			ActivityGroup activityGroup =</span>
<span class="nc" id="L538">				ActivityModelHandler.getActivityGroup(context, new ID(getOrgId()), ActivityGroup.MYTIME_ACTIVITYCATEGORIES);</span>

<span class="nc" id="L540">			activityCategories =(ArrayList)activityGroup.getActivityCategories();</span>
//System.out.println(&quot;********activityCategories size = &quot;+activityCategories.size());
<span class="nc" id="L542">			Collection activities = null;</span>
<span class="nc" id="L543">			activities = activityGroup.getActivities();</span>
<span class="nc" id="L544">			createActivityColorMap(activities);</span>
//System.out.println(&quot;********activity size = &quot;+activities.size());

			//Tample: add for QA 84187:START
			//Get the list of visible activityCategoryID
<span class="nc" id="L549">			HashMap activityCategoryIDVisibleList=new HashMap();</span>
<span class="nc" id="L550">			HashMap activityIDVisibleList=new HashMap();</span>
<span class="nc bnc" id="L551" title="All 2 branches missed.">			for( int i = 0; i&lt;activityCategories.size(); i++) {</span>
<span class="nc" id="L552">				ActivityCategory activityCategory = (ActivityCategory)activityCategories.get(i);</span>
<span class="nc" id="L553">				activityCategoryIDVisibleList.put(activityCategory.getID(), activityCategory.getID().toString());</span>
			}
			//Get the list of visible activityID
<span class="nc bnc" id="L556" title="All 2 branches missed.">			for( Iterator j = activities.iterator(); j.hasNext(); ) {</span>
<span class="nc" id="L557">				Activity activity = (Activity)j.next();</span>
<span class="nc bnc" id="L558" title="All 2 branches missed.">				if( !activity.getOrganizationId().equals( Organization.ROOT_ORG_ID_OBJ)&amp;&amp;</span>
<span class="nc bnc" id="L559" title="All 2 branches missed.">						(activityCategoryIDVisibleList.get(activity.getActivityCategoryId())!=null )) {</span>
<span class="nc" id="L560">					activityIDVisibleList.put(activity.getID().toString(), activity.getID().toString());</span>
				}
<span class="nc" id="L562">			}</span>
			//Tample: add for QA 84187: END

			//add recent activity category
<span class="nc" id="L566">			ArrayList oneCatWithActivities = new ArrayList();</span>
//System.out.println(&quot;********oneCatWithActivities size = &quot;+oneCatWithActivities.size());
<span class="nc" id="L568">			oneCatWithActivities.clear();</span>

			ArrayList actList;
<span class="nc" id="L571">			oneCatWithActivities.add(m_localizer.i18n(AmWebBundleKey.BUNDLE_NAME, AmWebBundleKey.RECENT));</span>
<span class="nc" id="L572">			oneCatWithActivities.add(&quot;0&quot;);</span>
<span class="nc" id="L573">			UserProfile aProfile = UserProfileManager.getUserProfile(context, empId);</span>

<span class="nc" id="L575">			ArrayList totActList = new ArrayList();</span>
<span class="nc bnc" id="L576" title="All 2 branches missed.">			if (aProfile.getProperty(&quot;ACTIVITY_HISTORY&quot;)!=null){</span>
<span class="nc" id="L577">				MyTimeProfileHelper aHelper = new MyTimeProfileHelper();</span>
<span class="nc" id="L578">				ArrayList aFullList =</span>
<span class="nc" id="L579">					aHelper.getArrListFromString(aProfile.getProperty(&quot;ACTIVITY_HISTORY&quot;));</span>
<span class="nc bnc" id="L580" title="All 2 branches missed.">				if (aFullList.size()&gt;0){</span>
<span class="nc bnc" id="L581" title="All 2 branches missed.">					for (int i=0; i&lt;aFullList.size(); i++){</span>
<span class="nc" id="L582">						ArrayList aList = (ArrayList)aFullList.get(i);</span>
						//Tample change for QA 84187
<span class="nc bnc" id="L584" title="All 4 branches missed.">						if ( aList.size() &gt;= 2 &amp;&amp; activityIDVisibleList.get(aList.get(0).toString())!=null ) {</span>
<span class="nc" id="L585">							actList = new ArrayList();</span>
<span class="nc" id="L586">							actList.add(aList.get(0));</span>
<span class="nc" id="L587">							actList.add(aList.get(1));</span>
<span class="nc" id="L588">							totActList.add(actList);</span>
						}
					}
					//oneCatWithActivities.add(totActList);
				}
			}

<span class="nc bnc" id="L595" title="All 2 branches missed.">			if ( totActList.size() == 0 ) {</span>
<span class="nc" id="L596">				actList = new ArrayList();</span>
<span class="nc" id="L597">				actList.add(&quot;0&quot;);</span>
<span class="nc" id="L598">				actList.add(m_localizer.i18n(AmWebBundleKey.BUNDLE_NAME, AmWebBundleKey.MSG_NORECENTCATEGORIES));</span>
<span class="nc" id="L599">				totActList.add(actList);</span>
			}
<span class="nc" id="L601">			oneCatWithActivities.add(totActList);</span>
<span class="nc" id="L602">			allActivities.add(oneCatWithActivities);</span>

<span class="nc bnc" id="L604" title="All 2 branches missed.">			for( int i = 0; i&lt;activityCategories.size(); i++) {</span>
<span class="nc" id="L605">				oneCatWithActivities = new ArrayList();</span>
<span class="nc" id="L606">				ActivityCategory activityCategory = (ActivityCategory)activityCategories.get(i);</span>
<span class="nc bnc" id="L607" title="All 2 branches missed.">				if ( activityCategory.getOrganizationId().equals(Organization.ROOT_ORG_ID_OBJ) )</span>
<span class="nc" id="L608">					continue;</span>
<span class="nc" id="L609">				oneCatWithActivities.add(activityCategory.getName());</span>
<span class="nc" id="L610">				oneCatWithActivities.add(activityCategory.getID().toString());</span>

			//now get related activities
<span class="nc bnc" id="L613" title="All 4 branches missed.">				if (activities!=null &amp;&amp; activities.size()&gt;0){</span>
<span class="nc" id="L614">					totActList = new ArrayList();</span>
<span class="nc bnc" id="L615" title="All 2 branches missed.">					for( Iterator j = activities.iterator(); j.hasNext(); ) {</span>
<span class="nc" id="L616">						Activity activity = (Activity)j.next();</span>
<span class="nc bnc" id="L617" title="All 2 branches missed.">						if( !activity.getOrganizationId().equals( Organization.ROOT_ORG_ID_OBJ) &amp;&amp;</span>
<span class="nc bnc" id="L618" title="All 2 branches missed.">							activity.getActivityCategoryId().equals(activityCategory.getID()) ) {</span>
//System.out.println(&quot;$$$$$$$$$$$$$$$$$4 found matching activity&quot;);
<span class="nc" id="L620">							ArrayList thisActivity = new ArrayList();</span>
<span class="nc" id="L621">							thisActivity.add(activity.getID().toString());</span>
<span class="nc" id="L622">							thisActivity.add(activity.getName());</span>
<span class="nc" id="L623">							totActList.add(thisActivity);</span>
						}
<span class="nc" id="L625">					}</span>
<span class="nc" id="L626">					oneCatWithActivities.add(totActList);</span>
				}

<span class="nc" id="L629">				allActivities.add(oneCatWithActivities);</span>
			}
		}
<span class="nc" id="L632">	}</span>

	private void createActivityColorMap(Collection activities){
<span class="nc bnc" id="L635" title="All 4 branches missed.">		if (activities != null &amp;&amp; activities.size()&gt;0){</span>
<span class="nc" id="L636">    		m_activityColorMap = new HashMap(activities.size());</span>
<span class="nc bnc" id="L637" title="All 2 branches missed.">            for( Iterator j = activities.iterator(); j.hasNext(); ) {</span>
<span class="nc" id="L638">				Activity activity = (Activity)j.next();</span>
<span class="nc" id="L639">				m_activityColorMap.put(activity.getID(), activity.getColor());</span>
<span class="nc" id="L640">			}</span>
		}
<span class="nc" id="L642">	}</span>

	protected String getActivityColor(ID activityID){
<span class="nc bnc" id="L645" title="All 2 branches missed.">		return m_activityColorMap!=null? (String)m_activityColorMap.get(activityID):StringUtil.NBSP;</span>
	}

	/**
	 * processEvents
	 */
	public void processCurrentActivity() {
		try {
<span class="nc" id="L653">			Activity curActivity = MyTimeModelHandler.getCurrentActivity(empId);</span>

<span class="nc" id="L655">			this.stateStr = m_localizer.i18n(AmWebBundleKey.BUNDLE_NAME, AmWebBundleKey.ADHERENCE_SORT_NONE);</span>
<span class="nc bnc" id="L656" title="All 2 branches missed.">			if (curActivity != null){</span>
<span class="nc" id="L657">				this.state = curActivity.getID();</span>

				//set state string
<span class="nc bnc" id="L660" title="All 2 branches missed.">				if (!curActivity.getID().equals(Activity.ACTIVITY_NONE)){</span>
<span class="nc" id="L661">					this.stateStr = curActivity.getName();</span>
				}
			}
<span class="nc" id="L664">		} catch (Exception ex){</span>
<span class="nc" id="L665">			log.setResourceBundle(m_localizer.getBundle(AmWebLogBundleKey.BUNDLE_NAME));</span>
<span class="nc" id="L666">			log.l7dError(AmWebLogBundleKey.MYTIME_FAILED_GETACTIVITY, ex);</span>
<span class="nc" id="L667">		}</span>
<span class="nc" id="L668">	}</span>


	/**
	* getEndShiftDisabled()
	* return boolean
	*/
	public boolean getEndShiftDisabled(){
<span class="nc bnc" id="L676" title="All 2 branches missed.">		if (state.equals(Activity.ACTIVITY_NONE)){</span>
<span class="nc" id="L677">			this.endShiftDisabled = true;</span>
		}
<span class="nc" id="L679">		return this.endShiftDisabled;</span>
	}

	/**
	* getStartShiftDisabled()
	* return boolean
	*/
	public boolean getStartShiftDisabled(){
<span class="nc" id="L687">		boolean getStartShiftDisabled = false;</span>
		//if (this.activityIDList.size()&lt;2 || this.activityCategoryIDList.size()&lt;1)
<span class="nc" id="L689">			getStartShiftDisabled = true;</span>
<span class="nc" id="L690">		return getStartShiftDisabled;</span>
	}

	/**
	 * Get the length of the timeout
	 */
	public int getTimeOutLength() {
<span class="nc" id="L697">		return m_iTimeoutLength;</span>
	}

	public int getErrorCode() {
<span class="nc" id="L701">		return m_errorCode;</span>
	}

	public void setErrorCode(int code) {
<span class="nc" id="L705">		m_errorCode = code;</span>
<span class="nc" id="L706">	}</span>

	/**
	 * Return the JavaScript init code required by Page model.
	 *
	 * Default behavior is to retrieve sub-component JavaScript Init code
	 */
	public String getJavaScriptInitCode() {

<span class="nc" id="L715">		StringBuffer jsInitCode = new StringBuffer(512);</span>

		// Add sub-component JavaScript code first
<span class="nc" id="L718">		jsInitCode.append(super.getJavaScriptInitCode()).append(&quot;\n&quot;);</span>
		//now instantiate the popup button objects

<span class="nc" id="L721">		String template =</span>
				&quot;// instantiate the Table control\n&quot; +

				&quot;window.oTable = new Table( \&quot;oTable\&quot;, \&quot;5\&quot;, \&quot;6\&quot;, \&quot;tblRowSelect\&quot; );\n&quot; + //GQ  scheduleRowSelected   tblRowSelect  tableRowSelected
				&quot;window.oTable.bind();&quot; +
				&quot;window.oTable.setMultiRowSelectable( false );\n&quot; +
				&quot;window.oTable.setMultiColSelectable( false );\n&quot; +

				&quot;// instantiate the listboxes\n&quot; +
				&quot;window.listbox0 = new ListboxPrimary(\&quot;listbox0\&quot;);\n&quot; +
				&quot;window.listbox0.bind();\n&quot; +
				&quot;window.listbox1 = new ListboxSecondary( \&quot;listbox1\&quot;, secondaryOptions);\n&quot; +
				&quot;window.listbox1.bind();\n&quot; +

				&quot;// now instantiate the popup button objects\n&quot; +
				&quot;window.popupbutton0 = new PopupButton(\&quot;popupbutton0\&quot;);\n&quot; +
				&quot;window.popupbutton0.bind();\n&quot; +

				&quot;// now instantiate the toolbar objects\n&quot; +
				&quot;window.toolbar1 = new Toolbar(\&quot;toolbar1\&quot;);\n&quot; +
				&quot;window.toolbar1.bind();\n&quot; +

				&quot;// now create the new mediator\n&quot; +
				//&quot;top.activityMediator = new ActivityMediator( \&quot;activityMediator\&quot; );\n&quot; +


				&quot;// add the child components of the right mediator\n&quot; +
				&quot;top.activityMediator.addChild( oTable );\n&quot; +

				&quot;// we add the list boxes as children of the mediator\n&quot; +
				&quot;top.activityMediator.addChild( listbox0 );\n&quot; +
				&quot;top.activityMediator.addChild( listbox1 );\n&quot; +

				&quot;//now we can add the toolbars to the mediator's collection\n&quot; +
				&quot;top.activityMediator.addChild( toolbar1 );\n&quot; +

				&quot;//now we can add the popupbottons to the mediator's collection\n&quot; +
				&quot;top.activityMediator.addChild( popupbutton0 );\n&quot; +
				&quot;popupbutton0.setParent(top.activityMediator);\n&quot; +

				&quot;listbox0.addChild( listbox1 );\n&quot; +

				&quot;//now set the parent child relationship\n&quot; +
				&quot;top.activityMediator.addChild( top.findObj('applicationMediator').getObjectByName(\'hiddenIframeMediator\') );\n&quot;;

<span class="nc" id="L766">		jsInitCode.append(template);</span>

<span class="nc" id="L768">		jsInitCode.append(</span>
		 &quot;// Start date click will hide keypress iFrame when clicked\n&quot; +
		 &quot;if (is.nav) {\n&quot; +
			 &quot;var eDateButton = DOM2.getElementById('start_datePickerDialogBoxWrapper');\n&quot; +
			 &quot;if (eDateButton) eDateButton.addEventListener('click', setFrameToHide, true);\n&quot; +
		 &quot;}\n&quot;);

<span class="nc" id="L775">		return jsInitCode.toString();</span>
	}

	//[Swati] London: no support for agent control
	/*
	protected String getMainFuncJSCode() {
		if ( m_type != GET_STATUS_MODEL &amp;&amp; getEnableDevicePopup()
			&amp;&amp; (deviceID == null || deviceID.equals(&quot;&quot;))
			&amp;&amp; m_useDeviceIDFromCookie) {
			return super.getMainFuncJSCode() +
				&quot;var device = DOM2.getElementById('popupbutton0_DEVICE_ACTIONWrapper');\n&quot; +
								&quot;window.popupbutton0.onSelect('POPUP_DEVICEID', device);\n&quot;;
		} else  if (enableDeviceId &amp;&amp; !m_useDeviceIDFromCookie){
			return super.getMainFuncJSCode() + &quot;getDeviceIdFromControl();\n&quot;;
		 } else {
			return super.getMainFuncJSCode();
		}
	} */

	/**
	* Return the string representing the content of the MyTimeModel model
	*/
	public String toString() {
<span class="nc" id="L798">	return &quot;\n[MyTimeModel]:&quot;+</span>
			 &quot;\npageAction=&quot; + pageAction +
			 &quot;\nactivityType=&quot; + activityCategory +
			 &quot;\nactivity=&quot; + activity +
			 &quot;\nallActivities=&quot; + allActivities +
			 &quot;\nnotes=&quot; + notes +
			 &quot;\nstate=&quot; + state +
			 &quot;\nstateStr=&quot; + stateStr +
			 &quot;\nenableDeviceId=&quot; + enableDeviceId +
			 &quot;\nshowLog=&quot; + showLog +
			 &quot;\nempId=&quot; + empId +
			 &quot;\nendShiftDisabled=&quot; + endShiftDisabled +
			 &quot;\ndeviceID=&quot; + deviceID +
			 &quot;\nstartYear=&quot; + startYear +
			 &quot;\nstartMonth=&quot; + startMonth +
			 &quot;\nstartDay=&quot; + startDay +
			 &quot;\nlastName=&quot; + lastName +
			 &quot;\nfirstName=&quot; + firstName +
			 &quot;\norgId=&quot; + orgId;
	}

	public Calendar getStartDateCalendar() {
<span class="nc" id="L820">		Calendar calendar = getCalendar();</span>
<span class="nc" id="L821">		calendar.set(startYear, startMonth, startDay, 0, 0, 0);</span>
<span class="nc" id="L822">		return calendar;</span>
	}

	public DateFormat getDateFormat() {
<span class="nc" id="L826">		DateFormat df = DateFormat.getDateTimeInstance();</span>
<span class="nc" id="L827">		df.setCalendar(getCalendar());</span>
<span class="nc" id="L828">		return df;</span>
	}

	public Calendar getCalendar() {
		// must add time zone
<span class="nc" id="L833">		return Calendar.getInstance(m_context.getViewingTimeZone());</span>
	}

	/**
	 * Returns the DatePicker HTML.
	 */
	public String getStartDateUI() {
<span class="nc" id="L840">		m_datePicker.setTimeZone(m_context.getViewingTimeZone());</span>
<span class="nc" id="L841">		m_datePicker.setOnChangeJS(&quot;document.oFormMain.submit();var refreshPage = true;&quot;);</span>
<span class="nc" id="L842">		m_datePicker.setIsDayNavEnabled(true);</span>
<span class="nc" id="L843">		return m_datePicker.getHtmlDisplay();</span>
	}

	//[Swati] London: no support for agent control
	/*
	public static String checkDeviceID(RequestContext context, String name){
		String value = &quot;&quot;;
		Cookie[] cookies = context.getRequest().getCookies();
		if (cookies != null) {
			for (int i=0; i&lt;cookies.length; i++) {
				if (cookies[i].getName().equals(name)){
					value = cookies[i].getValue();
					break;
				}
			}
		}
		return value;
	}*/

	/**
	 * setValuesFromProfile
	 * This method allows for setting of the page model variables
	 * that derive from the user profile
	 */
	private void setValuesFromProfile(UserProfile aProfile) throws Exception{
		//set boolean value of enableDeviceId
<span class="nc bnc" id="L869" title="All 2 branches missed.">		if (aProfile.getProperty(MYTIME_SN)==null ||</span>
<span class="nc bnc" id="L870" title="All 2 branches missed.">			aProfile.getProperty(&quot;ACTIVITY_HISTORY&quot;)==null){</span>
<span class="nc" id="L871">			aProfile.initProperty(new String[]{&quot;ACTIVITY_HISTORY&quot;,MYTIME_SN});</span>
		}
		//setUseDevice();
<span class="nc" id="L874">		setOrgId(aProfile);</span>
<span class="nc" id="L875">		setPageSN(aProfile);</span>
<span class="nc" id="L876">	}</span>

	/**
	 * setUseDevice()
	 */
	//[Swati] London: no support for agent control
	/*
	private void setUseDevice() throws Exception{
		Object myTimeDevice = m_context.getAttribute(RequestContext.APPLICATION_SCOPE, MYTIME_DEVICE);
		if (myTimeDevice==null){
			// Get setting from configuration
			String strValue = getDBConfigManager().getValue(ConfigKey.MYTIME_DEVICE_USED);
			if (strValue != null)
				enableDeviceId =  strValue.equals(&quot;true&quot;);

			m_context.setAttribute(RequestContext.APPLICATION_SCOPE,
				MYTIME_DEVICE, new Boolean(enableDeviceId));
		} else {
				enableDeviceId = ((Boolean)myTimeDevice).booleanValue();
		}
		if (enableDeviceId){
			setUseDeviceIDFromCookie();
		}
	}*/

	/**
	 * setUseDeviceIDFromCookie()
	 */
	//[Swati] London: no support for agent control
	/*
	private void setUseDeviceIDFromCookie()
	throws Exception{
		Object valueFromContext =
			m_context.getAttribute(RequestContext.APPLICATION_SCOPE,
				MYTIME_DEVICEID_FROMCOOKIE);
		if (valueFromContext==null){
			// Get setting from configuration
			String strValue = getDBConfigManager().getValue(ConfigKey.MYTIME_USE_NONUSERSPECIFIC_DEVICEID);
			if (strValue != null)
				m_useDeviceIDFromCookie =  strValue.equals(&quot;false&quot;);
			m_context.setAttribute(RequestContext.APPLICATION_SCOPE,
				MYTIME_DEVICEID_FROMCOOKIE, new Boolean(m_useDeviceIDFromCookie));
		} else {
			m_useDeviceIDFromCookie = ((Boolean)valueFromContext).booleanValue();
		}
		if (!m_useDeviceIDFromCookie){
			//get file path
			valueFromContext = m_context.getAttribute(RequestContext.APPLICATION_SCOPE,
					MYTIME_DEVICEID_FILEPATH);
			if (valueFromContext==null){

				m_deviceIDFilePath = getDBConfigManager().getValue(ConfigKey.MYTIME_NONUSERSPECIFIC_DEVICEID_FILEPATH);
				m_context.setAttribute(RequestContext.APPLICATION_SCOPE,
					MYTIME_DEVICEID_FILEPATH, m_deviceIDFilePath);
			} else {
			   m_deviceIDFilePath = (String)valueFromContext;
			}
			//encrypt device id
			valueFromContext = m_context.getAttribute(RequestContext.APPLICATION_SCOPE,
					MYTIME_ENCRYPT_DEVICEID);
			if (valueFromContext==null){

				String strValue = getDBConfigManager().getValue(ConfigKey.MYTIME_ENCRYPT_NONUSERSPECIFIC_DEVICEID);
				if (strValue != null)
					m_encryptDeviceID =  strValue.equals(&quot;true&quot;)?1:0;
				m_context.setAttribute(RequestContext.APPLICATION_SCOPE,
					MYTIME_ENCRYPT_DEVICEID, strValue != null?new Boolean(strValue):new Boolean(&quot;false&quot;));
			} else {
				m_encryptDeviceID = ((Boolean)valueFromContext).booleanValue()==true?1:0;
			}
			//use auto install
			valueFromContext = m_context.getAttribute(RequestContext.APPLICATION_SCOPE,
					MYTIME_DEVICEID_AUTOINSTALL);
			if (valueFromContext==null){

				String strValue = getDBConfigManager().getValue(ConfigKey.MYTIME_NONUSERSPECIFIC_DEVICEID_AUTOINSTALL);
				if (strValue != null)
					m_autoInstallDeviceID =  strValue.equals(&quot;true&quot;);
					m_context.setAttribute(RequestContext.APPLICATION_SCOPE,
						MYTIME_DEVICEID_AUTOINSTALL, new Boolean(m_autoInstallDeviceID));
			} else {
				m_autoInstallDeviceID = ((Boolean)valueFromContext).booleanValue();
			}
		}
	}

	private DBConfigManager getDBConfigManager(){
		if (m_configMgr == null){
			try {
				m_configMgr = BbmManagerFactory.getDBConfigManager();
			} catch (Exception ex){
				log.l7dError(&quot;Failed to get DBConfigManager&quot;, ex);
			}
		}
		return m_configMgr;
	}

	public boolean getUseCookie(){
		return m_useDeviceIDFromCookie;
	}*/

	/**
	 * setPageSN()
	 */
	protected void setPageSN(UserProfile aProfile){
<span class="nc" id="L981">	}</span>

	/**
	 * getPageSN()
	 */
	protected int getLatestPageSN(UserProfile aProfile){
<span class="nc bnc" id="L987" title="All 2 branches missed.">		if (aProfile.getProperty(MYTIME_SN) != null){</span>
<span class="nc" id="L988">			String sn = aProfile.getProperty(MYTIME_SN);</span>
<span class="nc bnc" id="L989" title="All 2 branches missed.">			if ( sn != null ) {</span>
				try {
<span class="nc" id="L991">					return Integer.parseInt(sn);</span>
<span class="nc" id="L992">				} catch ( NumberFormatException ne) {</span>
				}
			}
		}
<span class="nc" id="L996">		return 0;</span>
	}

	/**
	 * setOrgId()
	 */
	private void setOrgId(UserProfile aProfile) throws Exception{
<span class="nc bnc" id="L1003" title="All 2 branches missed.">		if ( empId != null ){</span>
<span class="nc bnc" id="L1004" title="All 2 branches missed.">			if (aProfile.getProperty(&quot;ORG_ID&quot;)==null){</span>
<span class="nc" id="L1005">				orgId = MyTimeModelHandler.getEmployeeOrgId(m_context, empId);</span>
<span class="nc" id="L1006">				aProfile.setProperty(&quot;ORG_ID&quot;, String.valueOf(orgId), false);</span>
			}
			else {
<span class="nc" id="L1009">				orgId = new ID(Integer.valueOf(aProfile.getProperty(&quot;ORG_ID&quot;)).intValue());</span>
			}
		}
<span class="nc" id="L1012">	}</span>

	public Collection getActivityCategoryList() {
<span class="nc" id="L1015">		ArrayList list = new ArrayList(allActivities.size());</span>
<span class="nc bnc" id="L1016" title="All 2 branches missed.">		for (int aList=0; aList&lt;allActivities.size(); aList++){</span>
<span class="nc" id="L1017">			ArrayList thisActCat = (ArrayList) allActivities.get(aList);</span>
<span class="nc" id="L1018">			list.add(new StringsPair((String)thisActCat.get(1),(String)thisActCat.get(0)));</span>
		}
<span class="nc" id="L1020">		return list;</span>
	}

	public Collection getRecentActivities() {
<span class="nc" id="L1024">		ArrayList list = new ArrayList();</span>
<span class="nc bnc" id="L1025" title="All 6 branches missed.">		if ( empId != null &amp;&amp; allActivities != null &amp;&amp; allActivities.size() &gt; 0 ) {</span>
<span class="nc" id="L1026">			ArrayList activityTot = (ArrayList) allActivities.get(0);</span>
<span class="nc" id="L1027">			ArrayList activityObj = (ArrayList) activityTot.get(2);</span>
<span class="nc bnc" id="L1028" title="All 2 branches missed.">			for (int aList=0; aList&lt;activityObj.size(); aList++){</span>
<span class="nc" id="L1029">				ArrayList thisActivity = (ArrayList) activityObj.get(aList);</span>
<span class="nc" id="L1030">				list.add(new StringsPair((String)thisActivity.get(0),(String)thisActivity.get(1)));</span>
			}
		}
<span class="nc" id="L1033">		return list;</span>
	}

		/**
	 * Return Html for time record display: to be overwritten
	 */
	public String getTimeRecordDisplay() {
<span class="nc" id="L1040">		return &quot;&quot;;</span>
	}

	public String getRefreshRateComponentHtml(){
<span class="nc" id="L1044">		return &quot;&quot;;</span>
	}
	
	/**
	 * Return total activity time: to be overwritten
	 */
	public String getActivityTotalTime() {
<span class="nc" id="L1051">		return &quot;&quot;;</span>
	}

	public void setActivityDisplayName(String displayName){
<span class="nc" id="L1055">		m_activityDisplayName = displayName;</span>
<span class="nc" id="L1056">	}</span>

	public String getActivityDisplayName(){
<span class="nc" id="L1059">		return m_activityDisplayName;</span>
	}
	
	public boolean isMyTimeRecordModel(){
<span class="nc" id="L1063">    	return false;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>