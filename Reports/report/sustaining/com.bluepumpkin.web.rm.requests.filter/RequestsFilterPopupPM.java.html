<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>RequestsFilterPopupPM.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.rm.requests.filter</a> &gt; <span class="el_source">RequestsFilterPopupPM.java</span></div><h1>RequestsFilterPopupPM.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.rm.requests.filter;

import java.io.Serializable;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collection;
import java.util.Collections;
import java.util.HashMap;
import java.util.List;
import java.util.ResourceBundle;

import javax.servlet.http.HttpServletRequest;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.IDStringPair;
import com.bluepumpkin.common.datatypes.StringsPair;
import com.bluepumpkin.common.util.StringUtil;
import com.bluepumpkin.ejb.bbm.activity.model.Activity;
import com.bluepumpkin.ejb.core.CoreManagerFactory;
import com.bluepumpkin.ejb.rm.requests.common.ejb.RequestUtil;
import com.bluepumpkin.ejb.rm.requests.common.model.Request;
import com.bluepumpkin.ejb.rm.requests.commonrequestmanager.model.RequestFilter;
import com.bluepumpkin.ejb.rm.util.LicenseUtil;
import com.bluepumpkin.web.bbm.l10n.BbmWebBundleKey;
import com.bluepumpkin.web.bbm.organization.tree.OrganizationTreePC;
import com.bluepumpkin.web.rm.keys.RmPageAction;
import com.bluepumpkin.web.rm.l10n.RmWebBundleKey;
import com.witness.ejb.core.licensing.LicenseKeys;
import com.witness.ejb.core.licensing.ejb.LicenseManager;
import com.witness.ejb.core.security.model.User;
import com.witness.web.uif.jsp.HtmlDiv;
import com.witness.web.uif.keys.PageKeys;
import com.witness.web.uif.l10n.UIFWebBundleKey;
import com.witness.web.uif.pagecomponent.BaseNodeData;
import com.witness.web.uif.pagecomponent.container.ListContainerPC;
import com.witness.web.uif.pagecomponent.list.OptionData;
import com.witness.web.uif.pagecomponent.picker.date.DatePickerPC;
import com.witness.web.uif.pagecomponent.picker.date.DateRangePickerPC;
import com.witness.web.uif.pagemodel.ConfigPopupPM;
import com.witness.web.uif.pagemodel.PageModel;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.util.HtmlUtil;
import com.witness.web.uif.util.html.CSSUtil;
import com.witness.web.uif.util.html.HtmlChoiceInput;
import com.witness.web.uif.util.js.JSUtil;

/**
 * Title: RequestsFilterPopupPM Description: Request Filter Popup Copyright: Copyright (c) 2001 Company: Blue Pumpkin Software, inc
 * 
 * @author David Su
 * @version 1.0
 */
public class RequestsFilterPopupPM extends ConfigPopupPM {
	private static final String RT_CHANGE_JS = &quot;pageMediator.refreshPageWithAction('&quot; + RmPageAction.REQUEST_TYPE_CHANGE_ACTION
			+ &quot;', true);&quot;;
	private static final String FILTER_NAME_FN = &quot;filterName&quot;;

	protected ListContainerPC m_reqTypePC;
	protected OrganizationTreePC m_orgTreePC;
	protected RequestsFilterPropPC m_propPC;
	protected DatePickerPC m_datePC;
	protected DateRangePickerPC m_dateRangePC;

	protected ResourceBundle m_bundle;
	protected RequestFilter m_rFilter;
<span class="nc" id="L66">	protected boolean m_isNewFilter = false;</span>
<span class="nc" id="L67">	protected boolean m_isOrgIDSelected = true;</span>

<span class="nc" id="L69">	protected Collection m_orgList = Collections.emptyList();</span>
<span class="nc" id="L70">	protected IDStringPair[] m_filterNames = null;</span>
<span class="nc" id="L71">	private boolean isCloseAfterLoadCustomize = false;</span>
	/** Creates a new instance of ListConfigPM */
	public RequestsFilterPopupPM(RequestContext context) {
<span class="nc" id="L74">		super(context);</span>

<span class="nc" id="L76">		m_bundle = m_localizer.getBundle(RmWebBundleKey.BUNDLE_NAME);</span>
		// change the default all value
<span class="nc" id="L78">		m_sAllDisplay = i18n(m_bundle, RmWebBundleKey.REQUEST_FILTER_ALL_ACTIVE);</span>
<span class="nc" id="L79">		m_reqTypePC = new ListContainerPC(m_context);</span>
<span class="nc" id="L80">		m_datePC = new DatePickerPC(m_context, &quot;&quot;);</span>
<span class="nc" id="L81">		m_dateRangePC = new DateRangePickerPC(m_context, &quot;&quot;);</span>
		
<span class="nc bnc" id="L83" title="All 2 branches missed.">		if (!isAccessibilityComplianceMode()) {</span>
<span class="nc" id="L84">			m_orgTreePC = new OrganizationTreePC(m_context);</span>
<span class="nc" id="L85">			m_propPC = new RequestsFilterPropPC(m_context, m_datePC, m_dateRangePC);</span>
		} else {
<span class="nc" id="L87">			m_orgTreePC = new OrganizationTreePC(m_context) {</span>
				@Override
				protected HtmlDiv getNewHtmlDiv() {
<span class="nc" id="L90">					HtmlDiv wrapper = super.getNewHtmlDiv();</span>
<span class="nc" id="L91">					wrapper.setAttribute(ATTR_ARIA_LABEL,</span>
<span class="nc" id="L92">							getLocalizer().i18n(RmWebBundleKey.BUNDLE_NAME, RmWebBundleKey.ORGANIZATIONS_TREE));</span>
<span class="nc" id="L93">					return wrapper;</span>
				}
			};
<span class="nc" id="L96">			m_orgTreePC.setComplianceModeTitle(</span>
<span class="nc" id="L97">					getLocalizer().i18n(BbmWebBundleKey.BUNDLE_NAME, BbmWebBundleKey.ORGANIZATION_NAME));</span>
<span class="nc" id="L98">			m_propPC = new RequestsFilterPropPC(m_context, m_datePC, m_dateRangePC) {</span>
				@Override
				protected HtmlDiv getNewHtmlDiv() {
<span class="nc" id="L101">					HtmlDiv wrapper = super.getNewHtmlDiv();</span>
<span class="nc" id="L102">					wrapper.setAttribute(&quot;aria-label&quot;, i18n(m_bundle, RmWebBundleKey.REQUEST_FILTER_PROPERTIES));</span>
<span class="nc" id="L103">					return wrapper;</span>
				}
			};
<span class="nc" id="L106">			m_configListBoxPC.getSelect()</span>
<span class="nc" id="L107">					.setTitle(getLocalizer().i18n(UIFWebBundleKey.BUNDLE_NAME, UIFWebBundleKey.FILTERS_LABEL));</span>
		}
<span class="nc" id="L109">		addChildComponent(m_orgTreePC);</span>
<span class="nc" id="L110">		addChildComponent(m_reqTypePC);</span>
<span class="nc" id="L111">		addChildComponent(m_datePC);</span>
<span class="nc" id="L112">		addChildComponent(m_dateRangePC);</span>
<span class="nc bnc" id="L113" title="All 2 branches missed.">		if (!isAccessibilityComplianceMode()) {</span>
<span class="nc" id="L114">			m_orgTreePC = new OrganizationTreePC(m_context);</span>
<span class="nc" id="L115">			m_propPC = new RequestsFilterPropPC(m_context, m_datePC, m_dateRangePC);</span>
		} else {
<span class="nc" id="L117">			m_orgTreePC = new OrganizationTreePC(m_context) {</span>
				@Override
				protected HtmlDiv getNewHtmlDiv() {
<span class="nc" id="L120">					HtmlDiv wrapper = super.getNewHtmlDiv();</span>
<span class="nc" id="L121">					return wrapper;</span>
				}

				@Override
				protected boolean skipEncloseForKeyboardAccess(BaseNodeData nodeData) {
<span class="nc" id="L126">					return false;</span>
				}
			};
<span class="nc" id="L129">			m_orgTreePC.setComplianceModeTitle(i18n(m_bundle, RmWebBundleKey.ORGANIZATIONS_TREE));</span>
<span class="nc" id="L130">			m_propPC = new RequestsFilterPropPC(m_context, m_datePC, m_dateRangePC) {</span>
				@Override
				protected HtmlDiv getNewHtmlDiv() {
<span class="nc" id="L133">					HtmlDiv wrapper = super.getNewHtmlDiv();</span>
<span class="nc" id="L134">					wrapper.setAttribute(&quot;aria-label&quot;, i18n(m_bundle, RmWebBundleKey.REQUEST_FILTER_PROPERTIES)</span>
<span class="nc" id="L135">							+ i18n(m_bundle, RmWebBundleKey.REQUEST_FILTER_PROPERTIES_DESC));</span>
<span class="nc" id="L136">					return wrapper;</span>
				}
			};
<span class="nc" id="L139">			m_configListBoxPC.setOnChange(m_configListBoxPC.getOnChange() +  &quot;\nvar refreshPage = true;&quot;);</span>
<span class="nc" id="L140">			m_configListBoxPC.getSelect()</span>
<span class="nc" id="L141">					.setTitle(getLocalizer().i18n(UIFWebBundleKey.BUNDLE_NAME, UIFWebBundleKey.FILTERS_LABEL));</span>
		}
<span class="nc" id="L143">		addChildComponent(m_orgTreePC);</span>
<span class="nc" id="L144">		addChildComponent(m_reqTypePC);</span>
<span class="nc" id="L145">		addChildComponent(m_datePC);</span>
<span class="nc" id="L146">		addChildComponent(m_dateRangePC);</span>
<span class="nc" id="L147">		addChildComponent(m_propPC);</span>
<span class="nc" id="L148">		resetRequestFilter();</span>
<span class="nc" id="L149">	}</span>

	/**
	 * Return an instance of Page Model
	 */
	public static PageModel getInstance(RequestContext context) {
<span class="nc" id="L155">		RequestsFilterPopupPM model = null;</span>

<span class="nc" id="L157">		PageModel cachedModel = context.getPageModel();</span>
<span class="nc bnc" id="L158" title="All 2 branches missed.">		if (cachedModel instanceof RequestsFilterPopupPM) {</span>
<span class="nc" id="L159">			model = (RequestsFilterPopupPM) cachedModel;</span>
		} else {
			// Need to create new Model
<span class="nc" id="L162">			model = new RequestsFilterPopupPM(context);</span>
<span class="nc" id="L163">			model.extractParameters(context.getRequest());</span>
<span class="nc" id="L164">			context.setPageModel(model);</span>
		}

<span class="nc" id="L167">		return model;</span>
	}

	/**
	 * Initialize Component For Display
	 */
	@Override
	public void initForDisplay() {
<span class="nc bnc" id="L175" title="All 2 branches missed.">		if (m_isInitializedForDisplay) {</span>
<span class="nc" id="L176">			return;</span>
		} else {
<span class="nc" id="L178">			super.initForDisplay();</span>

<span class="nc" id="L180">			initOrgTreeContainer();</span>
<span class="nc" id="L181">			initReqTypeContainer();</span>

<span class="nc" id="L183">			addGenericHTML(HtmlUtil.makeHiddenInput(FILTER_NAME_FN, m_rFilter.getName()));</span>
		}
<span class="nc" id="L185">	}</span>

	/**
	 * Initialize Model with Data
	 */
	protected void setSupportData(IDStringPair[] filterNames, Collection orgList, Collection supervisorList, List reqStatusList,
			Collection skillList, Collection poolList, Collection bidList, Collection campaignList, HashMap&lt;ID, String&gt; shiftMap,
			Collection activityList, HashMap&lt;ID, String&gt; extensionMap,Collection&lt;Activity&gt; toActivityList,List&lt;StringsPair&gt; shiftBidAuctionList ) {
<span class="nc" id="L193">		m_orgList = orgList;</span>
<span class="nc" id="L194">		m_filterNames = filterNames;</span>

<span class="nc" id="L196">		m_propPC.init(supervisorList, reqStatusList, skillList, poolList, bidList, campaignList, shiftMap, activityList,</span>
				extensionMap,toActivityList,shiftBidAuctionList);
<span class="nc" id="L198">	}</span>

	/**
	 * Initialize Filter Names
	 */
	protected void initFilterNames() {
<span class="nc" id="L204">		ArrayList configNames = RequestsFilterUtil.createFilterOptions(m_filterNames, getSelectedConfig());</span>

<span class="nc" id="L206">		OptionData data = new OptionData(i18n(m_localizer.getBundle(RmWebBundleKey.BUNDLE_NAME),</span>
				RmWebBundleKey.REQUEST_TYPE_NO_FILTER), RequestUtil.ALL_FILTER);
<span class="nc bnc" id="L208" title="All 2 branches missed.">		if (getSelectedConfig().equals(RequestUtil.ALL_FILTER)) {</span>
<span class="nc" id="L209">			data.setSelected(true);</span>
		}
<span class="nc" id="L211">		configNames.add(0, data);</span>

<span class="nc" id="L213">		super.initConfigNames(configNames);</span>
<span class="nc" id="L214">	}</span>

	/**
	 * Initialize Org Tree Container
	 */
	protected void initOrgTreeContainer() {
<span class="nc" id="L220">		m_orgTreePC.setOnSelectAction(OrganizationTreePC.HANDLE_ON_SELECT_SELECT_CHILD);</span>
<span class="nc" id="L221">		m_orgTreePC.init(m_orgList);</span>

		// Initialize Check Organizations
<span class="nc" id="L224">		Collection orgIDs = (Collection) m_rFilter.getValueForKey(RequestFilter.ORGANIZATION_KEY);</span>
<span class="nc bnc" id="L225" title="All 4 branches missed.">		if (orgIDs == null || orgIDs.isEmpty()) {</span>
<span class="nc" id="L226">			m_orgTreePC.setCheckedIDAsCollection(Collections.emptyList());</span>
		} else {
<span class="nc" id="L228">			m_orgTreePC.setCheckedIDAsCollection(orgIDs);</span>
		}
<span class="nc" id="L230">	}</span>

	/**
	 * Initialize Request Type Container
	 */
	protected void initReqTypeContainer() {
<span class="nc" id="L236">		String title = i18n(m_bundle, RmWebBundleKey.REQUEST_TYPE_LABEL);</span>
<span class="nc" id="L237">		m_reqTypePC.setTitle(title);</span>
<span class="nc bnc" id="L238" title="All 2 branches missed.">		if (isAccessibilityComplianceMode()) {</span>
<span class="nc" id="L239">			m_reqTypePC.setPCTitleSpan(</span>
<span class="nc" id="L240">					title + &quot; &quot; + HtmlUtil.makeHiddenReadableText(i18n(m_common_bundle, UIFWebBundleKey.RADIO_GROUP)</span>
<span class="nc" id="L241">							+ &quot; &quot; + i18n(m_bundle, RmWebBundleKey.REQUEST_FILTER_RADIOGROUP_DESC)</span>
<span class="nc" id="L242">							+ &quot; &quot; + i18n(m_common_bundle, UIFWebBundleKey.RADIOGROUP_SELECTION_CAUTION_MESSAGE)));</span>
		}
<span class="nc" id="L244">		m_reqTypePC.setWrapperCSSClass(CSSUtil.CLASS_BORDER_DEFAULT);</span>

<span class="nc" id="L246">		m_reqTypePC.addRowData(createReqTypeInput(Request.REQUESTTYPE_ALL, RmWebBundleKey.REQUEST_TYPE_ALL, false));</span>
<span class="nc" id="L247">		boolean hasTOMLicense = false;</span>
<span class="nc" id="L248">		boolean hasSSLicense = false;</span>
<span class="nc" id="L249">		boolean hasSBLicense = false;</span>
<span class="nc" id="L250">		boolean hasCSLicense = false;</span>
		

		try {
			// get licenses to disable options
<span class="nc" id="L255">			LicenseManager licManager = CoreManagerFactory.getLicenseManager();</span>
<span class="nc" id="L256">			hasTOMLicense = licManager.isLicensed(LicenseKeys.APP_RM_TOM);</span>
<span class="nc" id="L257">			hasSSLicense = licManager.isLicensed(LicenseKeys.APP_RM_SS);</span>
<span class="nc" id="L258">			hasSBLicense = licManager.isLicensed(LicenseKeys.APP_RM_SB);</span>
<span class="nc" id="L259">			hasCSLicense = licManager.isLicensed(LicenseKeys.APP_RM_TOM);</span>
			
<span class="nc" id="L261">		} catch (Exception ex) {</span>
<span class="nc" id="L262">			log.l7dError(BbmWebBundleKey.UNABLE_TO_LOAD_DATA, ex);</span>
<span class="nc" id="L263">		}</span>

<span class="nc bnc" id="L265" title="All 2 branches missed.">		m_reqTypePC</span>
<span class="nc" id="L266">				.addRowData(createReqTypeInput(Request.REQUESTTYPE_TIMEOFF, RmWebBundleKey.REQUEST_TYPE_TIME_OFF, !hasTOMLicense));</span>

<span class="nc" id="L268">		m_reqTypePC.addRowData(createReqTypeInput(Request.REQUESTTYPE_FLEXTIME, RmWebBundleKey.REQUEST_TYPE_FLEX_TIME, false));</span>

<span class="nc bnc" id="L270" title="All 2 branches missed.">		m_reqTypePC.addRowData(createReqTypeInput(Request.REQUESTTYPE_SHIFTSWAP, RmWebBundleKey.REQUEST_TYPE_SHIFT_SWAP,</span>
				!hasSSLicense));

<span class="nc bnc" id="L273" title="All 2 branches missed.">		m_reqTypePC.addRowData(createReqTypeInput(Request.REQUESTTYPE_SHIFTBID, RmWebBundleKey.REQUEST_TYPE_SHIFT_BIDDING,</span>
				!hasSBLicense));

<span class="nc bnc" id="L276" title="All 2 branches missed.">		m_reqTypePC.addRowData(createReqTypeInput(Request.REQUESTTYPE_CUSTSHIFT, RmWebBundleKey.REQUEST_TYPE_CUSTOM_SHIFT,</span>
				!hasCSLicense));
<span class="nc" id="L278">	}</span>

	/**
	 * Create RequestType Radio Option
	 */
	protected String createReqTypeInput(String value, String rbKey, boolean isDisabled) {
<span class="nc" id="L284">		StringBuffer sb = new StringBuffer(100);</span>

<span class="nc" id="L286">		String rType = (String) m_rFilter.getValueForKey(RequestFilter.REQUEST_TYPE_KEY);</span>
<span class="nc" id="L287">		boolean isChecked = value.equals(rType);</span>

<span class="nc" id="L289">		String label = i18n(m_bundle, rbKey);</span>
<span class="nc" id="L290">		HtmlChoiceInput choiceInput = HtmlChoiceInput.createRadioInput(&quot;requestType&quot;, value, label, isChecked, isDisabled,</span>
				RT_CHANGE_JS);
<span class="nc bnc" id="L292" title="All 2 branches missed.">		if (isAccessibilityComplianceMode()) {</span>
<span class="nc" id="L293">			choiceInput.setRole(&quot;option&quot;);</span>
		}
<span class="nc" id="L295">		choiceInput.setIsLabelLast(true);</span>
<span class="nc" id="L296">		sb.append(choiceInput.getHtmlDisplay());</span>
<span class="nc" id="L297">		return sb.toString();</span>
	}

	/**
	 * Initialize Content Title
	 */
	@Override
	protected void initContentTitle() {
<span class="nc" id="L305">		initFilterNames();</span>

<span class="nc bnc" id="L307" title="All 2 branches missed.">		String rbKey = m_isNewFilter ? UIFWebBundleKey.FILTER_CREATE : UIFWebBundleKey.FILTER_EDIT;</span>
<span class="nc" id="L308">		String pageTitle = i18n(m_common_bundle, rbKey);</span>
<span class="nc" id="L309">		String itemName = getContentTitleItemName();</span>

<span class="nc" id="L311">		m_contentTitlePC.setPageTitle(pageTitle);</span>
<span class="nc" id="L312">		m_contentTitlePC.setItemName(itemName);</span>

<span class="nc bnc" id="L314" title="All 2 branches missed.">		boolean isVisible = !m_isNewFilter;</span>
<span class="nc" id="L315">		String label = i18n(m_common_bundle, UIFWebBundleKey.FILTERS_LABEL);</span>
<span class="nc" id="L316">		m_contentTitlePC.setActiveComponent(label, m_configListBoxPC, isVisible);</span>
<span class="nc" id="L317">	}</span>

	/**
	 * Return Content Title Item Name
	 */
	@Override
	protected String getContentTitleItemName() {
<span class="nc bnc" id="L324" title="All 2 branches missed.">		if (m_isNewFilter) {</span>
<span class="nc" id="L325">			return &quot;&quot;;</span>
		}

<span class="nc" id="L328">		return super.getContentTitleItemName();</span>
	}

	/**
	 * Return True if default Config Name is selected
	 */
	@Override
	public boolean isDefaultConfig() {
<span class="nc" id="L336">		String value = getSelectedConfig();</span>
<span class="nc bnc" id="L337" title="All 6 branches missed.">		return StringUtil.isEmpty(value) || PageKeys.DEFAULT_ALL.equals(value) || RequestUtil.ALL_FILTER.equals(value);</span>
	}

	/**
	 * Return Selected Config as ID
	 */
	@Override
	public ID getSelectedConfigID() {
<span class="nc" id="L345">		ID id = null;</span>

<span class="nc" id="L347">		String sID = getSelectedConfig();</span>
<span class="nc bnc" id="L348" title="All 6 branches missed.">		if (sID != null &amp;&amp; !sID.equals(PageKeys.DEFAULT_ALL) &amp;&amp; !sID.equals(RequestUtil.ALL_FILTER)) {</span>
<span class="nc" id="L349">			id = new ID(sID);</span>
		}
<span class="nc" id="L351">		return id;</span>
	}

	/**
	 * Specify whether it is a new filter
	 */
	public void setIsNewFilter(boolean bSwitch) {
<span class="nc" id="L358">		m_isNewFilter = bSwitch;</span>
<span class="nc" id="L359">	}</span>

	/**
	 * Return true if it is a New Filter
	 */
	public boolean isNewFilter() {
<span class="nc" id="L365">		return m_isNewFilter;</span>
	}

	/**
	 * Set Request Filter Name
	 */
	public void setFilterName(String name) {
<span class="nc" id="L372">		m_rFilter.setName(name);</span>
<span class="nc" id="L373">	}</span>

	/**
	 * Return Request Filter Name
	 */
	public String getFilterName() {
<span class="nc" id="L379">		return m_rFilter.getName();</span>
	}

	/**
	 * Specifiy Request Type
	 */
	public void setRequestType(String type) {
<span class="nc" id="L386">		m_rFilter.setKey(RequestFilter.REQUEST_TYPE_KEY, type);</span>
<span class="nc" id="L387">	}</span>

	/**
	 * Return Request Type
	 */
	public String getRequestType() {
<span class="nc" id="L393">		return (String) m_rFilter.getValueForKey(RequestFilter.REQUEST_TYPE_KEY);</span>
	}

	/**
	 * Return current User ID
	 */
	public User getUser() {
<span class="nc" id="L400">		return m_context.getUser();</span>
	}

	public ID getSelectedFilterID() {
<span class="nc" id="L404">		return getSelectedConfigID();</span>
	}

	/**
	 * Reset Request Filter
	 */
	public void resetRequestFilter() {
<span class="nc" id="L411">		setRequestFilter(new RequestFilter(getUser().getID(), &quot;&quot;));</span>
<span class="nc" id="L412">		m_rFilter.setKey(RequestFilter.REQUEST_TYPE_KEY, Request.REQUESTTYPE_ALL);</span>
<span class="nc" id="L413">	}</span>

	/**
	 * Specify Request Filter to be used
	 */
	public void setRequestFilter(RequestFilter rFilter) {
<span class="nc" id="L419">		m_rFilter = rFilter;</span>
<span class="nc" id="L420">		m_propPC.setRequestFilter(rFilter);</span>
<span class="nc" id="L421">	}</span>

	/**
	 * Return Request Filter
	 */
	public RequestFilter getRequestFilter() {
<span class="nc" id="L427">		return m_rFilter;</span>
	}

	/**
	 * Extract Parameter
	 */
	@Override
	public boolean extractParameters(HttpServletRequest request) {
<span class="nc" id="L435">		boolean success = super.extractParameters(request);</span>

<span class="nc" id="L437">		ID[] checkedID = m_orgTreePC.getCheckedID();</span>
<span class="nc bnc" id="L438" title="All 2 branches missed.">		if (checkedID == null) {</span>
<span class="nc" id="L439">			m_isOrgIDSelected = false;</span>
		} else {
<span class="nc" id="L441">			m_isOrgIDSelected = true;</span>
<span class="nc" id="L442">			Collection orgIDs = Arrays.asList(checkedID);</span>
<span class="nc" id="L443">			m_rFilter.setKey(RequestFilter.ORGANIZATION_KEY, (Serializable) orgIDs);</span>
		}

<span class="nc" id="L446">		return success;</span>
	}

	/**
	 * Return HTML
	 */
	@Override
	public String getHtmlDisplay() {
<span class="nc" id="L454">		StringBuffer sb = new StringBuffer(512);</span>

<span class="nc" id="L456">		sb.append(&quot;&lt;table border=\&quot;0\&quot; cellpadding=\&quot;2\&quot; cellspacing=\&quot;2\&quot; width=\&quot;100%\&quot;&gt;&quot;);</span>

<span class="nc" id="L458">		sb.append(&quot;&lt;tr valign=\&quot;top\&quot;&gt;&quot;);</span>
<span class="nc" id="L459">		sb.append(&quot;&lt;td width=\50%\&quot;&gt;&quot;).append(m_orgTreePC).append(&quot;&lt;/td&gt;&quot;);</span>
<span class="nc" id="L460">		sb.append(&quot;&lt;td width=\50%\&quot; rowspan=\&quot;2\&quot;&gt;&quot;).append(m_propPC).append(&quot;&lt;/td&gt;&quot;);</span>
<span class="nc" id="L461">		sb.append(&quot;&lt;/tr&gt;&quot;);</span>

<span class="nc" id="L463">		sb.append(&quot;&lt;tr valign=\&quot;top\&quot;&gt;&quot;);</span>
<span class="nc" id="L464">		sb.append(&quot;&lt;td&gt;&quot;).append(m_reqTypePC).append(&quot;&lt;/td&gt;&quot;);</span>
<span class="nc" id="L465">		sb.append(&quot;&lt;/tr&gt;&quot;);</span>

<span class="nc" id="L467">		sb.append(&quot;&lt;/table&gt;&quot;);</span>

<span class="nc" id="L469">		return sb.toString();</span>
	}

	/**
	 * Return Custome JavaScript
	 */
	@Override
	public String getCustomJavaScript() {
<span class="nc" id="L477">		StringBuffer sb = new StringBuffer(512);</span>
<span class="nc" id="L478">		sb.append(super.getCustomJavaScript());</span>

		// Create Custom Resize Function
<span class="nc" id="L481">		sb.append(JSUtil.CUSTOM_RESIZE_FUNC);</span>
<span class="nc" id="L482">		JSUtil.resizePC(m_orgTreePC.getName(), 269, 200, sb);</span>
<span class="nc" id="L483">		JSUtil.resizePC(m_propPC.getName(), 141, 306, sb);</span>
<span class="nc" id="L484">		sb.append(&quot;}\n&quot;);</span>

<span class="nc" id="L486">		return sb.toString();</span>
	}
	public boolean isCloseAfterLoadCustomize() {
<span class="nc" id="L489">		return isCloseAfterLoadCustomize;</span>
	}

	public void setCloseAfterLoadCustomize(boolean isCloseAfterLoadCustomize) {
<span class="nc" id="L493">		this.isCloseAfterLoadCustomize = isCloseAfterLoadCustomize;</span>
<span class="nc" id="L494">	}</span>
	@Override
	public String getJavaScriptInitCode() {
<span class="nc" id="L497">		StringBuffer jsInit = new StringBuffer(1000);</span>
<span class="nc" id="L498">		jsInit.append(super.getJavaScriptInitCode());</span>
<span class="nc bnc" id="L499" title="All 2 branches missed.">		if(isCloseAfterLoadCustomize()){</span>
<span class="nc" id="L500">			jsInit.append(super.getJSBeforeClose() );</span>
<span class="nc" id="L501">			jsInit.append(&quot;\nwindow.notifyOpener=true;\n&quot;);</span>
<span class="nc" id="L502">			jsInit.append(&quot;if(is.chrome)\n&quot;);</span>
<span class="nc" id="L503">			jsInit.append(&quot;    handleUnload(window);\n&quot;);</span>
<span class="nc" id="L504">			jsInit.append(&quot;window.close();\n&quot;); </span>
		}
<span class="nc" id="L506">		return jsInit.toString();</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>