<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>RequestsFilterPropPC.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.rm.requests.filter</a> &gt; <span class="el_source">RequestsFilterPropPC.java</span></div><h1>RequestsFilterPropPC.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.rm.requests.filter;

import java.io.*;
import java.util.*;
import java.util.Map.Entry;

import javax.servlet.http.HttpServletRequest;

import com.bluepumpkin.common.util.*;
import com.bluepumpkin.common.datatypes.*;
import com.bluepumpkin.ejb.bbm.skill.model.Skill;
import com.bluepumpkin.ejb.bbm.workresource.model.EmployeeName;
import com.bluepumpkin.ejb.rm.requests.common.model.*;
import com.bluepumpkin.ejb.rm.requests.commonrequestmanager.model.*;
import com.bluepumpkin.ejb.rm.requests.swap.request.model.ShiftSwapRequest;
import com.bluepumpkin.ejb.core.filterconfig.model.Filter;
import com.bluepumpkin.web.bbm.l10n.*;
import com.witness.web.uif.system.*;
import com.witness.web.uif.l10n.*;
import com.witness.web.uif.util.js.*;
import com.witness.web.uif.util.*;
import com.witness.web.uif.pagecomponent.*;
import com.witness.web.uif.pagecomponent.form.FormInputPC;
import com.witness.web.uif.pagecomponent.list.*;
import com.witness.web.uif.pagecomponent.picker.date.*;
import com.bluepumpkin.web.rm.l10n.*;
import com.bluepumpkin.web.rm.requests.shiftbidding.ShiftBidUtil;
import com.bluepumpkin.ejb.rm.setup.calendartimeoff.model.TOPool;
import com.bluepumpkin.ejb.rm.requests.custshift.model.*;
import com.bluepumpkin.ejb.bbm.workrules.model.Shift;
import com.bluepumpkin.ejb.bbm.campaign.model.Campaign;
import com.bluepumpkin.ejb.bbm.activity.model.Activity;
import com.bluepumpkin.ejb.bbm.workrules.model.ShiftOTExtension;
import com.witness.web.uif.base.Message;
import com.bluepumpkin.ejb.rm.util.LicenseUtil;
import com.bluepumpkin.ejb.rm.setup.timeoffbid.model.TimeOffBid;

/**
 * Title: RequestsFilterPropPC Description: Encapsulate UI fro Request Filter Properties Copyright: Copyright (c) 2002 Company: Blue
 * Pumpkin Software, Inc
 * 
 * @author David Su, dsu
 * @version 1.0
 * 
 *          Created on October 16, 2002, 11:23 AM
 */
public class RequestsFilterPropPC extends MultiColListPC {
	private static final String SUPERVISOR_FN = &quot;supervisor&quot;;
	private static final String STATUS_FN = &quot;status&quot;;
	private static final String SUBMITTED_DR_FN = &quot;submitted&quot;;
	private static final String SENIORITY_DR_FN = &quot;seniority&quot;;
	private static final String START_END_DR_FN = &quot;startEndDates&quot;;
	private static final String FLEX_MAKEUP_START_END_DR_FN = &quot;flexMakeupStartEndDates&quot;;

	private static final String TO_NUM_CHOICE_FN = &quot;toNumOfChoice&quot;;
	private static final String TO_POOL_FN = &quot;toPoolName&quot;;
	private static final String TO_BID_FN = &quot;toBidName&quot;;

	private static final String SS_TYPE_FN = &quot;ssType&quot;;
	private static final String SS_SKILLS_FN = &quot;ssSkills&quot;;

	private static final String OPERATOR_SUFFIX = &quot;Op&quot;;
	private static final String SB_PREF_FN = &quot;sbPref&quot;;
	private static final String SB_REQDAY_FN = &quot;sbRD&quot;;
	private static final String SB_DEADLINE_FN = &quot;sbDl&quot;;
	private static final String SB_DEADLINE_OP_FN = SB_DEADLINE_FN + OPERATOR_SUFFIX;
	private static final String SB_RANK_FN = &quot;sbRank&quot;;
	private static final String SB_RANK_OP_FN = SB_RANK_FN + OPERATOR_SUFFIX;
	private static final String SB_POINTS_FN = &quot;sbPoints&quot;;
	private static final String SB_POINTS_OP_FN = SB_POINTS_FN + OPERATOR_SUFFIX;
	private static final String SB_BONUS_FN = &quot;sbBonus&quot;;
	private static final String SB_BONUS_OP_FN = SB_BONUS_FN + OPERATOR_SUFFIX;
	private static final String SB_SCORE_FN = &quot;sbScore&quot;;
	private static final String SB_SCORE_OP_FN = SB_SCORE_FN + OPERATOR_SUFFIX;

	private static final String CS_SUBTYPE_FN = &quot;csSubType&quot;;
	private static final String CS_CAMPAIGN_FN = &quot;csCampaign&quot;;
	private static final String CS_ACTIVITY_FN = &quot;csActivity&quot;;
	private static final String CS_SHIFT_FN = &quot;csShift&quot;;
	private static final String CS_EXTENSION_FN = &quot;csExtension&quot;;
	private static final String CS_OVERTIME_FN = &quot;csOvertime&quot;;

	private final FormInputPC m_inputPC;
	private final DatePickerPC m_datePC;
	private final DateRangePickerPC m_dateRangePC;
	private RequestFilter m_rFilter;

<span class="nc" id="L88">	private List m_reqStatusList = Collections.EMPTY_LIST;</span>
<span class="nc" id="L89">	private Collection m_supervisorList = Collections.EMPTY_LIST;</span>
<span class="nc" id="L90">	private Collection m_skillList = Collections.EMPTY_LIST;</span>
<span class="nc" id="L91">	private Collection m_poolList = Collections.EMPTY_LIST;</span>
<span class="nc" id="L92">	private Collection bidList = Collections.EMPTY_LIST;</span>

<span class="nc" id="L94">	private Collection m_campaignList = Collections.EMPTY_LIST;</span>
<span class="nc" id="L95">	private Map&lt;ID, String&gt; m_shiftIDNamesMap = new HashMap&lt;ID, String&gt;();</span>
<span class="nc" id="L96">	private Collection m_activityList = Collections.EMPTY_LIST;</span>
<span class="nc" id="L97">	private Map&lt;ID, String&gt; m_extIDNamesMap = new HashMap&lt;ID, String&gt;();</span>

	private final StringsPair m_allOption;
	private final ResourceBundle m_bundle;

<span class="nc" id="L102">	private boolean hasAdvRMLicense = false;</span>

	/** Creates a new instance of RequestsFilterPropPC */
	public RequestsFilterPropPC(RequestContext context, DatePickerPC datePC, DateRangePickerPC drPC) {
<span class="nc" id="L106">		super(context);</span>

<span class="nc" id="L108">		m_bundle = m_localizer.getBundle(RmWebBundleKey.BUNDLE_NAME);</span>

<span class="nc" id="L110">		hasAdvRMLicense = LicenseUtil.isAdvancedRMLicense();</span>

<span class="nc" id="L112">		setEnabled(false);</span>
<span class="nc" id="L113">		setIsBorderEnabled(true);</span>

<span class="nc" id="L115">		m_datePC = datePC;</span>
<span class="nc" id="L116">		m_dateRangePC = drPC;</span>

<span class="nc" id="L118">		m_allOption = new StringsPair(&quot;&quot;, &quot;&quot;);</span>

<span class="nc" id="L120">		m_inputPC = new FormInputPC(m_context);</span>
<span class="nc" id="L121">		addChildComponent(m_inputPC);</span>
<span class="nc" id="L122">	}</span>

	/**
	 * Initialize Component
	 */
	public void init(Collection supervisorList, List reqStatusList, Collection skillList, Collection poolList, Collection bidList,
			Collection campaignList, Map&lt;ID, String&gt; shiftMap, Collection activityList, Map&lt;ID, String&gt; extensionMap) {
<span class="nc" id="L129">		m_supervisorList = supervisorList;</span>
<span class="nc" id="L130">		m_reqStatusList = reqStatusList;</span>
<span class="nc" id="L131">		m_skillList = skillList;</span>
<span class="nc" id="L132">		m_poolList = poolList;</span>
<span class="nc" id="L133">		this.bidList = bidList;</span>
<span class="nc" id="L134">		m_campaignList = campaignList;</span>
<span class="nc" id="L135">		m_shiftIDNamesMap = shiftMap;</span>
<span class="nc" id="L136">		m_activityList = activityList;</span>
<span class="nc" id="L137">		m_extIDNamesMap = extensionMap;</span>
<span class="nc" id="L138">	}</span>

	/**
	 * Initialize Component for display
	 */
	public void initForDisplay() {
<span class="nc bnc" id="L144" title="All 2 branches missed.">		if (m_isInitializedForDisplay)</span>
<span class="nc" id="L145">			return;</span>
		else {
<span class="nc" id="L147">			super.initForDisplay();</span>

<span class="nc" id="L149">			initHeader();</span>
<span class="nc" id="L150">			initList();</span>
		}
<span class="nc" id="L152">	}</span>

	/**
	 * Validates the Page Component
	 * 
	 * NOTE: This method recurse through all sub-components
	 */
	public boolean validate() {
<span class="nc" id="L160">		boolean success = super.validate();</span>

<span class="nc" id="L162">		ID shiftID = (ID) m_rFilter.getValueForKey(RequestFilter.CS_SHIFTID_KEY);</span>
<span class="nc" id="L163">		ID extID = (ID) m_rFilter.getValueForKey(RequestFilter.CS_EXTID_KEY);</span>
<span class="nc bnc" id="L164" title="All 8 branches missed.">		if (shiftID != null &amp;&amp; shiftID.toString().length() &gt; 0 &amp;&amp; extID != null &amp;&amp; extID.toString().length() &gt; 0) {</span>
<span class="nc" id="L165">			addPageMessage(Message.WARNING_TYPE, RmWebBundleKey.CSR_WARNING_CANNOT_SELECT_SHIFT_AND_EXT, RmWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L166">			return false;</span>
		}
<span class="nc" id="L168">		return success;</span>
	}

	/**
	 * limit the DateRange picker to +/- 30 years
	 */
	protected void limitDateRangePicker() {
<span class="nc" id="L175">		CalendarRange selectableRange = DateTimeUtil.makeTimeRangeAroundNow(Calendar.YEAR, 30, 30); // +/-30 years</span>
<span class="nc" id="L176">		m_dateRangePC.getStartDatePickerPC().setLowerLimit(selectableRange.getStartDate());</span>
<span class="nc" id="L177">		m_dateRangePC.getEndDatePickerPC().setUpperLimit(selectableRange.getEndDate());</span>
<span class="nc" id="L178">	}</span>

	/**
	 * Initialize Header
	 */
	protected void initHeader() {
<span class="nc" id="L184">		String name = i18n(m_common_bundle, UIFWebBundleKey.NAME);</span>
<span class="nc" id="L185">		String value = i18n(m_common_bundle, UIFWebBundleKey.VALUE);</span>
<span class="nc" id="L186">		getHeader().addColumnHeaderData(&quot;&quot;, name);</span>
<span class="nc" id="L187">		getHeader().addColumnHeaderData(&quot;&quot;, value);</span>
<span class="nc" id="L188">	}</span>

	/**
	 * Initialize List
	 */
	protected void initList() {
<span class="nc" id="L194">		String reqType = (String) m_rFilter.getValueForKey(RequestFilter.REQUEST_TYPE_KEY);</span>

<span class="nc" id="L196">		ArrayList listModel = new ArrayList();</span>
<span class="nc" id="L197">		addCommonProp(listModel);</span>
<span class="nc bnc" id="L198" title="All 2 branches missed.">		if (Request.REQUESTTYPE_TIMEOFF.equals(reqType)) {</span>
<span class="nc" id="L199">			addTimeOffProp(listModel);</span>
<span class="nc bnc" id="L200" title="All 2 branches missed.">		} else if (Request.REQUESTTYPE_FLEXTIME.equals(reqType)) {</span>
<span class="nc" id="L201">			addFlexTimeProp(listModel);</span>
<span class="nc bnc" id="L202" title="All 2 branches missed.">		} else if (Request.REQUESTTYPE_SHIFTSWAP.equals(reqType)) {</span>
<span class="nc" id="L203">			addShiftSwapProp(listModel);</span>
<span class="nc bnc" id="L204" title="All 2 branches missed.">		} else if (Request.REQUESTTYPE_SHIFTBID.equals(reqType)) {</span>
<span class="nc" id="L205">			addShiftBidProp(listModel);</span>
<span class="nc bnc" id="L206" title="All 2 branches missed.">		} else if (Request.REQUESTTYPE_CUSTSHIFT.equals(reqType)) {</span>
<span class="nc" id="L207">			addCustShiftProp(listModel);</span>
		}

<span class="nc" id="L210">		setListModel(listModel);</span>
<span class="nc" id="L211">	}</span>

	/**
	 * Create Common Filter Properties
	 */
	protected void addCommonProp(List listModel) {
<span class="nc" id="L217">		String label = i18n(m_common_bundle, UIFWebBundleKey.SUPERVISOR);</span>
<span class="nc" id="L218">		String value = createSupervisorDD();</span>
<span class="nc" id="L219">		listModel.add(createNodeData(label, value));</span>

<span class="nc" id="L221">		label = i18n(m_common_bundle, UIFWebBundleKey.STATUS);</span>
<span class="nc" id="L222">		value = createStatusDD();</span>
<span class="nc" id="L223">		listModel.add(createNodeData(label, value));</span>

<span class="nc" id="L225">		label = i18n(m_common_bundle, UIFWebBundleKey.SUBMITTED);</span>
<span class="nc" id="L226">		value = createDateRange(SUBMITTED_DR_FN, RequestFilter.SUBMITTED_KEY);</span>
<span class="nc" id="L227">		listModel.add(createNodeData(label, value));</span>

<span class="nc" id="L229">		label = i18n(m_common_bundle, UIFWebBundleKey.SENIORITY);</span>
<span class="nc" id="L230">		value = createDateRange(SENIORITY_DR_FN, RequestFilter.SENIORITY_KEY);</span>
<span class="nc" id="L231">		listModel.add(createNodeData(label, value));</span>
<span class="nc" id="L232">	}</span>

	/**
	 * @param listModel
	 */
	protected void addStartEndProp(List listModel) {
<span class="nc" id="L238">		String label = i18n(m_common_bundle, UIFWebBundleKey.START_END_DATES);</span>
<span class="nc" id="L239">		addStartEndProp(listModel, START_END_DR_FN, RequestFilter.REQUEST_DATE_RANGE_KEY, label);</span>
<span class="nc" id="L240">	}</span>

	/**
	 * @param listModel
	 */
	protected void addStartEndProp(List listModel, String fieldName, String key, String label) {
		String value;
<span class="nc" id="L247">		value = createDateRange(fieldName, key);</span>
<span class="nc" id="L248">		listModel.add(createNodeData(label, value));</span>
<span class="nc" id="L249">	}</span>

	/**
	 * Create Time Off Specific Properties
	 */
	protected void addTimeOffProp(List listModel) {
<span class="nc" id="L255">		addStartEndProp(listModel);</span>

<span class="nc bnc" id="L257" title="All 2 branches missed.">		if (hasAdvRMLicense) {</span>
<span class="nc" id="L258">			String label = i18n(m_bundle, RmWebBundleKey.RM_TIMEOFF_BID);</span>
<span class="nc" id="L259">			String value = createTimeOffBidDD();</span>
<span class="nc" id="L260">			listModel.add(createNodeData(label, value));</span>
		}

<span class="nc" id="L263">		String label = i18n(m_common_bundle, UIFWebBundleKey.NUMBER_OF_CHOICES);</span>
<span class="nc" id="L264">		String value = createTimeOffChoiceDD();</span>
<span class="nc" id="L265">		listModel.add(createNodeData(label, value));</span>

<span class="nc" id="L267">		label = i18n(m_bundle, RmWebBundleKey.TIME_OFF_POOL);</span>
<span class="nc" id="L268">		value = createPoolDD();</span>
<span class="nc" id="L269">		listModel.add(createNodeData(label, value));</span>
<span class="nc" id="L270">	}</span>

	/**
	 * Create Flex Time Specific Properties
	 */
	protected void addFlexTimeProp(List listModel) {
<span class="nc" id="L276">		String label = i18n(m_bundle, RmWebBundleKey.TIMEOFF_START_END_DATES);</span>
<span class="nc" id="L277">		addStartEndProp(listModel, START_END_DR_FN, RequestFilter.REQUEST_DATE_RANGE_KEY, label);</span>

<span class="nc" id="L279">		label = i18n(m_bundle, RmWebBundleKey.FLEX_MAKEUP_START_END_DATES);</span>
<span class="nc" id="L280">		addStartEndProp(listModel, FLEX_MAKEUP_START_END_DR_FN, RequestFilter.REQUEST_FLEX_MAKEUP_DATE_RANGE_KEY, label);</span>

		// Shift
<span class="nc" id="L283">		label = i18n(m_bundle, RmWebBundleKey.RM_SA_FILTER_MAKEUP_SHIFT);</span>
<span class="nc" id="L284">		String value = createShiftDD();</span>
<span class="nc" id="L285">		listModel.add(createNodeData(label, value));</span>

		// Activity
<span class="nc" id="L288">		label = i18n(m_bundle, RmWebBundleKey.RM_SA_FILTER_MAKEUP_ACTIVITY);</span>
<span class="nc" id="L289">		value = createActivityDD();</span>
<span class="nc" id="L290">		listModel.add(createNodeData(label, value));</span>
<span class="nc" id="L291">	}</span>

	/**
	 * Create Shift Swap Specific Properties
	 */
	protected void addShiftSwapProp(List listModel) {
<span class="nc" id="L297">		addStartEndProp(listModel);</span>

<span class="nc" id="L299">		String label = i18n(m_common_bundle, UIFWebBundleKey.TYPE);</span>
<span class="nc" id="L300">		String value = createShiftSwapTypeDD();</span>
<span class="nc" id="L301">		listModel.add(createNodeData(label, value));</span>

<span class="nc" id="L303">		ResourceBundle m_bbm_bundle = m_localizer.getBundle(BbmWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L304">		label = i18n(m_bbm_bundle, BbmWebBundleKey.BBM_PEOPLE_SKILLS);</span>
<span class="nc" id="L305">		value = createShiftSwapSkillDD();</span>
<span class="nc" id="L306">		listModel.add(createNodeData(label, value));</span>
<span class="nc" id="L307">	}</span>

	/**
	 * Create Shift Swap Specific Properties
	 */
	protected void addShiftBidProp(List listModel) {
<span class="nc" id="L313">		addStartEndProp(listModel);</span>

		// preference
<span class="nc" id="L316">		String label = i18n(m_common_bundle, UIFWebBundleKey.PREFERENCE);</span>
<span class="nc" id="L317">		Integer prefValue = (Integer) m_rFilter.getValueForKey(RequestFilter.BID_PREF_KEY);</span>
<span class="nc bnc" id="L318" title="All 2 branches missed.">		String sPrefValue = prefValue != null ? prefValue.toString() : null;</span>
<span class="nc" id="L319">		String value = ShiftBidUtil.createBidPrefDDForFilter(SB_PREF_FN, sPrefValue, m_allOption, m_localizer);</span>
<span class="nc" id="L320">		listModel.add(createNodeData(label, value));</span>

		// day
<span class="nc" id="L323">		label = i18n(m_common_bundle, UIFWebBundleKey.DAY);</span>
<span class="nc" id="L324">		Integer dayValue = (Integer) m_rFilter.getValueForKey(RequestFilter.BID_REQUESTED_DAY_KEY);</span>
<span class="nc bnc" id="L325" title="All 2 branches missed.">		int iDayValue = dayValue != null ? dayValue.intValue() : -1;</span>
<span class="nc" id="L326">		value = HtmlUtil.getDayOfWeekDropDown(SB_REQDAY_FN, iDayValue, JSUtil.ON_CHANGE, true, m_localizer);</span>
<span class="nc" id="L327">		listModel.add(createNodeData(label, value));</span>

		// deadline
<span class="nc" id="L330">		ArrayList opOptionsForDealine = new ArrayList(3);</span>
<span class="nc" id="L331">		opOptionsForDealine.add(new StringsPair(Filter.LESS_THAN_OPERATION, i18n(m_common_bundle, UIFWebBundleKey.BEFORE)));</span>
<span class="nc" id="L332">		opOptionsForDealine.add(new StringsPair(Filter.EQUAL_OPERATION, i18n(m_common_bundle, UIFWebBundleKey.EQUAL_TO)));</span>
<span class="nc" id="L333">		opOptionsForDealine.add(new StringsPair(Filter.GREATER_THAN_OPERATION, i18n(m_common_bundle, UIFWebBundleKey.AFTER)));</span>
<span class="nc" id="L334">		label = i18n(m_common_bundle, UIFWebBundleKey.DEADLINE);</span>
<span class="nc" id="L335">		Date deadlineValue = (Date) m_rFilter.getValueForKey(RequestFilter.BID_DEADLINE_KEY);</span>
<span class="nc" id="L336">		String sOperator = (String) m_rFilter.getValueForKey(RequestFilter.BID_DEADLINE_OPERATOR_KEY);</span>
<span class="nc" id="L337">		initDate(SB_DEADLINE_FN);</span>
<span class="nc" id="L338">		m_datePC.setDate(deadlineValue);</span>
<span class="nc" id="L339">		value = HtmlUtil.makeSelectInput(SB_DEADLINE_OP_FN, sOperator, JSUtil.ON_CHANGE, opOptionsForDealine) + &quot; &quot;</span>
<span class="nc" id="L340">				+ m_datePC.getHtmlDisplay();</span>
<span class="nc" id="L341">		listModel.add(createNodeData(label, value));</span>

<span class="nc" id="L343">		ArrayList opOptionsForNum = new ArrayList(3);</span>
<span class="nc" id="L344">		opOptionsForNum.add(new StringsPair(Filter.LESS_THAN_OPERATION, i18n(m_common_bundle, UIFWebBundleKey.LESS_THAN)));</span>
<span class="nc" id="L345">		opOptionsForNum.add(new StringsPair(Filter.EQUAL_OPERATION, i18n(m_common_bundle, UIFWebBundleKey.EQUAL_TO)));</span>
<span class="nc" id="L346">		opOptionsForNum.add(new StringsPair(Filter.GREATER_THAN_OPERATION, i18n(m_common_bundle, UIFWebBundleKey.MORE_THAN)));</span>

		// Rank
<span class="nc" id="L349">		addNumWithOperatorInput(SB_RANK_FN, SB_RANK_OP_FN, UIFWebBundleKey.RANK, RequestFilter.EMP_RANK_KEY,</span>
				RequestFilter.EMP_RANK_OPERATOR_KEY, opOptionsForNum, listModel);

		// Points
<span class="nc" id="L353">		addNumWithOperatorInput(SB_POINTS_FN, SB_POINTS_OP_FN, UIFWebBundleKey.POINTS, RequestFilter.BID_POINTS_KEY,</span>
				RequestFilter.BID_POINTS_OPERATOR_KEY, opOptionsForNum, listModel);

		// Bonus
<span class="nc" id="L357">		addNumWithOperatorInput(SB_BONUS_FN, SB_BONUS_OP_FN, UIFWebBundleKey.BONUS, RequestFilter.BID_BONUS_KEY,</span>
				RequestFilter.BID_BONUS_OPERATOR_KEY, opOptionsForNum, listModel);

		// Score
<span class="nc" id="L361">		addNumWithOperatorInput(SB_SCORE_FN, SB_SCORE_OP_FN, UIFWebBundleKey.SCORE, RequestFilter.BID_SCORE_KEY,</span>
				RequestFilter.BID_SCORE_OPERATOR_KEY, opOptionsForNum, listModel);

<span class="nc" id="L364">	}</span>

	/**
	 * Create Custom Shift Specific Properties The Custom Requests will be filtered on the following columns &gt; Request sub type (new
	 * shift /shift change) &gt; Campaign ID (Name) &gt; Activity ID (Name) in main shift or extensions &gt; Shift ID(Name ) OR &gt; Extn
	 * ID(Name) (You can either filter by shift name or extn name but not by both) //Extn Name applicable to both before and after
	 * extn &gt; Overtime (Yes/No) (will filter for either shift or extn)
	 */
	protected void addCustShiftProp(List listModel) {
<span class="nc" id="L373">		addStartEndProp(listModel);</span>

		// Sub Type (New Shift/Shift Change)
<span class="nc" id="L376">		String label = i18n(m_common_bundle, UIFWebBundleKey.TYPE);</span>
<span class="nc" id="L377">		String value = createCustShiftTypeDD();</span>
<span class="nc" id="L378">		listModel.add(createNodeData(label, value));</span>

		// Campaign
<span class="nc" id="L381">		label = i18n(m_bundle, RmWebBundleKey.CAMPAIGN);</span>
<span class="nc" id="L382">		value = createCampaignDD();</span>
<span class="nc" id="L383">		listModel.add(createNodeData(label, value));</span>

		// Shift
<span class="nc" id="L386">		label = i18n(m_bundle, RmWebBundleKey.RM_SA_FILTER_SHIFT);</span>
<span class="nc" id="L387">		value = createShiftDD();</span>
<span class="nc" id="L388">		listModel.add(createNodeData(label, value));</span>

		// Activity
<span class="nc" id="L391">		label = i18n(m_bundle, RmWebBundleKey.RM_SA_FILTER_ACTIVITY);</span>
<span class="nc" id="L392">		value = createActivityDD();</span>
<span class="nc" id="L393">		listModel.add(createNodeData(label, value));</span>

		// Extension
<span class="nc" id="L396">		label = i18n(m_bundle, RmWebBundleKey.CSR_EXTENSION_BEFORE_OR_AFTER_SHIFT);</span>
<span class="nc" id="L397">		value = createExtensionDD();</span>
<span class="nc" id="L398">		listModel.add(createNodeData(label, value));</span>

		// OT (Yes/No)
<span class="nc" id="L401">		label = i18n(m_bundle, RmWebBundleKey.ORG_RM_FILING_RULE_OVERTIME);</span>
<span class="nc" id="L402">		value = createOvertimeDD();</span>
<span class="nc" id="L403">		listModel.add(createNodeData(label, value));</span>
<span class="nc" id="L404">	}</span>

	private void addNumWithOperatorInput(String fn, String opFn, String rbKey, String reqKey, String reqOpKey, List opOptions,
			List listModel) {
<span class="nc" id="L408">		String label = i18n(m_common_bundle, rbKey);</span>
<span class="nc" id="L409">		Integer reqVal = (Integer) m_rFilter.getValueForKey(reqKey);</span>
<span class="nc" id="L410">		String sOperator = (String) m_rFilter.getValueForKey(reqOpKey);</span>

<span class="nc" id="L412">		m_inputPC.reset();</span>
<span class="nc" id="L413">		m_inputPC.setInputFN(fn);</span>
<span class="nc" id="L414">		m_inputPC.setInputFieldDesc(label);</span>
<span class="nc" id="L415">		m_inputPC.setInputType(FormInputPC.TYPE_INTEGER);</span>
<span class="nc" id="L416">		m_inputPC.setLowerLimit(0, true);</span>
<span class="nc bnc" id="L417" title="All 2 branches missed.">		if (reqVal != null)</span>
<span class="nc" id="L418">			m_inputPC.setInputValue(reqVal.toString());</span>

<span class="nc" id="L420">		String value = HtmlUtil.makeSelectInput(opFn, sOperator, JSUtil.ON_CHANGE, opOptions) + &quot; &quot; + m_inputPC.getHtmlDisplay();</span>
<span class="nc" id="L421">		listModel.add(createNodeData(label, value));</span>
<span class="nc" id="L422">	}</span>

	/**
	 * Set Request Filter
	 */
	public void setRequestFilter(RequestFilter rFilter) {
<span class="nc" id="L428">		m_rFilter = rFilter;</span>
<span class="nc" id="L429">	}</span>

	/**
	 * Extract Parameter
	 */
	public boolean extractParameters(HttpServletRequest request) {
<span class="nc" id="L435">		boolean success = super.extractParameters(request);</span>

<span class="nc" id="L437">		extractValue(request, STATUS_FN, RequestFilter.STATUS_KEY);</span>
<span class="nc" id="L438">		extractDateRange(request, SUBMITTED_DR_FN, RequestFilter.SUBMITTED_KEY);</span>
<span class="nc" id="L439">		extractDateRange(request, SENIORITY_DR_FN, RequestFilter.SENIORITY_KEY);</span>
<span class="nc" id="L440">		extractDateRange(request, START_END_DR_FN, RequestFilter.REQUEST_DATE_RANGE_KEY);</span>
<span class="nc" id="L441">		extractDateRange(request, FLEX_MAKEUP_START_END_DR_FN, RequestFilter.REQUEST_FLEX_MAKEUP_DATE_RANGE_KEY);</span>

<span class="nc" id="L443">		extractValue(request, TO_NUM_CHOICE_FN, RequestFilter.TO_NUMBER_OF_CHOICES_KEY);</span>
<span class="nc" id="L444">		extractID(request, TO_BID_FN, RequestFilter.TOBID_KEY);</span>
		// extractValue(request, TO_POOL_FN, RequestFilter.TOPOOL_KEY);

<span class="nc" id="L447">		extractValue(request, SS_TYPE_FN, RequestFilter.SWAP_TYPE_KEY);</span>
<span class="nc" id="L448">		extractIDs(request, SS_SKILLS_FN, RequestFilter.SWAP_SKILLS_KEY);</span>

<span class="nc" id="L450">		extractInteger(request, SB_PREF_FN, RequestFilter.BID_PREF_KEY);</span>
<span class="nc" id="L451">		extractInteger(request, SB_REQDAY_FN, RequestFilter.BID_REQUESTED_DAY_KEY);</span>
<span class="nc" id="L452">		Date date = extractDate(request, SB_DEADLINE_FN, RequestFilter.BID_DEADLINE_KEY);</span>
<span class="nc bnc" id="L453" title="All 2 branches missed.">		if (date != null)</span>
<span class="nc" id="L454">			extractString(request, SB_DEADLINE_OP_FN, RequestFilter.BID_DEADLINE_OPERATOR_KEY);</span>
<span class="nc" id="L455">		extractNumWithOperator(request, SB_RANK_FN, SB_RANK_OP_FN, RequestFilter.EMP_RANK_KEY, RequestFilter.EMP_RANK_OPERATOR_KEY);</span>
<span class="nc" id="L456">		extractNumWithOperator(request, SB_POINTS_FN, SB_POINTS_OP_FN, RequestFilter.BID_POINTS_KEY,</span>
				RequestFilter.BID_POINTS_OPERATOR_KEY);
<span class="nc" id="L458">		extractNumWithOperator(request, SB_BONUS_FN, SB_BONUS_OP_FN, RequestFilter.BID_BONUS_KEY,</span>
				RequestFilter.BID_BONUS_OPERATOR_KEY);
<span class="nc" id="L460">		extractNumWithOperator(request, SB_SCORE_FN, SB_SCORE_OP_FN, RequestFilter.BID_SCORE_KEY,</span>
				RequestFilter.BID_SCORE_OPERATOR_KEY);

<span class="nc" id="L463">		return success;</span>
	}

	/**
	 * Extract Value to Request Filter
	 */
	protected void extractValue(HttpServletRequest request, String fn, String key) {
<span class="nc" id="L470">		String value = request.getParameter(fn);</span>
<span class="nc bnc" id="L471" title="All 2 branches missed.">		if (!StringUtil.isEmpty(value)) {</span>
<span class="nc" id="L472">			m_rFilter.setKey(key, value);</span>
		}
<span class="nc" id="L474">	}</span>

	/**
	 * Extract Integer Value to Request Filter
	 */
	protected Integer extractInteger(HttpServletRequest request, String fn, String key) {
<span class="nc" id="L480">		Integer result = null;</span>
<span class="nc" id="L481">		String value = request.getParameter(fn);</span>
<span class="nc bnc" id="L482" title="All 2 branches missed.">		if (!StringUtil.isEmpty(value)) {</span>
<span class="nc" id="L483">			result = new Integer(value);</span>
<span class="nc" id="L484">			m_rFilter.setKey(key, result);</span>
		}

<span class="nc" id="L487">		return result;</span>
	}

	protected void extractNumWithOperator(HttpServletRequest request, String fn, String opFn, String key, String opKey) {
<span class="nc" id="L491">		Integer num = extractInteger(request, fn, key);</span>
<span class="nc bnc" id="L492" title="All 2 branches missed.">		if (num != null)</span>
<span class="nc" id="L493">			extractString(request, opFn, opKey);</span>
<span class="nc" id="L494">	}</span>

	protected void extractID(HttpServletRequest request, String fn, String key) {
<span class="nc" id="L497">		ID result = null;</span>
<span class="nc" id="L498">		String value = request.getParameter(fn);</span>
<span class="nc bnc" id="L499" title="All 2 branches missed.">		if (!StringUtil.isEmpty(value)) {</span>
<span class="nc" id="L500">			result = new ID(value);</span>
<span class="nc" id="L501">			m_rFilter.setKey(key, result);</span>
		}
<span class="nc" id="L503">	}</span>

	/**
	 * Extract Value to Request Filter
	 */
	protected void extractIDs(HttpServletRequest request, String fn, String key) {
<span class="nc" id="L509">		String[] value = request.getParameterValues(fn);</span>
<span class="nc bnc" id="L510" title="All 4 branches missed.">		if (value != null &amp;&amp; value.length &gt; 0) {</span>
<span class="nc" id="L511">			int size = value.length;</span>
<span class="nc" id="L512">			ArrayList ids = new ArrayList(size);</span>
<span class="nc bnc" id="L513" title="All 2 branches missed.">			for (int i = 0; i &lt; size; i++) {</span>
<span class="nc" id="L514">				String val = value[i];</span>
<span class="nc bnc" id="L515" title="All 2 branches missed.">				if (StringUtil.isEmpty(val))</span>
<span class="nc" id="L516">					continue;</span>
<span class="nc" id="L517">				ids.add(new ID(val));</span>
			}
<span class="nc bnc" id="L519" title="All 2 branches missed.">			if (!ids.isEmpty()) {</span>
<span class="nc" id="L520">				m_rFilter.setKey(key, ids);</span>
			}
		}
<span class="nc" id="L523">	}</span>

	// ////////////////////////////////////////////////////////////////////////////
	// The following are just helper methods
	// ////////////////////////////////////////////////////////////////////////////
	/**
	 * Create Node Data
	 */
	protected MultiColumnNodeData createNodeData(String label, String value) {
<span class="nc" id="L532">		DefaultMultiColumnNodeData nodeData = new DefaultMultiColumnNodeData();</span>
<span class="nc" id="L533">		nodeData.add(label);</span>
<span class="nc" id="L534">		nodeData.add(value);</span>
<span class="nc" id="L535">		return nodeData;</span>
	}

	/**
	 * Create Drop Down for the specified Key and Options
	 */
	protected String createDD(String fn, String key, List options) {
<span class="nc" id="L542">		String selectedValue = (String) m_rFilter.getValueForKey(key);</span>
<span class="nc" id="L543">		return HtmlUtil.makeSelectInput(fn, selectedValue, JSUtil.ON_CHANGE, options);</span>
	}

	/**
	 * Set Supervisor ID
	 */
	public void setSupervisor(ID id) {
<span class="nc bnc" id="L550" title="All 2 branches missed.">		if (id != null) {</span>
<span class="nc" id="L551">			ArrayList ids = new ArrayList(1);</span>
<span class="nc" id="L552">			ids.add(id);</span>
<span class="nc" id="L553">			m_rFilter.setKey(RequestFilter.SUPERVISOR_KEY, ids);</span>
		}
<span class="nc" id="L555">	}</span>

	/**
	 * Set Time Off Pool ID
	 */
	public void setTopool(ID id) {
<span class="nc bnc" id="L561" title="All 2 branches missed.">		if (id != null)</span>
<span class="nc" id="L562">			m_rFilter.setKey(RequestFilter.TOPOOL_KEY, id);</span>
<span class="nc" id="L563">	}</span>

	/**
	 * Set Time Off Pool ID
	 */
	public void setTopool(String id) {
<span class="nc bnc" id="L569" title="All 2 branches missed.">		if (id != null)</span>
<span class="nc" id="L570">			m_rFilter.setKey(RequestFilter.TOPOOL_KEY, new ID(id));</span>
<span class="nc" id="L571">	}</span>

	/**
	 * Set Time Off Pool ID
	 */
	public void setToPoolName(String id) {
<span class="nc bnc" id="L577" title="All 2 branches missed.">		if (!StringUtil.isEmptyOrWhiteSpace(id))</span>
<span class="nc" id="L578">			m_rFilter.setKey(RequestFilter.TOPOOL_KEY, new ID(id));</span>
<span class="nc" id="L579">	}</span>

	/**
	 * Sets the Time Off Bid value in the Request Filter.
	 * 
	 * @param id ID of the selected filter.
	 */
	public void setToBid(ID id) {
<span class="nc bnc" id="L587" title="All 2 branches missed.">		if (id != null) {</span>
<span class="nc" id="L588">			m_rFilter.setKey(RequestFilter.TOBID_KEY, id);</span>
		}
<span class="nc" id="L590">	}</span>

	/**
	 * Sets the Time Off Bid value in the Request Filter.
	 * 
	 * @param id ID of the selected filter.
	 */
	public void setToBid(String id) {
<span class="nc bnc" id="L598" title="All 2 branches missed.">		if (id != null) {</span>
<span class="nc" id="L599">			m_rFilter.setKey(RequestFilter.TOBID_KEY, new ID(id));</span>
		}
<span class="nc" id="L601">	}</span>

	/**
	 * Sets the Time Off Bid value in the Request Filter.
	 * 
	 * @param id ID of the selected filter.
	 */
	public void setToBidName(String id) {
<span class="nc bnc" id="L609" title="All 2 branches missed.">		if (!StringUtil.isEmptyOrWhiteSpace(id)) {</span>
<span class="nc" id="L610">			m_rFilter.setKey(RequestFilter.TOBID_KEY, new ID(id));</span>
		}
<span class="nc" id="L612">	}</span>

	public void setCsSubType(String str) {
<span class="nc bnc" id="L615" title="All 2 branches missed.">		if (!StringUtil.isEmptyOrWhiteSpace(str)) {</span>
<span class="nc" id="L616">			m_rFilter.setKey(RequestFilter.CS_SUBTYPE_KEY, str);</span>
		}
<span class="nc" id="L618">	}</span>

	public void setCsCampaign(String id) {
<span class="nc bnc" id="L621" title="All 2 branches missed.">		if (!StringUtil.isEmptyOrWhiteSpace(id)) {</span>
<span class="nc" id="L622">			m_rFilter.setKey(RequestFilter.CS_CAMPAIGNID_KEY, new ID(id));</span>
		}
<span class="nc" id="L624">	}</span>

	public void setCsActivity(String id) {
<span class="nc bnc" id="L627" title="All 2 branches missed.">		if (!StringUtil.isEmptyOrWhiteSpace(id)) {</span>
<span class="nc" id="L628">			m_rFilter.setKey(RequestFilter.CS_ACTIVITYID_KEY, new ID(id));</span>
		}
<span class="nc" id="L630">	}</span>

	public void setCsShift(String id) {
<span class="nc bnc" id="L633" title="All 2 branches missed.">		if (!StringUtil.isEmptyOrWhiteSpace(id)) {</span>
<span class="nc" id="L634">			m_rFilter.setKey(RequestFilter.CS_SHIFTID_KEY, new ID(id));</span>
		}
<span class="nc" id="L636">	}</span>

	public void setCsExtension(String id) {
<span class="nc bnc" id="L639" title="All 2 branches missed.">		if (!StringUtil.isEmptyOrWhiteSpace(id)) {</span>
<span class="nc" id="L640">			m_rFilter.setKey(RequestFilter.CS_EXTID_KEY, new ID(id));</span>
		}
<span class="nc" id="L642">	}</span>

	public void setCsOvertime(String str) {
<span class="nc bnc" id="L645" title="All 2 branches missed.">		if (!StringUtil.isEmptyOrWhiteSpace(str)) {</span>
<span class="nc" id="L646">			m_rFilter.setKey(RequestFilter.CS_ISOT_KEY, str);</span>
		}
<span class="nc" id="L648">	}</span>

	/**
	 * Create Supervisor Drop Down
	 */
	public String createSupervisorDD() {
<span class="nc" id="L654">		List&lt;ID&gt; supervisorIDs = (List&lt;ID&gt;) m_rFilter.getValueForKey(RequestFilter.SUPERVISOR_KEY);</span>
<span class="nc bnc" id="L655" title="All 2 branches missed.">		String selectedValue = supervisorIDs != null ? supervisorIDs.get(0).toString() : &quot;&quot;;</span>

<span class="nc" id="L657">		ArrayList orderedNames = new ArrayList();</span>
<span class="nc bnc" id="L658" title="All 2 branches missed.">		for (Iterator it1 = m_supervisorList.iterator(); it1.hasNext();) {</span>
<span class="nc" id="L659">			EmployeeName eName = (EmployeeName) it1.next();</span>
<span class="nc" id="L660">			String label = m_localizer.formatName(eName);</span>
<span class="nc" id="L661">			String value = eName.getID().toString();</span>
<span class="nc" id="L662">			orderedNames.add(new StringsPair(value, label));</span>
<span class="nc" id="L663">		}</span>
		// sort supervisor names ASC
<span class="nc" id="L665">		Collections.sort(orderedNames);</span>

<span class="nc" id="L667">		List options = new ArrayList();</span>
<span class="nc bnc" id="L668" title="All 2 branches missed.">		for (Iterator it2 = orderedNames.iterator(); it2.hasNext();) {</span>
<span class="nc" id="L669">			StringsPair option = (StringsPair) it2.next();</span>
<span class="nc" id="L670">			options.add(option);</span>
<span class="nc" id="L671">		}</span>

<span class="nc" id="L673">		insertAllToOptions(options);</span>
<span class="nc" id="L674">		return HtmlUtil.makeSelectInput(SUPERVISOR_FN, selectedValue, JSUtil.ON_CHANGE, options);</span>
	}

	/**
	 * Create Time Off Pool Drop Down
	 */
	public String createPoolDD() {
<span class="nc" id="L681">		ID poolID = (ID) m_rFilter.getValueForKey(RequestFilter.TOPOOL_KEY);</span>
<span class="nc bnc" id="L682" title="All 2 branches missed.">		String selectedValue = poolID != null ? poolID.toString() : &quot;&quot;;</span>

<span class="nc" id="L684">		ArrayList orderedNames = new ArrayList();</span>
<span class="nc bnc" id="L685" title="All 2 branches missed.">		for (Iterator it1 = m_poolList.iterator(); it1.hasNext();) {</span>
<span class="nc" id="L686">			TOPool pool = (TOPool) it1.next();</span>
<span class="nc" id="L687">			String label = pool.getName();</span>
<span class="nc" id="L688">			String value = pool.getID().toString();</span>
<span class="nc" id="L689">			orderedNames.add(new StringsPair(value, label));</span>
<span class="nc" id="L690">		}</span>
		// sort pool names ASC
<span class="nc" id="L692">		Collections.sort(orderedNames);</span>

<span class="nc" id="L694">		List options = new ArrayList();</span>
<span class="nc bnc" id="L695" title="All 2 branches missed.">		for (Iterator it2 = orderedNames.iterator(); it2.hasNext();) {</span>
<span class="nc" id="L696">			StringsPair option = (StringsPair) it2.next();</span>
<span class="nc" id="L697">			options.add(option);</span>
<span class="nc" id="L698">		}</span>

<span class="nc" id="L700">		insertAllToOptions(options);</span>
<span class="nc" id="L701">		return HtmlUtil.makeSelectInput(TO_POOL_FN, selectedValue, JSUtil.ON_CHANGE, options);</span>
	}

	/**
	 * Creates Time Off Bid Drop Down
	 * 
	 * @return HTML create display the drop down
	 */
	public String createTimeOffBidDD() {
<span class="nc" id="L710">		ID bidID = (ID) m_rFilter.getValueForKey(RequestFilter.TOBID_KEY);</span>
<span class="nc bnc" id="L711" title="All 2 branches missed.">		String selectedValue = bidID != null ? bidID.toString() : &quot;&quot;;</span>

<span class="nc" id="L713">		List orderedNames = new ArrayList();</span>
<span class="nc bnc" id="L714" title="All 2 branches missed.">		for (Iterator it1 = bidList.iterator(); it1.hasNext();) {</span>
<span class="nc" id="L715">			TimeOffBid bid = (TimeOffBid) it1.next();</span>
<span class="nc" id="L716">			String label = bid.getName();</span>
<span class="nc" id="L717">			String value = bid.getID().toString();</span>
<span class="nc" id="L718">			orderedNames.add(new StringsPair(value, label));</span>
<span class="nc" id="L719">		}</span>

		// sort pool names ASC
<span class="nc" id="L722">		Collections.sort(orderedNames);</span>

<span class="nc" id="L724">		List options = new ArrayList();</span>
<span class="nc bnc" id="L725" title="All 2 branches missed.">		for (Iterator it2 = orderedNames.iterator(); it2.hasNext();) {</span>
<span class="nc" id="L726">			StringsPair option = (StringsPair) it2.next();</span>
<span class="nc" id="L727">			options.add(option);</span>
<span class="nc" id="L728">		}</span>

<span class="nc" id="L730">		insertAllToOptions(options);</span>
<span class="nc" id="L731">		return HtmlUtil.makeSelectInput(TO_BID_FN, selectedValue, JSUtil.ON_CHANGE, options);</span>
	}

	/**
	 * Create Campaign Drop Down for the Custom Shift request filter
	 */
	public String createCampaignDD() {
<span class="nc" id="L738">		ID id = (ID) m_rFilter.getValueForKey(RequestFilter.CS_CAMPAIGNID_KEY);</span>
<span class="nc bnc" id="L739" title="All 2 branches missed.">		String selectedValue = id != null ? id.toString() : &quot;&quot;;</span>

<span class="nc" id="L741">		ArrayList orderedNames = new ArrayList();</span>
<span class="nc bnc" id="L742" title="All 2 branches missed.">		for (Iterator it = m_campaignList.iterator(); it.hasNext();) {</span>
<span class="nc" id="L743">			Campaign item = (Campaign) it.next();</span>
<span class="nc" id="L744">			String label = item.getName();</span>
<span class="nc" id="L745">			String value = item.getID().toString();</span>
<span class="nc" id="L746">			orderedNames.add(new StringsPair(value, label));</span>
<span class="nc" id="L747">		}</span>
		// sort shift names ASC
<span class="nc" id="L749">		Collections.sort(orderedNames);</span>

<span class="nc" id="L751">		List options = new ArrayList();</span>
<span class="nc bnc" id="L752" title="All 2 branches missed.">		for (Iterator it = orderedNames.iterator(); it.hasNext();) {</span>
<span class="nc" id="L753">			StringsPair option = (StringsPair) it.next();</span>
<span class="nc" id="L754">			options.add(option);</span>
<span class="nc" id="L755">		}</span>

<span class="nc" id="L757">		insertAllToOptions(options);</span>
<span class="nc" id="L758">		return HtmlUtil.makeSelectInput(CS_CAMPAIGN_FN, selectedValue, JSUtil.ON_CHANGE, options);</span>
	}

	/**
	 * Create Shift Drop Down for the Custom Shift and Flex Time request filters
	 */
	public String createShiftDD() {
<span class="nc" id="L765">		ID id = (ID) m_rFilter.getValueForKey(RequestFilter.CS_SHIFTID_KEY);</span>
<span class="nc bnc" id="L766" title="All 2 branches missed.">		String selectedValue = id != null ? id.toString() : &quot;&quot;;</span>

<span class="nc" id="L768">		ArrayList orderedNames = new ArrayList();</span>
<span class="nc bnc" id="L769" title="All 2 branches missed.">		for (Iterator it = m_shiftIDNamesMap.entrySet().iterator(); it.hasNext();) {</span>
<span class="nc" id="L770">			Entry&lt;ID, String&gt; entry = (Entry&lt;ID, String&gt;) it.next();</span>
<span class="nc" id="L771">			String value = entry.getKey().toString();</span>
<span class="nc" id="L772">			String label = entry.getValue();</span>
<span class="nc" id="L773">			orderedNames.add(new StringsPair(value, label));</span>
<span class="nc" id="L774">		}</span>
		// sort shift names ASC
<span class="nc" id="L776">		Collections.sort(orderedNames);</span>

<span class="nc" id="L778">		List options = new ArrayList();</span>
<span class="nc bnc" id="L779" title="All 2 branches missed.">		for (Iterator it = orderedNames.iterator(); it.hasNext();) {</span>
<span class="nc" id="L780">			StringsPair option = (StringsPair) it.next();</span>
<span class="nc" id="L781">			options.add(option);</span>
<span class="nc" id="L782">		}</span>

<span class="nc" id="L784">		insertAllToOptions(options);</span>
<span class="nc" id="L785">		return HtmlUtil.makeSelectInput(CS_SHIFT_FN, selectedValue, JSUtil.ON_CHANGE, options);</span>
	}

	/**
	 * Create Activity Drop Down for the Custom Shift and Flex Time request filters
	 */
	public String createActivityDD() {
<span class="nc" id="L792">		ID id = (ID) m_rFilter.getValueForKey(RequestFilter.CS_ACTIVITYID_KEY);</span>
<span class="nc bnc" id="L793" title="All 2 branches missed.">		String selectedValue = id != null ? id.toString() : &quot;&quot;;</span>

<span class="nc" id="L795">		ArrayList orderedNames = new ArrayList();</span>
<span class="nc bnc" id="L796" title="All 2 branches missed.">		for (Iterator it = m_activityList.iterator(); it.hasNext();) {</span>
<span class="nc" id="L797">			Activity item = (Activity) it.next();</span>
<span class="nc" id="L798">			String label = item.getName();</span>
<span class="nc" id="L799">			String value = item.getID().toString();</span>
<span class="nc" id="L800">			orderedNames.add(new StringsPair(value, label));</span>
<span class="nc" id="L801">		}</span>
		// sort shift names ASC
<span class="nc" id="L803">		Collections.sort(orderedNames);</span>

<span class="nc" id="L805">		List options = new ArrayList();</span>
<span class="nc bnc" id="L806" title="All 2 branches missed.">		for (Iterator it = orderedNames.iterator(); it.hasNext();) {</span>
<span class="nc" id="L807">			StringsPair option = (StringsPair) it.next();</span>
<span class="nc" id="L808">			options.add(option);</span>
<span class="nc" id="L809">		}</span>

<span class="nc" id="L811">		insertAllToOptions(options);</span>
<span class="nc" id="L812">		return HtmlUtil.makeSelectInput(CS_ACTIVITY_FN, selectedValue, JSUtil.ON_CHANGE, options);</span>
	}

	/**
	 * Create Extensions Drop Down for the Custom Shift request filter
	 */
	public String createExtensionDD() {
<span class="nc" id="L819">		ID id = (ID) m_rFilter.getValueForKey(RequestFilter.CS_EXTID_KEY);</span>
<span class="nc bnc" id="L820" title="All 2 branches missed.">		String selectedValue = id != null ? id.toString() : &quot;&quot;;</span>

<span class="nc" id="L822">		ArrayList orderedNames = new ArrayList();</span>
<span class="nc bnc" id="L823" title="All 2 branches missed.">		for (Iterator it = m_extIDNamesMap.entrySet().iterator(); it.hasNext();) {</span>
<span class="nc" id="L824">			Entry&lt;ID, String&gt; entry = (Entry&lt;ID, String&gt;) it.next();</span>
<span class="nc" id="L825">			String value = entry.getKey().toString();</span>
<span class="nc" id="L826">			String label = entry.getValue();</span>
<span class="nc" id="L827">			orderedNames.add(new StringsPair(value, label));</span>
<span class="nc" id="L828">		}</span>

		// sort shift names ASC
<span class="nc" id="L831">		Collections.sort(orderedNames);</span>

<span class="nc" id="L833">		List options = new ArrayList();</span>
<span class="nc bnc" id="L834" title="All 2 branches missed.">		for (Iterator it = orderedNames.iterator(); it.hasNext();) {</span>
<span class="nc" id="L835">			StringsPair option = (StringsPair) it.next();</span>
<span class="nc" id="L836">			options.add(option);</span>
<span class="nc" id="L837">		}</span>

<span class="nc" id="L839">		insertAllToOptions(options);</span>
<span class="nc" id="L840">		return HtmlUtil.makeSelectInput(CS_EXTENSION_FN, selectedValue, JSUtil.ON_CHANGE, options);</span>
	}

	/**
	 * Create Status Drop Down
	 */
	public String createStatusDD() {
<span class="nc" id="L847">		List options = RequestsFilterUtil.createStatusOptions(m_reqStatusList, m_localizer);</span>
<span class="nc" id="L848">		insertAllToOptions(options);</span>
<span class="nc" id="L849">		return createDD(STATUS_FN, RequestFilter.STATUS_KEY, options);</span>
	}

	/**
	 * Create Time Off Length Drop Down
	 */
	public String createTimeOffChoiceDD() {
<span class="nc" id="L856">		List options = new ArrayList(2);</span>

<span class="nc" id="L858">		String allChoiceLabel = i18n(m_common_bundle, UIFWebBundleKey.ALL);</span>
<span class="nc" id="L859">		options.add(new StringsPair(RequestFilter.ALL_TO_CHOICES, allChoiceLabel));</span>

<span class="nc" id="L861">		String firstChoiceLabel = i18n(m_common_bundle, UIFWebBundleKey.FIRST_ONLY);</span>
<span class="nc" id="L862">		options.add(new StringsPair(RequestFilter.FIRST_ONLY_TO_CHOICE, firstChoiceLabel));</span>

<span class="nc" id="L864">		return createDD(TO_NUM_CHOICE_FN, RequestFilter.TO_NUMBER_OF_CHOICES_KEY, options);</span>
	}

	/**
	 * Create Shift Swap Type Drop Down
	 */
	public String createShiftSwapTypeDD() {
<span class="nc" id="L871">		List options = new ArrayList(2);</span>

<span class="nc" id="L873">		String twoWayLabel = i18n(m_bundle, RmWebBundleKey.SWAPTYPE_TWOWAY);</span>
<span class="nc" id="L874">		options.add(new StringsPair(ShiftSwapRequest.SHIFTSWAP_TYPE_TWOWAY, twoWayLabel));</span>

<span class="nc" id="L876">		String oneWayLabel = i18n(m_bundle, RmWebBundleKey.SWAPTYPE_ONEWAY);</span>
<span class="nc" id="L877">		options.add(new StringsPair(ShiftSwapRequest.SHIFTSWAP_TYPE_ONEWAY, oneWayLabel));</span>

<span class="nc" id="L879">		insertAllToOptions(options);</span>
<span class="nc" id="L880">		return createDD(SS_TYPE_FN, RequestFilter.SWAP_TYPE_KEY, options);</span>
	}

	/**
	 * Create Custom Shift sub-Type Drop Down (New Shift/Shift Change)
	 */
	public String createCustShiftTypeDD() {
<span class="nc" id="L887">		List options = new ArrayList(2);</span>

<span class="nc" id="L889">		String newShiftLabel = i18n(m_bundle, RmWebBundleKey.CSR_SUBTYPE_NEW_SHIFT);</span>
<span class="nc" id="L890">		options.add(new StringsPair(CustShiftReq.CS_SUBTYPE_NEW_SHIFT, newShiftLabel));</span>

<span class="nc" id="L892">		String shiftChangeLabel = i18n(m_bundle, RmWebBundleKey.CSR_SUBTYPE_SHIFT_CHANGE);</span>
<span class="nc" id="L893">		options.add(new StringsPair(CustShiftReq.CS_SUBTYPE_SHIFT_CHANGE, shiftChangeLabel));</span>

<span class="nc" id="L895">		insertAllToOptions(options);</span>
<span class="nc" id="L896">		return createDD(CS_SUBTYPE_FN, RequestFilter.CS_SUBTYPE_KEY, options);</span>
	}

	/**
	 * Create Overtime Drop Down (Yes/No)
	 */
	public String createOvertimeDD() {
<span class="nc" id="L903">		List options = new ArrayList(2);</span>

<span class="nc" id="L905">		String yesLabel = i18n(m_bundle, RmWebBundleKey.YES);</span>
<span class="nc" id="L906">		options.add(new StringsPair(CustShiftReq.CS_OVERTIME_YES, yesLabel));</span>

<span class="nc" id="L908">		String noLabel = i18n(m_bundle, RmWebBundleKey.NO);</span>
<span class="nc" id="L909">		options.add(new StringsPair(CustShiftReq.CS_OVERTIME_NO, noLabel));</span>

<span class="nc" id="L911">		insertAllToOptions(options);</span>
<span class="nc" id="L912">		return createDD(CS_OVERTIME_FN, RequestFilter.CS_ISOT_KEY, options);</span>
	}

	/**
	 * Set Shif Swap Skills IDs
	 */
	public void setSsSkills(ID[] ids) {
<span class="nc bnc" id="L919" title="All 2 branches missed.">		if (ids != null) {</span>
<span class="nc" id="L920">			List idList = Arrays.asList(ids);</span>
<span class="nc" id="L921">			m_rFilter.setKey(RequestFilter.SWAP_SKILLS_KEY, (Serializable) idList);</span>
		}
<span class="nc" id="L923">	}</span>

	/**
	 * Create Shift Swap Skills Drop Down
	 */
	public String createShiftSwapSkillDD() {
<span class="nc" id="L929">		Collection skillIDs = (Collection) m_rFilter.getValueForKey(RequestFilter.SWAP_SKILLS_KEY);</span>
<span class="nc" id="L930">		String[] selectedValue = StringUtil.createStringArrayFromIDs(skillIDs);</span>

<span class="nc" id="L932">		List options = new ArrayList();</span>
<span class="nc bnc" id="L933" title="All 2 branches missed.">		for (Iterator it = m_skillList.iterator(); it.hasNext();) {</span>
<span class="nc" id="L934">			Skill skill = (Skill) it.next();</span>

<span class="nc" id="L936">			String label = skill.getName();</span>
<span class="nc" id="L937">			String value = skill.getID().toString();</span>
<span class="nc" id="L938">			options.add(new StringsPair(value, label));</span>
<span class="nc" id="L939">		}</span>

<span class="nc" id="L941">		boolean isMultiple = true;</span>
<span class="nc" id="L942">		insertAllToOptions(options);</span>
<span class="nc" id="L943">		return HtmlUtil.makeSelectInput(SS_SKILLS_FN, selectedValue, JSUtil.ON_CHANGE, options, isMultiple, true);</span>
	}

	/**
	 * Insert All Option into Options List
	 */
	protected void insertAllToOptions(List options) {
<span class="nc" id="L950">		options.add(0, m_allOption);</span>
<span class="nc" id="L951">	}</span>

	// ////////////////////////////////////////////////////////////////////////////
	// The following are date helper methods
	// ////////////////////////////////////////////////////////////////////////////
	/**
	 * Initialize Date
	 */
	protected void initDate(String fn) {
<span class="nc" id="L960">		m_datePC.reset();</span>
<span class="nc" id="L961">		m_datePC.setDateInputFieldName(fn);</span>

<span class="nc" id="L963">		m_datePC.setIsDateValueOptional(true);</span>
<span class="nc" id="L964">		m_datePC.setIsTimeEnabled(true);</span>
<span class="nc" id="L965">	}</span>

	/**
	 * Extract Date Parameter
	 */
	protected Date extractDate(HttpServletRequest request, String fn, String key) {
<span class="nc" id="L971">		initDate(fn);</span>

<span class="nc" id="L973">		m_datePC.extractParameters(request);</span>
<span class="nc" id="L974">		Date date = m_datePC.getDate();</span>
<span class="nc bnc" id="L975" title="All 2 branches missed.">		if (date != null)</span>
<span class="nc" id="L976">			m_rFilter.setKey(key, date);</span>
<span class="nc" id="L977">		return date;</span>
	}

	/**
	 * Extract String Parameter
	 */
	protected void extractString(HttpServletRequest request, String fn, String key) {
<span class="nc" id="L984">		String value = request.getParameter(fn);</span>
<span class="nc bnc" id="L985" title="All 2 branches missed.">		if (value != null) {</span>
<span class="nc" id="L986">			m_rFilter.setKey(key, value);</span>
		}
<span class="nc" id="L988">	}</span>

	/**
	 * Initialize Date Range
	 */
	protected void initDateRange(String fn) {
<span class="nc" id="L994">		m_dateRangePC.reset();</span>
<span class="nc" id="L995">		m_dateRangePC.setDateInputFieldName(fn);</span>

<span class="nc" id="L997">		m_dateRangePC.getStartDatePickerPC().setIsDateValueOptional(true);</span>
<span class="nc" id="L998">		m_dateRangePC.getStartDatePickerPC().setIsTimeEnabled(true);</span>

<span class="nc" id="L1000">		m_dateRangePC.getEndDatePickerPC().setIsDateValueOptional(true);</span>
<span class="nc" id="L1001">		m_dateRangePC.getEndDatePickerPC().setIsTimeEnabled(true);</span>

<span class="nc" id="L1003">		limitDateRangePicker(); // make selectable +/- 30years</span>
<span class="nc" id="L1004">	}</span>

	/**
	 * Extract Date Parameters
	 */
	protected void extractDateRange(HttpServletRequest request, String fn, String key) {
<span class="nc" id="L1010">		initDateRange(fn);</span>

<span class="nc" id="L1012">		m_dateRangePC.extractParameters(request);</span>
<span class="nc" id="L1013">		Date sDate = m_dateRangePC.getStartDatePickerPC().getDate();</span>
<span class="nc" id="L1014">		Date eDate = m_dateRangePC.getEndDatePickerPC().getDate();</span>
<span class="nc bnc" id="L1015" title="All 4 branches missed.">		if (sDate != null &amp;&amp; eDate != null) {</span>
<span class="nc" id="L1016">			List dates = new ArrayList(2);</span>
<span class="nc" id="L1017">			dates.add(sDate);</span>
<span class="nc" id="L1018">			dates.add(eDate);</span>
<span class="nc" id="L1019">			m_rFilter.setKey(key, (Serializable) dates);</span>
		}
<span class="nc" id="L1021">	}</span>

	/**
	 * Create Date Range with specified Field Name and Request Key
	 */
	protected String createDateRange(String fn, String key) {
<span class="nc" id="L1027">		initDateRange(fn);</span>

<span class="nc" id="L1029">		List dates = (List) m_rFilter.getValueForKey(key);</span>
<span class="nc bnc" id="L1030" title="All 4 branches missed.">		if (dates != null &amp;&amp; !dates.isEmpty()) {</span>
<span class="nc" id="L1031">			Date sDate = (Date) dates.get(0);</span>
<span class="nc" id="L1032">			Date eDate = (Date) dates.get(1);</span>
<span class="nc" id="L1033">			m_dateRangePC.getStartDatePickerPC().setDate(sDate);</span>
<span class="nc" id="L1034">			m_dateRangePC.getEndDatePickerPC().setDate(eDate);</span>
		}

<span class="nc" id="L1037">		m_dateRangePC.initForDisplay();</span>
<span class="nc" id="L1038">		return m_dateRangePC.getHtmlDisplay();</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>