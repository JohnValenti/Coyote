<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>TRDayDetailPC.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.am.timerecords</a> &gt; <span class="el_source">TRDayDetailPC.java</span></div><h1>TRDayDetailPC.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.am.timerecords;

import java.text.MessageFormat;
import java.util.ArrayList;
import java.util.Collection;

import com.bluepumpkin.web.am.keys.AmJavaScriptFileID;
import com.bluepumpkin.web.am.l10n.AmWebBundleKey;
import com.witness.web.uif.jsp.HtmlDiv;
import com.witness.web.uif.jsp.HtmlElement;
import com.witness.web.uif.keys.JavaScriptFileID;
import com.witness.web.uif.pagecomponent.BaseNodeData;
import com.witness.web.uif.pagecomponent.CompositePC;
import com.witness.web.uif.pagecomponent.list.MultiColListPC;
import com.witness.web.uif.pagecomponent.toolbar.ToolbarPC;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.util.HtmlUtil;
import com.witness.web.uif.util.html.CSSUtil;

/**
 * Title:
 * Description:
 * Copyright:    Copyright (c) 2001
 * Company:      Blue Pumpkin Software, Inc
 * @author
 * @version 1.0
 */
public class TRDayDetailPC extends CompositePC{
	private static final String TABLE_BORDER_OPEN_TAG
		= &quot;&lt;table style=\&quot;width: 100%; &quot; + CSSUtil.STYLE_BORDER + &quot;\&quot; cellpadding=\&quot;0\&quot; cellspacing=\&quot;0\&quot;&gt;&quot;;

	private static final String ADD_CHILD_TEMPLATE = &quot;{0}.addPairChild({1}, {2}, {3}); \n&quot;;
	private static final String MAIN_TOOLBAR_NAME = &quot;_mtb&quot;;
	private MultiColListPC m_multiColListPC;
	private ToolbarPC m_mainTB_PC;
	private ToolbarPC m_toolbarPC1;
	private ToolbarPC m_toolbarPC2;
	private ToolbarPC m_toolbarExceptions;
	private ToolbarPC m_toolbarAdjustments;
	private String m_comments;
	private String m_remarkEmployeeStr;
<span class="nc" id="L42">	private String complianceModeTitle = &quot;&quot;;</span>
	private int m_height;
	private boolean m_isSummary;
	private boolean m_needExpSummary;
	private String m_colspan;
	private boolean m_needExceptions;

	// Keep track of Previous Toolbars and Tables
<span class="nc" id="L50">	private ArrayList m_prevToolbars = new ArrayList();</span>
<span class="nc" id="L51">	private ArrayList m_prevLists = new ArrayList();</span>

	/**
	 * Constructor
	 *
	 * @param context The RequestContext
	 */
	public TRDayDetailPC(RequestContext context) {
<span class="nc" id="L59">		super(context);</span>

<span class="nc" id="L61">		initMultiColList();</span>
<span class="nc" id="L62">		initMainTB();</span>

<span class="nc" id="L64">		addRequiredJavaScriptFile(JavaScriptFileID.MEDIATOR_CONTAINED_LIST);</span>
<span class="nc" id="L65">		setJSMediator(AmJavaScriptFileID.MEDIATOR_TR_CONTAINED_LIST);</span>
<span class="nc" id="L66">	}</span>

	/**
	 * Initialize Main Toolbar
	 */
	private void initMainTB() {
<span class="nc" id="L72">		m_mainTB_PC = getNewToolbar();</span>
<span class="nc" id="L73">		addChildComponent(m_mainTB_PC);</span>

<span class="nc" id="L75">		ToolbarPC tmpTB = new ToolbarPC(m_context);</span>
<span class="nc" id="L76">		setFirstTB(tmpTB);</span>
<span class="nc" id="L77">		setSecondTB(tmpTB);</span>
<span class="nc" id="L78">		setExceptionsTB(tmpTB);</span>
<span class="nc" id="L79">		setAdjustmentsTB(tmpTB);</span>
<span class="nc" id="L80">	}</span>

	/**
	 * Return new Toolbar
	 */
	private ToolbarPC getNewToolbar() {
<span class="nc" id="L86">		ToolbarPC tb = new ToolbarPC(m_context);</span>
<span class="nc" id="L87">		tb.setName(getName() + MAIN_TOOLBAR_NAME);</span>
<span class="nc" id="L88">		m_prevToolbars.add(tb);</span>
<span class="nc" id="L89">		return tb;</span>
	}

	/**
	 * Return Main Toolbar
	 */
	public ToolbarPC getMainTB() {
<span class="nc" id="L96">		return m_mainTB_PC;</span>
	}

	/**
	 * Set Name
	 */
	public void setName(String name) {
<span class="nc" id="L103">		super.setName(name);</span>

<span class="nc" id="L105">		m_mainTB_PC.setName(name + MAIN_TOOLBAR_NAME);</span>
<span class="nc" id="L106">		updateListName(m_multiColListPC, name);</span>
<span class="nc" id="L107">		updateFirstToolbarName(m_toolbarPC1, name);</span>
<span class="nc" id="L108">		updateSecondToolbarName(m_toolbarPC2, name);</span>
<span class="nc" id="L109">		updateAdjustmentsToolbarName(m_toolbarAdjustments, name);</span>
<span class="nc" id="L110">		updateExceptionsToolbarName(m_toolbarExceptions, name);</span>
<span class="nc" id="L111">	}</span>

	/**
	 * Set height of the HTML display in pixesl
	 */
	public void setHeightInPixels(int height) {
<span class="nc" id="L117">		m_height = height;</span>
<span class="nc" id="L118">	}</span>

	/**
	 * Return height of the HTML display in pixesl
	 */
	public int getHeightInPixels() {
<span class="nc" id="L124">		return m_height;</span>
	}

	/**
	 * Set MultiColList
	 */
	private void initMultiColList() {
<span class="nc" id="L131">		m_multiColListPC = getNewMultiColListPC();</span>
<span class="nc" id="L132">		addChildComponent(m_multiColListPC);</span>
<span class="nc" id="L133">	}</span>

	/**
	 * Return new MultiColListPC
	 */
	private MultiColListPC getNewMultiColListPC() {
<span class="nc" id="L139">		MultiColListPC list = null;</span>
<span class="nc bnc" id="L140" title="All 2 branches missed.">		if (!isAccessibilityComplianceMode()) {</span>
<span class="nc" id="L141">			list = new MultiColListPC(m_context, false);</span>
		} else {
<span class="nc" id="L143">			list = new MultiColListPC(m_context, false) {</span>
				@Override
				protected HtmlDiv getNewHtmlDiv() {
<span class="nc" id="L146">					HtmlDiv wrapper = super.getNewHtmlDiv();</span>
<span class="nc" id="L147">					wrapper.setAttribute(ATTR_ARIA_LABEL, getLocalizer().i18n(AmWebBundleKey.BUNDLE_NAME,</span>
							AmWebBundleKey.AM_TIME_DAYDETAILS_ENTRY_GRID));
<span class="nc" id="L149">					return wrapper;</span>
				}
				
				@Override
				protected boolean skipEncloseForKeyboardAccess(BaseNodeData nodeData) {
<span class="nc" id="L154">					return false;</span>
				}
			};
<span class="nc" id="L157">			list.setReadableRowInfoEnabled(true);</span>
<span class="nc" id="L158">			list.setRenderJavaScriptIfDisabled(true);</span>
		}
<span class="nc" id="L160">		m_prevLists.add(list);</span>
<span class="nc" id="L161">		updateListName(list, getName());</span>
<span class="nc" id="L162">		return list;</span>
	}

	/**
	 * Return MultiColList
	 */
	public MultiColListPC getMultiColList() {
<span class="nc" id="L169">		return m_multiColListPC;</span>
	}

	/**
	 * Set the first toolbar
	 */
	public void setFirstTB(ToolbarPC firstTB) {
<span class="nc" id="L176">		m_toolbarPC1 = firstTB;</span>

<span class="nc" id="L178">		updateFirstToolbarName(m_toolbarPC1, getName());</span>
<span class="nc" id="L179">	}</span>

	/**
	 * Return the first toolbar
	 */
	public ToolbarPC getFirstTB() {
<span class="nc" id="L185">		return m_toolbarPC1;</span>
	}

	/**
	 * Set the second toolbar
	 */
	public void setSecondTB(ToolbarPC secondTB) {
<span class="nc" id="L192">		m_toolbarPC2 = secondTB;</span>

<span class="nc" id="L194">		updateSecondToolbarName(m_toolbarPC2, getName());</span>
<span class="nc" id="L195">	}</span>

	/**
	 * Return the secondst toolbar
	 */
	public ToolbarPC getSecondTB() {
<span class="nc" id="L201">		return m_toolbarPC2;</span>
	}

	/**
	 * Set the exceptions toolbar
	 */
	public void setExceptionsTB(ToolbarPC exceptionsTB) {
<span class="nc" id="L208">		m_toolbarExceptions = exceptionsTB;</span>

<span class="nc" id="L210">		updateExceptionsToolbarName(m_toolbarExceptions, getName());</span>
<span class="nc" id="L211">	}</span>

	/**
	 * Return the exceptions toolbar
	 */
	public ToolbarPC getExceptionsTB() {
<span class="nc" id="L217">		return m_toolbarExceptions;</span>
	}

	/**
	 * Set the adjustments toolbar
	 */
	public void setAdjustmentsTB(ToolbarPC exceptionsTB) {
<span class="nc" id="L224">		m_toolbarAdjustments = exceptionsTB;</span>

<span class="nc" id="L226">		updateAdjustmentsToolbarName(m_toolbarAdjustments, getName());</span>
<span class="nc" id="L227">	}</span>

	/**
	 * Return the adjustments toolbar
	 */
	public ToolbarPC getAdjustmentsTB() {
<span class="nc" id="L233">		return m_toolbarAdjustments;</span>
	}

	/**
	 * Set the comments text
	 */
	public void setComments(String comments) {
<span class="nc" id="L240">		m_comments = comments;</span>
<span class="nc" id="L241">	}</span>

	/**
	 * Return the comments
	 */
	public String getComments() {
<span class="nc" id="L247">		return m_comments;</span>
	}

	/**
	 * Set the remarkEmployeeStr
	 */
	public void setRemarkEmployeeStr(String remarkEmployeeStr) {
<span class="nc" id="L254">		m_remarkEmployeeStr = remarkEmployeeStr;</span>
<span class="nc" id="L255">	}</span>

	/**
	 * Return the remarkEmployeeStr
	 */
	public String getRemarkEmployeeStr() {
<span class="nc" id="L261">		return m_remarkEmployeeStr;</span>
	}

	/**
	 * Set boolean for summary/day detail
	 */
	public void setIsSummary(boolean isSummary) {
<span class="nc" id="L268">		m_isSummary = isSummary;</span>
<span class="nc" id="L269">	}</span>

	/**
	 * Return the isSummary
	 */
	public boolean getIsSummary() {
<span class="nc" id="L275">		return m_isSummary;</span>
	}

	/**
	 * Set boolean for need of expanded summary detail
	 */
	public void setNeedExpSummary(boolean needExpSummary) {
<span class="nc" id="L282">		m_needExpSummary = needExpSummary;</span>
<span class="nc" id="L283">	}</span>

	/**
	 * Return the needExpSummary
	 */
	public boolean getNeedExpSummary() {
<span class="nc" id="L289">		return m_needExpSummary;</span>
	}

	/**
	 * Set boolean for exceptions display
	 */
	public void setNeedExceptions(boolean needExceptions) {
<span class="nc" id="L296">		m_needExceptions = needExceptions;</span>
<span class="nc" id="L297">	}</span>

	/**
	 * Return the boolean
	 */
	public boolean getNeedExceptions() {
<span class="nc" id="L303">		return m_needExceptions;</span>
	}

	/**
	 * Set String for colspan
	 */
	public void setColspan(String colspan) {
<span class="nc" id="L310">		m_colspan = colspan;</span>
<span class="nc" id="L311">	}</span>

	/**
	 * Return the colspan
	 */
	public String getColspan() {
<span class="nc" id="L317">		return m_colspan;</span>
	}

	// Update Multi Column List  Name to be in sync with parent component
	private static void updateListName(MultiColListPC list, String parentName) {
<span class="nc" id="L322">		list.setName(parentName + &quot;_t&quot;);</span>
<span class="nc" id="L323">	}</span>

	// Update first toolbar name to be in sync with parent component
	private static void updateFirstToolbarName(ToolbarPC toolbar, String parentName) {
<span class="nc" id="L327">		toolbar.setName(parentName + MAIN_TOOLBAR_NAME);</span>
<span class="nc" id="L328">	}</span>

	// Update second toolbar name Name to be in sync with parent component
	private static void updateSecondToolbarName(ToolbarPC toolbar, String parentName) {
<span class="nc" id="L332">		toolbar.setName(parentName + MAIN_TOOLBAR_NAME);</span>
<span class="nc" id="L333">	}</span>

	// Update exceptions toolbar name Name to be in sync with parent component
	private static void updateExceptionsToolbarName(ToolbarPC toolbar, String parentName) {
<span class="nc" id="L337">		toolbar.setName(parentName + MAIN_TOOLBAR_NAME);</span>
<span class="nc" id="L338">	}</span>

	// Update adjustments toolbar name Name to be in sync with parent component
	private static void updateAdjustmentsToolbarName(ToolbarPC toolbar, String parentName) {
<span class="nc" id="L342">		toolbar.setName(parentName + MAIN_TOOLBAR_NAME);</span>
<span class="nc" id="L343">	}</span>

	/**
	 * Return JavaScript Init Code
	 */
	public String getJavaScriptInitCode() {
<span class="nc" id="L349">		return super.getCompositeJavaScriptInitCode() + &quot;\n&quot;</span>
<span class="nc" id="L350">					 + getJSChildsAssociation() + &quot;\n&quot;;</span>
	}

	/**
	 * Return the code which associates Child components
	 */
	private String getJSChildsAssociation() {
<span class="nc" id="L357">		StringBuffer sb = new StringBuffer(500);</span>
<span class="nc" id="L358">		String mediatorName = getNamePrefix()+getName();</span>
<span class="nc" id="L359">		int i=0;</span>

		// Append JS Object for Previous Components
<span class="nc bnc" id="L362" title="All 2 branches missed.">		for(i=0; i &lt; m_prevLists.size(); i++) {</span>
<span class="nc" id="L363">			MultiColListPC list = (MultiColListPC)m_prevLists.get(i);</span>
<span class="nc" id="L364">			ToolbarPC tb = (ToolbarPC)m_prevToolbars.get(i);</span>
<span class="nc" id="L365">			appendChildJSCode(sb, mediatorName, list, tb, i);</span>
		}

<span class="nc" id="L368">		return sb.toString();</span>
	}

	/**
	 * Append Child JS association code
	 */
	private void appendChildJSCode(StringBuffer sb, String mediatorName, MultiColListPC list, ToolbarPC tb, int index) {
		// Determine whether to Turn Off MutliColListPC's javascript
<span class="nc" id="L376">		Collection listModel = list.getListModel();</span>
<span class="nc bnc" id="L377" title="All 4 branches missed.">		if (listModel==null || listModel.isEmpty()) list.setEnabled(false);</span>

		// Create Component JS Object
<span class="nc" id="L380">		sb.append(list.getJavaScriptInitCode());</span>
<span class="nc" id="L381">		sb.append(tb.getJavaScriptInitCode());</span>

		// Associate JS Object to Mediator
<span class="nc bnc" id="L384" title="All 2 branches missed.">		String listName = list.isEnabled()?list.getName():&quot;null&quot;;</span>
<span class="nc" id="L385">		String tbName = tb.getName();</span>
<span class="nc" id="L386">		Object[] args = new Object[]{mediatorName, listName, tbName, Integer.toString(index)};</span>
<span class="nc" id="L387">		sb.append(MessageFormat.format(ADD_CHILD_TEMPLATE, args)).append(&quot;\n&quot;);</span>
<span class="nc" id="L388">	}</span>

	/**
	 * Reset Component for Reuse.
	 *
	 * NOTE: only main to be reused for same contained list
	 */
	public void resetForReUse() {
		// Create new ones
<span class="nc" id="L397">		m_multiColListPC = getNewMultiColListPC();</span>
<span class="nc" id="L398">		m_mainTB_PC = getNewToolbar();</span>

<span class="nc" id="L400">		m_remarkEmployeeStr = null;</span>
<span class="nc" id="L401">	}</span>
	
	public void setComplianceModeTitle(String title) {
<span class="nc" id="L404">		this.complianceModeTitle = title;</span>
<span class="nc" id="L405">	}</span>
	
	public String getComplianceModeTitle() {
<span class="nc" id="L408">		return this.complianceModeTitle;</span>
	}

	/**
	 * Return Html Display
	 */
	public String getHtmlDisplay() {
<span class="nc" id="L415">		StringBuilder htmlDisplay = new StringBuilder(5000);</span>

		// Determine whether height should be set
		// String heightProperty = (getHeightInPixels()==0)?&quot;&quot;: &quot;height:&quot; + getHeightInPixels() + &quot;px;&quot;;

		// Display Table Header and Table Content
<span class="nc" id="L421">		htmlDisplay.append(&quot;&lt;table width=\&quot;100%\&quot;&gt;&lt;tr&gt;&quot;);</span>
<span class="nc" id="L422">		htmlDisplay.append(&quot;&lt;td class=\&quot;listRowMedForm\&quot;&gt;&quot;);</span>

<span class="nc bnc" id="L424" title="All 2 branches missed.">		if (getIsSummary()){</span>
<span class="nc" id="L425">			htmlDisplay.append(TABLE_BORDER_OPEN_TAG);</span>
<span class="nc bnc" id="L426" title="All 2 branches missed.">			if (getNeedExceptions()){</span>
<span class="nc" id="L427">				htmlDisplay.append(&quot;&lt;tr&gt;&lt;td class=\&quot;ppListExceptionsCell\&quot;&gt;&quot;);</span>
<span class="nc" id="L428">				htmlDisplay.append(getExceptionsTB());</span>
<span class="nc" id="L429">				htmlDisplay.append(&quot;&lt;/td&gt;&lt;/tr&gt;&quot;);</span>
			}
<span class="nc" id="L431">			htmlDisplay.append(&quot;&lt;tr&gt;&lt;td class=\&quot;ppListExceptionsCell\&quot;&gt;&quot;);</span>
<span class="nc" id="L432">			htmlDisplay.append(getAdjustmentsTB());</span>
<span class="nc" id="L433">			htmlDisplay.append(&quot;&lt;/td&gt;&lt;/tr&gt;&quot;);</span>
<span class="nc" id="L434">			htmlDisplay.append(&quot;&lt;/table&gt;&lt;br&gt;\n&quot;);</span>
		}

<span class="nc bnc" id="L437" title="All 2 branches missed.">		if (getNeedExpSummary()){//to prevent showing summary if none in summary page</span>
<span class="nc" id="L438">			htmlDisplay.append(TABLE_BORDER_OPEN_TAG);</span>
<span class="nc" id="L439">			htmlDisplay.append(&quot;&lt;tr&gt;&lt;td&gt;&quot;);</span>
<span class="nc" id="L440">			htmlDisplay.append(getMultiColList());</span>
<span class="nc" id="L441">			htmlDisplay.append(&quot;&lt;/td&gt;&lt;/tr&gt;\n&quot;);</span>
<span class="nc bnc" id="L442" title="All 2 branches missed.">			if (!getIsSummary()){</span>
<span class="nc" id="L443">				htmlDisplay.append(&quot;&lt;tr&gt;&lt;td&gt;&quot;);</span>
<span class="nc" id="L444">				htmlDisplay.append(getFirstTB());</span>
<span class="nc" id="L445">				htmlDisplay.append(&quot;&lt;/td&gt;&lt;/tr&gt;\n&quot;);</span>
			}

<span class="nc bnc" id="L448" title="All 2 branches missed.">			if (!getIsSummary()){</span>
<span class="nc bnc" id="L449" title="All 2 branches missed.">				if (getRemarkEmployeeStr()!=null)</span>
<span class="nc" id="L450">					htmlDisplay.append(getRemarkEmployeeStr());</span>
<span class="nc" id="L451">				htmlDisplay.append(getComments());</span>
			}

<span class="nc" id="L454">			htmlDisplay.append(&quot;&lt;tr&gt;&lt;td&gt;&quot;);</span>
<span class="nc" id="L455">			htmlDisplay.append(getSecondTB());</span>
<span class="nc" id="L456">			htmlDisplay.append(&quot;&lt;/td&gt;&lt;/tr&gt;&quot;);</span>
<span class="nc" id="L457">			htmlDisplay.append(&quot;&lt;/table&gt;&quot;);</span>
		}
<span class="nc" id="L459">		htmlDisplay.append(&quot;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&quot;);</span>
		
<span class="nc bnc" id="L461" title="All 2 branches missed.">		if (isAccessibilityComplianceMode()) {</span>
<span class="nc" id="L462">			HtmlElement el = HtmlUtil.createAriaWrapper(&quot;dayDetailsEntryTable&quot;,</span>
					this.complianceModeTitle, &quot;&quot;, ATTR_VALUE_REGION, &quot;&quot;);
<span class="nc" id="L464">			el.setInnerHtml(htmlDisplay.toString());</span>
<span class="nc" id="L465">			htmlDisplay = new StringBuilder(el.toString());</span>
		}
<span class="nc" id="L467">		return htmlDisplay.toString();</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>