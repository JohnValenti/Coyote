<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>EditTimeRecordModel.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.am.timerecords</a> &gt; <span class="el_source">EditTimeRecordModel.java</span></div><h1>EditTimeRecordModel.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.am.timerecords;

import java.rmi.RemoteException;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.Collection;
import java.util.Date;
import java.util.Iterator;
import java.util.ResourceBundle;
import java.util.StringTokenizer;
import java.util.TimeZone;

import javax.servlet.http.HttpServletRequest;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.StringsPair;
import com.bluepumpkin.common.logging.Category;
import com.bluepumpkin.common.util.StringUtil;
import com.bluepumpkin.ejb.am.AmEJBCreateException;
import com.bluepumpkin.ejb.bbm.activity.model.Activity;
import com.bluepumpkin.ejb.bbm.activity.model.ActivityCategory;
import com.bluepumpkin.ejb.bbm.activity.model.ActivityGroup;
import com.bluepumpkin.ejb.bbm.timerecord.model.TimeRecord;
import com.bluepumpkin.ejb.bbm.timerecord.model.TimeRecordEntry;
import com.bluepumpkin.ejb.bbm.workresource.model.Organization;
import com.bluepumpkin.web.am.Log;
import com.bluepumpkin.web.am.l10n.AmWebBundleKey;
import com.bluepumpkin.web.am.l10n.AmWebLogBundleKey;
import com.bluepumpkin.web.am.util.JSPUtil;
import com.bluepumpkin.web.bbm.activity.ActivityModelHandler;
import com.witness.web.uif.base.UnableToLoadDataException;
import com.witness.web.uif.jsp.HtmlSelect;
import com.witness.web.uif.keys.JavaScriptFileID;
import com.witness.web.uif.keys.PageAction;
import com.witness.web.uif.l10n.UIFWebBundleKey;
import com.witness.web.uif.pagecomponent.picker.date.DatePickerPC;
import com.witness.web.uif.pagemodel.PopupWindowPM;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.util.HourMinInput;
import com.witness.web.uif.util.HtmlUtil;
import com.witness.web.uif.util.html.CSSUtil;
import com.witness.web.uif.util.html.HtmlChoiceInput;

/**
 * Title:        Blue Pumpkin Software Activity Management
 * Description:  Edit time record model
 * Copyright:    Copyright (c) 2001
 * Company:      Blue Pumpkin Software, Inc
 * @author       Swati Tewari
 * @version 1.0
 */

public class EditTimeRecordModel extends PopupWindowPM {

	public static final String MODEL_KEY = &quot;EditTimeRecordModel&quot;;
	public static final String EDITREMARK_ACTION = &quot;EDITREMARK_ACTION&quot;;
	public static final String OKEDITREMARK_ACTION = &quot;OKEDITREMARK_ACTION&quot;;
	public static final String INSERTTE_ACTION = &quot;INSERTTE_ACTION&quot;;
	public static final String DELETETE_ACTION = &quot;DELETETE_ACTION&quot;;
	public static final String REFRESHEDIT_ACTION = &quot;REFRESHEDIT_ACTION&quot;;
	public static final String EDITTE_ACTION = &quot;EDITTE_ACTION&quot;;
	public static final String CREATE_END_SHIFT = &quot;CREATE_END_SHIFT&quot;;
	public static final String REFRESHCREATE_END_SHIFT = &quot;REFRESHCREATE_END_SHIFT&quot;;
	public static final String REFRESHINSERT_ACTION = &quot;REFRESHINSERT_ACTION&quot;;
	public static final String OKENDSHIFT_ACTION = &quot;OKENDSHIFT_ACTION&quot;;
	public static final String OKDELETE_ACTION = &quot;OKDELETE_ACTION&quot;;
	public static final String OKEDIT_ACTION = &quot;OKEDIT_ACTION&quot;;
	public static final String OKINSERT_ACTION = &quot;OKINSERT_ACTION&quot;;
	public static final String DONE_ACTION = &quot;DONE_ACTION&quot;;

	// Page Actions
<span class="nc" id="L72">	private static Category cat = Log.initCategory(EditTimeRecordModel.class.getName());</span>
	private ResourceBundle m_bundle;
	private ID empId;
	private String tableContent;
	private String pageTitleText;
	private String popUpHeader;
<span class="nc" id="L78">	private ArrayList tableData = new ArrayList();</span>
<span class="nc" id="L79">	private TimeRecord timeRecord = null;</span>
<span class="nc" id="L80">	private Date date = new Date();</span>
	private String selectedID;
	private ID[] selectedIDs;
<span class="nc" id="L83">	private int curIndex = 0;</span>
	private ID orgId;
	private int durationHour;
	private int durationMinute;
	private boolean isPaid;
	private String comment;
<span class="nc" id="L89">	private int position = -1;</span>
	private ID recordID;
	private String timeZone;
	private long version;
<span class="nc" id="L93">	private ID entryID = new ID(-1);</span>
	private int rawTimeEntryId;
<span class="nc" id="L95">	private TimeRecordEntry anEntry = null;</span>
	private boolean rowToDelete;
<span class="nc" id="L97">	private Date curDate = null;</span>
<span class="nc" id="L98">	private String remarks = null;</span>
	private boolean isLastEntry;
	private boolean isFirstEntry;
	private long hiddenMillisecond;
	private int hiddenSecond;
	private boolean isOpenShift;

<span class="nc" id="L105">	ActivityGroup activityGroup = null;</span>
<span class="nc" id="L106">	private boolean m_isInitiated = false;</span>

	//activity related variables
<span class="nc" id="L109">	private ArrayList activityCategoryNameList = new ArrayList();</span>
<span class="nc" id="L110">	private ArrayList activityCategoryIDList = new ArrayList();</span>
<span class="nc" id="L111">	private ArrayList activityIDList = new ArrayList();</span>
<span class="nc" id="L112">	private ArrayList activityNameList = new ArrayList();</span>
	private ID activityList;
	private ID activityCategory;

	private DatePickerPC m_dateTimePickerPC;
<span class="nc" id="L117">    private Date m_date = new Date();</span>

	/**
	 * setHtmlDisplay
	 */
	public String getHtmlDisplay() {
		//return html for display
<span class="nc" id="L124">		StringBuilder htmlDisplay = new StringBuilder(5000);</span>

		//start another table
<span class="nc" id="L127">		htmlDisplay.append(&quot;&lt;table cellpadding=\&quot;0\&quot; cellspacing=\&quot;0\&quot; width=\&quot;100%\&quot; class=\&quot;popupTable&quot;);</span>

<span class="nc" id="L129">		setRegionForAccessibilityMode(htmlDisplay);</span>

		//closing table tag
<span class="nc" id="L132">		htmlDisplay.append(&quot;&gt;&quot;);</span>
		
		//get table header
<span class="nc" id="L135">		htmlDisplay.append(popUpHeader);</span>

		//get table content
<span class="nc" id="L138">		htmlDisplay.append(tableContent);</span>

		//end table
<span class="nc" id="L141">		htmlDisplay.append(&quot;&lt;/table&gt;&quot;);</span>

<span class="nc" id="L143">		return htmlDisplay.toString();</span>
	}

	private void setRegionForAccessibilityMode(StringBuilder builder) {
<span class="nc bnc" id="L147" title="All 2 branches missed.">		if (isAccessibilityComplianceMode()) {</span>
<span class="nc" id="L148">			String pageAction = getPageAction();</span>
<span class="nc" id="L149">			String tabbableAndRole = &quot; tabbable\&quot; &quot; + ATTR_ROLE_REGION + &quot; aria-label=\&quot;&quot;;</span>
			
<span class="nc bnc" id="L151" title="All 13 branches missed.">			switch (pageAction) {</span>
				case DELETETE_ACTION:
<span class="nc" id="L153">					builder.append(tabbableAndRole).append(m_localizer.i18n(m_bundle, AmWebBundleKey.DELETE_ENTRY_TEXT));</span>
<span class="nc" id="L154">					break;</span>
				case INSERTTE_ACTION:
				case EDITTE_ACTION:
<span class="nc" id="L157">					builder.append(tabbableAndRole).append(m_localizer.i18n(m_bundle, AmWebBundleKey.AM_TIME_DAYDETAILS_ENTRY_WITH_DESC));</span>
<span class="nc" id="L158">					break;</span>
				default:
					// There is no aria label for this pop up window 
					break;
			}
		}
<span class="nc" id="L164">		builder.append(&quot;\&quot;&quot;);</span>
<span class="nc" id="L165">	}</span>

	/**
	 * Constructor
	 */
	public EditTimeRecordModel(RequestContext context) {
<span class="nc" id="L171">		super(context);</span>
<span class="nc" id="L172">		m_bundle = m_localizer.getBundle(AmWebBundleKey.BUNDLE_NAME);</span>

<span class="nc" id="L174">		addRequiredJavaScriptFile(JavaScriptFileID.DIALOG_PICKERS);</span>
		//--- add a DatePicker Dialog Box to the model
		// It is enclosed in a DialogBoxPageModel to provide DialogMediator support.
<span class="nc" id="L177">		m_dateTimePickerPC = new DatePickerPC(context, &quot;display&quot;);</span>
<span class="nc" id="L178">		m_dateTimePickerPC.setIsTimeEnabled(true);</span>
<span class="nc bnc" id="L179" title="All 2 branches missed.">		if (isAccessibilityComplianceMode()) {</span>
<span class="nc" id="L180">			m_dateTimePickerPC.setAriaLabel(i18n(m_bundle, AmWebBundleKey.TIME));</span>
		}
<span class="nc" id="L182">		addChildComponent(m_dateTimePickerPC);</span>
<span class="nc" id="L183">	}</span>

	protected void initToolbar() {
<span class="nc" id="L186">		m_toolbar.addValidateSubmitTextButton(</span>
				PageAction.SAVE,
<span class="nc" id="L188">				i18n(m_common_bundle, UIFWebBundleKey.TOOLBAR_SAVE),</span>
				true);
<span class="nc" id="L190">		m_toolbar.addCloseWindowTextButton(</span>
				PageAction.CANCEL,
<span class="nc" id="L192">				i18n(m_common_bundle, UIFWebBundleKey.TOOLBAR_CANCEL),</span>
				true);
<span class="nc" id="L194">	}</span>

	/**
	 * Return instance of Model which is ready to be rendered
	 */
	public static EditTimeRecordModel getInstance(RequestContext context) throws Exception {
<span class="nc" id="L200">		EditTimeRecordModel model = null;</span>
		try {
<span class="nc" id="L202">			model = (EditTimeRecordModel) context.getAttribute(RequestContext.REQUEST_SCOPE,</span>
					EditTimeRecordModel.MODEL_KEY);

<span class="nc bnc" id="L205" title="All 2 branches missed.">			if (model == null) {</span>
				//create a new model
<span class="nc" id="L207">				model = new EditTimeRecordModel(context);</span>
			}

<span class="nc" id="L210">			model.populateModel();</span>
<span class="nc" id="L211">		} catch (UnableToLoadDataException ex) {</span>
<span class="nc" id="L212">			cat.l7dError(AmWebLogBundleKey.UNABLE_TO_LOAD_DATA, ex);</span>
<span class="nc" id="L213">		}</span>
<span class="nc" id="L214">		return model;</span>
	}

	/**
	 * Return the resource bundle associated with the page model
	 */
	public ResourceBundle getBundle() {
<span class="nc" id="L221">		return m_bundle;</span>
	}

	/**
	 * Make sure that the model is populated
	 */
	private void populateModel() throws UnableToLoadDataException, Exception {

		//process activity group if action requires it
<span class="nc bnc" id="L230" title="All 2 branches missed.">		if (this.getPageAction().equals(EDITTE_ACTION) ||</span>
<span class="nc bnc" id="L231" title="All 2 branches missed.">				this.getPageAction().equals(DELETETE_ACTION) ||</span>
<span class="nc bnc" id="L232" title="All 2 branches missed.">				this.getPageAction().equals(REFRESHEDIT_ACTION) ||</span>
<span class="nc bnc" id="L233" title="All 2 branches missed.">				this.getPageAction().equals(REFRESHINSERT_ACTION) ||</span>
<span class="nc bnc" id="L234" title="All 2 branches missed.">				this.getPageAction().equals(INSERTTE_ACTION) ||</span>
<span class="nc bnc" id="L235" title="All 2 branches missed.">				this.getPageAction().equals(OKDELETE_ACTION) ||</span>
<span class="nc bnc" id="L236" title="All 2 branches missed.">				this.getPageAction().equals(OKEDIT_ACTION) ||</span>
<span class="nc bnc" id="L237" title="All 2 branches missed.">				this.getPageAction().equals(OKINSERT_ACTION)) {</span>
<span class="nc" id="L238">			this.processActivityGroup();</span>
		}

<span class="nc bnc" id="L241" title="All 2 branches missed.">		if (m_isInitiated) return;</span>
<span class="nc" id="L242">		initToolbar();</span>
<span class="nc" id="L243">		this.getPopupHeader();</span>
<span class="nc" id="L244">		this.setPopupPageTitle();</span>
<span class="nc" id="L245">		this.setTableContent();</span>
<span class="nc" id="L246">		m_isInitiated = true;</span>
<span class="nc" id="L247">	}</span>

	//override base class;  buttons: back, forward, refresh, print, preferences, help, logout, close
	protected void initUtilityPane() {
<span class="nc" id="L251">		this.getUtilityPane().setIsRefreshEnabled(false);</span>
<span class="nc" id="L252">		String pageAction = getPageAction();</span>
<span class="nc bnc" id="L253" title="All 2 branches missed.">		if (DELETETE_ACTION.equals(pageAction) ||</span>
<span class="nc bnc" id="L254" title="All 2 branches missed.">			EDITREMARK_ACTION.equals(pageAction) ||</span>
<span class="nc bnc" id="L255" title="All 2 branches missed.">			CREATE_END_SHIFT.equals(pageAction) ||</span>
<span class="nc bnc" id="L256" title="All 2 branches missed.">			REFRESHCREATE_END_SHIFT.equals(pageAction)){</span>
<span class="nc bnc" id="L257" title="All 2 branches missed.">		  if (getUtilityPane()!=null){</span>
<span class="nc" id="L258">			getUtilityPane().setIsPrintEnabled(false);</span>
<span class="nc" id="L259">			getUtilityPane().setIsHelpEnabled(false);</span>
		  }
		}
<span class="nc" id="L262">	}</span>

	/**
	 * set empId
	 */
	public void setEmpId(ID empId) {
<span class="nc" id="L268">		this.empId = empId;</span>
<span class="nc" id="L269">	}</span>

	/**
	 * get empId
	 */
	public ID getEmpId() {
<span class="nc" id="L275">		return this.empId;</span>
	}

	/**
	 * get pageTitleText
	 */
	public String getPageTitleText() {
<span class="nc" id="L282">		return this.pageTitleText;</span>
	}

	/**
	 * set pageTitleText
	 */
	public void setPageTitleText(String pageTitleText) {
<span class="nc" id="L289">		this.pageTitleText = pageTitleText;</span>
<span class="nc" id="L290">	}</span>

	/**
	 * get tableData
	 */
	public ArrayList getTableData() {
<span class="nc" id="L296">		return this.tableData;</span>
	}

	/**
	 * set tableData
	 */
	public void setTableData(ArrayList tableData) {
<span class="nc" id="L303">		this.tableData = tableData;</span>
<span class="nc" id="L304">	}</span>

	/**
	 * setPopupPageTitle()
	 */
	private void setPopupPageTitle() {
<span class="nc" id="L310">		String headerStr = &quot;&quot;;</span>
<span class="nc bnc" id="L311" title="All 2 branches missed.">		if (this.getPageAction().equals(DELETETE_ACTION)) {</span>
<span class="nc" id="L312">			headerStr = i18n(m_bundle, AmWebBundleKey.DELETE_TIME_ENTRY);</span>
<span class="nc bnc" id="L313" title="All 2 branches missed.">		} else if (getPageAction().equals(EDITTE_ACTION) ||</span>
<span class="nc bnc" id="L314" title="All 2 branches missed.">				getPageAction().equals(REFRESHEDIT_ACTION)) {</span>
<span class="nc" id="L315">			headerStr = i18n(m_bundle, AmWebBundleKey.EDIT_TIME_ENTRY);</span>
<span class="nc bnc" id="L316" title="All 2 branches missed.">		} else if (getPageAction().equals(INSERTTE_ACTION) ||</span>
<span class="nc bnc" id="L317" title="All 2 branches missed.">				getPageAction().equals(REFRESHINSERT_ACTION)) {</span>
<span class="nc" id="L318">			headerStr = i18n(m_bundle, AmWebBundleKey.INSERT_TIME_ENTRY);</span>
<span class="nc bnc" id="L319" title="All 2 branches missed.">		} else if (getPageAction().equals(EDITREMARK_ACTION)) {</span>
<span class="nc" id="L320">			headerStr = i18n(m_bundle, AmWebBundleKey.EDIT_COMMENTS);</span>
<span class="nc bnc" id="L321" title="All 2 branches missed.">		} else if (getPageAction().equals(CREATE_END_SHIFT) ||</span>
<span class="nc bnc" id="L322" title="All 2 branches missed.">				getPageAction().equals(REFRESHCREATE_END_SHIFT)) {</span>
<span class="nc" id="L323">			headerStr = i18n(m_bundle, AmWebBundleKey.CREATE_END_SHIFT);</span>
		}

<span class="nc" id="L326">		m_contentTitlePC.setPageTitle(headerStr);</span>

<span class="nc" id="L328">	}</span>

	/**
	 * getPopupHeader()
	 */
	private void getPopupHeader() {
<span class="nc" id="L334">		StringBuffer aSb = new StringBuffer(512);</span>
<span class="nc bnc" id="L335" title="All 2 branches missed.">		if (getPageAction().equals(EDITTE_ACTION) ||</span>
<span class="nc bnc" id="L336" title="All 2 branches missed.">				getPageAction().equals(INSERTTE_ACTION) ||</span>
<span class="nc bnc" id="L337" title="All 2 branches missed.">				getPageAction().equals(REFRESHEDIT_ACTION) ||</span>
<span class="nc bnc" id="L338" title="All 2 branches missed.">				getPageAction().equals(REFRESHEDIT_ACTION)) {</span>
<span class="nc" id="L339">			aSb.append(&quot;&lt;tr&gt;&lt;th scope=\&quot;col\&quot; class=\&quot;popupDialogTitlePane\&quot; style=\&quot;&quot; + CSSUtil.STYLE_NORMAL_LEFT_PAD10 + &quot;\&quot; nowrap&gt;\n&quot; +</span>
<span class="nc" id="L340">					i18n(m_bundle, AmWebBundleKey.TIME) +</span>
					&quot;&lt;/td&gt;&quot;);
<span class="nc bnc" id="L342" title="All 2 branches missed.">			if (getAnEntry() != null) {</span>
<span class="nc" id="L343">				aSb.append(&quot;&lt;th scope=\&quot;col\&quot; class=\&quot;popupDialogTitlePane\&quot; style=\&quot;&quot; + CSSUtil.STYLE_NORMAL_LEFT_PAD10 + &quot;\&quot; nowrap&gt;\n&quot; +</span>
<span class="nc" id="L344">						i18n(m_bundle, AmWebBundleKey.ACTIVITY_TYPE) +</span>
						&quot;&lt;/td&gt;&quot;);
<span class="nc bnc" id="L346" title="All 2 branches missed.">				if (!getAnEntry().getActivityID().equals(Activity.ACTIVITY_NONE)) {</span>
<span class="nc" id="L347">					aSb.append(&quot;&lt;th scope=\&quot;col\&quot; class=\&quot;popupDialogTitlePane\&quot; style=\&quot;&quot; + CSSUtil.STYLE_NORMAL_LEFT_PAD10 + &quot;\&quot; nowrap&gt;\n&quot; +</span>
<span class="nc" id="L348">							i18n(m_bundle, AmWebBundleKey.ACTIVITY) +</span>
							&quot;&lt;/td&gt;&lt;th scope=\&quot;col\&quot; class=\&quot;popupDialogTitlePane\&quot; style=\&quot;&quot; + CSSUtil.STYLE_NORMAL_LEFT_PAD10 + &quot;\&quot; nowrap&gt;\n&quot; +
<span class="nc" id="L350">							i18n(m_bundle, AmWebBundleKey.DURATION) +</span>
							&quot;&lt;/td&gt;&lt;th scope=\&quot;col\&quot; class=\&quot;popupDialogTitlePane\&quot; style=\&quot;&quot; + CSSUtil.STYLE_NORMAL_LEFT_PAD10 + &quot;\&quot; nowrap&gt;\n&quot; +
<span class="nc" id="L352">							i18n(m_bundle, AmWebBundleKey.PAYABLE));</span>
				}
			}
<span class="nc" id="L355">			aSb.append(&quot;&lt;/td&gt;&lt;th scope=\&quot;col\&quot; class=\&quot;popupDialogTitlePane\&quot; style=\&quot;&quot; + CSSUtil.STYLE_NORMAL_LEFT_PAD10 + &quot;\&quot; nowrap&gt;\n&quot; +</span>
<span class="nc" id="L356">					i18n(m_bundle, AmWebBundleKey.MY_NOTES) +</span>
					&quot;&lt;/tr&gt;&quot;);
		}
<span class="nc" id="L359">		popUpHeader = aSb.toString();</span>
<span class="nc" id="L360">	}</span>

	/**
	 * getTableContent()
	 */
	private String getTableContent() {
<span class="nc" id="L366">		return tableContent;</span>
	}

	/**
	 * setTableContent()
	 */
	public void setTableContent() throws Exception {
<span class="nc" id="L373">		StringBuffer aSb = new StringBuffer(512);</span>

<span class="nc" id="L375">		TimeRecordEntry trEntry = getAnEntry();</span>
<span class="nc bnc" id="L376" title="All 4 branches missed.">		boolean isEndShift = (trEntry != null &amp;&amp; trEntry.getActivityID().equals(Activity.ACTIVITY_NONE)) ? true : false;</span>

<span class="nc bnc" id="L378" title="All 2 branches missed.">		if (getTimeRecord() != null &amp;&amp;</span>
<span class="nc bnc" id="L379" title="All 2 branches missed.">				getPageAction().equals(EDITREMARK_ACTION)) {</span>
			//render table row
<span class="nc" id="L381">			aSb.append(&quot;&lt;tr&gt;&quot; +</span>
					&quot;&lt;td colspan=\&quot;2\&quot; class=\&quot;popupDialogPane\&quot; style=\&quot;padding-left:10px\&quot;&gt;&quot; +
<span class="nc" id="L383">				HtmlUtil.makeTextAreaInput(&quot;remarks&quot;, 52, 5, &quot;setPageDirty();&quot;, true, false, false,</span>
<span class="nc bnc" id="L384" title="All 2 branches missed.">					getTimeRecord().getDescription() != null ? getTimeRecord().getDescription() : &quot;&quot;, null, i18n(m_bundle, AmWebBundleKey.COMMENTS)) +</span>
					&quot;&lt;/td&gt;&quot; +
					&quot;&lt;/tr&gt;&quot;);
<span class="nc bnc" id="L387" title="All 2 branches missed.">		} else if (getPageAction().equals(DELETETE_ACTION)) {</span>
<span class="nc" id="L388">			aSb.append(&quot;&lt;tr&gt;&quot; +</span>
					&quot;&lt;td colspan=\&quot;2\&quot; class=\&quot;popupDialogTitlePane\&quot; style=\&quot;padding-left:10px\&quot; nowrap&gt;&quot; +
<span class="nc" id="L390">					m_localizer.i18n(m_bundle, AmWebBundleKey.DELETE_ENTRY_TEXT) +</span>
					&quot;&lt;/td&gt;&quot; +
					&quot;&lt;/tr&gt;&quot;);

<span class="nc bnc" id="L394" title="All 2 branches missed.">			if (!getIsFirstEntry()) {</span>
<span class="nc" id="L395">				aSb.append(&quot;&lt;tr&gt;&quot; +</span>
						&quot;&lt;td colspan=\&quot;2\&quot; class=\&quot;popupDialogPane\&quot; style=\&quot;padding-left:10px; padding-top:0px;\&quot;&gt;&quot; +
						&quot;&lt;input type=\&quot;radio\&quot; name=\&quot;rowToDelete\&quot; value=\&quot;true\&quot; checked onChange=\&quot;setPageDirty();\&quot;&quot;);

<span class="nc bnc" id="L399" title="All 2 branches missed.">				if (isAccessibilityComplianceMode()) {</span>
<span class="nc" id="L400">					aSb.append(ATTR_ARIA_LABEL).append(&quot;=\&quot;&quot;).append(m_localizer.i18n(m_bundle, AmWebBundleKey.DELETE_ENTRY_EXTENDPREV)).append(&quot;\&quot;&quot;);</span>
				}
				
<span class="nc" id="L403">				aSb.append(&quot;&gt;&lt;span class=\&quot;headerText2\&quot;&gt;&quot; +</span>
<span class="nc" id="L404">						m_localizer.i18n(m_bundle, AmWebBundleKey.DELETE_ENTRY_EXTENDPREV) +</span>
						&quot;&lt;/span&gt;&quot; +
						&quot;&lt;/td&gt;&quot; +
						&quot;&lt;/tr&gt;&quot;);
			}
<span class="nc bnc" id="L409" title="All 4 branches missed.">			if (!getIsLastEntry() &amp;&amp; !isEndShift) {</span>
<span class="nc" id="L410">				aSb.append(&quot;&lt;tr&gt;&quot; +</span>
						&quot;&lt;td colspan=\&quot;2\&quot; class=\&quot;popupDialogPane\&quot; style=\&quot;padding-left:10px; padding-top:0px;\&quot;&gt;&quot; +
						&quot;&lt;input type=\&quot;radio\&quot; name=\&quot;rowToDelete\&quot; value=\&quot;false\&quot; checked onChange=\&quot;setPageDirty();\&quot;&quot;);

<span class="nc bnc" id="L414" title="All 2 branches missed.">				if (isAccessibilityComplianceMode()) {</span>
<span class="nc" id="L415">					aSb.append(ATTR_ARIA_LABEL).append(&quot;=\&quot;&quot;).append(m_localizer.i18n(m_bundle, AmWebBundleKey.DELETE_ENTRY_EXTENDNEXT)).append(&quot;\&quot;&quot;);</span>
				}
				
<span class="nc" id="L418">				aSb.append(&quot;&gt;&lt;span class=\&quot;headerText2\&quot;&gt;&quot; +</span>
<span class="nc" id="L419">						m_localizer.i18n(m_bundle, AmWebBundleKey.DELETE_ENTRY_EXTENDNEXT) +</span>
						&quot;&lt;/span&gt;&quot; +
						&quot;&lt;/td&gt;&quot; +
						&quot;&lt;/tr&gt;&quot;);
			}
<span class="nc bnc" id="L424" title="All 2 branches missed.">		} else if (getPageAction().equals(CREATE_END_SHIFT) ||</span>
<span class="nc bnc" id="L425" title="All 2 branches missed.">				getPageAction().equals(REFRESHCREATE_END_SHIFT)) {</span>
<span class="nc" id="L426">			Calendar aCal = Calendar.getInstance(TimeZone.getTimeZone(getTimeZone()));</span>
<span class="nc" id="L427">			aCal.setTime(trEntry.getStartTime());</span>

			//add a minute to prevent back end exception
<span class="nc bnc" id="L430" title="All 2 branches missed.">			if (getPageAction().equals(CREATE_END_SHIFT)) aCal.add(Calendar.MINUTE, 1);</span>
<span class="nc" id="L431">            getDateTimePicker().setDate(aCal.getTime());</span>
<span class="nc" id="L432">			getDateTimePicker().setOnChangeJS(&quot;setPageDirty();&quot;);</span>
<span class="nc" id="L433">			aSb.append(&quot;&lt;tr&gt;&quot; +</span>
					&quot;&lt;td colspan=\&quot;2\&quot; class=\&quot;popupDialogPane\&quot; style=\&quot;padding-left:10px\&quot;&gt;&quot; +
<span class="nc" id="L435">					(getDateTimePicker().getHtmlDisplay()) +</span>
					&quot;&lt;input type=\&quot;hidden\&quot; name=\&quot;activityList\&quot; value=\&quot;&quot; +
<span class="nc" id="L437">					Activity.ACTIVITY_NONE.toString() +</span>
					&quot;\&quot;&gt;&quot; +
					&quot;&lt;input type=\&quot;hidden\&quot; name=\&quot;comment\&quot; value=\&quot;\&quot;&gt;&quot; +
					&quot;&lt;input type=\&quot;hidden\&quot; name=\&quot;rawTimeEntryId\&quot; value=\&quot;&quot; +
<span class="nc" id="L441">					getRawTimeEntryId() +</span>
					&quot;\&quot;&gt;&quot; +
					&quot;&lt;input type=\&quot;hidden\&quot; name=\&quot;payType\&quot; value=\&quot;payType\&quot;&gt;&quot; +
					&quot;&lt;/td&gt;&quot; +
					&quot;&lt;/tr&gt;&quot;);
<span class="nc bnc" id="L446" title="All 2 branches missed.">		} else if (getAnEntry() != null) {//edit and insert entry</span>
<span class="nc bnc" id="L447" title="All 2 branches missed.">			String anAction = getPageAction().equals(EDITTE_ACTION)</span>
<span class="nc bnc" id="L448" title="All 2 branches missed.">					|| getPageAction().equals(REFRESHEDIT_ACTION)</span>
					? REFRESHEDIT_ACTION : REFRESHINSERT_ACTION;

<span class="nc" id="L451">			getDateTimePicker().setDate(trEntry.getStartTime());</span>
<span class="nc" id="L452">			getDateTimePicker().setOnChangeJS(&quot;setPageDirty();&quot;);</span>

<span class="nc" id="L454">			aSb.append(&quot;&lt;tr&gt;&quot; +</span>
					&quot;&lt;td class=\&quot;popupDialogPane\&quot; style=\&quot;padding-left:10px\&quot; nowrap&gt;&quot; +
<span class="nc" id="L456">					(getDateTimePicker().getHtmlDisplay()) +</span>
					&quot;&lt;/td&gt;&quot;);
<span class="nc bnc" id="L458" title="All 2 branches missed.">			if (!isEndShift) {</span>
<span class="nc" id="L459">				aSb.append(&quot;&lt;td class=\&quot;popupDialogPane\&quot; style=\&quot;padding-left:10px\&quot;&gt;&quot; +</span>
<span class="nc" id="L460">						getActivityCategorySelector() +</span>
						&quot;&lt;/td&gt;&quot; +
						&quot;&lt;td class=\&quot;popupDialogPane\&quot; style=\&quot;padding-left:10px\&quot; nowrap&gt;&quot; +
<span class="nc" id="L463">						getActivitySelector(trEntry.getActivityID()) +</span>
						&quot;&lt;/td&gt;&quot;);
<span class="nc" id="L465">				int[] aDuration = JSPUtil.getDisplayDuration(trEntry.getDuration() * 60);</span>
<span class="nc" id="L466">				aSb.append(&quot;&lt;td class=\&quot;popupDialogPane\&quot; style=\&quot;padding-left:10px\&quot; nowrap&gt;&quot; +</span>
<span class="nc" id="L467">						HourMinInput.getHourMinInput(&quot;duration&quot;, aDuration[0], aDuration[1], 0, 23, &quot;&quot;, i18n(m_bundle, AmWebBundleKey.DURATION)) +</span>
						&quot;&lt;/td&gt;&quot; +
						&quot;&lt;td class=\&quot;popupDialogPane\&quot; style=\&quot;padding-left:10px\&quot;&gt;&quot; +
<span class="nc" id="L470">						HtmlChoiceInput.makeChkBoxInput(&quot;payType&quot;, &quot;payType&quot;, i18n(m_bundle, AmWebBundleKey.PAYABLE),</span>
<span class="nc" id="L471">								trEntry.getPaid(), isEndShift, &quot;setPageDirty();&quot;, true)+ </span>
						&quot;&lt;/td&gt;&quot;);
<span class="nc" id="L473">			} else {</span>
<span class="nc" id="L474">				String escapedEndShift = HtmlUtil.escapeAttributeValue(m_localizer.i18n(m_bundle, AmWebBundleKey.END_SHIFT));</span>
<span class="nc" id="L475">				aSb.append(</span>
						&quot;&lt;td class=\&quot;popupDialogPane\&quot; style=\&quot;padding-left:10px\&quot;&gt;&quot; +
						&quot;&lt;font class=\&quot;headerText2\&quot;&gt;&quot; +
<span class="nc bnc" id="L478" title="All 2 branches missed.">						(isAccessibilityComplianceMode() ? HtmlUtil.getTabbableLabel(</span>
<span class="nc" id="L479">									HtmlUtil.makeHiddenReadableText(i18n(m_bundle, AmWebBundleKey.ACTIVITY_TYPE)) </span>
									+ &quot; &quot; + escapedEndShift, null)
								: escapedEndShift) +
						&quot;&lt;/font&gt;&quot; +
						&quot;&lt;/td&gt;&quot; +
						&quot;&lt;input type=\&quot;hidden\&quot; name=\&quot;activityCategory\&quot; value=\&quot;&quot; +
<span class="nc" id="L485">						HtmlUtil.escapeAttributeValue(getActivityCategory().toString()) +</span>
						&quot;\&quot;&gt;&quot; +
						&quot;&lt;input type=\&quot;hidden\&quot; name=\&quot;activityList\&quot; value=\&quot;&quot; +
<span class="nc" id="L488">						HtmlUtil.escapeAttributeValue(getActivityList().toString()) +</span>
						&quot;\&quot;&gt;&quot; +
						&quot;&lt;input type=\&quot;hidden\&quot; name=\&quot;minute\&quot; value=\&quot;0\&quot;&gt;&quot; +
						&quot;&lt;input type=\&quot;hidden\&quot; name=\&quot;hour\&quot; value=\&quot;0\&quot;&gt;&quot; +
						&quot;&lt;input type=\&quot;hidden\&quot; name=\&quot;payType\&quot; value=\&quot;payType\&quot;&gt;&quot;);
			}
<span class="nc" id="L494">			aSb.append(//text field for both</span>
					&quot;&lt;td class=\&quot;popupDialogPane\&quot; style=\&quot;padding-left:10px\&quot;&gt;&quot; +
<span class="nc" id="L496">							HtmlUtil.makeTextInput(&quot;comment&quot;, 10, 200,</span>
<span class="nc bnc" id="L497" title="All 2 branches missed.">									trEntry.getDescription() != null ? trEntry.getDescription() : &quot;&quot;, &quot;setPageDirty();&quot;,</span>
<span class="nc" id="L498">									null, true, false, i18n(m_bundle, AmWebBundleKey.MY_NOTES), null, null,</span>
<span class="nc" id="L499">									i18n(m_bundle, AmWebBundleKey.MY_NOTES)) +</span>
					&quot;&lt;/td&gt;&quot; +
					&quot;&lt;/tr&gt;&quot; +
					&quot;&lt;input type=\&quot;hidden\&quot; name=\&quot;entryID\&quot; value=&quot; +
<span class="nc" id="L503">					HtmlUtil.escapeAttributeValue(getEntryID().toString()) +</span>
					&quot;&gt;&quot;);
		}

<span class="nc" id="L507">		tableContent = aSb.toString();</span>
<span class="nc" id="L508">	}</span>

	/**
	 * getActivityCategorySelector()
	 * return HtmlSelect
	 */
	private HtmlSelect getActivityCategorySelector() {
<span class="nc" id="L515">		HtmlSelect activityCategorySelect = new HtmlSelect(&quot;activityCategory&quot;);</span>
<span class="nc" id="L516">		activityCategorySelect.setStyleClass(&quot;dropDown&quot;);</span>
<span class="nc" id="L517">		activityCategorySelect.setAttribute(&quot;nameIndex&quot;);</span>
<span class="nc" id="L518">		activityCategorySelect.setOnChange(&quot;populateSecondaryListFromPreLoad(this, 0);&quot;);</span>
<span class="nc bnc" id="L519" title="All 2 branches missed.">		if (isAccessibilityComplianceMode()) {</span>
<span class="nc" id="L520">			activityCategorySelect.setTitle(i18n(m_bundle, AmWebBundleKey.ACTIVITY_TYPE));</span>
		}
		try {
<span class="nc" id="L523">			activityCategorySelect.setOptions(getActivityCategoryNameList(),</span>
<span class="nc" id="L524">					getActivityCategoryIDList(), getActivityCategory().toString());</span>
<span class="nc" id="L525">		} catch (Exception ex) {</span>

<span class="nc" id="L527">		}</span>
<span class="nc" id="L528">		return activityCategorySelect;</span>
	}

	/**
	 * getActivitySelector()
	 * returnHtmlSelect
	 */
	private String getActivitySelector(ID activityID) {
<span class="nc" id="L536">		ArrayList list = new ArrayList();</span>
<span class="nc bnc" id="L537" title="All 2 branches missed.">		for (int i = 0; i &lt; activityIDList.size(); i++) {</span>
<span class="nc" id="L538">			list.add(new StringsPair((String) activityIDList.get(i), (String) activityNameList.get(i)));</span>
		}
<span class="nc" id="L540">		return HtmlUtil.makeSelectInput(&quot;activityList&quot;, &quot;&quot; + 0, new String[] { activityID.toString() },</span>
<span class="nc" id="L541">				&quot;activityChanged();&quot;, list, &quot;150px&quot;, i18n(m_bundle, AmWebBundleKey.ACTIVITY));</span>
	}
    
	/**
	 * Return the JavaScript init code required by Page model.
	 *
	 * Default behavior is to retrieve sub-component JavaScript Init code
	 */
	public String getJavaScriptInitCode() {
		//generate string to close popup
<span class="nc" id="L551">		String template = &quot;&quot;;</span>
<span class="nc bnc" id="L552" title="All 4 branches missed.">		if (getPageAction() != null &amp;&amp; getPageAction().equals(DONE_ACTION)) {</span>
<span class="nc" id="L553">			setOpenerValueOnClose(&quot;selectedID&quot;, selectedID, true);</span>
<span class="nc" id="L554">			setOpenerValueOnClose(&quot;editIndex&quot;, String.valueOf(curIndex), false);</span>
<span class="nc" id="L555">			setOpenerValueOnClose(&quot;timeEntryID&quot;, String.valueOf(entryID), false);</span>
<span class="nc" id="L556">			setOpenerValueOnClose(&quot;position&quot;, String.valueOf(position), false);</span>
<span class="nc" id="L557">            setRefreshOpenerWithAction(&quot;&quot;);</span>
<span class="nc" id="L558">			setIsCloseAfterLoad(true);</span>
		}
<span class="nc bnc" id="L560" title="All 4 branches missed.">		if (getPageAction() != null &amp;&amp; getPageAction().equals(INSERTTE_ACTION))</span>
<span class="nc" id="L561">			template = &quot;setActivityPaid()&quot;;</span>
<span class="nc" id="L562">		StringBuffer jsInitCode = new StringBuffer(512);</span>

		// Add sub-component JavaScript code first
<span class="nc" id="L565">		jsInitCode.append(super.getJavaScriptInitCode()).append(&quot;\n&quot;);</span>

		// [now create the new mediator]
<span class="nc" id="L568">		jsInitCode.append(template);</span>

<span class="nc" id="L570">		return jsInitCode.toString();</span>
	}

	/**
	 * setActivityGroup()
	 */
	public void setActivityGroup() {
<span class="nc bnc" id="L577" title="All 2 branches missed.">		if (activityGroup == null) {</span>
			try {
<span class="nc" id="L579">				activityGroup =	ActivityModelHandler.getActivityGroup(m_context, getOrgId(), ActivityGroup.ALL_ACTIVITYCATEGORIES);</span>
<span class="nc" id="L580">			} catch (Exception ex) {</span>
<span class="nc" id="L581">				handleUnableToLoadDataError(log, ex);</span>
<span class="nc" id="L582">			}</span>
		}
<span class="nc" id="L584">	}</span>

	/**
	 * Return the custom JavaScript code for the Page model.
	 */
	public String getCustomJavaScript() {
<span class="nc" id="L590">		StringBuffer jsInitCode = new StringBuffer(512);</span>
		//need to get this only for update and insert
<span class="nc bnc" id="L592" title="All 2 branches missed.">		if ((this.pageAction.equals(EDITTE_ACTION) ||</span>
<span class="nc bnc" id="L593" title="All 2 branches missed.">				this.pageAction.equals(DELETETE_ACTION) ||</span>
<span class="nc bnc" id="L594" title="All 2 branches missed.">				this.pageAction.equals(REFRESHEDIT_ACTION) ||</span>
<span class="nc bnc" id="L595" title="All 2 branches missed.">				this.pageAction.equals(REFRESHINSERT_ACTION) ||</span>
<span class="nc bnc" id="L596" title="All 2 branches missed.">				this.pageAction.equals(INSERTTE_ACTION) ||</span>
<span class="nc bnc" id="L597" title="All 2 branches missed.">				this.pageAction.equals(OKEDIT_ACTION) ||</span>
<span class="nc bnc" id="L598" title="All 4 branches missed.">				this.pageAction.equals(OKINSERT_ACTION)) &amp;&amp;</span>
				this.activityGroup != null) {
			//create the arrays of activity category and activities to preload into the jsp
			// Create the Primary dropdown collection
<span class="nc" id="L602">			ArrayList primary = new ArrayList();</span>

<span class="nc bnc" id="L604" title="All 2 branches missed.">			ArrayList activityCategories = this.activityGroup.getActivityCategories().size() &gt; 0 ?</span>
<span class="nc" id="L605">					(ArrayList) this.activityGroup.getActivityCategories() : new ArrayList();</span>

<span class="nc" id="L607">			Collection activities = null;</span>
<span class="nc bnc" id="L608" title="All 2 branches missed.">			activities = this.activityGroup.getActivities().size() &gt; 0 ?</span>
<span class="nc" id="L609">					this.activityGroup.getActivities() : new ArrayList();</span>

<span class="nc" id="L611">			ArrayList[] secondaryLists = new ArrayList[activityCategories.size()];</span>
<span class="nc bnc" id="L612" title="All 2 branches missed.">			for (int i = 0; i &lt; activityCategories.size(); i++) {</span>
<span class="nc" id="L613">				ActivityCategory activityCategory = (ActivityCategory) activityCategories.get(i);</span>
<span class="nc" id="L614">				StringsPair sp = new StringsPair(activityCategory.getID().toString(),</span>
<span class="nc" id="L615">						activityCategory.getName());</span>
<span class="nc" id="L616">				primary.add(sp);</span>

<span class="nc" id="L618">				ArrayList actList = new ArrayList();</span>
<span class="nc bnc" id="L619" title="All 4 branches missed.">				if (activities != null &amp;&amp; activities.size() &gt; 0) {</span>
<span class="nc bnc" id="L620" title="All 2 branches missed.">					for (Iterator j = activities.iterator(); j.hasNext();) {</span>
<span class="nc" id="L621">						Activity activity = (Activity) j.next();</span>
<span class="nc bnc" id="L622" title="All 2 branches missed.">						if (!activityCategory.getOrganizationId().equals(new ID(Organization.ROOT_ORG_ID)) &amp;&amp;</span>
<span class="nc bnc" id="L623" title="All 2 branches missed.">								activity.getActivityCategoryId().equals(activityCategory.getID())) {</span>
<span class="nc" id="L624">							StringsPair actSp = new StringsPair(activity.getID().toString(), activity.getName());</span>
<span class="nc" id="L625">							actList.add(actSp);</span>
						}
<span class="nc" id="L627">					}</span>
				}
<span class="nc" id="L629">				secondaryLists[i] = actList;</span>
			}

<span class="nc" id="L632">			jsInitCode.append(&quot;var secondaryLists;\n&quot;)</span>
<span class="nc" id="L633">					.append(&quot;secondaryLists = new Array(&quot; + primary.size() + &quot;);\n&quot;);</span>

<span class="nc bnc" id="L635" title="All 2 branches missed.">			for (int i = 0; i &lt; primary.size(); i++) {</span>
<span class="nc" id="L636">				ArrayList list = secondaryLists[i];</span>
<span class="nc" id="L637">				jsInitCode.append(&quot;var secondaryList = new Array(2);\n&quot;)</span>
<span class="nc" id="L638">						.append(&quot;var secondaryValues = new Array(&quot; + list.size() + &quot;);\n&quot;)</span>
<span class="nc" id="L639">						.append(&quot;var secondaryText = new Array(&quot; + list.size() + &quot;);\n&quot;);</span>
<span class="nc bnc" id="L640" title="All 2 branches missed.">				if (list.size() &gt; 0) {</span>
<span class="nc bnc" id="L641" title="All 2 branches missed.">					for (int option = 0; option &lt; list.size(); option++) {</span>
<span class="nc" id="L642">						jsInitCode.append(&quot;secondaryValues[&quot; + option + &quot;] = \'&quot; + ((StringsPair) list.get(option)).getKey() + &quot;\';\n&quot;)</span>
<span class="nc" id="L643">								.append(&quot;secondaryText[&quot; + option + &quot;] = \'&quot; + JSPUtil.escapeString(((StringsPair) list.get(option)).getValue(), &quot;\'&quot;) + &quot;\';\n&quot;);</span>
					}
				} else {
<span class="nc" id="L646">					jsInitCode.append(&quot;secondaryValues[0] = \'-1\';\n&quot;)</span>
<span class="nc" id="L647">							.append(&quot;secondaryText[0] = \'\';\n&quot;);</span>
				}

<span class="nc" id="L650">				jsInitCode.append(&quot;secondaryList[0] = secondaryValues;\n&quot;)</span>
<span class="nc" id="L651">						.append(&quot;secondaryList[1] = secondaryText;\n&quot;)</span>
<span class="nc" id="L652">						.append(&quot;secondaryLists[&quot; + ((StringsPair) primary.get(i)).getKey() + &quot;] = secondaryList;\n&quot;);</span>
			}

			//add all activities and paid value to a new array
<span class="nc bnc" id="L656" title="All 4 branches missed.">			if (activities != null &amp;&amp; activities.size() &gt; 0) {</span>
<span class="nc" id="L657">				jsInitCode.append(&quot;var actvitiyIDArray;\n&quot;)</span>
<span class="nc" id="L658">						.append(&quot;actvitiyIDArray = new Array(&quot; + activities.size() + &quot;);\n&quot;);</span>
<span class="nc" id="L659">				jsInitCode.append(&quot;var actvitiyPaidArray;\n&quot;)</span>
<span class="nc" id="L660">						.append(&quot;actvitiyPaidArray = new Array(&quot; + activities.size() + &quot;);\n&quot;);</span>
<span class="nc" id="L661">				int count = 0;</span>
<span class="nc bnc" id="L662" title="All 2 branches missed.">				for (Iterator j = activities.iterator(); j.hasNext(); count++) {</span>
<span class="nc" id="L663">					Activity activity = (Activity) j.next();</span>
<span class="nc" id="L664">					jsInitCode.append(&quot;actvitiyIDArray[&quot; + count + &quot;] = \'&quot; + activity.getID().toString() + &quot;\';\n&quot;);</span>
<span class="nc" id="L665">					jsInitCode.append(&quot;actvitiyPaidArray[&quot; + count + &quot;] = \'&quot; + activity.isPaid() + &quot;\';\n&quot;);</span>
				}
			}
		}

<span class="nc" id="L670">		return jsInitCode.toString();</span>
	}

	/**
	 * processActivityGroup()
	 */
	public void processActivityGroup()
			throws AmEJBCreateException, RemoteException, Exception {
<span class="nc" id="L678">		setActivityGroup();</span>
<span class="nc" id="L679">		processActivityCategoryInfo();</span>
<span class="nc" id="L680">		processActivityInfo();</span>
<span class="nc" id="L681">	}</span>

	/**
	 * processActivityCategoryInfo
	 */
	public void processActivityCategoryInfo()
			throws Exception {
<span class="nc bnc" id="L688" title="All 2 branches missed.">		if (this.activityGroup != null) {</span>
<span class="nc" id="L689">			ArrayList activityCategories = (ArrayList) this.activityGroup.getActivityCategories();</span>
			//put items into ArrayLists and set the model
<span class="nc bnc" id="L691" title="All 2 branches missed.">			for (int i = 0; i &lt; activityCategories.size(); i++) {</span>
<span class="nc" id="L692">				ActivityCategory activityCategory = (ActivityCategory) activityCategories.get(i);</span>
<span class="nc bnc" id="L693" title="All 2 branches missed.">				if (!activityCategory.getOrganizationId().equals(new ID(Organization.ROOT_ORG_ID))) {</span>
<span class="nc" id="L694">					this.activityCategoryNameList.add(activityCategory.getName());</span>
<span class="nc" id="L695">					this.activityCategoryIDList.add(activityCategory.getID().toString());</span>
				}
			}
		}
<span class="nc" id="L699">	}</span>

	/**
	 * set the activity collection
	 */
	private void processActivityInfo()
			throws Exception {
		//get activities from activitygroup
<span class="nc" id="L707">		Collection activities = this.activityGroup.getActivities();</span>

<span class="nc" id="L709">		ID aCatID = null;</span>
<span class="nc bnc" id="L710" title="All 2 branches missed.">		if (this.getActivityCategory() != null) {</span>
<span class="nc bnc" id="L711" title="All 2 branches missed.">			if (this.getActivityCategory().equals(new ID(0))) {</span>
<span class="nc" id="L712">				aCatID = new ID(this.activityCategoryIDList.get(0));</span>
			} else {
<span class="nc" id="L714">				aCatID = this.getActivityCategory();</span>
			}
		}
<span class="nc bnc" id="L717" title="All 2 branches missed.">		if (aCatID != null) {</span>
<span class="nc bnc" id="L718" title="All 4 branches missed.">			if (activities != null &amp;&amp; activities.size() &gt; 0) {</span>
<span class="nc bnc" id="L719" title="All 2 branches missed.">				for (Iterator j = activities.iterator(); j.hasNext();) {</span>
<span class="nc" id="L720">					Activity activity = (Activity) j.next();</span>
<span class="nc bnc" id="L721" title="All 2 branches missed.">					if (activity.getActivityCategoryId().equals(aCatID)) {</span>
<span class="nc" id="L722">						this.activityIDList.add(activity.getID().toString());</span>
<span class="nc" id="L723">						this.activityNameList.add(activity.getName());</span>
					}
<span class="nc" id="L725">				}</span>
			}
		}

<span class="nc bnc" id="L729" title="All 2 branches missed.">		if (this.activityIDList.size() == 0) {</span>
<span class="nc" id="L730">			this.activityIDList.add(&quot;-1&quot;);</span>
<span class="nc" id="L731">			this.activityNameList.add(&quot;&quot;);</span>
		}
<span class="nc" id="L733">	}</span>

	/**
	 * set entryValues
	 * This method parses the parameter string from the request
	 * Parameters are: recordID, entryID, selectedID, curIndex, timeZone, orgID, position, curDate
	 */
	public void setEntryValues(String entryValues) {
<span class="nc" id="L741">		StringTokenizer temp = new StringTokenizer(entryValues, &quot;||&quot;);</span>
<span class="nc bnc" id="L742" title="All 2 branches missed.">		if (entryValues != null) {</span>
<span class="nc" id="L743">			ArrayList&lt;String&gt; values = new ArrayList();</span>
<span class="nc bnc" id="L744" title="All 2 branches missed.">			while (temp.hasMoreElements()) {</span>
<span class="nc" id="L745">				values.add(temp.nextToken());</span>
			}
<span class="nc" id="L747">			this.setRecordID(ID.fromIntStr(values.get(0)));</span>
<span class="nc" id="L748">			this.setEntryID(ID.fromIntStr(values.get(1)));</span>
<span class="nc" id="L749">			this.setSelectedID((String) values.get(2));</span>
<span class="nc" id="L750">			this.setCurIndex(Integer.valueOf((String) values.get(3)).intValue());</span>
<span class="nc" id="L751">			this.setTimeZone((String) values.get(4));</span>
<span class="nc" id="L752">			this.setOrgId(ID.fromIntStr(values.get(5)));</span>
<span class="nc" id="L753">			this.setPosition(Integer.valueOf((String) values.get(6)).intValue());</span>
<span class="nc" id="L754">			this.setCurDate((String) values.get(7));</span>
<span class="nc" id="L755">			this.setIsFirstEntry(Boolean.valueOf((String) values.get(8)).booleanValue());</span>
<span class="nc" id="L756">			this.setIsLastEntry(Boolean.valueOf((String) values.get(9)).booleanValue());</span>
<span class="nc" id="L757">			this.setVersion((String) values.get(10));</span>
		}
<span class="nc" id="L759">	}</span>

	/**
	 * set orgId
	 */
	public void setOrgId(ID orgId) {
<span class="nc" id="L765">		this.orgId = orgId;</span>
<span class="nc" id="L766">	}</span>

	/**
	 * get orgId
	 */
	public ID getOrgId() {
<span class="nc" id="L772">		return this.orgId;</span>
	}

	/**
	 * Set activityCategoryNameList
	 */
	public void setActivityCategoryNameList(ArrayList activityCategoryNameList) {
<span class="nc" id="L779">		this.activityCategoryNameList = activityCategoryNameList;</span>
<span class="nc" id="L780">	}</span>

	/**
	 * Get activityCategoryNameList
	 */
	public ArrayList getActivityCategoryNameList() {
<span class="nc" id="L786">		return this.activityCategoryNameList;</span>
	}

	/**
	 * Set activityCategoryIDList
	 */
	public void setActivityCategoryIDList(ArrayList activityCategoryIDList) {
<span class="nc" id="L793">		this.activityCategoryIDList = activityCategoryIDList;</span>
<span class="nc" id="L794">	}</span>

	/**
	 * Get activityCategoryIDList
	 */
	public ArrayList getActivityCategoryIDList() {
<span class="nc" id="L800">		return this.activityCategoryIDList;</span>
	}


	/**
	 * Set activityNameList
	 */
	public void setActivityColl(ArrayList activityNameList) {
<span class="nc" id="L808">		this.activityNameList = activityNameList;</span>
<span class="nc" id="L809">	}</span>

	/**
	 * Get activityCategoryNameList
	 */
	public ArrayList getActivityNameList() {
<span class="nc" id="L815">		return this.activityNameList;</span>
	}

	/**
	 * Set activityIDList
	 */
	public void setActivityIDList(ArrayList activityIDList) {
<span class="nc" id="L822">		this.activityIDList = activityIDList;</span>
<span class="nc" id="L823">	}</span>

	/**
	 * Get activityIDList
	 */
	public ArrayList getActivityIDList() {
<span class="nc" id="L829">		return this.activityIDList;</span>
	}

	/**
	 * set activityList
	 */
	public void setActivityList(String actList) {
<span class="nc" id="L836">		this.activityList = new ID(actList);</span>
<span class="nc" id="L837">	}</span>

	/**
	 * get activityList
	 */
	public ID getActivityList() {
<span class="nc" id="L843">		return this.activityList;</span>
	}

	/**
	 * set activityCategory
	 */
	public void setActivityCategory(String actCat) {
<span class="nc" id="L850">		this.activityCategory = new ID(actCat);</span>
<span class="nc" id="L851">	}</span>

	/**
	 * get activityCategory
	 */
	public ID getActivityCategory() {
<span class="nc" id="L857">		return this.activityCategory;</span>
	}

	/**
	 * set timeRecord
	 */
	public void setTimeRecord(TimeRecord timeRecord) {
<span class="nc" id="L864">		this.timeRecord = timeRecord;</span>
<span class="nc" id="L865">	}</span>

	/**
	 * get timeRecord
	 */
	public TimeRecord getTimeRecord() {
<span class="nc" id="L871">		return this.timeRecord;</span>
	}

	/**
	 * set date
	 */
	public void setDate(String date) {
<span class="nc" id="L878">		this.date = new Date(Long.valueOf(date).longValue());</span>
<span class="nc" id="L879">	}</span>

	/**
	 * get date
	 */
	public Date getDate() {
<span class="nc" id="L885">		return this.date;</span>
	}

	/**
	 * Set Selected IDs
	 *
	 * @param ids Comma delimited IDs
	 */
	public void setSelectedIDs(String ids) {
<span class="nc" id="L894">		int [] intIds = StringUtil.parseIntString(ids, StringUtil.DELIM);</span>
<span class="nc" id="L895">		this.selectedIDs = new ID[intIds.length];</span>
<span class="nc" id="L896">		int index = 0;</span>
<span class="nc bnc" id="L897" title="All 2 branches missed.">		for (int i : intIds) {</span>
<span class="nc" id="L898">			this.selectedIDs[index++] = ID.fromInt(i);</span>
		}
<span class="nc" id="L900">	}</span>

	/**
	 * Return Selected IDS in a Comman delimited IDs
	 */
	public ID[] getSelectedIDs() {
<span class="nc" id="L906">		return this.selectedIDs;</span>
	}

	/**
	 * Set Selected IDs
	 *
	 * @param selectedID Comma delimited IDs
	 */
	public void setSelectedID(String selectedID) {
<span class="nc" id="L915">		this.selectedID = selectedID;</span>
<span class="nc" id="L916">		this.setSelectedIDs(selectedID);</span>
<span class="nc" id="L917">	}</span>

	/**
	 * Return Selected IDS as a string
	 */
	public String getSelectedID() {
<span class="nc" id="L923">		return this.selectedID;</span>
	}

	/**
	 * Set curIndex
	 */
	public void setCurIndex(int curIndex) {
<span class="nc" id="L930">		this.curIndex = curIndex;</span>
<span class="nc" id="L931">	}</span>

	/**
	 * Get curIndex
	 */
	public int getCurIndex() {
<span class="nc" id="L937">		return this.curIndex;</span>
	}

	/**
	 * set durationHour
	 */
	public void setDurationHour(int editHour) {
<span class="nc" id="L944">		this.durationHour = editHour;</span>
<span class="nc" id="L945">	}</span>

	/**
	 * get durationHour
	 */
	public int getDurationHour() {
<span class="nc" id="L951">		return this.durationHour;</span>
	}

	/**
	 * set durationMinute
	 */
	public void setDurationMinute(int editMinute) {
<span class="nc" id="L958">		this.durationMinute = editMinute;</span>
<span class="nc" id="L959">	}</span>

	/**
	 * get editMinute
	 */
	public int getDurationMinute() {
<span class="nc" id="L965">		return this.durationMinute;</span>
	}

	/**
	 * set isPaid
	 */
	public void setIsPaid(boolean isPaid) {
<span class="nc" id="L972">		this.isPaid = isPaid;</span>
<span class="nc" id="L973">	}</span>

	/**
	 * get isPaid
	 */
	public boolean getIsPaid() {
<span class="nc" id="L979">		return this.isPaid;</span>
	}

	/**
	 * set comment
	 */
	public void setComment(String comment) {
<span class="nc" id="L986">		this.comment = comment;</span>
<span class="nc" id="L987">	}</span>

	/**
	 * get comment
	 */
	public String getComment() {
<span class="nc" id="L993">		return this.comment;</span>
	}

	/**
	 * set position
	 */
	public void setPosition(int position) {
<span class="nc" id="L1000">		this.position = position;</span>
<span class="nc" id="L1001">	}</span>

	/**
	 * get position
	 */
	public int getPosition() {
<span class="nc" id="L1007">		return this.position;</span>
	}

	/**
	 * set recordID
	 */
	public void setRecordID(ID recordID) {
<span class="nc" id="L1014">		this.recordID = new ID(recordID);</span>
<span class="nc" id="L1015">	}</span>

	/**
	 * get recordID
	 */
	public ID getRecordID() {
<span class="nc" id="L1021">		return this.recordID;</span>
	}

	/**
	 * Set timeZone
	 */
	public void setTimeZone(String timeZone) {
<span class="nc" id="L1028">		this.timeZone = timeZone;</span>
<span class="nc" id="L1029">	}</span>

	/**
	 * Get timeZone
	 */
	public String getTimeZone() {
<span class="nc" id="L1035">		return this.timeZone;</span>
	}

	/**
	 * Set version
	 */
	public void setVersion(String version) {
<span class="nc" id="L1042">		this.version = Long.valueOf(version).longValue();</span>
<span class="nc" id="L1043">	}</span>

	/**
	 * Get version
	 */
	public long getVersion() {
<span class="nc" id="L1049">		return this.version;</span>
	}

	/**
	 * set entryID
	 */
	public void setEntryID(ID entryID) {
<span class="nc" id="L1056">		this.entryID = entryID;</span>
<span class="nc" id="L1057">	}</span>

	/**
	 * get entryID
	 */
	public ID getEntryID() {
<span class="nc" id="L1063">		return this.entryID;</span>
	}

	/**
	 * set rawTimeEntryId
	 */
	public void setRawTimeEntryId(int rawTimeEntryId) {
<span class="nc" id="L1070">		this.rawTimeEntryId = rawTimeEntryId;</span>
<span class="nc" id="L1071">	}</span>

	/**
	 * get rawTimeEntryId
	 */
	public int getRawTimeEntryId() {
<span class="nc" id="L1077">		return this.rawTimeEntryId;</span>
	}

	/**
	 * setAnEntry
	 */
	public void setAnEntry(TimeRecordEntry anEntry) {
<span class="nc" id="L1084">		this.anEntry = anEntry;</span>
<span class="nc" id="L1085">	}</span>

	/**
	 * getAnEntry
	 */
	public TimeRecordEntry getAnEntry() {
<span class="nc" id="L1091">		return this.anEntry;</span>
	}

	/**
	 * set rowToDelete
	 */
	public void setRowToDelete(boolean rowToDelete) {
<span class="nc" id="L1098">		this.rowToDelete = rowToDelete;</span>
<span class="nc" id="L1099">	}</span>

	/**
	 * get rowToDelete
	 */
	public boolean getRowToDelete() {
<span class="nc" id="L1105">		return this.rowToDelete;</span>
	}

	/**
	 * Set curDate
	 */
	public void setCurDate(String curDate) {
<span class="nc" id="L1112">		this.curDate = new Date(Long.valueOf(curDate).longValue());</span>
<span class="nc" id="L1113">	}</span>

	/**
	 * Get curDate
	 */
	public Date getCurDate() {
<span class="nc" id="L1119">		return this.curDate;</span>
	}

	/**
	 * Set remarks
	 */
	public void setRemarks(String remarks) {
<span class="nc" id="L1126">		this.remarks = remarks;</span>
<span class="nc" id="L1127">	}</span>

	/**
	 * Get remarks
	 */
	public String getRemarks() {
<span class="nc" id="L1133">		return this.remarks;</span>
	}

	/**
	 * set isLastEntry
	 */
	public void setIsLastEntry(boolean isLastEntry) {
<span class="nc" id="L1140">		this.isLastEntry = isLastEntry;</span>
<span class="nc" id="L1141">	}</span>

	/**
	 * get isLastEntry
	 */
	public boolean getIsLastEntry() {
<span class="nc" id="L1147">		return this.isLastEntry;</span>
	}

	/**
	 * set isFirstEntry
	 */
	public void setIsFirstEntry(boolean isFirstEntry) {
<span class="nc" id="L1154">		this.isFirstEntry = isFirstEntry;</span>
<span class="nc" id="L1155">	}</span>

	/**
	 * get isFirstEntry
	 */
	public boolean getIsFirstEntry() {
<span class="nc" id="L1161">		return this.isFirstEntry;</span>
	}

	/**
	 * set hiddenMillisecond
	 */
	public void setHiddenMillisecond(long ms) {
<span class="nc" id="L1168">		this.hiddenMillisecond = ms;</span>
<span class="nc" id="L1169">	}</span>

	/**
	 * get hiddenMillisecond
	 */
	public long getHiddenMillisecond() {
<span class="nc" id="L1175">		return this.hiddenMillisecond;</span>
	}

	/**
	 * set hiddenSecond
	 */
	public void setHiddenSecond(int s) {
<span class="nc" id="L1182">		this.hiddenSecond = s;</span>
<span class="nc" id="L1183">	}</span>

	/**
	 * get hiddenMillisecond
	 */
	public int getHiddenSecond() {
<span class="nc" id="L1189">		return this.hiddenSecond;</span>
	}

	/**
	 * set isOpenShift
	 */
	public void setIsOpenShift(boolean isOpenShift) {
<span class="nc" id="L1196">		this.isOpenShift = isOpenShift;</span>
<span class="nc" id="L1197">	}</span>

	/**
	 * get isOpenShift
	 */
	public boolean getIsOpenShift() {
<span class="nc" id="L1203">		return this.isOpenShift;</span>
	}

	/**
	 * Returns the DatePicker page component.
	 */
	public DatePickerPC getDateTimePicker() {
<span class="nc" id="L1210">		return m_dateTimePickerPC;</span>
	}

	/**
	 * Sets the DatePicker page component.
	 */
	public void setDateTimePicker(DatePickerPC dateTimePickerPC) {
<span class="nc" id="L1217">		m_dateTimePickerPC = dateTimePickerPC;</span>
<span class="nc" id="L1218">	}</span>

	public Date getExtractedDate(){
<span class="nc" id="L1221">		return m_date;</span>
	}

	/**
	 * Override extract Parameters to handle date input
	 */
	public boolean extractParameters(HttpServletRequest request) {
<span class="nc" id="L1228">		boolean success = super.extractParameters(request);</span>

<span class="nc bnc" id="L1230" title="All 2 branches missed.">		if (this.timeZone!=null)</span>
<span class="nc" id="L1231">			m_dateTimePickerPC.setTimeZone(TimeZone.getTimeZone(this.timeZone));</span>
<span class="nc" id="L1232">		m_date = m_dateTimePickerPC.extractDate(&quot;display&quot;);</span>

<span class="nc" id="L1234">		return success;</span>
	}


	/**
	 * Return URL for HTML Form Action
	 */
	public String getFormAction() {
<span class="nc" id="L1242">		return &quot;edittimerecord&quot;;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>