<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>DayDetailsTimeIntervalModel.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.am.timerecords</a> &gt; <span class="el_source">DayDetailsTimeIntervalModel.java</span></div><h1>DayDetailsTimeIntervalModel.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.am.timerecords;

import java.rmi.RemoteException;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.Collection;
import java.util.Collections;
import java.util.Date;
import java.util.Iterator;
import java.util.List;
import java.util.ResourceBundle;
import java.util.TimeZone;

import javax.servlet.http.HttpServletRequest;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.StringsPair;
import com.bluepumpkin.common.logging.Category;
import com.bluepumpkin.common.util.StringUtil;
import com.bluepumpkin.ejb.bbm.activity.model.Activity;
import com.bluepumpkin.ejb.bbm.activity.model.ActivityCategory;
import com.bluepumpkin.ejb.bbm.activity.model.ActivityGroup;
import com.bluepumpkin.ejb.bbm.base.BbmException;
import com.bluepumpkin.ejb.bbm.base.BbmFinderException;
import com.bluepumpkin.ejb.bbm.workresource.model.Organization;
import com.bluepumpkin.web.am.Log;
import com.bluepumpkin.web.am.l10n.AmWebBundleKey;
import com.bluepumpkin.web.am.util.JSPUtil;
import com.bluepumpkin.web.bbm.activity.ActivityModelHandler;
import com.witness.web.uif.base.UnableToLoadDataException;
import com.witness.web.uif.jsp.HtmlSelect;
import com.witness.web.uif.keys.JavaScriptFileID;
import com.witness.web.uif.keys.PageAction;
import com.witness.web.uif.l10n.UIFWebBundleKey;
import com.witness.web.uif.pagecomponent.picker.date.DatePickerPC;
import com.witness.web.uif.pagemodel.PopupWindowPM;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.util.HourMinInput;
import com.witness.web.uif.util.HtmlUtil;
import com.witness.web.uif.util.html.HtmlChoiceInput;
import com.witness.web.uif.util.html.CSSUtil;

/**
 * Title:        Blue Pumpkin Software Activity Management
 * Description:  Day Details Time Interval Popup model
 * Copyright:    Copyright (c) 2001
 * Company:      Blue Pumpkin Software, Inc
 * @author       Swati Tewari
 * @version 1.0
 */

public class DayDetailsTimeIntervalModel  extends PopupWindowPM{
	public static final String MODEL_KEY = &quot;DayDetailsTimeIntervalModel&quot;;
	public static final String SUCCESS = &quot;SUCCESS&quot;;
	public static final String SAVE_TIME_INTERVAL = &quot;SAVE_TIME_INTERVAL&quot;;
	public static final String CREATE_TIME_INTERVAL = &quot;CREATE_TIME_INTERVAL&quot;;
	public static final String REFRESH_CREATE_TIMEINTERVAL = &quot;REFRESH_CREATE_TIMEINTERVAL&quot;;
	public static final String EDIT_TIME_INTERVAL = &quot;EDIT_TIME_INTERVAL&quot;;
	public static final String REFRESHEDIT_TIME_INTERVAL = &quot;REFRESHEDIT_TIME_INTERVAL&quot;;
	public static final String UPDATE_TIME_INTERVAL = &quot;UPDATE_TIME_INTERVAL&quot;;

<span class="nc" id="L62">	private static Category cat  = Log.initCategory(DayDetailsTimeIntervalModel.class.getName());</span>
	private ResourceBundle m_bundle;
	private ID[] selectedIDs;
	private String selectedID;
	private int curIndex;
	private String popUpHeader;
	private String popUpTitle;
	private String tableContent;
	private ID activity;
<span class="nc" id="L71">	private boolean isPaid = true;</span>
	private ID activityCategory;
	private int startHour;
	private int startMinute;
	private int startYear;
	private int startMonth;
	private int startDay;
	private int endHour;
	private int endMinute;
<span class="nc" id="L80">	private int endYear = -1;</span>
	private int endMonth;
	private int endDay;
<span class="nc" id="L83">	private int editHour = 0;</span>
<span class="nc" id="L84">	private int editMinute = 0;</span>
	private String notes;
	private ID recordID;
<span class="nc" id="L87">	private ID intervalID = new ID(-1);</span>
	private ID orgId;
<span class="nc" id="L89">	private String timeZone=null;</span>
	private String actionType;
    private List m_dateList;

	private DatePickerPC m_dateTimePickerPC;
<span class="nc" id="L94">	ActivityGroup activityGroup = null;</span>
<span class="nc" id="L95">	private boolean m_isInitiated = false;</span>

	/**
	 * Constructor
	 */
	public DayDetailsTimeIntervalModel(RequestContext context) {
<span class="nc" id="L101">		super(context);</span>
<span class="nc" id="L102">		m_bundle = m_localizer.getBundle(AmWebBundleKey.BUNDLE_NAME);</span>

		//--- Add Date Time Picker
<span class="nc" id="L105">		m_dateTimePickerPC = new DatePickerPC(context, &quot;display&quot;);</span>
<span class="nc" id="L106">        m_dateTimePickerPC.setIsTimeEnabled(true);</span>
<span class="nc" id="L107">		addChildComponent(m_dateTimePickerPC);</span>

<span class="nc" id="L109">		addRequiredJavaScriptFile(JavaScriptFileID.DIALOG_PICKERS);</span>
<span class="nc" id="L110">	}</span>

	/**
	 * Return instance of Model which is ready to be rendered
	 */
	public static DayDetailsTimeIntervalModel getInstance(RequestContext context)throws Exception{
<span class="nc" id="L116">		DayDetailsTimeIntervalModel model = null;</span>
		try{
<span class="nc" id="L118">			model = (DayDetailsTimeIntervalModel) context.getAttribute(RequestContext.REQUEST_SCOPE,</span>
					DayDetailsTimeIntervalModel.MODEL_KEY);

<span class="nc bnc" id="L121" title="All 2 branches missed.">			if (model==null){</span>
				//create a new model
<span class="nc" id="L123">				model = new DayDetailsTimeIntervalModel(context);</span>
			}

<span class="nc" id="L126">			model.populateModel(context);</span>
<span class="nc" id="L127">		} catch (UnableToLoadDataException ex){</span>
<span class="nc" id="L128">			cat.l7dError(AmWebBundleKey.MSG_ERROR_UNABLETOLOADDATA, ex);</span>
<span class="nc" id="L129">		}</span>
<span class="nc" id="L130">		return model;</span>
	}

	/**
	 * Make sure that the model is populated
	 */
	private void populateModel(RequestContext context)
	throws UnableToLoadDataException, Exception {
<span class="nc" id="L138">		setPopupTitle();</span>
<span class="nc bnc" id="L139" title="All 2 branches missed.">		if (m_isInitiated) return;</span>
<span class="nc" id="L140">		setTableContent(context);</span>
<span class="nc" id="L141">		setPopupHeader();</span>
<span class="nc" id="L142">        initToolbar();</span>
<span class="nc" id="L143">		m_isInitiated = true;</span>
<span class="nc" id="L144">	}</span>

    protected void initToolbar(){
<span class="nc" id="L147">		m_toolbar.addValidateSubmitTextButton(</span>
				PageAction.SAVE,
<span class="nc" id="L149">				i18n(m_common_bundle, UIFWebBundleKey.TOOLBAR_SAVE),</span>
				true);
<span class="nc" id="L151">		m_toolbar.addCloseWindowTextButton(</span>
				PageAction.CANCEL,
<span class="nc" id="L153">				i18n(m_common_bundle, UIFWebBundleKey.TOOLBAR_CANCEL),</span>
				true);
<span class="nc" id="L155">	}</span>

		//override base class;  buttons: back, forward, refresh, print, preferences, help, logout, close
	protected void initUtilityPane() {
<span class="nc" id="L159">		getUtilityPane().setIsRefreshEnabled(false);</span>
<span class="nc" id="L160">	}</span>

	/**
	 * setPopupTitle
	 */
	private void setPopupTitle(){
<span class="nc" id="L166">		String popUpTitleStr = i18n(m_bundle, AmWebBundleKey.CREATE_TIME_INTERVAL);</span>
<span class="nc bnc" id="L167" title="All 4 branches missed.">		if (getPageAction()!=null &amp;&amp; (getPageAction().equals(EDIT_TIME_INTERVAL) ||</span>
<span class="nc bnc" id="L168" title="All 2 branches missed.">			getPageAction().equals(REFRESHEDIT_TIME_INTERVAL) ||</span>
<span class="nc bnc" id="L169" title="All 2 branches missed.">			getPageAction().equals(UPDATE_TIME_INTERVAL))){</span>
<span class="nc" id="L170">			popUpTitleStr = i18n(m_bundle, AmWebBundleKey.EDIT_TIME_INTERVAL);</span>
		}

<span class="nc" id="L173">		m_contentTitlePC.setPageTitle(popUpTitleStr);</span>
<span class="nc" id="L174">	}</span>

	/**
	 * setPopupHeader()
	 */
	private void setPopupHeader(){
<span class="nc" id="L180">		StringBuffer aSb = new StringBuffer(512);</span>

<span class="nc" id="L182">		aSb.append(&quot;&lt;tr&gt;&quot; +</span>
				&quot;&lt;th scope=\&quot;col\&quot; class=\&quot;popupDialogTitlePane\&quot; style=\&quot;&quot; + CSSUtil.STYLE_NORMAL_LEFT_PAD10 + &quot;\&quot; nowrap&gt;\n&quot; +
<span class="nc" id="L184">				i18n(m_bundle, AmWebBundleKey.ADHERENCE_SORT_STARTTIME) +</span>
				&quot;&lt;/td&gt;&quot; +
				&quot;&lt;th scope=\&quot;col\&quot; class=\&quot;popupDialogTitlePane\&quot; style=\&quot;&quot; + CSSUtil.STYLE_NORMAL_LEFT_PAD10 + &quot;\&quot; nowrap&gt;\n&quot; +
<span class="nc" id="L187">				i18n(m_bundle, AmWebBundleKey.ADHERENCE_SORT_ENDTIME) +</span>
				&quot;&lt;/td&gt;&quot; +
				&quot;&lt;th scope=\&quot;col\&quot; class=\&quot;popupDialogTitlePane\&quot; style=\&quot;&quot; + CSSUtil.STYLE_NORMAL_LEFT_PAD10 + &quot;\&quot; nowrap&gt;\n&quot; +
<span class="nc" id="L190">				i18n(m_bundle, AmWebBundleKey.ACTIVITY_TYPE) +</span>
				&quot;&lt;/td&gt;&quot; +
				&quot;&lt;th scope=\&quot;col\&quot; class=\&quot;popupDialogTitlePane\&quot; style=\&quot;&quot; + CSSUtil.STYLE_NORMAL_LEFT_PAD10 + &quot;\&quot; nowrap&gt;\n&quot; +
<span class="nc" id="L193">				i18n(m_bundle, AmWebBundleKey.ACTIVITY) +</span>
				&quot;&lt;/td&gt;&quot; +
				&quot;&lt;th scope=\&quot;col\&quot; class=\&quot;popupDialogTitlePane\&quot; style=\&quot;&quot; + CSSUtil.STYLE_NORMAL_LEFT_PAD10 + &quot;\&quot; nowrap&gt;\n&quot; +
<span class="nc" id="L196">				i18n(m_bundle, AmWebBundleKey.PAID_INTERVAL) +</span>
				&quot;&lt;/td&gt;&quot; +
				&quot;&lt;th scope=\&quot;col\&quot; class=\&quot;popupDialogTitlePane\&quot; style=\&quot;&quot; + CSSUtil.STYLE_NORMAL_LEFT_PAD10 + &quot;\&quot; nowrap&gt;\n&quot; +
<span class="nc" id="L199">				i18n(m_bundle, AmWebBundleKey.PAYABLE) +</span>
				&quot;&lt;/td&gt;&quot; +
				&quot;&lt;th scope=\&quot;col\&quot; class=\&quot;popupDialogTitlePane\&quot; style=\&quot;&quot; + CSSUtil.STYLE_NORMAL_LEFT_PAD10 + &quot;\&quot; nowrap&gt;\n&quot; +
<span class="nc" id="L202">				i18n(m_bundle, AmWebBundleKey.MY_NOTES) +</span>
				&quot;&lt;/td&gt;&lt;/tr&gt;&quot;);

<span class="nc" id="L205">		popUpHeader = aSb.toString();</span>
<span class="nc" id="L206">	}</span>

	/**
	 * setActivityGroup()
	 */
	public void setActivityGroup(){
<span class="nc bnc" id="L212" title="All 2 branches missed.">		if (activityGroup == null){</span>
			try {
<span class="nc" id="L214">				activityGroup = ActivityModelHandler.getActivityGroup(m_context, getOrgId(), ActivityGroup.ALL_ACTIVITYCATEGORIES);</span>
<span class="nc" id="L215">			} catch (Exception ex){</span>
<span class="nc" id="L216">				handleUnableToLoadDataError(log, ex);</span>
<span class="nc" id="L217">			}</span>
		}
<span class="nc" id="L219">	}</span>

	/**
	 * getActivityCategorySelector()
	 * return HtmlSelect
	 */
	private HtmlSelect getActivityCategorySelector(){
<span class="nc" id="L226">		ArrayList activityCategoryNameList = new ArrayList();</span>
<span class="nc" id="L227">		ArrayList activityCategoryIDList = new ArrayList();</span>
<span class="nc bnc" id="L228" title="All 2 branches missed.">		if (this.activityGroup != null){</span>
<span class="nc bnc" id="L229" title="All 2 branches missed.">			ArrayList activityCategories = this.activityGroup.getActivityCategories().size()&gt;0?</span>
<span class="nc" id="L230">				(ArrayList)this.activityGroup.getActivityCategories():new ArrayList();</span>
			//put items into ArrayLists and set the model
<span class="nc bnc" id="L232" title="All 2 branches missed.">			for(int i=0; i&lt;activityCategories.size(); i++) {</span>
<span class="nc" id="L233">				ActivityCategory activityCategory = (ActivityCategory)activityCategories.get(i);</span>
<span class="nc bnc" id="L234" title="All 2 branches missed.">				if (!activityCategory.getOrganizationId().equals(new ID(Organization.ROOT_ORG_ID))){</span>
<span class="nc" id="L235">					activityCategoryNameList.add(activityCategory.getName());</span>
<span class="nc" id="L236">					activityCategoryIDList.add(activityCategory.getID().toString());</span>
<span class="nc bnc" id="L237" title="All 2 branches missed.">					if (this.activityCategory == null){</span>
<span class="nc" id="L238">						this.activityCategory = activityCategory.getID();</span>
					}
				}
			}
		}

<span class="nc" id="L244">		HtmlSelect activityCategorySelect = new HtmlSelect(&quot;activityCategory&quot;);</span>
<span class="nc" id="L245">		activityCategorySelect.setStyleClass(&quot;dropDown&quot;);</span>
<span class="nc" id="L246">		activityCategorySelect.setAttribute(&quot;nameIndex&quot;);</span>
<span class="nc" id="L247">		activityCategorySelect.setOnChange(&quot;populateSecondaryListFromPreLoad(this, 0);&quot;);</span>
		try {
<span class="nc" id="L249">			activityCategorySelect.setOptions(activityCategoryNameList,</span>
<span class="nc" id="L250">				activityCategoryIDList, this.getActivityCategory().toString());</span>
<span class="nc" id="L251">		} catch (Exception ex){</span>

<span class="nc" id="L253">		}</span>
<span class="nc" id="L254">		return activityCategorySelect;</span>
	}

	/**
	 * getActivitySelector()
	 */
	private String getActivitySelector()
	throws BbmFinderException, BbmException, RemoteException{
<span class="nc" id="L262">		Collection activities = this.activityGroup.getActivities();</span>

<span class="nc" id="L264">		ArrayList activityIDList = new ArrayList();</span>
<span class="nc" id="L265">		ArrayList activityNameList = new ArrayList();</span>
<span class="nc bnc" id="L266" title="All 4 branches missed.">		if (activities!=null &amp;&amp; activities.size()&gt;0){</span>
<span class="nc bnc" id="L267" title="All 2 branches missed.">			for( Iterator j = activities.iterator(); j.hasNext(); ) {</span>
<span class="nc" id="L268">				Activity activity = (Activity)j.next();</span>
<span class="nc bnc" id="L269" title="All 2 branches missed.">				if (activity.getActivityCategoryId().equals(this.activityCategory)){</span>
<span class="nc" id="L270">					activityIDList.add(activity.getID().toString());</span>
<span class="nc" id="L271">					activityNameList.add(activity.getName());</span>
<span class="nc bnc" id="L272" title="All 2 branches missed.">					if (this.activity == null){</span>
<span class="nc" id="L273">						this.activity = activity.getID();</span>
					}
				}
<span class="nc" id="L276">			}</span>
		}
<span class="nc bnc" id="L278" title="All 2 branches missed.">		if (activityIDList.size() == 0) {</span>
<span class="nc" id="L279">			activityIDList.add(&quot;-1&quot;);</span>
<span class="nc" id="L280">			activityNameList.add(&quot;&quot;);</span>
		}

<span class="nc" id="L283">		ArrayList list = new ArrayList();</span>
<span class="nc bnc" id="L284" title="All 2 branches missed.">		for (int i=0; i&lt;activityIDList.size(); i++){</span>
<span class="nc" id="L285">			list.add(new StringsPair((String)activityIDList.get(i), (String)activityNameList.get(i)));</span>
		}
<span class="nc bnc" id="L287" title="All 2 branches missed.">		return HtmlUtil.makeSelectInput(&quot;activity&quot;, &quot;&quot;+0,</span>
<span class="nc" id="L288">			new String[]{this.activity!=null?this.activity.toString():&quot;&quot;}, &quot;activityChanged();&quot;, list, &quot;150px&quot;);</span>
	}

	/**
	 * getPopupHeader()
	 */
	private String getPopupHeader(){
<span class="nc" id="L295">		return this.popUpHeader;</span>
	}

	/**
	 * setTableContent
	 * @param RequestContext
	 */
	private void setTableContent(RequestContext context) throws Exception{
<span class="nc" id="L303">		StringBuffer aSb = new StringBuffer(512);</span>
		//get valid time zone string
<span class="nc" id="L305">		Calendar aStartCal = Calendar.getInstance(TimeZone.getTimeZone(this.getTimeZone()));</span>
<span class="nc" id="L306">		aStartCal.set(this.getStartYear(), this.getStartMonth(), this.getStartDay(),</span>
<span class="nc" id="L307">			this.getStartHour(), this.getStartMinute());</span>

<span class="nc" id="L309">		Calendar aEndCal = Calendar.getInstance(TimeZone.getTimeZone(this.getTimeZone()));</span>
<span class="nc" id="L310">        aEndCal.setTime(aStartCal.getTime());</span>
<span class="nc" id="L311">        aEndCal.add(Calendar.DATE, 1);</span>

<span class="nc bnc" id="L313" title="All 4 branches missed.">        if (m_dateList !=null &amp;&amp; m_dateList != Collections.emptyList()){</span>
<span class="nc" id="L314">            aStartCal.setTime((Date)m_dateList.get(0));</span>
<span class="nc" id="L315">            aEndCal.setTime((Date)m_dateList.get(1));</span>
        }

<span class="nc" id="L318">        m_dateTimePickerPC.setTimeZone(TimeZone.getTimeZone(this.timeZone));</span>

		//set the activitygroup
<span class="nc" id="L321">		setActivityGroup();</span>
<span class="nc" id="L322">		aSb.append(&quot;&lt;tr&gt;&quot; +</span>
					&quot;&lt;td class=\&quot;popupDialogPane\&quot; style=\&quot;padding-left:10px\&quot; nowrap&gt;\n&quot;);
<span class="nc" id="L324">        m_dateTimePickerPC.setDateInputIndex(0);</span>
<span class="nc" id="L325">	    m_dateTimePickerPC.setDate(aStartCal.getTime());</span>
<span class="nc" id="L326">		aSb.append(m_dateTimePickerPC.getHtmlDisplay() +</span>
					&quot;&lt;/td&gt;&quot; +
					&quot;&lt;td class=\&quot;popupDialogPane\&quot; style=\&quot;padding-left:10px\&quot; nowrap&gt;\n&quot;);
<span class="nc" id="L329">        m_dateTimePickerPC.setDateInputIndex(1);</span>
<span class="nc" id="L330">        m_dateTimePickerPC.setDate(aEndCal.getTime());</span>
<span class="nc" id="L331">		aSb.append(m_dateTimePickerPC.getHtmlDisplay() +</span>
					&quot;&lt;/td&gt;&quot; +
					&quot;&lt;td class=\&quot;popupDialogPane\&quot; style=\&quot;padding-left:10px\&quot;&gt;\n&quot; +
<span class="nc" id="L334">					getActivityCategorySelector() +</span>
					&quot;&lt;/td&gt;&quot; +
					&quot;&lt;td class=\&quot;popupDialogPane\&quot; style=\&quot;padding-left:10px\&quot;&gt;\n&quot; +
<span class="nc" id="L337">					getActivitySelector() +</span>
					&quot;&lt;/td&gt;&quot; +
					&quot;&lt;td class=\&quot;popupDialogPane\&quot; style=\&quot;padding-left:10px\&quot; nowrap&gt;\n&quot; +
<span class="nc" id="L340">					HourMinInput.getHourMinInput(&quot;edit&quot;, this.getEditHour(), this.getEditMinute(), &quot;&quot;) +</span>
					&quot;&lt;/td&gt;&quot; +
					&quot;&lt;td class=\&quot;popupDialogPane\&quot; style=\&quot;padding-left:10px\&quot;&gt;\n&quot; +
<span class="nc" id="L343">					HtmlChoiceInput.makeChkBoxInput(&quot;payType&quot;, &quot;payType&quot;, this.getIsPaid(), &quot;&quot;) +</span>
					&quot;&lt;/td&gt;&quot; +
					&quot;&lt;td class=\&quot;popupDialogPane\&quot; style=\&quot;padding-left:10px\&quot;&gt;\n&quot; +
<span class="nc bnc" id="L346" title="All 2 branches missed.">					HtmlUtil.makeTextInput(&quot;notes&quot;, 10, 200, this.getNotes()!=null?this.getNotes():&quot;&quot;) +</span>
					&quot;&lt;/td&gt;&quot; +
					&quot;&lt;/tr&gt;\n&quot;);
<span class="nc" id="L349">		this.tableContent = aSb.toString();</span>
<span class="nc" id="L350">	}</span>

	/**
	 * getTableContent()
	 */
	private String getTableContent(){
<span class="nc" id="L356">		return this.tableContent;</span>
	}

	/**
	 * Set Selected IDs
	 *
	 * @param selectedID Comma delimited IDs
	 */
	public void setSelectedIDs(String ids) {
<span class="nc" id="L365">		this.selectedIDs = StringUtil.parseIDString(ids);</span>
<span class="nc" id="L366">	}</span>

	/**
	 * Return Selected IDS in a Comman delimited IDs
	 */
	public ID[] getSelectedIDs() {
<span class="nc" id="L372">		return this.selectedIDs;</span>
	}

	/**
	 * Set Selected IDs
	 *
	 * @param selectedIDs Comma delimited IDs
	 */
	public void setSelectedID(String selectedID) {
<span class="nc" id="L381">		this.selectedID = selectedID;</span>
<span class="nc" id="L382">		this.setSelectedIDs(selectedID);</span>
<span class="nc" id="L383">	}</span>

	/**
	 * Return Selected IDS as a string
	 */
	public String getSelectedID() {
<span class="nc" id="L389">		return this.selectedID;</span>
	}

	/**
	* Set curIndex
	*/
	public void setCurIndex(int curIndex){
<span class="nc" id="L396">		this.curIndex = curIndex;</span>
<span class="nc" id="L397">	}</span>

	/**
	* Get curIndex
	*/
	public int getCurIndex(){
<span class="nc" id="L403">		return this.curIndex;</span>
	}

	/**
	 * set activity
	 */
	public void setActivity(ID activity){
<span class="nc" id="L410">		this.activity = activity;</span>
<span class="nc" id="L411">	}</span>

	/**
	 * get activity
	 */
	public ID getActivity(){
<span class="nc" id="L417">		return this.activity;</span>
	}

	/**
	 * set isPaid
	 */
	public void setIsPaid(String isPaid){
<span class="nc bnc" id="L424" title="All 4 branches missed.">		this.isPaid = (isPaid!=null &amp;&amp; isPaid.equals(&quot;true&quot;))?true:false;</span>
<span class="nc" id="L425">	}</span>

	/**
	 * get isPaid
	 */
	public boolean getIsPaid(){
<span class="nc" id="L431">		return this.isPaid;</span>
	}

	/**
	 * set activityCategoryid
	 */
	public void setActivityCategory(ID activityCategory){
<span class="nc" id="L438">		this.activityCategory = activityCategory;</span>
<span class="nc" id="L439">	}</span>

	/**
	 * get activityCategory
	 */
	public ID getActivityCategory(){
<span class="nc" id="L445">		return this.activityCategory;</span>
	}

	/**
	 * set startHour
	 */
	public void setStartHour(int startHour){
<span class="nc" id="L452">		this.startHour = startHour;</span>
<span class="nc" id="L453">	}</span>

	/**
	 * get startHour
	 */
	public int getStartHour(){
<span class="nc" id="L459">		return this.startHour;</span>
	}

	/**
	 * set startMinute
	 */
	public void setStartMinute(int startMinute){
<span class="nc" id="L466">		this.startMinute = startMinute;</span>
<span class="nc" id="L467">	}</span>

	/**
	 * get startMinute
	 */
	public int getStartMinute(){
<span class="nc" id="L473">		return this.startMinute;</span>
	}

	/**
	 * set startYear
	 */
	public void setStartYear(int startYear){
<span class="nc" id="L480">		this.startYear = startYear;</span>
<span class="nc" id="L481">	}</span>

	/**
	 * get startYear
	 */
	public int getStartYear(){
<span class="nc" id="L487">		return this.startYear;</span>
	}

	/**
	 * set startMonth
	 */
	public void setStartMonth(int startMonth){
<span class="nc" id="L494">		this.startMonth = startMonth;</span>
<span class="nc" id="L495">	}</span>

	/**
	 * get startMonth
	 */
	public int getStartMonth(){
<span class="nc" id="L501">		return this.startMonth;</span>
	}

	/**
	 * set startDay
	 */
	public void setStartDay(int startDay){
<span class="nc" id="L508">		this.startDay = startDay;</span>
<span class="nc" id="L509">	}</span>

	/**
	 * get startDay
	 */
	public int getStartDay(){
<span class="nc" id="L515">		return this.startDay;</span>
	}




	/**
	 * set endHour
	 */
	public void setEndHour(int endHour){
<span class="nc" id="L525">		this.endHour = endHour;</span>
<span class="nc" id="L526">	}</span>

	/**
	 * get endHour
	 */
	public int getEndHour(){
<span class="nc" id="L532">		return this.endHour;</span>
	}

	/**
	 * set endMinute
	 */
	public void setEndMinute(int endMinute){
<span class="nc" id="L539">		this.endMinute = endMinute;</span>
<span class="nc" id="L540">	}</span>

	/**
	 * get endMinute
	 */
	public int getEndMinute(){
<span class="nc" id="L546">		return this.endMinute;</span>
	}

	/**
	 * set endYear
	 */
	public void setEndYear(int endYear){
<span class="nc" id="L553">		this.endYear = endYear;</span>
<span class="nc" id="L554">	}</span>

	/**
	 * get endYear
	 */
	public int getEndYear(){
<span class="nc" id="L560">		return this.endYear;</span>
	}

	/**
	 * set endMonth
	 */
	public void setEndMonth(int endMonth){
<span class="nc" id="L567">		this.endMonth = endMonth;</span>
<span class="nc" id="L568">	}</span>

	/**
	 * get endMonth
	 */
	public int getEndMonth(){
<span class="nc" id="L574">		return this.endMonth;</span>
	}

	/**
	 * set endDay
	 */
	public void setEndDay(int endDay){
<span class="nc" id="L581">		this.endDay = endDay;</span>
<span class="nc" id="L582">	}</span>

	/**
	 * get endDay
	 */
	public int getEndDay(){
<span class="nc" id="L588">		return this.endDay;</span>
	}


	/**
	 * set editHour
	 */
	public void setEditHour(int editHour){
<span class="nc" id="L596">		this.editHour = editHour;</span>
<span class="nc" id="L597">	}</span>

	/**
	 * get editHour
	 */
	public int getEditHour(){
<span class="nc" id="L603">		return this.editHour;</span>
	}

	/**
	 * set editMinute
	 */
	public void setEditMinute(int editMinute){
<span class="nc" id="L610">		this.editMinute = editMinute;</span>
<span class="nc" id="L611">	}</span>

	/**
	 * get editMinute
	 */
	public int getEditMinute(){
<span class="nc" id="L617">		return this.editMinute;</span>
	}

	/**
	 * set notes
	 */
	public void setNotes(String notes){
<span class="nc" id="L624">		this.notes = notes;</span>
<span class="nc" id="L625">	}</span>

	/**
	 * get notes
	 */
	public String getNotes(){
<span class="nc" id="L631">		return this.notes;</span>
	}

	/**
	 * set recordID
	 */
	public void setRecordID(ID recordID){
<span class="nc" id="L638">		this.recordID = recordID;</span>
<span class="nc" id="L639">	}</span>

	/**
	 * get recordID
	 */
	public ID getRecordID(){
<span class="nc" id="L645">		return this.recordID;</span>
	}

	/**
	 * set intervalID
	 */
	public void setIntervalID(ID intervalID){
<span class="nc" id="L652">		this.intervalID = intervalID;</span>
<span class="nc" id="L653">	}</span>

	/**
	 * get intervalID
	 */
	public ID getIntervalID(){
<span class="nc" id="L659">		return this.intervalID;</span>
	}

	/**
	 * set orgId
	 */
	public void setOrgId(ID orgId){
<span class="nc" id="L666">		this.orgId = orgId;</span>
<span class="nc" id="L667">	}</span>

	/**
	 * get orgId
	 */
	public ID getOrgId(){
<span class="nc" id="L673">		return this.orgId;</span>
	}

	/**
	 * set timeZone
	 */
	public void setTimeZone(String timeZone){
<span class="nc" id="L680">		this.timeZone = timeZone;</span>
<span class="nc" id="L681">	}</span>

	/**
	 * get timeZone
	 */
	public String getTimeZone(){
<span class="nc" id="L687">		return this.timeZone;</span>
	}

	/**
	 * Set actionType
	 */
	public void setActionType(String actionType) {
<span class="nc" id="L694">		this.actionType = actionType;</span>
<span class="nc" id="L695">	}</span>

	/**
	 * Get actionType
	 */
	public String getActionType() {
<span class="nc" id="L701">		return this.actionType;</span>
	}

    public List getDateList(){
<span class="nc" id="L705">		return m_dateList;</span>
	}

    public void setDateList(List dateList){
<span class="nc" id="L709">		m_dateList = dateList;</span>
<span class="nc" id="L710">	}</span>

	/**
	 * Override extract Parameters to handle date input
	 */
	public boolean extractParameters(HttpServletRequest request) {
<span class="nc" id="L716">		boolean success = super.extractParameters(request);</span>
<span class="nc bnc" id="L717" title="All 2 branches missed.">        if (this.timeZone!=null)</span>
<span class="nc" id="L718">			m_dateTimePickerPC.setTimeZone(TimeZone.getTimeZone(this.timeZone));</span>
<span class="nc bnc" id="L719" title="All 2 branches missed.">        if (m_dateTimePickerPC.getDates() != Collections.emptyList()){</span>
<span class="nc" id="L720">            m_dateList = m_dateTimePickerPC.getDates();</span>
        }
<span class="nc" id="L722">		return success;</span>
	}


	/**
	 * Return the JavaScript init code required by Page model.
	 *
	 * Default behavior is to retrieve sub-component JavaScript Init code
	 */
	public String getJavaScriptInitCode() {
<span class="nc" id="L732">		StringBuffer jsInitCode = new StringBuffer(512);</span>

		//generate string to close popup
<span class="nc" id="L735">		String template = &quot;&quot;;</span>
<span class="nc bnc" id="L736" title="All 4 branches missed.">		if (this.actionType!=null &amp;&amp; this.actionType.equals(SUCCESS)){</span>
<span class="nc" id="L737">            setOpenerValueOnClose(&quot;selectedID&quot;, this.selectedID, false);</span>
<span class="nc" id="L738">            setOpenerValueOnClose(&quot;editIndex&quot;, String.valueOf(this.curIndex), false);</span>
<span class="nc" id="L739">            setOpenerValueOnClose(&quot;timeEntryID&quot;, this.getIntervalID().toString(), false);</span>
<span class="nc" id="L740">            setRefreshOpenerWithAction(&quot;&quot;);</span>
<span class="nc" id="L741">			setIsCloseAfterLoad(true);</span>
		} else {
<span class="nc" id="L743">			template = &quot;window.focus();\n&quot;;</span>
		}

<span class="nc bnc" id="L746" title="All 4 branches missed.">        if (this.getPageAction() != null &amp;&amp; this.getPageAction().equals(CREATE_TIME_INTERVAL))</span>
<span class="nc" id="L747">			template = &quot;setActivityPaid()&quot;;</span>

        // Add sub-component JavaScript code first
<span class="nc" id="L750">		jsInitCode.append(super.getJavaScriptInitCode()).append(&quot;\n&quot;);</span>
        // [now create the new mediator]
<span class="nc" id="L752">		jsInitCode.append(template);</span>
<span class="nc" id="L753">		return jsInitCode.toString();</span>
	}

	/**
	 * Return the custom JavaScript code for the Page model.
	 */
	public String getCustomJavaScript() {
<span class="nc" id="L760">		StringBuffer jsInitCode = new StringBuffer(512);</span>

<span class="nc" id="L762">		jsInitCode.append(&quot;\nfunction customValidateForm(){&quot;)</span>
<span class="nc" id="L763">		.append(&quot;\n\tvalidateSubmit();\n&quot;)</span>
<span class="nc" id="L764">		.append(&quot;}\n&quot;);</span>


<span class="nc" id="L767">		setActivityGroup();</span>
		//create the arrays of activity category and activities to preload into the jsp
		// Create the Primary dropdown collection
<span class="nc" id="L770">		ArrayList primary = new ArrayList();</span>

<span class="nc bnc" id="L772" title="All 2 branches missed.">		ArrayList activityCategories = this.activityGroup.getActivityCategories().size()&gt;0?</span>
<span class="nc" id="L773">			(ArrayList)this.activityGroup.getActivityCategories():new ArrayList();</span>

<span class="nc" id="L775">		Collection activities = null;</span>
<span class="nc bnc" id="L776" title="All 2 branches missed.">		activities = this.activityGroup.getActivities().size()&gt;0?</span>
<span class="nc" id="L777">			this.activityGroup.getActivities():new ArrayList();</span>

<span class="nc" id="L779">		ArrayList[] secondaryLists = new ArrayList[activityCategories.size()];</span>
<span class="nc bnc" id="L780" title="All 2 branches missed.">		for (int i=0; i&lt;activityCategories.size(); i++){</span>
<span class="nc" id="L781">			ActivityCategory activityCategory = (ActivityCategory)activityCategories.get(i);</span>
<span class="nc" id="L782">			StringsPair sp = new StringsPair(activityCategory.getID().toString(),</span>
<span class="nc" id="L783">					activityCategory.getName());</span>
<span class="nc" id="L784">			primary.add(sp);</span>

<span class="nc" id="L786">			ArrayList actList = new ArrayList();</span>
<span class="nc bnc" id="L787" title="All 4 branches missed.">			if (activities!=null &amp;&amp; activities.size()&gt;0){</span>
<span class="nc bnc" id="L788" title="All 2 branches missed.">				for( Iterator j = activities.iterator(); j.hasNext(); ) {</span>
<span class="nc" id="L789">					Activity activity = (Activity)j.next();</span>
<span class="nc bnc" id="L790" title="All 2 branches missed.">					if (!activityCategory.getOrganizationId().equals(new ID(Organization.ROOT_ORG_ID)) &amp;&amp;</span>
<span class="nc bnc" id="L791" title="All 2 branches missed.">							activity.getActivityCategoryId().equals(activityCategory.getID())){</span>
<span class="nc" id="L792">						StringsPair actSp = new StringsPair(activity.getID().toString(), activity.getName());</span>
<span class="nc" id="L793">						actList.add(actSp);</span>
					}
<span class="nc" id="L795">				}</span>
			}
<span class="nc" id="L797">			secondaryLists[i] = actList;</span>
		}

<span class="nc" id="L800">		jsInitCode.append(&quot;var secondaryLists;\n&quot;)</span>
<span class="nc" id="L801">		.append(&quot;secondaryLists = new Array(&quot; + primary.size() +&quot;);\n&quot;);</span>

<span class="nc bnc" id="L803" title="All 2 branches missed.">		for (int i=0; i &lt; primary.size(); i++) {</span>
<span class="nc" id="L804">			ArrayList list = secondaryLists[i];</span>
<span class="nc" id="L805">			jsInitCode.append(&quot;var secondaryList = new Array(2);\n&quot;)</span>
<span class="nc" id="L806">			.append(&quot;var secondaryValues = new Array(&quot; + list.size() +&quot;);\n&quot;)</span>
<span class="nc" id="L807">			.append(&quot;var secondaryText = new Array(&quot;+list.size() + &quot;);\n&quot;);</span>

<span class="nc bnc" id="L809" title="All 2 branches missed.">			if (list.size()&gt;0){</span>
<span class="nc bnc" id="L810" title="All 2 branches missed.">				for (int option=0; option &lt; list.size(); option++) {</span>
<span class="nc" id="L811">					jsInitCode.append(&quot;secondaryValues[&quot; +option +&quot;] = \'&quot; + ((StringsPair)list.get(option)).getKey() +&quot;\';\n&quot;)</span>
<span class="nc" id="L812">					.append(&quot;secondaryText[&quot; + option + &quot;] = \'&quot;</span>
<span class="nc" id="L813">						+ JSPUtil.escapeString(((StringsPair)list.get(option)).getValue(), &quot;\'&quot;)</span>
						+ &quot;\';\n&quot;);
				}
			} else {
<span class="nc" id="L817">				jsInitCode.append(&quot;secondaryValues[0] = \'-1\';\n&quot;)</span>
<span class="nc" id="L818">					.append(&quot;secondaryText[0] = \'\';\n&quot;);</span>
			}

<span class="nc" id="L821">			jsInitCode.append(&quot;secondaryList[0] = secondaryValues;\n&quot;)</span>
<span class="nc" id="L822">			.append(&quot;secondaryList[1] = secondaryText;\n&quot;)</span>
<span class="nc" id="L823">			.append(&quot;secondaryLists[&quot; + ((StringsPair)primary.get(i)).getKey() + &quot;] = secondaryList;\n&quot;);</span>
		}

        //add all activities and paid value to a new array
<span class="nc bnc" id="L827" title="All 4 branches missed.">        if (activities != null &amp;&amp; activities.size() &gt; 0) {</span>
<span class="nc" id="L828">            jsInitCode.append(&quot;var actvitiyIDArray;\n&quot;)</span>
<span class="nc" id="L829">                    .append(&quot;actvitiyIDArray = new Array(&quot; + activities.size() + &quot;);\n&quot;);</span>
<span class="nc" id="L830">            jsInitCode.append(&quot;var actvitiyPaidArray;\n&quot;)</span>
<span class="nc" id="L831">                    .append(&quot;actvitiyPaidArray = new Array(&quot; + activities.size() + &quot;);\n&quot;);</span>
<span class="nc" id="L832">            int count = 0;</span>
<span class="nc bnc" id="L833" title="All 2 branches missed.">            for (Iterator j = activities.iterator(); j.hasNext(); count++) {</span>
<span class="nc" id="L834">                Activity activity = (Activity) j.next();</span>
<span class="nc" id="L835">                jsInitCode.append(&quot;actvitiyIDArray[&quot; + count + &quot;] = \'&quot; + activity.getID().toString() + &quot;\';\n&quot;);</span>
<span class="nc" id="L836">                jsInitCode.append(&quot;actvitiyPaidArray[&quot; + count + &quot;] = \'&quot; + activity.isPaid() + &quot;\';\n&quot;);</span>
            }
        }

<span class="nc" id="L840">		return jsInitCode.toString();</span>
	}

	/**
	* Return the string representing the content of the TimeRecordSummary model
	*/
	public String toString() {
<span class="nc" id="L847">		return &quot;\nselectedID=&quot; + this.selectedID +</span>
			&quot;\ncurIndex=&quot; + this.curIndex +
			&quot;\nrecordID=&quot; + this.recordID +
			&quot;\npageAction=&quot; + this.pageAction;
	}

	/**
	 * Return URL for HTML Form Action
	 */
	public String getFormAction() {
<span class="nc" id="L857">		return &quot;createtimeinterval&quot;;</span>
	}

    /**
     * setHtmlDisplay
     */
    public String getHtmlDisplay(){
        //return html for display
<span class="nc" id="L865">        StringBuffer htmlDisplay = new StringBuffer(5000);</span>

        //start another table
<span class="nc" id="L868">        htmlDisplay.append(&quot;&lt;table cellpadding=\&quot;0\&quot; cellspacing=\&quot;0\&quot; width=\&quot;100%\&quot; class=\&quot;popupTable\&quot;&gt;&quot;);</span>

        //get table header
<span class="nc" id="L871">        htmlDisplay.append(popUpHeader);</span>

        //get table content
<span class="nc" id="L874">        htmlDisplay.append(tableContent);</span>

        //end table
<span class="nc" id="L877">        htmlDisplay.append(&quot;&lt;/table&gt;&quot;);</span>

<span class="nc" id="L879">        return htmlDisplay.toString();</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>