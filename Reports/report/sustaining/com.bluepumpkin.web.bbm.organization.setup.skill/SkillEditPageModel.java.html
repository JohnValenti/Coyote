<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>SkillEditPageModel.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.bbm.organization.setup.skill</a> &gt; <span class="el_source">SkillEditPageModel.java</span></div><h1>SkillEditPageModel.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.bbm.organization.setup.skill;

import java.util.Collection;
import java.util.Collections;
import java.util.Iterator;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.keys.DBInfo;
import com.bluepumpkin.common.logging.Category;
import com.bluepumpkin.common.util.StringUtil;
import com.witness.ejb.core.licensing.ejb.LicenseManager;
import com.witness.web.uif.keys.*;
import com.witness.web.uif.util.*;
import com.witness.web.uif.util.js.*;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.pagecomponent.form.FormTwoColumnPC;
import com.witness.web.uif.pagecomponent.toolbar.ToolbarUtil;
import com.witness.web.uif.validator.*;
import com.witness.web.uif.pagemodel.PageModel;
import com.bluepumpkin.web.bbm.Log;
import com.bluepumpkin.web.bbm.l10n.BbmWebBundleKey;
import com.bluepumpkin.web.bbm.organization.OrgWorkpaneFormPageModel;
import com.bluepumpkin.web.bbm.organization.OrganizationModelHandler;
import com.bluepumpkin.web.bbm.organization.tree.OrganizationTreeHelper;
import com.bluepumpkin.ejb.bbm.skill.model.Skill;
import com.bluepumpkin.web.bbm.skill.SkillModelHandler;
import com.bluepumpkin.web.bbm.workload.WorkloadModelHandler;
import com.bluepumpkin.ejb.bbm.workload.model.Media;
import com.bluepumpkin.ejb.core.CoreManagerFactory;
import com.bluepumpkin.common.datatypes.StringsPair;
import com.bluepumpkin.web.core.setup.mediatypes.MediaTypesSetupPageModel;

import java.util.ArrayList;


/**
 * Title:        SkillEditPageModel
 * Description:  Display the Edit page for Skills
 * Copyright:    Copyright (c) 2008
 * Company:      Verint Systems, Inc.
 *
 * @author Gonzalo Quintanar
 */
public class SkillEditPageModel extends OrgWorkpaneFormPageModel {
<span class="nc" id="L45">  private static final Category log = Log.initCategory(SkillEditPageModel.class.getName());</span>

  public static final String SKILL_NAME_FN = &quot;skillName&quot;;
  public static final String SKILL_MEDIA_TYPE_FN = &quot;skillMediaType&quot;;
  public static final String SKILL_DESC_FN = &quot;skillDesc&quot;;
  public static final String OWNER_ORG_FN = &quot;organizationID&quot;;

  private Skill m_skill;
  private FormTwoColumnPC m_formPC;
  private Collection m_mediaStringPairs;

  /**
   * Constructor
   */
  public SkillEditPageModel(RequestContext context) {
<span class="nc" id="L60">    super(context);</span>

    // Initialize Form PC
<span class="nc" id="L63">    m_formPC = new FormTwoColumnPC(context);</span>
<span class="nc" id="L64">    addChildComponent(m_formPC);</span>

    // Component specific required JavaScript Files
<span class="nc" id="L67">    addRequiredJavaScriptFile(JavaScriptFileID.MEDIATOR_WORKPANE);</span>
<span class="nc" id="L68">    setJSMediator(JavaScriptFileID.MEDIATOR_WORKPANE_GENERIC);</span>

<span class="nc" id="L70">    m_skill = new Skill();</span>
<span class="nc" id="L71">    m_skill.setName(&quot;&quot;);</span>
<span class="nc" id="L72">    m_skill.setDescription(&quot;&quot;);</span>
<span class="nc" id="L73">    m_skill.setSkillActive(true);</span>
<span class="nc" id="L74">    m_skill.setMediaID(Media.MEDIA_ID_PHONE);</span>
<span class="nc" id="L75">  }</span>

  /**
   * Return instance of Model which is ready to be rendered
   */
  public static PageModel getInstance(RequestContext context) {
<span class="nc" id="L81">    return getInstance(context, SkillEditPageModel.class);</span>
  }

  /**
   * Create Form Model
   */
  protected void createFormModel() {
    try {
<span class="nc" id="L89">      initSkill();</span>

<span class="nc bnc" id="L91" title="All 2 branches missed.">      if (getSkillID() != null) {</span>
<span class="nc" id="L92">        ID orgID = getSelectedIDObject();</span>
<span class="nc" id="L93">        m_skill = SkillModelHandler.getSkillByStringID(m_context, getSkillID(), orgID);</span>
      }

      // load media for the drop down
<span class="nc" id="L97">      m_mediaStringPairs = getMediaStringsPair();</span>
<span class="nc" id="L98">    } catch (Exception ex) {</span>
<span class="nc" id="L99">      handleUnableToLoadDataError(log, ex);</span>
<span class="nc" id="L100">    }</span>
<span class="nc" id="L101">  }</span>

  /**
   * Initialize the skill
   */
  private void initSkill() {
<span class="nc bnc" id="L107" title="All 4 branches missed.">    if ((m_performActionOnIDs != null) &amp;&amp; (m_performActionOnIDs.length &gt; 0)) {</span>
<span class="nc" id="L108">      m_skill.setID(m_performActionOnIDs[getEditIndex()]);</span>
    }

<span class="nc bnc" id="L111" title="All 4 branches missed.">    if (hasSelectedID() &amp;&amp; m_skill.getOrganizationID() == null) {</span>
<span class="nc" id="L112">      ID orgID = getSelectedIDObject();</span>
<span class="nc" id="L113">      m_skill.setOrganizationID(orgID);</span>
    }
<span class="nc" id="L115">  }</span>

  /**
   * Return Collection of Media StringsPair (String mediaId, String mediaName)
   */
  private Collection getMediaStringsPair() throws Exception {
<span class="nc" id="L121">    Collection stringPairs = WorkloadModelHandler.getMediaWithIDStringsPairList(m_context, m_localizer);</span>
<span class="nc" id="L122">    Collection licensedStringPairs = new ArrayList(stringPairs.size());</span>

<span class="nc" id="L124">    LicenseManager licManager = CoreManagerFactory.getLicenseManager();</span>
<span class="nc bnc" id="L125" title="All 2 branches missed.">    for (Iterator it = stringPairs.iterator(); it.hasNext(); ) {</span>
<span class="nc" id="L126">      StringsPair stringPair = (StringsPair) it.next();</span>
<span class="nc" id="L127">      ID mediaId = new ID(stringPair.getKey());</span>
      //QC109687: Resolution should not be listed as a media type in this page
<span class="nc bnc" id="L129" title="All 2 branches missed.">      if (mediaId.equals(Media.MEDIA_ID_RESOLUTION)) continue;</span>

<span class="nc bnc" id="L131" title="All 2 branches missed.">      if (MediaTypesSetupPageModel.isLicensedForMedia(licManager, mediaId))</span>
<span class="nc" id="L132">        licensedStringPairs.add(stringPair);</span>
<span class="nc" id="L133">    }</span>
<span class="nc" id="L134">    return licensedStringPairs;</span>
  }

  /**
   * Initialize Form Display
   */
  protected void initForm() {
    try {
<span class="nc" id="L142">      setForm(m_formPC);</span>
<span class="nc" id="L143">      m_formPC.setTitle(getFormTitle());</span>

<span class="nc" id="L145">      m_formPC.addRow(getOrganizationLabel(), getOrganizationDropDown());</span>

<span class="nc" id="L147">      m_formPC.addRow(getSkillLabel(),</span>
<span class="nc" id="L148">          HtmlUtil.makeTextInput(SKILL_NAME_FN, 50, DBInfo.SKILL_NAME_MAXLENGTH, getSkillName(), JSUtil.ON_CHANGE));</span>

<span class="nc" id="L150">      m_formPC.addRow(getSkillDescLabel(),</span>
<span class="nc" id="L151">          HtmlUtil.makeTextInput(SKILL_DESC_FN, 50, 50, getSkillDesc(), JSUtil.ON_CHANGE));</span>

<span class="nc" id="L153">      m_formPC.addRow(getSkillMediaTypeLabel(), getMediaDropDown());</span>
<span class="nc" id="L154">    } catch (Exception exp) {</span>
<span class="nc" id="L155">      handleUnableToLoadDataError(log, exp);</span>
<span class="nc" id="L156">      m_initFailure = true;</span>
<span class="nc" id="L157">    }</span>
<span class="nc" id="L158">  }</span>

  /**
   * Return the DropDown display of organizations
   */
  public String getOrganizationDropDown() throws Exception {
<span class="nc" id="L164">    return HtmlUtil.makeSelectInput(OWNER_ORG_FN, getOrganizationID(),</span>
<span class="nc" id="L165">        JSUtil.ON_CHANGE, getOrganizationStringsPair());</span>
  }

  public String getOrganizationID() {
    {
<span class="nc" id="L170">      ID id = m_skill.getOrganizationID();</span>
<span class="nc bnc" id="L171" title="All 4 branches missed.">      if (id != null &amp;&amp; !id.toString().equals(&quot;&quot;)) {</span>
<span class="nc" id="L172">        return id.toString();</span>
      } else {
<span class="nc" id="L174">        return this.getSelectedID();</span>
      }
    }
  }

  public void setOrganizationID(String id) {
<span class="nc bnc" id="L180" title="All 2 branches missed.">    if (!StringUtil.isEmpty(id)) {</span>
<span class="nc" id="L181">      m_skill.setOrganizationID(new ID(id));</span>
    }
<span class="nc" id="L183">  }</span>

  private Collection getOrganizationStringsPair() throws Exception {
<span class="nc" id="L186">    Collection collOrgs = OrganizationModelHandler.getAllOrgsInUserScope(m_context, m_context.getUser());</span>
<span class="nc" id="L187">    Collection collStringPair = OrganizationTreeHelper.createOrgNameList(collOrgs, m_localizer);</span>
<span class="nc" id="L188">    Collections.sort((ArrayList) collStringPair);</span>
<span class="nc" id="L189">    return collStringPair;</span>
  }

  /**
   * Return the DropDown display of Media Types
   * with the current selected Type choosen
   */
  public Object getMediaDropDown() throws Exception {
<span class="nc" id="L197">    return HtmlUtil.makeSelectInput(SKILL_MEDIA_TYPE_FN,</span>
<span class="nc" id="L198">        getSkillMediaType().toString(), JSUtil.ON_CHANGE, m_mediaStringPairs);</span>
  }

  /**
   * Initialize Toolbar
   */
  protected void initToolbar() {
<span class="nc" id="L205">    ToolbarUtil.addValidateSaveBtn(m_toolbar, true);</span>
<span class="nc" id="L206">    ToolbarUtil.addConfirmDoneBtn(m_toolbar, true);</span>
<span class="nc" id="L207">    ToolbarUtil.addResetBtn(m_toolbar, true);</span>
<span class="nc" id="L208">  }</span>

  /**
   * Set the validators to the form fields
   */
  protected void initFieldValidators() {
    // Add Field Validators
<span class="nc" id="L215">    addValidator(new IsEnteredFieldValidator(this, SKILL_NAME_FN,</span>
        BbmWebBundleKey.ORG_SKILL_LABEL, BbmWebBundleKey.BUNDLE_NAME));
<span class="nc" id="L217">  }</span>

  /**
   * Set Skill
   */
  public void setSkillName(String Skill) {
<span class="nc" id="L223">    m_skill.setName(Skill);</span>
<span class="nc" id="L224">  }</span>

  /**
   * Return Skill
   */
  public String getSkillName() {
<span class="nc" id="L230">    return m_skill.getName();</span>
  }

  /**
   * Set Media ID
   */
  public void setSkillMediaType(ID mediaID) {
<span class="nc" id="L237">    m_skill.setMediaID(mediaID);</span>
<span class="nc" id="L238">  }</span>

  /**
   * Return Media ID
   */
  public ID getSkillMediaType() {
<span class="nc" id="L244">    return m_skill.getMediaID();</span>
  }

  /**
   * Return Media name
   */
  public String getSkillMediaTypeName() {
<span class="nc" id="L251">    String mediaName = &quot;&quot;;</span>
    try {
<span class="nc" id="L253">      mediaName = SkillModelHandler.getMedia(getSkillMediaType()).getName();</span>
<span class="nc" id="L254">    } catch (Exception ex) {</span>
<span class="nc" id="L255">      handleUnableToLoadDataError(log, ex);</span>
<span class="nc" id="L256">    }</span>
<span class="nc" id="L257">    return mediaName;</span>
  }

  /**
   * Set Skill Description
   */
  public void setSkillDesc(String skillDesc) {
<span class="nc" id="L264">    m_skill.setDescription(skillDesc);</span>
<span class="nc" id="L265">  }</span>

  /**
   * Return Skill Description
   */
  public String getSkillDesc() {
<span class="nc" id="L271">    return m_skill.getDescription();</span>
  }

  /**
   * Return the Associated Skill Object
   */
  public Skill getSkill() {
<span class="nc" id="L278">    return m_skill;</span>
  }

  /**
   * Set Skill ID
   */
  public void setSkillID(ID id) {
<span class="nc" id="L285">    m_skill.setID(id);</span>
<span class="nc" id="L286">  }</span>

  /**
   * Return Skill ID
   */
  public ID getSkillID() {
<span class="nc" id="L292">    initSkill();</span>

<span class="nc" id="L294">    return m_skill.getID();</span>
  }

  /**
   * Return true if the skill is new, false otherwise.
   */
  public boolean isNew() {
<span class="nc bnc" id="L301" title="All 2 branches missed.">    return getSkillID() == null;</span>
  }

  /**
   * Return Localized Organization Label
   */
  public String getOrganizationLabel() {
<span class="nc" id="L308">    return i18n(m_bbmBundle, BbmWebBundleKey.ORGANIZATION_NAME);</span>
  }

  /**
   * Return Localized Skill Label
   */
  public String getSkillLabel() {
<span class="nc" id="L315">    return i18n(m_bbmBundle, BbmWebBundleKey.NAME);</span>
  }

  /**
   * Return Localized Skill Description Label
   */
  public String getSkillDescLabel() {
<span class="nc" id="L322">    return i18n(m_bbmBundle, BbmWebBundleKey.ORG_SKILL_DESC_LABEL);</span>
  }

  /**
   * Return Localized Skill Media Type Label
   */
  public String getSkillMediaTypeLabel() {
<span class="nc" id="L329">    return i18n(m_bbmBundle, BbmWebBundleKey.ORG_SKILL_MEDIA_TYPE_LABEL);</span>
  }

  /**
   * Return the form title
   *
   * @return form title
   */
  public String getFormTitle() {
<span class="nc bnc" id="L338" title="All 2 branches missed.">    if (isNew()) {</span>
<span class="nc" id="L339">      return i18n(m_bbmBundle, BbmWebBundleKey.ORG_SKILL_CREATING);</span>
    } else {
<span class="nc" id="L341">      return HtmlUtil.NBSP;</span>
    }
  }

  /**
   * Get entity name. Used for title.
   */
  protected String getTitleEntityType() {
<span class="nc" id="L349">    return i18n(m_bbmBundle, BbmWebBundleKey.ORG_SKILL_CONTENT_TITLE);</span>
  }

  /**
   * Returns an entity name. Used for title.
   */
  protected String getEntityName() {
<span class="nc" id="L356">    return getSkillName();</span>
  }

  /**
   * Return URL for HTML Form Action
   */
  public String getFormAction() {
<span class="nc" id="L363">    return &quot;org_skill&quot;;</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>