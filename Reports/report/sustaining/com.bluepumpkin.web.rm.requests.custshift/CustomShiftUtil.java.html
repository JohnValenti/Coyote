<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>CustomShiftUtil.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.rm.requests.custshift</a> &gt; <span class="el_source">CustomShiftUtil.java</span></div><h1>CustomShiftUtil.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.rm.requests.custshift;

import java.text.Collator;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.Collection;
import java.util.Collections;
import java.util.Comparator;
import java.util.Date;
import java.util.List;
import java.util.ResourceBundle;
import java.util.TimeZone;

import com.bluepumpkin.common.datatypes.Pair;
import com.bluepumpkin.common.l10n.RegionalFormatBundleKey;
import com.bluepumpkin.common.localization.LocaleContext;
import com.bluepumpkin.common.localization.LocalizationManager;
import com.bluepumpkin.common.localization.Localizer;
import com.bluepumpkin.ejb.bbm.activity.model.Activity;
import com.bluepumpkin.ejb.bbm.schedule.model.ShiftAssignment;
import com.bluepumpkin.ejb.bbm.workrules.model.Shift;
import com.bluepumpkin.ejb.bbm.workrules.model.ShiftOTExtension;
import com.bluepumpkin.ejb.rm.l10n.RmEjbBundleKey;
import com.bluepumpkin.ejb.rm.requests.custshift.model.CustShiftReq;
import com.bluepumpkin.ejb.rm.requests.custshift.model.CustShiftReqFieldInfo;
import com.bluepumpkin.ejb.rm.requests.custshift.model.CustShiftReqGap;
import com.bluepumpkin.ejb.rm.setup.settings.model.OrganizationSetting;
import com.bluepumpkin.ejb.rm.util.CustomShiftEJBUtil;
import com.bluepumpkin.web.rm.keys.RmPageAction;
import com.bluepumpkin.web.rm.l10n.RmWebBundleKey;
import com.witness.web.uif.base.Message;
import com.witness.web.uif.data.wrapper.DateWrapper;
import com.witness.web.uif.pagecomponent.DefaultMultiColumnNodeData;
import com.witness.web.uif.pagecomponent.container.ListContainerPC;
import com.witness.web.uif.pagecomponent.dialog.DialogToolbarMenuPC;
import com.witness.web.uif.pagecomponent.toolbar.ToolbarPC;
import com.witness.web.uif.pagemodel.PageModel;
import com.witness.web.uif.system.RequestContext;

/**
 * Title:        CustomShiftUtil
 * Description:  UI utility class for My Custom Shift Requests
 * Copyright:    Copyright (c) 2011
 * Company:      Verint Systems, Inc
 * @author       Gonzalo Quintanar
 */
<span class="nc" id="L47">public class CustomShiftUtil {</span>
	/**
	 * Currently, there is no special workflow for managers vs. agents. This function checks the
	 * organization settings of the logged-in user (whether agent or manager) to determine whether
	 * the Custom Shift workflow should be enabled for him. For either, this determines whether
	 * they can create/edit requests. For managers, this is also used to enabled/disable the
	 * Employee Requests page when a Custom Shift Request filter is selected. Note that the filter
	 * itself is still editable.
	 * @param orgSetting
	 * @return true if the Custom Shift Requests workflow is enabled for the logged-in user's organization. False otherwise.
	 */
	public static boolean isWorkflowEnabled(OrganizationSetting orgSetting)
	{
<span class="nc" id="L60">		boolean allowNewShifts = orgSetting.getEnableCustomShiftRequests();   //allow new shift requests</span>
<span class="nc" id="L61">		boolean allowShiftChanges = orgSetting.getAllowShiftChangeRequests(); //allow shift change requests</span>
<span class="nc bnc" id="L62" title="All 4 branches missed.">		return allowNewShifts || allowShiftChanges;</span>
	}

	/**
	  * Add Custom Shift Requests Not Enabled Message
	  */
	public static void addCSNotEnabledMsg(PageModel model) {
<span class="nc" id="L69">		model.addPageMessage(Message.INFO_TYPE,</span>
		RmWebBundleKey.CSR_NOT_ENABLED, RmWebBundleKey.BUNDLE_NAME);
<span class="nc" id="L71">	}</span>

	/**
	 * Checks if the given CustShiftReq object specifies a &quot;Shift Change&quot; request (as opposed to a &quot;New Shift&quot; request).
	 */
	public static boolean isShiftChangeSubType(CustShiftReq csr)
	{
<span class="nc bnc" id="L78" title="All 2 branches missed.">		return (csr.getSubType() == (CustShiftReq.REQUEST_SUB_TYPE_OT_SHIFT_CHANGE.toInt())) ||</span>
<span class="nc bnc" id="L79" title="All 2 branches missed.">				(csr.getSubType() == (CustShiftReq.REQUEST_SUB_TYPE_REG_SHIFT_CHANGE.toInt()));</span>
	}

	/**
	 * Get Request Sub Type string.
	 */
	public static String getRequestSubTypeString(CustShiftReq csr, Localizer localizer) {
<span class="nc" id="L86">		ResourceBundle bundle = localizer.getBundle(RmEjbBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L87">		int subType = (int) csr.getSubType();</span>
<span class="nc" id="L88">		return localizer.i18n(bundle, CustomShiftEJBUtil.getRequestSubTypeStringKey(subType));</span>
	}

	/**
	 * For shift change requests, the saved request only contains the delta information, so we need to merge
	 * that with the shift assignment for that day in order to populate all of the request fields.
	 * The problem is that we don't have the shift assignment yet, and the existingRequest.ShiftStartTime might be
	 * null, so we must use the existingRequest.StartTime and add any extensionBefore to it, in order to get the ShiftStartTime.
	 * @param existingRequest - a CustShiftReq object that possibly only stores &quot;delta&quot; information. It will always have a StartTime, but
	 *        it might not have a ShiftStartTime. This function will calculate ShiftStartTime and set it back in existingRequest.
	 *
	public static void setShiftStartTimeInExistingRequest(CustShiftReq existingRequest, TimeZone tz)
	{
		if (existingRequest.getShiftStartTime() == null)
		{
			Date startTime = existingRequest.getStartTime();

			int extBeforeDuration = existingRequest.getExtBeforeDuration(); //existingRequest.getExtBeforeDuration()==null ? 0 : existingRequest.getExtBeforeDuration().toInt();
			if (existingRequest.getExtBeforeActivityID()!= null &amp;&amp; extBeforeDuration&gt;0)
			{
				Calendar cal = Calendar.getInstance(tz);
				cal.setTime(startTime);
				cal.add(Calendar.MINUTE, extBeforeDuration);
				existingRequest.setShiftStartTime(cal.getTime());
			}
			else
			{
				existingRequest.setShiftStartTime(startTime);
			}
		}
	}
	*/

	/**
	 * Copy the deltas from an existing shift change request (existingRequest) into
	 * mergeResult, which will initially only contain the ShiftAssignment data.
	 * After this method completes, mergeResult should have the full request+ShiftAssignment data.
	 */
	protected static void mergeExistingRequestDeltasIntoRequest(CustShiftReq existingRequest, CustShiftReq mergeResult)
	{
<span class="nc bnc" id="L128" title="All 2 branches missed.">		if (existingRequest.getShiftID() != null)</span>
		{
<span class="nc" id="L130">			mergeResult.setShiftID(existingRequest.getShiftID());</span>
<span class="nc" id="L131">			mergeResult.setShiftStartTime(existingRequest.getShiftStartTime());</span>
<span class="nc" id="L132">			mergeResult.setShiftEndTime(existingRequest.getShiftEndTime());</span>
<span class="nc" id="L133">			mergeResult.setActivityID(existingRequest.getActivityID());</span>
<span class="nc" id="L134">			mergeResult.setIsOT(existingRequest.isOT());</span>
<span class="nc" id="L135">			mergeResult.setShiftAssignmentID(existingRequest.getShiftAssignmentID());</span>
		}

<span class="nc bnc" id="L138" title="All 2 branches missed.">		if (existingRequest.getExtBeforeID() != null)</span>
		{
<span class="nc" id="L140">			mergeResult.setExtBeforeID(existingRequest.getExtBeforeID());</span>
<span class="nc" id="L141">			mergeResult.setExtBeforeActivityID(existingRequest.getExtBeforeActivityID());</span>
<span class="nc" id="L142">			mergeResult.setExtBeforeIsOT(existingRequest.getExtBeforeIsOT());</span>
<span class="nc" id="L143">			mergeResult.setExtBeforeGap(existingRequest.getExtBeforeGap());</span>
<span class="nc" id="L144">			mergeResult.setExtBeforeDuration(existingRequest.getExtBeforeDuration());</span>
		}

<span class="nc bnc" id="L147" title="All 2 branches missed.">		if (existingRequest.getExtAfterID() != null)</span>
		{
<span class="nc" id="L149">			mergeResult.setExtAfterID(existingRequest.getExtAfterID());</span>
<span class="nc" id="L150">			mergeResult.setExtAfterActivityID(existingRequest.getExtAfterActivityID());</span>
<span class="nc" id="L151">			mergeResult.setExtAfterIsOT(existingRequest.getExtAfterIsOT());</span>
<span class="nc" id="L152">			mergeResult.setExtAfterGap(existingRequest.getExtAfterGap());</span>
<span class="nc" id="L153">			mergeResult.setExtAfterDuration(existingRequest.getExtAfterDuration());</span>
		}
		
<span class="nc" id="L156">		Collection&lt;CustShiftReqGap&gt; existingGaps = existingRequest.getChildObjects(CustShiftReqFieldInfo.CUSTREQGAP_CHILD_TYPE);</span>
<span class="nc bnc" id="L157" title="All 4 branches missed.">		if(existingGaps!=null &amp;&amp; !existingGaps.isEmpty()){</span>
<span class="nc" id="L158">				CustShiftReqGap existingGap = existingGaps.iterator().next();</span>
<span class="nc" id="L159">				CustShiftReqGap mergeGap = new CustShiftReqGap();</span>
				
<span class="nc" id="L161">				mergeGap.setExtGapStartTime(existingGap.getExtGapStartTime());</span>
<span class="nc" id="L162">				mergeGap.setExtGapEndTime(existingGap.getExtGapEndTime());</span>
<span class="nc" id="L163">				mergeGap.setExtGapDuration(existingGap.getExtGapDuration());</span>
<span class="nc" id="L164">				mergeGap.setExtGapGap(existingGap.getExtGapGap());</span>
<span class="nc" id="L165">				mergeGap.setExtGapActivityID(existingGap.getExtGapActivityID());</span>
<span class="nc" id="L166">				mergeGap.setShiftOtGapID(existingGap.getShiftOTGapID());</span>
				
<span class="nc" id="L168">				mergeResult.createChildObject(CustShiftReqFieldInfo.CUSTREQGAP_CHILD_TYPE, mergeGap);</span>
		}		
<span class="nc" id="L170">	}</span>

	public static void mergeOnlyGapSectionIntoRequest(CustShiftReq existingRequest, CustShiftReq mergeResult)
	{
<span class="nc" id="L174">		Collection&lt;CustShiftReqGap&gt; existingGaps = existingRequest.getChildObjects(CustShiftReqFieldInfo.CUSTREQGAP_CHILD_TYPE);</span>
<span class="nc bnc" id="L175" title="All 4 branches missed.">		if(existingGaps!=null &amp;&amp; !existingGaps.isEmpty()){</span>
<span class="nc" id="L176">				CustShiftReqGap existingGap = existingGaps.iterator().next();</span>
<span class="nc" id="L177">				CustShiftReqGap mergeGap = new CustShiftReqGap();</span>
				
<span class="nc" id="L179">				mergeGap.setExtGapStartTime(existingGap.getExtGapStartTime());</span>
<span class="nc" id="L180">				mergeGap.setExtGapEndTime(existingGap.getExtGapEndTime());</span>
<span class="nc" id="L181">				mergeGap.setExtGapDuration(existingGap.getExtGapDuration());</span>
<span class="nc" id="L182">				mergeGap.setExtGapGap(existingGap.getExtGapGap());</span>
<span class="nc" id="L183">				mergeGap.setExtGapActivityID(existingGap.getExtGapActivityID());</span>
<span class="nc" id="L184">				mergeGap.setShiftOtGapID(existingGap.getShiftOTGapID());</span>
				
<span class="nc" id="L186">				mergeResult.createChildObject(CustShiftReqFieldInfo.CUSTREQGAP_CHILD_TYPE, mergeGap);</span>
		}		
<span class="nc" id="L188">	}</span>
	
	/**
	 * Set the customShiftRequest to match the shiftAssignment.
	 * @boolean forceShiftID - true means that if the ShiftAssignment has no ShiftID, we will set it to NONE_ID in
	 * 			the CustShiftReq object. Otherwise, we will set it to null.
	 */
	public static void convertShiftAssignmentToRequest(ShiftAssignment sa, CustShiftReq csr, Date saMainShiftStartTime,
			Date saMainShiftEndTime, int saGapBeforeDuration, int saGapAfterDuration, boolean forceShiftID)
	{
<span class="nc bnc" id="L198" title="All 4 branches missed.">		csr.setShiftID((sa.getShiftID()==null &amp;&amp; forceShiftID) ? CustomShiftRequestFormPopupPM.NONE_ID : sa.getShiftID());</span>
<span class="nc" id="L199">		csr.setActivityID(sa.getActivityID());</span>

<span class="nc" id="L201">		csr.setShiftStartTime(saMainShiftStartTime);</span>
<span class="nc" id="L202">		csr.setShiftEndTime(saMainShiftEndTime); //we set end time instead of calling setDuration()</span>
		//csr.setStartTime(completeShiftStartTime);
		//csr.setEndTime(completeShiftEndTime);

<span class="nc" id="L206">		csr.setIsOT(isOTShiftAssignment(sa));</span>

<span class="nc" id="L208">		csr.setExtBeforeID(sa.getOTExtensionBeforeID());</span>
<span class="nc" id="L209">		csr.setExtBeforeActivityID(sa.getOTExtensionBeforeActivityID());</span>
<span class="nc" id="L210">		csr.setExtBeforeIsOT(saHasExtBefore(sa)); //any SA extension must be OT</span>
<span class="nc" id="L211">		csr.setExtBeforeGap(saGapBeforeDuration);</span>

<span class="nc" id="L213">		csr.setExtAfterID(sa.getOTExtensionAfterID());</span>
<span class="nc" id="L214">		csr.setExtAfterActivityID(sa.getOTExtensionAfterActivityID());</span>
<span class="nc" id="L215">		csr.setExtAfterIsOT(saHasExtAfter(sa)); //any SA extension must be OT</span>
<span class="nc" id="L216">		csr.setExtAfterGap(saGapAfterDuration);</span>

		//We need to be able to call setExtBeforeDuration(), setExtAfterDuration() because they may have
		//custom durations already scheduled for the user. Say he just wants to request a change to the main
		//activity. In this case, the extBeforeDuration should not change, and we need to specify that here.
		//However, since we now only store the deltas, this shouldn't be needed, since you cannot change durations.
<span class="nc" id="L222">		csr.setExtBeforeDuration(sa.getExtensionBefore() - saGapBeforeDuration);</span>
<span class="nc" id="L223">		csr.setExtAfterDuration(sa.getExtensionAfter() - saGapAfterDuration);</span>

<span class="nc" id="L225">		csr.setShiftAssignmentID(sa.getID());</span>
<span class="nc" id="L226">	}</span>

	/**
	 * Set the customShiftRequest to match the shiftAssignment.
	 * @boolean forceShiftID - true means that if the ShiftAssignment has no ShiftID, we will set it to NONE_ID in
	 * 			the CustShiftReq object. Otherwise, we will set it to null.
	 */
	protected static void convertShiftAssignmentToRequest(ShiftAssignment sa, CustShiftReq csr, Date saMainShiftStartTime,
			Date saMainShiftEndTime, int saGapBeforeDuration, int saGapAfterDuration, int saDurationBeforeDuration,
			int saDurationAfterDuration, boolean forceShiftID)
	{
<span class="nc bnc" id="L237" title="All 4 branches missed.">		csr.setShiftID((sa.getShiftID()==null &amp;&amp; forceShiftID) ? CustomShiftRequestFormPopupPM.NONE_ID : sa.getShiftID());</span>
<span class="nc" id="L238">		csr.setActivityID(sa.getActivityID());</span>
		
<span class="nc" id="L240">		csr.setShiftStartTime(saMainShiftStartTime);</span>
<span class="nc" id="L241">		csr.setShiftEndTime(saMainShiftEndTime); //we set end time instead of calling setDuration()		</span>
		//csr.setStartTime(completeShiftStartTime);
		//csr.setEndTime(completeShiftEndTime);	

<span class="nc" id="L245">		csr.setIsOT(isOTShiftAssignment(sa));</span>
		
<span class="nc" id="L247">		csr.setExtBeforeID(sa.getOTExtensionBeforeID());</span>
<span class="nc" id="L248">		csr.setExtBeforeActivityID(sa.getOTExtensionBeforeActivityID());</span>
<span class="nc" id="L249">		csr.setExtBeforeIsOT(saHasExtBefore(sa)); //any SA extension must be OT</span>
<span class="nc" id="L250">		csr.setExtBeforeGap(saGapBeforeDuration); </span>
		
<span class="nc" id="L252">		csr.setExtAfterID(sa.getOTExtensionAfterID());</span>
<span class="nc" id="L253">		csr.setExtAfterActivityID(sa.getOTExtensionAfterActivityID());</span>
<span class="nc" id="L254">		csr.setExtAfterIsOT(saHasExtAfter(sa)); //any SA extension must be OT</span>
<span class="nc" id="L255">		csr.setExtAfterGap(saGapAfterDuration); </span>
<span class="nc" id="L256">		csr.setExtBeforeDuration(saDurationBeforeDuration);</span>
<span class="nc" id="L257">		csr.setExtAfterDuration(saDurationAfterDuration);</span>
		
<span class="nc" id="L259">		csr.setShiftAssignmentID(sa.getID());</span>
<span class="nc" id="L260">	}</span>

	/**
	 * Return true if the shift assignment is all OT, false otherwise.
	 */
	protected static boolean isOTShiftAssignment(ShiftAssignment sa)
	{
		//OT shift assignments are implemented as a shift comprised of ONLY an OT After extension.
<span class="nc bnc" id="L268" title="All 2 branches missed.">		return (sa.getDuration() == sa.getExtensionAfter());</span>
	}

	/**
	 * Returns true if the employee's shift assignment has a non-zero length extension before the shift.
	 */
    protected static boolean saHasExtBefore(ShiftAssignment sa)
    {
<span class="nc bnc" id="L276" title="All 2 branches missed.">    	return (sa!= null &amp;&amp;</span>
<span class="nc bnc" id="L277" title="All 2 branches missed.">    			sa.getOTExtensionBeforeActivityID()!=null &amp;&amp;</span>
<span class="nc bnc" id="L278" title="All 2 branches missed.">    			sa.getExtensionBefore()&gt;0);</span>

    	//(sa.getOTExtensionBeforeID()!=null)
    }

	/**
	 * Returns true if the employee's shift assignment has a non-zero length extension after the shift.
	 */
    protected static boolean saHasExtAfter(ShiftAssignment sa)
    {
<span class="nc bnc" id="L288" title="All 2 branches missed.">    	return (sa!= null &amp;&amp;</span>
<span class="nc bnc" id="L289" title="All 2 branches missed.">    			sa.getOTExtensionAfterActivityID()!= null &amp;&amp;</span>
<span class="nc bnc" id="L290" title="All 2 branches missed.">    			sa.getExtensionAfter()&gt;0);</span>
    }

	/**
	 * Returns true if the CustShiftReq has a non-zero length extension before the shift,
	 * and a non-null Activity.
	 */
	public static boolean hasExtBefore(CustShiftReq csr)
	{
<span class="nc bnc" id="L299" title="All 2 branches missed.">		if (csr.getExtBeforeDuration()==0 ||</span>
<span class="nc bnc" id="L300" title="All 2 branches missed.">				csr.getExtBeforeActivityID()==null) {</span>
<span class="nc" id="L301">			return false;</span>
		}

<span class="nc" id="L304">		return true;</span>
	}


	/**
	 * Returns true if the CustShiftReq has a non-zero length extension in gaps of the shift,
	 * and a non-null Activity.
	 */
	public static boolean hasExtInGaps(CustShiftReq csr)
	{
<span class="nc" id="L314">		Collection&lt;CustShiftReqGap&gt; gaps = csr.getChildObjects(CustShiftReqFieldInfo.CUSTREQGAP_CHILD_TYPE);</span>
<span class="nc bnc" id="L315" title="All 4 branches missed.">		if(gaps!=null &amp;&amp; gaps.size()&gt;0) {</span>
<span class="nc" id="L316">			return true;</span>
		}

<span class="nc" id="L319">		return false;</span>
	}

	/**
	 * Returns true if the CustShiftReq has a non-zero length extension after the shift,
	 * and a non-null Activity.
	 */
	public static boolean hasExtAfter(CustShiftReq csr)
	{
<span class="nc bnc" id="L328" title="All 2 branches missed.">		if (csr.getExtAfterDuration()==0 ||</span>
<span class="nc bnc" id="L329" title="All 2 branches missed.">				csr.getExtAfterActivityID()==null) {</span>
<span class="nc" id="L330">			return false;</span>
		}

<span class="nc" id="L333">		return true;</span>
	}

	/**
	 * Returns true if the CustShiftReq has a non-zero length shift,
	 * and a non-null Activity.
	 */
	public static boolean hasShift(CustShiftReq csr)
	{
<span class="nc bnc" id="L342" title="All 2 branches missed.">		if (csr.getShiftDurationinMinutes()==0 ||</span>
<span class="nc bnc" id="L343" title="All 2 branches missed.">				csr.getActivityID()==null) {</span>
<span class="nc" id="L344">			return false;</span>
		}

<span class="nc" id="L347">		return true;</span>
	}

	/**
	 * Given a date, return the start of the day and end of the day in the view time zone.
	 */
	public static Pair&lt;Date, Date&gt; getFullDayRange(Date date, TimeZone tz) {
<span class="nc bnc" id="L354" title="All 2 branches missed.">		if (date == null) {</span>
<span class="nc" id="L355">			date = new Date();</span>
		}

<span class="nc" id="L358">		Calendar cal = Calendar.getInstance(tz);</span>
<span class="nc" id="L359">		cal.setTime(date);</span>
<span class="nc" id="L360">		setTimeToMidnight(cal);</span>
<span class="nc" id="L361">		Date startDate = cal.getTime();</span>
<span class="nc" id="L362">		cal.add(Calendar.DATE, 1);</span>
<span class="nc" id="L363">		cal.add(Calendar.SECOND, -1);</span>

<span class="nc" id="L365">		return new Pair&lt;Date, Date&gt;(startDate, cal.getTime());</span>
	}

	protected static void setTimeToMidnight(Calendar cal)
	{
<span class="nc" id="L370">		cal.set(Calendar.HOUR_OF_DAY, 0);</span>
<span class="nc" id="L371">		cal.set(Calendar.MINUTE, 0);</span>
<span class="nc" id="L372">		cal.set(Calendar.SECOND, 0);</span>
<span class="nc" id="L373">		cal.set(Calendar.MILLISECOND, 0);</span>
<span class="nc" id="L374">	}</span>

	/**
	 * Convert a number of minutes into an hh:mm duration string, such as &quot;8:30&quot;.
	 */
	public static String getDurationString(Localizer localizer, int duration)
	{
<span class="nc" id="L381">		String hhmm = &quot;&quot;;</span>
<span class="nc" id="L382">		hhmm = localizer.formatDurationInMins(duration);</span>
<span class="nc" id="L383">		return hhmm;</span>
	}

	/**
	 * Return the duration string, such as &quot;8:30&quot;.
	 * @return
	 */
	public static String getDurationString(CustShiftReq csr, Localizer localizer)
	{
<span class="nc" id="L392">		return getDurationString(localizer, csr.getShiftDurationinMinutes());</span>
	}

	/**
	 * Return the duration string, such as &quot;8:30&quot;.
	 * @return
	 */
	public static String getExtBeforeDurationString(CustShiftReq csr, Localizer localizer)
	{
<span class="nc" id="L401">		return getDurationString(localizer, csr.getExtBeforeDuration());</span>
	}

	/**
	 * Return the duration string, such as &quot;8:30&quot;.
	 * @return
	 */
	public static String getExtAfterDurationString(CustShiftReq csr, Localizer localizer)
	{
<span class="nc" id="L410">		return getDurationString(localizer, csr.getExtAfterDuration());</span>
	}

	/**
	 * Return the duration string, such as &quot;8:30&quot;.
	 * @return
	 */
	public static String getExtBeforeGapString(CustShiftReq csr, Localizer localizer)
	{
<span class="nc" id="L419">		return getDurationString(localizer, csr.getExtBeforeGap());</span>
	}

	/**
	 * Return the duration string, such as &quot;8:30&quot;.
	 * @return
	 */
	public static String getExtAfterGapString(CustShiftReq csr, Localizer localizer)
	{
<span class="nc" id="L428">		return getDurationString(localizer, csr.getExtAfterGap());</span>
	}

	/**
	 * Create Date Wrapper
	 */
	protected static DateWrapper createDataWrapper(Date date, Localizer localizer, TimeZone tz)
	{
<span class="nc" id="L436">		return new DateWrapper(date, localizer, tz, RegionalFormatBundleKey.DATE_FORMAT, RegionalFormatBundleKey.TIME_FORMAT);</span>
	}

	/**
	 * Return the Shift end date string, such as &quot;5/01/2011 8:00 PM&quot;.
	 */
	public static String getShiftEndDateString(CustShiftReq csr, Localizer localizer, TimeZone tz)
	{
<span class="nc" id="L444">		DateWrapper endDate = createDataWrapper(csr.getShiftEndTime(), localizer, tz);</span>
<span class="nc" id="L445">		return endDate.getDisplay();</span>
	}

	/**
	 * Return the Shift start date string, such as &quot;5/01/2011 8:00 PM&quot;.
	 */
	public static String getShiftStartDateString(CustShiftReq csr, Localizer localizer, TimeZone tz)
	{
<span class="nc" id="L453">		DateWrapper startDate = createDataWrapper(csr.getShiftStartTime(), localizer, tz);</span>
<span class="nc" id="L454">		return startDate.getDisplay();</span>
	}

	/**
	 * Return the Request end date string, such as &quot;5/01/2011 8:00 PM&quot;.
	 * The request end date includes any extension after the shift. Only deltas are included.
	 */
	public static String getRequestEndDateString(CustShiftReq csr, Localizer localizer, TimeZone tz)
	{
<span class="nc" id="L463">		DateWrapper endDate = createDataWrapper(csr.getCSRequestDisplayRange().getEndDate(), localizer, tz);</span>
<span class="nc" id="L464">		return endDate.getDisplay();</span>
	}

	/**
	 * Return the Request start date string, such as &quot;5/01/2011 8:00 PM&quot;.
	 * The request start date includes any extension before the shift. Only deltas are included.
	 */
	public static String getRequestStartDateString(CustShiftReq csr, Localizer localizer, TimeZone tz)
	{
<span class="nc" id="L473">		DateWrapper startDate = createDataWrapper(csr.getCSRequestDisplayRange().getStartDate(), localizer, tz);</span>
<span class="nc" id="L474">		return startDate.getDisplay();</span>
	}

	/**
	 * We extend FormFourColumnPC in order to show one title per section.
	 */
	protected static class MyFormConfigColumnPC extends ListContainerPC
	{
<span class="nc" id="L482">		String[] m_colNames = null;</span>

		/**
		 * Constructor
		 * @param RequestContext context
		 */
		public MyFormConfigColumnPC(RequestContext context, String[] colNames) 
		{
<span class="nc" id="L490">			super(context, colNames.length*2);</span>
<span class="nc" id="L491">			m_name = &quot;listContainer&quot;;</span>
<span class="nc" id="L492">			m_colNames = colNames;</span>
<span class="nc" id="L493">		}</span>

		/**

		 */
		public void addRowData(List data) {	
<span class="nc" id="L499">			addRowData(new DefaultMultiColumnNodeData(&quot;&quot;, new ArrayList(data)));</span>
<span class="nc" id="L500">		}		</span>
		
		/**
		 * Append Header. Overrides the method from ListContainerPC.
		 */
		@Override
		protected void appendHeaderRow(StringBuffer sb)
		{
<span class="nc bnc" id="L508" title="All 2 branches missed.">			if (!m_showTitle) {</span>
<span class="nc" id="L509">				return;</span>
			}

<span class="nc" id="L512">			sb.append(&quot;\n&lt;tr&gt;&quot;);</span>
<span class="nc bnc" id="L513" title="All 2 branches missed.">			for(String name:m_colNames){</span>
<span class="nc" id="L514">				sb.append(&quot;&lt;td colspan=\&quot;&quot;).append(2).append(&quot;\&quot; &quot;)</span>
<span class="nc" id="L515">				.append(&quot;class=\&quot;&quot;).append(m_headerCssClass).append(&quot;\&quot; &quot;)</span>
<span class="nc" id="L516">				.append(&quot;&gt;&quot;).append(name).append(&quot;&lt;/td&gt;&quot;);</span>
			}
<span class="nc" id="L518">			sb.append(&quot;&lt;/tr&gt;&quot;);</span>
<span class="nc" id="L519">		}</span>
	}

	/**
	 * Sort Collection of Object (Shift/Activity/ShiftOTExtension) based on Locale information.
	 * @param onjects List of Objects (Shift/Activity/ShiftOTExtension). All must be of same type.
	 * @param isAsc Specify whether the sorting is ascending or descending
	 * @param lcontext The LocaleContext
	 */
	public static void sort(List onjects, boolean isAsc, LocaleContext lcontext)
	{
<span class="nc bnc" id="L530" title="All 4 branches missed.">		if (onjects.isEmpty() || onjects.size()==1) {</span>
<span class="nc" id="L531">			return;</span>
		}

<span class="nc" id="L534">		Localizer localizer = LocalizationManager.getInstance().getLocalizer(lcontext);</span>
<span class="nc" id="L535">		Comparator comp = new NameComparator(localizer, isAsc);</span>
<span class="nc" id="L536">		Collections.sort(onjects, comp);</span>
<span class="nc" id="L537">	}</span>

	/**
	 * Helper Class to compare Shift/Activity/ShiftOTExtension names
	 * You can only compare 2 like types.
	 */
<span class="nc" id="L543">	private static class NameComparator implements Comparator</span>
	{
		private final Collator m_collator;
		private final boolean m_isAsc;

		public NameComparator(Localizer localizer, boolean isAsc)
<span class="nc" id="L549">		{</span>
<span class="nc" id="L550">			m_collator = localizer.getCollator();</span>
<span class="nc" id="L551">			m_isAsc = isAsc;</span>
<span class="nc" id="L552">		}</span>

		@Override
		public int compare(Object o1, Object o2)
		{
<span class="nc" id="L557">			String name1=&quot;&quot;, name2=&quot;&quot;;</span>

<span class="nc bnc" id="L559" title="All 2 branches missed.">			if (o1 instanceof Shift)</span>
			{
<span class="nc" id="L561">				name1 = ((Shift)o1).getName();</span>
<span class="nc" id="L562">				name2 = ((Shift)o2).getName();</span>
			}
<span class="nc bnc" id="L564" title="All 2 branches missed.">			else if (o1 instanceof Activity)</span>
			{
<span class="nc" id="L566">				name1 = ((Activity)o1).getName();</span>
<span class="nc" id="L567">				name2 = ((Activity)o2).getName();</span>
			}
<span class="nc bnc" id="L569" title="All 2 branches missed.">			else if (o1 instanceof ShiftOTExtension)</span>
			{
<span class="nc" id="L571">				name1 = ((ShiftOTExtension)o1).getName();</span>
<span class="nc" id="L572">				name2 = ((ShiftOTExtension)o2).getName();</span>
			}

<span class="nc" id="L575">			int result = m_collator.compare(name1, name2);</span>

<span class="nc bnc" id="L577" title="All 2 branches missed.">			return m_isAsc ? result : (-1 * result);</span>
		}
	}

	  /**
	   * Create the Net Staffing Request Type Disambiguation Menu PC.
	   */
	  public static DialogToolbarMenuPC createNetStaffingDisambiguationMenu(RequestContext context, ToolbarPC toolbar, String name)
	  {
<span class="nc" id="L586">	    DialogToolbarMenuPC menuPC = new DialogToolbarMenuPC(context, toolbar);</span>
<span class="nc" id="L587">	    menuPC.setName(name);</span>

<span class="nc" id="L589">		Localizer localizer = context.getLocalizer();</span>
<span class="nc" id="L590">	    ResourceBundle bundle = localizer.getBundle(RmWebBundleKey.BUNDLE_NAME);</span>

	    // Initialize Title
<span class="nc" id="L593">	    String title = localizer.i18n(bundle, RmWebBundleKey.REQUEST_TYPE_LABEL);</span>
<span class="nc" id="L594">	    menuPC.setHeader(title);</span>

	    // Initialize Menu Buttons
<span class="nc" id="L597">	    menuPC.addPopupWindowButton(RmPageAction.POPUP_CUSTSHIFT_REQUEST_FORM_ACTION,</span>
<span class="nc" id="L598">	      localizer.i18n(bundle, RmWebBundleKey.REQUEST_TYPE_CUSTOM_SHIFT), true);</span>

<span class="nc" id="L600">	    menuPC.addPopupWindowButton(RmPageAction.POPUP_TIMEOFF_REQUEST_FORM_ACTION,</span>
<span class="nc" id="L601">	      localizer.i18n(bundle, RmWebBundleKey.REQUEST_TYPE_VTO), true);</span>

<span class="nc" id="L603">	    return menuPC;</span>
	  }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>