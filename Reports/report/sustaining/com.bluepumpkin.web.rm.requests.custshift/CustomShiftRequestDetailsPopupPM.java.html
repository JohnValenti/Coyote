<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>CustomShiftRequestDetailsPopupPM.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.rm.requests.custshift</a> &gt; <span class="el_source">CustomShiftRequestDetailsPopupPM.java</span></div><h1>CustomShiftRequestDetailsPopupPM.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.rm.requests.custshift;

import java.util.ArrayList;
import java.util.Collection;
import java.util.Date;
import java.util.List;

import com.witness.web.uif.base.Message;
import com.witness.web.uif.pagemodel.*;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.util.html.CSSUtil;
import com.witness.web.uif.pagecomponent.DefaultMultiColumnNodeData;
import com.witness.web.uif.pagecomponent.form.FormTwoColumnPC;
import com.bluepumpkin.ejb.bbm.schedule.model.ShiftAssignment;
import com.bluepumpkin.ejb.bbm.schedule.model.ShiftEventAssignment;
import com.bluepumpkin.ejb.bbm.workrules.model.Shift;
import com.bluepumpkin.ejb.bbm.workrules.model.ShiftOTExtension;
import com.bluepumpkin.ejb.rm.requests.common.ejb.Timeline;
import com.bluepumpkin.ejb.rm.requests.common.model.RequestAggregate;
import com.bluepumpkin.ejb.rm.requests.custshift.model.CustShiftReq;
import com.bluepumpkin.ejb.rm.requests.custshift.model.CustShiftReqFieldInfo;
import com.bluepumpkin.ejb.rm.requests.custshift.model.CustShiftReqGap;
import com.bluepumpkin.ejb.rm.util.LicenseUtil;
import com.bluepumpkin.web.rm.keys.*;
import com.bluepumpkin.web.rm.requests.*;
import com.bluepumpkin.web.rm.requests.custshift.CustomShiftUtil.MyFormConfigColumnPC;
import com.bluepumpkin.web.rm.l10n.RmWebBundleKey;
import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.Pair;
import com.bluepumpkin.ejb.bbm.activity.model.Activity;

/**
 * Title:		 CustomShiftRequestDetailsPopupPM
 * Description:  Custom Shift Request Details
 * Copyright:    Copyright (c) 2011
 * Company:      Verint Systems, inc
 * @author       Gonzalo Quintanar
 */
public class CustomShiftRequestDetailsPopupPM extends RequestDetailsPopupPM 
{
	//Member variables
	private CustShiftReq m_customShiftRequest;
<span class="nc" id="L43">	private boolean m_hasError = false;</span>
	protected FormTwoColumnPC m_shiftContainerPC;
	private MyFormConfigColumnPC m_extContainerPC;
	
	//These variables store information about the employee's scheduled shift assignment (if any) on the selected day
<span class="nc" id="L48">	private ShiftAssignment m_shiftAssignment = null; //the employee's scheduled shift assignment (if any) on the selected day</span>
	private Date m_saMainShiftStartTime; //the employee's scheduled main shift start time (excluding the gap before shift)
	private Date m_saMainShiftEndTime;   //the employee's scheduled main shift end time (excluding the gap after shift)
<span class="nc" id="L51">	private int m_saGapBeforeDuration = 0; //the employee's scheduled OT Before gap duration (if any) on the selected day</span>
<span class="nc" id="L52">	private int m_saGapAfterDuration = 0; //the employee's scheduled OT After gap duration (if any) on the selected day	</span>
	
	//these variables will be used to store the details of the requested shift
<span class="nc" id="L55">	private Shift m_shift = null;</span>
<span class="nc" id="L56">	private ShiftOTExtension m_extBeforeType = null;</span>
<span class="nc" id="L57">	private ShiftOTExtension m_extAfterType = null;</span>
<span class="nc" id="L58">	private Activity m_activity = null;</span>
<span class="nc" id="L59">	private Activity m_extBeforeActivity = null;</span>
<span class="nc" id="L60">	private Activity m_extAfterActivity = null;</span>
	
<span class="nc" id="L62">	private String m_extDuringGap = null;</span>
<span class="nc" id="L63">	private ShiftOTExtension m_extDuringGapType = null;</span>
<span class="nc" id="L64">	private Activity m_extDuringActivity = null;</span>
<span class="nc" id="L65">	private int m_extDuringGapDuration = 0;</span>
<span class="nc" id="L66">	private int m_extDuringGapGap = 0;</span>

	/**
	 * Constructor
	 */
	public CustomShiftRequestDetailsPopupPM(RequestContext context) 
	{
<span class="nc" id="L73">		super(context, RmKeys.RH_CUSTSHIFT_DETAILS);</span>
<span class="nc" id="L74">		setCustomShiftRequest(new CustShiftReq(CustShiftReq.DL_BASIC));</span>
<span class="nc" id="L75">	}</span>

	/**
	 * Return an instance of the model that is ready for rendering
	 */
	public static PageModel getInstance(RequestContext context) throws Exception 
	{
<span class="nc" id="L82">		return getInstance(context, CustomShiftRequestDetailsPopupPM.class);</span>
	}

	/**
	 * Fetch Sepecific Request for given ID
	 */
	protected RequestAggregate fetchRequest(ID requestID) throws Exception 
	{
<span class="nc" id="L90">		return CustomShiftRequestsMH.getCSRequest(requestID);</span>
	}

	/**
	 * Set the Custom Shift Request to be used
	 */
	public void setCustomShiftRequest(RequestAggregate request)
	{
<span class="nc" id="L98">		m_customShiftRequest = (CustShiftReq)request;</span>
<span class="nc" id="L99">		m_request = request;</span>
<span class="nc" id="L100">	}</span>
	
	/**
	 * Load Specific Data
	 */
	protected void loadSpecifiedData() throws Exception 
	{
		try	
		{
<span class="nc" id="L109">			setCustomShiftRequest(m_request);</span>
<span class="nc" id="L110">			m_valResults = m_customShiftRequest.getValidationResults(false);</span>
<span class="nc" id="L111">			m_hasError = false;</span>
			//m_orgSetting = RequestsMH.getOrgSettingForEmployee(m_context, m_empID);

<span class="nc" id="L114">			ID empID = m_customShiftRequest.getEmployeeID();</span>
			//CustomShiftUtil.setShiftStartTimeInExistingRequest(m_customShiftRequest, m_view_tz);
			
<span class="nc" id="L117">			Pair entireDayDates = getFromToDates(); </span>
<span class="nc" id="L118">			Date dayStart = (Date)entireDayDates.getFirst();</span>
<span class="nc" id="L119">			Date dayEnd = (Date)entireDayDates.getSecond();</span>
			
<span class="nc bnc" id="L121" title="All 2 branches missed.">			if (CustomShiftUtil.isShiftChangeSubType(m_customShiftRequest))</span>
			{
				//Since Shift Change requests only store deltas, we get the shift assignment, then merge the deltas into it.
<span class="nc" id="L124">				CustomShiftRequestsMH.CSDetailData csData = CustomShiftRequestsMH.getCSDetailDataForDetailsDialog(</span>
						m_context, empID, m_customShiftRequest, dayStart, dayEnd, m_bundle, m_view_tz);

<span class="nc" id="L127">				storeCSDataInMemberVars(csData);				</span>
				
<span class="nc bnc" id="L129" title="All 6 branches missed.">				if (m_customShiftRequest != null &amp;&amp; m_customShiftRequest.isPending() &amp;&amp;</span>
<span class="nc bnc" id="L130" title="All 2 branches missed.">				       (m_shiftAssignment == null || !checkHashCode(m_shiftAssignment, m_customShiftRequest)))</span>
				{
<span class="nc" id="L132">					addPageMessage(Message.ERROR_TYPE, i18n(m_bundle, RmWebBundleKey.CSR_ERROR_NO_SHIFT_ASSIGNMENT));</span>
					//m_hasError = true;
				}

				/* TBD: We may want to uncomment this in order to show ShiftAssignment info in the dialog. We'd probably
				   want to add *'s or something to indicate which sections are different than the ShiftAssignment				 
				if (m_shiftAssignment!=null &amp;&amp; !m_hasError)
				{
					CustShiftReq saRequest = (CustShiftReq) m_customShiftRequest.clone();
					CustomShiftUtil.convertShiftAssignmentToRequest(m_shiftAssignment, saRequest, 
							m_saMainShiftStartTime,	m_saMainShiftEndTime, m_saGapBeforeDuration, m_saGapAfterDuration, false);
					
					CustomShiftUtil.mergeExistingRequestDeltasIntoRequest(m_customShiftRequest, saRequest);
					m_customShiftRequest = saRequest;
				}
				*/
			}
			
<span class="nc" id="L150">			setCustomShiftRequest(m_customShiftRequest);</span>
			
<span class="nc bnc" id="L152" title="All 2 branches missed.">			if (!m_hasError)</span>
			{
				//Load the Shift, Activity, ExtBeforeShift, ExtBeforeActivity, ExtAfterShift, ExtAfterActivity
<span class="nc" id="L155">				CustomShiftRequestsMH.CSObjectData csObjects = CustomShiftRequestsMH.getCSObjectDataForDetailsDialog(m_context, m_customShiftRequest);</span>
<span class="nc" id="L156">				m_shift = csObjects.getShift();</span>
<span class="nc" id="L157">				m_extBeforeType = csObjects.getExtBeforeType();</span>
<span class="nc" id="L158">				m_extAfterType = csObjects.getExtAfterType();</span>
<span class="nc" id="L159">				m_activity = csObjects.getActivity();</span>
<span class="nc" id="L160">				m_extBeforeActivity = csObjects.getExtBeforeActivity();</span>
<span class="nc" id="L161">				m_extAfterActivity = csObjects.getExtAfterActivity();</span>
				
<span class="nc bnc" id="L163" title="All 2 branches missed.">				if(LicenseUtil.isAdvancedRMLicense()){</span>
<span class="nc" id="L164">					m_extDuringGap=csObjects.getExtDuringGap();</span>
<span class="nc" id="L165">					m_extDuringActivity=csObjects.getExtDuringGapActivity();</span>
<span class="nc" id="L166">					m_extDuringGapType=csObjects.getExtADuringGapType();</span>
					
<span class="nc bnc" id="L168" title="All 2 branches missed.">					if(m_extDuringGap!=null){</span>
<span class="nc" id="L169">						Collection gaps = m_customShiftRequest.getChildObjects(CustShiftReqFieldInfo.CUSTREQGAP_CHILD_TYPE);</span>
<span class="nc" id="L170">						CustShiftReqGap gap = (CustShiftReqGap)gaps.iterator().next();</span>
<span class="nc" id="L171">						m_extDuringGapDuration=gap.getExtGapDuration();</span>
<span class="nc" id="L172">						m_extDuringGapGap=gap.getExtGapGap();</span>
					}
				}
			}
		} 
<span class="nc" id="L177">		catch (Exception ex) </span>
		{
<span class="nc" id="L179">			handleUnableToLoadDataError(log, ex);</span>
<span class="nc" id="L180">		} 		</span>
<span class="nc" id="L181">	}</span>
	
	/**
	 * Return true if the hashCode of the ShiftAssignment object matches the one in the CustShiftReq hashCode field.
	 */
	public boolean checkHashCode(ShiftAssignment sa, CustShiftReq csr)
	{
<span class="nc" id="L188">		String sHashCodeFromDB = m_customShiftRequest.getHashCodeForUndrlyngShift();</span>
<span class="nc bnc" id="L189" title="All 2 branches missed.">		if (sHashCodeFromDB==null)</span>
<span class="nc" id="L190">			return false;</span>
		
		try
		{
<span class="nc" id="L194">			int iHashCodeFromDB = Integer.parseInt(sHashCodeFromDB);</span>
<span class="nc bnc" id="L195" title="All 2 branches missed.">			if (iHashCodeFromDB != sa.hashCode()){</span>
<span class="nc bnc" id="L196" title="All 4 branches missed.">				if (csr.getExtAfterID()!=null &amp;&amp; sa.getOTExtensionAfterID()!=null){</span>
<span class="nc" id="L197">					return false;</span>
				}
<span class="nc bnc" id="L199" title="All 4 branches missed.">				if (csr.getExtBeforeID()!=null &amp;&amp; sa.getOTExtensionBeforeID()!=null){</span>
<span class="nc" id="L200">					return false;</span>
				}
<span class="nc" id="L202">				Collection&lt;CustShiftReqGap&gt; gaps = csr.getChildObjects(CustShiftReqFieldInfo.CUSTREQGAP_CHILD_TYPE);</span>
<span class="nc bnc" id="L203" title="All 4 branches missed.">				if(gaps!=null &amp;&amp; gaps.size()&gt;0){</span>
<span class="nc" id="L204">					CustShiftReqGap gap = gaps.iterator().next();</span>
					//Check if gap exists in shift and is identical
					
					//Create timeline of shift
<span class="nc" id="L208">					Timeline t = new Timeline(sa.getStartTime(),sa.getEndTime());</span>
<span class="nc bnc" id="L209" title="All 2 branches missed.">					for(ShiftEventAssignment sea:sa.getChildren()){</span>
<span class="nc bnc" id="L210" title="All 2 branches missed.">						if(sea.getActivityID().compareTo(Activity.ACTIVITY_SHIFT_OVERTIME_GAP)==0){</span>
<span class="nc" id="L211">							t=t.subtract(new Timeline(sea.getStartTime(),sea.getEndTime()));</span>
						}
<span class="nc" id="L213">					}</span>
					
<span class="nc bnc" id="L215" title="All 2 branches missed.">					if (!t.intersect(new Timeline(gap.getExtGapStartTime(),gap.getExtGapEndTime())).isEmpty()){</span>
<span class="nc" id="L216">						return false;</span>
					}
				}
<span class="nc" id="L219">				return true;</span>
			} else {
<span class="nc" id="L221">				return true;</span>
			}
		}
<span class="nc" id="L224">		catch (NumberFormatException ex)</span>
		{
<span class="nc" id="L226">			return false;</span>
		}
	}
	
	protected void storeCSDataInMemberVars(CustomShiftRequestsMH.CSDetailData csData) throws Exception
	{
		//m_empNames = csData.getEmployeeNames();
		//m_orgSetting = csData.getOrgSetting();
		//m_empID = csData.getEmpID();
<span class="nc" id="L235">		m_shiftAssignment = csData.getShiftAssignment();				</span>
<span class="nc" id="L236">		m_saGapBeforeDuration = csData.getGapBeforeDuration();</span>
<span class="nc" id="L237">		m_saGapAfterDuration = csData.getGapAfterDuration();</span>
<span class="nc" id="L238">		m_saMainShiftStartTime = csData.getMainShiftStartTime();</span>
<span class="nc" id="L239">		m_saMainShiftEndTime = csData.getMainShiftEndTime();</span>
<span class="nc" id="L240">	}</span>
	
	/**
	 * Get a Pair of Dates, where the first one is the start of the currently selected day,
	 * and the second one is the end of the currently selected day. This range does NOT take
	 * the selected startTime into consideration.
	 * This range is NOT aligned with org day boundary. Should it be?
	 * 
	 * @param existingRequest - if null, we will get the current day set in the m_datePickerPC. If not null, 
	 * 		  	we will get the day from the existingRequest.
	 */
	public Pair getFromToDates()
	{
<span class="nc" id="L253">		Date date = m_customShiftRequest.getShiftStartTime();		</span>
<span class="nc" id="L254">		Pair dates = CustomShiftUtil.getFullDayRange(date, m_view_tz);		</span>
<span class="nc" id="L255">		return dates;</span>
	}
	
	/**
	 * Return Content Title Item Name
	 */
	protected String getContentTitleItemName()
	{
<span class="nc" id="L263">		return i18n(m_bundle, RmWebBundleKey.REQUEST_TYPE_CUSTOM_SHIFT);</span>
	}
	
	/**
	 * Initialize Content
	 */
	protected void initContent() 
	{
<span class="nc bnc" id="L271" title="All 2 branches missed.">		if (!m_hasError)</span>
		{
<span class="nc" id="L273">			initMainList();</span>
<span class="nc" id="L274">			initShiftList();</span>
<span class="nc" id="L275">			initExtensionsList();</span>
		}
<span class="nc" id="L277">		initAlertList();</span>
<span class="nc" id="L278">		initAuditTrailList();</span>
<span class="nc" id="L279">	}</span>

	/**
	 * Initialize Main List
	 */
	protected void initMainList() 
	{
<span class="nc" id="L286">		super.initMainList();</span>
<span class="nc" id="L287">		String mainContainerName = &quot;requestSummary&quot;;</span>
<span class="nc" id="L288">		String title = i18n(m_bundle, RmWebBundleKey.REQUEST_SUMMARY);</span>
		
<span class="nc" id="L290">		m_mainContainerPC.setTitle(title);</span>
<span class="nc" id="L291">		m_mainContainerPC.setSummary(i18n(m_bundle, RmWebBundleKey.REQUEST_SUMMARY_TABLE));</span>
		
<span class="nc bnc" id="L293" title="All 2 branches missed.">		if (isAccessibilityComplianceMode()) {</span>
<span class="nc" id="L294">			m_mainContainerPC.setName(mainContainerName);</span>
<span class="nc" id="L295">			m_mainContainerPC.setPCTitleSpan(title);</span>
<span class="nc" id="L296">			m_mainContainerPC.setWrapperRegion(true);</span>
		}

		// Employee Name
<span class="nc" id="L300">		addRowToComponent(m_mainContainerPC, i18n(m_bundle, RmWebBundleKey.EMPLOYEE_NAME_LABEL),</span>
<span class="nc" id="L301">				getEmployeeName(m_customShiftRequest.getEmployeeID()));</span>
		// Sub Type
<span class="nc" id="L303">		addRowToComponent(m_mainContainerPC, i18n(m_bundle, RmWebBundleKey.REQUEST_TYPE_LABEL),</span>
<span class="nc" id="L304">				CustomShiftUtil.getRequestSubTypeString(m_customShiftRequest, m_localizer));</span>
		// Start Date
<span class="nc" id="L306">		addRowToComponent(m_mainContainerPC, i18n(m_bundle, RmWebBundleKey.CSR_REQUEST_START_DATE),</span>
<span class="nc" id="L307">				CustomShiftUtil.getRequestStartDateString(m_customShiftRequest, m_localizer, m_view_tz));</span>
		// End Date
<span class="nc" id="L309">		addRowToComponent(m_mainContainerPC, i18n(m_bundle, RmWebBundleKey.CSR_REQUEST_END_DATE),</span>
<span class="nc" id="L310">				CustomShiftUtil.getRequestEndDateString(m_customShiftRequest, m_localizer, m_view_tz));</span>
<span class="nc" id="L311">	}</span>

	private void addRowToComponent(FormTwoColumnPC container, String leftObject, String rightObject) {
<span class="nc bnc" id="L314" title="All 2 branches missed.">		if (isAccessibilityComplianceMode()) {</span>
<span class="nc" id="L315">			container.addAriaLabelsRow(leftObject, rightObject);</span>
		} else {
<span class="nc" id="L317">			container.addRow(leftObject, rightObject);</span>
		}
<span class="nc" id="L319">	}</span>

	/**
	 * Initialize Shift List
	 */
	protected void initShiftList() 
	{
<span class="nc" id="L326">		String shiftContainerName = &quot;shiftContainer&quot;;</span>
<span class="nc" id="L327">		String shiftContainerTitle = i18n(m_bundle, RmWebBundleKey.RM_SA_FILTER_SHIFT);</span>
		
<span class="nc" id="L329">		m_shiftContainerPC = new FormTwoColumnPC(m_context);</span>
<span class="nc" id="L330">		m_containerList.add(m_shiftContainerPC);</span>
<span class="nc" id="L331">		m_shiftContainerPC.setWrapperCSSClass(CSSUtil.CLASS_BORDER_DEFAULT);</span>
<span class="nc" id="L332">		m_shiftContainerPC.setLastRowType(FormTwoColumnPC.LAST_ROW_NONE);		</span>
<span class="nc" id="L333">		m_shiftContainerPC.setTitle(shiftContainerTitle);</span>
<span class="nc" id="L334">		m_shiftContainerPC.setSummary(i18n(m_bundle, RmWebBundleKey.SHIFT_DETAILS_TABLE_NONEDITABLE));</span>
		
<span class="nc bnc" id="L336" title="All 2 branches missed.">		if (isAccessibilityComplianceMode()) {</span>
<span class="nc" id="L337">			m_shiftContainerPC.setName(shiftContainerName);</span>
<span class="nc" id="L338">			m_shiftContainerPC.setPCTitleSpan(shiftContainerTitle);</span>
		}

		// Shift Start Date
<span class="nc" id="L342">		addRowToComponent(m_shiftContainerPC, i18n(m_bundle, RmWebBundleKey.CSR_SHIFT_START_DATE),</span>
<span class="nc bnc" id="L343" title="All 2 branches missed.">				hasShift() ? CustomShiftUtil.getShiftStartDateString(m_customShiftRequest, m_localizer, m_view_tz) : &quot;&quot;);</span>

		// Shift End Date
<span class="nc" id="L346">		addRowToComponent(m_shiftContainerPC, i18n(m_bundle, RmWebBundleKey.CSR_SHIFT_END_DATE),</span>
<span class="nc bnc" id="L347" title="All 2 branches missed.">				hasShift() ? CustomShiftUtil.getShiftEndDateString(m_customShiftRequest, m_localizer, m_view_tz) : &quot;&quot;);</span>
		// Duration
<span class="nc" id="L349">		addRowToComponent(m_shiftContainerPC, i18n(m_bundle, RmWebBundleKey.CSR_DURATION),</span>
<span class="nc bnc" id="L350" title="All 2 branches missed.">				hasShift() ? CustomShiftUtil.getDurationString(m_customShiftRequest, m_localizer) : &quot;&quot;);</span>
		// Shift
<span class="nc" id="L352">		addRowToComponent(m_shiftContainerPC, i18n(m_bundle, RmWebBundleKey.RM_SA_FILTER_SHIFT),</span>
<span class="nc bnc" id="L353" title="All 4 branches missed.">				hasShift() ? (m_shift == null ? &quot;&quot; : m_shift.getName()) : &quot;&quot;);</span>
		// Activity
<span class="nc" id="L355">		addRowToComponent(m_shiftContainerPC, i18n(m_bundle, RmWebBundleKey.RM_SA_FILTER_ACTIVITY),</span>
<span class="nc bnc" id="L356" title="All 4 branches missed.">				hasShift() ? (m_activity == null ? &quot;&quot; : m_activity.getName()) : &quot;&quot;);</span>
		// Overtime
<span class="nc" id="L358">		addRowToComponent(m_shiftContainerPC, i18n(m_bundle, RmWebBundleKey.ORG_RM_FILING_RULE_OVERTIME),</span>
<span class="nc bnc" id="L359" title="All 4 branches missed.">				hasShift() ? (m_customShiftRequest.isOT() ? i18n(m_bundle, RmWebBundleKey.YES) : i18n(m_bundle, RmWebBundleKey.NO)) : &quot;&quot;);</span>
<span class="nc" id="L360">	}</span>
	
	/**
	 * Initialize the Extension Before &amp; After list container
	 */ 
	private void initExtensionsList() 
	{ 
		String[] columnNames;
<span class="nc bnc" id="L368" title="All 2 branches missed.">		if(LicenseUtil.isAdvancedRMLicense()){</span>
<span class="nc" id="L369">			columnNames = new String[]{i18n(m_bundle, RmWebBundleKey.CSR_EXTENSION_BEFORE_SHIFT),</span>
<span class="nc" id="L370">					i18n(m_bundle, RmWebBundleKey.CSR_EXTENSION_DURING_GAP),</span>
<span class="nc" id="L371">					i18n(m_bundle, RmWebBundleKey.CSR_EXTENSION_AFTER_SHIFT)</span>
			};
		} else {
<span class="nc" id="L374">			columnNames = new String[]{i18n(m_bundle, RmWebBundleKey.CSR_EXTENSION_BEFORE_SHIFT),</span>
<span class="nc" id="L375">					i18n(m_bundle, RmWebBundleKey.CSR_EXTENSION_AFTER_SHIFT)</span>
			};
		}
		
<span class="nc" id="L379">		m_extContainerPC = new MyFormConfigColumnPC(m_context, columnNames);			</span>
<span class="nc" id="L380">		m_extContainerPC.setWrapperCSSClass(CSSUtil.CLASS_BORDER_DEFAULT);</span>
<span class="nc" id="L381">		m_extContainerPC.setLastRowType(FormTwoColumnPC.LAST_ROW_NONE);</span>
<span class="nc" id="L382">		m_extContainerPC.setSummary(i18n(m_bundle, RmWebBundleKey.EXTENSION_DETAILS_TABLE));</span>

<span class="nc" id="L384">		List&lt;String&gt; data=new ArrayList();</span>
		//Type 
<span class="nc" id="L386">		data.add(m_localizer.i18n(m_bundle, RmWebBundleKey.CSR_TYPE));</span>
<span class="nc bnc" id="L387" title="All 2 branches missed.">		data.add(hasExtBefore() ? m_extBeforeType.getName() : &quot;&quot;);</span>
<span class="nc bnc" id="L388" title="All 2 branches missed.">		if(LicenseUtil.isAdvancedRMLicense()){</span>
			//Gap
<span class="nc" id="L390">			data.add(m_localizer.i18n(m_bundle, RmWebBundleKey.CSR_GAP));</span>
<span class="nc bnc" id="L391" title="All 2 branches missed.">			data.add(m_extDuringGap!=null ? m_extDuringGap : &quot;&quot;);</span>
		}
<span class="nc" id="L393">		data.add(m_localizer.i18n(m_bundle, RmWebBundleKey.CSR_TYPE));</span>
<span class="nc bnc" id="L394" title="All 2 branches missed.">		data.add(hasExtAfter() ? m_extAfterType.getName() : &quot;&quot;);</span>
	
<span class="nc" id="L396">		m_extContainerPC.addRowData(new DefaultMultiColumnNodeData(&quot;&quot;, new ArrayList(data)));</span>
<span class="nc" id="L397">		data.clear();</span>
		
		//Activity
<span class="nc" id="L400">		data.add(m_localizer.i18n(m_bundle, RmWebBundleKey.RM_SA_FILTER_ACTIVITY));</span>
<span class="nc bnc" id="L401" title="All 2 branches missed.">		data.add(hasExtBefore() ? m_extBeforeActivity.getName() : &quot;&quot;);</span>
<span class="nc bnc" id="L402" title="All 2 branches missed.">		if(LicenseUtil.isAdvancedRMLicense()){</span>
			//Type
<span class="nc" id="L404">			data.add(m_localizer.i18n(m_bundle, RmWebBundleKey.CSR_TYPE));</span>
<span class="nc bnc" id="L405" title="All 2 branches missed.">			data.add(m_extDuringGap!=null ? m_extDuringGapType.getName() : &quot;&quot;);</span>
		}
<span class="nc" id="L407">		data.add(m_localizer.i18n(m_bundle, RmWebBundleKey.RM_SA_FILTER_ACTIVITY));</span>
<span class="nc bnc" id="L408" title="All 2 branches missed.">		data.add(hasExtAfter() ? m_extAfterActivity.getName() : &quot;&quot;);</span>
	
<span class="nc" id="L410">		m_extContainerPC.addRowData(new DefaultMultiColumnNodeData(&quot;&quot;, new ArrayList(data)));</span>
<span class="nc" id="L411">		data.clear();</span>
		
		//Before/After Duration strings
<span class="nc" id="L414">		data.add(m_localizer.i18n(m_bundle, RmWebBundleKey.CSR_DURATION));</span>
<span class="nc" id="L415">		data.add(getExtBeforeDurationString());</span>
<span class="nc bnc" id="L416" title="All 2 branches missed.">		if(LicenseUtil.isAdvancedRMLicense()){</span>
			//Gap
<span class="nc" id="L418">			data.add(m_localizer.i18n(m_bundle, RmWebBundleKey.RM_SA_FILTER_ACTIVITY));</span>
<span class="nc bnc" id="L419" title="All 2 branches missed.">			data.add(m_extDuringGap!=null ? m_extDuringActivity.getName() : &quot;&quot;);</span>
		}
<span class="nc" id="L421">		data.add(m_localizer.i18n(m_bundle, RmWebBundleKey.CSR_DURATION));</span>
<span class="nc" id="L422">		data.add(getExtAfterDurationString());</span>
	
<span class="nc" id="L424">		m_extContainerPC.addRowData(new DefaultMultiColumnNodeData(&quot;&quot;, new ArrayList(data)));</span>
<span class="nc" id="L425">		data.clear();</span>
		
		//Before/After Gap 
<span class="nc" id="L428">		data.add(m_localizer.i18n(m_bundle, RmWebBundleKey.CSR_GAP));</span>
<span class="nc bnc" id="L429" title="All 2 branches missed.">		data.add(hasExtBefore() ? CustomShiftUtil.getExtBeforeGapString(m_customShiftRequest, m_localizer) : &quot;&quot;);</span>
<span class="nc bnc" id="L430" title="All 2 branches missed.">		if(LicenseUtil.isAdvancedRMLicense()){</span>
			//Gap
<span class="nc" id="L432">			data.add(m_localizer.i18n(m_bundle, RmWebBundleKey.CSR_DURATION));</span>
<span class="nc bnc" id="L433" title="All 2 branches missed.">			data.add(m_extDuringGap!=null ? getExtDuringGapDurationString() : &quot;&quot;);</span>
		}
<span class="nc" id="L435">		data.add(m_localizer.i18n(m_bundle, RmWebBundleKey.CSR_GAP));</span>
<span class="nc bnc" id="L436" title="All 2 branches missed.">		data.add(hasExtAfter() ? CustomShiftUtil.getExtAfterGapString(m_customShiftRequest, m_localizer) : &quot;&quot;);</span>
	
<span class="nc" id="L438">		m_extContainerPC.addRowData(new DefaultMultiColumnNodeData(&quot;&quot;, new ArrayList(data)));</span>
<span class="nc" id="L439">		data.clear();</span>
		
		//Before/After OT
<span class="nc" id="L442">		data.add(m_localizer.i18n(m_bundle, RmWebBundleKey.ORG_RM_FILING_RULE_OVERTIME));</span>
<span class="nc bnc" id="L443" title="All 4 branches missed.">		data.add(hasExtBefore() ? (m_customShiftRequest.getExtBeforeIsOT()?i18n(m_bundle, RmWebBundleKey.YES) : i18n(m_bundle, RmWebBundleKey.NO)) : &quot;&quot;);</span>
<span class="nc bnc" id="L444" title="All 2 branches missed.">		if(LicenseUtil.isAdvancedRMLicense()){</span>
			//Gap
<span class="nc" id="L446">			data.add(m_localizer.i18n(m_bundle, RmWebBundleKey.CSR_EXTENSION_GAP));</span>
<span class="nc bnc" id="L447" title="All 2 branches missed.">			data.add(m_extDuringGap!=null ? getExtDuringGapGapString() : &quot;&quot;);</span>
		}
<span class="nc" id="L449">		data.add(m_localizer.i18n(m_bundle, RmWebBundleKey.ORG_RM_FILING_RULE_OVERTIME));</span>
<span class="nc bnc" id="L450" title="All 4 branches missed.">		data.add(hasExtAfter() ? (m_customShiftRequest.getExtAfterIsOT()?i18n(m_bundle, RmWebBundleKey.YES) : i18n(m_bundle, RmWebBundleKey.NO)) : &quot;&quot;);</span>
	
<span class="nc" id="L452">		m_extContainerPC.addRowData(new DefaultMultiColumnNodeData(&quot;&quot;, new ArrayList(data)));</span>
		
<span class="nc" id="L454">		m_containerList.add(m_extContainerPC);</span>
<span class="nc" id="L455">	}</span>
	
	public boolean hasShift()
	{
<span class="nc" id="L459">		return CustomShiftUtil.hasShift(m_customShiftRequest);</span>
	}
	
	public boolean hasExtBefore()
	{
<span class="nc" id="L464">		return CustomShiftUtil.hasExtBefore(m_customShiftRequest);</span>
	}
	
	public boolean hasExtAfter()
	{
<span class="nc" id="L469">		return CustomShiftUtil.hasExtAfter(m_customShiftRequest);</span>
	}
	
	private String getExtBeforeDurationString()
	{
<span class="nc bnc" id="L474" title="All 2 branches missed.">		if (!hasExtBefore())</span>
<span class="nc" id="L475">			return &quot;&quot;;</span>
		
<span class="nc" id="L477">		return CustomShiftUtil.getExtBeforeDurationString(m_customShiftRequest, m_localizer);</span>
	}

	private String getExtAfterDurationString()
	{
<span class="nc bnc" id="L482" title="All 2 branches missed.">		if (!hasExtAfter())</span>
<span class="nc" id="L483">			return &quot;&quot;;</span>
		
<span class="nc" id="L485">		return CustomShiftUtil.getExtAfterDurationString(m_customShiftRequest, m_localizer);</span>
	}
	
	private String getExtDuringGapDurationString(){
<span class="nc bnc" id="L489" title="All 2 branches missed.">		if (m_extDuringGap==null)</span>
<span class="nc" id="L490">			return &quot;&quot;;</span>
		
<span class="nc" id="L492">		return CustomShiftUtil.getDurationString(m_localizer,m_extDuringGapDuration);</span>
	}
	
	private String getExtDuringGapGapString(){
<span class="nc bnc" id="L496" title="All 2 branches missed.">		if (m_extDuringGap==null)</span>
<span class="nc" id="L497">			return &quot;&quot;;</span>
		
<span class="nc" id="L499">		return CustomShiftUtil.getDurationString(m_localizer,m_extDuringGapGap);</span>
	}
	
	/**
	 * Create the collapsible Alert List PC. Overrides parent class.
	 *
	protected MultiColCollapsibleContainerPC createAlertsList() {
		MultiColCollapsibleContainerPC listPC = super.createAlertsList();
		listPC.getMultiColListPC().setRowSelectable(false);
		return listPC;
	}	
    */
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>