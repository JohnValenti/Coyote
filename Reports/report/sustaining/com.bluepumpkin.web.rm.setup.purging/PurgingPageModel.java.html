<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>PurgingPageModel.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.rm.setup.purging</a> &gt; <span class="el_source">PurgingPageModel.java</span></div><h1>PurgingPageModel.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.rm.setup.purging;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.ResourceBundle;

import javax.servlet.http.HttpServletRequest;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.LocalDate;
import com.bluepumpkin.common.datatypes.StringsPair;
import com.bluepumpkin.common.logging.Category;
import com.bluepumpkin.ejb.bbm.workresource.OrganizationScopeManagerProxy;
import com.bluepumpkin.ejb.rm.util.LicenseUtil;
import com.bluepumpkin.web.bbm.l10n.BbmWebBundleKey;
import com.bluepumpkin.web.bbm.organization.OrgWorkpaneFormPageModel;
import com.bluepumpkin.web.rm.Log;
import com.bluepumpkin.web.rm.l10n.RmWebBundleKey;
import com.witness.ejb.core.security.PrivilegeKeys;
import com.witness.web.uif.base.Message;
import com.witness.web.uif.keys.JavaScriptFileID;
import com.witness.web.uif.keys.PageAction;
import com.witness.web.uif.l10n.UIFWebBundleKey;
import com.witness.web.uif.pagecomponent.container.ListContainerPC;
import com.witness.web.uif.pagecomponent.picker.date.DateRangePickerPC;
import com.witness.web.uif.pagemodel.PageModel;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.util.HtmlUtil;
import com.witness.web.uif.util.html.HtmlChoiceInput;
import com.witness.web.uif.util.js.JSUtil;
import com.witness.web.uif.validator.IsPosIntegerFieldValidator;

/**
 * Title          PurgingPageModel
 * Description    Displays the Purging page
 * Copyright      Copyright (c) 2002
 * Company        Blue Pumpkin Software, Inc
 * @author        Howard Mullings
 * @version       1.0
 */
@SuppressWarnings(&quot;serial&quot;)
public class PurgingPageModel extends OrgWorkpaneFormPageModel {
<span class="nc" id="L44">	private static final Category m_log = Log.initCategory(PurgingPageModel.class.getName());</span>

	private static final String REQUEST_TYPE_FN  = &quot;requestType&quot;;
	private static final String WHAT_REQUEST_FN  = &quot;whatRequest&quot;;
	private static final String APPLY_DELETE_FN  = &quot;applyDelete&quot;;
	private static final String ADVANCE_COUNT_FN = &quot;advanceCount&quot;;
	private static final String DATE_RANGE_FN    = &quot;dateRange&quot;;
	private static final String REQUEST_START_DATE_RANGE_FN    = &quot;requestStartDateRange&quot;;

	public static final String WHAT_REQ_DATE_VAL = &quot;dates&quot;;
	public static final String WHAT_REQ_All_VAL = &quot;allTypes&quot;;
	public static final String WHAT_REQ_ADVANCE_DAYS_VAL = &quot;advanceDays&quot;;
	public static final String WHAT_REQ_START_DATE_VAL = &quot;startDates&quot;;
	public static final String APPLY_TO_CURRENT_ORGANIZATION_VAL = &quot;0&quot;;
	public static final String APPLY_TO_ORGANIZATION_BRANCH_VAL = &quot;1&quot;;

<span class="nc" id="L60">	private final HashMap           m_reqData = new HashMap(13);</span>
	private final DateRangePickerPC m_dateRangePC;
	private final DateRangePickerPC m_startDateRangePC;
	@SuppressWarnings(&quot;rawtypes&quot;)
	private List              m_requestTypes;
	private final ListContainerPC   m_purgingPC;
	private final ResourceBundle    m_rmBundle;

	/**
	 * Constuctor
	 */
	public PurgingPageModel(RequestContext context) {
<span class="nc" id="L72">		super(context);</span>

<span class="nc" id="L74">		m_rmBundle = m_localizer.getBundle(RmWebBundleKey.BUNDLE_NAME);</span>

		// Component specific required JavaScript Files
<span class="nc" id="L77">		addRequiredJavaScriptFile(JavaScriptFileID.MEDIATOR_WORKPANE);</span>
<span class="nc" id="L78">		setJSMediator(JavaScriptFileID.MEDIATOR_WORKPANE_GENERIC);</span>

<span class="nc" id="L80">		addJSVariable(DELETE_CONFIRMATION,</span>
				m_rmBundle,
				RmWebBundleKey.PURGE_REQUEST_CONFIRMATION);

<span class="nc" id="L84">		m_purgingPC = new ListContainerPC(m_context);</span>

<span class="nc" id="L86">		m_dateRangePC = new DateRangePickerPC(context,</span>
				DATE_RANGE_FN,
<span class="nc" id="L88">				context.getViewingTimeZone());</span>

<span class="nc" id="L90">		m_startDateRangePC = new DateRangePickerPC(context,</span>
				REQUEST_START_DATE_RANGE_FN,
<span class="nc" id="L92">				context.getViewingTimeZone());</span>

<span class="nc" id="L94">		addChildComponent(m_purgingPC);</span>
<span class="nc" id="L95">		addChildComponent(m_dateRangePC);</span>
<span class="nc" id="L96">		addChildComponent(m_startDateRangePC);</span>
<span class="nc" id="L97">		setIsIgnorePageDirty(false);</span>
<span class="nc" id="L98">	}</span>

	/**
	 * Return an instance of PurgingPageModel ready to be rendered in JSP
	 * @param   context RequestContext
	 * @return  PurgingPageModel  instance of PurgingPageModel
	 */
	public static PageModel getInstance(RequestContext context) throws Exception {
<span class="nc" id="L106">		return getInstance(context, PurgingPageModel.class);</span>
	}

	/**
	 * Create Form Model
	 */
	@Override
	protected void createFormModel() {
		try {
<span class="nc bnc" id="L115" title="All 2 branches missed.">			if (!isAuthorizedToConfigure()) {</span>
				String key;
<span class="nc" id="L117">				key = BbmWebBundleKey.NOT_AUTHORIZED_TO_CONFIG_SELECTED_ORG;</span>
<span class="nc" id="L118">				String msg = i18n(m_bbmBundle, key);</span>
<span class="nc" id="L119">				addPageMessage(Message.RESPONSE_TYPE, msg);</span>
			}

			// Get the request type list data
<span class="nc" id="L123">			m_requestTypes = PurgingModelHandler.getRequestTypes(getSelectedIDObject(),</span>
					m_rmBundle, m_localizer);
<span class="nc" id="L125">		} catch (Exception ex) {</span>
<span class="nc" id="L126">			handleUnableToLoadDataError(m_log, ex);</span>
<span class="nc" id="L127">		}</span>
<span class="nc" id="L128">	}</span>

	/**
	 * Initialize Form Display, sets the form elements
	 */
	@Override
	protected void initForm() {
<span class="nc" id="L135">		setForm(m_purgingPC);</span>
<span class="nc" id="L136">		m_purgingPC.setTitle(getFormTitle());</span>
<span class="nc bnc" id="L137" title="All 4 branches missed.">		if (m_requestTypes == null || m_requestTypes.size() == 0)  {</span>
<span class="nc" id="L138">			return;</span>
		}

<span class="nc" id="L141">		ArrayList applyToList = getApplyOrgStatus();</span>


		// The requestType array list is assumed to have items in the
		// following order:
		// 1) All
		// 2) Shift Bid
		// 3) Shift swap
		// 4) Custom Shift
		// 5) Time Off	 *
		// 6) Flex Time *
		//
		// When shift bidding is added this logic must be changed.
<span class="nc bnc" id="L154" title="All 2 branches missed.">		if (canConfigureAll()) {</span>
			// no modifications are necessary since the user is authorized to
			// do everything.

			@SuppressWarnings(&quot;unchecked&quot;)
<span class="nc" id="L159">			List&lt;StringsPair&gt; timeOffEntries = (List&lt;StringsPair&gt;) m_requestTypes.remove(4); // remove 'time-off' entries</span>
			@SuppressWarnings(&quot;unchecked&quot;)
<span class="nc" id="L161">			List&lt;StringsPair&gt; flexTimeEntries = (List&lt;StringsPair&gt;) m_requestTypes.remove(4); // remove 'flex-time' entries</span>
<span class="nc" id="L162">			m_requestTypes.addAll(timeOffEntries);</span>
<span class="nc bnc" id="L163" title="All 2 branches missed.">			if (isAuthorizedToConfigureFT()) {</span>
<span class="nc" id="L164">				m_requestTypes.addAll(flexTimeEntries);</span>
			}
<span class="nc bnc" id="L166" title="All 2 branches missed.">		} else if (canConfigureNothing()) {</span>
			// not authorized to purge anything...
<span class="nc" id="L168">			m_requestTypes.clear();</span>
<span class="nc" id="L169">			applyToList.clear();</span>
		}
		else {
<span class="nc" id="L172">			m_requestTypes.remove(0); // remove 'all'</span>
<span class="nc" id="L173">			StringsPair shiftBidEntry = (StringsPair) m_requestTypes.remove(0); // remove 'shift-bid'</span>
<span class="nc" id="L174">			StringsPair shiftSwapEntry = (StringsPair) m_requestTypes.remove(0); // remove 'shift-swap'</span>
<span class="nc" id="L175">			StringsPair customShiftEntry = (StringsPair) m_requestTypes.remove(0); // remove 'cust-shift'</span>
			@SuppressWarnings(&quot;unchecked&quot;)
<span class="nc" id="L177">			List&lt;StringsPair&gt; timeOffEntries = (List&lt;StringsPair&gt;) m_requestTypes.remove(0); // remove 'time-off' entries</span>
			@SuppressWarnings(&quot;unchecked&quot;)
<span class="nc" id="L179">			List&lt;StringsPair&gt; flexTimeEntries = (List&lt;StringsPair&gt;) m_requestTypes.remove(0); // remove 'flex-time' entries</span>
<span class="nc" id="L180">			List&lt;Object&gt; newRequestTypes = new ArrayList&lt;Object&gt;();</span>
<span class="nc bnc" id="L181" title="All 2 branches missed.">			if (isAuthorizedToConfigureSB()) {</span>
<span class="nc" id="L182">				newRequestTypes.add(shiftBidEntry);</span>
			}

<span class="nc bnc" id="L185" title="All 2 branches missed.">			if (isAuthorizedToConfigureSS()) {</span>
<span class="nc" id="L186">				newRequestTypes.add(shiftSwapEntry);</span>
			}

<span class="nc bnc" id="L189" title="All 2 branches missed.">			if (isAuthorizedToConfigureCS()) {</span>
<span class="nc" id="L190">				newRequestTypes.add(customShiftEntry);</span>
			}

<span class="nc bnc" id="L193" title="All 2 branches missed.">			if (isAuthorizedToConfigureTOM()) {</span>
<span class="nc" id="L194">				newRequestTypes.addAll(timeOffEntries);</span>
			}

<span class="nc bnc" id="L197" title="All 2 branches missed.">			if (isAuthorizedToConfigureFT()) {</span>
<span class="nc" id="L198">				newRequestTypes.addAll(flexTimeEntries);</span>
			}

<span class="nc" id="L201">			m_requestTypes = newRequestTypes;</span>
		}

<span class="nc" id="L204">		String selReqTypeValue = &quot;&quot;;</span>
<span class="nc" id="L205">		String selApplyValue = &quot;&quot;;</span>
<span class="nc bnc" id="L206" title="All 2 branches missed.">		if (m_requestTypes.size() != 0)</span>
<span class="nc" id="L207">			selReqTypeValue = ((StringsPair)m_requestTypes.get(0)).getValue();</span>

<span class="nc bnc" id="L209" title="All 2 branches missed.">		if (applyToList.size() != 0)</span>
<span class="nc" id="L210">			selApplyValue = ((StringsPair)applyToList.get(0)).getValue();</span>

		// add the selection row that contains the Request Type list and the apply to list
<span class="nc" id="L213">		Object args[] = new Object[]{</span>
<span class="nc" id="L214">			HtmlUtil.makeSelectInput(REQUEST_TYPE_FN,selReqTypeValue,m_requestTypes),</span>
<span class="nc" id="L215">			HtmlUtil.makeSelectInput(APPLY_DELETE_FN,selApplyValue,applyToList)</span>
			};
<span class="nc" id="L217">		String strRow = m_localizer.i18n(m_rmBundle,RmWebBundleKey.ORG_RM_PURGING_TYPE_AND_ORG_PHRASE, args);</span>
<span class="nc" id="L218">		m_purgingPC.addRowData(strRow);</span>

		// add the selection row that contains the All option
<span class="nc" id="L221">		m_purgingPC.addRowData(</span>
<span class="nc" id="L222">				HtmlChoiceInput.makeRadioInput(WHAT_REQUEST_FN,</span>
					WHAT_REQUEST_FN,
					&quot; &quot;,
					false,
<span class="nc bnc" id="L226" title="All 2 branches missed.">					!isAuthorizedToConfigure(),</span>
					JSUtil.ON_CHANGE)
<span class="nc" id="L228">				+ i18n(m_rmBundle,RmWebBundleKey.ORG_RM_PURGING_ALL_REQ_LABEL));</span>

		// add the selection row that contains the Advance Days option
<span class="nc" id="L231">		args = new Object[]{</span>
<span class="nc" id="L232">			HtmlUtil.makeTextInput(ADVANCE_COUNT_FN,5,3,&quot;14&quot;,JSUtil.ON_CHANGE,isAuthorizedToConfigure())</span>
			};
<span class="nc" id="L234">		String label = m_localizer.i18n(m_rmBundle, RmWebBundleKey.ORG_RM_PURGING_PAST_DAYS_PHRASE,args);</span>
<span class="nc" id="L235">		m_purgingPC.addRowData(</span>
<span class="nc" id="L236">				HtmlChoiceInput.makeRadioInput(WHAT_REQUEST_FN,</span>
					WHAT_REQ_ADVANCE_DAYS_VAL,
					&quot; &quot;,
<span class="nc" id="L239">					isAuthorizedToConfigure(),</span>
<span class="nc bnc" id="L240" title="All 2 branches missed.">					!isAuthorizedToConfigure(),</span>
					JSUtil.ON_CHANGE)
				+ label);

		// have to call this method before converting this object to a string.
<span class="nc" id="L245">		m_dateRangePC.setIsPickerEnabled(isAuthorizedToConfigure());</span>
<span class="nc" id="L246">		m_dateRangePC.initForDisplay();</span>

		// add the selection row that contains the Date range option
<span class="nc" id="L249">		args = new Object[]{m_dateRangePC};</span>
<span class="nc" id="L250">		label = m_localizer.i18n(m_rmBundle,RmWebBundleKey.ORG_RM_PURGING_FROM_TO_PHRASE,args);</span>
<span class="nc" id="L251">		m_purgingPC.addRowData(</span>
<span class="nc" id="L252">				HtmlChoiceInput.makeRadioInput(WHAT_REQUEST_FN,</span>
					WHAT_REQ_DATE_VAL,
					&quot; &quot;,
					false,
<span class="nc bnc" id="L256" title="All 2 branches missed.">					!isAuthorizedToConfigure(),</span>
					JSUtil.ON_CHANGE)
				+ label);

		//purge requests starting during range
		//		 have to call this method before converting this object to a string.
<span class="nc" id="L262">		m_startDateRangePC.setIsPickerEnabled(isAuthorizedToConfigure());</span>
<span class="nc" id="L263">		m_startDateRangePC.initForDisplay();</span>

		// add the selection row that contains the Date range option
<span class="nc" id="L266">		args = new Object[]{m_startDateRangePC};</span>
<span class="nc" id="L267">		label = m_localizer.i18n(m_rmBundle,RmWebBundleKey.ORG_RM_PURGING_FROM_TO_REQ_START_PHRASE,args);</span>
<span class="nc" id="L268">		m_purgingPC.addRowData(</span>
<span class="nc" id="L269">				HtmlChoiceInput.makeRadioInput(WHAT_REQUEST_FN,</span>
						WHAT_REQ_START_DATE_VAL,
					&quot; &quot;,
					false,
<span class="nc bnc" id="L273" title="All 2 branches missed.">					!isAuthorizedToConfigure(),</span>
					JSUtil.ON_CHANGE)
				+ label);

<span class="nc" id="L277">		m_purgingPC.setLastRowType(ListContainerPC.LAST_ROW_NONE);</span>
<span class="nc" id="L278">	}</span>

	private boolean canConfigureAll() {
<span class="nc bnc" id="L281" title="All 4 branches missed.">		boolean canConfigure = isAuthorizedToConfigureTOM() &amp;&amp; isAuthorizedToConfigureSS() &amp;&amp;</span>
<span class="nc bnc" id="L282" title="All 4 branches missed.">				isAuthorizedToConfigureSB() &amp;&amp; isAuthorizedToConfigureCS();</span>
		
<span class="nc bnc" id="L284" title="All 2 branches missed.">		if(!LicenseUtil.isAdvancedRMLicense()) {</span>
<span class="nc" id="L285">			return canConfigure;</span>
		}
		
<span class="nc bnc" id="L288" title="All 4 branches missed.">		return canConfigure &amp;&amp; isAuthorizedToConfigureFT();</span>
	}

	private boolean canConfigureNothing() {
<span class="nc bnc" id="L292" title="All 4 branches missed.">		boolean canConfigure = !isAuthorizedToConfigureTOM() &amp;&amp; !isAuthorizedToConfigureSS() &amp;&amp;</span>
<span class="nc bnc" id="L293" title="All 4 branches missed.">				!isAuthorizedToConfigureSB() &amp;&amp; !isAuthorizedToConfigureCS();</span>

<span class="nc bnc" id="L295" title="All 2 branches missed.">		if (!LicenseUtil.isAdvancedRMLicense()) {</span>
<span class="nc" id="L296">			return canConfigure;</span>
		}

<span class="nc bnc" id="L299" title="All 4 branches missed.">		return canConfigure &amp;&amp; !isAuthorizedToConfigureFT();</span>
	}



	/**
	 * Set Request Type Name
	 * @param   name String
	 */
	public void setRequestType(String name) {
<span class="nc" id="L309">		m_reqData.put(&quot;REQUEST_TYPE_FN&quot;,name);</span>
<span class="nc" id="L310">	}</span>

	/**
	 * Returns the request type selected
	 * @return  String Identifes the request type
	 */
	public String getRequestType() {
<span class="nc" id="L317">		return (String)m_reqData.get(&quot;REQUEST_TYPE_FN&quot;);</span>
	}

	/**
	 * Sets the OrganizationID
	 * @param orgID	Identifies the OrganizationID
	 */
	public void setOrgID(ID orgID) {
<span class="nc" id="L325">		m_reqData.put(&quot;ORGANIZATION_ID&quot;,orgID);</span>
<span class="nc" id="L326">	}</span>

	/**
	 * Gets the OrganizationID
	 * @return  ID Identifes the OrganizationID
	 */
	public ID getOrgID() {
<span class="nc" id="L333">		return (ID)m_reqData.get(&quot;ORGANIZATION_ID&quot;);</span>
	}


	/**
	 * Identifies if the request is applied to the current organization or the branch
	 * @param   name String
	 */
	public void setApplyDelete(String name) {
<span class="nc" id="L342">		m_reqData.put(&quot;APPLY_DELETE_FN&quot;,name);</span>
<span class="nc" id="L343">	}</span>

	/**
	 * @return  String
	 */
	public String getApplyDelete() {
<span class="nc" id="L349">		return (String)m_reqData.get(&quot;APPLY_DELETE_FN&quot;);</span>
	}

	public boolean isForBranch() {
<span class="nc" id="L353">		return getApplyDelete().equals(APPLY_TO_ORGANIZATION_BRANCH_VAL);</span>
	}


	/**
	 * Sets the Request subtype
	 * @param   name String Identifies the Request subtype
	 */
	public void setWhatRequest(String name) {
<span class="nc" id="L362">		m_reqData.put(&quot;WHAT_REQUEST_FN&quot;,name);</span>
<span class="nc" id="L363">	}</span>

	/**
	 * Returns the Request subtype selected
	 * @return  String Identifies the Request subtype
	 */
	public String getWhatRequest() {
<span class="nc" id="L370">		return (String)m_reqData.get(&quot;WHAT_REQUEST_FN&quot;);</span>
	}

	/**
	 * Sets the advance count
	 * @param   name String Identifies the advance count
	 */
	public void setAdvanceCount(String name) {
<span class="nc" id="L378">		m_reqData.put(&quot;ADVANCE_COUNT_FN&quot;,name);</span>
<span class="nc" id="L379">	}</span>

	/**
	 * Returns the advance count
	 * @return  String Identifies the advance count
	 */
	public String getAdvanceCount() {
<span class="nc" id="L386">		return (String)m_reqData.get(&quot;ADVANCE_COUNT_FN&quot;);</span>
	}

	/**
	 * Sets the start date
	 * @param sDate String Identifies the start date
	 */
	public void setStartDate(LocalDate sDate) {
<span class="nc" id="L394">		m_reqData.put(&quot;START_DATE_FN&quot;,sDate);</span>

<span class="nc" id="L396">	}</span>

	/**
	 * Returns the start date
	 * @return  String Identifies the start date
	 */
	public LocalDate getStartDate() {
<span class="nc" id="L403">		return (LocalDate)m_reqData.get(&quot;START_DATE_FN&quot;);</span>
	}

	/**
	 * Sets the end date
	 * @param eDate String Identifies the end date
	 */
	public void setEndDate(LocalDate eDate) {
<span class="nc" id="L411">		m_reqData.put(&quot;END_DATE_FN&quot;,eDate);</span>
<span class="nc" id="L412">	}</span>

	/**
	 * Returns the end date
	 * @return  String Identifies the end date
	 */
	public LocalDate getEndDate() {
<span class="nc" id="L419">		return (LocalDate)m_reqData.get(&quot;END_DATE_FN&quot;);</span>
	}

	/**
	 * Sets the start date
	 * @param sDate String Identifies the start date
	 */
	public void setRequestStartDate(LocalDate sDate) {
<span class="nc" id="L427">		m_reqData.put(&quot;REQUEST_START_DATE_FN&quot;,sDate);</span>

<span class="nc" id="L429">	}</span>

	/**
	 * Returns the request start date
	 * @return  String Identifies the start date
	 */
	public LocalDate getRequestStartDate() {
<span class="nc" id="L436">		return (LocalDate)m_reqData.get(&quot;REQUEST_START_DATE_FN&quot;);</span>
	}

	/**
	 * Sets the request start date
	 * @param sDate String Identifies the start date
	 */
	public void setRequestEndDate(LocalDate sDate) {
<span class="nc" id="L444">		m_reqData.put(&quot;REQUEST_END_DATE_FN&quot;,sDate);</span>

<span class="nc" id="L446">	}</span>

	/**
	 * Returns the request start date
	 * @return  String Identifies the start date
	 */
	public LocalDate getRequestEndDate() {
<span class="nc" id="L453">		return (LocalDate)m_reqData.get(&quot;REQUEST_END_DATE_FN&quot;);</span>
	}

	/**
	 * Initialize the Toolbar
	 * Adds the Delete Requests and Revert button
	 */
	@Override
	protected void initToolbar() {
<span class="nc" id="L462">		String deleteLabel = i18n(m_rmBundle,</span>
				RmWebBundleKey.ORG_RM_PURGING_DELETE_ACTION);
<span class="nc" id="L464">		String revertLabel = i18n(m_common_bundle,</span>
				UIFWebBundleKey.TOOLBAR_RESET);

<span class="nc" id="L467">		m_toolbar.setName(getName() + &quot;_toolbar&quot;);</span>

<span class="nc" id="L469">		m_toolbar.addDeleteTextButton(PageAction.DELETE,</span>
				deleteLabel,
<span class="nc" id="L471">				isAuthorizedToConfigure());</span>

<span class="nc" id="L473">		m_toolbar.addResetTextButton(PageAction.RESET,</span>
				revertLabel,
<span class="nc" id="L475">				isAuthorizedToConfigure());</span>
<span class="nc" id="L476">	}</span>

	/**
	 * Adds the IntegerFiledValidator for Advance Count Field
	 */
	@Override
	protected void initFieldValidators() {
		// Add Field Validators
<span class="nc" id="L484">		addValidator(new IsPosIntegerFieldValidator(this,</span>
				ADVANCE_COUNT_FN, RmWebBundleKey.ORG_RM_PURGING_DAYS_SUFFIX_LABEL,
				RmWebBundleKey.BUNDLE_NAME));
<span class="nc" id="L487">	}</span>

	/**
	 * Return the form title
	 * @return form title
	 */
	@Override
	public String getFormTitle() {
<span class="nc" id="L495">		return i18n(m_rmBundle,RmWebBundleKey.ORG_RM_PURGING_TITLE);</span>
	}

	/**
	 * Gets entity name. Used for title.
	 * @return String Identifies the title entity
	 */
	@Override
	protected String getTitleEntityType() {
<span class="nc" id="L504">		return getEntityName();</span>
	}

	/**
	 * Returns an entity name. Used for title.
	 * @return String Identifies the entity name
	 */
	@Override
	protected String getEntityName() {
<span class="nc" id="L513">		return i18n(m_rmBundle, RmWebBundleKey.ORG_RM_PURGING_LABEL);</span>
	}

	/**
	 * Return URL for HTML Form Action
	 */
	@Override
	public String getFormAction() {
<span class="nc" id="L521">		return &quot;request_processing_purging&quot;;</span>
	}

	/**
	 * Override extract Parameters to handle date input
	 */
	@Override
	public boolean extractParameters(HttpServletRequest request) {
<span class="nc" id="L529">		boolean success = super.extractParameters(request);</span>

<span class="nc" id="L531">		setOrgID(getSelectedIDObject());</span>

<span class="nc" id="L533">		m_dateRangePC.extractParameters(request);</span>
<span class="nc" id="L534">		setStartDate(m_dateRangePC.getStartDatePickerPC().getLocalDate());</span>
<span class="nc" id="L535">		setEndDate(m_dateRangePC.getEndDatePickerPC().getLocalDate());</span>

<span class="nc" id="L537">		m_startDateRangePC.extractParameters(request);</span>
<span class="nc" id="L538">		setRequestStartDate(m_startDateRangePC.getStartDatePickerPC().getLocalDate());</span>
<span class="nc" id="L539">		setRequestEndDate(m_startDateRangePC.getEndDatePickerPC().getLocalDate());</span>

<span class="nc" id="L541">		return success;</span>
	}

	/**
	 * Custom validation for Start/End Date Range
	 */
	@Override
	public boolean validate() {
<span class="nc" id="L549">		boolean success = super.validate();</span>

		// Validate Start/End Date Range
<span class="nc" id="L552">		LocalDate startDate = getStartDate();</span>
<span class="nc" id="L553">		LocalDate endDate = getEndDate();</span>

<span class="nc bnc" id="L555" title="All 6 branches missed.">		if (startDate != null &amp;&amp; endDate != null &amp;&amp; startDate.after(endDate)) {</span>
<span class="nc" id="L556">			addPageMessage(Message.ERROR_TYPE,</span>
					UIFWebBundleKey.DATE_DEF_ERROR_SDATE_AFTER_EDATE,
					UIFWebBundleKey.BUNDLE_NAME);
<span class="nc" id="L559">			success = false;</span>
		}

<span class="nc" id="L562">		return success;</span>
	}

	/**
	 * Returns a collection of Apply to status
	 */
	private ArrayList getApplyOrgStatus()
	{
<span class="nc" id="L570">		ArrayList applyOrg = new ArrayList();</span>

<span class="nc" id="L572">		applyOrg.add(new StringsPair(APPLY_TO_CURRENT_ORGANIZATION_VAL,</span>
<span class="nc" id="L573">				i18n(m_rmBundle, RmWebBundleKey.ORG_RM_PURGING_CURRENT_ORG)));</span>
<span class="nc" id="L574">		applyOrg.add(new StringsPair(APPLY_TO_ORGANIZATION_BRANCH_VAL,</span>
<span class="nc" id="L575">				i18n(m_rmBundle, RmWebBundleKey.ORG_RM_PURGING_ORG_BRANCH)));</span>

<span class="nc" id="L577">		return applyOrg;</span>
	}

	@Override
	protected boolean isAuthorizedToView() {
<span class="nc bnc" id="L582" title="All 6 branches missed.">		return isAuthorizedToViewTOM() || isAuthorizedToViewFT() || isAuthorizedToViewSS()</span>
<span class="nc bnc" id="L583" title="All 2 branches missed.">				|| isAuthorizedToViewSB()</span>
<span class="nc bnc" id="L584" title="All 2 branches missed.">				|| isAuthorizedToViewCS();</span>
	}

	protected boolean isAuthorizedToViewTOM() {
<span class="nc bnc" id="L588" title="All 2 branches missed.">		return isValidSelectedOrg() &amp;&amp;</span>
<span class="nc bnc" id="L589" title="All 2 branches missed.">				m_context.getUser().isAuthorized(</span>
<span class="nc" id="L590">						PrivilegeKeys.TOM_PURGEREQUESTS, OrganizationScopeManagerProxy.getScopeID(getSelectedIDObject()));</span>
	}

	protected boolean isAuthorizedToViewFT() {
<span class="nc bnc" id="L594" title="All 2 branches missed.">		return isValidSelectedOrg() &amp;&amp;</span>
<span class="nc bnc" id="L595" title="All 2 branches missed.">				m_context.getUser().isAuthorized(</span>
<span class="nc" id="L596">						PrivilegeKeys.FT_PURGEREQUESTS, OrganizationScopeManagerProxy.getScopeID(getSelectedIDObject()));</span>
	}

	protected boolean isAuthorizedToViewSB() {
<span class="nc bnc" id="L600" title="All 2 branches missed.">		return isValidSelectedOrg() &amp;&amp;</span>
<span class="nc bnc" id="L601" title="All 2 branches missed.">				m_context.getUser().isAuthorized(</span>
<span class="nc" id="L602">						PrivilegeKeys.SB_PURGEREQUESTS, OrganizationScopeManagerProxy.getScopeID(getSelectedIDObject()));</span>
	}

	protected boolean isAuthorizedToViewSS() {
<span class="nc bnc" id="L606" title="All 2 branches missed.">		return isValidSelectedOrg() &amp;&amp;</span>
<span class="nc bnc" id="L607" title="All 2 branches missed.">				m_context.getUser().isAuthorized(</span>
<span class="nc" id="L608">						PrivilegeKeys.SS_PURGEREQUESTS, OrganizationScopeManagerProxy.getScopeID(getSelectedIDObject()));</span>
	}

	protected boolean isAuthorizedToViewCS() {
<span class="nc bnc" id="L612" title="All 2 branches missed.">		return isValidSelectedOrg() &amp;&amp;</span>
<span class="nc bnc" id="L613" title="All 2 branches missed.">				m_context.getUser().isAuthorized(</span>
<span class="nc" id="L614">						PrivilegeKeys.CS_PURGEREQUESTS, OrganizationScopeManagerProxy.getScopeID(getSelectedIDObject()));</span>
	}

	@Override
	protected boolean isAuthorizedToConfigure() {
<span class="nc bnc" id="L619" title="All 2 branches missed.">		return isAuthorizedToConfigureTOM() ||</span>
<span class="nc bnc" id="L620" title="All 2 branches missed.">				isAuthorizedToConfigureFT() ||</span>
<span class="nc bnc" id="L621" title="All 2 branches missed.">				isAuthorizedToConfigureSS() ||</span>
<span class="nc bnc" id="L622" title="All 2 branches missed.">				isAuthorizedToConfigureSB() ||</span>
<span class="nc bnc" id="L623" title="All 2 branches missed.">				isAuthorizedToConfigureCS() ;</span>
	}

	protected boolean isAuthorizedToConfigureTOM() {
<span class="nc bnc" id="L627" title="All 2 branches missed.">		return isValidSelectedOrg() &amp;&amp;</span>
<span class="nc bnc" id="L628" title="All 2 branches missed.">				m_context.getUser().isAuthorized(</span>
<span class="nc" id="L629">						PrivilegeKeys.TOM_PURGEREQUESTS, OrganizationScopeManagerProxy.getScopeID(getSelectedIDObject()));</span>
	}

	protected boolean isAuthorizedToConfigureFT() {
<span class="nc bnc" id="L633" title="All 4 branches missed.">		return LicenseUtil.isAdvancedRMLicense() &amp;&amp; isValidSelectedOrg() &amp;&amp;</span>
<span class="nc bnc" id="L634" title="All 2 branches missed.">				m_context.getUser().isAuthorized(</span>
<span class="nc" id="L635">						PrivilegeKeys.FT_PURGEREQUESTS, OrganizationScopeManagerProxy.getScopeID(getSelectedIDObject()));</span>
	}

	protected boolean isAuthorizedToConfigureSS() {
<span class="nc bnc" id="L639" title="All 2 branches missed.">		return isValidSelectedOrg() &amp;&amp;</span>
<span class="nc bnc" id="L640" title="All 2 branches missed.">				m_context.getUser().isAuthorized(</span>
<span class="nc" id="L641">						PrivilegeKeys.SS_PURGEREQUESTS, OrganizationScopeManagerProxy.getScopeID(getSelectedIDObject()));</span>
	}

	protected boolean isAuthorizedToConfigureSB() {
<span class="nc bnc" id="L645" title="All 2 branches missed.">		return isValidSelectedOrg() &amp;&amp;</span>
<span class="nc bnc" id="L646" title="All 2 branches missed.">				m_context.getUser().isAuthorized(</span>
<span class="nc" id="L647">						PrivilegeKeys.SB_PURGEREQUESTS, OrganizationScopeManagerProxy.getScopeID(getSelectedIDObject()));</span>
	}

	protected boolean isAuthorizedToConfigureCS() {
<span class="nc bnc" id="L651" title="All 2 branches missed.">		return isValidSelectedOrg() &amp;&amp;</span>
<span class="nc bnc" id="L652" title="All 2 branches missed.">				m_context.getUser().isAuthorized(</span>
<span class="nc" id="L653">						PrivilegeKeys.CS_PURGEREQUESTS, OrganizationScopeManagerProxy.getScopeID(getSelectedIDObject()));</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>