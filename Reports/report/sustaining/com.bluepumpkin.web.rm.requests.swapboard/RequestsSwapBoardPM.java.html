<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>RequestsSwapBoardPM.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.rm.requests.swapboard</a> &gt; <span class="el_source">RequestsSwapBoardPM.java</span></div><h1>RequestsSwapBoardPM.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.rm.requests.swapboard;

import java.rmi.RemoteException;
import java.util.ArrayList;
import java.util.Collection;
import java.util.Collections;
import java.util.Date;
import java.util.List;
import java.util.Map;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.Pair;
import com.bluepumpkin.ejb.bbm.base.BbmException;
import com.bluepumpkin.ejb.rm.base.RmHardValidationException;
import com.bluepumpkin.ejb.rm.requests.swap.posting.model.SSPostingCollection;
import com.bluepumpkin.ejb.rm.requests.swap.posting.model.ShiftSwapPosting;
import com.bluepumpkin.web.fs.schedule.personal.PersonalTextSchedulePM;
import com.bluepumpkin.web.rm.keys.RmImageFileID;
import com.bluepumpkin.web.rm.keys.RmJavaScriptFileID;
import com.bluepumpkin.web.rm.keys.RmKeys;
import com.bluepumpkin.web.rm.keys.RmPageAction;
import com.bluepumpkin.web.rm.l10n.RmWebBundleKey;
import com.bluepumpkin.web.rm.requests.RequestUtil;
import com.bluepumpkin.web.rm.requests.RequestsPM;
import com.bluepumpkin.web.rm.requests.SwapUtil;
import com.bluepumpkin.web.rm.requests.shiftswap.ShiftSwapRequestsMH;
import com.witness.ejb.core.security.PrivilegeKeys;
import com.witness.web.uif.base.Message;
import com.witness.web.uif.jsp.HtmlDiv;
import com.witness.web.uif.jsp.HtmlDivWSpan;
import com.witness.web.uif.keys.ImageFileID;
import com.witness.web.uif.keys.PageAction;
import com.witness.web.uif.l10n.UIFWebBundleKey;
import com.witness.web.uif.pagecomponent.BaseNodeData;
import com.witness.web.uif.pagecomponent.DefaultMultiColumnNodeData;
import com.witness.web.uif.pagecomponent.list.MultiColListPC;
import com.witness.web.uif.pagecomponent.picker.date.DatePickerPC;
import com.witness.web.uif.pagecomponent.table.TableHeaderPC;
import com.witness.web.uif.pagemodel.PageModel;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.util.HtmlUtil;
import com.witness.web.uif.util.SortUtil;
import com.witness.web.uif.util.html.HtmlChoiceInput;
import com.witness.web.uif.util.js.JSUtil;

/**
 * Title:        RequestsSwapBoardPM
 * Description:  My Shift Swap bulletin board.
 * Copyright:    Copyright (c) 2001
 * Company:      Blue Pumpkin Software, inc
 * @author       Zhibo, David Su
 * @version      1.0
 */
public class RequestsSwapBoardPM extends RequestsPM {
	private static final String POPUP_FORM_ACTION = RmPageAction.POPUP_SWAPBOARD_POSTING_FORM_ACTION;
	private static final String FORM_ACTION = &quot;my_requests_swapboard&quot;;
	private static final String VIEW_MODE_FN = &quot;viewMode&quot;;
	private static final String POSTING_ID_FN = &quot;postingID&quot;;

	private DatePickerPC m_datePicker;
<span class="nc" id="L61">	private Map m_eNameMap = Collections.emptyMap();</span>
<span class="nc" id="L62">	private Map m_eOrgMap = Collections.emptyMap();</span>
	private String m_viewMode;
	private ID m_postingID;
<span class="nc" id="L65">	private boolean m_isAuthorized=false;</span>
<span class="nc" id="L66">	protected boolean m_isIncludePartial = true;</span>
<span class="nc" id="L67">	private List&lt;DefaultMultiColumnNodeData&gt; multiColListModel = Collections.emptyList();</span>

	public static final String ALL_POSTINGS = &quot;ALL_POSTINGS&quot;;
	public static final String MY_POSTINGS = &quot;MY_POSTINGS&quot;;
	public static final String POSTING_BY_ORG = &quot;POSTING_BY_ORG&quot;;
	public static final String POSTING_BY_CAMP = &quot;POSTING_BY_CAMP&quot;;

	/**
	 * Constructs a schedule view page model shell.
	 */
	public RequestsSwapBoardPM(RequestContext context) {
<span class="nc" id="L78">		super(context);</span>

<span class="nc" id="L80">		m_isAuthorized = isAuthorized();</span>
<span class="nc" id="L81">		m_viewMode = RequestUtil.getCachedSwapBoardViewMode(m_context);</span>

<span class="nc" id="L83">		setDefaultPageIDSize(50);</span>
<span class="nc" id="L84">	}</span>

	/**
	 * Initialize Component For Display
	 */
	@Override
	public void initForDisplay() {
<span class="nc bnc" id="L91" title="All 2 branches missed.">		if (m_isInitializedForDisplay) return;</span>
		else {
<span class="nc" id="L93">			super.initForDisplay();</span>

<span class="nc" id="L95">			setJSMediator(RmJavaScriptFileID.MEDIATOR_POSTING);</span>
<span class="nc" id="L96">			addJSVariable(&quot;WITHDRAW_CONFIRMATION&quot;, m_bundle,</span>
					RmWebBundleKey.SWAPBOARD_POSTING_WITHDRAW_CONFIRMATION);
<span class="nc" id="L98">			addJSVariableAsString(&quot;VIEW_SCHEDULE_URL&quot;,</span>
					PersonalTextSchedulePM.FORM_ACTION);

<span class="nc" id="L101">			initShiftSwapPopupWindowArgs();</span>
		}
<span class="nc" id="L103">	}</span>

	/**
	 * Add Page Not Enabled Message
	 */
	@Override
	protected void addPageNotEnabledMsg() {
<span class="nc" id="L110">		SwapUtil.addSSNotEnabledMsg(this);</span>
<span class="nc" id="L111">	}</span>

	@Override
	protected MultiColListPC getMultiColListPC(RequestContext context) {
<span class="nc" id="L115">		return new MultiColListPC(context) {</span>
			protected HtmlDiv getNewHtmlDiv() {				
<span class="nc" id="L117">				return new HtmlDivWSpan(getPCAriaLabelID(), i18n(m_bundle, RmWebBundleKey.SWAPBOARD_GRID_LABEL));</span>
			}
			protected boolean skipEncloseForKeyboardAccess(BaseNodeData nodeData) {
<span class="nc bnc" id="L120" title="All 2 branches missed.">				return !nodeData.isSelectable();</span>
			}
		};
	}		

	/**
	 * Return instance of Model which is ready to be rendered
	 */
	public static PageModel getInstance(RequestContext context) throws Exception {
<span class="nc" id="L129">		return getInstance(context, RequestsSwapBoardPM.class);</span>
	}
	
	private SSPostingCollection getPostingCollection() throws RmHardValidationException, RemoteException, BbmException{
<span class="nc" id="L133">		int pageIDSize = Integer.MAX_VALUE;</span>
<span class="nc" id="L134">		SSPostingCollection result = null;</span>
		
<span class="nc bnc" id="L136" title="All 2 branches missed.">		if (ALL_POSTINGS.equals(m_viewMode)) {</span>
<span class="nc" id="L137">			result = RequestsSwapBoardMH.getAllPostings(m_empID, pageIDSize, m_isIncludePartial);</span>
<span class="nc bnc" id="L138" title="All 2 branches missed.">		} else if ( POSTING_BY_CAMP.equals(m_viewMode) ) {</span>
<span class="nc" id="L139">			result = RequestsSwapBoardMH.getMyCampaignPostings(m_empID, pageIDSize, m_isIncludePartial);</span>
<span class="nc bnc" id="L140" title="All 2 branches missed.">		} else if ( POSTING_BY_ORG.equals(m_viewMode) ) {</span>
<span class="nc" id="L141">			result = RequestsSwapBoardMH.getMyOrgPostings(m_empID, pageIDSize, m_isIncludePartial);</span>
		} else {
<span class="nc" id="L143">			result = RequestsSwapBoardMH.getMyPostings(m_empID, pageIDSize, m_isIncludePartial);</span>
		}
		
<span class="nc" id="L146">		return result;</span>
	}
	
	/*
	 * The first element in the returned pair is the list of all posting ids sorted per the current selection
	 * The second element is the list model for the current page that is being displayed 
	 */
	private Pair&lt;List&lt;ID&gt;, List&lt;DefaultMultiColumnNodeData&gt; &gt; sortAndPaginate(Collection&lt;ShiftSwapPosting&gt; allPostings){
		
<span class="nc" id="L155">		List&lt;DefaultMultiColumnNodeData&gt; listModel = getListModelFromPostings(allPostings);</span>
		
		//sort on currently selected column
<span class="nc" id="L158">		TableHeaderPC header = m_list.getHeader();</span>
<span class="nc" id="L159">		int[] sortColumnIndexes = header.getSortColumnIndexes();</span>
<span class="nc bnc" id="L160" title="All 4 branches missed.">		if(listModel == null || listModel.isEmpty() ) {</span>
<span class="nc" id="L161">			return new Pair&lt;List&lt;ID&gt;, List&lt;DefaultMultiColumnNodeData&gt; &gt;( Collections.emptyList(), Collections.emptyList());</span>
		}
		
<span class="nc" id="L164">		boolean isAscending = header.isAscending();</span>
<span class="nc bnc" id="L165" title="All 2 branches missed.">		if( sortColumnIndexes != null){</span>
<span class="nc" id="L166">			SortUtil.sort(listModel, sortColumnIndexes, isAscending, m_localizer);</span>
		}
		
		
<span class="nc" id="L170">		List&lt;ID&gt; sortedPostingIds = new ArrayList&lt;ID&gt;(listModel.size());</span>
<span class="nc bnc" id="L171" title="All 2 branches missed.">		for(DefaultMultiColumnNodeData rowData: listModel){</span>
<span class="nc" id="L172">			ID postingId = new ID(  Integer.parseInt(rowData.getID()));</span>
<span class="nc" id="L173">			sortedPostingIds.add(postingId);</span>
<span class="nc" id="L174">		}</span>
		
		//now get the current page
<span class="nc" id="L177">		int pageSize = getPageIDSize();</span>
		//getPagePaginationIndex() does not seem to return the value of the current page. Use getEditIndex instead
<span class="nc bnc" id="L179" title="All 2 branches missed.">		int pageNumber = pageSize&gt;0? getEditIndex()/pageSize : 0; </span>
<span class="nc" id="L180">		List&lt;DefaultMultiColumnNodeData&gt; pagedModel =  com.verint.web.rm.rest.util.RmUtils.pageList(listModel, pageSize, pageNumber);</span>

<span class="nc" id="L182">		return new Pair&lt;List&lt;ID&gt;, List&lt;DefaultMultiColumnNodeData&gt; &gt;(sortedPostingIds,pagedModel);</span>
	}

	/**
	 * Populate Model
	 */
	@Override
	protected void loadData() throws Exception {
<span class="nc bnc" id="L190" title="All 2 branches missed.">		if (m_isAuthorized) {</span>
<span class="nc" id="L191">			m_orgSetting = ShiftSwapRequestsMH.getOrgSettingForEmployee(m_context, m_empID);</span>
<span class="nc bnc" id="L192" title="All 2 branches missed.">			if (m_orgSetting == null){</span>
<span class="nc" id="L193">				this.addPageMessage(Message.ERROR_TYPE, RmWebBundleKey.EMP_NO_ORG,</span>
    					RmWebBundleKey.BUNDLE_NAME);
<span class="nc" id="L195">            	return;</span>
			}
<span class="nc" id="L197">			m_isPageEnabled = m_orgSetting.getEnableShiftSwap();</span>

<span class="nc bnc" id="L199" title="All 2 branches missed.">			if (m_isPageEnabled) {</span>
				try {
<span class="nc" id="L201">					initDatePicker();</span>
					//headers are initialized here since we need to sort based on the sort column header to paginate correctly
<span class="nc" id="L203">					initHeader();</span>
					Collection&lt;ShiftSwapPosting&gt; postings;

<span class="nc bnc" id="L206" title="All 2 branches missed.">					if (isPaginationNavPressed()) {</span>
						//the user clicked one of the page buttons (next,previous, etc..)
<span class="nc" id="L208">						postings = RequestsSwapBoardMH.getPostings(getPageIDs());</span>
<span class="nc" id="L209">						setupNameAndOrgMap(postings);</span>
<span class="nc" id="L210">						multiColListModel = getListModelFromPostings(postings);</span>
					} else {
<span class="nc" id="L212">						SSPostingCollection result = getPostingCollection();</span>
<span class="nc" id="L213">						postings = result.getPostings();</span>
<span class="nc" id="L214">						setupNameAndOrgMap(postings);</span>
<span class="nc" id="L215">						Pair&lt;List&lt;ID&gt;, List&lt;DefaultMultiColumnNodeData&gt; &gt;  pagedData =  sortAndPaginate(postings);</span>
<span class="nc" id="L216">						setPaginationIDs(pagedData.getFirst());</span>
<span class="nc" id="L217">						multiColListModel = pagedData.getSecond();</span>
					}
					
<span class="nc" id="L220">				} catch (RmHardValidationException ex) {</span>
<span class="nc" id="L221">					Message msg = handleUnableToLoadDataError(log, ex);</span>
<span class="nc" id="L222">					msg.setAssociatedMessage(ex.getLocalizedMessage(m_localizer, m_context.getViewingTimeZone()));</span>
<span class="nc" id="L223">				}</span>
			}
		}
<span class="nc" id="L226">	}</span>
	
	private void setupNameAndOrgMap(Collection&lt;ShiftSwapPosting&gt; postings) throws RemoteException, BbmException{
<span class="nc" id="L229">		Collection&lt;ID&gt; empIDList = RequestsSwapBoardMH.getUniqueEmpIDsForPostings(postings);</span>
<span class="nc" id="L230">		m_eNameMap = RequestsSwapBoardMH.getEmpNameMap(m_context, empIDList);</span>
<span class="nc" id="L231">		m_eOrgMap = RequestsSwapBoardMH.getEmpOrgMap(m_context, empIDList);</span>
<span class="nc" id="L232">	}</span>

	/**
	 * Initialize Popup Window Arguments for Shift Swap
	 */
	@Override
	protected void initShiftSwapPopupWindowArgs() {
<span class="nc" id="L239">		addPopupArgs(RmPageAction.POPUP_AGENT_SKILLS_ACTION, RmKeys.RH_AGENT_SKILLS,</span>
				null, &quot;employeeID,shiftDate1,shiftDate2&quot;, &quot;450,350,ctr,ctr&quot;, true, 1);

<span class="nc" id="L242">		addPopupArgs(RmPageAction.POPUP_SHIFTSWAP_REQUEST_FORM_ACTION, RmKeys.RH_SHIFTSWAP_FORM,</span>
				null, &quot;postingID&quot;, &quot;560,545,ctr,ctr&quot;, true, 1);

<span class="nc" id="L245">		addPopupArgs(POPUP_FORM_ACTION, RmKeys.RH_SWAPBOARD_FORM,</span>
				null, &quot;postingID&quot;, &quot;560,500,ctr,ctr&quot;, true, 1);
<span class="nc" id="L247">	}</span>

	/**
	 * Initialize Date Picker used to create Date Input Value for View Schedule
	 */
	protected void initDatePicker() {
<span class="nc" id="L253">		m_datePicker = new DatePickerPC(m_context, &quot;&quot;);</span>
<span class="nc" id="L254">	}</span>

	/**
	 * Initialize Header
	 */
	@Override
	protected void initHeader() {
<span class="nc" id="L261">		TableHeaderPC header = m_list.getHeader();</span>
<span class="nc" id="L262">		Collection headers = header.getHeaders();</span>
<span class="nc bnc" id="L263" title="All 4 branches missed.">		if(headers!=null &amp;&amp; headers.size()!=0){</span>
<span class="nc" id="L264">			return;</span>
		}
		
<span class="nc" id="L267">		header.setPartialSortable(true);</span>

<span class="nc" id="L269">		addHeaderData(header, m_common_bundle, UIFWebBundleKey.NAME, true);</span>
<span class="nc" id="L270">		addHeaderData(header, m_bundle, RmWebBundleKey.SHIFT_DATE, true);</span>
<span class="nc" id="L271">		addHeaderData(header, m_common_bundle, UIFWebBundleKey.START, false);</span>
<span class="nc" id="L272">		addHeaderData(header, m_common_bundle, UIFWebBundleKey.END, false);</span>
<span class="nc" id="L273">		addHeaderData(header, m_bundle, RmWebBundleKey.POST_EXPIRES, true);</span>
<span class="nc bnc" id="L274" title="All 2 branches missed.">		if (m_isIncludePartial)</span>
<span class="nc" id="L275">			addHeaderData(header, m_bundle, RmWebBundleKey.PARTIAL_SHIFT, true);</span>
<span class="nc" id="L276">		addHeaderData(header, m_common_bundle, UIFWebBundleKey.CONFIRM, true);</span>
<span class="nc" id="L277">		addHeaderData(header, m_bundle, RmWebBundleKey.SWAPTYPE, true);</span>
<span class="nc" id="L278">		addHeaderData(header, m_common_bundle, UIFWebBundleKey.COMMENTS, false);</span>
<span class="nc" id="L279">		addHeaderData(header, m_common_bundle, UIFWebBundleKey.ACTIONS, false);</span>
<span class="nc" id="L280">	}</span>
	
	
	private List&lt;DefaultMultiColumnNodeData&gt; getListModelFromPostings(Collection&lt;ShiftSwapPosting&gt; postings){
<span class="nc" id="L284">		List&lt;DefaultMultiColumnNodeData&gt; listModel = new ArrayList&lt;DefaultMultiColumnNodeData&gt;();</span>
<span class="nc" id="L285">		ID myEmpID = m_user.getEmployeeID();</span>
		
<span class="nc bnc" id="L287" title="All 2 branches missed.">		for(ShiftSwapPosting posting: postings) {</span>
			// Create the row data
<span class="nc" id="L289">			String rowID = posting.getID().toString();</span>
<span class="nc" id="L290">			DefaultMultiColumnNodeData row_data = new DefaultMultiColumnNodeData(rowID);</span>

<span class="nc bnc" id="L292" title="All 2 branches missed.">			if (isAccessibilityComplianceMode()) {			</span>
<span class="nc" id="L293">				String instructionMessage = m_localizer.i18n(m_bundle, RmWebBundleKey.ACTIVE_LINK_INSTRUCTION_MESSAGE,</span>
<span class="nc" id="L294">						i18n(m_bundle, RmWebBundleKey.SKILLS_DETAIL));</span>
<span class="nc" id="L295">				SwapUtil.addAgentName(m_user, posting, m_eNameMap, m_eOrgMap, m_localizer, row_data, instructionMessage);</span>
<span class="nc" id="L296">			} else {</span>
<span class="nc" id="L297">				SwapUtil.addAgentName(m_user, posting, m_eNameMap, m_eOrgMap, m_localizer, row_data);</span>
			}
			
<span class="nc" id="L300">			SwapUtil.addShiftDates(posting, m_localizer, m_view_tz, row_data);</span>
<span class="nc" id="L301">			SwapUtil.addPostExpirationDate(posting, m_localizer, m_view_tz, row_data);</span>
<span class="nc bnc" id="L302" title="All 2 branches missed.">			if (m_isIncludePartial)</span>
<span class="nc" id="L303">				SwapUtil.addIsPartial(posting, m_localizer, row_data);</span>
<span class="nc" id="L304">			SwapUtil.addConfirmData(posting, m_localizer, row_data);</span>
<span class="nc" id="L305">			SwapUtil.addSwapTypeImage(posting.getSwapType(), m_bundle, m_localizer, row_data, isAccessibilityComplianceMode());</span>
<span class="nc" id="L306">			addComment(posting, row_data);</span>
<span class="nc" id="L307">			addItemActions(posting, myEmpID, rowID, row_data);</span>

			// Add row data to list model
<span class="nc" id="L310">			listModel.add(row_data);</span>
<span class="nc" id="L311">		}</span>
<span class="nc" id="L312">		return listModel;</span>
	}

	/**
	 * Initialize Selectable Items
	 */
	@Override
	protected void initSelectableItems() {
<span class="nc bnc" id="L320" title="All 2 branches missed.">		if (isAccessibilityComplianceMode()) {</span>
<span class="nc" id="L321">			m_list.setUseWrapper(true);</span>
<span class="nc" id="L322">			m_list.addTableArrowNavigation();</span>
<span class="nc" id="L323">			m_list.setReadableRowInfoEnabled(true);</span>
<span class="nc" id="L324">			m_list.disableRepeatHeader();</span>
		}
<span class="nc bnc" id="L326" title="All 4 branches missed.">		if (multiColListModel==null || multiColListModel.isEmpty()){</span>
<span class="nc" id="L327">			return;</span>
		}

		// Initialize Date Picker used to create Date input Value for View Schedule
		
<span class="nc" id="L332">		m_list.setListModel(multiColListModel);</span>
<span class="nc" id="L333">		m_list.setIsAutoSortEnabled(true);</span>
<span class="nc" id="L334">		m_list.setHasRowHeaders(false);</span>
<span class="nc" id="L335">	}</span>

	/**
	 * Add Posting Comment
	 */
	protected void addComment(ShiftSwapPosting posting, DefaultMultiColumnNodeData row_data) {
<span class="nc" id="L341">		m_messagePC.clear();</span>

<span class="nc" id="L343">		Message msg = new Message(Message.INFO_TYPE, posting.getComment());</span>
<span class="nc" id="L344">		m_messagePC.addMessage(msg);</span>
<span class="nc" id="L345">		String data = m_messagePC.getHtmlDisplay();</span>
<span class="nc" id="L346">		row_data.add( data );</span>
<span class="nc" id="L347">	}</span>

	/**
	 * Add List Item Actions
	 */
	protected void addItemActions(ShiftSwapPosting posting, ID myEmpID,
			String rowID, DefaultMultiColumnNodeData row_data) {
<span class="nc" id="L354">		StringBuffer sb = new StringBuffer(100);</span>
<span class="nc" id="L355">		sb.append(&quot;&lt;nobr&gt;&quot;);</span>
<span class="nc" id="L356">		appendItemAction(posting, PageAction.EDIT, rowID, sb);</span>
<span class="nc" id="L357">		appendItemAction(posting, PageAction.WITHDRAW, rowID, sb);</span>
<span class="nc" id="L358">		appendItemAction(posting, RmPageAction.PICKUP_POSTING, rowID, sb);		</span>
<span class="nc" id="L359">		appendViewScheduleAction(posting, sb);</span>
<span class="nc" id="L360">		sb.append(&quot;&lt;/nobr&gt;&quot;);</span>

<span class="nc" id="L362">		row_data.add(sb);</span>
<span class="nc" id="L363">	}</span>

	/**
	 * Return Image for specified Action
	 */
	@Override
	protected String getImageForAction(String action) {		
<span class="nc bnc" id="L370" title="All 2 branches missed.">		if (RmPageAction.PICKUP_POSTING.equals(action)) {</span>
<span class="nc" id="L371">			return RmImageFileID.SWAP_BOARD_PICKUP;</span>
		} else {
<span class="nc" id="L373">			return super.getImageForAction(action);</span>
		}	
	}

	/**
	 * Return Image Alt text for specified Action
	 */
	@Override
	protected String getImageAltForAction(String action) {
<span class="nc bnc" id="L382" title="All 2 branches missed.">		if (RmPageAction.PICKUP_POSTING.equals(action)) {</span>
<span class="nc" id="L383">			return i18n(m_bundle, RmWebBundleKey.PICKUP_POSTING);</span>
<span class="nc bnc" id="L384" title="All 2 branches missed.">		} else  if (PageAction.VIEW_SCHEDULE.equals(action)) {</span>
<span class="nc" id="L385">			return i18n(m_bundle, RmWebBundleKey.VIEW_PERSONAL_SCHEDULE);</span>
		} else {
<span class="nc" id="L387">			return super.getImageAltForAction(action);</span>
		}		
	}

	/**
	 * Create List Item Action Icon
	 */
	protected String createActionIcon(String action, String rowID) {
<span class="nc" id="L395">		String src = getImageForAction(action);</span>
<span class="nc" id="L396">		String alt = getImageAltForAction(action);</span>
<span class="nc" id="L397">		String onClickJS = &quot;pageMediator.handleListAction('&quot;+ action +&quot;','&quot;+ rowID+&quot;');&quot;;		</span>
<span class="nc" id="L398">		return createIconButton(src, alt, onClickJS);</span>
	}

	/**
	 * Determine whether the specified action for the Posting is enabled
	 */
	protected boolean isItemActionEnabled(ShiftSwapPosting posting, String action) {
<span class="nc" id="L405">		boolean isMyPosting = m_empID.equals(posting.getEmployeeID());</span>

<span class="nc" id="L407">		if (</span>
<span class="nc bnc" id="L408" title="All 4 branches missed.">				PageAction.VIEW_SCHEDULE.equals(action)</span>
				||
<span class="nc bnc" id="L410" title="All 6 branches missed.">				( isMyPosting &amp;&amp; (PageAction.EDIT.equals(action) || PageAction.WITHDRAW.equals(action)))</span>
				||
<span class="nc bnc" id="L412" title="All 2 branches missed.">				( !isMyPosting &amp;&amp;	RmPageAction.PICKUP_POSTING.equals(action) )</span>
<span class="nc" id="L413">		) return true;</span>

<span class="nc" id="L415">		return false;</span>
	}

	/**    
	 * Append Item Action if enabled
	 */
	protected void appendItemAction(ShiftSwapPosting posting, String action, String rowID, StringBuffer sb) {
<span class="nc bnc" id="L422" title="All 2 branches missed.">		String itemAction = isItemActionEnabled(posting, action)?</span>
<span class="nc" id="L423">				createActionIcon(action, rowID):</span>
<span class="nc" id="L424">				createIconButton(ImageFileID.BLANK_SPACER, null, null);</span>
<span class="nc" id="L425">		sb.append( itemAction );</span>
<span class="nc" id="L426">	}</span>

	/**
	 * Append View Schedule Action
	 */
	protected void appendViewScheduleAction(ShiftSwapPosting posting, StringBuffer sb) {
<span class="nc" id="L432">		String action = PageAction.VIEW_SCHEDULE;</span>
<span class="nc" id="L433">		String src = getImageForAction(action);</span>
<span class="nc" id="L434">		String alt = getImageAltForAction(action);</span>

<span class="nc" id="L436">		String dateVal = getShiftDateInputValue(posting);</span>
<span class="nc" id="L437">		String onClickJS = &quot;pageMediator.viewSchedule('&quot;+ dateVal + &quot;');&quot;;</span>
<span class="nc" id="L438">		String itemAction = createIconButton(src, alt, onClickJS);</span>
<span class="nc" id="L439">		sb.append(itemAction);</span>
<span class="nc" id="L440">	}</span>

	/**
	 * Return Shift Date Value which will be used for Date Picker
	 */
	protected String getShiftDateInputValue(ShiftSwapPosting posting) {
<span class="nc" id="L446">		Date shiftDate = posting.getShiftSwapItem().getStartDate();</span>
<span class="nc" id="L447">		m_datePicker.setDate(shiftDate);		</span>
<span class="nc" id="L448">		return m_datePicker.getDateDisplay();</span>
	}

	/**
	 * Initialize Content Title
	 */
	@Override
	public void initContentTitle()	{
		// Initialize Content Title
<span class="nc" id="L457">		String pageTitle = i18n(m_bundle, RmWebBundleKey.RM_MYSCHEDULE_SWAPBOARD);</span>
<span class="nc" id="L458">		m_contentTitlePC.setPageTitle(pageTitle);</span>

<span class="nc" id="L460">        String showOnlyFullPostings = i18n(m_bundle, RmWebBundleKey.SWAPBOARD_SHOW_ONLY_FULL_POSTINGS);</span>
<span class="nc bnc" id="L461" title="All 2 branches missed.">        String checkbox = HtmlChoiceInput.makeChkBoxInput(&quot;isIncludePartial&quot;, &quot;true&quot;, </span>
                showOnlyFullPostings, !m_isIncludePartial, JSUtil.REFRESH_PAGE);
<span class="nc" id="L463">		m_contentTitlePC.setItemName(checkbox);</span>
        
		// View Option
<span class="nc bnc" id="L466" title="All 2 branches missed.">		if (m_isAuthorized) {</span>
<span class="nc" id="L467">			String viewLabel = i18n(m_common_bundle, UIFWebBundleKey.VIEW);</span>
<span class="nc" id="L468">			m_contentTitlePC.setActiveComponent(viewLabel, makeViewDropDown(viewLabel) + &quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&quot;);  //ESR#4234460</span>
		}
<span class="nc" id="L470">		m_contentTitlePC.setAriaRegion(true);</span>
<span class="nc" id="L471">	}</span>
	
	/**
	 * Specify whether Expired Requests are included
	 */
	public void setIsIncludePartial(boolean bValue) {
<span class="nc bnc" id="L477" title="All 2 branches missed.">		m_isIncludePartial = !bValue;</span>
<span class="nc" id="L478">	}</span>

	/**
	 * Initialize Toolbar
	 */
	@Override
	protected void initToolbar() {
<span class="nc bnc" id="L485" title="All 4 branches missed.">		boolean isBtnEnabled  = m_isPageEnabled &amp;&amp; m_isAuthorized;</span>
<span class="nc" id="L486">		String newPostingLabel = i18n(m_bundle, RmWebBundleKey.CREATE_NEW_POSTING);</span>
<span class="nc" id="L487">		m_toolbar.addPopupWindowTextButton(POPUP_FORM_ACTION,	newPostingLabel, isBtnEnabled);</span>
<span class="nc" id="L488">		enableToolbarPagination();</span>
<span class="nc" id="L489">	}</span>

	/**
	 * Create HTML for Drop down for View selection
	 */
	private String makeViewDropDown(String label) {
<span class="nc" id="L495">		String onChangeJS = JSUtil.REFRESH_PAGE;</span>

<span class="nc" id="L497">		ArrayList options = new ArrayList();</span>
<span class="nc" id="L498">		options.add(createViewOption(MY_POSTINGS, RmWebBundleKey.SWAPBOARD_VIEW_MY_POSTINGS));</span>
<span class="nc" id="L499">		options.add(createViewOption(ALL_POSTINGS, RmWebBundleKey.SWAPBOARD_VIEW_ALL_POSTINGS));</span>
<span class="nc" id="L500">		options.add(createViewOption(POSTING_BY_CAMP, RmWebBundleKey.SWAPBOARD_VIEW_POSTING_BY_CAMP));</span>
<span class="nc" id="L501">		options.add(createViewOption(POSTING_BY_ORG, RmWebBundleKey.SWAPBOARD_VIEW_POSTING_BY_ORG));</span>
		
<span class="nc bnc" id="L503" title="All 2 branches missed.">		if (isAccessibilityComplianceMode()) {			</span>
<span class="nc" id="L504">			return HtmlUtil.makeSelectInput(VIEW_MODE_FN, &quot;&quot;, new String[]{m_viewMode}, onChangeJS, options,</span>
<span class="nc" id="L505">					null, false, false, true, false, null, getHtmlSelectWithDescription(label));</span>
		} else {
<span class="nc" id="L507">			return HtmlUtil.makeSelectInput(VIEW_MODE_FN, m_viewMode, onChangeJS, options, false);</span>
		}
	}

	/**
	 * Return true if Authorized to this Page
	 */
	public boolean isAuthorized() {
<span class="nc bnc" id="L515" title="All 2 branches missed.">		return isValidEmployee() &amp;&amp;</span>
<span class="nc bnc" id="L516" title="All 2 branches missed.">				m_user.isAuthorized(PrivilegeKeys.SS_READWRITETOSWAPBOARD_ID);</span>
	}

	/**
	 * Set Selected Posting ID
	 */
	public void setPostingID(ID id) {
<span class="nc" id="L523">		m_postingID = id;</span>
<span class="nc" id="L524">	}</span>

	/**
	 * Return selected Posting ID
	 */
	public ID getPostingID() {
<span class="nc" id="L530">		return m_postingID;</span>
	}

	/**
	 * Set View Mode
	 */
	public void setViewMode(String mode) {
<span class="nc" id="L537">		m_viewMode = mode;</span>
<span class="nc" id="L538">		RequestUtil.cacheSwapBoardViewMode(m_context, mode);</span>
<span class="nc" id="L539">	}</span>

	/**
	 * Return View Mode
	 */
	public String getViewMode() {
<span class="nc" id="L545">		return m_viewMode;</span>
	}

	/**
	 * Return URL for HTML Form Action
	 */
	@Override
	public String getFormAction() {
<span class="nc" id="L553">		return FORM_ACTION;</span>
	}

	/**
	 * Create Hidden Input HTML
	 */
	@Override
	public String getRequiredHTML() {
<span class="nc" id="L561">		return super.getRequiredHTML() + HtmlUtil.makeHiddenInput(POSTING_ID_FN,&quot;&quot;);</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>