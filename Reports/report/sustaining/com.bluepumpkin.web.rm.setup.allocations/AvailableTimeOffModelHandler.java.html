<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>AvailableTimeOffModelHandler.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.rm.setup.allocations</a> &gt; <span class="el_source">AvailableTimeOffModelHandler.java</span></div><h1>AvailableTimeOffModelHandler.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.rm.setup.allocations;
import java.rmi.RemoteException;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.Collection;
import java.util.Date;
import java.util.HashMap;
import java.util.HashSet;
import java.util.Iterator;
import java.util.List;
import java.util.Map;
import java.util.TimeZone;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.LocalDate;
import com.bluepumpkin.common.logging.Category;
import com.bluepumpkin.ejb.bbm.base.BbmCreateException;
import com.bluepumpkin.ejb.bbm.base.BbmFinderException;
import com.bluepumpkin.ejb.bbm.base.BbmRemoveException;
import com.bluepumpkin.ejb.bbm.base.BbmUpdateException;
import com.bluepumpkin.ejb.core.base.MultiUserException;
import com.bluepumpkin.ejb.rm.RmManagerFactory;
import com.bluepumpkin.ejb.rm.setup.calendartimeoff.ejb.CalendarTimeOffDayFacade;
import com.bluepumpkin.ejb.rm.setup.calendartimeoff.ejb.MonthRange;
import com.bluepumpkin.ejb.rm.setup.calendartimeoff.model.BlackoutDay;
import com.bluepumpkin.ejb.rm.setup.calendartimeoff.model.CalendarTimeOffDay;
import com.bluepumpkin.ejb.rm.setup.calendartimeoff.model.TOIntervalAllocation;
import com.bluepumpkin.ejb.rm.setup.calendartimeoff.model.TOPool;
import com.bluepumpkin.web.core.base.ModelHandler;
import com.bluepumpkin.web.rm.Log;

/**
 * Title          AvailableTimeOffModelHandler
 * Description    Model handler for Available Time Off
 * Copyright      Copyright (c) 2002
 * Company        Blue Pumpkin Software, Inc
 * @author        Howard Mullings
 * @version       1.0
 */
<span class="nc" id="L40">public class AvailableTimeOffModelHandler extends ModelHandler {</span>

<span class="nc" id="L42">	private static Category category = </span>
<span class="nc" id="L43">		Log.initCategory(AvailableTimeOffModelHandler.class.getName());</span>

	/**
	 * Check to see if a Time Off Pool name already exists.
	 * @param name - The Time Off Pool name desired.
	 * @return poolID if pool name found, else null.
	 * @throws BbmFinderException
	 * @throws BbmCreateException
	 * @throws RemoteException
	 */
	public static ID getPoolIDForName(String poolName) throws BbmFinderException, BbmCreateException, RemoteException {
<span class="nc" id="L54">		HashSet poolNames = new HashSet(1);</span>
<span class="nc" id="L55">		poolNames.add(poolName);</span>
<span class="nc" id="L56">		HashMap poolIDNameMap = RmManagerFactory.getInstance().getTimeOffDayFacade().getTOPoolIDsByNames(poolNames);</span>
<span class="nc bnc" id="L57" title="All 4 branches missed.">		return (poolIDNameMap != null &amp;&amp; !poolIDNameMap.isEmpty()) ? (ID) poolIDNameMap.values().iterator().next() : null;</span>
	}

	/**
	 * Get Time off pools in the Organization
	 * @param orgId, bIncludeParentOrg - The time off pool in the organization, is to include parent Org
	 * @return list of time off pool Id, else empty.
	 * @throws BbmFinderException
	 * @throws BbmCreateException
	 * @throws RemoteException
	 */
	public static Collection&lt;TOPool&gt;  getToPoolsForOrg(ID orgID, boolean bIncludeParentOrg) throws BbmFinderException,BbmCreateException
		,RemoteException
	{
<span class="nc" id="L71">		return RmManagerFactory.getInstance().getTimeOffDayFacade().getTOPoolsForOrg(orgID,bIncludeParentOrg);</span>
	}
	
	/**
	 * Create a Time Off Pool.
	 * @param pool - The Time Off Pool that you want to add to the database.
	 * @return The ID of the created Time Off Pool (TOPool).
	 * @throws BbmFinderException
	 * @throws BbmCreateException
	 * @throws RemoteException
	 */
	public static ID createTOPool(TOPool pool) throws BbmFinderException, BbmCreateException, RemoteException 
	{
<span class="nc" id="L84">		return RmManagerFactory.getInstance().getTimeOffDayFacade().createTOPool(pool);		</span>
	}
	
	/**
	 * Update a Time Off Pool.
	 * @param pool - The Time Off Pool that you want to update in the database.
	 * @throws BbmFinderException
	 * @throws BbmCreateException
	 * @throws RemoteException
	 */
	public static void updateTOPool(TOPool pool) throws BbmFinderException, BbmCreateException, RemoteException 
	{
<span class="nc" id="L96">		RmManagerFactory.getInstance().getTimeOffDayFacade().updateTOPool(pool);		</span>
<span class="nc" id="L97">	}</span>
	
	/** 	
	 * Gets the time off calendar data configured for all days
	 *	for specified Month and Year.
	 *	@param pOrganizationId - ID for the Organization.
	 *	@param pMonth - integer value representing month.
	 *	@param pYear - integer value representing year.
	 *	@return Collection - Collection of CalendarTimeOffDay objects.
	 *  @throws BbmFinderException, RmMultipleObjectsException, RemoteException
	 */
    public static CalendarTimeOffDay[] getCalendarTimeOffDays(ID poolId, 
											  int month, 
											  int year)
        throws BbmFinderException, BbmCreateException, RemoteException 
	{
		Collection pTimeOffDays;
<span class="nc" id="L114">		pTimeOffDays = RmManagerFactory.getInstance().getTimeOffDayFacade().</span>
<span class="nc" id="L115">					getCalendarTimeOffDays(poolId, month, year);</span>

<span class="nc" id="L117">		Calendar c = Calendar.getInstance(TimeZone.getTimeZone(&quot;GMT&quot;));</span>

		// convert the data from collection to a month array
<span class="nc" id="L120">		CalendarTimeOffDay timeOffDays[] = new CalendarTimeOffDay[31]; </span>

<span class="nc" id="L122">		Iterator itr = pTimeOffDays.iterator();</span>
<span class="nc bnc" id="L123" title="All 2 branches missed.">		for (int i = 0; itr.hasNext(); i++) {</span>
<span class="nc" id="L124">			CalendarTimeOffDay timeOffDay = (CalendarTimeOffDay)itr.next();</span>
<span class="nc" id="L125">			Date timeOffDate = timeOffDay.getTimeOffDate();</span>
<span class="nc bnc" id="L126" title="All 2 branches missed.">			if (timeOffDate == null) {</span>
<span class="nc" id="L127">				throw new IllegalArgumentException(</span>
					&quot;A 'null' time off date is not allowed: \n&quot;+
					&quot;entryIdx=&quot;+i+&quot;;\nrecord=&quot;+timeOffDay);
			}
<span class="nc" id="L131">			c.setTime(timeOffDate);</span>
<span class="nc" id="L132">			int dayOfMonth = c.get(Calendar.DAY_OF_MONTH)-c.getMinimum(Calendar.DAY_OF_MONTH);</span>
<span class="nc" id="L133">			timeOffDays[dayOfMonth] = timeOffDay;</span>
		}
<span class="nc" id="L135">		return timeOffDays;</span>
	}

	/**
	 * Save the calendar time off data.
	 * @param pPoolId - ID for the Time Off Pool.
	 * @throws BbmFinderException, RmMultipleObjectsException, RemoteException
	 */
	public static void saveCalendarTimeOffDays(CalendarTimeOffDay calendarTimeOffDays[], ID pPoolId)	
		throws BbmCreateException, BbmUpdateException, BbmFinderException, 
			   BbmRemoveException, MultiUserException , RemoteException 
	{
<span class="nc" id="L147">		Collection pTimeOffDays = new ArrayList(31);</span>
<span class="nc" id="L148">		int l = calendarTimeOffDays.length;</span>
<span class="nc bnc" id="L149" title="All 2 branches missed.">		for (int i = 0; i &lt; l; i++) {</span>
<span class="nc bnc" id="L150" title="All 2 branches missed.">			if (calendarTimeOffDays[i] != null) {</span>
<span class="nc" id="L151">				pTimeOffDays.add(calendarTimeOffDays[i]);</span>
			}
		}
	
<span class="nc" id="L155">		RmManagerFactory.getInstance().getTimeOffDayFacade().</span>
<span class="nc" id="L156">					saveCalendarTimeOffDays(pTimeOffDays, pPoolId);</span>
<span class="nc" id="L157">	}</span>
	
    /** 
     * Save organization (plus trickle-down orgs) blackout days for a date range.
	 * @param StartDate - First date ir range.
	 * @param endDate - Last date in range.
	 * @param pPoolId - ID for the Time Off Pool.
     * @param isCreateRange - Pass true to create BO day range, false to remove range.
     */
	public static void saveBlackoutDaysForRange(Date StartDate, 
                                                Date endDate, 
											    ID pPoolId,
                                                boolean isCreateRange)	
		throws BbmCreateException, BbmUpdateException, BbmFinderException, 
			   BbmRemoveException, MultiUserException , RemoteException {

<span class="nc bnc" id="L173" title="All 2 branches missed.">        RmManagerFactory.getInstance().getTimeOffDayFacade().saveBlackoutDaysForRange(</span>
            new LocalDate(StartDate), new LocalDate(endDate), pPoolId, !isCreateRange);
<span class="nc" id="L175">	}</span>

	public static TOPool getTOPool(ID toPoolID) throws BbmFinderException,  BbmCreateException,RemoteException{
<span class="nc" id="L178">		return RmManagerFactory.getInstance().getTimeOffDayFacade().getTOPool(toPoolID);</span>
	}
	/**
	 * Save the calendar time off interval data.
	 * @param pPoolId - ID for the Time Off Pool.
	 * @throws BbmCreateException 
	 * @throws BbmFinderException, RmMultipleObjectsException, RemoteException
	 */
	public static int[] saveCalendarTimeOffIntervals(Map&lt;LocalDate,List&lt;TOIntervalAllocation&gt;&gt; hTimeOffIntervals, ID pTOPoolID,TimeZone tz)
		throws BbmRemoveException, BbmUpdateException, BbmCreateException, RemoteException {
<span class="nc" id="L188">		return RmManagerFactory.getInstance().getTimeOffDayFacade().saveCalendarTimeOffIntervals(hTimeOffIntervals, pTOPoolID,tz);</span>
	}

	/**
	 * Saves the Time-off interval calendar data.
	 */
	public static void saveTimeOffIntervalCalendar(Map&lt;LocalDate, List&lt;TOIntervalAllocation&gt;&gt; hTimeOffIntervals, ID pTOPoolID,
			TimeZone tz, MonthRange monthRange, BlackoutDay[] blackoutDays) throws BbmUpdateException, BbmCreateException, RemoteException {
<span class="nc" id="L196">		CalendarTimeOffDayFacade ctod = RmManagerFactory.getInstance().getTimeOffDayFacade();</span>
<span class="nc" id="L197">		ctod.saveTimeOffIntervalCalendar(hTimeOffIntervals, pTOPoolID, tz, monthRange, blackoutDays);</span>
<span class="nc" id="L198">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>