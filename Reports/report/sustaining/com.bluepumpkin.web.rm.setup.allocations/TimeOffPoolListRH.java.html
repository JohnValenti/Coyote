<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>TimeOffPoolListRH.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.rm.setup.allocations</a> &gt; <span class="el_source">TimeOffPoolListRH.java</span></div><h1>TimeOffPoolListRH.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.rm.setup.allocations;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.logging.Category;
import com.bluepumpkin.ejb.bbm.workresource.OrganizationScopeManagerProxy;
import com.bluepumpkin.web.bbm.Log;
import com.bluepumpkin.web.bbm.organization.OrganizationModelHandler;
import com.bluepumpkin.web.core.base.RequestHandler;
import com.witness.ejb.core.security.PrivilegeKeys;
import com.witness.web.uif.keys.PageAction;
import com.witness.web.uif.system.RequestContext;
import com.bluepumpkin.web.bbm.people.PeopleMH;

/**
 * Title:        TimeOffPoolListRH
 * Description:  Handle requests from the Time Off Pools List page
 * Copyright:    Copyright (c) 2010
 * Company:      Verint, Inc
 * @author       Gonzalo Quintanar
 */
<span class="nc" id="L21">public class TimeOffPoolListRH extends RequestHandler </span>
{
<span class="nc" id="L23">	private static final Category log = Log.initCategory(TimeOffPoolListRH.class.getName());</span>
	
    private static final String VIEW_PRIVILEGE = PrivilegeKeys.TOM_VIEWAVAILABLETIMEOFF; 
    private static final String DELETE_PRIVILEGE = PrivilegeKeys.TOM_EDITAVAILABLETIMEOFF; 
	public static final String LIST_PAGE = &quot;listPage&quot;;
	public static final String EDIT_PAGE = &quot;editPage&quot;;
	//public static final String CONFIRM_PAGE = &quot;confirmPage&quot;;
    

	/**
	 * Process Request for the User page
	 */
	public void processRequest(RequestContext context) throws Exception 
    {
		// Process requested action
<span class="nc bnc" id="L38" title="All 6 branches missed.">		if (isAction(context, PageAction.ADD) || isAction(context, PageAction.EDIT) || isAction(context, PageAction.VIEW)) </span>
        {
<span class="nc" id="L40">			goToFormPage(context);</span>
        } 
<span class="nc bnc" id="L42" title="All 4 branches missed.">        else if (isAction(context, PageAction.DONE) || isAction(context, PageAction.NEW_ID)) </span>
        {
<span class="nc" id="L44">			processRefresh(context);</span>
		} 
<span class="nc bnc" id="L46" title="All 2 branches missed.">        else if (isAction(context, PageAction.DELETE)) </span>
        {
<span class="nc" id="L48">			processDelete(context);      </span>
		} 
        //else if (isAction(context, PageAction.CONFIRMED_DELETE)) 
        //{
        //    processConfirmDelete(context);
        //}
        else 
        {
<span class="nc" id="L56">			processRefresh(context);</span>
		}    
<span class="nc" id="L58">	}</span>
  
	/**
	 * To go Form Page
	 */
	private void goToFormPage(RequestContext context) {
<span class="nc bnc" id="L64" title="All 2 branches missed.">		if (isAuthorized(context, VIEW_PRIVILEGE)) {</span>
<span class="nc" id="L65">			setNextPage(context, EDIT_PAGE);</span>
		} else {
<span class="nc" id="L67">			setNextPage(context, LIST_PAGE);</span>
		}
<span class="nc" id="L69">	}</span>
	
	protected boolean isAuthorizedToView(RequestContext context, ID orgID) 
	{
<span class="nc bnc" id="L73" title="All 2 branches missed.">		return isValidSelectedOrg(context, orgID) &amp;&amp;</span>
<span class="nc bnc" id="L74" title="All 2 branches missed.">				context.getUser().isAuthorized(</span>
						VIEW_PRIVILEGE,
<span class="nc" id="L76">						OrganizationScopeManagerProxy.getScopeID(orgID));</span>
	}

	protected boolean isAuthorizedToConfigure(RequestContext context, ID orgID) 
	{
<span class="nc bnc" id="L81" title="All 2 branches missed.">		return isValidSelectedOrg(context, orgID) &amp;&amp;</span>
<span class="nc bnc" id="L82" title="All 2 branches missed.">				context.getUser().isAuthorized(</span>
						DELETE_PRIVILEGE,
<span class="nc" id="L84">						OrganizationScopeManagerProxy.getScopeID(orgID));</span>
	}
	
    /**
     * Return true if selected Org is valid
     */
    protected boolean isValidSelectedOrg(RequestContext context, ID orgID) {
<span class="nc bnc" id="L91" title="All 2 branches missed.">        return orgID!=null &amp;&amp;</span>
<span class="nc bnc" id="L92" title="All 2 branches missed.">                OrganizationModelHandler.existsOrganization(context, orgID) &amp;&amp;</span>
<span class="nc bnc" id="L93" title="All 2 branches missed.">                !OrganizationModelHandler.ROOT_ORG_ID.equals(orgID);</span>
    }

	/**
	 * Process Delete Action
	 */
	private void processDelete(RequestContext context) throws Exception 
	{
<span class="nc" id="L101">		setNextPage(context, LIST_PAGE);</span>

		// Extract Parameters
<span class="nc" id="L104">		TimeOffPoolListPM model = new TimeOffPoolListPM(context);</span>
<span class="nc" id="L105">		model.extractParameters(context.getRequest());</span>

        // Cache Model
<span class="nc" id="L108">        context.setPageModel(model);</span>
        
		// Security check
<span class="nc" id="L111">		ID orgID = model.getOrgID();</span>
<span class="nc" id="L112">		ID poolID = model.getPoolID();</span>

<span class="nc bnc" id="L114" title="All 6 branches missed.">		if (orgID==null || !isAuthorizedToConfigure(context, orgID) || poolID==null) </span>
<span class="nc" id="L115">			return;</span>
        
        // Determine whether there are any affected Employees or WorkPatterns by this action
        //Collection affectedEmployees = getEmployeeIDsByEmployeeTypeID(context, poolID);
        //if (affectedEmployees==null) 
        //    return;  // Error retrieving User
        //Collection affectedPatterns = getWorkPatternNamesByEmployeeTypeID(context, poolID);
        //if (affectedPatterns==null) 
        //    return;  // Error retrieving User
        // Proceed to delete if there are no affected users else go to confirmation
        //if (affectedEmployees.isEmpty() &amp;&amp; affectedPatterns.isEmpty()) 
        //{
            //processConfirmedDel(context);
        //    processDelete(context, poolID, &quot;EMPLOYEETYPE&quot;, model,
        //            BbmWebBundleKey.ORG_EMPLOYEETYPE_DELETE_FAILURE, BbmWebBundleKey.BUNDLE_NAME,
        //            BbmWebLogBundleKey.ORG_EMPLOYEETYPE_DELETE_FAILURE, log);            
        //}
        //else 
        //{
        //    prepareToConfirm(context, poolID.toString(), affectedEmployees, affectedPatterns);
        //}
		
		
<span class="nc" id="L138">		PeopleMH.deleteTOPool(poolID);</span>
<span class="nc" id="L139">	}  </span>
    
	/*
    private Collection getEmployeeIDsByEmployeeTypeID(RequestContext context, ID employeeTypeID)
    {
        Collection empIDs = null;
        try 
        {
            empIDs = EmployeeTypeModelHandler.getEmployeeIDsByEmployeeTypeID(context, employeeTypeID);
        } 
        catch(Exception ex) 
        {
            log.l7dError(BbmWebLogBundleKey.EMPLOYEE_TYPE_UNABLE_TO_RETRIEVE_EMPLOYEES, ex);
            context.addPageMessage(
                    new Message(Message.ERROR_TYPE, BbmWebBundleKey.EMPLOYEE_TYPE_UNABLE_TO_RETRIEVE_EMPLOYEES,
                            BbmWebBundleKey.BUNDLE_NAME));
        }
        return empIDs;
    }
    
    private Collection getWorkPatternNamesByEmployeeTypeID(RequestContext context, ID employeeTypeID)
    {
        Collection empIDs = null;
        try 
        {
            empIDs = EmployeeTypeModelHandler.getWorkPatternNamesByEmployeeTypeID(context, employeeTypeID);
        } 
        catch(Exception ex) 
        {
            log.l7dError(BbmWebLogBundleKey.EMPLOYEE_TYPE_UNABLE_TO_RETRIEVE_WORK_PATTERNS, ex);
            context.addPageMessage(
                    new Message(Message.ERROR_TYPE, BbmWebBundleKey.EMPLOYEE_TYPE_UNABLE_TO_RETRIEVE_WORK_PATTERNS,
                            BbmWebBundleKey.BUNDLE_NAME));
        }
        return empIDs;
    }
    */
	
    /**
     * Return null if there are errors otherwise it will return an empty ArrayList
     * or one with users
     *
    private HashMap getEmployeeNamesByIDs(RequestContext context, Collection employeeIDs) 
    {
        HashMap names=null;
        try {
            names = EmployeeModelHandler.getEmployeeNamesByIDs(context, employeeIDs);
        } catch(Exception ex) {
            log.l7dError(BbmWebLogBundleKey.EMPLOYEE_TYPE_UNABLE_TO_RETRIEVE_EMPLOYEES, ex);
            context.addPageMessage(
                    new Message(Message.ERROR_TYPE, BbmWebBundleKey.EMPLOYEE_TYPE_UNABLE_TO_RETRIEVE_EMPLOYEES,
                            BbmWebBundleKey.BUNDLE_NAME));
        }
        return names;
    }
    */
    
    /**
     * Return null if there are errors otherwise it will return an empty ArrayList
     * or one with work patterns
     *
    private HashMap getWorkPatternNamesByIDs(RequestContext context, Collection patternIDs) 
    {
        HashMap names=null;
        try {
            names = EmployeeTypeModelHandler.getWorkPatternNamesByIDs(context, patternIDs);
        } catch(Exception ex) {
            log.l7dError(BbmWebLogBundleKey.EMPLOYEE_TYPE_UNABLE_TO_RETRIEVE_WORK_PATTERNS, ex);
            context.addPageMessage(
                    new Message(Message.ERROR_TYPE, BbmWebBundleKey.EMPLOYEE_TYPE_UNABLE_TO_RETRIEVE_WORK_PATTERNS,
                            BbmWebBundleKey.BUNDLE_NAME));
        }
        return names;
    }
    */
  
    /**
     * Determine whether to proceed to prepare for confirmation
     *
    private void prepareToConfirm(RequestContext context, String employeeTypeID, Collection affectedEmployeeIDs, 
            Collection affectedPatternNamess) 
    {
        // Get Employee Names and Work Patterns
        HashMap empNames = getEmployeeNamesByIDs(context, affectedEmployeeIDs);
        //HashMap patternNames = getWorkPatternNamesByIDs(context, affectedPatternIDs);

        // Need confirmation
        EmployeeTypeDelConfirmPageModel pageModel = new EmployeeTypeDelConfirmPageModel(context);
        pageModel.setEmployeeTypeID(employeeTypeID);
        pageModel.setAffectedEmployees(empNames.values()); //affectedEmployeeIDs
        pageModel.setAffectedWorkPatterns(affectedPatternNamess); //affectedPatternIDs
        context.setPageModel(pageModel);
        setNextPage(context, CONFIRM_PAGE);
    }
    */
    
	/**
	 * Process Refresh Action
	 */
	private void processRefresh(RequestContext context) {
<span class="nc" id="L239">		setNextPage(context, LIST_PAGE);</span>
<span class="nc" id="L240">	}</span>
    
    /**
     * Process Role Confirmed Delete
     *
    private void processConfirmDelete(RequestContext context) 
    {
        // Default Result Page
        setNextPage(context, LIST_PAGE);

        // Security check
        if (!isAuthorized(context, PrivilegeKeys.CORE_CONFIGUREEMPLOYEETYPES)) 
            return;

        // Extract form parameter
        EmployeeTypeDelConfirmPageModel model = new EmployeeTypeDelConfirmPageModel(context);
        model.extractParameters(context.getRequest());

        try 
        {
            // Delete employee type, replacing it in the linked objects with the user-selected employee type
            if (StringUtil.isEmpty(model.getSubEmployeeTypeID())) 
            {
                model.addPageMessage(Message.WARNING_TYPE, BbmWebBundleKey.EMPLOYEE_TYPE_CHOOSE_SUBSTITUTE,
                    BbmWebBundleKey.BUNDLE_NAME);
            } 
            else 
            { 
                EmployeeTypeModelHandler.confirmDelete(context, new ID(model.getEmployeeTypeID()), new ID(model.getSubEmployeeTypeID()));
            }
        } 
        catch(Exception ex) 
        {
            log.l7dError(BbmWebLogBundleKey.UM_UNABLE_TO_DEL_USER_ROLE, ex);

            String rbKey = UIFWebBundleKey.UM_UNABLE_TO_DEL_USER_ROLE;
            model.addPageMessage(Message.ERROR_TYPE, rbKey, UIFWebBundleKey.BUNDLE_NAME);
        }

        context.setPageModel(model);
    }
    */
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>