<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>SetBlackoutDayRangePopupPM.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.rm.setup.allocations</a> &gt; <span class="el_source">SetBlackoutDayRangePopupPM.java</span></div><h1>SetBlackoutDayRangePopupPM.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.rm.setup.allocations;

import java.util.Date;
import java.util.TimeZone;
import java.util.ResourceBundle;

import javax.servlet.http.HttpServletRequest;

import com.bluepumpkin.common.logging.Category;
import com.bluepumpkin.web.bbm.l10n.BbmWebBundleKey;
import com.bluepumpkin.web.rm.Log;
import com.bluepumpkin.web.rm.l10n.RmWebBundleKey;
import com.bluepumpkin.web.rm.l10n.RmWebLogBundleKey;
import com.witness.web.uif.pagecomponent.picker.date.DateRangePickerPC;
import com.witness.web.uif.pagecomponent.toolbar.ToolbarPC;
import com.witness.web.uif.pagecomponent.toolbar.ToolbarUtil;
import com.witness.web.uif.pagemodel.PageModel;
import com.witness.web.uif.pagemodel.PopupWindowPM;
import com.witness.web.uif.pagemodel.WorkpaneFieldNames;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.util.HtmlUtil;
import com.witness.web.uif.util.html.HtmlChoiceInput;
import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.ejb.rm.RmManagerFactory;
import com.bluepumpkin.ejb.rm.setup.calendartimeoff.model.TOPool;

/**
 * Title:        SetBlackoutDayRangePopupPM
 * Description:  Model for setting blackout day range
 * Copyright:    Copyright (c) 2005
 * Company:      Blue Pumpkin Software, inc
 * @author       Gonzalo Quintanar
 * @version 1.0
 */
public class SetBlackoutDayRangePopupPM extends PopupWindowPM
{
	protected ResourceBundle m_rmBundle;
	protected ResourceBundle m_bbm_bundle;

<span class="nc" id="L40">	private static Category log  = 	Log.initCategory(SetBlackoutDayRangePopupPM.class.getName());</span>

	private DateRangePickerPC m_dateRangePickerPC;
    private HtmlChoiceInput m_createBODaysChoice;
    private HtmlChoiceInput m_deleteBODaysChoice;
    
<span class="nc" id="L46">    private TOPool m_pool=null;  //The Time Off Pool which was selected in the Time Off Pool List page</span>
<span class="nc" id="L47">    private ID m_poolID = null;    </span>
    //private String m_poolName = &quot;&quot;;

    private static final String DATE_CHOICE_FN = &quot;dateChoice&quot;;
    private static final String BO_DAYS_TYPE_FN = &quot;blackoutDaysType&quot;;
    private static final String CREATE_BO_DAYS_FV = &quot;createBlackoutDays&quot;;
    private static final String DELETE_BO_DAYS_FV = &quot;deleteBlackoutDays&quot;;
<span class="nc" id="L54">    private boolean isCloseAfterLoadCustomize = false;</span>

	/**
	 * Constructor
	 */
	public SetBlackoutDayRangePopupPM(RequestContext context) {
<span class="nc" id="L60">		super(context);</span>

<span class="nc" id="L62">		m_rmBundle = m_localizer.getBundle(RmWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L63">		m_bbm_bundle = m_localizer.getBundle(BbmWebBundleKey.BUNDLE_NAME);</span>

        //Initialize Date Range Picker
<span class="nc" id="L66">		m_dateRangePickerPC = new DateRangePickerPC(context, DATE_CHOICE_FN);</span>
<span class="nc" id="L67">		m_dateRangePickerPC.setIsTimeEnabled(false);</span>
		
		// set gmt timezone for date range picker: qc63817
<span class="nc" id="L70">		TimeZone tz = TimeZone.getTimeZone(&quot;GMT&quot;);</span>
<span class="nc" id="L71">		m_dateRangePickerPC.setTimeZone(tz);</span>
		
<span class="nc" id="L73">		addChildComponent(m_dateRangePickerPC);</span>

        //Initialize Radio Buttons
<span class="nc" id="L76">        initCreateRangeChoice();</span>
<span class="nc" id="L77">        initDeleteRangeChoice();</span>

		//Add Toolbar
<span class="nc" id="L80">		m_toolbar = new ToolbarPC(context);</span>
<span class="nc" id="L81">		addChildComponent(m_toolbar);</span>
<span class="nc" id="L82">	}</span>

	/**
	 * Initialize the Create Blackout Day Range Radio Button
	 */
	private void initCreateRangeChoice() {
<span class="nc" id="L88">        String createBODaysString = i18n(m_rmBundle,</span>
				RmWebBundleKey.RM_ORG_REQUEST_PROCESSING_AVAILABLETIMEOFF_BO_RANGE_CREATE_BO_DAYS);
<span class="nc" id="L90">        boolean isChecked = true;</span>
<span class="nc" id="L91">        String onClickJS = &quot;&quot;;</span>
<span class="nc" id="L92">        boolean isCheckBox = false;</span>
<span class="nc" id="L93">        m_createBODaysChoice = HtmlChoiceInput.newInstance(BO_DAYS_TYPE_FN, </span>
            CREATE_BO_DAYS_FV, createBODaysString, isChecked, onClickJS, isCheckBox);
<span class="nc" id="L95">	}</span>

	/**
	 * Initialize the Delete Blackout Day Range Radio Button
	 */
	private void initDeleteRangeChoice() {
<span class="nc" id="L101">        String deleteBODaysString = i18n(m_rmBundle,</span>
				RmWebBundleKey.RM_ORG_REQUEST_PROCESSING_AVAILABLETIMEOFF_BO_RANGE_DELETE_BO_DAYS);
<span class="nc" id="L103">        boolean isChecked = false;</span>
<span class="nc" id="L104">        String onClickJS = &quot;&quot;;</span>
<span class="nc" id="L105">        boolean isCheckBox = false;</span>
<span class="nc" id="L106">        m_deleteBODaysChoice = HtmlChoiceInput.newInstance(BO_DAYS_TYPE_FN, </span>
            DELETE_BO_DAYS_FV, deleteBODaysString, isChecked, onClickJS, isCheckBox);
<span class="nc" id="L108">	}</span>

	/**
	 * Return an instance of the model that is ready for rendering
     */
	public static PageModel getInstance(RequestContext context) throws Exception {
<span class="nc" id="L114">		return getInstance(context, SetBlackoutDayRangePopupPM.class);</span>
	}

	/**
	 * Ensure the model is populated
	 */
	@Override
	protected void initializeModel() {
<span class="nc bnc" id="L122" title="All 2 branches missed.">		if (m_isInitialized) {</span>
<span class="nc" id="L123">			return;</span>
		} else {
<span class="nc" id="L125">			m_isInitialized = true;</span>
		}
		try	{
			//m_empNameList = TimeOffRequestsMH.getEmpNamesForTOHour(m_orgID, m_date, m_hourType);
			
<span class="nc bnc" id="L130" title="All 2 branches missed.">			if (m_poolID != null) {</span>
<span class="nc" id="L131">				m_pool = RmManagerFactory.getInstance().getTimeOffDayFacade().getTOPool(m_poolID);</span>
			}			
			
<span class="nc" id="L134">		} catch (Exception ex) {</span>
<span class="nc" id="L135">			handleUnableToLoadDataError(log, ex);</span>
		} finally {
<span class="nc" id="L137">			initContentTitle();</span>
			//initContent();
<span class="nc" id="L139">			initToolbar();</span>
<span class="nc" id="L140">		}</span>
<span class="nc" id="L141">	}</span>

	/**
	 * Prepare content title for rendering
	 */
	private void initContentTitle() {
<span class="nc" id="L147">		m_contentTitlePC.setPageTitle(i18n(m_rmBundle,</span>
				RmWebBundleKey.RM_ORG_REQUEST_PROCESSING_AVAILABLETIMEOFF_BO_RANGE_PAGE_TITLE));

<span class="nc" id="L150">		m_contentTitlePC.setItemName(getPoolName());</span>
<span class="nc" id="L151">	}</span>

	/**
	 * Initialize Toolbar
	 */
	@Override
	protected void initToolbar() {
<span class="nc" id="L158">		ToolbarUtil.addSaveBtn(m_toolbar, true);</span>
<span class="nc" id="L159">		ToolbarUtil.addCloseWindowCancelBtn(m_toolbar, true);</span>
<span class="nc" id="L160">	}</span>

	/**
	 * Return the HTML content for this popup window
	 */
    @Override
	public String getHtmlDisplay() {
<span class="nc" id="L167">        String datePickerLabel = i18n(m_rmBundle,</span>
				RmWebBundleKey.RM_ORG_REQUEST_PROCESSING_AVAILABLETIMEOFF_BO_RANGE_DATE_RANGE);

<span class="nc" id="L170">		StringBuffer aBuf = new StringBuffer();</span>
<span class="nc" id="L171">		aBuf.append(&quot;&lt;table width=\&quot;100%\&quot; cellpadding=\&quot;0\&quot; border=\&quot;0\&quot; cellspacing=\&quot;0\&quot;&gt;&quot;);</span>

<span class="nc" id="L173">		aBuf.append(&quot;&lt;tr class=\&quot;tblRow\&quot;&gt;&lt;td class=\&quot;tblItem\&quot;&gt;&quot;);</span>
<span class="nc" id="L174">        aBuf.append(datePickerLabel).append(&quot; &amp;nbsp; &quot;);</span>
<span class="nc" id="L175">		aBuf.append(m_dateRangePickerPC.getHtmlDisplay());</span>
<span class="nc" id="L176">		aBuf.append(&quot;&lt;/td&gt;&lt;/tr&gt;&quot;);</span>

<span class="nc" id="L178">		aBuf.append(&quot;&lt;tr class=\&quot;tblRow\&quot;&gt;&lt;td class=\&quot;tblItem\&quot;&gt;&quot;);</span>
<span class="nc" id="L179">		aBuf.append(&quot;&amp;nbsp;&quot;);</span>
<span class="nc" id="L180">		aBuf.append(&quot;&lt;/td&gt;&lt;/tr&gt;&quot;);</span>

<span class="nc" id="L182">		aBuf.append(&quot;&lt;tr class=\&quot;tblRow\&quot;&gt;&lt;td class=\&quot;tblItem\&quot;&gt;&quot;);</span>
<span class="nc" id="L183">		aBuf.append(getChoiceCreateHTML());</span>
<span class="nc" id="L184">		aBuf.append(&quot;&lt;/td&gt;&lt;/tr&gt;&quot;);</span>

<span class="nc" id="L186">		aBuf.append(&quot;&lt;tr class=\&quot;tblRow\&quot;&gt;&lt;td class=\&quot;tblItem\&quot;&gt;&quot;);</span>
<span class="nc" id="L187">		aBuf.append(getChoiceDeleteHTML());</span>
<span class="nc" id="L188">		aBuf.append(&quot;&lt;/td&gt;&lt;/tr&gt;&quot;);</span>

<span class="nc" id="L190">    	aBuf.append(&quot;&lt;/table&gt;&quot;);</span>
<span class="nc" id="L191">		return aBuf.toString();</span>
	}

	/**
	 * Return the HTML for the create blackout days radio button
	 */
    private String getChoiceCreateHTML() {
<span class="nc" id="L198">        return m_createBODaysChoice.getHtmlDisplay();</span>
    }

	/**
	 * Return the HTML for the delete blackout days radio button
	 */
    private String getChoiceDeleteHTML() {
<span class="nc" id="L205">        return m_deleteBODaysChoice.getHtmlDisplay();</span>
    }

	/**
	 * Return true if radio button is set to create blackout days
	 */
	public boolean isCreateBlackoutDays() {
<span class="nc" id="L212">		return m_createBODaysChoice.isChecked();</span>
	}

	/**
	 * Return true if radio button is set to delete blackout days
	 */
	public boolean isDeleteBlackoutDays() {
<span class="nc" id="L219">		return m_deleteBODaysChoice.isChecked();</span>
	}

	/**
	 * Return the start date selected.
	 */
    public Date getStartDate() {
<span class="nc" id="L226">        return m_dateRangePickerPC.getStartDatePickerPC().getDate();</span>
    }

	/**
	 * Return the end date selected.
	 */
    public Date getEndDate() {
<span class="nc" id="L233">        return m_dateRangePickerPC.getEndDatePickerPC().getDate();</span>
    }

	@Override
	public boolean extractParameters(HttpServletRequest request) {
<span class="nc" id="L238">		boolean success=super.extractParameters(request);</span>
		try {
<span class="nc" id="L240">            String boDaysParameter = request.getParameter(BO_DAYS_TYPE_FN);</span>
<span class="nc bnc" id="L241" title="All 2 branches missed.">            if (boDaysParameter != null) {</span>
<span class="nc bnc" id="L242" title="All 2 branches missed.">                if (boDaysParameter.equals(CREATE_BO_DAYS_FV)) {</span>
<span class="nc" id="L243">                    m_createBODaysChoice.setIsChecked(true);</span>
<span class="nc" id="L244">                    m_deleteBODaysChoice.setIsChecked(false);</span>
                }
                else {
<span class="nc" id="L247">                    m_createBODaysChoice.setIsChecked(false);</span>
<span class="nc" id="L248">                    m_deleteBODaysChoice.setIsChecked(true);</span>
                }
            }
		}
<span class="nc" id="L252">		catch (Exception e) {</span>
<span class="nc" id="L253">			log.l7dError(RmWebLogBundleKey.EXTRACT_PARAM_FAILED, e);</span>
<span class="nc" id="L254">		}</span>
<span class="nc" id="L255">		return success;</span>
	}

	/**
	 * Setter for pool ID. Automatically extracted.
	 * @param poolID
	 */
	public void setPerformActionOnID(ID poolID)
	{
<span class="nc" id="L264">		m_poolID = poolID;</span>
<span class="nc" id="L265">	}</span>
	
	/**
	 * Getter for pool ID.
	 * @return the time off pool ID
	 */
	public ID getPoolID()
	{
<span class="nc" id="L273">		return m_poolID;</span>
	}
	
	/**
	 * Setter for pool Name. Automatically extracted.
	 * @param poolName
	 *
	public void setPoolName(String poolName)
	{
		m_poolName = poolName;
	}
	*/
	
	/**
	 * Getter for pool Name.
	 * @return the time off pool name
	 */
	public String getPoolName()
	{
<span class="nc bnc" id="L292" title="All 2 branches missed.">		return m_pool==null ? &quot;&quot; : m_pool.getName();</span>
	}

	/**
	 * Return the Required HTML for this component.
	 */
	@Override
	public String getRequiredHTML() 
	{
<span class="nc" id="L301">		return super.getRequiredHTML() +</span>
<span class="nc" id="L302">				HtmlUtil.makeHiddenInput(WorkpaneFieldNames.PERFORM_ACTION_ON_ID_FN, m_poolID); //store poolID</span>
	}

	public boolean isCloseAfterLoadCustomize() {
<span class="nc" id="L306">		return isCloseAfterLoadCustomize;</span>
	}

	public void setCloseAfterLoadCustomize(boolean isCloseAfterLoadCustomize) {
<span class="nc" id="L310">		this.isCloseAfterLoadCustomize = isCloseAfterLoadCustomize;</span>
<span class="nc" id="L311">	}</span>
	@Override
	public String getJavaScriptInitCode() {
<span class="nc" id="L314">		StringBuffer jsInit = new StringBuffer(1000);</span>
<span class="nc" id="L315">		jsInit.append(super.getJavaScriptInitCode());</span>
<span class="nc bnc" id="L316" title="All 2 branches missed.">		if(isCloseAfterLoadCustomize()){</span>
<span class="nc" id="L317">			jsInit.append(super.getJSBeforeClose() );</span>
<span class="nc" id="L318">			jsInit.append(&quot;\nwindow.notifyOpener=true;\n&quot;);</span>
<span class="nc" id="L319">			jsInit.append(&quot;if(is.chrome)\n&quot;);</span>
<span class="nc" id="L320">			jsInit.append(&quot;    handleUnload(window);\n&quot;);</span>
<span class="nc" id="L321">			jsInit.append(&quot;window.close();\n&quot;); </span>
		}
<span class="nc" id="L323">		return jsInit.toString();</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>