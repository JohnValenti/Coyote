<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>PulsePortlet.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.verint.web.fs.dashboard.portlets.pulse</a> &gt; <span class="el_source">PulsePortlet.java</span></div><h1>PulsePortlet.java</h1><pre class="source lang-java linenums">package com.verint.web.fs.dashboard.portlets.pulse;

import java.awt.Point;
import java.io.PrintWriter;
import java.text.MessageFormat;

import javax.portlet.PortletMode;
import javax.portlet.PortletPreferences;
import javax.portlet.PortletRequest;
import javax.portlet.RenderRequest;
import javax.portlet.RenderResponse;
import javax.servlet.http.HttpSession;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.web.core.l10n.CoreWebLogBundleKey;
import com.verint.web.core.dashboard.pluto.PlutoRequestUtil;
import com.verint.web.core.dashboard.portlets.MultiIFramePortlet;
import com.verint.web.fs.dashboard.portlets.pulse.util.Constants;
import com.witness.web.uif.keys.SessionKeys;
import com.witness.web.uif.l10n.CommonWebLogBundleKey;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.system.integration.IntegrationUtil;

/**
 * This class renders the appropriate view for a Pulse Portlet. The Pulse
 * Portlet has a Forecasted Vs Requested Vs Actual graph
 * 
 * @author RPochana
 * 
 */
<span class="nc" id="L31">public class PulsePortlet extends MultiIFramePortlet {</span>

	private static final int PORTLET_WINDOW_WIDTH_SMALL = 425;
	private static final int PORTLET_WINDOW_WIDTH_MEDIUM = 550;
	private static final int PORTLET_WINDOW_HEIGHT_SMALL = 190;
	private static final int PORTLET_WINDOW_HEIGHT_MEDIUM = 315;

	@Override
	protected String getURL(PortletRequest request) {
<span class="nc" id="L40">		PortletPreferences prefs = request.getPreferences();</span>

<span class="nc bnc" id="L42" title="All 2 branches missed.">		if (PortletMode.VIEW.equals(request.getPortletMode())) {</span>
<span class="nc" id="L43">			RequestContext context = PlutoRequestUtil.getRequestContext(request);</span>
<span class="nc" id="L44">			ID userId = context.getUser().getEmployeeID();</span>
<span class="nc bnc" id="L45" title="All 2 branches missed.">			if (userId == null) {</span>
				// Abort if the user id does not exist, this is probably the super user.
<span class="nc" id="L47">				return &quot;&quot;;</span>
			}
<span class="nc" id="L49">			HttpSession session = context.getRequest().getSession();</span>

<span class="nc" id="L51">			String screenWidth = (String)session.getAttribute(SessionKeys.SCREEN_WIDTH);</span>
<span class="nc" id="L52">			String screenHeight = (String)session.getAttribute(SessionKeys.SCREEN_HEIGHT);</span>

			// TODO: remove these, using relative sizing instead
<span class="nc" id="L55">			Point portletWindowDim = getPortletWindow(context, screenWidth, screenHeight);</span>
<span class="nc" id="L56">			int portletWidth = portletWindowDim.x;</span>
<span class="nc" id="L57">			int portletHeight = portletWindowDim.y;</span>

<span class="nc" id="L59">			String campaignId = prefs.getValue(Constants.CAMPAIGN_ID, null);</span>
<span class="nc" id="L60">			String datetype = prefs.getValue(Constants.DATE_PICKER_TYPE, null);</span>
<span class="nc" id="L61">			String startDate = prefs.getValue(Constants.DATE_DATE_RANGE_START_DATE, null);</span>
<span class="nc" id="L62">			String endDate = prefs.getValue(Constants.DATE_DATE_RANGE_END_DATE, null);</span>
<span class="nc" id="L63">			String lastperiodType = prefs.getValue(Constants.DATE_LAST_N_PERIOD_TYPE, null);</span>
<span class="nc" id="L64">			String lastperiod = prefs.getValue(Constants.DATE_LAST_N_PERIOD, null);</span>
<span class="nc" id="L65">			String statisticType = prefs.getValue(Constants.STATISTIC_TYPE, null);</span>
<span class="nc" id="L66">			String queueId = prefs.getValue(Constants.QUEUE_ID, null);</span>
<span class="nc" id="L67">			String trimToHOO = prefs.getValue(Constants.TRIM_TO_HOO, null);</span>

<span class="nc" id="L69">			String viewUrl = &quot;&quot;;</span>
			try {
				// create a message format for the URL pattern
<span class="nc bnc" id="L72" title="All 16 branches missed.">				String urlPattern = &quot;/fs/pulse/PulsePortletView.jsp?&quot;</span>
						+ (campaignId!=null?Constants.CAMPAIGN_ID + &quot;={0}&amp;&quot;:&quot;&quot; )
						+ &quot;userID={1}&amp;&quot;
						+ Constants.STATISTIC_TYPE + &quot;={2}&quot;
						+ (datetype!=null? &quot;&amp;&quot;+Constants.DATE_PICKER_TYPE+&quot;={3}&quot;:&quot;&quot;)
						+ (startDate!=null? &quot;&amp;&quot;+Constants.START_DATE+ &quot;={4}&quot;:&quot;&quot; )
						+ (endDate!=null ? &quot;&amp;&quot;+Constants.END_DATE+&quot;={5}&quot;:&quot;&quot;) 
						+ (lastperiodType!=null?&quot;&amp;&quot;+Constants.DATE_LAST_N_PERIOD_TYPE+&quot;={6}&quot;:&quot;&quot;)
						+ (lastperiod!=null?&quot;&amp;&quot;+Constants.DATE_LAST_N_PERIOD+&quot;={7}&quot;:&quot;&quot;)
						+ (queueId!=null ? &quot;&amp;&quot;+Constants.QUEUE_ID+&quot;={8}&quot;:&quot;&quot;)
						+ &quot;&amp;width={9}&amp;height={10}&quot;
						+ (trimToHOO != null ? &quot;&amp;&quot; + Constants.TRIM_TO_HOO + &quot;={11}&quot;:&quot;&quot;);

<span class="nc" id="L85">				MessageFormat mf = new MessageFormat(urlPattern);</span>
<span class="nc" id="L86">				Object[] args = new Object[] {</span>
					campaignId, // {0} = Campaign Id
<span class="nc" id="L88">					String.valueOf(userId), // {1} = User Id</span>
					statisticType, // {2} = statisticType
					datetype , //{3} = date type last N period or range
					startDate, // {4} = start date
					endDate, // {5} = end date
					lastperiodType, //{6} = last n period periodicity
					lastperiod, // {7} = last n period no of periods
					queueId,// {8} =queueID
<span class="nc" id="L96">					String.valueOf(portletWidth), // {9} = Width</span>
<span class="nc" id="L97">					String.valueOf(portletHeight), // {10} = Height</span>
					trimToHOO // {11} = boolean value whether to trim the queue data to the campaign hours of operation
				};

				// format the pattern to get the URL
<span class="nc" id="L102">				String integrationURL = mf.format(args);</span>

<span class="nc" id="L104">				viewUrl = IntegrationUtil.getQMIntegrationURL(context, true, true, integrationURL);</span>
			}
<span class="nc" id="L106">			catch (Exception e) {</span>
<span class="nc" id="L107">				log.l7dError(CommonWebLogBundleKey.UNABLE_TO_LOAD_DATA, e);</span>
<span class="nc" id="L108">			}</span>
<span class="nc" id="L109">			return viewUrl;</span>
		}
		else {
<span class="nc" id="L112">			return prefs.getValue(request.getPortletMode().toString() + &quot;ModeURL&quot;, &quot;about:blank&quot;);</span>
		}
	}

	private static Point getPortletWindow(
		RequestContext context,
		String screenWidth,
		String screenHeight)
	{ 
<span class="nc" id="L121">		Point p = new Point(PORTLET_WINDOW_WIDTH_MEDIUM, PORTLET_WINDOW_HEIGHT_MEDIUM);</span>
		try {
<span class="nc" id="L123">			int iScreenWidth = Integer.parseInt(screenWidth);</span>
<span class="nc" id="L124">			int iScreenHeight = Integer.parseInt(screenHeight);</span>
<span class="nc bnc" id="L125" title="All 2 branches missed.">			if (iScreenWidth &lt; 1280) {</span>
<span class="nc" id="L126">				p.x = PORTLET_WINDOW_WIDTH_SMALL;</span>
<span class="nc" id="L127">				p.y = PORTLET_WINDOW_HEIGHT_SMALL;</span>
			}
		}
<span class="nc" id="L130">		catch (NumberFormatException ex) {</span>
<span class="nc" id="L131">			log.warn(context.getLocalizer().i18n(</span>
				CoreWebLogBundleKey.BUNDLE_NAME,
				CoreWebLogBundleKey.PORTLET_WINDOW_WIDTH_PARSE_ERROR,
<span class="nc" id="L134">				new Object[] {screenWidth, PORTLET_WINDOW_WIDTH_MEDIUM}));</span>
<span class="nc" id="L135">		}</span>
<span class="nc" id="L136">		return p;</span>
	}

	@Override
	protected void writeError(
		RequestContext context,
		PrintWriter pw,
		String bundleName,
		String messageKey,
		Object[] args)
	{
<span class="nc bnc" id="L147" title="All 2 branches missed.">		if (args == null) {</span>
<span class="nc" id="L148">			args = new Object[0];</span>
		}
		// make an outer div to erase any existing table cell alignment
<span class="nc" id="L151">		pw.write(&quot;&lt;div style='width: 100%; height: 100%; padding: 0px; margin: 0px;'&gt;&quot;);</span>
<span class="nc" id="L152">		pw.write(&quot;&lt;div class='portlet-msg-alert'&gt;&quot;);</span>
<span class="nc" id="L153">		pw.write(context.getLocalizer().i18n(bundleName, messageKey, args));</span>
<span class="nc" id="L154">		pw.write(&quot;&lt;/div&gt;&lt;/div&gt;&quot;);</span>
<span class="nc" id="L155">	}</span>
	
	@Override
	protected boolean shouldAppendIDs(
		RequestContext context,
		RenderRequest request,
		RenderResponse response)
	{
<span class="nc" id="L163">		return true;</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>