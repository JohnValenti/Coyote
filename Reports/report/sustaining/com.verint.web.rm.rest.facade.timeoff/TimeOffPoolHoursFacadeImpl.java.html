<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>TimeOffPoolHoursFacadeImpl.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.verint.web.rm.rest.facade.timeoff</a> &gt; <span class="el_source">TimeOffPoolHoursFacadeImpl.java</span></div><h1>TimeOffPoolHoursFacadeImpl.java</h1><pre class="source lang-java linenums">package com.verint.web.rm.rest.facade.timeoff;

/**
 * Created by kseetharaman on 5/10/2016.
 */

import java.util.ArrayList;
import java.util.Calendar;
import java.util.Collection;
import java.util.Collections;
import java.util.Date;
import java.util.Iterator;
import java.util.List;

import javax.ws.rs.core.Response;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.LocalDate;
import com.bluepumpkin.common.logging.Category;
import com.bluepumpkin.ejb.rm.RmManagerFactory;
import com.bluepumpkin.ejb.rm.setup.calendartimeoff.ejb.CalendarTimeOffDayFacade;
import com.bluepumpkin.ejb.rm.setup.calendartimeoff.model.CalendarTimeOffDay;
import com.bluepumpkin.web.rm.Log;
import com.verint.web.rest.exception.checked.BusinessWFOException;
import com.verint.web.rest.exception.checked.SystemWFOException;
import com.verint.web.rest.exception.checked.WFOException;
import com.verint.web.rest.util.FormatUtils;
import com.verint.web.rm.rest.entity.timeoff.TimeOffPoolHoursEntity;
import com.verint.web.rm.rest.entity.timeoff.TimeOffPoolHoursParamEntity;
import com.witness.web.uif.system.RequestContext;

public class TimeOffPoolHoursFacadeImpl implements ITimeOffPoolHoursFacade {
<span class="nc" id="L33">    private static final Category logger = Log.initCategory(TimeOffPoolHoursFacadeImpl.class.getName());</span>

<span class="nc" id="L35">    public TimeOffPoolHoursFacadeImpl() {</span>
<span class="nc" id="L36">    }</span>
    @Override
	public boolean checkIfTOPoolHoursExist(RequestContext context, ID toPoolId, Calendar startCal, Calendar endCal) throws WFOException
    {
        try
        {
<span class="nc" id="L42">            Collection timeOffPoolHours = getTOPoolHours(toPoolId, startCal, endCal);</span>
<span class="nc bnc" id="L43" title="All 2 branches missed.">            if(timeOffPoolHours.isEmpty()) {</span>
<span class="nc" id="L44">				return false;</span>
			} else {
<span class="nc" id="L46">				return true;</span>
			}
        }
<span class="nc" id="L49">        catch (BusinessWFOException ex) {</span>
<span class="nc" id="L50">            logger.error(ex.getLocalizedMessage(), ex);</span>
<span class="nc" id="L51">            throw ex;</span>
        }
<span class="nc" id="L53">        catch (Exception ex) {</span>
<span class="nc" id="L54">            logger.error(ex.getLocalizedMessage(), ex);</span>
<span class="nc" id="L55">            throw new SystemWFOException(ex.getLocalizedMessage());</span>
        }

    }
    @Override
	public List&lt;TimeOffPoolHoursEntity&gt; getTOPoolHours(RequestContext context, ID toPoolId, Calendar startCal, Calendar endCal) throws WFOException
    {
        try
        {
<span class="nc" id="L64">            Collection timeOffPoolHours = getTOPoolHours(toPoolId, startCal, endCal);</span>
<span class="nc" id="L65">            List&lt;TimeOffPoolHoursEntity&gt; toPoolEntity = buildTimeOffPoolHoursEntity(timeOffPoolHours);</span>
<span class="nc" id="L66">            return toPoolEntity;</span>
        }
<span class="nc" id="L68">        catch (BusinessWFOException ex) {</span>
<span class="nc" id="L69">            logger.error(ex.getLocalizedMessage(), ex);</span>
<span class="nc" id="L70">            throw ex;</span>
        }
<span class="nc" id="L72">        catch (Exception ex) {</span>
<span class="nc" id="L73">            logger.error(ex.getLocalizedMessage(), ex);</span>
<span class="nc" id="L74">            throw new SystemWFOException(ex.getLocalizedMessage());</span>
        }


    }

    public void saveTOPoolHours(List&lt;TimeOffPoolHoursParamEntity&gt; timeOffPoolHoursParamEntities) throws WFOException
    {

        try {
<span class="nc bnc" id="L84" title="All 4 branches missed.">            if (timeOffPoolHoursParamEntities == null || timeOffPoolHoursParamEntities.isEmpty()){</span>
<span class="nc" id="L85">                throw new BusinessWFOException(&quot;Time off hours list is empty&quot;, Response.Status.CONFLICT);</span>
            }
<span class="nc" id="L87">                saveTimeOffPoolHours(getCalendarTimeOffDayCollection(timeOffPoolHoursParamEntities));</span>
<span class="nc" id="L88">        }catch (BusinessWFOException ex){</span>
<span class="nc" id="L89">            logger.error(ex.getLocalizedMessage(), ex);</span>
<span class="nc" id="L90">            throw ex;</span>
<span class="nc" id="L91">        } catch (Exception ex) {</span>
<span class="nc" id="L92">            logger.error(ex.getLocalizedMessage(), ex);</span>
<span class="nc" id="L93">            throw new SystemWFOException(ex.getLocalizedMessage());</span>
<span class="nc" id="L94">        }</span>

<span class="nc" id="L96">    }</span>
    @Override
	public void deleteTOPoolHours(RequestContext context, ID toPoolId, Date startDate, Date endDate) throws WFOException
    {
        try
        {
<span class="nc" id="L102">           deleteTimeOffPoolHours(toPoolId,startDate,endDate);</span>
<span class="nc" id="L103">        } catch (BusinessWFOException ex){</span>
<span class="nc" id="L104">            logger.error(ex.getLocalizedMessage(), ex);</span>
<span class="nc" id="L105">            throw ex;</span>
<span class="nc" id="L106">        } catch (Exception ex) {</span>
<span class="nc" id="L107">            logger.error(ex.getLocalizedMessage(), ex);</span>
<span class="nc" id="L108">            throw new SystemWFOException(ex.getLocalizedMessage());</span>
<span class="nc" id="L109">        }</span>
<span class="nc" id="L110">    }</span>
    private void deleteTimeOffPoolHours(ID toPoolId, Date startDate, Date endDate) throws Exception
    {
<span class="nc" id="L113">        CalendarTimeOffDayFacade ctodf = RmManagerFactory.getInstance().getTimeOffDayFacade();</span>
<span class="nc bnc" id="L114" title="All 2 branches missed.">        if (toPoolId != null) {</span>
<span class="nc" id="L115">			ctodf.deleteTimeOffDays(toPoolId, startDate, endDate);</span>
		}
<span class="nc" id="L117">    }</span>

    private Collection getTOPoolHours(ID toPoolId, Calendar startCal, Calendar endCal) throws Exception
    {
<span class="nc" id="L121">        CalendarTimeOffDayFacade ctodf = RmManagerFactory.getInstance().getTimeOffDayFacade();</span>

<span class="nc" id="L123">        LocalDate localStartDate = new LocalDate(startCal);</span>
<span class="nc" id="L124">        LocalDate localEndDate = new LocalDate(endCal);</span>
<span class="nc bnc" id="L125" title="All 2 branches missed.">        if (toPoolId != null) {</span>
<span class="nc" id="L126">            return ctodf.getCalendarTimeOffDays(toPoolId, localStartDate, localEndDate, false);</span>
        } else {
<span class="nc" id="L128">            return Collections.emptyList();</span>
        }
    }

    private List&lt;TimeOffPoolHoursEntity&gt; buildTimeOffPoolHoursEntity(Collection timeOffPoolHours)
    {
<span class="nc" id="L134">        ArrayList&lt;TimeOffPoolHoursEntity&gt; toPoolEntities = new ArrayList();</span>
<span class="nc bnc" id="L135" title="All 2 branches missed.">        for (Iterator itt = timeOffPoolHours.iterator(); itt.hasNext();)</span>
        {
<span class="nc" id="L137">            CalendarTimeOffDay timeOffCalDay = (CalendarTimeOffDay) itt.next();</span>
<span class="nc" id="L138">            Date timeOffDate = timeOffCalDay.getTimeOffDate();</span>
<span class="nc" id="L139">            double allocatedHours = timeOffCalDay.getAllocatedHours();</span>
<span class="nc" id="L140">            TimeOffPoolHoursEntity toPoolEntity = new TimeOffPoolHoursEntity();</span>
<span class="nc" id="L141">            toPoolEntity.setTime(FormatUtils.dateToISO8601SecPrecisionString(timeOffDate));</span>
<span class="nc" id="L142">            toPoolEntity.setVacationHours(allocatedHours);</span>
<span class="nc" id="L143">            toPoolEntities.add(toPoolEntity);</span>
<span class="nc" id="L144">        }</span>
<span class="nc" id="L145">        return toPoolEntities;</span>
    }

    private List&lt;CalendarTimeOffDay&gt; getCalendarTimeOffDayCollection(List&lt;TimeOffPoolHoursParamEntity&gt; timeOffPoolHoursParamEntities) throws Exception
    {
        try {
<span class="nc" id="L151">            ArrayList&lt;CalendarTimeOffDay&gt; listCalTimeOffDay = new ArrayList&lt;CalendarTimeOffDay&gt;();</span>
<span class="nc bnc" id="L152" title="All 2 branches missed.">            for (TimeOffPoolHoursParamEntity timeOffPoolHours : timeOffPoolHoursParamEntities ) {</span>
<span class="nc" id="L153">                CalendarTimeOffDay calendarTimeOffDay = new CalendarTimeOffDay();</span>
<span class="nc" id="L154">                int nTOPoolId = timeOffPoolHours.getToPoolId();</span>
<span class="nc" id="L155">                ID toPoolID = new ID(nTOPoolId);</span>
<span class="nc" id="L156">                calendarTimeOffDay.setTOPoolID(toPoolID);</span>

<span class="nc" id="L158">                double allocatedhours = timeOffPoolHours.getVacationHours();</span>
<span class="nc" id="L159">                calendarTimeOffDay.setAllocatedHours(allocatedhours);</span>

<span class="nc" id="L161">                Date time = FormatUtils.iso8601SecPrecisionStringToDate(timeOffPoolHours.getTime());</span>
<span class="nc bnc" id="L162" title="All 2 branches missed.">                if(time == null) {</span>
<span class="nc" id="L163">                    throw new BusinessWFOException(&quot;Date is not valid&quot;,Response.Status.CONFLICT);</span>
                }
<span class="nc" id="L165">                calendarTimeOffDay.setTimeOffDate(time);</span>
<span class="nc" id="L166">                listCalTimeOffDay.add(calendarTimeOffDay);</span>
<span class="nc" id="L167">            }</span>
<span class="nc" id="L168">            return listCalTimeOffDay;</span>
<span class="nc" id="L169">        }catch(Exception e)</span>
        {
<span class="nc" id="L171">            throw e;</span>
        }

    }

    private void saveTimeOffPoolHours(Collection&lt;CalendarTimeOffDay&gt; colCalendarTimeOffDay) throws Exception
    {
<span class="nc" id="L178">        CalendarTimeOffDayFacade ctodf = RmManagerFactory.getInstance().getTimeOffDayFacade();</span>
<span class="nc" id="L179">        ctodf.createTimeOffDays(colCalendarTimeOffDay);</span>

<span class="nc" id="L181">    }</span>


}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>