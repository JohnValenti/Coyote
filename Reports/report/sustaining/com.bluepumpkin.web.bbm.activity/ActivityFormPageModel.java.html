<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>ActivityFormPageModel.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.bbm.activity</a> &gt; <span class="el_source">ActivityFormPageModel.java</span></div><h1>ActivityFormPageModel.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.bbm.activity;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.StringsPair;
import com.bluepumpkin.common.keys.DBInfo;
import com.bluepumpkin.common.logging.Category;
import com.bluepumpkin.common.util.StringUtil;
import com.bluepumpkin.ejb.bbm.activity.model.Activity;
import com.bluepumpkin.ejb.bbm.activity.model.ActivityFieldInfo;
import com.bluepumpkin.ejb.bbm.activity.model.ActivityProperties;
import com.bluepumpkin.ejb.bbm.base.BbmException;
import com.bluepumpkin.ejb.bbm.paypolicy.model.EarningTypeManager;
import com.bluepumpkin.ejb.bbm.workload.model.Media;
import com.bluepumpkin.ejb.bbm.workresource.OrganizationScopeManagerProxy;
import com.bluepumpkin.ejb.bbm.workresource.model.Organization;
import com.bluepumpkin.ejb.core.CoreManagerFactory;
import com.bluepumpkin.web.bbm.Log;
import com.bluepumpkin.web.bbm.earningtype.EarningTypeModelHandler;
import com.bluepumpkin.web.bbm.l10n.BbmWebBundleKey;
import com.bluepumpkin.web.bbm.l10n.BbmWebLogBundleKey;
import com.bluepumpkin.web.bbm.organization.OrgWorkpaneFormPageModel;
import com.bluepumpkin.web.bbm.organization.OrganizationModelHandler;
import com.bluepumpkin.web.bbm.workload.MediaSelectorPopupPageModel;
import com.bluepumpkin.web.bbm.workload.WorkloadModelHandler;
import com.bluepumpkin.web.bbm.workload.queue.QueueSelectorPopupPageModel;
import com.bluepumpkin.web.core.setup.mediatypes.MediaTypesSetupPageModel;
import com.verint.web.wfm.keys.WfmJavaScriptFileID;
import com.witness.ejb.core.licensing.LicenseKeys;
import com.witness.ejb.core.licensing.ejb.LicenseManager;
import com.witness.ejb.core.security.PrivilegeKeys;
import com.witness.web.uif.base.Message;
import com.witness.web.uif.keys.ImageFileID;
import com.witness.web.uif.keys.JavaScriptFileID;
import com.witness.web.uif.keys.PageAction;
import com.witness.web.uif.l10n.UIFWebBundleKey;
import com.witness.web.uif.pagecomponent.form.FormTwoColumnPC;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.util.ColorUtil;
import com.witness.web.uif.util.HtmlUtil;
import com.witness.web.uif.util.html.CSSUtil;
import com.witness.web.uif.util.html.HtmlChoiceInput;
import com.witness.web.uif.util.js.JSUtil;
import com.witness.web.uif.validator.IsEnteredFieldValidator;

import javax.servlet.http.HttpServletRequest;
import java.rmi.RemoteException;
import java.util.*;

/**
 * Title:        ActivityFormPageModel
 * Description:  Display a form for activity
 * Copyright:    Copyright (c) 2001
 * Company:      Blue Pumpkin Software, inc
 *
 * @author Shimon Kakon
 * @version 1.0
 */
@SuppressWarnings(&quot;serial&quot;)
public class ActivityFormPageModel extends OrgWorkpaneFormPageModel {
<span class="nc" id="L60">	private static final Category log = Log.initCategory(ActivityFormPageModel.class.getName());</span>
	private Activity m_activity;
	private ActivityProperties activityProperties;

	private Collection&lt;ID&gt; m_mediaIds;
<span class="nc" id="L65">	private boolean m_hasMedia = false;</span>
<span class="nc" id="L66">	private boolean m_hasProjectMedia = false;</span>

	private Collection&lt;ID&gt; m_queueIds; //the queue hopping (or Project) queueIDs linked to this activity (if any)
<span class="nc" id="L69">	private boolean m_hasQueues = false; //does this activity have any queue hopping (or Project) queues linked to it?</span>

	private Collection&lt;StringsPair&gt; m_activityTypeStringPair;
	private Collection&lt;StringsPair&gt; m_earningTypeStringPair;
	private String m_selectedActivityType;
	private String m_selectedEarningType;
	private FormTwoColumnPC m_formPC;
	private final ActivityUsage m_fsUsagePC;
	private final ActivityUsage m_rmUsagePC;
	private final ActivityUsage m_amUsagePC;
	private final ActivityUsage m_advisorUsagePC;
<span class="nc" id="L80">	private final StringBuffer m_hiddenFields = new StringBuffer(512);</span>
	private short[] m_displayMap;

	// Constants
	public static final boolean PAID_DEFAULT = false;
	public static final boolean TIMEOFF_DEFAULT = false;
<span class="nc" id="L86">	public static final ID EARNING_TYPE_DEFAULT = EarningTypeManager.REGULAR;</span>
	private static final String ACTIVITY_COLOR_PICKER_NAME = &quot;POPUP_ACTIVITY_COLOR_PICKER&quot;;
	private static final String ACTIVITY_COLOR_DEFAULT = &quot;#F7FFCF&quot;;

	private static final String MEDIA_NAMES_DISPLAY_FN = &quot;mediaNamesDisplay&quot;;
	private static final String MEDIA_NAMES_DISPLAY_SPAN = &quot;mediaSpan&quot;;
	private static final String ACTIVITY_FIELD_ON_CHANGE = &quot;activityOnChange(this);&quot;;

	private static final String QUEUE_NAMES_DISPLAY_FN = &quot;queueNamesDisplay&quot;;
	private static final String QUEUE_NAMES_DISPLAY_SPAN = &quot;queueSpan&quot;;

<span class="nc" id="L97">	private boolean m_hasPayrollLicense = false;</span>
<span class="nc" id="L98">	private boolean m_hasMultiMediaLicense = false;</span>
<span class="nc" id="L99">	private boolean m_hasQueueHoppingLicense = false;</span>
<span class="nc" id="L100">	private boolean m_hasAdvisorLicense = false;</span>

	/**
	 * Constructor
	 *
	 * @param context Request Context
	 */
	public ActivityFormPageModel(RequestContext context) {
<span class="nc" id="L108">		super(context);</span>
<span class="nc" id="L109">		addRequiredJavaScriptFile(JavaScriptFileID.JQUERY);</span>
<span class="nc" id="L110">		m_activity = new Activity();</span>
<span class="nc" id="L111">		activityProperties = new ActivityProperties();</span>

		// PC needed for extract parameters
<span class="nc" id="L114">		m_fsUsagePC = new ActivityFSUsage(context, m_bbmBundle, m_activity, activityProperties);</span>
<span class="nc" id="L115">		addChildComponent(m_fsUsagePC);</span>
<span class="nc" id="L116">		m_rmUsagePC = new ActivityRMUsage(context, m_bbmBundle, m_activity, activityProperties);</span>
<span class="nc" id="L117">		addChildComponent(m_rmUsagePC);</span>
<span class="nc" id="L118">		m_amUsagePC = new ActivityAMUsage(context, m_bbmBundle, m_activity, activityProperties);</span>
<span class="nc" id="L119">		addChildComponent(m_amUsagePC);</span>
<span class="nc" id="L120">		m_advisorUsagePC = new ActivityAdvisorUsage(context, m_bbmBundle, m_activity, activityProperties);</span>
<span class="nc" id="L121">		addChildComponent(m_advisorUsagePC);</span>
<span class="nc" id="L122">	}</span>


	public boolean extractParameters(HttpServletRequest request) {
<span class="nc" id="L126">		boolean success = super.extractParameters(request);</span>

		// now get the value for check boxes since checkboxes values are not
		// submitted with a form if they are not checked

<span class="nc" id="L131">		String boolValue = request.getParameter(ActivityFields.PAID_FN);</span>
<span class="nc bnc" id="L132" title="All 2 branches missed.">		setPaid((!StringUtil.isEmpty(boolValue)));</span>

<span class="nc" id="L134">		boolValue = request.getParameter(ActivityFields.TIMEOFF_FN);</span>
<span class="nc bnc" id="L135" title="All 2 branches missed.">		setTimeoff((!StringUtil.isEmpty(boolValue)));</span>

<span class="nc" id="L137">		boolValue = request.getParameter(ActivityFields.QUEUE_HOPPING_FN);</span>
<span class="nc bnc" id="L138" title="All 2 branches missed.">		setQueueHopping((!StringUtil.isEmpty(boolValue)));</span>

<span class="nc" id="L140">		boolValue = request.getParameter(ActivityFields.CAN_WORK_REMOTELY_FN);</span>
<span class="nc bnc" id="L141" title="All 2 branches missed.">		setAllowRemote((!StringUtil.isEmpty(boolValue)));</span>

<span class="nc" id="L143">		setSourceMeasureNullObjectIfNull();</span>

<span class="nc" id="L145">		return success;</span>
	}

	public boolean extractActivityPropertiesParameters(HttpServletRequest request) {
<span class="nc" id="L149">		super.extractParameters(request);</span>

<span class="nc" id="L151">		String boolValue = request.getParameter(ActivityFields.USE_DAILY_TOPOOL_FN);</span>
<span class="nc bnc" id="L152" title="All 2 branches missed.">		setUseDailyTOPool(!StringUtil.isEmpty(boolValue));</span>

<span class="nc" id="L154">		boolValue = request.getParameter(ActivityFields.USE_INTERVAL_TOPOOL_FN);</span>
<span class="nc bnc" id="L155" title="All 2 branches missed.">		setUseIntervalTOPool(!StringUtil.isEmpty(boolValue));</span>

<span class="nc" id="L157">		boolValue = request.getParameter(ActivityFields.USE_ADVANCED_VTO_OPTIONS_FN);</span>
<span class="nc bnc" id="L158" title="All 2 branches missed.">		setUseAdvancedVTOOptions(!StringUtil.isEmpty(boolValue));</span>

<span class="nc" id="L160">		String flex = request.getParameter(ActivityFields.TIMEOFF_WITH_FLEX_FN);</span>
<span class="nc bnc" id="L161" title="All 2 branches missed.">		setTimeoffWithFlex(!StringUtil.isEmpty(flex) ? Integer.valueOf(flex).intValue() : ActivityProperties.TIME_OFF_TIME);</span>
		
<span class="nc" id="L163">		boolValue = request.getParameter(ActivityFields.USE_REQUIRED_PAY_PERIOD_HOURS_FN);</span>
<span class="nc bnc" id="L164" title="All 2 branches missed.">		setUseRequiredPayPeriodHours(!StringUtil.isEmpty(boolValue));</span>

<span class="nc" id="L166">		return true;</span>
	}


	/**
	 * Initialize Component For Display
	 */
	public void initForDisplay() {
<span class="nc bnc" id="L174" title="All 2 branches missed.">		if (m_isInitializedForDisplay) {</span>
<span class="nc" id="L175">			return;</span>
		} else {
<span class="nc" id="L177">			m_displayMap = ActivityFields.getDisplayMap(getActivityID());</span>
<span class="nc" id="L178">			super.initForDisplay();</span>
<span class="nc" id="L179">			addForm(m_formPC);</span>
<span class="nc" id="L180">			int numOfForms = 1;</span>
<span class="nc bnc" id="L181" title="All 2 branches missed.">			if (isAuthorizedToConfigureFSAttributes(getSelectedIDObject())) {</span>
<span class="nc bnc" id="L182" title="All 2 branches missed.">				if (ActivityFields.hasDisplayableField(m_displayMap, ActivityFields.FS)) {</span>
<span class="nc" id="L183">					addForm(m_fsUsagePC);</span>
<span class="nc" id="L184">					numOfForms++;</span>
				}
<span class="nc bnc" id="L186" title="All 2 branches missed.">				if (ActivityFields.hasDisplayableField(m_displayMap, ActivityFields.RM)) {</span>
<span class="nc" id="L187">					addForm(m_rmUsagePC);</span>
<span class="nc" id="L188">					numOfForms++;</span>
				}
			}
<span class="nc bnc" id="L191" title="All 4 branches missed.">			if (isAuthorizedToConfigureAMAttributes(getSelectedIDObject()) &amp;&amp; ActivityFields.hasDisplayableField(m_displayMap, ActivityFields.AM)) {</span>
<span class="nc" id="L192">				addForm(m_amUsagePC);</span>
<span class="nc" id="L193">				numOfForms++;</span>
			}
			//show advisor form only if license
<span class="nc bnc" id="L196" title="All 2 branches missed.">			if (m_hasAdvisorLicense) {</span>
<span class="nc" id="L197">				addForm(m_advisorUsagePC);</span>
<span class="nc" id="L198">				numOfForms++;</span>
			}
<span class="nc bnc" id="L200" title="All 2 branches missed.">			if (numOfForms &gt; 1) {</span>
<span class="nc" id="L201">				m_formPC.setWrapperCSSClass(CSSUtil.CLASS_BORDER_DEFAULT);</span>
			}
<span class="nc" id="L203">			addRequiredJavaScriptFile(JavaScriptFileID.MODULE_POPUPBUTTON);</span>
<span class="nc" id="L204">			addRequiredJavaScriptFile(JavaScriptFileID.MEDIATOR_WORKPANE_FORM);</span>
<span class="nc" id="L205">			setJSMediator(WfmJavaScriptFileID.MEDIATOR_ACTIVITY_WORKPANE_FORM);</span>
<span class="nc" id="L206">			addRequiredJavaScriptFile(WfmJavaScriptFileID.MEDIA_SELECTOR_POPUP);</span>
<span class="nc" id="L207">			addRequiredJavaScriptFile(WfmJavaScriptFileID.QUEUE_SELECTOR_POPUP);</span>
<span class="nc" id="L208">			addRequiredJavaScriptFile(WfmJavaScriptFileID.ACTIVITY_ON_CHANGE);</span>

			// Color picker popup
<span class="nc" id="L211">			addPopupArgs(ACTIVITY_COLOR_PICKER_NAME,</span>
				&quot;activity_color_picker&quot;,
				&quot;name=&quot; + ActivityFields.COLOR_FN, null, &quot;700,345,150,150&quot;, true, 1);

			// Media selector popup
<span class="nc" id="L216">			addPopupArgs(MediaSelectorPopupPageModel.MEDIA_SELECTOR_POPUP_ACTION,</span>
				MediaSelectorPopupPageModel.MEDIA_SELECTOR_POPUP_URL, ActivityFields.MEDIA_FN, null,
				MediaSelectorPopupPageModel.MEDIA_SELECTOR_POPUP_SIZE_POSITION, true, 1);

			// Queue selector popup
<span class="nc" id="L221">			addPopupArgs(QueueSelectorPopupPageModel.QUEUE_SELECTOR_POPUP_ACTION,</span>
				QueueSelectorPopupPageModel.QUEUE_SELECTOR_POPUP_URL, ActivityFields.QUEUES_FN + &quot;,&quot; + ActivityFields.MEDIA_FN + &quot;,&quot; + ActivityFields.OWNER_ORG_FN, null,
				QueueSelectorPopupPageModel.QUEUE_SELECTOR_POPUP_SIZE_POSITION, true, 1);
		}
<span class="nc" id="L225">	}</span>


	/**
	 * Return instance of Model which is ready to be rendered
	 *
	 * @param context Request Context
	 */
	public static ActivityFormPageModel getInstance(RequestContext context) {
<span class="nc" id="L234">		return (ActivityFormPageModel) getInstance(context, ActivityFormPageModel.class);</span>
	}

	/**
	 * Return the form title
	 *
	 * @return form title
	 */
	public String getFormTitle() {
<span class="nc" id="L243">		return i18n(m_bbmBundle, BbmWebBundleKey.ACTIVITY_FORM_TITLE);</span>
	}

	/**
	 * Return the Organization ID as a String. The selected ID is not always the
	 * owner org that is display in the form. For example - system activities org
	 * owner is the root, which cannot be selected from the selection pane.
	 *
	 * @return form title
	 */
	public String getOrganizationId() {
<span class="nc" id="L254">		return m_activity.getOrganizationId().toString();</span>
	}

	public void setOrganizationId(String id) {
<span class="nc" id="L258">		m_activity.setOrganizationId(new ID(id));</span>
<span class="nc" id="L259">	}</span>

	public ID getActivityID() {
<span class="nc bnc" id="L262" title="All 2 branches missed.">		if (m_performActionOnIDs == null) {</span>
<span class="nc" id="L263">			return null;</span>
		} else {
<span class="nc" id="L265">			return m_performActionOnIDs[getEditIndex()];</span>
		}
	}

	/**
	 * Returns the organization dispaly label
	 */
	public String getOrganizationLabel() {
<span class="nc" id="L273">		return i18n(m_bbmBundle, BbmWebBundleKey.LIST_HEADER_OWNER_ORG);</span>
	}

	public String getActivityOrganizationName() throws Exception {
<span class="nc" id="L277">		return OrganizationModelHandler.getOrganizationName(m_context, m_activity.getOrganizationId());</span>
	}

	public String getActivityName() {
<span class="nc bnc" id="L281" title="All 2 branches missed.">		return m_activity.getName() == null ? null : m_activity.getName().trim();</span>
	}

	public void setActivityName(String name) {
<span class="nc" id="L285">		m_activity.setName(name.trim());</span>
<span class="nc" id="L286">	}</span>

	public String getActivityDescription() {
<span class="nc" id="L289">		return m_activity.getDescription();</span>
	}

	public void setActivityDescription(String desc) {
<span class="nc" id="L293">		m_activity.setDescription(StringUtil.convertEmptyStringToNull(desc));</span>
<span class="nc" id="L294">	}</span>

	public String getActivityType() {
<span class="nc" id="L297">		ID id = m_activity.getActivityCategoryId();</span>
<span class="nc bnc" id="L298" title="All 2 branches missed.">		if (id != null) {</span>
<span class="nc" id="L299">			return id.toString();</span>
		} else {
<span class="nc" id="L301">			return &quot;&quot;;</span>
		}
	}

	public void setActivityType(String id) {
<span class="nc bnc" id="L306" title="All 2 branches missed.">		if (!StringUtil.isEmpty(id)) {</span>
<span class="nc" id="L307">			m_activity.setActivityCategoryId(new ID(id));</span>
		}
<span class="nc" id="L309">	}</span>

	public String getEarningType() {
<span class="nc" id="L312">		ID id = m_activity.getEarningTypeId();</span>
<span class="nc bnc" id="L313" title="All 2 branches missed.">		if (id != null) {</span>
<span class="nc" id="L314">			return id.toString();</span>
		} else {
<span class="nc" id="L316">			return &quot;&quot;;</span>
		}
	}

	public void setEarningType(String id) {
<span class="nc bnc" id="L321" title="All 4 branches missed.">		if (id != null &amp;&amp; id.length() &gt; 0) {</span>
<span class="nc" id="L322">			m_activity.setEarningTypeId(new ID(id));</span>
		}
<span class="nc" id="L324">	}</span>

	public boolean getPaid() {
<span class="nc" id="L327">		return m_activity.isPaid();</span>
	}

	public void setPaid(boolean isPaid) {
<span class="nc" id="L331">		m_activity.setPaid(isPaid);</span>
<span class="nc" id="L332">	}</span>

	public boolean getQueueHopping() {
<span class="nc" id="L335">		return m_activity.isQueueHopping();</span>
	}

	public void setQueueHopping(boolean isQueueHopping) {
<span class="nc" id="L339">		m_activity.setQueueHopping(isQueueHopping);</span>
<span class="nc" id="L340">	}</span>

	public void setAllowRemote(boolean allowRemote) {
<span class="nc" id="L343">		m_activity.setAllowRemote(allowRemote);</span>
<span class="nc" id="L344">	}</span>

	public boolean getAllowRemote() {
<span class="nc" id="L347">		return m_activity.isAllowRemote();</span>
	}

	public String getColor() {
<span class="nc" id="L351">		String colorStr = ColorUtil.getHtmlColorCode(m_activity.getColor());</span>
<span class="nc bnc" id="L352" title="All 2 branches missed.">		if (ColorUtil.validateColor(colorStr)) {</span>
<span class="nc" id="L353">			return &quot;#&quot; + colorStr;</span>
		} else {
<span class="nc" id="L355">			return ACTIVITY_COLOR_DEFAULT;</span>
		}
	}

	public void setColor(String color) {
<span class="nc" id="L360">		m_activity.setColor(StringUtil.convertEmptyStringToNull(color));</span>
<span class="nc" id="L361">	}</span>

	public String getColorCode() {
<span class="nc" id="L364">		return m_activity.getColorCode();</span>
	}

	public void setColorCode(String colorCode) {
<span class="nc" id="L368">		m_activity.setColorCode(StringUtil.convertEmptyStringToNull(colorCode));</span>
<span class="nc" id="L369">	}</span>

	public boolean getTimeoff() {
<span class="nc" id="L372">		return m_activity.isTimeoff();</span>
	}

	public void setTimeoff(boolean isTimeoff) {
<span class="nc" id="L376">		m_activity.setTimeoff(isTimeoff);</span>
<span class="nc" id="L377">	}</span>

	public boolean getUseDailyTOPool() {
<span class="nc" id="L380">		return activityProperties.isUseDailyTOPool();</span>
	}

	public void setUseDailyTOPool(boolean isUseDailyTOPool) {
<span class="nc" id="L384">		activityProperties.setUseDailyTOPool(isUseDailyTOPool);</span>
<span class="nc" id="L385">	}</span>

	public boolean getUseIntervalTOPool() {
<span class="nc" id="L388">		return activityProperties.isUseIntervalTOPool();</span>
	}

	public void setUseIntervalTOPool(boolean isUseIntervalTOPool) {
<span class="nc" id="L392">		activityProperties.setUseIntervalTOPool(isUseIntervalTOPool);</span>
<span class="nc" id="L393">	}</span>

	public boolean getUseAdvancedVTOOptions() {
<span class="nc" id="L396">		return activityProperties.isUseAdvancedVTOOptions();</span>
	}

	public void setUseAdvancedVTOOptions(boolean isUseAdvancedVTOOptions) {
<span class="nc" id="L400">		activityProperties.setUseAdvancedVTOOptions(isUseAdvancedVTOOptions);</span>
<span class="nc" id="L401">	}</span>

	public int getTimeoffWithFlex() {
<span class="nc" id="L404">		return activityProperties.getTimeoffWithFlex();</span>
	}

	public void setTimeoffWithFlex(int timeoffWithFlex) {
<span class="nc" id="L408">		activityProperties.setTimeoffWithFlex(timeoffWithFlex);</span>
<span class="nc" id="L409">	}</span>

	public void setMedia(String mediaString) {
<span class="nc" id="L412">		ID[] mediaIdArray = StringUtil.parseIDString(mediaString, &quot;,&quot;);</span>
<span class="nc bnc" id="L413" title="All 4 branches missed.">		if (mediaIdArray != null &amp;&amp; mediaIdArray.length &gt; 0) {</span>
<span class="nc" id="L414">			m_mediaIds = Arrays.asList(mediaIdArray);</span>
		} else {
<span class="nc" id="L416">			m_mediaIds = Collections.emptyList();</span>
		}
<span class="nc" id="L418">		setHasMedia();</span>
<span class="nc" id="L419">		setHasProjectMedia();</span>
<span class="nc" id="L420">	}</span>

	public Collection&lt;ID&gt; getMedia() {
<span class="nc" id="L423">		return m_mediaIds;</span>
	}

	private void setHasMedia() {
<span class="nc bnc" id="L427" title="All 4 branches missed.">		m_hasMedia = ((m_mediaIds != null) &amp;&amp; (!m_mediaIds.isEmpty()));</span>
<span class="nc" id="L428">	}</span>

	private void setHasProjectMedia() {
<span class="nc bnc" id="L431" title="All 6 branches missed.">		m_hasProjectMedia = ((m_mediaIds != null) &amp;&amp; (!m_mediaIds.isEmpty()) &amp;&amp; (m_mediaIds.contains(Media.MEDIA_ID_PROJECT)));</span>
<span class="nc" id="L432">	}</span>

	public void setQueues(String queuesString) {
<span class="nc" id="L435">		ID[] queueIdArray = StringUtil.parseIDString(queuesString, &quot;,&quot;);</span>
<span class="nc bnc" id="L436" title="All 4 branches missed.">		if (queueIdArray != null &amp;&amp; queueIdArray.length &gt; 0) {</span>
<span class="nc" id="L437">			m_queueIds = Arrays.asList(queueIdArray);</span>
		} else {
<span class="nc" id="L439">			m_queueIds = Collections.emptyList();</span>
		}
<span class="nc" id="L441">		setHasQueues();</span>
<span class="nc" id="L442">	}</span>

	/**
	 * Return the Queue Hopping queueIDs linked to this activity.
	 *
	 * @return collection of queue IDs
	 */
	public Collection&lt;ID&gt; getQueues() {
<span class="nc" id="L450">		return m_queueIds;</span>
	}

	/**
	 * Determines whether this activity is linked to any Queue Hopping queues.
	 */
	private void setHasQueues() {
<span class="nc bnc" id="L457" title="All 4 branches missed.">		m_hasQueues = ((m_queueIds != null) &amp;&amp; (!m_queueIds.isEmpty()));</span>
<span class="nc" id="L458">	}</span>

	/**
	 * Gets the activity value object
	 *
	 * @return activity value object
	 */
	public Activity getActivity() {
<span class="nc" id="L466">		m_activity.setID(getActivityID());</span>
<span class="nc" id="L467">		return m_activity;</span>
	}

	/**
	 * Gets the activity value object
	 *
	 * @return activity value object
	 */
	public ActivityProperties getActivityProperties() {
<span class="nc" id="L476">		activityProperties.setActivityId(getActivityID());</span>
<span class="nc" id="L477">		return activityProperties;</span>
	}

	/**
	 * Return URL for HTML Form Action
	 */
	public String getFormAction() {
<span class="nc" id="L484">		return &quot;activity_form&quot;;</span>
	}


	/**
	 * Override method to generate necessary JS code needed for the Color Picker popup window from
	 * a popup button
	 */
	public String getJavaScriptInitCode() {
<span class="nc" id="L493">		StringBuffer jsInit = new StringBuffer(1256);</span>
<span class="nc" id="L494">		jsInit.append(super.getJavaScriptInitCode());</span>
<span class="nc" id="L495">		jsInit.append(&quot;\n// initialize the Color Picker popup button object\n&quot;)</span>
<span class="nc" id="L496">			.append(&quot;window.popupbutton0 = new PopupButton(\&quot;popupbutton0\&quot;);\n&quot;)</span>
<span class="nc" id="L497">			.append(&quot;window.popupbutton0.bind();\n&quot;)</span>
<span class="nc" id="L498">			.append(&quot;//add  popupbutton to the mediator's collection\n&quot;)</span>
<span class="nc" id="L499">			.append(&quot;top.workpaneMediator.addChild( popupbutton0 );\n&quot;)</span>
<span class="nc" id="L500">			.append(&quot;popupbutton0.setParent(top.workpaneMediator);\n&quot;)</span>
<span class="nc" id="L501">			.append(&quot; getRemoteInitJS();\n&quot;);</span>
<span class="nc" id="L502">		return jsInit.toString();</span>
	}

	public String getCustomJavaScript() {
<span class="nc" id="L506">		StringBuffer js = new StringBuffer();</span>
<span class="nc" id="L507">		js.append(super.getCustomJavaScript());</span>
<span class="nc" id="L508">		js.append(getRemoteInitJS());</span>
//		js.append(getQueueNameOnChange());
<span class="nc" id="L510">		return js.toString();</span>
	}

/*	public String getQueueNameOnChange() {
		StringBuffer js = new StringBuffer();
		js.append(&quot;jQuery('#&quot;).append(QUEUE_NAMES_DISPLAY_FN).append(&quot;').change(function() { \n&quot;);
		js.append(JSUtil.RESET_PAGEDIRTY + JSUtil.REFRESH_PAGE + &quot; \n&quot;);
		js.append(&quot;	}) \n&quot;);

		return js.toString();
	} */

	private String getRemoteInitJS() {
<span class="nc" id="L523">		StringBuffer js = new StringBuffer();</span>
<span class="nc" id="L524">		js.append(&quot;function getRemoteInitJS() {\n&quot;);</span>
<span class="nc" id="L525">		js.append(&quot;var queueName = document.getElementById('&quot;).append(QUEUE_NAMES_DISPLAY_FN).append(&quot;'); \n&quot;);</span>
<span class="nc" id="L526">		js.append(&quot;var mediaName = document.getElementById('&quot;).append(MEDIA_NAMES_DISPLAY_FN).append(&quot;'); \n&quot;);</span>
<span class="nc" id="L527">		js.append(&quot;var canRemote = document.getElementById('&quot;).append(ActivityFields.CAN_WORK_REMOTELY_FN).append(&quot;'); \n&quot;);</span>
		//js.append(&quot;var category = document.getElementById('&quot;).append(ActivityFields.ACTIVITY_CATEGORY_FN).append(&quot;'); \n&quot;);
<span class="nc" id="L529">		js.append(&quot;if(queueName == null || queueName === undefined || mediaName == null || mediaName === undefined || canRemote == null || canRemote === undefined) return; \n&quot;);</span>
		//js.append(&quot;var index = category.selectedIndex; \n&quot;);
		//js.append(&quot;if(index &amp;&amp; document.getElementById('&quot;).append(ActivityFields.ACTIVITY_CATEGORY_FN).append(&quot;').options[index].value == '-5003'&quot;);
<span class="nc" id="L532">		js.append(&quot;if(document.getElementById('&quot;).append(ActivityFields.USED_IN_SHIFT_EVENT_FN).append(&quot;').checked&quot;);</span>
<span class="nc" id="L533">		js.append(&quot;&amp;&amp; (jQuery.trim(queueName.value) != \&quot;\&quot; || jQuery.trim(mediaName.value) != \&quot;\&quot; )){ \n&quot;);</span>
<span class="nc" id="L534">		js.append(&quot;document.getElementById('&quot;).append(ActivityFields.CAN_WORK_REMOTELY_FN).append(&quot;').disabled = false; \n&quot;);</span>
<span class="nc" id="L535">		js.append(&quot;}else {\n&quot;);</span>
<span class="nc" id="L536">		js.append(&quot;document.getElementById('&quot;).append(ActivityFields.CAN_WORK_REMOTELY_FN).append(&quot;').disabled = true; \n&quot;);</span>
<span class="nc" id="L537">		js.append(&quot;}\n&quot;);</span>
<span class="nc" id="L538">		js.append(&quot;}\n&quot;);</span>

<span class="nc" id="L540">		return js.toString();</span>
	}


	/**
	 * Override method to return Required HTML for this component
	 * Use this to add a specific hidden field
	 */
	public String getRequiredHTML() {
<span class="nc" id="L549">		StringBuffer reqHtml = new StringBuffer(1256);</span>
<span class="nc" id="L550">		reqHtml.append(super.getRequiredHTML());</span>
<span class="nc" id="L551">		reqHtml.append(HtmlUtil.makeHiddenInput(ActivityFields.OWNER_ORG_FN, getOrganizationId()));</span>
<span class="nc" id="L552">		m_hiddenFields.append(&quot;\n&quot;);</span>
<span class="nc bnc" id="L553" title="All 2 branches missed.">		if (m_hiddenFields.length() &gt; 0) {</span>
<span class="nc" id="L554">			reqHtml.append(m_hiddenFields);</span>
		}
<span class="nc" id="L556">		return reqHtml.toString();</span>
	}


	/**
	 * Returns a (single) entity type.
	 */
	protected String getTitleEntityType() {
<span class="nc" id="L564">		return this.getFormTitle();</span>
	}

	/**
	 * Returns an entity name. Used for title.
	 */
	protected String getEntityName() {
<span class="nc" id="L571">		return this.getActivityName();</span>
	}

	/**
	 * Checks to see if there is a Phone media is linked to this activity.
	 *
	 * @return
	 */
	private boolean hasPhoneMedia(Collection&lt;ID&gt; mediaIds) {
<span class="nc bnc" id="L580" title="All 4 branches missed.">		return mediaIds != null &amp;&amp; mediaIds.contains(Media.MEDIA_ID_PHONE);</span>
	}

	private boolean hasOperationsMedia(Collection&lt;ID&gt; mediaIds) {
<span class="nc bnc" id="L584" title="All 4 branches missed.">		return mediaIds != null &amp;&amp; mediaIds.contains(Media.MEDIA_ID_OPERATIONS);</span>
	}

	protected Collection&lt;ID&gt; getActivityMedia(RequestContext context, ID activityID,
											  boolean hasMultiMediaLicense) throws Exception {
<span class="nc" id="L589">		Collection&lt;ID&gt; mediaIds = ActivityModelHandler.getActivityMedia(context, activityID);</span>
<span class="nc bnc" id="L590" title="All 2 branches missed.">		if (!hasMultiMediaLicense) {</span>
			//Since they don't have the Multi-Media license, we will only keep the Phone media
<span class="nc" id="L592">			ArrayList&lt;ID&gt; reducedMediaIds = new ArrayList&lt;ID&gt;(1);</span>
<span class="nc bnc" id="L593" title="All 2 branches missed.">			if (hasPhoneMedia(mediaIds))</span>
<span class="nc" id="L594">				reducedMediaIds.add(Media.MEDIA_ID_PHONE);</span>

<span class="nc bnc" id="L596" title="All 4 branches missed.">			if (hasOperationsMedia(mediaIds) &amp;&amp; MediaTypesSetupPageModel.hasAnyBackOfficeLicence()) {</span>
<span class="nc" id="L597">				reducedMediaIds.add(Media.MEDIA_ID_OPERATIONS);</span>
			}
<span class="nc" id="L599">			return reducedMediaIds;</span>
		}
<span class="nc" id="L601">		return mediaIds;</span>
	}

	/**
	 * Create the form model - fetch the data from backend
	 */
	protected void createFormModel() {
<span class="nc" id="L608">		checkForLicenses();</span>
		try {
			//When PageAction.REFRESH, and page has values inputed from UI, keep them, don't reload activity or create new
			//Note that after COPY an activity, page refreshes, that case m_activity is empty, needs to reload.
<span class="nc bnc" id="L612" title="All 2 branches missed.">			if (!(PageAction.REFRESH.equals(m_context.getParameter(PageAction.PAGE_ACTION))</span>
<span class="nc bnc" id="L613" title="All 2 branches missed.">				&amp;&amp; m_activity.getActivityCategoryId() != null)) {</span>
<span class="nc bnc" id="L614" title="All 2 branches missed.">				if (!this.isNew()) {</span>
<span class="nc" id="L615">					m_activity = ActivityModelHandler.getActivityByID(m_context, getCurrentID());</span>
					//if (m_hasMultiMediaLicense) //Fixed QC#81240: Activity Edit page in web suite doesn't have a Media selector when Multi-Media license not present.
					{
<span class="nc" id="L618">						m_mediaIds = getActivityMedia(m_context, m_activity.getID(), m_hasMultiMediaLicense);</span>
					}
<span class="nc" id="L620">					setHasMedia();</span>
<span class="nc" id="L621">					setHasProjectMedia();</span>

					//Load the Queue Hopping (or Project) Queue IDs that are already linked to this activity (if any).
<span class="nc bnc" id="L624" title="All 6 branches missed.">					if ((m_activity.isQueueHopping() &amp;&amp; m_hasQueueHoppingLicense) || hasProjectMedia()) {</span>
<span class="nc" id="L625">						m_queueIds = ActivityModelHandler.getActivityQueues(m_context, m_activity.getID());</span>
					}
<span class="nc" id="L627">					setHasQueues();</span>

					// Get Activity Properties
<span class="nc" id="L630">					activityProperties = ActivityModelHandler.getActivityProperties(m_context, m_activity.getID());</span>
				} else {
					// Create new mode - set the org ID
<span class="nc bnc" id="L633" title="All 2 branches missed.">					if (hasSelectedID()) {</span>
<span class="nc" id="L634">						m_activity.setOrganizationId(getSelectedIDObject());</span>
					}
<span class="nc" id="L636">					setDefaultValues();</span>
				}
			}

			// load the activity types for the drop down
			try {
<span class="nc bnc" id="L642" title="All 2 branches missed.">				if (hasSelectedID()) {</span>
<span class="nc" id="L643">					boolean filterSystemDefined = true;</span>
<span class="nc bnc" id="L644" title="All 2 branches missed.">					if (m_activity.getOrganizationId().equals(Organization.ROOT_ORG_ID_OBJ)) {</span>
<span class="nc" id="L645">						filterSystemDefined = false;</span>
					}
<span class="nc" id="L647">					m_activityTypeStringPair = ActivityTypeModelHandler.getActivityTypesStringsPair(m_context,</span>
<span class="nc" id="L648">						getSelectedIDObject(), filterSystemDefined);</span>
<span class="nc" id="L649">				} else {</span>
<span class="nc" id="L650">					m_activityTypeStringPair = Collections.emptyList();</span>
				}

<span class="nc" id="L653">				m_selectedActivityType = getActivityType();</span>
<span class="nc bnc" id="L654" title="All 2 branches missed.">				if (StringUtil.isEmpty(m_selectedActivityType)) {</span>
<span class="nc bnc" id="L655" title="All 2 branches missed.">					if (!m_activityTypeStringPair.isEmpty()) {</span>
<span class="nc" id="L656">						Iterator&lt;StringsPair&gt; it = m_activityTypeStringPair.iterator();</span>
<span class="nc" id="L657">						StringsPair firstActivityTypeStringsPair = it.next();</span>
<span class="nc" id="L658">						m_selectedActivityType = firstActivityTypeStringsPair.getKey();</span>
<span class="nc" id="L659">					} else {</span>
<span class="nc" id="L660">						m_selectedActivityType = &quot;&quot;;</span>
<span class="nc" id="L661">						m_initFailure = true;</span>
					}
				}
<span class="nc" id="L664">			} catch (Exception e) {</span>
<span class="nc" id="L665">				log.l7dError(BbmWebLogBundleKey.ACTIVITY_ACTIVITY_TYPES_RETRIEVE_FAILURE, e);</span>
<span class="nc" id="L666">				this.addPageMessage(Message.ERROR_TYPE,</span>
					BbmWebBundleKey.ACTIVITY_ACTIVITY_TYPES_RETRIEVE_FAILURE,
					BbmWebBundleKey.BUNDLE_NAME);
<span class="nc" id="L669">				m_activityTypeStringPair = null;</span>
<span class="nc" id="L670">				m_initFailure = true;</span>
<span class="nc" id="L671">			}</span>

<span class="nc bnc" id="L673" title="All 2 branches missed.">			if (m_hasPayrollLicense) {</span>
				// load the earning types for the drop down
				try {
<span class="nc" id="L676">					m_earningTypeStringPair = EarningTypeModelHandler.getEarningTypesStringsPair(</span>
						EarningTypeManager.SORT_EARNINGTYPE_BY_NAME, true);

<span class="nc bnc" id="L679" title="All 2 branches missed.">					if (!this.isNew()) {</span>
<span class="nc" id="L680">						m_selectedEarningType = getEarningType();</span>
					} else {
<span class="nc" id="L682">						m_selectedEarningType = EARNING_TYPE_DEFAULT.toString();</span>
					}

<span class="nc" id="L685">				} catch (Exception e) {</span>
<span class="nc" id="L686">					log.l7dError(BbmWebLogBundleKey.ACTIVITY_EARNING_TYPES_RETRIEVE_FAILURE, e);</span>
<span class="nc" id="L687">					this.addPageMessage(Message.ERROR_TYPE,</span>
						BbmWebBundleKey.ACTIVITY_EARNING_TYPES_RETRIEVE_FAILURE,
						BbmWebBundleKey.BUNDLE_NAME);
<span class="nc" id="L690">					m_earningTypeStringPair = null;</span>
<span class="nc" id="L691">					m_initFailure = true;</span>
<span class="nc" id="L692">				}</span>
			}

<span class="nc" id="L695">		} catch (Exception ex) {</span>
<span class="nc" id="L696">			handleUnableToLoadDataError(log, ex);</span>
<span class="nc" id="L697">			m_initFailure = true;</span>
<span class="nc" id="L698">		}</span>

<span class="nc" id="L700">	}</span>


	/**
	 * Initialize Form Display
	 */
	protected void initForm() {
		// Initialize Form PC
<span class="nc" id="L708">		m_formPC = new FormTwoColumnPC(m_context);</span>
<span class="nc" id="L709">		addChildComponent(m_formPC);</span>
<span class="nc" id="L710">		m_formPC.setTitle(getFormTitle());</span>

		try {
			// Organization
<span class="nc" id="L714">			m_formPC.addRow(getOrganizationLabel(), getActivityOrganizationName());</span>

			// Name
<span class="nc bnc" id="L717" title="All 4 branches missed.">			switch (m_displayMap[ActivityFields.NAME]) {</span>
				case ActivityFields.EDITABLE:
<span class="nc" id="L719">					m_formPC.addRow(getNameLabel(),</span>
<span class="nc" id="L720">						HtmlUtil.makeTextInput(ActivityFields.NAME_FN, 50, DBInfo.ACTIVITY_NAME_MAXLENGTH, getActivityName(), JSUtil.ON_CHANGE));</span>
<span class="nc" id="L721">					addValidator(new IsEnteredFieldValidator(this, ActivityFields.NAME_FN,</span>
						UIFWebBundleKey.LABEL_NAME, UIFWebBundleKey.BUNDLE_NAME));
<span class="nc" id="L723">					break;</span>
				case ActivityFields.DISPLAYABLE:
<span class="nc" id="L725">					m_formPC.addRow(getNameLabel(), getActivityName());</span>
				case ActivityFields.NON_DISPLAYABLE:
<span class="nc" id="L727">					m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.NAME_FN, getActivityName()));</span>
<span class="nc" id="L728">					m_hiddenFields.append(&quot;\n&quot;);</span>
					break;
			}


			// Description
<span class="nc bnc" id="L734" title="All 4 branches missed.">			switch (m_displayMap[ActivityFields.DESCRIPTION]) {</span>
				case ActivityFields.EDITABLE:
<span class="nc" id="L736">					m_formPC.addRow(getDescriptionLabel(),</span>
<span class="nc" id="L737">						HtmlUtil.makeTextInput(ActivityFields.DESCRIPTION_FN, 75, 75,</span>
<span class="nc" id="L738">							getActivityDescription(), JSUtil.ON_CHANGE));</span>
<span class="nc" id="L739">					break;</span>
				case ActivityFields.DISPLAYABLE:
<span class="nc" id="L741">					m_formPC.addRow(getDescriptionLabel(), getActivityDescription());</span>
				case ActivityFields.NON_DISPLAYABLE:
<span class="nc" id="L743">					m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.DESCRIPTION_FN, getActivityDescription()));</span>
<span class="nc" id="L744">					m_hiddenFields.append(&quot;\n&quot;);</span>
					break;
			}

			// Activity Type
<span class="nc bnc" id="L749" title="All 4 branches missed.">			switch (m_displayMap[ActivityFields.ACTIVITY_CATEGORY]) {</span>
				case ActivityFields.EDITABLE:
<span class="nc" id="L751">					m_formPC.addRow(getActivityTypeLabel(), getActivityTypeDropDown(JSUtil.RESET_PAGEDIRTY + JSUtil.REFRESH_PAGE));</span>
<span class="nc" id="L752">					break;</span>
				case ActivityFields.DISPLAYABLE:
<span class="nc" id="L754">					m_formPC.addRow(getActivityTypeLabel(), getActivityTypeName());</span>
				case ActivityFields.NON_DISPLAYABLE:
<span class="nc" id="L756">					m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.ACTIVITY_CATEGORY_FN, getActivityType()));</span>
<span class="nc" id="L757">					m_hiddenFields.append(&quot;\n&quot;);</span>
					break;
			}

			// Paid
<span class="nc bnc" id="L762" title="All 4 branches missed.">			switch (m_displayMap[ActivityFields.PAID]) {</span>
				case ActivityFields.EDITABLE:
<span class="nc" id="L764">					m_formPC.addRow(getPaidLabel(),</span>
<span class="nc" id="L765">						HtmlChoiceInput.makeChkBoxInput(ActivityFields.PAID_FN, &quot;true&quot;, &quot;&quot;, getPaid(), false, ACTIVITY_FIELD_ON_CHANGE));</span>
<span class="nc" id="L766">					break;</span>
				case ActivityFields.DISPLAYABLE:
<span class="nc" id="L768">					m_formPC.addRow(getPaidLabel(), m_localizer.formatYesNo(getPaid()));</span>
				case ActivityFields.NON_DISPLAYABLE:
<span class="nc bnc" id="L770" title="All 2 branches missed.">					m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.PAID_FN, (getPaid() ? &quot;true&quot; : &quot;&quot;)));</span>
<span class="nc" id="L771">					m_hiddenFields.append(&quot;\n&quot;);</span>
					break;
			}

<span class="nc bnc" id="L775" title="All 2 branches missed.">			if (m_hasPayrollLicense) {</span>
				// Earning Type
<span class="nc bnc" id="L777" title="All 4 branches missed.">				switch (m_displayMap[ActivityFields.EARNING_TYPE]) {</span>
					case ActivityFields.EDITABLE:
<span class="nc" id="L779">						m_formPC.addRow(getEarningTypeLabel(), getEarningTypeDropDown(JSUtil.ON_CHANGE));</span>
<span class="nc" id="L780">						break;</span>
					case ActivityFields.DISPLAYABLE:
<span class="nc" id="L782">						m_formPC.addRow(getEarningTypeLabel(), getEarningTypeName());</span>
					case ActivityFields.NON_DISPLAYABLE:
<span class="nc" id="L784">						m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.EARNING_TYPE_FN, getEarningType()));</span>
<span class="nc" id="L785">						m_hiddenFields.append(&quot;\n&quot;);</span>
						break;
				}
			}

			// Color
<span class="nc bnc" id="L791" title="All 4 branches missed.">			switch (m_displayMap[ActivityFields.COLOR]) {</span>
				case ActivityFields.EDITABLE:
<span class="nc" id="L793">					m_formPC.addRow(getColorLabel(), getColorDispaly(true));</span>
					// a hidden field for color is always required
<span class="nc" id="L795">					m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.COLOR_FN, getColor()));</span>
<span class="nc" id="L796">					break;</span>
				case ActivityFields.DISPLAYABLE:
<span class="nc" id="L798">					m_formPC.addRow(getColorLabel(), getColorDispaly(false));</span>
				case ActivityFields.NON_DISPLAYABLE:
<span class="nc" id="L800">					m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.COLOR_FN, getColor()));</span>
					break;
			}

			// Color code
<span class="nc bnc" id="L805" title="All 4 branches missed.">			switch (m_displayMap[ActivityFields.COLOR_CODE]) {</span>
				case ActivityFields.EDITABLE:
<span class="nc" id="L807">					m_formPC.addRow(getColorCodeLabel(),</span>
<span class="nc" id="L808">						HtmlUtil.makeTextInput(ActivityFields.COLOR_CODE_FN, 4, 4, getColorCode(), JSUtil.ON_CHANGE));</span>
<span class="nc" id="L809">					break;</span>
				case ActivityFields.DISPLAYABLE:
<span class="nc" id="L811">					m_formPC.addRow(getColorCodeLabel(), getColorCode());</span>
				case ActivityFields.NON_DISPLAYABLE:
<span class="nc" id="L813">					m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.COLOR_CODE_FN, getColorCode()));</span>
<span class="nc" id="L814">					m_hiddenFields.append(&quot;\n&quot;);</span>
					break;
			}

			// Timeoff
<span class="nc bnc" id="L819" title="All 4 branches missed.">			switch (m_displayMap[ActivityFields.TIMEOFF]) {</span>
				case ActivityFields.EDITABLE:
<span class="nc" id="L821">					m_formPC.addRow(getTimeoffLabel(),</span>
<span class="nc" id="L822">						HtmlChoiceInput.makeChkBoxInput(ActivityFields.TIMEOFF_FN, &quot;true&quot;, &quot;&quot;,</span>
<span class="nc" id="L823">							getTimeoff(), isFieldDisabled(ActivityFields.TIMEOFF), ACTIVITY_FIELD_ON_CHANGE));</span>
<span class="nc" id="L824">					break;</span>
				case ActivityFields.DISPLAYABLE:
<span class="nc" id="L826">					m_formPC.addRow(getTimeoffLabel(), m_localizer.formatYesNo(getTimeoff()));</span>
				case ActivityFields.NON_DISPLAYABLE:
<span class="nc bnc" id="L828" title="All 2 branches missed.">					m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.TIMEOFF_FN, (getTimeoff() ? &quot;true&quot; : &quot;&quot;)));</span>
<span class="nc" id="L829">					m_hiddenFields.append(&quot;\n&quot;);</span>
					break;
			}

			//if (m_hasMultiMediaLicense) //Fixed QC#81240: Activity Edit page in web suite doesn't have a Media selector when Multi-Media license not present.
			{
				// Media selector row
<span class="nc bnc" id="L836" title="All 4 branches missed.">				switch (m_displayMap[ActivityFields.MEDIA]) {</span>
					case ActivityFields.EDITABLE:
<span class="nc" id="L838">						m_formPC.addRow(getMediaLabel(), getMediaDisplay(true));</span>
						// a hidden field for media is always required
<span class="nc" id="L840">						m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.MEDIA_FN, getMediaIdsString()));</span>
<span class="nc" id="L841">						break;</span>
					case ActivityFields.DISPLAYABLE:
<span class="nc" id="L843">						m_formPC.addRow(getMediaLabel(), getMediaDisplay(false));</span>
					case ActivityFields.NON_DISPLAYABLE:
<span class="nc" id="L845">						m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.MEDIA_FN, getMediaIdsString()));</span>
						break;
				}
			}

			//Queue Hopping checkbox
<span class="nc bnc" id="L851" title="All 2 branches missed.">			if (m_hasQueueHoppingLicense) {</span>
<span class="nc bnc" id="L852" title="All 4 branches missed.">				switch (m_displayMap[ActivityFields.QUEUE_HOPPING]) {</span>
					case ActivityFields.EDITABLE:
<span class="nc" id="L854">						m_formPC.addRow(getQueueHoppingLabel(),</span>
<span class="nc" id="L855">							HtmlChoiceInput.makeChkBoxInput(ActivityFields.QUEUE_HOPPING_FN, &quot;true&quot;, &quot;&quot;,</span>
<span class="nc" id="L856">								getQueueHopping(), isFieldDisabled(ActivityFields.QUEUE_HOPPING), ACTIVITY_FIELD_ON_CHANGE + &quot;getRemoteInitJS();\n&quot;));</span>
<span class="nc" id="L857">						break;</span>

					case ActivityFields.DISPLAYABLE:
<span class="nc" id="L860">						m_formPC.addRow(getQueueHoppingLabel(), m_localizer.formatYesNo(getPaid()));</span>

					case ActivityFields.NON_DISPLAYABLE:
<span class="nc bnc" id="L863" title="All 2 branches missed.">						m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.QUEUE_HOPPING_FN, (getQueueHopping() ? &quot;true&quot; : &quot;&quot;)));</span>
<span class="nc" id="L864">						m_hiddenFields.append(&quot;\n&quot;);</span>
						break;
				}
			}

			//Queues selector row
<span class="nc bnc" id="L870" title="All 4 branches missed.">			if (m_hasQueueHoppingLicense || m_hasMultiMediaLicense) {</span>
<span class="nc bnc" id="L871" title="All 4 branches missed.">				switch (m_displayMap[ActivityFields.QUEUES]) {</span>
					case ActivityFields.EDITABLE:
<span class="nc" id="L873">						m_formPC.addRow(getQueuesLabel(), getQueuesDisplay(true));</span>
						// a hidden field for queues is always required
<span class="nc" id="L875">						m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.QUEUES_FN, getQueueIdsString()));</span>
<span class="nc" id="L876">						break;</span>

					case ActivityFields.DISPLAYABLE:
<span class="nc" id="L879">						m_formPC.addRow(getQueuesLabel(), getQueuesDisplay(false));</span>

					case ActivityFields.NON_DISPLAYABLE:
<span class="nc" id="L882">						m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.QUEUES_FN, getQueueIdsString()));</span>
<span class="nc" id="L883">						break;</span>
				}
<span class="nc bnc" id="L885" title="All 4 branches missed.">			} else if (m_displayMap[ActivityFields.QUEUES] == ActivityFields.EDITABLE ||</span>
				m_displayMap[ActivityFields.QUEUES] == ActivityFields.NON_DISPLAYABLE) {
<span class="nc" id="L887">				m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.QUEUES_FN, getQueueIdsString()));</span>
			}


/*			if(!ActivityFields.isSystemActivity(getActivityID()))
				m_formPC.addRow(getCanRemoteLabel(),
						HtmlChoiceInput.makeChkBoxInput(ActivityFields.CAN_WORK_REMOTELY_FN, &quot;true&quot;, &quot;&quot;, getAllowRemote(), false, &quot;&quot;));
			else
				m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.CAN_WORK_REMOTELY_FN, &quot;&quot;) ); */

			// init FS &amp; RM usage
<span class="nc bnc" id="L898" title="All 2 branches missed.">			if (isAuthorizedToConfigureFSAttributes(getSelectedIDObject())) {</span>
<span class="nc" id="L899">				m_fsUsagePC.initForm(m_activity, activityProperties, true, m_hiddenFields, m_displayMap, m_hasMedia, m_hasProjectMedia);</span>
<span class="nc" id="L900">				m_rmUsagePC.initForm(m_activity, activityProperties, true, m_hiddenFields, m_displayMap, m_hasMedia, m_hasProjectMedia);</span>
			} else {
<span class="nc" id="L902">				m_fsUsagePC.initForm(m_activity, activityProperties, true, m_hiddenFields, ActivityFields.nonDisplayableDisplayMap, m_hasMedia, m_hasProjectMedia);</span>
<span class="nc" id="L903">				m_rmUsagePC.initForm(m_activity, activityProperties, true, m_hiddenFields, ActivityFields.nonDisplayableDisplayMap, m_hasMedia, m_hasProjectMedia);</span>
			}

			// init AM usage
<span class="nc bnc" id="L907" title="All 2 branches missed.">			if (isAuthorizedToConfigureAMAttributes(getSelectedIDObject())) {</span>
<span class="nc" id="L908">				m_amUsagePC.initForm(m_activity, activityProperties, true, m_hiddenFields, m_displayMap, m_hasMedia, m_hasProjectMedia);</span>
			} else {
<span class="nc" id="L910">				m_amUsagePC.initForm(m_activity, activityProperties, true, m_hiddenFields, ActivityFields.nonDisplayableDisplayMap, m_hasMedia, m_hasProjectMedia);</span>
			}

			//init advisor usage
<span class="nc bnc" id="L914" title="All 2 branches missed.">			if (m_hasAdvisorLicense) {</span>
<span class="nc" id="L915">				m_advisorUsagePC.initForm(m_activity, activityProperties, true, m_hiddenFields, m_displayMap, m_hasMedia, m_hasProjectMedia);</span>
			} else {
<span class="nc" id="L917">				m_advisorUsagePC.initForm(m_activity, activityProperties, true, m_hiddenFields, ActivityFields.nonDisplayableDisplayMap, m_hasMedia, m_hasProjectMedia);</span>
			}

<span class="nc" id="L920">		} catch (Exception ex) {</span>
<span class="nc" id="L921">			handleUnableToLoadDataError(log, ex);</span>
<span class="nc" id="L922">			m_initFailure = true;</span>
<span class="nc" id="L923">		}</span>
<span class="nc" id="L924">	}</span>

	/**
	 * Return true if selected Org is valid; Override parent method to allow editing
	 * of activities define in the root (system)level
	 */
	protected boolean isValidSelectedOrg() {
<span class="nc" id="L931">		return hasSelectedID();</span>
	}

	protected void initFieldValidators() {
		// validators were added in initForm() since fields are not necessary rendered
<span class="nc" id="L936">	}</span>


	private String getNameLabel() {
<span class="nc" id="L940">		return i18n(m_common_bundle, UIFWebBundleKey.LABEL_NAME);</span>
	}

	private String getDescriptionLabel() {
<span class="nc" id="L944">		return i18n(m_common_bundle, UIFWebBundleKey.LABEL_DESCRIPTION);</span>
	}

	private String getActivityTypeLabel() {
<span class="nc" id="L948">		return i18n(m_bbmBundle, BbmWebBundleKey.ACTIVITY_LABEL_ACTIVITY_TYPE);</span>
	}

	/**
	 * Return the DropDown display of activity types
	 */
	private String getActivityTypeDropDown(String onChangeJS) {
<span class="nc bnc" id="L955" title="All 2 branches missed.">		if (m_activityTypeStringPair != null) {</span>
<span class="nc" id="L956">			return HtmlUtil.makeSelectInput(ActivityFields.ACTIVITY_CATEGORY_FN,</span>
				m_selectedActivityType, onChangeJS,
				m_activityTypeStringPair);
		} else {
<span class="nc" id="L960">			return &quot;&amp;nbsp;&quot;;</span>
		}
	}

	private String getActivityTypeName() {
		// Scan the m_activityTypeStringPair collection for the name of the activity type
<span class="nc bnc" id="L966" title="All 6 branches missed.">		if (m_activityTypeStringPair == null || m_activityTypeStringPair.isEmpty() || StringUtil.isEmpty(getActivityType())) {</span>
<span class="nc" id="L967">			return HtmlUtil.NBSP;</span>
		}

<span class="nc" id="L970">		String key = getActivityType();</span>
<span class="nc" id="L971">		StringsPair sp = null;</span>
<span class="nc bnc" id="L972" title="All 2 branches missed.">		for (Iterator&lt;StringsPair&gt; it = m_activityTypeStringPair.iterator(); it.hasNext(); ) {</span>
<span class="nc" id="L973">			sp = it.next();</span>
<span class="nc bnc" id="L974" title="All 2 branches missed.">			if (sp.getKey().equals(key)) {</span>
<span class="nc" id="L975">				return sp.getValue();</span>
			}
		}
<span class="nc" id="L978">		return HtmlUtil.NBSP;</span>
	}

	private String getEarningTypeName() {
		// Scan the m_activityTypeStringPair collection for the name of the activity type
<span class="nc bnc" id="L983" title="All 6 branches missed.">		if (m_earningTypeStringPair == null || m_earningTypeStringPair.isEmpty() || StringUtil.isEmpty(getEarningType())) {</span>
<span class="nc" id="L984">			return HtmlUtil.NBSP;</span>
		}
<span class="nc" id="L986">		StringsPair sp = null;</span>
<span class="nc" id="L987">		String key = getEarningType();</span>
<span class="nc bnc" id="L988" title="All 2 branches missed.">		for (Iterator&lt;StringsPair&gt; it = m_earningTypeStringPair.iterator(); it.hasNext(); ) {</span>
<span class="nc" id="L989">			sp = it.next();</span>
<span class="nc bnc" id="L990" title="All 2 branches missed.">			if (sp.getKey().equals(key)) {</span>
<span class="nc" id="L991">				return sp.getValue();</span>
			}
		}
<span class="nc" id="L994">		return HtmlUtil.NBSP;</span>
	}


	private String getEarningTypeLabel() {
<span class="nc" id="L999">		return i18n(m_bbmBundle, BbmWebBundleKey.ACTIVITY_LABEL_EARNING_TYPE);</span>
	}

	/**
	 * Return the DropDown display of activity types
	 */
	private String getEarningTypeDropDown(String onChangeJS) {
<span class="nc bnc" id="L1006" title="All 2 branches missed.">		if (m_earningTypeStringPair != null) {</span>
<span class="nc" id="L1007">			return HtmlUtil.makeSelectInput(ActivityFields.EARNING_TYPE_FN,</span>
				m_selectedEarningType, onChangeJS,
				m_earningTypeStringPair);
		} else {
<span class="nc" id="L1011">			return &quot;&amp;nbsp;&quot;;</span>
		}
	}

	private String getPaidLabel() {
<span class="nc" id="L1016">		return i18n(m_bbmBundle, BbmWebBundleKey.ACTIVITY_LABEL_IS_PAID);</span>
	}

	private String getTimeoffLabel() {
<span class="nc" id="L1020">		return i18n(m_bbmBundle, BbmWebBundleKey.ACTIVITY_LABEL_TIMEOFF);</span>
	}

	private String getMediaLabel() {
<span class="nc" id="L1024">		return i18n(m_bbmBundle, BbmWebBundleKey.ACTIVITY_LABEL_MEDIA);</span>
	}

	//TBD: Verticalize string
	private String getQueuesLabel() {
<span class="nc" id="L1029">		return i18n(m_bbmBundle, BbmWebBundleKey.ACTIVITY_LABEL_QUEUES);</span>
	}

	//TBD: Verticalize string
	private String getQueueHoppingLabel() {
<span class="nc" id="L1034">		return i18n(m_bbmBundle, BbmWebBundleKey.ACTIVITY_LABEL_IS_QUEUE_HOPPING);</span>
	}

	private String getColorDispaly(boolean editable) {
<span class="nc" id="L1038">		StringBuffer htmlColor = new StringBuffer(256);</span>

<span class="nc" id="L1040">		htmlColor.append(&quot;\n&lt;input name=\&quot;&quot;).append(ActivityFields.COLOR_FN).append(&quot;Show\&quot;&quot;)</span>
<span class="nc" id="L1041">			.append(&quot; id=\&quot;&quot;).append(ActivityFields.COLOR_FN).append(&quot;Show\&quot;&quot;)</span>
<span class="nc" id="L1042">			.append(&quot; type=\&quot;text\&quot; class=\&quot;colorshow\&quot; readonly &quot;)</span>
<span class="nc" id="L1043">			.append(&quot;style=\&quot;background-color: &quot;).append(getColor())</span>
<span class="nc" id="L1044">			.append(&quot;; vertical-align:bottom\&quot; &quot;)</span>
<span class="nc" id="L1045">			.append(&quot;size=\&quot;1\&quot; maxlength=\&quot;1\&quot; value=\&quot; \&quot;&gt;&quot;);</span>

<span class="nc bnc" id="L1047" title="All 2 branches missed.">		if (editable) {</span>
<span class="nc" id="L1048">			htmlColor.append(&quot;\n&lt;img onClick=\&quot;popupbutton0.onSelect('&quot;)</span>
<span class="nc" id="L1049">				.append(ACTIVITY_COLOR_PICKER_NAME).append(&quot;', this);\&quot;&quot;)</span>
<span class="nc" id="L1050">				.append(&quot; width=\&quot;&quot;).append(ImageFileID.COLOR_PICKER_WIDTH)</span>
<span class="nc" id="L1051">				.append(&quot;\&quot; height=\&quot;&quot;).append(ImageFileID.COLOR_PICKER_HEIGHT)</span>
<span class="nc" id="L1052">				.append(&quot;\&quot; src=\&quot;&quot;).append(ImageFileID.COLOR_PICKER)</span>
				//.append(&quot;\&quot; alt=\&quot;&quot;).append(m_common_bundle.getString(UIFWebBundleKey.COLOR_PICKER))
<span class="nc" id="L1054">				.append(&quot;\&quot; alt=\&quot;&quot;).append(m_localizer.i18n(m_common_bundle, UIFWebBundleKey.COLOR_PICKER))</span>
<span class="nc" id="L1055">				.append(&quot;\&quot; align=\&quot;absmiddle\&quot;&gt;&quot;);</span>
		}
<span class="nc" id="L1057">		return htmlColor.toString();</span>
	}

	private String getMediaDisplay(boolean editable) throws RemoteException, BbmException {
<span class="nc" id="L1061">		StringBuffer sb = new StringBuffer(512);</span>
<span class="nc" id="L1062">		sb.append(makeTextReadOnlyInput(MEDIA_NAMES_DISPLAY_FN, 45, getMediaNamesString()));</span>
<span class="nc bnc" id="L1063" title="All 2 branches missed.">		if (editable) {</span>
<span class="nc" id="L1064">			sb.append(&quot;&lt;span &quot;).append(&quot;id=\&quot;&quot;).append(MEDIA_NAMES_DISPLAY_SPAN).append(&quot;\&quot; &quot;);</span>
<span class="nc" id="L1065">			sb.append(&quot;name=\&quot;&quot;).append(MEDIA_NAMES_DISPLAY_SPAN).append(&quot;\&quot; &quot;);</span>
<span class="nc" id="L1066">			sb.append(&quot;onClick=\&quot;&quot;).append(&quot;MediaSelectorPopup();\&quot;&quot;);</span>
<span class="nc bnc" id="L1067" title="All 2 branches missed.">			if (isFieldDisabled(ActivityFields.MEDIA)) {</span>
<span class="nc" id="L1068">				sb.append(&quot; style=\&quot;visibility:hidden;\&quot;&quot;);</span>
			} else {
<span class="nc" id="L1070">				sb.append(&quot; style=\&quot;visibility:visible;\&quot;&quot;);</span>
			}
<span class="nc" id="L1072">			sb.append(&quot; &gt;&quot;);</span>
<span class="nc" id="L1073">			sb.append(HtmlUtil.imageTag(ImageFileID.EDIT, ImageFileID.EDIT_WIDTH,</span>
<span class="nc" id="L1074">				ImageFileID.EDIT_HEIGHT, i18n(m_bbmBundle, BbmWebBundleKey.EDIT)));</span>
<span class="nc" id="L1075">			sb.append(&quot;&lt;/span&gt;&quot;);</span>
		}
<span class="nc" id="L1077">		return sb.toString();</span>
	}

	private String getMediaIdsString() {
<span class="nc" id="L1081">		return StringUtil.createDelimitedString(m_mediaIds, &quot;,&quot;);</span>
	}

	private String getMediaNamesString() throws RemoteException, BbmException {
<span class="nc" id="L1085">		return WorkloadModelHandler.getMediaDisplayFromIds(m_context, m_mediaIds);</span>
	}


	private String getQueuesDisplay(boolean editable) throws RemoteException, BbmException {
<span class="nc" id="L1090">		StringBuffer sb = new StringBuffer(512);</span>
<span class="nc" id="L1091">		sb.append(makeTextReadOnlyInput(QUEUE_NAMES_DISPLAY_FN, 45, getQueueNamesString()));</span>
<span class="nc bnc" id="L1092" title="All 2 branches missed.">		if (editable) {</span>
<span class="nc" id="L1093">			sb.append(&quot;&lt;span &quot;).append(&quot;id=\&quot;&quot;).append(QUEUE_NAMES_DISPLAY_SPAN).append(&quot;\&quot; &quot;);</span>
<span class="nc" id="L1094">			sb.append(&quot;name=\&quot;&quot;).append(QUEUE_NAMES_DISPLAY_SPAN).append(&quot;\&quot; &quot;);</span>
<span class="nc" id="L1095">			sb.append(&quot;onClick=\&quot;&quot;).append(&quot;QueueSelectorPopup();\&quot;&quot;);</span>
<span class="nc bnc" id="L1096" title="All 2 branches missed.">			if (isFieldDisabled(ActivityFields.QUEUES)) {</span>
<span class="nc" id="L1097">				sb.append(&quot; style=\&quot;visibility:hidden;\&quot;&quot;);</span>
			} else {
<span class="nc" id="L1099">				sb.append(&quot; style=\&quot;visibility:visible;\&quot;&quot;);</span>
			}
<span class="nc" id="L1101">			sb.append(&quot; &gt;&quot;);</span>
<span class="nc" id="L1102">			sb.append(HtmlUtil.imageTag(ImageFileID.EDIT, ImageFileID.EDIT_WIDTH,</span>
<span class="nc" id="L1103">				ImageFileID.EDIT_HEIGHT, i18n(m_bbmBundle, BbmWebBundleKey.EDIT)));</span>
<span class="nc" id="L1104">			sb.append(&quot;&lt;/span&gt;&quot;);</span>
		}
<span class="nc" id="L1106">		return sb.toString();</span>
	}

	private String makeTextReadOnlyInput(String name, int size, String value) {
<span class="nc" id="L1110">		StringBuffer sb = new StringBuffer(128);</span>
<span class="nc" id="L1111">		sb.append(&quot;&lt;input type=\&quot;text\&quot; class=\&quot;inputTextReadOnly\&quot; readonly &quot;)</span>
<span class="nc" id="L1112">			.append(&quot;name=\&quot;&quot;).append(name).append(&quot;\&quot; &quot;)</span>
<span class="nc" id="L1113">			.append(&quot;id=\&quot;&quot;).append(name).append(&quot;\&quot; &quot;)</span>
<span class="nc" id="L1114">			.append(&quot; onChange=\&quot;&quot;).append(&quot;getRemoteInitJS();\n&quot;).append(&quot;\&quot;&quot;);</span>
<span class="nc bnc" id="L1115" title="All 2 branches missed.">		if (size &gt; 0) sb.append(&quot;size=\&quot;&quot;).append(size).append(&quot;\&quot; &quot;);</span>
<span class="nc" id="L1116">		sb.append(&quot;value=\&quot;&quot;).append(HtmlUtil.escapeFieldValue(value)).append(&quot;\&quot; &quot;)</span>
<span class="nc" id="L1117">			.append(&quot;&gt;&quot;);</span>
<span class="nc" id="L1118">		return sb.toString();</span>
	}//makeTextReadOnlyInput

	private String getQueueIdsString() {
<span class="nc" id="L1122">		return StringUtil.createDelimitedString(m_queueIds, &quot;,&quot;);</span>
	}

	private String getQueueNamesString() throws RemoteException, BbmException {
<span class="nc" id="L1126">		return WorkloadModelHandler.getQueueDisplayFromIds(m_context, m_queueIds);</span>
	}


	private String getColorCodeLabel() {
<span class="nc" id="L1131">		return i18n(m_bbmBundle, BbmWebBundleKey.ACTIVITY_LABEL_COLOR_CODE);</span>
	}

	private String getColorLabel() {
<span class="nc" id="L1135">		return i18n(m_bbmBundle, BbmWebBundleKey.ACTIVITY_LABEL_COLOR);</span>
	}

	private void setDefaultValues() {
<span class="nc" id="L1139">		m_activity.setPaid(PAID_DEFAULT);</span>
<span class="nc" id="L1140">		m_activity.setColor(ACTIVITY_COLOR_DEFAULT);</span>
<span class="nc" id="L1141">		m_activity.setTimeoff(TIMEOFF_DEFAULT);</span>
<span class="nc" id="L1142">		m_fsUsagePC.setDefaultValues();</span>
<span class="nc" id="L1143">		m_rmUsagePC.setDefaultValues();</span>
<span class="nc" id="L1144">		m_amUsagePC.setDefaultValues();</span>
<span class="nc" id="L1145">	}</span>

	private boolean isFieldDisabled(short field) {
<span class="nc bnc" id="L1148" title="All 5 branches missed.">		switch (field) {</span>
			case ActivityFields.TIMEOFF:
<span class="nc bnc" id="L1150" title="All 2 branches missed.">				if (m_activity.isTimeoff()) return false;</span>
<span class="nc" id="L1151">				return m_hasMedia;</span>
			case ActivityFields.MEDIA:
<span class="nc bnc" id="L1153" title="All 2 branches missed.">				if (m_hasMedia) return false;</span>
<span class="nc bnc" id="L1154" title="All 6 branches missed.">				return m_activity.isUsedInCalendarEvent() || m_activity.isTimeoff() || m_activity.isUnavailability();</span>
			case ActivityFields.QUEUES:
<span class="nc bnc" id="L1156" title="All 2 branches missed.">				if (m_hasQueues) return false;</span>
<span class="nc bnc" id="L1157" title="All 4 branches missed.">				return !m_activity.isQueueHopping() &amp;&amp; !hasProjectMedia();</span>
			case ActivityFields.QUEUE_HOPPING:
<span class="nc bnc" id="L1159" title="All 2 branches missed.">				if (hasProjectMedia()) return true;</span>
<span class="nc" id="L1160">				return false;</span>
		}
<span class="nc" id="L1162">		return false;</span>
	}

	/**
	 * Checks to see if there is a Project media is linked to this activity.
	 *
	 * @return
	 */
	private boolean hasProjectMedia() {
<span class="nc bnc" id="L1171" title="All 4 branches missed.">		return m_mediaIds != null &amp;&amp; m_mediaIds.contains(Media.MEDIA_ID_PROJECT);</span>
	}

	/**
	 * Return true if Current User is authorized to configure activity FS attributes
	 */
	protected boolean isAuthorizedToConfigureFSAttributes(ID orgID) {
<span class="nc" id="L1178">		return m_context.getUser().isAuthorized(PrivilegeKeys.CORE_VIEWACTIVITIES,</span>
<span class="nc" id="L1179">			OrganizationScopeManagerProxy.getScopeID(orgID));</span>
	}

	/**
	 * Return true if Current User is authorized to configure activity AM attributes
	 */
	protected boolean isAuthorizedToConfigureAMAttributes(ID orgID) {
<span class="nc" id="L1186">		return m_context.getUser().isAuthorized(PrivilegeKeys.CORE_VIEWACTIVITIES,</span>
<span class="nc" id="L1187">			OrganizationScopeManagerProxy.getScopeID(orgID));</span>
	}

	/**
	 * Return true if Current User is authorized to configure activity AM attributes
	 */
	protected boolean isAuthorizedToConfigureAdvisorAttributes(ID orgID) {
<span class="nc" id="L1194">		return m_context.getUser().isAuthorized(PrivilegeKeys.CORE_VIEWACTIVITIES,</span>
<span class="nc" id="L1195">			OrganizationScopeManagerProxy.getScopeID(orgID));</span>
	}

	private void checkForLicenses() {
		try {
<span class="nc" id="L1200">			LicenseManager licManager = CoreManagerFactory.getLicenseManager();</span>
<span class="nc" id="L1201">			m_hasPayrollLicense = licManager.isLicensed(LicenseKeys.APP_PAYROLL);</span>
<span class="nc" id="L1202">			m_hasMultiMediaLicense = licManager.isLicensed(LicenseKeys.APP_MULTIMEDIA);</span>
<span class="nc" id="L1203">			m_hasQueueHoppingLicense = licManager.isLicensed(LicenseKeys.APP_QUEUE_HOPPING);</span>
<span class="nc" id="L1204">			m_hasAdvisorLicense = licManager.isLicensed(LicenseKeys.APP_ADVISOR_EXPRESS);</span>
<span class="nc" id="L1205">		} catch (Exception ex) {</span>
<span class="nc" id="L1206">			log.l7dError(BbmWebBundleKey.UNABLE_TO_LOAD_DATA, ex);</span>
<span class="nc" id="L1207">		}</span>
<span class="nc" id="L1208">	}</span>

	protected void setSourceMeasureNullObjectIfNull() {
<span class="nc bnc" id="L1211" title="All 2 branches missed.">		if (m_activity.getSourceMeasureId() == null)</span>
<span class="nc" id="L1212">			m_activity.setFieldNull(ActivityFieldInfo.SOURCEMEASUREID);</span>
<span class="nc" id="L1213">	}</span>
	
	public boolean getUseRequiredPayPeriodHours() {
<span class="nc" id="L1216">		return activityProperties.getUseRequiredPayPeriodHours();</span>
	}

	public void setUseRequiredPayPeriodHours(boolean useRequiredPayPeriodHours) {
<span class="nc" id="L1220">		activityProperties.setUseRequiredPayPeriodHours(useRequiredPayPeriodHours);</span>
<span class="nc" id="L1221">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>