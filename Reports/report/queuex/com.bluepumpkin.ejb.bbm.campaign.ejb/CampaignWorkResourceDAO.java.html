<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>CampaignWorkResourceDAO.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.ejb.bbm.campaign.ejb</a> &gt; <span class="el_source">CampaignWorkResourceDAO.java</span></div><h1>CampaignWorkResourceDAO.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.ejb.bbm.campaign.ejb;

/**
 * Copyright:    Copyright (c) 2001
 * Company:      Blue Pumpkin Software, Inc
 */

import java.util.ArrayList;
import java.util.Collection;
import java.util.Collections;
import java.util.Date;
import java.util.HashMap;
import java.util.HashSet;
import java.util.List;
import java.util.Map;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.jdmo.Jdmo;
import com.bluepumpkin.common.jdmo.JdmoException;
import com.bluepumpkin.common.jdmo.JdmoRowset;
import com.bluepumpkin.common.jdmo.JdmoUtil;
import com.bluepumpkin.ejb.bbm.base.BbmFinderException;
import com.bluepumpkin.ejb.bbm.campaign.model.CampaignWorkResource;
import com.bluepumpkin.ejb.bbm.campaign.model.CampaignWorkResourceFieldInfo;
import com.bluepumpkin.ejb.bbm.campaign.model.SchedulingPeriod;
import com.bluepumpkin.ejb.bbm.dao.DAOEffectivity;
import com.bluepumpkin.ejb.bbm.vo.FieldInfo;
import com.bluepumpkin.ejb.bbm.vo.ValueObjectBase;
import com.bluepumpkin.ejb.bbm.workresource.model.WorkResourceInner;

public class CampaignWorkResourceDAO extends DAOEffectivity {

<span class="fc" id="L33">	private static FieldInfo m_fieldInfo = new CampaignWorkResourceFieldInfo();</span>

	@Override
	protected FieldInfo getFieldInfo() {
<span class="fc" id="L37">		return m_fieldInfo;</span>
	}

	public CampaignWorkResourceDAO() {
<span class="fc" id="L41">		super();</span>
<span class="fc" id="L42">	}</span>

	public CampaignWorkResourceDAO(Jdmo dmo) {
<span class="nc" id="L45">		super(dmo);</span>
<span class="nc" id="L46">	}</span>

	@Override
	protected ValueObjectBase createValueObject() {
<span class="nc" id="L50">		return (new CampaignWorkResource());</span>
	}

	/**
	 * When schedulingPeriod.isUsingAllEmployees() is set to false this is how
	 * we determine the assignments
	 */
	public Collection&lt;CampaignWorkResource&gt; getCampaignWorkResourceAssignmentsByLinkedEmployees(
			SchedulingPeriod schedulingPeriod) throws BbmFinderException {
<span class="fc" id="L59">		List&lt;CampaignWorkResource&gt; resources = new ArrayList&lt;CampaignWorkResource&gt;();</span>
<span class="fc" id="L60">		JdmoRowset r = null;</span>

		try {
<span class="fc" id="L63">			String query = &quot;SELECT DISTINCT map.WORKRESOURCEID, sp.FROMDATE, sp.TODATE, SP.SID \n&quot; + &quot; FROM SP sp \n&quot;</span>
					+ &quot; INNER JOIN SPWORKRESOURCE map \n&quot; + &quot;    ON map.SPID = SP.ID  \n&quot; + &quot; INNER JOIN WORKRESOURCE r \n&quot;
					+ &quot; 	ON r.ID = map.WORKRESOURCEID \n&quot; + &quot; 	AND r.WORKRESTYPE = '&quot; + WorkResourceInner.TYPE_EMPLOYEE
<span class="fc" id="L66">					+ &quot;' \n&quot; + &quot; WHERE SP.SID = &quot; + schedulingPeriod.getID() + &quot;   AND SP.FROMDATE &lt; '&quot;</span>
<span class="fc" id="L67">					+ JdmoUtil.formatDBString(schedulingPeriod.getEndTime()) + &quot;' \n&quot; + &quot; 	AND SP.TODATE &gt; '&quot;</span>
<span class="fc" id="L68">					+ JdmoUtil.formatDBString(schedulingPeriod.getStartTime())</span>
					+ &quot;'\n                                                                                               &quot;;

			// convert data to entities
<span class="fc" id="L72">			r = m_dmo.createRowset(query);</span>
<span class="fc bfc" id="L73" title="All 2 branches covered.">			while (r.next()) {</span>
<span class="fc" id="L74">				ID employeeID = r.getID(&quot;WORKRESOURCEID&quot;);</span>
<span class="fc" id="L75">				Date startDate = r.getTimestamp(&quot;FROMDATE&quot;);</span>
<span class="fc" id="L76">				Date endDate = r.getTimestamp(&quot;TODATE&quot;);</span>
<span class="fc" id="L77">				ID SPID = r.getID(&quot;SID&quot;);</span>

<span class="fc" id="L79">				CampaignWorkResource resource = new CampaignWorkResource();</span>
				// Note this is SID
<span class="fc" id="L81">				resource.setCampaignID(schedulingPeriod.getCampaignID());</span>
<span class="fc" id="L82">				resource.setWorkResourceID(employeeID);</span>
<span class="fc" id="L83">				resource.setStartTime(startDate);</span>
<span class="fc" id="L84">				resource.setEndTime(endDate);</span>
<span class="fc" id="L85">				resource.setSPID(SPID);</span>

<span class="fc" id="L87">				resources.add(resource);</span>
<span class="fc" id="L88">			}</span>

<span class="fc" id="L90">			return resources;</span>

<span class="nc" id="L92">		} catch (JdmoException e) {</span>
<span class="nc" id="L93">			e.printStackTrace();</span>
<span class="nc" id="L94">			throw new BbmFinderException(e);</span>
		} finally {
<span class="nc" id="L96">			try {</span>
<span class="pc bpc" id="L97" title="3 of 4 branches missed.">				if (r != null) {</span>
<span class="pc" id="L98">					r.close();</span>
				}
<span class="nc" id="L100">			} catch (JdmoException e) {</span>
<span class="nc" id="L101">				e.printStackTrace();</span>
<span class="nc" id="L102">				throw new BbmFinderException(e);</span>
<span class="pc" id="L103">			}</span>
<span class="pc" id="L104">			m_dmo.cleanUp();</span>
		}
	}

	/**
	 * When schedulingPeriod.isUsingAllEmployees() is set to true this is how we
	 * determine the assignments
	 */
	public Collection&lt;CampaignWorkResource&gt; getCampaignWorkResourceAssignmentsByLinkedOrganizations(
			SchedulingPeriod schedulingPeriod) throws BbmFinderException {
<span class="fc" id="L114">		List&lt;CampaignWorkResource&gt; resources = new ArrayList&lt;CampaignWorkResource&gt;();</span>

<span class="fc" id="L116">		String query = &quot;SELECT DISTINCT staff.WORKRESOURCEID, sp.FROMDATE, sp.TODATE, SP.SID, map.ORGANIZATIONID, staff.STARTTIME,&quot;</span>
				+ &quot; staff.ENDTIME \n&quot;
				+ &quot; FROM SP sp \n&quot;
				+ &quot; INNER JOIN SPCALLCENTER map \n&quot;
				+ &quot;    ON map.SPID = sp.ID \n&quot;
				+ &quot; INNER JOIN WORKRESOURCEORGANIZATION staff \n&quot;
				+ &quot;    ON staff.ORGANIZATIONID =map.ORGANIZATIONID \n&quot;
				+ &quot;    AND staff.STARTTIME &lt; '&quot;
<span class="fc" id="L124">				+ JdmoUtil.formatDBString(schedulingPeriod.getEndTime())</span>
				+ &quot;' \n&quot;
				+ &quot;    AND (staff.ENDTIME &gt; '&quot;
<span class="fc" id="L127">				+ JdmoUtil.formatDBString(schedulingPeriod.getStartTime())</span>
				+ &quot;' OR staff.ENDTIME is null) \n&quot;
				+ &quot; INNER JOIN WORKRESOURCE r \n&quot;
				+ &quot;    ON r.ID = staff.WORKRESOURCEID \n&quot;
				+ &quot;    AND r.WORKRESTYPE = '&quot;
				+ WorkResourceInner.TYPE_EMPLOYEE
				+ &quot;' \n&quot;
				+ &quot; WHERE SP.isusingallemployees = 1 AND SP.SID = &quot;
<span class="fc" id="L135">				+ schedulingPeriod.getID()</span>
				+ &quot; \nUnion\n&quot;
				+ &quot; SELECT EMPLOYEEID, SP.FROMDATE, SP.TODATE, SP.SID, SPCALLCENTER.ORGANIZATIONID, PRule.STARTTIME, PRule.ENDTIME &quot;
				+ &quot;FROM EmployeePoolingRules PRule,empPoolingRulesOrganizations, SP,SPCALLCENTER &quot;
				+ &quot; WHERE SP.SID = &quot;
<span class="fc" id="L140">				+ schedulingPeriod.getID()</span>
				+ &quot; AND SPCALLCENTER.SPID = SP.ID &quot;
				+ &quot; AND SPCALLCENTER.ORGANIZATIONID = empPoolingRulesOrganizations.ORGANIZATIONID &quot;
				+ &quot; AND PRule.ID = empPoolingRulesOrganizations.poolingruleID &quot;
				+ &quot; AND ((PRule.STARTTIME &lt;= '&quot;
<span class="fc" id="L145">				+ JdmoUtil.formatDBString(schedulingPeriod.getStartTime())</span>
				+ &quot;'&quot;
				+ &quot; AND (PRule.ENDTIME &gt; '&quot;
<span class="fc" id="L148">				+ JdmoUtil.formatDBString(schedulingPeriod.getStartTime())</span>
				+ &quot;' OR PRule.ENDTIME is NULL))&quot;
				+ &quot; OR (PRule.STARTTIME&gt;= '&quot;
<span class="fc" id="L151">				+ JdmoUtil.formatDBString(schedulingPeriod.getStartTime())</span>
<span class="fc" id="L152">				+ &quot;' AND PRule.STARTTIME &lt; '&quot; + JdmoUtil.formatDBString(schedulingPeriod.getEndTime()) + &quot;'))&quot;;</span>

		// convert data to entities
<span class="fc" id="L155">		JdmoRowset r = null;</span>
		try {
<span class="fc" id="L157">			r = m_dmo.createRowset(query);</span>
<span class="fc bfc" id="L158" title="All 2 branches covered.">			while (r.next()) {</span>
<span class="fc" id="L159">				ID employeeID = r.getID(&quot;WORKRESOURCEID&quot;);</span>
<span class="fc" id="L160">				Date startDate = r.getTimestamp(&quot;FROMDATE&quot;);</span>
<span class="fc" id="L161">				Date endDate = r.getTimestamp(&quot;TODATE&quot;);</span>
<span class="fc" id="L162">				ID SPID = r.getID(&quot;SID&quot;);</span>

<span class="fc" id="L164">				CampaignWorkResource resource = new CampaignWorkResource();</span>
				// Note this is SID
<span class="fc" id="L166">				resource.setCampaignID(schedulingPeriod.getCampaignID());</span>
<span class="fc" id="L167">				resource.setWorkResourceID(employeeID);</span>
<span class="fc" id="L168">				resource.setStartTime(startDate);</span>
<span class="fc" id="L169">				resource.setEndTime(endDate);</span>
<span class="fc" id="L170">				resource.setSPID(SPID);</span>

<span class="fc" id="L172">				resources.add(resource);</span>
<span class="fc" id="L173">			}</span>

<span class="fc" id="L175">			return resources;</span>

<span class="nc" id="L177">		} catch (JdmoException e) {</span>
<span class="nc" id="L178">			e.printStackTrace();</span>
<span class="nc" id="L179">			throw new BbmFinderException(e);</span>
		} finally {
<span class="nc" id="L181">			try {</span>
<span class="pc" id="L182">				r.close();</span>
<span class="nc" id="L183">			} catch (JdmoException e) {</span>
<span class="nc" id="L184">				m_dmo.cleanUp();</span>
<span class="pc" id="L185">			}</span>
		}
	}

	/**
	 * For a collection of work resource ids (usually employee ids) and a date
	 * range, return a map of work resource ids to the campaigns they are
	 * assigned to, only for those scheduling periods for which
	 * isUsingAllEmployees() does not obtain
	 *
	 * @param startDate null treated as unlimited
	 * @param endDate   null treated as unlimited
	 */
	public Map&lt;ID, List&lt;CampaignWorkResource&gt;&gt; getCampaignWorkResourceAssignmentsByLinkedEmployees(
			Collection&lt;ID&gt; workResourceIds, Date startDate, Date endDate) throws BbmFinderException {
<span class="fc" id="L200">		Map&lt;ID, List&lt;CampaignWorkResource&gt;&gt; resourceAssignmentMap = new HashMap&lt;ID, List&lt;CampaignWorkResource&gt;&gt;();</span>
<span class="pc bpc" id="L201" title="2 of 4 branches missed.">		if (workResourceIds == null || workResourceIds.isEmpty()) {</span>
<span class="nc" id="L202">			return resourceAssignmentMap;</span>
		}

		// initialize map
<span class="fc bfc" id="L206" title="All 2 branches covered.">		for (ID id : workResourceIds) {</span>
<span class="fc" id="L207">			resourceAssignmentMap.put(id, new ArrayList&lt;CampaignWorkResource&gt;());</span>
<span class="fc" id="L208">		}</span>

<span class="fc" id="L210">		JdmoRowset r = null;</span>
		try {
<span class="fc" id="L212">			String query = &quot;SELECT DISTINCT c.sid AS c_sid, \n&quot; + &quot;    sp.sid AS sp_sid,  \n&quot; + &quot;    sp.fromdate, \n&quot;</span>
					+ &quot;    sp.todate, \n&quot; + &quot;    map.workresourceid \n&quot; + &quot; FROM spworkresource map \n&quot;
					+ &quot; INNER JOIN sp sp \n&quot; + &quot;    ON sp.id = map.spid \n&quot; + &quot;    AND SP.isusingallemployees = 0 \n&quot;
<span class="fc" id="L215">					+ &quot;    AND	sp.fromdate &lt; '&quot; + JdmoUtil.formatDBString(endDate) + &quot;' \n&quot; + &quot;    AND sp.todate &gt; '&quot;</span>
<span class="fc" id="L216">					+ JdmoUtil.formatDBString(startDate) + &quot;' \n&quot; + &quot; INNER JOIN campaign c \n&quot;</span>
					+ &quot;    ON sp.campaignid = c.id \n&quot; + &quot; WHERE  \n&quot; + &quot;    map.workresourceid IN &quot;
<span class="fc" id="L218">					+ (m_dmo.createInClause(workResourceIds));</span>

			// convert data to entities
<span class="fc" id="L221">			r = m_dmo.createRowset(query);</span>
<span class="pc bpc" id="L222" title="1 of 2 branches missed.">			while (r.next()) {</span>
<span class="nc" id="L223">				ID campaignID = r.getID(&quot;c_sid&quot;);</span>
<span class="nc" id="L224">				Date fromDate = r.getTimestamp(&quot;fromdate&quot;);</span>
<span class="nc" id="L225">				Date toDate = r.getTimestamp(&quot;todate&quot;);</span>
<span class="nc" id="L226">				ID spSID = r.getID(&quot;sp_sid&quot;);</span>
<span class="nc" id="L227">				ID resourceID = r.getID(&quot;workresourceid&quot;);</span>
<span class="nc" id="L228">				CampaignWorkResource assignment = new CampaignWorkResource();</span>
<span class="nc" id="L229">				assignment.setCampaignID(campaignID);</span>
<span class="nc" id="L230">				assignment.setWorkResourceID(resourceID);</span>
<span class="nc" id="L231">				assignment.setStartTime(fromDate);</span>
<span class="nc" id="L232">				assignment.setEndTime(toDate);</span>
<span class="nc" id="L233">				assignment.setSPID(spSID);</span>
<span class="nc" id="L234">				resourceAssignmentMap.get(resourceID).add(assignment);</span>
<span class="nc" id="L235">			}</span>
<span class="fc" id="L236">			return resourceAssignmentMap;</span>
<span class="nc" id="L237">		} catch (JdmoException e) {</span>
<span class="nc" id="L238">			e.printStackTrace();</span>
<span class="nc" id="L239">			throw new BbmFinderException(e);</span>
		} finally {
<span class="nc" id="L241">			try {</span>
<span class="pc" id="L242">				r.close();</span>
<span class="nc" id="L243">			} catch (JdmoException e) {</span>
<span class="nc" id="L244">				m_dmo.cleanUp();</span>
<span class="pc" id="L245">			}</span>
		}
	}

	/**
	 * For a collection of work resource ids (usually employee ids) and a date
	 * range, return a map of work resource ids to the campaigns they are
	 * assigned to, only for those scheduling periods for which
	 * isUsingAllEmployees() obtains
	 *
	 * @param startDate null treated as unlimited
	 * @param endDate   null treated as unlimited
	 */
	public Map&lt;ID, List&lt;CampaignWorkResource&gt;&gt; getCampaignWorkResourceAssignmentsByLinkedOrganizations(
			Collection&lt;ID&gt; workResourceIds, Date startDate, Date endDate) throws BbmFinderException {
<span class="fc" id="L260">		Map&lt;ID, List&lt;CampaignWorkResource&gt;&gt; resourceAssignmentMap = new HashMap&lt;ID, List&lt;CampaignWorkResource&gt;&gt;();</span>
<span class="pc bpc" id="L261" title="2 of 4 branches missed.">		if (workResourceIds == null || workResourceIds.isEmpty()) {</span>
<span class="nc" id="L262">			return resourceAssignmentMap;</span>
		}

		// initialize map
<span class="fc bfc" id="L266" title="All 2 branches covered.">		for (ID id : workResourceIds) {</span>
<span class="fc" id="L267">			resourceAssignmentMap.put(id, new ArrayList&lt;CampaignWorkResource&gt;());</span>
<span class="fc" id="L268">		}</span>

<span class="fc" id="L270">		JdmoRowset r = null;</span>
		try {
<span class="fc" id="L272">			String query = &quot;SELECT DISTINCT c.sid AS c_sid, \n&quot; + &quot;    sp.sid AS sp_sid,  \n&quot; + &quot;    sp.fromdate, \n&quot;</span>
					+ &quot;    sp.todate, \n&quot; + &quot;    r_o.workresourceid  \n&quot; + &quot; FROM workresourceorganization r_o \n&quot;
					+ &quot; INNER JOIN spcallcenter sp_o \n&quot; + &quot;    ON sp_o.organizationid = r_o.organizationid \n&quot;
					+ &quot; INNER JOIN sp sp \n&quot; + &quot;    ON sp.id = sp_o.spid \n&quot; + &quot;    AND SP.isusingallemployees = 1 \n&quot;
<span class="fc" id="L276">					+ &quot;    AND sp.fromdate &lt; '&quot; + JdmoUtil.formatDBString(endDate) + &quot;' \n&quot; + &quot;    AND sp.todate &gt; '&quot;</span>
<span class="fc" id="L277">					+ JdmoUtil.formatDBString(startDate) + &quot;' \n&quot; + &quot; INNER JOIN campaign c \n&quot;</span>
					+ &quot;    ON sp.campaignid = c.id \n&quot; + &quot; WHERE  \n&quot; + &quot;    r_o.workresourceid IN &quot;
<span class="fc" id="L279">					+ (m_dmo.createInClause(workResourceIds));</span>

			// convert data to entities
<span class="fc" id="L282">			r = m_dmo.createRowset(query);</span>
<span class="fc bfc" id="L283" title="All 2 branches covered.">			while (r.next()) {</span>
<span class="fc" id="L284">				ID campaignID = r.getID(&quot;c_sid&quot;);</span>
<span class="fc" id="L285">				Date fromDate = r.getTimestamp(&quot;fromdate&quot;);</span>
<span class="fc" id="L286">				Date toDate = r.getTimestamp(&quot;todate&quot;);</span>
<span class="fc" id="L287">				ID spSID = r.getID(&quot;sp_sid&quot;);</span>
<span class="fc" id="L288">				ID resourceID = r.getID(&quot;workresourceid&quot;);</span>
<span class="fc" id="L289">				CampaignWorkResource assignment = new CampaignWorkResource();</span>
<span class="fc" id="L290">				assignment.setCampaignID(campaignID);</span>
<span class="fc" id="L291">				assignment.setWorkResourceID(resourceID);</span>
<span class="fc" id="L292">				assignment.setStartTime(fromDate);</span>
<span class="fc" id="L293">				assignment.setEndTime(toDate);</span>
<span class="fc" id="L294">				assignment.setSPID(spSID);</span>
<span class="fc" id="L295">				resourceAssignmentMap.get(resourceID).add(assignment);</span>
<span class="fc" id="L296">			}</span>
<span class="fc" id="L297">			return resourceAssignmentMap;</span>
<span class="nc" id="L298">		} catch (JdmoException e) {</span>
<span class="nc" id="L299">			e.printStackTrace();</span>
<span class="nc" id="L300">			throw new BbmFinderException(e);</span>
		} finally {
<span class="nc" id="L302">			try {</span>
<span class="pc" id="L303">				r.close();</span>
<span class="nc" id="L304">			} catch (JdmoException e) {</span>
<span class="nc" id="L305">				m_dmo.cleanUp();</span>
<span class="pc" id="L306">			}</span>
		}
	}

	/**
	 * get the pooler assignments for the given set of Scheduling Periods.
	 *
	 * @return a collection of work resource IDs which are poolers at any of the
	 * given scheduling periods.
	 * @spIDs a collection of IDs of scheduling periods for which we want to
	 * retrieve the pooling assignments.
	 */
	public Collection&lt;ID&gt; getSPPoolerAssignments(Collection&lt;ID&gt; spIDs) throws BbmFinderException {
<span class="fc" id="L319">		return getSPPoolerAssignments(spIDs, null, null);</span>
	}

	/**
	 * get the pooler assignments for the given Scheduling Period between the
	 * given date range.
	 *
	 * @return a collection of work resource IDs which are poolers at the given
	 * scheduling period during the given time frame.
	 * @spID sp id
	 * @dtStart, @dtEnd: the time period, null date means a open period
	 */
	public Collection&lt;ID&gt; getSPPoolerAssignments(ID spID, Date dtStart, Date dtEnd) throws BbmFinderException {
<span class="pc bpc" id="L332" title="1 of 2 branches missed.">		if (spID == null) {</span>
<span class="nc" id="L333">			return Collections.emptyList();</span>
		}
<span class="fc" id="L335">		return getSPPoolerAssignments(Collections.singleton(spID), dtStart, dtEnd);</span>
	}

	/**
	 * get the pooler assignments for the given Scheduling Periods between the
	 * given date range.
	 * &lt;p&gt;
	 * Note that if a collection of scheduling periods is given, then the dates
	 * should be null in this case. The date ranges will then be ignored and the
	 * dates used in the query will be the start and end dates of the respective
	 * scheduling periods.
	 * &lt;p&gt;
	 * If a single scheduling period is given, then the date ranges could be
	 * non-null if you want to specify a date range that might be a subset of
	 * the scheduling period date range. If the dates are null, the method will
	 * use the start/end dates of the scheduling period.
	 *
	 * @return a collection of work resource IDs which are poolers at the given
	 * scheduling periods during the given time frame.
	 * @spIDs a collection of IDs of scheduling periods for which we want to
	 * retrieve the pooling assignments.
	 * @dtStart, @dtEnd: the time period, null date means a open period
	 */
	private Collection&lt;ID&gt; getSPPoolerAssignments(Collection&lt;ID&gt; spIDs, Date dtStart, Date dtEnd) throws BbmFinderException {
<span class="pc bpc" id="L359" title="2 of 4 branches missed.">		if (spIDs == null || spIDs.isEmpty()) {</span>
<span class="nc" id="L360">			return Collections.emptyList();</span>
		}
		// load all campaigns
<span class="fc" id="L363">		HashSet&lt;ID&gt; aAssignments = new HashSet&lt;ID&gt;();</span>
<span class="fc" id="L364">		JdmoRowset r = null;</span>
		try {
<span class="fc" id="L366">			StringBuilder query = new StringBuilder();</span>
<span class="fc" id="L367">			query.append(&quot;SELECT EMPLOYEEID FROM EmployeePoolingRules,empPoolingRulesOrganizations, SP,SPCALLCENTER &quot;);</span>
<span class="fc" id="L368">			query.append(&quot; WHERE SP.SID IN &quot;);</span>
<span class="fc" id="L369">			query.append(getDMO().createInClause(spIDs));</span>
<span class="fc" id="L370">			query.append(&quot; AND SPCALLCENTER.SPID = SP.ID &quot;);</span>
<span class="fc" id="L371">			query.append(&quot; AND SPCALLCENTER.ORGANIZATIONID = empPoolingRulesOrganizations.ORGANIZATIONID &quot;);</span>
<span class="fc" id="L372">			query.append(&quot; AND EmployeePoolingRules.ID = empPoolingRulesOrganizations.poolingruleID &quot;);</span>
<span class="fc" id="L373">			query.append(&quot; AND ((EmployeePoolingRules.STARTTIME &lt;= &quot;);</span>
<span class="fc bfc" id="L374" title="All 2 branches covered.">			if (dtStart != null) {</span>
<span class="fc" id="L375">				query.append(JdmoUtil.asSqlLiteral(dtStart));</span>
			} else {
<span class="fc" id="L377">				query.append(&quot; SP.FROMDATE &quot;);</span>
			}
<span class="fc" id="L379">			query.append(&quot; AND (EmployeePoolingRules.ENDTIME &gt; &quot;);</span>
<span class="fc bfc" id="L380" title="All 2 branches covered.">			if (dtEnd != null) {</span>
<span class="fc" id="L381">				query.append(JdmoUtil.asSqlLiteral(dtStart));</span>
			} else {
<span class="fc" id="L383">				query.append(&quot; SP.FROMDATE &quot;);</span>
			}
<span class="fc" id="L385">			query.append(&quot; OR EmployeePoolingRules.ENDTIME is NULL))&quot;);</span>
<span class="fc" id="L386">			query.append(&quot; OR (EmployeePoolingRules.STARTTIME &gt;= &quot;);</span>
<span class="fc bfc" id="L387" title="All 2 branches covered.">			if (dtStart != null) {</span>
<span class="fc" id="L388">				query.append(JdmoUtil.asSqlLiteral(dtStart));</span>
			} else {
<span class="fc" id="L390">				query.append(&quot; SP.FROMDATE &quot;);</span>
			}
<span class="fc" id="L392">			query.append(&quot; AND EmployeePoolingRules.STARTTIME &lt; &quot;);</span>
<span class="fc bfc" id="L393" title="All 2 branches covered.">			if (dtEnd != null) {</span>
<span class="fc" id="L394">				query.append(JdmoUtil.asSqlLiteral(dtEnd));</span>
			} else {
<span class="fc" id="L396">				query.append(&quot; SP.TODATE &quot;);</span>
			}
<span class="fc" id="L398">			query.append(&quot;))&quot;);</span>

<span class="fc" id="L400">			r = m_dmo.createRowset(query.toString());</span>

<span class="pc bpc" id="L402" title="1 of 2 branches missed.">			while (r.next()) {</span>
<span class="nc" id="L403">				ID idEmployee = r.getID(&quot;EMPLOYEEID&quot;);</span>
<span class="nc" id="L404">				aAssignments.add(idEmployee);</span>
<span class="nc" id="L405">			}</span>

<span class="fc" id="L407">			r.close();</span>
<span class="fc" id="L408">			return aAssignments;</span>

<span class="nc" id="L410">		} catch (JdmoException e) {</span>
<span class="nc" id="L411">			e.printStackTrace();</span>
<span class="nc" id="L412">			throw new BbmFinderException(e);</span>
		} finally {
<span class="nc" id="L414">			try {</span>
<span class="pc" id="L415">				r.close();</span>
<span class="nc" id="L416">			} catch (JdmoException e) {</span>
<span class="nc" id="L417">				m_dmo.cleanUp();</span>
<span class="pc" id="L418">			}</span>
		}
	}

	/**
	 * get a campaign workresource assignment object by id
	 */
	public CampaignWorkResource getCampaignWorkResourceAssignmentByID(ID idAssignment) throws BbmFinderException {
<span class="nc" id="L426">		return (CampaignWorkResource) getObjectByID(idAssignment);</span>
	}

	/**
	 * Get campaign work resource assignments given their ids
	 */
	@SuppressWarnings(&quot;unchecked&quot;)
	public Collection&lt;CampaignWorkResource&gt; getCampaignWorkResourceAssignmentsByIDs(Collection&lt;ID&gt; colAssignmentIDs)
			throws BbmFinderException {
<span class="nc" id="L435">		return getObjectsByIDs(colAssignmentIDs);</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>