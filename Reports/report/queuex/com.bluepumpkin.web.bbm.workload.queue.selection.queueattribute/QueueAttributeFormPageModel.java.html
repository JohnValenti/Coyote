<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>QueueAttributeFormPageModel.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.bbm.workload.queue.selection.queueattribute</a> &gt; <span class="el_source">QueueAttributeFormPageModel.java</span></div><h1>QueueAttributeFormPageModel.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.bbm.workload.queue.selection.queueattribute;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.StringsPair;
import com.bluepumpkin.common.logging.Category;
import com.bluepumpkin.common.util.StringUtil;
import com.bluepumpkin.ejb.bbm.workload.model.Queue;
import com.bluepumpkin.ejb.bbm.workload.model.queueattribute.*;
import com.bluepumpkin.web.bbm.Log;
import com.bluepumpkin.web.bbm.l10n.BbmWebBundleKey;
import com.bluepumpkin.web.bbm.organization.OrganizationUtil;
import com.bluepumpkin.web.bbm.workload.WorkloadModelHandler;
import com.witness.web.uif.l10n.UIFWebBundleKey;
import com.witness.web.uif.pagecomponent.DefaultMultiColumnNodeData;
import com.witness.web.uif.pagecomponent.form.FormInputPC;
import com.witness.web.uif.pagecomponent.list.DynamicMultiColListPC;
import com.witness.web.uif.pagecomponent.picker.date.DatePickerPC;
import com.witness.web.uif.pagecomponent.table.TableHeaderPC;
import com.witness.web.uif.pagecomponent.toolbar.ToolbarUtil;
import com.witness.web.uif.pagemodel.ContainersInRowsPM;
import com.witness.web.uif.pagemodel.PageModel;
import com.witness.web.uif.pagemodel.WorkpaneFormPageModel;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.system.manager.impl.DefaultVerticalizationManager;
import com.witness.web.uif.util.ContainerList;
import com.witness.web.uif.util.HtmlUtil;
import com.witness.web.uif.util.js.JSUtil;
import com.witness.web.uif.validator.InRangeFieldValidator;

import javax.servlet.http.HttpServletRequest;
import java.text.SimpleDateFormat;
import java.util.*;


/**
 * Title:        QueueAttributeFormPageModel
 * Description:  Display the Edit page for Queue Attributes
 * Copyright:    Copyright (c) 2008
 * Company:      Verint Systems, Inc.
 *
 * @author Sankar Nair
 */
public class QueueAttributeFormPageModel extends WorkpaneFormPageModel implements ContainersInRowsPM {
	private static final String MULTIVALUE_ID = &quot;MULTIVALUE_ID_&quot;;
	private static final String ATTRIB_TYPE_ID = &quot;ATTRIB_TYPE_ID_&quot;;
	private static final String ATTRIB_ID = &quot;ATTRIB_ID&quot;;
	private static final String UNDERSCORE = &quot;_&quot;;
	private static final String QUEUE_ATTRIB_VALUE_FUNCTION = &quot;QUEUE_ATTRIB_VALUE_&quot;;
	private static final String QUEUE_ATTRIB_ID = &quot;QueueAttribID&quot;;
	private static final String DATE_SAVING_PATTERN = &quot;yyyy-MMM-dd&quot;;

	public static final String ATTRIBUTES_EDITOR_TABLE = &quot;ATTRIBUTES_EDITOR_TABLE&quot;;
	public static final String QUEUE_ATTRIBUTE_SAVE = &quot;QUEUE_ATTRIBUTE_SAVE&quot;;

<span class="fc" id="L55">	private static final Category log = Log.initCategory(QueueAttributeFormPageModel.class.getName());</span>

	protected ResourceBundle m_bbmBundle;
	private QueueAttributeDefintion queueAttribute;
	private DatePickerPC m_datePicker;
	private QueueAttributeDefinitionModelHandler modelHandler;
<span class="nc" id="L61">	private DynamicMultiColListPC attributesHolder = null;</span>
	// outer container list
	private ContainerList m_containerList;
<span class="nc" id="L64">	private FormInputPC m_inputPCOne = null;</span>

<span class="nc" id="L66">	private Collection&lt;QueueAttributeDefintion&gt; attribCollection = Collections.emptyList();</span>
<span class="nc" id="L67">	private Hashtable&lt;String, String&gt; lookupValues = new Hashtable&lt;String, String&gt;();</span>

<span class="nc" id="L69">	private Hashtable&lt;ID, QueueAttributePairDateValue&gt; dateLookup = new Hashtable&lt;ID, QueueAttributePairDateValue&gt;();</span>
<span class="nc" id="L70">	private Hashtable&lt;ID, QueueAttributePairTextValue&gt; textLookup = new Hashtable&lt;ID, QueueAttributePairTextValue&gt;();</span>
<span class="nc" id="L71">	private Hashtable&lt;ID, QueueAttributePairDropDownValue&gt; dropDownLookup = new Hashtable&lt;ID, QueueAttributePairDropDownValue&gt;();</span>
<span class="nc" id="L72">	private Hashtable&lt;ID, QueueAttributePairNumericValue&gt; numericLookup = new Hashtable&lt;ID, QueueAttributePairNumericValue&gt;();</span>
<span class="nc" id="L73">	private Hashtable&lt;String, String&gt; dropDownValuesLookup = new Hashtable&lt;String, String&gt;();</span>

	public QueueAttributeFormPageModel(RequestContext context) {
<span class="nc" id="L76">		super(context, FRAMED_MODEL);</span>

<span class="nc" id="L78">		m_bbmBundle = m_localizer.getBundle(BbmWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L79">		m_containerList = new ContainerList(this, 4);</span>

		// Initialize Name
<span class="nc" id="L82">		queueAttribute = new QueueAttributeDefintion();</span>
		// small input box
<span class="nc" id="L84">		m_inputPCOne = new FormInputPC(context);</span>
<span class="nc" id="L85">		addChildComponent(m_inputPCOne);</span>

<span class="nc" id="L87">		modelHandler = new QueueAttributeDefinitionModelHandler();</span>

<span class="nc" id="L89">		attributesHolder = initializeAttributeEditorTable(context);</span>
<span class="nc" id="L90">		addChildComponent(attributesHolder);</span>
<span class="nc" id="L91">		m_containerList.add(attributesHolder);</span>
<span class="nc" id="L92">	}</span>


	private DynamicMultiColListPC initializeAttributeEditorTable(RequestContext context) {
<span class="nc" id="L96">		DynamicMultiColListPC table = new DynamicMultiColListPC(context);</span>
<span class="nc" id="L97">		table.setName(ATTRIBUTES_EDITOR_TABLE);</span>

		// buttons
<span class="nc" id="L100">		TableHeaderPC header = table.getHeader();</span>
<span class="nc" id="L101">		Object[] args = new Object[1];</span>
<span class="nc" id="L102">		args[0] = m_context.getSystemManagerFactory().getVerticalizationManager().getVerticalizedString(m_context,</span>
				DefaultVerticalizationManager.QUEUE);

<span class="nc" id="L105">		header.addColumnHeaderData(&quot;col1&quot;, m_localizer.i18n(m_bbmBundle, BbmWebBundleKey.QUEUE_ATTRIBUTE_ATTRIBUTES, args));</span>
<span class="nc" id="L106">		header.addColumnHeaderData(&quot;col2&quot;, m_localizer.i18n(m_bbmBundle, BbmWebBundleKey.QUEUE_ATTRIBUTE_ATTRIBUTE_VALUES, args));</span>
<span class="nc" id="L107">		header.addColumnHeaderData(&quot;&quot;, &quot;&quot;); // for hidden id //$NON-NLS-1$ //$NON-NLS-2$</span>
<span class="nc" id="L108">		header.addColumnHeaderData(&quot;&quot;, &quot;&quot;); // for hidden type</span>
<span class="nc" id="L109">		header.addColumnHeaderData(&quot;&quot;, &quot;&quot;); // for hidden type</span>
<span class="nc" id="L110">		header.addColumnHeaderData(&quot;&quot;, &quot;&quot;); //for hidden type</span>
<span class="nc" id="L111">		return table;</span>
	}


	public Collection getContainers() {
<span class="nc" id="L116">		return m_containerList;</span>
	}

	/**
	 * Return instance of Model which is ready to be rendered
	 */
	public static PageModel getInstance(RequestContext context) {
<span class="nc" id="L123">		return getInstance(context, QueueAttributeFormPageModel.class);</span>
	}


	/**
	 * Create Form Model
	 */
	protected void loadData() throws Exception {
		try {
			//There are two IDs. Selected ORganization ID and selected queue ID(s).
			//The best option would be to allow selection of only one queue and all the same queue attribute settings to
			//be applied to other queues.
			ID selectedOrganizationID;

<span class="nc" id="L137">			selectedOrganizationID = new ID(OrganizationUtil.getSelectedOrganizationID(m_context));//getSelectedIDObject();</span>

<span class="nc" id="L139">			ID[] selectedIDs = getPerformActionOnIDs();</span>
<span class="nc" id="L140">			ArrayList&lt;ID&gt; queueIDs = new ArrayList&lt;ID&gt;();</span>
<span class="nc" id="L141">			queueIDs.addAll(Arrays.asList(selectedIDs));</span>

<span class="nc" id="L143">			attribCollection = new QueueAttributeDefinitionModelHandler().getQueueAttributeDefinitions(m_context, selectedOrganizationID);</span>

<span class="nc" id="L145">			StringBuilder currentQueueName = new StringBuilder();</span>
<span class="nc" id="L146">			Collection&lt;Queue&gt; queues = WorkloadModelHandler.getQueuesByIDs(m_context, queueIDs);</span>

<span class="nc bnc" id="L148" title="All 2 branches missed.">			for (Queue queue : queues) {</span>
<span class="nc bnc" id="L149" title="All 2 branches missed.">				if (!StringUtil.isEmpty(currentQueueName.toString())) {</span>
<span class="nc" id="L150">					currentQueueName.append(&quot;, &quot;);</span>
				}
<span class="nc" id="L152">				currentQueueName.append(queue.getName());</span>
<span class="nc" id="L153">			}</span>

<span class="nc" id="L155">			Collection&lt;QueueAttributePairDateValue&gt; dateValues = modelHandler.getDateValues(m_context, queueIDs);</span>
<span class="nc" id="L156">			Iterator&lt;QueueAttributePairDateValue&gt; dateIter = dateValues.iterator();</span>
<span class="nc bnc" id="L157" title="All 2 branches missed.">			while (dateIter.hasNext()) {</span>
<span class="nc" id="L158">				QueueAttributePairDateValue v = dateIter.next();</span>
<span class="nc" id="L159">				dateLookup.put(v.getQueueAttributeID(), v);</span>
				//TODO - Format the date
<span class="nc" id="L161">				lookupValues.put(v.getQueueID() + UNDERSCORE + v.getQueueAttributeID(), v.getValue().toString());</span>
<span class="nc" id="L162">			}</span>

<span class="nc" id="L164">			Collection&lt;QueueAttributePairNumericValue&gt; numericValues = modelHandler.getNumericValues(m_context, queueIDs);</span>
<span class="nc" id="L165">			Iterator&lt;QueueAttributePairNumericValue&gt; numericIter = numericValues.iterator();</span>
<span class="nc bnc" id="L166" title="All 2 branches missed.">			while (numericIter.hasNext()) {</span>
<span class="nc" id="L167">				QueueAttributePairNumericValue v = numericIter.next();</span>
<span class="nc" id="L168">				numericLookup.put(v.getQueueAttributeID(), v);</span>
<span class="nc" id="L169">				lookupValues.put(v.getQueueID() + UNDERSCORE + v.getQueueAttributeID(), v.getValue() + &quot;&quot;);</span>
<span class="nc" id="L170">			}</span>

<span class="nc" id="L172">			Collection&lt;QueueAttributePairDropDownValue&gt; ddValues = modelHandler.getDropDownValues(m_context, queueIDs);</span>
<span class="nc" id="L173">			Iterator&lt;QueueAttributePairDropDownValue&gt; ddIter = ddValues.iterator();</span>
<span class="nc bnc" id="L174" title="All 2 branches missed.">			while (ddIter.hasNext()) {</span>
<span class="nc" id="L175">				QueueAttributePairDropDownValue v = ddIter.next();</span>
<span class="nc" id="L176">				dropDownLookup.put(v.getQueueAttributeID(), v);</span>
<span class="nc" id="L177">				lookupValues.put(v.getQueueID() + UNDERSCORE + v.getQueueAttributeID(), v.getValue().toString());</span>
<span class="nc" id="L178">			}</span>

<span class="nc" id="L180">			Collection&lt;QueueAttributePairTextValue&gt; textValues = modelHandler.getTextValues(m_context, queueIDs);</span>
<span class="nc" id="L181">			Iterator&lt;QueueAttributePairTextValue&gt; textIter = textValues.iterator();</span>
<span class="nc bnc" id="L182" title="All 2 branches missed.">			while (textIter.hasNext()) {</span>
<span class="nc" id="L183">				QueueAttributePairTextValue v = textIter.next();</span>
<span class="nc" id="L184">				textLookup.put(v.getQueueAttributeID(), v);</span>
<span class="nc" id="L185">				lookupValues.put(v.getQueueID() + UNDERSCORE + v.getQueueAttributeID(), v.getValue());</span>
<span class="nc" id="L186">			}</span>

<span class="nc" id="L188">			Object[] args = new Object[1];</span>
<span class="nc" id="L189">			args[0] = m_context.getSystemManagerFactory().getVerticalizationManager().getVerticalizedString(m_context,</span>
					DefaultVerticalizationManager.QUEUE);

<span class="nc" id="L192">			String title = m_localizer.i18n(m_bbmBundle, BbmWebBundleKey.QUEUE_ATTRIBUTE_ATTRIBUTES, args);</span>

<span class="nc" id="L194">			this.getContentTitle().setProperties(title, currentQueueName.toString());</span>
<span class="nc" id="L195">		} catch (Exception ex) {</span>
<span class="nc" id="L196">			ex.printStackTrace();</span>
<span class="nc" id="L197">			handleUnableToLoadDataError(log, ex);</span>
<span class="nc" id="L198">			throw ex;</span>
<span class="nc" id="L199">		}</span>
<span class="nc" id="L200">	}</span>

	protected boolean isValidSelectedOrg() {
<span class="nc" id="L203">		return true;</span>
	}

	/**
	 * Initialize Form Display
	 */
	protected void initForm() {
<span class="nc" id="L210">		List&lt;DefaultMultiColumnNodeData&gt; tableRows = new ArrayList&lt;&gt;();</span>

<span class="nc bnc" id="L212" title="All 2 branches missed.">		for (QueueAttributeDefintion obj : attribCollection) {</span>
<span class="nc" id="L213">			DefaultMultiColumnNodeData node = new DefaultMultiColumnNodeData(obj.getID());</span>
<span class="nc" id="L214">			node.add(obj.getName());</span>

<span class="nc" id="L216">			boolean sameValues = checkForSameAttribValue(obj.getID());</span>
<span class="nc bnc" id="L217" title="All 2 branches missed.">			if (obj.getType().equals(QueueAttributeType.TYPE_TEXT)) {</span>
<span class="nc bnc" id="L218" title="All 2 branches missed.">				if (!sameValues) {</span>
<span class="nc" id="L219">					node.add(HtmlUtil.makeTextInput(QUEUE_ATTRIB_VALUE_FUNCTION + obj.getID(), 50, 50, MULTI_VALUE_DATA, JSUtil.ON_CHANGE));</span>
<span class="nc bnc" id="L220" title="All 2 branches missed.">				} else if (textLookup.containsKey(obj.getID())) {</span>
<span class="nc" id="L221">					node.add(HtmlUtil.makeTextInput(QUEUE_ATTRIB_VALUE_FUNCTION + obj.getID(), 50, 50, textLookup.get(obj.getID()).getValue(), JSUtil.ON_CHANGE));</span>
				} else {
<span class="nc" id="L223">					node.add(HtmlUtil.makeTextInput(QUEUE_ATTRIB_VALUE_FUNCTION + obj.getID(), 50, 50, &quot;&quot;, JSUtil.ON_CHANGE));</span>
				}
<span class="nc bnc" id="L225" title="All 2 branches missed.">			} else if (obj.getType().equals(QueueAttributeType.TYPE_NUMERIC)) {</span>
<span class="nc" id="L226">				int type = FormInputPC.TYPE_STRING;</span>
<span class="nc bnc" id="L227" title="All 4 branches missed.">				if (sameValues &amp;&amp; numericLookup.containsKey(obj.getID()))</span>
<span class="nc" id="L228">					m_inputPCOne.reset(QUEUE_ATTRIB_VALUE_FUNCTION + obj.getID(), FormInputPC.localizeRealNumber(numericLookup.get(obj.getID()).getValue() + &quot;&quot;, m_context.getLocalizer()) + &quot;&quot;, type, false);</span>
<span class="nc bnc" id="L229" title="All 2 branches missed.">				else if (!sameValues)</span>
<span class="nc" id="L230">					m_inputPCOne.reset(QUEUE_ATTRIB_VALUE_FUNCTION + obj.getID(), MULTI_VALUE_DATA, type, false);</span>
				else
<span class="nc" id="L232">					m_inputPCOne.reset(QUEUE_ATTRIB_VALUE_FUNCTION + obj.getID(), FormInputPC.localizeRealNumber(&quot;0.0&quot;, m_context.getLocalizer()), type, false);</span>
<span class="nc" id="L233">				m_inputPCOne.setAllowedChars(MULTI_VALUE_DATA);</span>
<span class="nc" id="L234">				m_inputPCOne.setIsRequired(false);</span>
<span class="nc bnc" id="L235" title="All 2 branches missed.">				if (!sameValues) {</span>
<span class="nc" id="L236">					setIsMultiObjEditEnabled(true);</span>
				}

<span class="nc" id="L239">				Object[] args = new Object[1];</span>
<span class="nc" id="L240">				args[0] = m_context.getSystemManagerFactory().getVerticalizationManager().getVerticalizedString(m_context, DefaultVerticalizationManager.QUEUE);</span>

<span class="nc" id="L242">				m_inputPCOne.addValidator(new InRangeFieldValidator(this, QUEUE_ATTRIB_VALUE_FUNCTION + obj.getID(),</span>
<span class="nc" id="L243">						m_localizer.i18n(m_bbmBundle, BbmWebBundleKey.QUEUE_ATTRIBUTE_NUMERIC, args),</span>
						BbmWebBundleKey.BUNDLE_NAME, -1000000.00, 1000000.00));

<span class="nc" id="L246">				node.add(m_inputPCOne.getHtmlDisplay());</span>
<span class="nc bnc" id="L247" title="All 2 branches missed.">			} else if (obj.getType().equals(QueueAttributeType.TYPE_DATE)) {</span>
<span class="nc" id="L248">				String fn = QUEUE_ATTRIB_VALUE_FUNCTION + obj.getID();</span>
<span class="nc" id="L249">				m_datePicker = new DatePickerPC(m_context, fn);</span>
<span class="nc" id="L250">				addChildComponent(m_datePicker);</span>

<span class="nc" id="L252">				m_datePicker.setTimeZone(TimeZone.getTimeZone(&quot;GMT&quot;));</span>
<span class="nc" id="L253">				m_datePicker.setIsTimeEnabled(false);</span>
<span class="nc" id="L254">				setLowerAndUpperLimit(m_datePicker);</span>

<span class="nc" id="L256">				m_datePicker.initForDisplay();</span>
<span class="nc" id="L257">				SimpleDateFormat format = new SimpleDateFormat();</span>
<span class="nc" id="L258">				m_datePicker.setIsDateValueOptional(true);</span>
<span class="nc" id="L259">				format.applyPattern(DATE_SAVING_PATTERN);</span>

<span class="nc bnc" id="L261" title="All 4 branches missed.">				if (sameValues &amp;&amp; dateLookup.containsKey(obj.getID())) {</span>
<span class="nc" id="L262">					m_datePicker.setDate(dateLookup.get(obj.getID()).getValue());</span>
				}

<span class="nc bnc" id="L265" title="All 2 branches missed.">				if (!sameValues) {</span>
<span class="nc" id="L266">					m_datePicker.setIsMultiValueSupported(true);</span>
<span class="nc" id="L267">					m_datePicker.setIsMultiValue(true);</span>
				}
<span class="nc" id="L269">				node.add(m_datePicker.getHtmlDisplay());</span>
<span class="nc bnc" id="L270" title="All 2 branches missed.">			} else if (obj.getType().equals(QueueAttributeType.TYPE_DROPDOWN)) {</span>
				try {
<span class="nc" id="L272">					obj = QueueAttributeDefinitionModelHandler.getQueueAttributeByID(m_context, obj.getID());</span>
<span class="nc" id="L273">				} catch (Exception e) {</span>
<span class="nc" id="L274">					e.printStackTrace();</span>
<span class="nc" id="L275">					handleUnableToLoadDataError(log, e);</span>
<span class="nc" id="L276">				}</span>
<span class="nc" id="L277">				Collection&lt;QueueAttributeDropDown&gt; colDD = obj.getQueueAttributeDropDown();</span>
<span class="nc" id="L278">				Collection&lt;StringsPair&gt; pairedValue = new ArrayList&lt;StringsPair&gt;();</span>
<span class="nc" id="L279">				pairedValue.add(new StringsPair(&quot;-1&quot;, &quot;&quot;));</span>
<span class="nc" id="L280">				Iterator&lt;QueueAttributeDropDown&gt; ddIter = colDD.iterator();</span>
<span class="nc bnc" id="L281" title="All 2 branches missed.">				while (ddIter.hasNext()) {</span>
<span class="nc" id="L282">					QueueAttributeDropDown ddVal = ddIter.next();</span>
<span class="nc" id="L283">					pairedValue.add(new StringsPair(ddVal.getID().toString(), ddVal.getValue()));</span>
<span class="nc" id="L284">					dropDownValuesLookup.put(obj.getID() + UNDERSCORE + ddVal.getID(), ddVal.getValue());</span>
<span class="nc" id="L285">				}</span>

<span class="nc bnc" id="L287" title="All 2 branches missed.">				if (!sameValues) {</span>
<span class="nc" id="L288">					pairedValue.add(new StringsPair(MULTI_VALUE_DATA, MULTI_VALUE_DATA));</span>
<span class="nc" id="L289">					node.add(HtmlUtil.makeSelectInput(QUEUE_ATTRIB_VALUE_FUNCTION + obj.getID(), MULTI_VALUE_DATA, pairedValue));</span>
<span class="nc bnc" id="L290" title="All 2 branches missed.">				} else if (dropDownLookup.containsKey(obj.getID())) {</span>
<span class="nc" id="L291">					node.add(HtmlUtil.makeSelectInput(QUEUE_ATTRIB_VALUE_FUNCTION + obj.getID(),</span>
<span class="nc" id="L292">							dropDownLookup.get(obj.getID()).getValue().toString(), pairedValue));</span>
				} else {
<span class="nc" id="L294">					node.add(HtmlUtil.makeSelectInput(QUEUE_ATTRIB_VALUE_FUNCTION + obj.getID(), &quot;&quot;, pairedValue));</span>
				}
			}

<span class="nc" id="L298">			node.add(HtmlUtil.makeHiddenInput(ATTRIB_ID, obj.getID().toString()));</span>
<span class="nc" id="L299">			node.add(HtmlUtil.makeHiddenInput(ATTRIB_TYPE_ID + obj.getID(), obj.getType().toString()));</span>
<span class="nc" id="L300">			node.add(HtmlUtil.makeHiddenInput(MULTIVALUE_ID + obj.getID(), Boolean.toString(sameValues)));</span>
<span class="nc" id="L301">			tableRows.add(node);</span>
<span class="nc" id="L302">		}</span>
<span class="nc" id="L303">		attributesHolder.setColumnOneClickable(false);</span>
<span class="nc" id="L304">		attributesHolder.setRowSelectable(false);</span>
<span class="nc" id="L305">		attributesHolder.setListModel(tableRows);</span>
<span class="nc" id="L306">	}</span>


	private boolean checkForSameAttribValue(ID attributeID) {
<span class="nc" id="L310">		ID[] queueIDs = getPerformActionOnIDs();</span>
<span class="nc" id="L311">		String value = &quot;*(*(*_INVALID_VALUE_*(*(*&quot;;</span>
<span class="nc bnc" id="L312" title="All 2 branches missed.">		if (lookupValues.containsKey(queueIDs[0] + UNDERSCORE + attributeID))</span>
<span class="nc" id="L313">			value = lookupValues.get(queueIDs[0] + UNDERSCORE + attributeID);</span>
<span class="nc bnc" id="L314" title="All 2 branches missed.">		for (int x = 1; x &lt; queueIDs.length; x++) {</span>

<span class="nc bnc" id="L316" title="All 4 branches missed.">			if (value.equals(&quot;*(*(*_INVALID_VALUE_*(*(*&quot;) &amp;&amp; !lookupValues.containsKey(queueIDs[x] + UNDERSCORE + attributeID)) {</span>
				//First queue did not have any value and this queue also do not have any value for this attribute. So the
				//value is unique.
<span class="nc" id="L319">				continue;</span>
			}

<span class="nc bnc" id="L322" title="All 2 branches missed.">			if (!value.equals(lookupValues.get(queueIDs[x] + UNDERSCORE + attributeID))) {</span>
<span class="nc" id="L323">				return false;</span>
			}
		}

<span class="nc" id="L327">		return true;</span>
	}


	/**
	 * Initialize Toolbar
	 */
	protected void initToolbar() {
<span class="nc" id="L335">		m_toolbar.addValidateSubmitTextButton(QUEUE_ATTRIBUTE_SAVE, i18n(m_common_bundle, UIFWebBundleKey.TOOLBAR_SAVE), true);</span>

<span class="nc" id="L337">		ToolbarUtil.addConfirmDoneBtn(m_toolbar, true);</span>
<span class="nc" id="L338">	}</span>


	/**
	 * Return the form title
	 *
	 * @return form title
	 */
	public String getFormTitle() {
<span class="nc bnc" id="L347" title="All 2 branches missed.">		if (isNew()) {</span>
<span class="nc" id="L348">			return i18n(m_bbmBundle, &quot;Create Queue Attribute Definition - Non Localized&quot;);</span>
		} else {
<span class="nc" id="L350">			return &quot;Edit Queue Attribute Definition - Non Localized&quot;;</span>
		}
	}


	/**
	 * Get entity name. Used for title.
	 */
	protected String getTitleEntityType() {
<span class="nc" id="L359">		return i18n(m_bbmBundle, BbmWebBundleKey.ORG_EMPLOYEETYPE_CONTENT_TITLE);</span>
	}

	/**
	 * Returns an entity name. Used for title.
	 */
	protected String getEntityName() {
<span class="nc" id="L366">		return &quot;Sankar - Entity Name&quot;;</span>
	}

	public String getRequiredHTML() {
<span class="nc" id="L370">		StringBuilder reqHtml = new StringBuilder(&quot;&quot;);</span>
<span class="nc" id="L371">		reqHtml.append(super.getRequiredHTML());</span>
<span class="nc" id="L372">		reqHtml.append(HtmlUtil.makeHiddenInput(QUEUE_ATTRIB_ID, queueAttribute.getID()));</span>

<span class="nc" id="L374">		return reqHtml.toString();</span>
	}

	/**
	 * Return URL for HTML Form Action
	 */
	public String getFormAction() {
<span class="nc" id="L381">		return &quot;queue_attribute&quot;;</span>
	}


	void saveAttributePairValues(HttpServletRequest request) throws Exception {
		try {
<span class="nc" id="L387">			String[] idValues = request.getParameterValues(ATTRIB_ID);</span>
<span class="nc" id="L388">			String[] typeIDs = request.getParameterValues(ATTRIB_TYPE_ID);</span>
<span class="nc" id="L389">			String[] queues = request.getParameterValues(&quot;QUEUE_LIST_VALUES&quot;);</span>

<span class="nc" id="L391">			ID[] queueIDs = getPerformActionOnIDs();</span>

<span class="nc" id="L393">			String pattern = m_context.getLocalizer().getDateInputFormat();</span>
<span class="nc" id="L394">			SimpleDateFormat format = new SimpleDateFormat(pattern, m_context.getLocalizer().getLocaleContext().getRegionalFormatLocale());</span>

			ID queueID;
<span class="nc" id="L397">			ArrayList&lt;QueueAttributePairDateValue&gt; dateValues = new ArrayList&lt;QueueAttributePairDateValue&gt;();</span>
<span class="nc" id="L398">			ArrayList&lt;QueueAttributePairNumericValue&gt; numericValues = new ArrayList&lt;QueueAttributePairNumericValue&gt;();</span>
<span class="nc" id="L399">			ArrayList&lt;QueueAttributePairDropDownValue&gt; ddValues = new ArrayList&lt;QueueAttributePairDropDownValue&gt;();</span>
<span class="nc" id="L400">			ArrayList&lt;QueueAttributePairTextValue&gt; textValues = new ArrayList&lt;QueueAttributePairTextValue&gt;();</span>

<span class="nc" id="L402">			Collection&lt;ID&gt; queueIDS = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L403" title="All 2 branches missed.">			for (int x = 0; x &lt; queueIDs.length; x++) {</span>
<span class="nc" id="L404">				queueIDS.add(new ID(queueIDs[x]));</span>
			}

<span class="nc" id="L407">			Collection&lt;ID&gt; retainAttributeValues = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L408" title="All 2 branches missed.">			for (int x = 0; x &lt; idValues.length; x++) {</span>
<span class="nc" id="L409">				Iterator&lt;ID&gt; iter = queueIDS.iterator();</span>
<span class="nc bnc" id="L410" title="All 2 branches missed.">				while (iter.hasNext()) {</span>
<span class="nc" id="L411">					queueID = iter.next();</span>
<span class="nc" id="L412">					String userValue = request.getParameter(QUEUE_ATTRIB_VALUE_FUNCTION + idValues[x]);</span>

<span class="nc" id="L414">					ID typeID = new ID(request.getParameter(ATTRIB_TYPE_ID + idValues[x]));</span>
<span class="nc" id="L415">					boolean sameValue = Boolean.parseBoolean(request.getParameter(MULTIVALUE_ID + idValues[x]));</span>

<span class="nc bnc" id="L417" title="All 2 branches missed.">					if (StringUtil.isEmptyOrWhiteSpace(userValue)) {</span>
<span class="nc" id="L418">						break;</span>
					}

<span class="nc bnc" id="L421" title="All 4 branches missed.">					if (!sameValue &amp;&amp; MULTI_VALUE_DATA.equals(userValue)) {</span>
<span class="nc" id="L422">						retainAttributeValues.add(new ID(idValues[x]));</span>
<span class="nc" id="L423">						break;</span>
					}

<span class="nc bnc" id="L426" title="All 4 branches missed.">					if (typeID.equals(QueueAttributeType.TYPE_DROPDOWN) &amp;&amp; userValue.equals(&quot;-1&quot;)) {</span>
<span class="nc" id="L427">						break;</span>
					}

<span class="nc bnc" id="L430" title="All 2 branches missed.">					if (typeID.equals(QueueAttributeType.TYPE_DATE)) {</span>
<span class="nc" id="L431">						QueueAttributePairDateValue value = new QueueAttributePairDateValue();</span>
<span class="nc" id="L432">						value.setQueueAttributeID(new ID(idValues[x]));</span>
<span class="nc" id="L433">						value.setQueueID(queueID);</span>
<span class="nc" id="L434">						value.setValue(format.parse(userValue));</span>
<span class="nc" id="L435">						dateValues.add(value);</span>
<span class="nc bnc" id="L436" title="All 2 branches missed.">					} else if (typeID.equals(QueueAttributeType.TYPE_DROPDOWN)) {</span>
						//System.out.println(&quot;Setting Drop Down Values&quot;);
<span class="nc" id="L438">						QueueAttributePairDropDownValue value = new QueueAttributePairDropDownValue();</span>
<span class="nc" id="L439">						value.setQueueAttributeID(new ID(idValues[x]));</span>
<span class="nc" id="L440">						value.setQueueID(queueID);</span>
<span class="nc" id="L441">						value.setValue(new ID(userValue));</span>
<span class="nc" id="L442">						ddValues.add(value);</span>
<span class="nc bnc" id="L443" title="All 2 branches missed.">					} else if (typeID.equals(QueueAttributeType.TYPE_NUMERIC)) {</span>
<span class="nc" id="L444">						QueueAttributePairNumericValue value = new QueueAttributePairNumericValue();</span>
<span class="nc" id="L445">						value.setQueueAttributeID(new ID(idValues[x]));</span>
<span class="nc" id="L446">						value.setQueueID(queueID);</span>

<span class="nc" id="L448">						value.setValue(FormInputPC.convertLocalizedRealNumber(userValue, m_context.getLocalizer()));</span>
<span class="nc bnc" id="L449" title="All 4 branches missed.">						if (value.getValue() &lt; -1000000 || value.getValue() &gt; 1000000) {</span>
<span class="nc" id="L450">							throw new NumberFormatException();</span>
						}
<span class="nc" id="L452">						numericValues.add(value);</span>
<span class="nc" id="L453">					} else {</span>
<span class="nc" id="L454">						QueueAttributePairTextValue value = new QueueAttributePairTextValue();</span>
<span class="nc" id="L455">						value.setQueueAttributeID(new ID(idValues[x]));</span>
<span class="nc" id="L456">						value.setQueueID(queueID);</span>
<span class="nc" id="L457">						value.setValue(userValue);</span>
<span class="nc" id="L458">						textValues.add(value);</span>
					}
<span class="nc" id="L460">				}</span>
			}

			//First delete all the values and create new values. This is to remove any values
			//whose selection has been removed by the user
<span class="nc" id="L465">			modelHandler.deleteQueueAttributePairValues(m_context, queueIDS, retainAttributeValues);</span>

<span class="nc bnc" id="L467" title="All 2 branches missed.">			if (ddValues.size() &gt; 0) {</span>
<span class="nc" id="L468">				modelHandler.createDropDownValuePair(m_context, ddValues);</span>
			}
<span class="nc bnc" id="L470" title="All 2 branches missed.">			if (textValues.size() &gt; 0) {</span>
<span class="nc" id="L471">				modelHandler.createTextValuePair(m_context, textValues);</span>
			}
<span class="nc bnc" id="L473" title="All 2 branches missed.">			if (dateValues.size() &gt; 0)</span>
<span class="nc" id="L474">				modelHandler.createDateValuePair(m_context, dateValues);</span>

<span class="nc bnc" id="L476" title="All 2 branches missed.">			if (numericValues.size() &gt; 0)</span>
<span class="nc" id="L477">				modelHandler.createNumericValuePair(m_context, numericValues);</span>

<span class="nc" id="L479">		} catch (NumberFormatException e) {</span>
<span class="nc" id="L480">			e.printStackTrace();</span>
<span class="nc" id="L481">			throw e;</span>
<span class="nc" id="L482">		} catch (Exception e) {</span>
<span class="nc" id="L483">			handleUnableToUpdateInfo(log, e);</span>
<span class="nc" id="L484">			e.printStackTrace();</span>
<span class="nc" id="L485">			throw e;</span>
<span class="nc" id="L486">		}</span>
<span class="nc" id="L487">	}</span>

	private void setLowerAndUpperLimit(DatePickerPC m_dateRangePicker) {
<span class="nc" id="L490">		Calendar calendar = Calendar.getInstance();</span>
<span class="nc" id="L491">		calendar.set(1970, Calendar.JANUARY, 1, 0, 0, 0);</span>
<span class="nc" id="L492">		calendar.set(2078, Calendar.DECEMBER, 31, 0, 0, 0);</span>
<span class="nc" id="L493">		Date dateUpper = calendar.getTime();</span>
<span class="nc" id="L494">		m_dateRangePicker.setUpperLimit(dateUpper);</span>
<span class="nc" id="L495">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>