<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>ValidationRulePC.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.rm.setup.validation</a> &gt; <span class="el_source">ValidationRulePC.java</span></div><h1>ValidationRulePC.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.rm.setup.validation;

import java.util.ArrayList;
import java.util.Collection;
import java.util.Collections;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.ResourceBundle;

import javax.servlet.http.HttpServletRequest;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.StringsPair;
import com.bluepumpkin.common.util.StringUtil;
import com.bluepumpkin.ejb.bbm.workresource.model.Organization;
import com.bluepumpkin.ejb.rm.requests.flextime.validation.FlexRequestMustOccurASAPValidationRule;
import com.bluepumpkin.ejb.rm.requests.flextime.validation.FlexTimeComplyFilingRulesValidationRule;
import com.bluepumpkin.ejb.rm.requests.flextime.validation.FlexTimeMustAvoidSchedCalEventsValidationRule;
import com.bluepumpkin.ejb.rm.requests.flextime.validation.MakeupTimeComplyWithHOOValidationRule;
import com.bluepumpkin.ejb.rm.requests.flextime.validation.MaxNumberMakeupPerRequestValidationRule;
import com.bluepumpkin.ejb.rm.requests.flextime.validation.MaxNumberRequestsPerPeriodValidationRule;
import com.bluepumpkin.ejb.rm.requests.flextime.validation.MaxShiftDurationOfFlexRequestPerDayRule;
import com.bluepumpkin.ejb.rm.requests.flextime.validation.MaximumFlexRequestDurationValidationRule;
import com.bluepumpkin.ejb.rm.requests.flextime.validation.MinimumFlexRequestDurationValidationRule;
import com.bluepumpkin.ejb.rm.requests.flextime.validation.MinimumGapBetweenConsecutiveShiftsValidationRule;
import com.bluepumpkin.ejb.rm.requests.swap.request.validation.MaxHoursAndMaxAlternateHoursPerDayValidationRule;
import com.bluepumpkin.ejb.rm.requests.swap.request.validation.MaxNumberApprovedPartialSwapsPerShiftValidationRule;
import com.bluepumpkin.ejb.rm.requests.swap.request.validation.MaxNumberApprovedSwapPerShiftValidationRule;
import com.bluepumpkin.ejb.rm.requests.swap.request.validation.MaxNumberOneWaySwapPerPersonPeriodValidationRule;
import com.bluepumpkin.ejb.rm.requests.swap.request.validation.PSSMaxAllowableOverlap;
import com.bluepumpkin.ejb.rm.requests.swap.request.validation.PSSMaxSwapDurationPerDay;
import com.bluepumpkin.ejb.rm.requests.swap.request.validation.PSSMinRemainingShiftDuration;
import com.bluepumpkin.ejb.rm.requests.swap.request.validation.PSSMinShiftSwapDuration;
import com.bluepumpkin.ejb.rm.requests.swap.request.validation.PSSNonSwappableActivites;
import com.bluepumpkin.ejb.rm.requests.swap.request.validation.PSSShiftGapConditions;
import com.bluepumpkin.ejb.rm.requests.timeoff.validation.AvoidCalendarEventsValidationRule;
import com.bluepumpkin.ejb.rm.requests.timeoff.validation.MaximumRequestDurationValidationRule;
import com.bluepumpkin.ejb.rm.requests.timeoff.validation.MinimumRequestDurationValidationRule;
import com.bluepumpkin.ejb.rm.setup.validation.model.ValidationRule;
import com.bluepumpkin.ejb.rm.util.LicenseUtil;
import com.bluepumpkin.web.rm.l10n.RmWebBundleKey;
import com.bluepumpkin.web.rm.setup.RmSetupUtil;
import com.bluepumpkin.web.rm.validation.ValidationResources;
import com.bluepumpkin.web.rm.validation.ValidationRulesMap;
import com.witness.web.uif.pagecomponent.CompositePC;
import com.witness.web.uif.pagecomponent.DefaultMultiColumnNodeData;
import com.witness.web.uif.pagecomponent.PageComponent;
import com.witness.web.uif.pagecomponent.list.MultiColListPC;
import com.witness.web.uif.pagecomponent.table.DefaultHeaderData;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.util.HtmlUtil;
import com.witness.web.uif.util.html.HtmlChoiceInput;
import com.witness.web.uif.util.js.JSUtil;
import com.witness.web.uif.util.reflection.ParameterUtil;

/**
 * Title:        ValidationRulePC
 * Description:  Includes collapsible section of the form with
 *               a) TimeOff validation rule
 *               b) Shift Swap validation rule
 * Copyright:    Copyright (c) 2002
 * Company:      Blue Pumpkin Software, Inc
 * @author       Howard Mullings
 * @version      1.0
 */

public class ValidationRulePC extends CompositePC {
    private final ResourceBundle rmBundle;

    private final ValidationRulesMap m_vrMap;

    private static final String PC_KEY = &quot;validation_rule_pc&quot;;
<span class="fc" id="L74">    private final String m_headerCssClass = &quot;tableHeaderLightLeft&quot;;</span>
    private static final String VALIDATIONBYTYPE_FN = &quot;VALIDATIONBYTYPE_FN&quot;;
    private static final String VTO_MIN_SURPLUS_DURATION_VALUE = &quot;VTO_MIN_SURPLUS_DURATION_VALUE&quot;;

	private Map&lt;String, ValidationRule&gt; validationRules;

    private Map m_ancestors; //maps each inheritted key to the ancestor orgName from which it was inheritted
    private ID m_orgID; //the ID of the currently selected organization

    private static final int SHIFT_SWAP = 1;
    private static final int TIME_OFF = 2;
    private static final int SHIFT_BID = 3;
    private static final int TIME_OFF_WITHDRAW = 4;
    private static final int CUSTOM_SHIFT = 5;
    private static final int FLEX_TIME = 6;
	private static final int SHIFT_SWAP_WITHDRAW = 7;
	private static final String DEFAULT_PARAM_VALUE = &quot;-1&quot;;


    private MultiColListPC approvedTOWithdrawValidationRule;
    private MultiColListPC flexTimeValidationRule;
    private MultiColListPC ssValidationRule;
	private MultiColListPC approvedSSWithdrawValidationRule;
    private MultiColListPC sbValidationRule;
    private MultiColListPC csValidationRule;
	private final TimeOffValidationRulePC toValidationRule;
	private transient ActivityDropdownCreator activityDDCreator;



    private final ValidationPageModel pageModel;

<span class="fc" id="L106">    private final HtmlChoiceInput htmlChoiceInput = new HtmlChoiceInput();</span>
<span class="fc" id="L107">    private final List&lt;PageComponent&gt; m_containerList = new ArrayList&lt;PageComponent&gt;(5);</span>

	public ValidationRulePC(RequestContext context, ValidationPageModel aPageModel) {
<span class="fc" id="L110">		super(context);</span>
<span class="fc" id="L111">		pageModel =  aPageModel;</span>
<span class="fc" id="L112">		rmBundle = m_localizer.getBundle(RmWebBundleKey.BUNDLE_NAME);</span>
<span class="fc" id="L113">		m_vrMap = ValidationRulesMap.getInstance();</span>
<span class="fc" id="L114">		toValidationRule = new TimeOffValidationRulePC(m_context, pageModel, rmBundle);</span>
<span class="fc" id="L115">		addChildContainer(toValidationRule);</span>
<span class="fc" id="L116">		setName(PC_KEY);</span>
<span class="fc" id="L117">	}</span>


	@Override
	public void initForDisplay() {

<span class="pc bpc" id="L123" title="1 of 2 branches missed.">		if (m_orgID == null) {</span>
			//m_orgID is null means that ValidationPageModel.createFormModel did not finish successfully.
<span class="nc" id="L125">			return;</span>
		}

		try {

<span class="fc" id="L130">			initTimeOffValidationRule();</span>
<span class="fc" id="L131">			initApprovedTimeOffWithdrawValidationRule();</span>

<span class="pc bpc" id="L133" title="1 of 2 branches missed.">			if (pageModel.isAuthorizedToConfigureFLexValidationRule()) {</span>
<span class="nc" id="L134">				initFlexTimeValidationRule();</span>
			}

<span class="fc" id="L137">			initShiftSwapValidationRule();</span>
<span class="pc bpc" id="L138" title="1 of 2 branches missed.">		if(pageModel.isAuthorizedToConfigureSSApprovedWithdrawal()) {</span>
<span class="nc" id="L139">			initApprovedShiftSwapWithdrawValidationRule();</span>
		}
<span class="fc" id="L141">			initShiftBidValidationRule();</span>
<span class="fc" id="L142">			initCustomShiftValidationRule();</span>
<span class="nc" id="L143">		} catch (Exception ex) {</span>
<span class="nc" id="L144">			handleUnableToLoadDataError(log, ex);</span>
<span class="fc" id="L145">		}</span>

<span class="fc" id="L147">	}</span>

    public void setRules(Map rules) {
<span class="fc" id="L150">    	validationRules = rules;</span>
<span class="fc" id="L151">    }</span>

	public Map getRules() {
<span class="nc" id="L154">		return validationRules;</span>
	}


    public void setAncestors(Map ancestors) {
<span class="fc" id="L159">        m_ancestors = ancestors;</span>
<span class="fc" id="L160">    }</span>

    public Map getAncestors() {
<span class="nc" id="L163">        return m_ancestors;</span>
    }

    private void addChildContainer(PageComponent pc) {
<span class="fc" id="L167">        m_containerList.add(pc);</span>
<span class="fc" id="L168">        addChildComponent(pc);</span>
<span class="fc" id="L169">    }</span>

    public Collection getContainers() {
<span class="fc" id="L172">        return m_containerList;</span>
    }

	public void setOrgID(ID orgID) {
<span class="fc" id="L176">		m_orgID = orgID;</span>
<span class="fc" id="L177">	}</span>

	public ID getOrgID() {
<span class="nc" id="L180">		return m_orgID;</span>
	}

	private MultiColListPC createContainer(String name, String title) {
<span class="fc" id="L184">        MultiColListPC container = new MultiColListPC(m_context);</span>
<span class="fc" id="L185">		setContainerAttributes(name, title, container);</span>
<span class="fc" id="L186">		addChildContainer(container);</span>
<span class="fc" id="L187">		return container;</span>
    }

	private MultiColListPC setContainerAttributes(String name, String title, MultiColListPC container) {
		//ESR4082546
<span class="fc" id="L192">        container.disableRepeatHeader();</span>
<span class="fc" id="L193">        container.setIsToggleable(true);</span>
<span class="fc" id="L194">        container.setName(name);</span>
<span class="fc" id="L195">        container.setRowDeselectable(false);</span>
<span class="fc" id="L196">        container.setIsBorderEnabled(true);</span>
<span class="fc" id="L197">		DefaultHeaderData header = new DefaultHeaderData(&quot;c1&quot;, title, null, m_headerCssClass, false);</span>
<span class="fc" id="L198">        container.getHeader().setHeaders(Collections.singletonList(header));</span>
<span class="fc" id="L199">        return container;</span>
	}

    /**
     * Get the title for a validation rule section.
     * @param mainTitle The main part of the title.
     * @param ancestorOrgName - the name of the org (Ex: &quot;Customer Service&quot;) from which this section's
     *                   settings were inherited. Pass null if none.
     * @return The full section title, such as: &quot;Time Off (Settings override parent org)&quot; or
     *         &quot;Shift Swap (Settings inheritted from Organization: Customer Service)&quot;
     */
    private String getSectionTitle(String aMainTitle, String ancestorOrgName) {
<span class="fc" id="L211">        String mainTitle = i18n(rmBundle, aMainTitle);</span>

<span class="pc bpc" id="L213" title="2 of 4 branches missed.">        if (m_orgID.equals(Organization.ROOT_ORG_ID_OBJ) || m_orgID.equals(Organization.YOUR_COMPANY_ID_OBJ)) {</span>
<span class="nc" id="L214">			return mainTitle;</span>
		}

<span class="fc bfc" id="L217" title="All 2 branches covered.">        if (ancestorOrgName != null)</span>
        {
<span class="fc" id="L219">            Object[] args = new Object[] {ancestorOrgName};</span>
<span class="fc" id="L220">            return mainTitle + &quot; &quot; + m_localizer.i18n(rmBundle,</span>
                    RmWebBundleKey.ORG_RM_SETTINGS_INHERITED_FROM_ORG, args);  //&quot;(Settings inherited from organization:&quot;
        }
        else
        {
<span class="fc" id="L225">            return (mainTitle + &quot; &quot; +</span>
<span class="fc" id="L226">                i18n(rmBundle, RmWebBundleKey.ORG_RM_SETTINGS_OVERRIDE_PARENT_ORG)); //&quot;(Settings override parent org)&quot;</span>
        }
    }

    /**
     * Given a key, return the name of the ancestor org from which it was inheritted, or null if none.
     * You must have already set the m_ancestors variable.
     * @param key An validation rule bundle key.
     * @return The name of the ancestor org from which it was inheritted, or null if none.
     */
    private String getAncestor(String key) {
<span class="pc bpc" id="L237" title="1 of 2 branches missed.">        if (m_ancestors == null) {</span>
<span class="nc" id="L238">			return null;</span>
		}
<span class="fc" id="L240">        return (String)m_ancestors.get(key);</span>
    }



    private void initTimeOffValidationRule() {
        //all rules in each section should have same ancestor, so we only check the first rule
<span class="fc" id="L247">        String title = getSectionTitle(RmWebBundleKey.ORG_RM_VALIDATION_TO_RULE_TITLE,</span>
<span class="fc" id="L248">                getAncestor(ValidationRulesMap.VALIDATION_AVAILABLE_TO_HRS));</span>


<span class="fc" id="L251">		setContainerAttributes(&quot;timeOff&quot;, title, toValidationRule);</span>

<span class="fc" id="L253">		createCheckBoxes(toValidationRule, TIME_OFF, pageModel.isAuthorizedToConfigureTOM());</span>
<span class="fc" id="L254">    }</span>

    private void initApprovedTimeOffWithdrawValidationRule() {
        //all rules in each section should have same ancestor, so we only check the first rule
<span class="fc" id="L258">        String title = getSectionTitle(RmWebBundleKey.ORG_RM_VALIDATION_ARRROVED_TO_WITHDRAW_RULE_TITLE,</span>
<span class="fc" id="L259">                getAncestor(ValidationRulesMap.VALIDATION_APPROVED_TO_WITHDRAW_COMPLY_FILINGRULE));</span>

<span class="fc" id="L261">        approvedTOWithdrawValidationRule = createContainer(&quot;timeOffWithdraw&quot;, title);</span>
<span class="fc" id="L262">        createCheckBoxes(approvedTOWithdrawValidationRule, TIME_OFF_WITHDRAW, pageModel</span>
<span class="fc" id="L263">                .isAuthorizedToConfigureTOM());</span>
<span class="fc" id="L264">    }</span>

    private void initFlexTimeValidationRule() {
        //all rules in each section should have same ancestor, so we only check the first rule
<span class="nc" id="L268">        String title = getSectionTitle(RmWebBundleKey.FLEX_TIME_VALIDATION_TO_RULE_TITLE,</span>
<span class="nc" id="L269">                getAncestor(ValidationRulesMap.VALIDATION_FT_MAX_DURATION));</span>

<span class="nc" id="L271">        flexTimeValidationRule = createContainer(&quot;flexTime&quot;, title);</span>
<span class="nc" id="L272">        createCheckBoxes(flexTimeValidationRule, FLEX_TIME, pageModel</span>
<span class="nc" id="L273">                .isAuthorizedToConfigureFLexValidationRule());</span>
<span class="nc" id="L274">    }</span>

    private void initShiftSwapValidationRule() {
        //all rules in each section should have same ancestor, so we only check the first rule
<span class="fc" id="L278">        String title = getSectionTitle(RmWebBundleKey.ORG_RM_VALIDATION_SS_RULE_TITLE,</span>
<span class="fc" id="L279">                getAncestor(ValidationRulesMap.VALIDATION_SS_SAME_CALL_CENTER));</span>

<span class="fc" id="L281">        ssValidationRule = createContainer(&quot;shiftSwap&quot;, title);</span>
<span class="fc" id="L282">        createCheckBoxes(ssValidationRule, SHIFT_SWAP, pageModel</span>
<span class="fc" id="L283">                .isAuthorizedToConfigureSS());</span>
<span class="fc" id="L284">    }</span>


	private void initApprovedShiftSwapWithdrawValidationRule() {
		//all rules in each section should have same ancestor, so we only check the first rule
<span class="nc" id="L289">		String title = getSectionTitle(RmWebBundleKey.ORG_RM_VALIDATION_ARRROVED_SS_WITHDRAW_RULE_TITLE,</span>
<span class="nc" id="L290">				getAncestor(ValidationRulesMap.VALIDATION_APPROVED_SS_WITHDRAW_COMPLY_FILINGRULE));</span>

<span class="nc" id="L292">		approvedSSWithdrawValidationRule = createContainer(&quot;shidtSwapWithdraw&quot;, title);</span>
<span class="nc" id="L293">		createCheckBoxes(approvedSSWithdrawValidationRule, SHIFT_SWAP_WITHDRAW, pageModel</span>
<span class="nc" id="L294">				.isAuthorizedToConfigureSS());</span>
<span class="nc" id="L295">	}</span>

	private void initShiftBidValidationRule() {
        //all rules in each section should have same ancestor, so we only check the first rule
<span class="fc" id="L299">        String title = getSectionTitle(RmWebBundleKey.ORG_RM_VALIDATION_SB_RULE_TITLE,</span>
<span class="fc" id="L300">                getAncestor(ValidationRulesMap.VALIDATION_SB_COMPLY_RULES));</span>

<span class="fc" id="L302">        sbValidationRule = createContainer(&quot;shiftBid&quot;, title);</span>
<span class="fc" id="L303">        createCheckBoxes(sbValidationRule, SHIFT_BID, pageModel</span>
<span class="fc" id="L304">                .isAuthorizedToConfigureSB());</span>
<span class="fc" id="L305">    }</span>

    private void initCustomShiftValidationRule() {
        //all rules in each section should have same ancestor, so we only check the first rule
<span class="fc" id="L309">        String title = getSectionTitle(RmWebBundleKey.ORG_RM_VALIDATION_CS_RULE_TITLE,</span>
<span class="fc" id="L310">                getAncestor(ValidationRulesMap.VALIDATION_CS_FULFILLS_NET_STAFFING_SHORTAGE));</span>

<span class="fc" id="L312">        csValidationRule = createContainer(&quot;customShift&quot;, title);</span>
<span class="fc" id="L313">        createCheckBoxes(csValidationRule, CUSTOM_SHIFT, pageModel</span>
<span class="fc" id="L314">                .isAuthorizedToConfigureCS());</span>
<span class="fc" id="L315">    }</span>

	private void createCheckBoxes(MultiColListPC container, int which, boolean enabled) {
<span class="fc" id="L318">        String[] keys = getRuleKeys(which);</span>

<span class="fc" id="L320">        htmlChoiceInput.setIsValueSubmittedWhenDisabled(true);</span>
<span class="fc" id="L321">        htmlChoiceInput.setIsMultiSelect(true);</span>
<span class="pc bpc" id="L322" title="1 of 2 branches missed.">        htmlChoiceInput.setIsDisabled(!enabled);</span>
<span class="fc" id="L323">        htmlChoiceInput.setValue(&quot;true&quot;);</span>
<span class="fc" id="L324">		List&lt;DefaultMultiColumnNodeData&gt; listModel = new ArrayList&lt;DefaultMultiColumnNodeData&gt;();</span>

<span class="fc bfc" id="L326" title="All 2 branches covered.">		boolean isTimeOff = which == TIME_OFF;</span>
<span class="fc" id="L327">		Collection&lt;String&gt; timeOffRulesOnFlex = Collections.emptyList();</span>
<span class="fc" id="L328">		boolean isAtLeastOneFlexActivitySelected = false;</span>
<span class="pc bpc" id="L329" title="1 of 4 branches missed.">		if (isTimeOff &amp;&amp; LicenseUtil.isAdvancedRMLicense()) {</span>
<span class="nc" id="L330">			listModel.add(toValidationRule.createValidateByTypeDropDown(enabled));</span>
<span class="nc" id="L331">	        timeOffRulesOnFlex = toValidationRule.getApplicableTimeOffValidatorsOnFlexRequests();</span>
<span class="nc" id="L332">	        isAtLeastOneFlexActivitySelected = toValidationRule.isSelectedActivitiesHasFlexActivity();</span>
        }

<span class="fc" id="L335">		int i = 1;</span>
<span class="fc bfc" id="L336" title="All 2 branches covered.">		for (String key : keys) {</span>
<span class="fc" id="L337">            ValidationRule rule = validationRules.get(key);</span>

<span class="pc bpc" id="L339" title="1 of 2 branches missed.">			if (rule == null) {</span>
<span class="nc" id="L340">				continue;</span>
			}

<span class="fc" id="L343">            String label = getValidationRuleLabelHtml(key, rule);</span>
<span class="fc" id="L344">            htmlChoiceInput.setInputName(key);</span>

<span class="fc bfc" id="L346" title="All 2 branches covered.">			if (isParamRule(key)) {</span>
<span class="fc" id="L347">				htmlChoiceInput.setLabel(null);</span>
			} else {
<span class="fc" id="L349">				htmlChoiceInput.setLabel(label);</span>
			}

<span class="fc" id="L352">			setCheckBoxState(enabled, isTimeOff, key, rule);</span>

<span class="fc bfc" id="L354" title="All 2 branches covered.">			if(isTimeOff) {</span>
				//Only some Time Off rules are disabled for selected flex activity.
<span class="pc bpc" id="L356" title="2 of 4 branches missed.">				htmlChoiceInput.setIsDisabled(!timeOffRulesOnFlex.contains(key) &amp;&amp; isAtLeastOneFlexActivitySelected);</span>
			}

<span class="fc" id="L359">			String html = htmlChoiceInput.getHtmlDisplay();</span>

<span class="fc bfc" id="L361" title="All 2 branches covered.">            if (isParamRule(key)) {</span>
<span class="fc" id="L362">				html += &quot; &quot; + label;</span>
			}

<span class="fc" id="L365">			html = addMultiValueIndicator(rule.isPartiallyEnabled(), key, html);</span>

<span class="fc" id="L367">			DefaultMultiColumnNodeData rowData = new DefaultMultiColumnNodeData(&quot;r&quot; + i);</span>
<span class="fc" id="L368">			rowData.add(html);</span>
<span class="fc" id="L369">            listModel.add(rowData);</span>
<span class="fc" id="L370">			i++;</span>
        }
<span class="fc" id="L372">        container.setListModel(listModel);</span>
<span class="fc" id="L373">    }</span>

	private static String addMultiValueIndicator(boolean isMultiValued, String key, String html) {
<span class="pc bpc" id="L376" title="1 of 2 branches missed.">		return String.format(&quot;&lt;span id='multivalueindicator-%s' style='display:inline-block; min-width:6px;'&gt;%s&lt;/span&gt;%s&quot;,</span>
				key, isMultiValued ? MULTI_VALUE_DATA : &quot;&quot;, html);
	}

	private void setCheckBoxState(boolean enabled, boolean isTimeOff, String key, ValidationRule rule) {
<span class="fc" id="L381">		boolean isChecked = rule.isEnabled();</span>

<span class="fc" id="L383">		htmlChoiceInput.setIsChecked(isChecked);</span>
<span class="pc bpc" id="L384" title="1 of 2 branches missed.">		if (!enabled) {</span>
<span class="nc" id="L385">			String value = String.valueOf(isChecked);</span>
<span class="nc" id="L386">		    htmlChoiceInput.setValue(value);</span>
		}

<span class="pc bpc" id="L389" title="1 of 4 branches missed.">		if (isTimeOff &amp;&amp; rule.isPartiallyEnabled()) {</span>
<span class="nc" id="L390">			this.toValidationRule.addMultiValuedRuleKey(key);</span>
		}
<span class="fc" id="L392">	}</span>

	private String getValidationRuleLabelHtml(String key, ValidationRule rule) {
<span class="fc" id="L395">		ValidationResources vResource = m_vrMap.getValResource(key);</span>
<span class="pc bpc" id="L396" title="1 of 2 branches missed.">		String message = vResource!=null? vResource.getMessage(m_localizer): &quot;&quot;;</span>
<span class="fc bfc" id="L397" title="All 2 branches covered.">		if (isParamRule(key)) {</span>
<span class="fc" id="L398">			message = getRuleString(key, rule, vResource);</span>
		}

<span class="pc bpc" id="L401" title="1 of 2 branches missed.">		return vResource != null ? HtmlUtil.imageTag(vResource.getIconPath(m_localizer)) + &quot; &quot; + message : &quot;&quot;;</span>
	}

	private String[] getRuleKeys(int which) {
		String[] keys;
<span class="fc" id="L406">        boolean hasAdvancedLicense = LicenseUtil.isAdvancedRMLicense();</span>
<span class="pc bpc" id="L407" title="2 of 7 branches missed.">        switch (which) {</span>
	        case SHIFT_SWAP:
<span class="fc" id="L409">	            keys = RmSetupUtil.getShiftSwapKeys(hasAdvancedLicense);</span>
<span class="fc" id="L410">	            break;</span>

	        case SHIFT_SWAP_WITHDRAW:
	        	//Adding License check for pulling shift swap withdraw validation key
<span class="nc" id="L414">	        	keys = RmSetupUtil.getShiftSwapWithdrawlKeys(hasAdvancedLicense);</span>
<span class="nc" id="L415">			break;</span>

	        case TIME_OFF:
<span class="fc" id="L418">	            keys = RmSetupUtil.getTimeOffKeys(hasAdvancedLicense);</span>
<span class="fc" id="L419">	            break;</span>

	        case TIME_OFF_WITHDRAW:
<span class="fc" id="L422">	            keys = RmSetupUtil.getTimeOffWithdrawKeys();</span>
<span class="fc" id="L423">	            break;</span>

	        case FLEX_TIME:
<span class="nc" id="L426">	        	keys = RmSetupUtil.getFlexTimeKeys();</span>
<span class="nc" id="L427">	            break;</span>

	        case SHIFT_BID:
<span class="fc" id="L430">	            keys = RmSetupUtil.getShiftBidKeys();</span>
<span class="fc" id="L431">	            break;</span>

	        case CUSTOM_SHIFT:
	        default:
<span class="fc" id="L435">	            keys = RmSetupUtil.getCustomShiftKeys();</span>
	            break;
        }
<span class="fc" id="L438">		return keys;</span>
	}

	private boolean isParamRule(String key) {
<span class="fc" id="L442">		return RmSetupUtil.isParamRule(key);</span>
	}

	private String getRuleString(String key, ValidationRule rule, ValidationResources vResource) {
<span class="fc" id="L446">        String ruleStr = null;</span>
<span class="fc bfc" id="L447" title="All 2 branches covered.">        if (key.equals(ValidationRulesMap.VALIDATION_PSS_MIN_SHIFT_SWAP_DURATION)) {</span>
<span class="fc" id="L448">            Map paramMap = rule.getParamMap();</span>
<span class="fc" id="L449">            ruleStr = vResource.getMessage(m_localizer, new Object[] {</span>
<span class="fc" id="L450">                    createTextBox(PSSMinShiftSwapDuration.MIN_DURATION_VALUE,</span>
<span class="fc" id="L451">                            getParamValueStr(String.valueOf(paramMap.get(PSSMinShiftSwapDuration.MIN_DURATION_VALUE)))),</span>
<span class="fc" id="L452">                    createUnitTypeDD(PSSMinShiftSwapDuration.MIN_DURATION_UNIT,</span>
<span class="fc" id="L453">                            getParamValueStr(String.valueOf(paramMap.get(PSSMinShiftSwapDuration.MIN_DURATION_UNIT))))});</span>
<span class="fc bfc" id="L454" title="All 2 branches covered.">        } else if (key.equals(ValidationRulesMap.VALIDATION_PSS_MIN_REMAINING_SHIFT_DURATION)) {</span>
<span class="fc" id="L455">            Map paramMap = rule.getParamMap();</span>
<span class="fc" id="L456">            ruleStr = vResource</span>
<span class="fc" id="L457">                    .getMessage(m_localizer, new Object[] {</span>
<span class="fc" id="L458">                            createTextBox(PSSMinRemainingShiftDuration.MIN_SHIFT_DURATION_VALUE,</span>
<span class="fc" id="L459">                                    getParamValueStr(String.valueOf(paramMap</span>
<span class="fc" id="L460">                                            .get(PSSMinRemainingShiftDuration.MIN_SHIFT_DURATION_VALUE)))),</span>
<span class="fc" id="L461">                            createUnitTypeDD(PSSMinRemainingShiftDuration.MIN_SHIFT_DURATION_UNIT,</span>
<span class="fc" id="L462">                                    getParamValueStr(String.valueOf(paramMap</span>
<span class="fc" id="L463">                                            .get(PSSMinRemainingShiftDuration.MIN_SHIFT_DURATION_UNIT))))});</span>
<span class="fc bfc" id="L464" title="All 2 branches covered.">        } else if (key.equals(ValidationRulesMap.VALIDATION_PSS_MAX_SWAP_DURATION_PER_DAY)) {</span>
<span class="fc" id="L465">            Map paramMap = rule.getParamMap();</span>
<span class="fc" id="L466">            ruleStr = vResource.getMessage(m_localizer,</span>
<span class="fc" id="L467">                    new Object[] { createTextBox(PSSMaxSwapDurationPerDay.MAX_SHIFT_DURATION_VALUE,</span>
<span class="fc" id="L468">                            getParamValueStr(String.valueOf(paramMap</span>
<span class="fc" id="L469">                                    .get(PSSMaxSwapDurationPerDay.MAX_SHIFT_DURATION_VALUE)))),</span>
<span class="fc" id="L470">                                    createDayTypeDD(PSSMaxSwapDurationPerDay.MAX_SHIFT_DURATION_UNIT, String.valueOf(paramMap</span>
<span class="fc" id="L471">                                            .get(PSSMaxSwapDurationPerDay.MAX_SHIFT_DURATION_UNIT)))});</span>
<span class="fc bfc" id="L472" title="All 2 branches covered.">        } else if (key.equals(ValidationRulesMap.VALIDATION_PSS_NON_SWAPPABLE_ACTIVITIES)) {</span>
<span class="fc" id="L473">            Map paramMap = rule.getParamMap();</span>
<span class="fc" id="L474">            ruleStr = vResource.getMessage(m_localizer,</span>
<span class="fc" id="L475">                    new Object[] { createActivityDD(PSSNonSwappableActivites.ACTIVITY, paramMap, true, true, false) });</span>
<span class="fc bfc" id="L476" title="All 2 branches covered.">        } else if (key.equals(ValidationRulesMap.VALIDATION_PSS_SHIFT_GAP_CONDITIONS)) {</span>
<span class="fc" id="L477">            Map paramMap = rule.getParamMap();</span>
<span class="fc" id="L478">            ruleStr = vResource.getMessage(m_localizer,</span>
                    new Object[] {
<span class="fc" id="L480">                            createTextBox(PSSShiftGapConditions.RANGE_MIN_DURATION_VALUE,</span>
<span class="fc" id="L481">                                    getParamValueStr(String.valueOf(paramMap</span>
<span class="fc" id="L482">                                            .get(PSSShiftGapConditions.RANGE_MIN_DURATION_VALUE)))),</span>
<span class="fc" id="L483">                            createTextBox(PSSShiftGapConditions.RANGE_MAX_DURATION_VALUE,</span>
<span class="fc" id="L484">                                    getParamValueStr(String.valueOf(paramMap</span>
<span class="fc" id="L485">                                            .get(PSSShiftGapConditions.RANGE_MAX_DURATION_VALUE)))),</span>
<span class="fc" id="L486">                            createTextBox(PSSShiftGapConditions.MIN_GAP_DURATION_VALUE,</span>
<span class="fc" id="L487">                                    getParamValueStr(String.valueOf(paramMap</span>
<span class="fc" id="L488">                                            .get(PSSShiftGapConditions.MIN_GAP_DURATION_VALUE))))});</span>
<span class="fc bfc" id="L489" title="All 2 branches covered.">        } else if (key.equals(ValidationRulesMap.VALIDATION_PSS_MAX_ALLOWABLE_OVERLAP)) {</span>
<span class="fc" id="L490">            Map paramMap = rule.getParamMap();</span>
<span class="fc" id="L491">            ruleStr = vResource.getMessage(m_localizer,</span>
<span class="fc" id="L492">                    new Object[] { createTextBox(PSSMaxAllowableOverlap.MAX_OVERLAP_VALUE,</span>
<span class="fc" id="L493">                            getParamValueStr(String.valueOf(paramMap</span>
<span class="fc" id="L494">                                    .get(PSSMaxAllowableOverlap.MAX_OVERLAP_VALUE))))});</span>
<span class="pc bpc" id="L495" title="1 of 2 branches missed.">        } else if (key.equals(ValidationRulesMap.VALIDATION_PSS_MAX_APPROVED_PARTIAL_SWAPS_PER_SHIFT)) {</span>
<span class="nc" id="L496">	        Map paramMap = rule.getParamMap();</span>
<span class="nc" id="L497">	        ruleStr = vResource</span>
<span class="nc" id="L498">            .getMessage(m_localizer, new Object[] {</span>
<span class="nc" id="L499">                    createTextBox(MaxNumberApprovedPartialSwapsPerShiftValidationRule.MAX_APPROVED_PARTIAL_SWAPS_PER_SHIFT,</span>
<span class="nc" id="L500">                           getParamValueStr(String.valueOf(paramMap</span>
<span class="nc" id="L501">                                    .get(MaxNumberApprovedPartialSwapsPerShiftValidationRule.MAX_APPROVED_PARTIAL_SWAPS_PER_SHIFT))))});</span>
<span class="pc bfc" id="L502" title="All 2 branches covered.">	    } else if (key.equals(ValidationRulesMap.VALIDATION_REQ_MIN_DURATION)) {</span>
<span class="fc" id="L503">			ruleStr = getMinimumRequestDurationRuleString(rule, vResource);</span>
<span class="fc bfc" id="L504" title="All 2 branches covered.">        } else if (key.equals(ValidationRulesMap.VALIDATION_REQ_MAX_DURATION)) {</span>
<span class="fc" id="L505">            ruleStr = getMaximumRequestDurationRuleString(rule, vResource);</span>
<span class="fc bfc" id="L506" title="All 2 branches covered.">        } else if (key.equals(ValidationRulesMap.VALIDATION_AVOID_CAL_EVENTS)) {</span>
<span class="fc" id="L507">			ruleStr = getAvoidCalendarEventsRuleString(rule, vResource);</span>
<span class="fc bfc" id="L508" title="All 2 branches covered.">        } else if (key.equals(ValidationRulesMap.VALIDATION_CS_MAX_SHIFT_DURATION_PER_DAY)) {</span>
<span class="fc" id="L509">	        Map paramMap = rule.getParamMap();</span>
<span class="fc" id="L510">	        ruleStr = vResource.getMessage(m_localizer,</span>
<span class="fc" id="L511">	                new Object[] { createTextBox(&quot;CS_MAX_SHIFT_DURATION_VALUE&quot;,</span>
<span class="fc" id="L512">	                        getParamValueStr(String.valueOf(paramMap</span>
<span class="fc" id="L513">	                                .get(&quot;CS_MAX_SHIFT_DURATION_VALUE&quot;)))),</span>
<span class="fc" id="L514">	                                createCSDayTypeDD(&quot;CS_MAX_SHIFT_DURATION_UNIT&quot;, String.valueOf(paramMap</span>
<span class="fc" id="L515">	                                        .get(&quot;CS_MAX_SHIFT_DURATION_UNIT&quot;)))});</span>

<span class="fc bfc" id="L517" title="All 2 branches covered.">        } else if (key.equals(ValidationRulesMap.VALIDATION_CS_MIN_SHIFT_DURATION_PER_DAY)) {</span>
<span class="fc" id="L518">	        Map paramMap = rule.getParamMap();</span>
<span class="fc" id="L519">	        ruleStr = vResource.getMessage(m_localizer,</span>
<span class="fc" id="L520">	                new Object[] { createTextBox(&quot;CS_MIN_SHIFT_DURATION_VALUE&quot;,</span>
<span class="fc" id="L521">	                        getParamValueStr(String.valueOf(paramMap</span>
<span class="fc" id="L522">	                                .get(&quot;CS_MIN_SHIFT_DURATION_VALUE&quot;)))),</span>
<span class="fc" id="L523">	                                createCSDayTypeDD(&quot;CS_MIN_SHIFT_DURATION_UNIT&quot;, String.valueOf(paramMap</span>
<span class="fc" id="L524">	                                        .get(&quot;CS_MIN_SHIFT_DURATION_UNIT&quot;)))});</span>

<span class="fc bfc" id="L526" title="All 2 branches covered.">        } else if (key.equals(ValidationRulesMap.VALIDATION_CS_FULFILLS_NET_STAFFING_SHORTAGE)) {</span>
<span class="fc" id="L527">	        Map paramMap = rule.getParamMap();</span>
<span class="fc" id="L528">	        ruleStr = vResource.getMessage(m_localizer,</span>
<span class="fc" id="L529">	                new Object[] { createTextBox(&quot;CS_MIN_SHORTAGE_DURATION_VALUE&quot;,</span>
<span class="fc" id="L530">	                        getParamValueStr(String.valueOf(paramMap</span>
<span class="fc" id="L531">	                                .get(&quot;CS_MIN_SHORTAGE_DURATION_VALUE&quot;)))) });</span>

<span class="pc bpc" id="L533" title="1 of 2 branches missed.">        } else if (key.equals(ValidationRulesMap.VALIDATION_VTO_REDUCE_NET_STAFFING_SURPLUS)) {</span>
<span class="fc" id="L534">	        ruleStr = getMinimumDurationNetStaffingSurplusRuleString(rule, vResource);</span>
<span class="nc bnc" id="L535" title="All 2 branches missed.">	    } else if (key.equals(ValidationRulesMap.VALIDATION_FT_MAX_DURATION)) {</span>
<span class="nc" id="L536">	        Map paramMap = rule.getParamMap();</span>
<span class="nc" id="L537">	        ruleStr = vResource</span>
<span class="nc" id="L538">	                .getMessage(m_localizer, new Object[] {</span>
<span class="nc" id="L539">	                        createTextBox(MaximumFlexRequestDurationValidationRule.MAX_FLEX_REQUEST_DURATION_VALUE,</span>
<span class="nc" id="L540">	                               getParamValueStr(String.valueOf(paramMap</span>
<span class="nc" id="L541">	                                        .get(MaximumFlexRequestDurationValidationRule.MAX_FLEX_REQUEST_DURATION_VALUE)))),</span>
<span class="nc" id="L542">	                        createDurationUnitTypeMinutesAndHours(MaximumFlexRequestDurationValidationRule.MAX_FLEX_REQUEST_DURATION_UNIT,</span>
<span class="nc" id="L543">	                                getParamValueStr(String.valueOf(paramMap</span>
<span class="nc" id="L544">	                                        .get(MaximumFlexRequestDurationValidationRule.MAX_FLEX_REQUEST_DURATION_UNIT))))});</span>
<span class="nc bnc" id="L545" title="All 2 branches missed.">	    } else if (key.equals(ValidationRulesMap.VALIDATION_FT_MIN_DURATION)) {</span>
<span class="nc" id="L546">	        Map paramMap = rule.getParamMap();</span>
<span class="nc" id="L547">	        ruleStr = vResource</span>
<span class="nc" id="L548">	                .getMessage(m_localizer, new Object[] {</span>
<span class="nc" id="L549">	                        createTextBox(MinimumFlexRequestDurationValidationRule.MIN_FLEX_REQUEST_DURATION_VALUE,</span>
<span class="nc" id="L550">	                               getParamValueStr(String.valueOf(paramMap</span>
<span class="nc" id="L551">	                                        .get(MinimumFlexRequestDurationValidationRule.MIN_FLEX_REQUEST_DURATION_VALUE)))),</span>
<span class="nc" id="L552">	                        createDurationUnitTypeMinutesAndHours(MinimumFlexRequestDurationValidationRule.MIN_FLEX_REQUEST_DURATION_UNIT,</span>
<span class="nc" id="L553">	                                getParamValueStr(String.valueOf(paramMap</span>
<span class="nc" id="L554">	                                        .get(MinimumFlexRequestDurationValidationRule.MIN_FLEX_REQUEST_DURATION_UNIT))))});</span>
<span class="nc bnc" id="L555" title="All 2 branches missed.">	    } else if (key.equals(ValidationRulesMap.VALIDATION_FT_MAX_NUMBER_FLEX_REQ_PER_PERIOD)) {</span>
<span class="nc" id="L556">	        Map paramMap = rule.getParamMap();</span>
<span class="nc" id="L557">	        ruleStr = vResource</span>
<span class="nc" id="L558">	                .getMessage(m_localizer, new Object[] {</span>
<span class="nc" id="L559">	                        createTextBox(MaxNumberRequestsPerPeriodValidationRule.MAX_FLEX_MAKEUP_PER_PERIOD,</span>
<span class="nc" id="L560">	                               getParamValueStr(String.valueOf(paramMap</span>
<span class="nc" id="L561">	                                        .get(MaxNumberRequestsPerPeriodValidationRule.MAX_FLEX_MAKEUP_PER_PERIOD)))),</span>
<span class="nc" id="L562">	                        createUnitTypeMonthAndQuater(MaxNumberRequestsPerPeriodValidationRule.MAX_FLEX_MAKEUP_PER_PERIOD_UNIT,</span>
<span class="nc" id="L563">	                                getParamValueStr(String.valueOf(paramMap</span>
<span class="nc" id="L564">	                                        .get(MaxNumberRequestsPerPeriodValidationRule.MAX_FLEX_MAKEUP_PER_PERIOD_UNIT))))</span>
	                        });
<span class="nc bnc" id="L566" title="All 2 branches missed.">	    } else if (key.equals(ValidationRulesMap.VALIDATION_FT_AVOID_SCHEDULED_CALENDAR_EVENTS)) {</span>
<span class="nc" id="L567">	        Map paramMap = rule.getParamMap();</span>
<span class="nc" id="L568">	        ruleStr = vResource</span>
<span class="nc" id="L569">	                .getMessage(m_localizer, new Object[] {</span>
<span class="nc" id="L570">	                		createActivityDD(FlexTimeMustAvoidSchedCalEventsValidationRule.FLEX_TIME_MUST_AVOID_SCHED_CALENDAR_EVENTS, paramMap, false, false, true)});</span>
<span class="nc bnc" id="L571" title="All 2 branches missed.">        } else if (key.equals(ValidationRulesMap.VALIDATION_FT_MUST_OCCUR_ASAP)) {</span>
<span class="nc" id="L572">	        Map paramMap = rule.getParamMap();</span>
<span class="nc" id="L573">	        ruleStr = vResource.getMessage(m_localizer,</span>
<span class="nc" id="L574">	                new Object[] { createTextBox(FlexRequestMustOccurASAPValidationRule.MUST_OCCUR_ASAP_MAX_DAYS,</span>
<span class="nc" id="L575">	                        getParamValueStr(String.valueOf(paramMap</span>
<span class="nc" id="L576">	                                .get(FlexRequestMustOccurASAPValidationRule.MUST_OCCUR_ASAP_MAX_DAYS)))) });</span>

<span class="nc bnc" id="L578" title="All 2 branches missed.">	    } else if (key.equals(ValidationRulesMap.VALIDATION_FT_MAX_NUMBER_MAKEUP_PER_REQUEST)) {</span>
<span class="nc" id="L579">	        Map paramMap = rule.getParamMap();</span>
<span class="nc" id="L580">	        ruleStr = vResource</span>
<span class="nc" id="L581">	                .getMessage(m_localizer, new Object[] {</span>
<span class="nc" id="L582">	                        createTextBox(MaxNumberMakeupPerRequestValidationRule.MAX_FLEX_MAKEUP_PER_REQUEST,</span>
<span class="nc" id="L583">	                               getParamValueStr(String.valueOf(paramMap</span>
<span class="nc" id="L584">	                                        .get(MaxNumberMakeupPerRequestValidationRule.MAX_FLEX_MAKEUP_PER_REQUEST))))});</span>
<span class="nc bnc" id="L585" title="All 2 branches missed.">		} else if (key.equals(ValidationRulesMap.VALIDATION_FT_MAX_SHIFT_DURATION)) {</span>

<span class="nc" id="L587">			Map paramMap = rule.getParamMap();</span>
<span class="nc" id="L588">			ruleStr = vResource.getMessage(m_localizer, new Object[] {</span>
<span class="nc" id="L589">					createTextBox(</span>
							MaxShiftDurationOfFlexRequestPerDayRule.FT_MAX_SHIFT_DURATION_VALUE,
<span class="nc" id="L591">							getParamValueStr(String.valueOf(paramMap</span>
<span class="nc" id="L592">									.get(MaxShiftDurationOfFlexRequestPerDayRule.FT_MAX_SHIFT_DURATION_VALUE)))),</span>
<span class="nc" id="L593">					createDayTypeDD(MaxShiftDurationOfFlexRequestPerDayRule.FT_MAX_SHIFT_DURATION_UNIT,</span>
<span class="nc" id="L594">							getParamValueStr(String.valueOf(paramMap</span>
<span class="nc" id="L595">									.get(MaxShiftDurationOfFlexRequestPerDayRule.FT_MAX_SHIFT_DURATION_UNIT)))) });</span>

<span class="nc bnc" id="L597" title="All 2 branches missed.">	    } else if (key.equals(ValidationRulesMap.VALIDATION_SS_MAX_ONE_WAY_SWAP_PER_PERSON_PERIOD)) {</span>
<span class="nc" id="L598">	        Map paramMap = rule.getParamMap();</span>
<span class="nc" id="L599">	        ruleStr = vResource</span>
<span class="nc" id="L600">	                .getMessage(m_localizer, new Object[] {</span>
<span class="nc" id="L601">	                        createTextBox(MaxNumberOneWaySwapPerPersonPeriodValidationRule.MAX_ONE_WAY_SWAP_PER_PERSON_PERIOD,</span>
<span class="nc" id="L602">	                               getParamValueStr(String.valueOf(paramMap</span>
<span class="nc" id="L603">	                                        .get(MaxNumberOneWaySwapPerPersonPeriodValidationRule.MAX_ONE_WAY_SWAP_PER_PERSON_PERIOD)))),</span>
<span class="nc" id="L604">	                        createUnitTypeMonthAndQuater(MaxNumberOneWaySwapPerPersonPeriodValidationRule.MAX_ONE_WAY_SWAP_PER_PERSON_PERIOD_UNIT,</span>
<span class="nc" id="L605">	                                getParamValueStr(String.valueOf(paramMap</span>
<span class="nc" id="L606">	                                        .get(MaxNumberOneWaySwapPerPersonPeriodValidationRule.MAX_ONE_WAY_SWAP_PER_PERSON_PERIOD_UNIT))))</span>
	                        });
<span class="nc bnc" id="L608" title="All 2 branches missed.">	    } else if (key.equals(ValidationRulesMap.VALIDATION_SS_MAX_APPROVED_SWAP_PER_SHIFT)) {</span>
<span class="nc" id="L609">	        Map paramMap = rule.getParamMap();</span>
<span class="nc" id="L610">	        ruleStr = vResource</span>
<span class="nc" id="L611">	                .getMessage(m_localizer, new Object[] {</span>
<span class="nc" id="L612">	                        createTextBox(MaxNumberApprovedSwapPerShiftValidationRule.MAX_APPROVED_SWAP_PER_SHIFT,</span>
<span class="nc" id="L613">	                               getParamValueStr(String.valueOf(paramMap</span>
<span class="nc" id="L614">	                                        .get(MaxNumberApprovedSwapPerShiftValidationRule.MAX_APPROVED_SWAP_PER_SHIFT))))});</span>
<span class="nc bnc" id="L615" title="All 2 branches missed.">	    } else if (key.equals(ValidationRulesMap.VALIDATION_SS_MAX_HOURS_ALTERNATE_MAX_HOURS_PER_DAY)) {</span>
<span class="nc" id="L616">	        Map paramMap = rule.getParamMap();</span>
<span class="nc" id="L617">	        ruleStr = vResource</span>
<span class="nc" id="L618">	                .getMessage(m_localizer, new Object[] {</span>
<span class="nc" id="L619">	                        createTextBox(MaxHoursAndMaxAlternateHoursPerDayValidationRule.MAX_HOURS_PER_DAY,</span>
<span class="nc" id="L620">	                               getParamValueStr(String.valueOf(paramMap</span>
<span class="nc" id="L621">	                                        .get(MaxHoursAndMaxAlternateHoursPerDayValidationRule.MAX_HOURS_PER_DAY)))),</span>
<span class="nc" id="L622">                            createTextBox(MaxHoursAndMaxAlternateHoursPerDayValidationRule.MAX_ALTERNATIVE_HOURS_PER_DAY,</span>
<span class="nc" id="L623"> 	                               getParamValueStr(String.valueOf(paramMap</span>
<span class="nc" id="L624"> 	                                        .get(MaxHoursAndMaxAlternateHoursPerDayValidationRule.MAX_ALTERNATIVE_HOURS_PER_DAY))))</span>
	                });
	    }

<span class="fc" id="L628">        return ruleStr;</span>
    }


	private String getMinimumDurationNetStaffingSurplusRuleString(ValidationRule rule, ValidationResources vResource) {
<span class="fc" id="L633">		return vResource.getMessage(m_localizer, createTextBox(rule, VTO_MIN_SURPLUS_DURATION_VALUE));</span>
	}

	private String getMaximumRequestDurationRuleString(ValidationRule rule, ValidationResources vResource) {
<span class="fc" id="L637">		return vResource.getMessage(m_localizer,</span>
<span class="fc" id="L638">				createTextBox(rule, MaximumRequestDurationValidationRule.MAX_REQUEST_DURATION_VALUE),</span>
<span class="fc" id="L639">				createDurationUnitTypeDD(rule, MaximumRequestDurationValidationRule.MAX_REQUEST_DURATION_UNIT));</span>
	}

	private String getMinimumRequestDurationRuleString(ValidationRule rule, ValidationResources vResource) {
<span class="fc" id="L643">		return vResource.getMessage(m_localizer,</span>
<span class="fc" id="L644">						createTextBox(rule, MinimumRequestDurationValidationRule.MIN_REQUEST_DURATION_VALUE),</span>
<span class="fc" id="L645">						createDurationUnitTypeDD(rule, MinimumRequestDurationValidationRule.MIN_REQUEST_DURATION_UNIT));</span>
	}

	private String getAvoidCalendarEventsRuleString(ValidationRule rule, ValidationResources vResource) {
<span class="fc" id="L649">		Map paramMap = rule.getParamMap();</span>
<span class="fc" id="L650">		boolean isSelectionMulitValued = rule.isAnyParamValuesMultipleValue();</span>
<span class="fc" id="L651">		String activityDDHtml = createActivityDD(AvoidCalendarEventsValidationRule.CALENDAR_EVENT_ACTIVITY, paramMap, false, false, true,</span>
				isSelectionMulitValued);
<span class="fc" id="L653">		return vResource.getMessage(m_localizer, activityDDHtml);</span>
	}

	protected String createUnitTypeDD(String key, String value) {
<span class="fc" id="L657">        ArrayList&lt;StringsPair&gt; options = new ArrayList&lt;StringsPair&gt;(2);</span>
<span class="fc" id="L658">        options.add(new StringsPair(String.valueOf(PSSMinRemainingShiftDuration.DURATION_UNIT_PERCENT), i18n(rmBundle, RmWebBundleKey.VALIDATION_PERCENT)));</span>
<span class="fc" id="L659">        options.add(new StringsPair(String.valueOf(PSSMinRemainingShiftDuration.DURATION_UNIT_MINUTES), i18n(rmBundle, RmWebBundleKey.VALIDATION_MINUTES)));</span>
<span class="fc" id="L660">        return HtmlUtil.makeSelectInput(key, value, JSUtil.ON_CHANGE, options);</span>
    }

	protected String createTextBox(ValidationRule rule, String key) {
<span class="fc" id="L664">		String value = getAdjustedValue(rule, key);</span>
<span class="fc" id="L665">		return createTextBox(key, value);</span>
	}

	protected String createDurationUnitTypeDD(ValidationRule rule, String key) {
<span class="fc" id="L669">		String value = getAdjustedValue(rule, key);</span>
<span class="fc" id="L670">		return createDurationUnitTypeDD(key, value);</span>
	}

	protected String getAdjustedValue(ValidationRule rule, String key) {
<span class="fc" id="L674">		Map paramMap = rule.getParamMap();</span>
<span class="fc" id="L675">		boolean isMultiValue = rule.isParamValueMultipleValue(key);</span>
<span class="pc bpc" id="L676" title="1 of 2 branches missed.">		return isMultiValue ? MULTI_VALUE_DATA : getParamValueStr(String.valueOf(paramMap.get(key)));</span>
	}


    protected String createDurationUnitTypeDD(String key, String value) {
<span class="fc" id="L681">    	ArrayList&lt;StringsPair&gt; options = new ArrayList&lt;StringsPair&gt;(2);</span>
<span class="fc" id="L682">        options.add(new StringsPair(&quot;0&quot;, i18n(RmWebBundleKey.VALIDATION_MINUTES)));</span>
<span class="fc" id="L683">        options.add(new StringsPair(&quot;1&quot;, i18n(RmWebBundleKey.VALIDATION_HOURS)));</span>
<span class="fc" id="L684">        options.add(new StringsPair(&quot;2&quot;, i18n(RmWebBundleKey.VALIDATION_DAYS)));</span>
<span class="fc" id="L685">		return makeSelectedInputMultiValue(key, value, options);</span>
    }

    protected String createDurationUnitTypeMinutesAndHours(String key, String value) {
<span class="nc" id="L689">    	ArrayList&lt;StringsPair&gt; options = new ArrayList&lt;StringsPair&gt;(2);</span>
<span class="nc" id="L690">        options.add(new StringsPair(&quot;0&quot;, i18n(RmWebBundleKey.VALIDATION_MINUTES)));</span>
<span class="nc" id="L691">        options.add(new StringsPair(&quot;1&quot;, i18n(RmWebBundleKey.VALIDATION_HOURS)));</span>
<span class="nc" id="L692">        return HtmlUtil.makeSelectInput(key, value, JSUtil.ON_CHANGE, options);</span>
    }

    protected String createUnitTypeMonthAndQuater(String key, String value) {
<span class="nc" id="L696">    	ArrayList&lt;StringsPair&gt; options = new ArrayList&lt;StringsPair&gt;(2);</span>
<span class="nc" id="L697">        options.add(new StringsPair(&quot;0&quot;, i18n(RmWebBundleKey.VALIDATION_MONTH)));</span>
<span class="nc" id="L698">        options.add(new StringsPair(&quot;1&quot;, i18n(RmWebBundleKey.VALIDATION_QUARTER)));</span>
<span class="nc" id="L699">        return HtmlUtil.makeSelectInput(key, value, JSUtil.ON_CHANGE, options);</span>
    }

    protected String createDayTypeDD(String key, String value) {
<span class="fc" id="L703">    	ArrayList&lt;StringsPair&gt; options = new ArrayList&lt;StringsPair&gt;(2);</span>
<span class="fc" id="L704">        options.add(new StringsPair(String.valueOf(PSSMaxSwapDurationPerDay.MAX_SHIFT_DURATION_UNIT_ORGHOO), i18n(RmWebBundleKey.VALIDATION_ORG_DAY)));</span>
<span class="fc" id="L705">        options.add(new StringsPair(String.valueOf(PSSMaxSwapDurationPerDay.MAX_SHIFT_DURATION_UNIT_24HOURS), i18n(RmWebBundleKey.VALIDATION_24_HR_PERIOD)));</span>
<span class="fc" id="L706">        return HtmlUtil.makeSelectInput(key, value, JSUtil.ON_CHANGE, options);</span>
    }

    /**
     * Create the day type drop down for the Custom Shift rules
     * @param key
     * @param value
     * @return
     */
    protected String createCSDayTypeDD(String key, String value) {
<span class="fc" id="L716">    	ArrayList&lt;StringsPair&gt; options = new ArrayList&lt;StringsPair&gt;(2);</span>
<span class="fc" id="L717">        options.add(new StringsPair(String.valueOf(PSSMaxSwapDurationPerDay.MAX_SHIFT_DURATION_UNIT_ORGHOO), i18n(RmWebBundleKey.VALIDATION_ORG_DAY)));</span>
<span class="fc" id="L718">        options.add(new StringsPair(String.valueOf(PSSMaxSwapDurationPerDay.MAX_SHIFT_DURATION_UNIT_24HOURS), i18n(RmWebBundleKey.VALIDATION_24_HR_PERIOD)));</span>
<span class="fc" id="L719">        return HtmlUtil.makeSelectInput(key, value, JSUtil.ON_CHANGE, options);</span>
    }

	private static String makeSelectedInputMultiValue(String key, String value, List&lt;StringsPair&gt; options) {
<span class="pc bpc" id="L723" title="1 of 2 branches missed.">		if (MULTI_VALUE_DATA.equalsIgnoreCase(value)) {</span>
<span class="nc" id="L724">			options.add(0, new StringsPair(MULTI_VALUE_DATA, MULTI_VALUE_DATA));</span>
		}
<span class="fc" id="L726">		return HtmlUtil.makeSelectInput(key, value, JSUtil.ON_CHANGE, options);</span>
	}

    protected String createTextBox(String key, String value) {
<span class="fc" id="L730">        return HtmlUtil.makeTextInput(key, 10, 10, value);</span>
    }

	protected String createActivityDD(String key, Map map, boolean usedInShift, boolean includeNone, boolean includeAll) {
<span class="fc" id="L734">		return createActivityDD(key, map, usedInShift, includeNone, includeAll, false);</span>
	}

	protected String createActivityDD(String key, Map map, boolean usedInShift, boolean includeNone, boolean includeAll,
			boolean selctionIsMultiValued) {
<span class="fc bfc" id="L739" title="All 2 branches covered.">		if (activityDDCreator == null) {</span>
<span class="fc" id="L740">			activityDDCreator = new ActivityDropdownCreator(getLocalizer(), rmBundle);</span>
<span class="fc" id="L741">			activityDDCreator.intialize(pageModel.getSelectedID(), m_context);</span>
		}
<span class="fc" id="L743">		return activityDDCreator.getHtml(key, map.values(), usedInShift, includeNone, includeAll, selctionIsMultiValued);</span>
	}


    @Override
	public boolean extractParameters(HttpServletRequest request) {
<span class="fc" id="L749">        boolean success = super.extractParameters(request);</span>

<span class="fc" id="L751">		toValidationRule.extractActivityIDs(request);</span>

<span class="fc bfc" id="L753" title="All 2 branches covered.">		if (validationRules != null) {</span>
<span class="fc bfc" id="L754" title="All 2 branches covered.">			for (Map.Entry&lt;String, ValidationRule&gt; entry : validationRules.entrySet()) {</span>

<span class="fc" id="L756">				ValidationRule rule = entry.getValue();</span>
<span class="fc" id="L757">				String key = entry.getKey();</span>

<span class="fc" id="L759">				String checked = request.getParameter(key);</span>
<span class="fc bfc" id="L760" title="All 2 branches covered.">				int enabledState = &quot;true&quot;.equals(checked) ? ValidationRule.VALIDATION_ENABLED : ValidationRule.VALIDATION_NOT_ENABLED;</span>

<span class="pc bpc" id="L762" title="1 of 2 branches missed.">				if (toValidationRule.isKeyMulitValued(key)) {</span>
<span class="nc" id="L763">					enabledState = ValidationRule.VALIDATION_PARTIALLY_ENABLED;</span>
				}

<span class="fc" id="L766">				rule.setEnabledState(enabledState);</span>

<span class="fc bfc" id="L768" title="All 2 branches covered.">				if (isParamRule(key)) {</span>
<span class="fc" id="L769">					rule = extractParamMap(key, rule, request);</span>
				}

<span class="fc" id="L772">				entry.setValue(rule);</span>
<span class="fc" id="L773">			}</span>

		}
<span class="fc" id="L776">		return success;</span>
	}

	private boolean extractFlexTimeParamMap(HttpServletRequest request, String key, ValidationRule rule, Map paramMap) {
<span class="fc bfc" id="L780" title="All 2 branches covered.">		if (key.equals(ValidationRulesMap.VALIDATION_FT_MAX_DURATION)) {</span>
<span class="fc" id="L781">			paramMap.put(MaximumFlexRequestDurationValidationRule.MAX_FLEX_REQUEST_DURATION_VALUE,</span>
<span class="fc" id="L782">					getParamValue(request.getParameter(MaximumFlexRequestDurationValidationRule.MAX_FLEX_REQUEST_DURATION_VALUE)));</span>
<span class="fc" id="L783">			paramMap.put(MaximumFlexRequestDurationValidationRule.MAX_FLEX_REQUEST_DURATION_UNIT,</span>
<span class="fc" id="L784">					getParamValue(request.getParameter(MaximumFlexRequestDurationValidationRule.MAX_FLEX_REQUEST_DURATION_UNIT)));</span>
<span class="fc bfc" id="L785" title="All 2 branches covered.">		} else if (key.equals(ValidationRulesMap.VALIDATION_FT_MIN_DURATION)) {</span>
<span class="fc" id="L786">			paramMap.put(MinimumFlexRequestDurationValidationRule.MIN_FLEX_REQUEST_DURATION_VALUE,</span>
<span class="fc" id="L787">					getParamValue(request.getParameter(MinimumFlexRequestDurationValidationRule.MIN_FLEX_REQUEST_DURATION_VALUE)));</span>
<span class="fc" id="L788">			paramMap.put(MinimumFlexRequestDurationValidationRule.MIN_FLEX_REQUEST_DURATION_UNIT,</span>
<span class="fc" id="L789">					getParamValue(request.getParameter(MinimumFlexRequestDurationValidationRule.MIN_FLEX_REQUEST_DURATION_UNIT)));</span>
<span class="fc bfc" id="L790" title="All 2 branches covered.">		} else if (key.equals(ValidationRulesMap.VALIDATION_FT_MAX_NUMBER_FLEX_REQ_PER_PERIOD)) {</span>
<span class="fc" id="L791">			paramMap.put(MaxNumberRequestsPerPeriodValidationRule.MAX_FLEX_MAKEUP_PER_PERIOD,</span>
<span class="fc" id="L792">					getParamValue(request.getParameter(MaxNumberRequestsPerPeriodValidationRule.MAX_FLEX_MAKEUP_PER_PERIOD)));</span>
<span class="fc" id="L793">			paramMap.put(MaxNumberRequestsPerPeriodValidationRule.MAX_FLEX_MAKEUP_PER_PERIOD_UNIT,</span>
<span class="fc" id="L794">					getParamValue(request.getParameter(MaxNumberRequestsPerPeriodValidationRule.MAX_FLEX_MAKEUP_PER_PERIOD_UNIT)));</span>
<span class="fc bfc" id="L795" title="All 2 branches covered.">		} else if (key.equals(ValidationRulesMap.VALIDATION_FT_MAX_NUMBER_MAKEUP_PER_REQUEST)) {</span>
<span class="fc" id="L796">			paramMap.put(MaxNumberMakeupPerRequestValidationRule.MAX_FLEX_MAKEUP_PER_REQUEST,</span>
<span class="fc" id="L797">					getParamValue(request.getParameter(MaxNumberMakeupPerRequestValidationRule.MAX_FLEX_MAKEUP_PER_REQUEST)));</span>
<span class="fc bfc" id="L798" title="All 2 branches covered.">		} else if (key.equals(ValidationRulesMap.VALIDATION_FT_AVOID_SCHEDULED_CALENDAR_EVENTS)) {</span>

<span class="fc" id="L800">			String activities[] = ParameterUtil.getParameters(request,</span>
					FlexTimeMustAvoidSchedCalEventsValidationRule.FLEX_TIME_MUST_AVOID_SCHED_CALENDAR_EVENTS);
<span class="pc bpc" id="L802" title="1 of 2 branches missed.">			if (activities != null) {</span>
<span class="nc bnc" id="L803" title="All 2 branches missed.">				for (int i = 0; i &lt; activities.length; i++) {</span>
<span class="nc" id="L804">					paramMap.put(FlexTimeMustAvoidSchedCalEventsValidationRule.FLEX_TIME_MUST_AVOID_SCHED_CALENDAR_EVENTS + i, new ID(activities[i]));</span>
				}
			}
<span class="fc bfc" id="L807" title="All 2 branches covered.">		} else if (key.equals(ValidationRulesMap.VALIDATION_FT_MUST_OCCUR_ASAP)){</span>
<span class="fc" id="L808">			paramMap.put(FlexRequestMustOccurASAPValidationRule.MUST_OCCUR_ASAP_MAX_DAYS,</span>
<span class="fc" id="L809">					getParamValue(request.getParameter(FlexRequestMustOccurASAPValidationRule.MUST_OCCUR_ASAP_MAX_DAYS)));</span>
<span class="pc bpc" id="L810" title="1 of 2 branches missed.">		} else if (key.equals(ValidationRulesMap.VALIDATION_FT_COMPLYING_FILING_RULES)){</span>
<span class="nc" id="L811">			paramMap.put(FlexTimeComplyFilingRulesValidationRule.FLEX_TIME_COMPLY_FILING_RULES,</span>
<span class="nc" id="L812">					getParamValue(request.getParameter(FlexTimeComplyFilingRulesValidationRule.FLEX_TIME_COMPLY_FILING_RULES)));</span>
<span class="pc bpc" id="L813" title="1 of 2 branches missed.">		} else if (key.equals(ValidationRulesMap.VALIDATION_FT_MAKEUP_COMPLYING_HOO)){</span>
<span class="nc" id="L814">			paramMap.put(MakeupTimeComplyWithHOOValidationRule.MAKEUP_TIME_COMPLY_HOO,</span>
<span class="nc" id="L815">					getParamValue(request.getParameter(MakeupTimeComplyWithHOOValidationRule.MAKEUP_TIME_COMPLY_HOO)));</span>
<span class="pc bpc" id="L816" title="1 of 2 branches missed.">		} else if (key.equals(ValidationRulesMap.VALIDATION_FT_MIN_GAP_BETWEEN_CONSECUTIVE_SHIFTS)){</span>
<span class="nc" id="L817">			paramMap.put(MinimumGapBetweenConsecutiveShiftsValidationRule.MIN_GAP_BETWEEN_CONSECUTIVE_SHIFTS,</span>
<span class="nc" id="L818">					getParamValue(request.getParameter(</span>
							MinimumGapBetweenConsecutiveShiftsValidationRule.MIN_GAP_BETWEEN_CONSECUTIVE_SHIFTS)));
<span class="fc bfc" id="L820" title="All 2 branches covered.">		} else if (key.equals(ValidationRulesMap.VALIDATION_FT_MAX_SHIFT_DURATION)) {</span>
<span class="fc" id="L821">			paramMap.put(MaxShiftDurationOfFlexRequestPerDayRule.FT_MAX_SHIFT_DURATION_VALUE, getParamValue(</span>
<span class="fc" id="L822">					request.getParameter(MaxShiftDurationOfFlexRequestPerDayRule.FT_MAX_SHIFT_DURATION_VALUE)));</span>
<span class="fc" id="L823">			paramMap.put(MaxShiftDurationOfFlexRequestPerDayRule.FT_MAX_SHIFT_DURATION_UNIT, getParamValue(</span>
<span class="fc" id="L824">					request.getParameter(MaxShiftDurationOfFlexRequestPerDayRule.FT_MAX_SHIFT_DURATION_UNIT)));</span>
		} else {
<span class="fc" id="L826">			return false;</span>
		}
<span class="fc" id="L828">		return true;</span>
	}

    private ValidationRule extractParamMap(String key, ValidationRule rule,
            HttpServletRequest request) {
<span class="fc" id="L833">        HashMap paramMap = new HashMap(2);</span>
<span class="fc" id="L834">		rule.setParamMap(paramMap);</span>

<span class="fc bfc" id="L836" title="All 2 branches covered.">		if (extractFlexTimeParamMap(request, key, rule, paramMap)) {</span>
<span class="fc" id="L837">			return rule;</span>
		}

<span class="fc bfc" id="L840" title="All 2 branches covered.">        if (key.equals(ValidationRulesMap.VALIDATION_PSS_MIN_SHIFT_SWAP_DURATION)) {</span>
<span class="fc" id="L841">            paramMap.put(PSSMinShiftSwapDuration.MIN_DURATION_VALUE,</span>
<span class="fc" id="L842">                    getParamValue(request.getParameter(PSSMinShiftSwapDuration.MIN_DURATION_VALUE)));</span>
<span class="fc" id="L843">            paramMap.put(PSSMinShiftSwapDuration.MIN_DURATION_UNIT,</span>
<span class="fc" id="L844">                    getParamValue(request.getParameter(PSSMinShiftSwapDuration.MIN_DURATION_UNIT)));</span>
<span class="fc bfc" id="L845" title="All 2 branches covered.">        } else if (key.equals(ValidationRulesMap.VALIDATION_PSS_MIN_REMAINING_SHIFT_DURATION)) {</span>
<span class="fc" id="L846">            paramMap.put(PSSMinRemainingShiftDuration.MIN_SHIFT_DURATION_VALUE,</span>
<span class="fc" id="L847">                    getParamValue(request.getParameter(PSSMinRemainingShiftDuration.MIN_SHIFT_DURATION_VALUE)));</span>
<span class="fc" id="L848">            paramMap.put(PSSMinRemainingShiftDuration.MIN_SHIFT_DURATION_UNIT,</span>
<span class="fc" id="L849">                    getParamValue(request.getParameter(PSSMinRemainingShiftDuration.MIN_SHIFT_DURATION_UNIT)));</span>
<span class="fc bfc" id="L850" title="All 2 branches covered.">        } else if (key.equals(ValidationRulesMap.VALIDATION_PSS_MAX_SWAP_DURATION_PER_DAY)){</span>
<span class="fc" id="L851">            paramMap.put(PSSMaxSwapDurationPerDay.MAX_SHIFT_DURATION_VALUE,</span>
<span class="fc" id="L852">                    getParamValue(request.getParameter(PSSMaxSwapDurationPerDay.MAX_SHIFT_DURATION_VALUE)));</span>
<span class="fc" id="L853">            paramMap.put(PSSMaxSwapDurationPerDay.MAX_SHIFT_DURATION_UNIT,</span>
<span class="fc" id="L854">                    getParamValue(request.getParameter(PSSMaxSwapDurationPerDay.MAX_SHIFT_DURATION_UNIT)));</span>
<span class="fc bfc" id="L855" title="All 2 branches covered.">        } else if (key.equals(ValidationRulesMap.VALIDATION_PSS_NON_SWAPPABLE_ACTIVITIES)) {</span>
<span class="fc" id="L856">            String activities[] = ParameterUtil.getParameters(request,</span>
                    PSSNonSwappableActivites.ACTIVITY);
<span class="pc bpc" id="L858" title="1 of 2 branches missed.">            if (activities != null) {</span>
<span class="fc bfc" id="L859" title="All 2 branches covered.">                for (int i = 0; i &lt; activities.length; i++) {</span>
<span class="fc" id="L860">					paramMap.put(PSSNonSwappableActivites.ACTIVITY + i, new ID(activities[i]));</span>
				}

            }
<span class="fc bfc" id="L864" title="All 2 branches covered.">        } else if (key.equals(ValidationRulesMap.VALIDATION_PSS_SHIFT_GAP_CONDITIONS)) {</span>
<span class="fc" id="L865">            paramMap.put(PSSShiftGapConditions.RANGE_MIN_DURATION_VALUE,</span>
<span class="fc" id="L866">                    getParamValue(request.getParameter(PSSShiftGapConditions.RANGE_MIN_DURATION_VALUE)));</span>
<span class="fc" id="L867">            paramMap.put(PSSShiftGapConditions.RANGE_MAX_DURATION_VALUE,</span>
<span class="fc" id="L868">                    getParamValue(request.getParameter(PSSShiftGapConditions.RANGE_MAX_DURATION_VALUE)));</span>
<span class="fc" id="L869">            paramMap.put(PSSShiftGapConditions.MIN_GAP_DURATION_VALUE,</span>
<span class="fc" id="L870">                    getParamValue(request.getParameter(PSSShiftGapConditions.MIN_GAP_DURATION_VALUE)));</span>
<span class="fc bfc" id="L871" title="All 2 branches covered.">        } else if (key.equals(ValidationRulesMap.VALIDATION_PSS_MAX_ALLOWABLE_OVERLAP)){</span>
<span class="fc" id="L872">            paramMap.put(PSSMaxAllowableOverlap.MAX_OVERLAP_VALUE,</span>
<span class="fc" id="L873">                    getParamValue(request.getParameter(PSSMaxAllowableOverlap.MAX_OVERLAP_VALUE)));</span>
<span class="fc bfc" id="L874" title="All 2 branches covered.">        } else if (key.equals(ValidationRulesMap.VALIDATION_PSS_MAX_APPROVED_PARTIAL_SWAPS_PER_SHIFT)) {</span>
<span class="fc" id="L875">            paramMap.put(MaxNumberApprovedPartialSwapsPerShiftValidationRule.MAX_APPROVED_PARTIAL_SWAPS_PER_SHIFT,</span>
<span class="fc" id="L876">                    getParamValue(request.getParameter(MaxNumberApprovedPartialSwapsPerShiftValidationRule.MAX_APPROVED_PARTIAL_SWAPS_PER_SHIFT)));</span>
<span class="fc bfc" id="L877" title="All 2 branches covered.">        } else if (key.equals(ValidationRulesMap.VALIDATION_REQ_MIN_DURATION)){</span>
<span class="fc" id="L878">            paramMap.put(MinimumRequestDurationValidationRule.MIN_REQUEST_DURATION_VALUE,</span>
<span class="fc" id="L879">                    getParamValue(request.getParameter(MinimumRequestDurationValidationRule.MIN_REQUEST_DURATION_VALUE)));</span>
<span class="fc" id="L880">            paramMap.put(MinimumRequestDurationValidationRule.MIN_REQUEST_DURATION_UNIT,</span>
<span class="fc" id="L881">                    getParamValue(request.getParameter(MinimumRequestDurationValidationRule.MIN_REQUEST_DURATION_UNIT)));</span>
<span class="fc bfc" id="L882" title="All 2 branches covered.">        } else if (key.equals(ValidationRulesMap.VALIDATION_REQ_MAX_DURATION)){</span>
<span class="fc" id="L883">            paramMap.put(MaximumRequestDurationValidationRule.MAX_REQUEST_DURATION_VALUE,</span>
<span class="fc" id="L884">                    getParamValue(request.getParameter(MaximumRequestDurationValidationRule.MAX_REQUEST_DURATION_VALUE)));</span>
<span class="fc" id="L885">            paramMap.put(MaximumRequestDurationValidationRule.MAX_REQUEST_DURATION_UNIT,</span>
<span class="fc" id="L886">                    getParamValue(request.getParameter(MaximumRequestDurationValidationRule.MAX_REQUEST_DURATION_UNIT)));</span>
<span class="fc bfc" id="L887" title="All 2 branches covered.">        } else if (key.equals(ValidationRulesMap.VALIDATION_SS_MAX_ONE_WAY_SWAP_PER_PERSON_PERIOD)){</span>
<span class="fc" id="L888">            paramMap.put(MaxNumberOneWaySwapPerPersonPeriodValidationRule.MAX_ONE_WAY_SWAP_PER_PERSON_PERIOD,</span>
<span class="fc" id="L889">                    getParamValue(request.getParameter(MaxNumberOneWaySwapPerPersonPeriodValidationRule.MAX_ONE_WAY_SWAP_PER_PERSON_PERIOD)));</span>
<span class="fc" id="L890">            paramMap.put(MaxNumberOneWaySwapPerPersonPeriodValidationRule.MAX_ONE_WAY_SWAP_PER_PERSON_PERIOD_UNIT,</span>
<span class="fc" id="L891">                    getParamValue(request.getParameter(MaxNumberOneWaySwapPerPersonPeriodValidationRule.MAX_ONE_WAY_SWAP_PER_PERSON_PERIOD_UNIT)));</span>
<span class="fc bfc" id="L892" title="All 2 branches covered.">        } else if (key.equals(ValidationRulesMap.VALIDATION_SS_MAX_APPROVED_SWAP_PER_SHIFT)) {</span>
<span class="fc" id="L893">            paramMap.put(MaxNumberApprovedSwapPerShiftValidationRule.MAX_APPROVED_SWAP_PER_SHIFT,</span>
<span class="fc" id="L894">                    getParamValue(request.getParameter(MaxNumberApprovedSwapPerShiftValidationRule.MAX_APPROVED_SWAP_PER_SHIFT)));</span>
<span class="fc bfc" id="L895" title="All 2 branches covered.">        } else if (key.equals(ValidationRulesMap.VALIDATION_SS_MAX_HOURS_ALTERNATE_MAX_HOURS_PER_DAY)) {</span>
<span class="fc" id="L896">            paramMap.put(MaxHoursAndMaxAlternateHoursPerDayValidationRule.MAX_HOURS_PER_DAY,</span>
<span class="fc" id="L897">                    getParamValue(request.getParameter(MaxHoursAndMaxAlternateHoursPerDayValidationRule.MAX_HOURS_PER_DAY)));</span>
<span class="fc" id="L898">            paramMap.put(MaxHoursAndMaxAlternateHoursPerDayValidationRule.MAX_ALTERNATIVE_HOURS_PER_DAY,</span>
<span class="fc" id="L899">                    getParamValue(request.getParameter(MaxHoursAndMaxAlternateHoursPerDayValidationRule.MAX_ALTERNATIVE_HOURS_PER_DAY)));</span>
<span class="fc bfc" id="L900" title="All 2 branches covered.">        } else if (key.equals(ValidationRulesMap.VALIDATION_AVOID_CAL_EVENTS)) {</span>
<span class="fc" id="L901">            String activities[] = ParameterUtil.getParameters(request,</span>
                    AvoidCalendarEventsValidationRule.CALENDAR_EVENT_ACTIVITY);
<span class="pc bpc" id="L903" title="1 of 2 branches missed.">            if (activities != null) {</span>
<span class="fc bfc" id="L904" title="All 2 branches covered.">                for (int i = 0; i &lt; activities.length; i++) {</span>
<span class="fc" id="L905">					paramMap.put(AvoidCalendarEventsValidationRule.CALENDAR_EVENT_ACTIVITY + i, new ID(activities[i]));</span>
				}

            }
<span class="fc bfc" id="L909" title="All 2 branches covered.">        } else if (key.equals(ValidationRulesMap.VALIDATION_CS_MAX_SHIFT_DURATION_PER_DAY)) {</span>
<span class="fc" id="L910">	        paramMap.put(&quot;CS_MAX_SHIFT_DURATION_VALUE&quot;,</span>
<span class="fc" id="L911">	                getParamValue(request.getParameter(&quot;CS_MAX_SHIFT_DURATION_VALUE&quot;)));</span>
<span class="fc" id="L912">	        paramMap.put(&quot;CS_MAX_SHIFT_DURATION_UNIT&quot;,</span>
<span class="fc" id="L913">	                getParamValue(request.getParameter(&quot;CS_MAX_SHIFT_DURATION_UNIT&quot;)));</span>
<span class="fc bfc" id="L914" title="All 2 branches covered.">	    } else if (key.equals(ValidationRulesMap.VALIDATION_CS_MIN_SHIFT_DURATION_PER_DAY)) {</span>
<span class="fc" id="L915">	        paramMap.put(&quot;CS_MIN_SHIFT_DURATION_VALUE&quot;,</span>
<span class="fc" id="L916">	                getParamValue(request.getParameter(&quot;CS_MIN_SHIFT_DURATION_VALUE&quot;)));</span>
<span class="fc" id="L917">	        paramMap.put(&quot;CS_MIN_SHIFT_DURATION_UNIT&quot;,</span>
<span class="fc" id="L918">	                getParamValue(request.getParameter(&quot;CS_MIN_SHIFT_DURATION_UNIT&quot;)));</span>
<span class="fc bfc" id="L919" title="All 2 branches covered.">	    } else if (key.equals(ValidationRulesMap.VALIDATION_CS_FULFILLS_NET_STAFFING_SHORTAGE)) {</span>
<span class="fc" id="L920">	        paramMap.put(&quot;CS_MIN_SHORTAGE_DURATION_VALUE&quot;,</span>
<span class="fc" id="L921">	                getParamValue(request.getParameter(&quot;CS_MIN_SHORTAGE_DURATION_VALUE&quot;)));</span>
<span class="pc bpc" id="L922" title="1 of 2 branches missed.">	    } else if (key.equals(ValidationRulesMap.VALIDATION_VTO_REDUCE_NET_STAFFING_SURPLUS)) {</span>
<span class="fc" id="L923">	        paramMap.put(&quot;VTO_MIN_SURPLUS_DURATION_VALUE&quot;,</span>
<span class="fc" id="L924">	                getParamValue(request.getParameter(&quot;VTO_MIN_SURPLUS_DURATION_VALUE&quot;)));</span>
	    }

<span class="fc" id="L927">        return rule;</span>
    }

	private String getParamValue(String paramValue) {
<span class="fc bfc" id="L931" title="All 2 branches covered.">		return StringUtil.isEmpty(paramValue) ? DEFAULT_PARAM_VALUE : paramValue;</span>
    }

    private String getParamValueStr(String paramValue){
<span class="pc bpc" id="L935" title="1 of 4 branches missed.">		return DEFAULT_PARAM_VALUE.equals(paramValue) || &quot;null&quot;.equals(paramValue) ? &quot;&quot; : paramValue;</span>
    }
    private String i18n(String key) {
<span class="fc" id="L938">		return i18n(rmBundle, key);</span>
	}
    @Override
	public String getHtmlDisplay() {
<span class="nc" id="L942">        return &quot;&quot;;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>