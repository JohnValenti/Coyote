<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>ShiftSwapRequestDetailsPopupPM.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.rm.requests.shiftswap</a> &gt; <span class="el_source">ShiftSwapRequestDetailsPopupPM.java</span></div><h1>ShiftSwapRequestDetailsPopupPM.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.rm.requests.shiftswap;

import java.util.*;

import com.bluepumpkin.common.datatypes.*;
import com.bluepumpkin.common.util.*;
import com.bluepumpkin.ejb.rm.requests.swap.request.model.*;
import com.bluepumpkin.ejb.rm.requests.swap.shiftitem.model.ShiftSwapItem;
import com.bluepumpkin.ejb.rm.requests.common.model.RequestAggregate;
import com.witness.web.uif.l10n.*;
import com.witness.web.uif.system.*;
import com.witness.web.uif.pagemodel.*;
import com.witness.web.uif.pagecomponent.list.*;
import com.bluepumpkin.web.rm.keys.*;
import com.bluepumpkin.web.rm.l10n.*;
import com.bluepumpkin.web.rm.requests.*;

/**
 * Title:        ShiftSwapDetailsPopupPM
 * Description:  Display Details about a Shift Swap Request
 * Copyright:    Copyright (c) 2002
 * Company:      Blue Pumpkin Software, Inc
 * @author       David Su, dsu
 * @version      1.0
 *
 * Created on November 6, 2002, 6:22 PM
 */
public class ShiftSwapRequestDetailsPopupPM extends RequestDetailsPopupPM {
	private MultiColListPC m_mainListPC;
<span class="nc" id="L30">  private Map m_eNameMap = Collections.EMPTY_MAP;</span>
	private ShiftSwapRequest m_ssRequest;
	
	/**
	 * Constructor
	 */
	public ShiftSwapRequestDetailsPopupPM(RequestContext context) {
<span class="nc" id="L37">		super(context, RmKeys.RH_SHIFTSWAP_DETAILS);</span>

<span class="nc" id="L39">	  m_ssRequest = new ShiftSwapRequest(ShiftSwapRequest.DL_BASIC);</span>
<span class="nc" id="L40">		m_request = m_ssRequest;</span>
<span class="nc" id="L41">	}</span>

	/**
	 * Return an instance of the model that is ready for rendering
	 */
	public static PageModel getInstance(RequestContext context) throws Exception {
<span class="nc" id="L47">		return getInstance(context, ShiftSwapRequestDetailsPopupPM.class);</span>
	}//getInstance

	/** 
	 * Return Content Title Item Name
	 */
	protected String getContentTitleItemName() {
<span class="nc" id="L54">		 return i18n(m_bundle, RmWebBundleKey.REQUEST_TYPE_SHIFT_SWAP);</span>
	}

	/**
	 * Fetch Sepecific Request for given ID
	 */
	protected RequestAggregate fetchRequest(ID requestID) throws Exception {
<span class="nc" id="L61">		return ShiftSwapRequestsMH.getRequestByID(requestID);</span>
	}

	/**
	 * Load Specific Data
	 */
	protected void loadSpecifiedData() throws Exception {
<span class="nc" id="L68">		m_ssRequest = (ShiftSwapRequest)m_request;</span>
<span class="nc" id="L69">		m_eNameMap = ShiftSwapRequestsMH.getEmpNameMapForRequest(m_context, m_ssRequest);</span>
<span class="nc" id="L70">	}</span>
		
  /**
   * Initialize Content
   */
  protected void initContent() {
<span class="nc" id="L76">		initMainList();</span>
<span class="nc" id="L77">    initAlertList();</span>
<span class="nc" id="L78">		initAuditTrailList();</span>
<span class="nc" id="L79">  }</span>

  /**
   * Initialize Main List
   */
  protected void initMainList() {
<span class="nc" id="L85">	  m_mainListPC = createNewList();</span>

<span class="nc" id="L87">    String title = i18n(m_bundle, RmWebBundleKey.REQUEST_SUMMARY);</span>
<span class="nc" id="L88">		m_mainListPC.getHeader().addColumnHeaderData(null, title);</span>

<span class="nc" id="L90">		ArrayList listModel = new ArrayList();</span>
<span class="nc" id="L91">		addMainListData(listModel);</span>
<span class="nc" id="L92">		m_mainListPC.setListModel(listModel);</span>
        
<span class="nc" id="L94">        m_mainListPC.setHasRowHeaders(false); //508        </span>
<span class="nc" id="L95">  }</span>

  /**
	 * Add Swap Sentence
	 */
	private void addMainListData(List listModel) {			
<span class="nc" id="L101">		List ssItems = m_ssRequest.getShiftSwapItems();</span>
<span class="nc" id="L102">		ShiftSwapItem ssItem1 = (ShiftSwapItem)ssItems.get(0);</span>
<span class="nc" id="L103">		ShiftSwapItem ssItem2 = (ShiftSwapItem)ssItems.get(1);</span>
		
		// Determine which item to be displayed first
<span class="nc bnc" id="L106" title="All 2 branches missed.">		if (!m_empID.equals(ssItem1.getEmployeeID()) &amp;&amp; </span>
<span class="nc bnc" id="L107" title="All 2 branches missed.">				 m_empID.equals(ssItem2.getEmployeeID())) {</span>
<span class="nc" id="L108">			ShiftSwapItem tmpItem = ssItem1;</span>
<span class="nc" id="L109">			ssItem1 = ssItem2;</span>
<span class="nc" id="L110">			ssItem2 = tmpItem;</span>
		}		
	
<span class="nc" id="L113">		addSwapSentence(ssItem1, ssItem2, listModel);</span>
<span class="nc" id="L114">		addExpireSentence(ssItem1, ssItem2, listModel);</span>
<span class="nc" id="L115">	}</span>
	
	/**
	 * Add Swap Sentence
	 */
	private void addSwapSentence(ShiftSwapItem ssItem1, ShiftSwapItem ssItem2, List listModel) {
<span class="nc" id="L121">		ID agentID1 = ssItem1.getEmployeeID();</span>
<span class="nc" id="L122">		ID agentID2 = ssItem2.getEmployeeID();</span>
		
<span class="nc bnc" id="L124" title="All 2 branches missed.">		String agent1Name = m_empID.equals(agentID1)?</span>
<span class="nc" id="L125">		  i18n(m_common_bundle, UIFWebBundleKey.MY):</span>
<span class="nc" id="L126">			getEmployeeName(agentID1, m_eNameMap);</span>
				
<span class="nc bnc" id="L128" title="All 2 branches missed.">		String rbKey = isTwoWaySwap()?RmWebBundleKey.SWAP_REQUEST_TWOWAY_SENTENCE</span>
		                             :RmWebBundleKey.SWAP_REQUEST_ONEWAY_SENTENCE;
<span class="nc bnc" id="L130" title="All 6 branches missed.">		if (!isTwoWaySwap() &amp;&amp; m_empID.equals(agentID1) &amp;&amp; ssItem1.getShiftType().equals(ShiftSwapItem.SWAPITEMTYPE_TIMEOFF)){</span>
			//shift detail message
<span class="nc" id="L132">			rbKey = RmWebBundleKey.SWAP_REQUEST_ONEWAY_DAYOFF_SENTENCE;</span>
		}
	
<span class="nc" id="L135">		String sentence_template = i18n(m_bundle, rbKey);</span>
<span class="nc" id="L136">		Object[] args = null;</span>
<span class="nc bnc" id="L137" title="All 2 branches missed.">		if (ssItem1.getShiftType().equals(ShiftSwapItem.SWAPITEMTYPE_TIMEOFF) &amp;&amp;</span>
<span class="nc bnc" id="L138" title="All 6 branches missed.">				m_empID.equals(agentID1) &amp;&amp; !isTwoWaySwap() &amp;&amp; ssItem2.getIsPartial()){//do not display day off</span>
<span class="nc" id="L139">			sentence_template = i18n(m_bundle, RmWebBundleKey.SWAP_REQUEST_ONEWAY_DAYOFF_PARTIAL_SENTENCE);</span>
<span class="nc" id="L140">			args = new Object[] {   </span>
<span class="nc" id="L141">					getEmployeeName(agentID2, m_eNameMap),</span>
<span class="nc" id="L142">					SwapUtil.formatShiftDate(ssItem2, m_localizer, m_view_tz),</span>
<span class="nc" id="L143">					getShiftSwapTypeDisplay()</span>
				};
		} else {
<span class="nc" id="L146">			args = new Object[] {</span>
			agent1Name,
<span class="nc" id="L148">			getShiftTypeDisplay( ssItem1 ),</span>
<span class="nc" id="L149">      SwapUtil.formatShiftDate( ssItem1, m_localizer, m_view_tz),</span>
<span class="nc" id="L150">			getEmployeeName(agentID2, m_eNameMap),</span>
<span class="nc" id="L151">      SwapUtil.formatShiftDate( ssItem2, m_localizer, m_view_tz ),</span>
<span class="nc" id="L152">			getShiftSwapTypeDisplay()</span>
		};
		}
<span class="nc" id="L155">		String sentence = BPMessageFormat.format(sentence_template, args);</span>
<span class="nc" id="L156">		addDataRow(sentence, listModel);		</span>
<span class="nc" id="L157">	}</span>
		
	/**
	 * Add Expire Sentence
	 */
	private void addExpireSentence(ShiftSwapItem ssItem1, ShiftSwapItem ssItem2, List listModel) {
<span class="nc" id="L163">		ID agentID1 = ssItem1.getEmployeeID();</span>
<span class="nc" id="L164">		ID agentID2 = ssItem2.getEmployeeID();</span>
<span class="nc" id="L165">		String sentence = createExpirationSentence();</span>
						
<span class="nc" id="L167">		addDataRow(sentence, listModel);</span>
<span class="nc" id="L168">	}			</span>
	
	/**
	 * Return Expiration Sentation
	 */
	private String createExpirationSentence() {
<span class="nc" id="L174">		String sentence_template = i18n(m_bundle, RmWebBundleKey.SWAP_REQUEST_EXPIRE_SENTENCE);			</span>
<span class="nc" id="L175">		Date date = m_request.getExpirationDate();</span>
<span class="nc" id="L176">		Object[] args = new Object[] { formatDateTime(date) };</span>
<span class="nc" id="L177">		return BPMessageFormat.format(sentence_template, args);		</span>
	}	
	
	/**
	 * Return Shift Type Display
	 */
	private String getShiftTypeDisplay(ShiftSwapItem item) {
<span class="nc" id="L184">		String shiftTyppe = item.getShiftType();</span>
<span class="nc bnc" id="L185" title="All 2 branches missed.">		String rbKey = ShiftSwapItem.SWAPITEMTYPE_SHIFT.equals(shiftTyppe)?</span>
		  RmWebBundleKey.SHIFTTYPE_SHIFT:RmWebBundleKey.SHIFTTYPE_DAYOFF;
<span class="nc" id="L187">	  return i18n(m_bundle, rbKey);		</span>
	}	
	
	/**
	 * Return localize shift Swap Type
	 */
	protected String getShiftSwapTypeDisplay() {
<span class="nc" id="L194">		String swapType = getSwapType();</span>
<span class="nc bnc" id="L195" title="All 2 branches missed.">		String rbKey = ShiftSwapRequest.SHIFTSWAP_TYPE_ONEWAY.equals(swapType) ?</span>
      RmWebBundleKey.SWAPTYPE_ONEWAY:
			RmWebBundleKey.SWAPTYPE_TWOWAY;
		
<span class="nc" id="L199">		return i18n(m_bundle, rbKey);</span>
	}	
	
	/**
	 * Return true if it is a Two Way Swap
	 */
	protected boolean isTwoWaySwap() {
<span class="nc" id="L206">		return ShiftSwapRequest.SHIFTSWAP_TYPE_TWOWAY.equals(getSwapType());</span>
	}	
	
	/**
	 * Return Swap Type
	 */
	protected String getSwapType() {
<span class="nc" id="L213">		return m_ssRequest.getSwapType();		</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>