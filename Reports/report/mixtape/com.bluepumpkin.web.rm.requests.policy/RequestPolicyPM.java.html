<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>RequestPolicyPM.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.rm.requests.policy</a> &gt; <span class="el_source">RequestPolicyPM.java</span></div><h1>RequestPolicyPM.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.rm.requests.policy;

import java.util.ArrayList;
import java.util.Collection;
import java.util.Collections;
import java.util.Iterator;
import java.util.List;
import java.util.ResourceBundle;
import java.util.TimeZone;

import com.bluepumpkin.common.datatypes.ID;
import com.witness.ejb.core.security.PrivilegeKeys;
import com.bluepumpkin.ejb.rm.requests.common.model.Request;
import com.bluepumpkin.ejb.rm.setup.autoprocessing.model.AutoProcessingRule;
import com.bluepumpkin.ejb.rm.setup.filingrules.model.RequestFilingRule;
import com.bluepumpkin.web.bbm.l10n.BbmWebBundleKey;
import com.bluepumpkin.web.bbm.organization.OrganizationModelHandler;
import com.bluepumpkin.web.rm.l10n.RmWebBundleKey;
import com.bluepumpkin.web.rm.requests.RequestsMH;
import com.bluepumpkin.web.rm.requests.RequestsPM;
import com.bluepumpkin.web.rm.setup.RmSetupUtil;
import com.bluepumpkin.web.rm.setup.autoprocessing.AutoProcessingModelHandler;
import com.bluepumpkin.web.rm.setup.autoprocessing.AutoProcessingUtil;
import com.bluepumpkin.web.rm.setup.filingrules.FilingRuleModelHandler;
import com.bluepumpkin.web.rm.setup.filingrules.FilingRuleUtil;
import com.bluepumpkin.web.rm.validation.ValidationRulesMap;
import com.witness.ejb.core.security.model.User;
import com.witness.web.uif.base.Message;
import com.witness.web.uif.pagecomponent.DefaultMultiColumnNodeData;
import com.witness.web.uif.pagecomponent.MultiColumnNodeData;
import com.witness.web.uif.pagecomponent.container.CollapsibleContainerPC;
import com.witness.web.uif.pagecomponent.list.MultiColListPC;
import com.witness.web.uif.pagemodel.ContainersInRowsPM;
import com.witness.web.uif.pagemodel.PageModel;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.util.ContainerList;
import com.witness.web.uif.util.html.CSSUtil;


/**
 * Title:        RequestPolicyPM
 * Description:  Request Policy
 * Copyright:    Copyright (c) 2001
 * Company:      Blue Pumpkin Software, inc
 * @author       David Su
 * @version      1.0
 */
public class RequestPolicyPM extends RequestsPM implements ContainersInRowsPM {
	private static final String OPEN_WPR =
			&quot;&lt;span style=\&quot;width:100%; overflow:auto; height:100\&quot;&gt;&lt;pre class=\&quot;textBlock\&quot;&gt;&quot;;
	private static final String CLOSE_WPR = &quot;&lt;/pre&gt;&lt;/span&gt;&quot;;
	private static final String FORM_ACTION = &quot;my_requests_policy&quot;;

	private ContainerList m_containerList;
	private CollapsibleContainerPC m_toPolicyPC;
	private CollapsibleContainerPC m_ftPolicyPC;
	private CollapsibleContainerPC m_ssPolicyPC;
	private CollapsibleContainerPC m_sbPolicyPC;
	private CollapsibleContainerPC m_csPolicyPC;
	private CollapsibleContainerPC m_autoProPC;
	private CollapsibleContainerPC m_filingRulePC;
	private ResourceBundle m_bbm_bundle;
	private ValidationRulesMap m_vrMap;
<span class="nc" id="L64">	private Collection m_apList = Collections.EMPTY_LIST;</span>
<span class="nc" id="L65">	private Collection m_frList = Collections.EMPTY_LIST;</span>
	private TimeZone m_orgTimeZone;

	/**
	 * Constructs a schedule view page model shell.
	 */
	public RequestPolicyPM(RequestContext context)	{
<span class="nc" id="L72">		super(context);</span>
<span class="nc" id="L73">		m_bbm_bundle = m_localizer.getBundle(BbmWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L74">		m_vrMap = ValidationRulesMap.getInstance();</span>

<span class="nc" id="L76">		m_containerList = new ContainerList(this, 4);</span>
<span class="nc" id="L77">		m_toPolicyPC = createCCPC(&quot;toPolicy&quot;);</span>
<span class="nc" id="L78">		m_ftPolicyPC = createCCPC(&quot;ftPolicy&quot;);</span>
<span class="nc" id="L79">		m_ssPolicyPC = createCCPC(&quot;ssPolicy&quot;);</span>
<span class="nc" id="L80">		m_sbPolicyPC = createCCPC(&quot;sbPolicy&quot;);</span>
<span class="nc" id="L81">		m_csPolicyPC = createCCPC(&quot;csPolicy&quot;);</span>
<span class="nc" id="L82">		m_autoProPC = createCCPC(&quot;autoPro&quot;);</span>
<span class="nc" id="L83">		m_filingRulePC = createCCPC(&quot;filingRule&quot;);</span>
<span class="nc" id="L84">	}</span>

	/**
	 * Return instance of Model which is ready to be rendered
	 */
	public static PageModel getInstance(RequestContext context) throws Exception {
<span class="nc" id="L90">		return getInstance(context, RequestPolicyPM.class);</span>
	}

	/**
	 * Populate Model
	 */
	protected void loadData() throws Exception {
<span class="nc bnc" id="L97" title="All 2 branches missed.">		if (m_empID!=null) {</span>
<span class="nc" id="L98">			ID orgID = OrganizationModelHandler.getEmployeeOrgID(m_context, m_empID);</span>
<span class="nc bnc" id="L99" title="All 2 branches missed.">			if (orgID == null){</span>
<span class="nc" id="L100">            	this.addPageMessage(Message.ERROR_TYPE, RmWebBundleKey.EMP_NO_ORG,</span>
    					RmWebBundleKey.BUNDLE_NAME);
<span class="nc" id="L102">            	return;</span>
            }
			//get org time zone for display
<span class="nc" id="L105">			m_orgTimeZone = RmSetupUtil.getOrgTimeZone(m_context, orgID);</span>
<span class="nc" id="L106">			m_orgSetting = RequestsMH.getOrgSetting(orgID);</span>
				
<span class="nc" id="L108">			m_apList = AutoProcessingModelHandler.getAutoProcessingRuleList(orgID, Request.REQUESTTYPE_ALL);</span>
<span class="nc" id="L109">			m_frList = FilingRuleModelHandler.getFilingRuleList(orgID);</span>
		}
<span class="nc" id="L111">	}</span>

	/**
	 * Create Collapsible Container PC
	 */
	private CollapsibleContainerPC createCCPC(String name) {
<span class="nc" id="L117">		CollapsibleContainerPC containerPC = new CollapsibleContainerPC(m_context);</span>
<span class="nc" id="L118">		containerPC.setName(name);</span>
<span class="nc" id="L119">		containerPC.setToggleable(true);</span>
<span class="nc" id="L120">		containerPC.setStyleClass(CSSUtil.CLASS_BORDER_DEFAULT);</span>
<span class="nc" id="L121">		containerPC.setTemplate(&quot;{0}&quot;);</span>
<span class="nc" id="L122">		return containerPC;</span>
	}

	/**
	 * Initialize Content Tittle
	 */
	protected void initContentTitle()	{
		// Initialize Content Title    
<span class="nc" id="L130">		String pageTitle = i18n(m_bundle, RmWebBundleKey.RM_MYSCHEDULE_POLICIES);</span>
<span class="nc" id="L131">		m_contentTitlePC.setPageTitle(pageTitle);</span>
<span class="nc" id="L132">	}</span>

	/**
	 * Initiailize Container
	 */
	protected void initContainer(CollapsibleContainerPC containerPC, String label_rbKey, String content) {
<span class="nc" id="L138">		String title = i18n(m_bundle, label_rbKey);</span>
<span class="nc" id="L139">		containerPC.setTitle(title);</span>

<span class="nc bnc" id="L141" title="All 2 branches missed.">		content = (content != null) ? content : &quot;&quot;;</span>
<span class="nc" id="L142">		content = OPEN_WPR + content + CLOSE_WPR;</span>
<span class="nc" id="L143">		containerPC.addComponent(content);</span>
<span class="nc" id="L144">		m_containerList.add(containerPC);</span>
<span class="nc" id="L145">	}</span>

	/**
	 * Create and Add Inner List PC to Container
	 */
	private MultiColListPC addInnerListPC(CollapsibleContainerPC container) {
<span class="nc" id="L151">		MultiColListPC listPC = new MultiColListPC(m_context);</span>
<span class="nc" id="L152">		listPC.setHeightInPixels(100);</span>
<span class="nc" id="L153">		listPC.setEnabled(false);</span>
<span class="nc" id="L154">		container.addComponent(listPC);</span>
<span class="nc" id="L155">		return listPC;</span>
	}

	/**
	 * Initialize Auto Processing Container
	 */
	protected void initAutoProcessing() {
<span class="nc bnc" id="L162" title="All 2 branches missed.">		if (!m_orgSetting.getAllowAgentsViewAutoProcessingRules()) return;</span>

<span class="nc" id="L164">		String title = i18n(m_bundle, RmWebBundleKey.RM_ORG_REQUEST_PROCESSING_AUTOPROCESSING);</span>
<span class="nc" id="L165">		m_autoProPC.setTitle(title);</span>

<span class="nc" id="L167">		MultiColListPC listPC = addInnerListPC(m_autoProPC);</span>
<span class="nc" id="L168">		AutoProcessingUtil.initListHeader(listPC.getHeader(), m_bundle, m_bbm_bundle, false, m_localizer);</span>
<span class="nc" id="L169">		List listModel = new ArrayList();</span>
<span class="nc bnc" id="L170" title="All 2 branches missed.">		if (m_apList.isEmpty()) {</span>
			// Create/Add no data msg Row
<span class="nc" id="L172">			MultiColumnNodeData row_data = AutoProcessingUtil.createNoDataRow(m_bundle, false, m_localizer);</span>
<span class="nc" id="L173">			listModel.add(row_data);</span>
<span class="nc" id="L174">		} else {</span>
<span class="nc bnc" id="L175" title="All 2 branches missed.">			for(Iterator it=m_apList.iterator(); it.hasNext(); ) {</span>
<span class="nc" id="L176">				AutoProcessingRule rule = (AutoProcessingRule)it.next();</span>
<span class="nc bnc" id="L177" title="All 2 branches missed.">				if (!rule.isApplied()) continue;</span>

<span class="nc" id="L179">				DefaultMultiColumnNodeData row_data = AutoProcessingUtil</span>
<span class="nc" id="L180">						.createRuleDataRow(m_context, rule, m_bundle, m_vrMap, null, null, false, m_orgTimeZone, m_localizer);</span>
<span class="nc" id="L181">				listModel.add(row_data);</span>
<span class="nc" id="L182">			}</span>
		}
<span class="nc" id="L184">		listPC.setListModel(listModel);</span>
<span class="nc" id="L185">		m_containerList.add(m_autoProPC);</span>
<span class="nc" id="L186">	}</span>

	/**
	 * Initialize Filing Rule Container
	 */
	protected void initFilingRule() {
<span class="nc" id="L192">		String title = i18n(m_bundle, RmWebBundleKey.RM_ORG_REQUEST_PROCESSING_FILINGRULE);</span>
<span class="nc" id="L193">		m_filingRulePC.setTitle(title);</span>

<span class="nc" id="L195">		MultiColListPC listPC = addInnerListPC(m_filingRulePC);</span>
<span class="nc" id="L196">		FilingRuleUtil.initListHeader(listPC.getHeader(), m_bundle, m_bbm_bundle, false, m_localizer);</span>
<span class="nc" id="L197">		List listModel = new ArrayList();</span>
<span class="nc bnc" id="L198" title="All 2 branches missed.">		if (m_frList.isEmpty()) {</span>
			// Create/Add no data msg Row
<span class="nc" id="L200">			MultiColumnNodeData row_data = FilingRuleUtil.createNoDataRow(m_bundle, false, m_localizer);</span>
<span class="nc" id="L201">			listModel.add(row_data);</span>
<span class="nc" id="L202">		} else {</span>
<span class="nc bnc" id="L203" title="All 2 branches missed.">			for(Iterator it=m_frList.iterator(); it.hasNext(); ) {</span>
<span class="nc" id="L204">				RequestFilingRule rule = (RequestFilingRule)it.next();</span>
<span class="nc bnc" id="L205" title="All 2 branches missed.">				if (!rule.isApplied()) continue;</span>

<span class="nc" id="L207">				DefaultMultiColumnNodeData row_data = FilingRuleUtil.createRuleDataRow(</span>
						m_context, rule, m_bundle, null, null, false, m_localizer, m_orgTimeZone);
<span class="nc" id="L209">				listModel.add(row_data);</span>
<span class="nc" id="L210">			}</span>
		}
<span class="nc" id="L212">		listPC.setListModel(listModel);</span>

<span class="nc" id="L214">		m_containerList.add(m_filingRulePC);</span>
<span class="nc" id="L215">	}</span>

	// Not Used
<span class="nc" id="L218">	protected void initHeader() {}</span>

	/**
	 * Initialize Selectable Items
	 */
	protected void initSelectableItems() {
<span class="nc bnc" id="L224" title="All 2 branches missed.">		if (m_orgSetting==null) return;</span>

<span class="nc" id="L226">		User user = m_context.getUser();</span>

<span class="nc bnc" id="L228" title="All 2 branches missed.">		if (user.isAuthorized(PrivilegeKeys.TOM_VIEWPERSONALREQUESTS_ID)) {</span>
<span class="nc" id="L229">			initContainer(m_toPolicyPC,</span>
					RmWebBundleKey.ORG_RM_SETTINGS_TO_POLICY_TITLE,
<span class="nc" id="L231">					m_orgSetting.getTimeOffPolicy());</span>
		}

<span class="nc bnc" id="L234" title="All 2 branches missed.">		if (user.isAuthorized(PrivilegeKeys.FT_VIEWPERSONALREQUESTS_ID)) {</span>
<span class="nc" id="L235">			initContainer(m_ftPolicyPC,</span>
					RmWebBundleKey.ORG_RM_SETTINGS_FT_POLICY_TITLE,
<span class="nc" id="L237">					m_orgSetting.getFlexTimePolicy());</span>
		}

<span class="nc bnc" id="L240" title="All 2 branches missed.">		if (user.isAuthorized(PrivilegeKeys.SS_VIEWPERSONALREQUESTS_ID)) {</span>
<span class="nc" id="L241">			initContainer(m_ssPolicyPC,</span>
					RmWebBundleKey.ORG_RM_SETTINGS_SS_POLICY_TITLE,
<span class="nc" id="L243">					m_orgSetting.getShiftSwapPolicy());</span>
		}

<span class="nc bnc" id="L246" title="All 2 branches missed.">		if (user.isAuthorized(PrivilegeKeys.SB_VIEWPERSONALBIDS_ID)) {</span>
<span class="nc" id="L247">			initContainer(m_sbPolicyPC,</span>
					RmWebBundleKey.ORG_RM_SETTINGS_SB_POLICY_TITLE,
<span class="nc" id="L249">					m_orgSetting.getShiftBidPolicy());</span>
		}
		
<span class="nc bnc" id="L252" title="All 2 branches missed.">		if (user.isAuthorized(PrivilegeKeys.CS_VIEWPERSONALREQUESTS_ID)) {</span>
<span class="nc" id="L253">			initContainer(m_csPolicyPC,</span>
					RmWebBundleKey.ORG_RM_SETTINGS_CS_POLICY_TITLE,
<span class="nc" id="L255">					m_orgSetting.getCustomShiftPolicy());</span>
		}

<span class="nc" id="L258">		initAutoProcessing();</span>
<span class="nc" id="L259">		initFilingRule();</span>
<span class="nc" id="L260">	}</span>

	/**
	 * Initialize Toolbar
	 */
	protected void initToolbar() {
<span class="nc" id="L266">	}</span>

	/** Return URL for HTML Form Action
	 *
	 */
	public String getFormAction() {
<span class="nc" id="L272">		return FORM_ACTION;</span>
	}

	/**
	 * Return List of Containers
	 *
	 * NOTE: Items in the Collection will be treated either as Page Components or
	 *       just a basic Object.
	 */
	public Collection getContainers() {
<span class="nc" id="L282">		return m_containerList;</span>
	}	
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>