<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>EmployeeTemplateDAO.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.ejb.bbm.workresource.ejb</a> &gt; <span class="el_source">EmployeeTemplateDAO.java</span></div><h1>EmployeeTemplateDAO.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.ejb.bbm.workresource.ejb;

import java.util.ArrayList;
import java.util.Collection;
import java.util.Collections;
import java.util.Date;
import java.util.HashMap;
import java.util.HashSet;
import java.util.Iterator;
import java.util.Set;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.jdmo.Jdmo;
import com.bluepumpkin.common.jdmo.JdmoException;
import com.bluepumpkin.common.jdmo.JdmoRowset;
import com.bluepumpkin.common.jdmo.JdmoUtil;
import com.bluepumpkin.common.localization.LocaleContext;
import com.bluepumpkin.ejb.bbm.base.BbmCreateException;
import com.bluepumpkin.ejb.bbm.base.BbmException;
import com.bluepumpkin.ejb.bbm.base.BbmFinderException;
import com.bluepumpkin.ejb.bbm.base.BbmRemoveException;
import com.bluepumpkin.ejb.bbm.base.BbmUpdateException;
import com.bluepumpkin.ejb.bbm.dao.DAOBase;
import com.bluepumpkin.ejb.bbm.dao.DAOUtil;
import com.bluepumpkin.ejb.bbm.skill.model.SkillAssignment;
import com.bluepumpkin.ejb.bbm.vo.FieldInfo;
import com.bluepumpkin.ejb.bbm.workresource.model.EmployeeTemplate;
import com.bluepumpkin.ejb.bbm.workresource.model.EmployeeTemplateFieldInfo;
import com.bluepumpkin.ejb.core.base.MultiUserException;
import com.witness.ejb.bbm.copy.ejb.CopyDAO;

/**
 * Title: Blue Pumpkin Software Basic Business Model Description: dao object to
 * serialize EmployeeTemplate value object Copyright: Copyright (c) 2001
 * Company: Blue Pumpkin Software, inc
 * 
 * @author lixin zhang
 * @version 1.0
 */

public class EmployeeTemplateDAO extends DAOBase&lt;EmployeeTemplate&gt; {

	// meta data information
<span class="fc" id="L44">	private static FieldInfo m_fieldInfo = new EmployeeTemplateFieldInfo();</span>

	@Override
	protected FieldInfo getFieldInfo() {
<span class="fc" id="L48">		return m_fieldInfo;</span>
	}

	public EmployeeTemplateDAO() {
<span class="fc" id="L52">		super();</span>
<span class="fc" id="L53">	}</span>

	public EmployeeTemplateDAO(Jdmo dmo) {
<span class="fc" id="L56">		super(dmo);</span>
<span class="fc" id="L57">	}</span>

	@Override
	protected EmployeeTemplate createValueObject() {
<span class="nc" id="L61">		return (new EmployeeTemplate());</span>
	}

	@Override
	protected boolean allowCreateWithId() {
<span class="nc" id="L66">		return true;</span>
	}

	public ID createEmployeeTemplate(EmployeeTemplate objValue) throws BbmCreateException {
<span class="fc" id="L70">		ID DEIDEmpTemplate = null;</span>
		try {
			String strCreate;
<span class="fc" id="L73">			String idStr = DAOUtil.getDEID(m_dmo);</span>
<span class="fc" id="L74">			DEIDEmpTemplate = new ID(idStr);</span>
<span class="fc" id="L75">			strCreate = &quot;INSERT INTO EMPTEMPLATE (ID, NAME, PROFICIENCY, ORGANIZATIONID, ISHIDDEN, WAGE) VALUES ('&quot; + idStr</span>
<span class="fc" id="L76">					+ &quot;','&quot; + objValue.getName() + &quot;',&quot; + objValue.getProficiency() + &quot;,'&quot; + objValue.getOrganizationID()</span>
<span class="pc bpc" id="L77" title="1 of 2 branches missed.">					+ &quot;',&quot; + ((objValue.getIsHidden()) ? 1 : 0) + &quot;,&quot; + objValue.getWage() + &quot;)&quot;;</span>
<span class="fc" id="L78">			m_dmo.executeCommand(strCreate.toString());</span>

<span class="fc" id="L80">			Collection&lt;SkillAssignment&gt; skillAssignments = objValue.getSkillAssignments();</span>
<span class="pc bpc" id="L81" title="2 of 4 branches missed.">			if (skillAssignments != null &amp;&amp; !skillAssignments.isEmpty()) {</span>
				// need to create the skill assignment for this template in
				// emptemplateskill table
<span class="nc" id="L84">				HashMap&lt;ID, ID&gt; SkillIDHM = getDEIDFromSkillAssignments(skillAssignments);</span>
<span class="nc" id="L85">				SkillAssignment skillAssignment = null;</span>
<span class="nc" id="L86">				HashMap&lt;String, Object&gt; nameValuesSA = new HashMap&lt;String, Object&gt;(2);</span>
<span class="nc" id="L87">				Set&lt;ID&gt; uniqueSkills = new HashSet&lt;ID&gt;();</span>
<span class="nc bnc" id="L88" title="All 2 branches missed.">				for (Iterator&lt;SkillAssignment&gt; i = skillAssignments.iterator(); i.hasNext();) {</span>
<span class="nc" id="L89">					skillAssignment = i.next();</span>
<span class="nc" id="L90">					ID skillID = skillAssignment.getSkillID();</span>
<span class="nc bnc" id="L91" title="All 2 branches missed.">					if (!uniqueSkills.contains(skillID)) {</span>
<span class="nc" id="L92">						nameValuesSA.put(&quot;EMPTEMPLATEID&quot;, DEIDEmpTemplate.toString());</span>
<span class="nc" id="L93">						nameValuesSA.put(&quot;SKILLID&quot;, SkillIDHM.get(skillAssignment.getSkillID()).toString());</span>
<span class="nc" id="L94">						nameValuesSA.put(&quot;PROFICIENCY&quot;, new Double(skillAssignment.getProficiency()));</span>
<span class="nc" id="L95">						nameValuesSA.put(&quot;PRIORITY&quot;, new Integer(skillAssignment.getPriority()));</span>
<span class="nc" id="L96">						nameValuesSA.put(&quot;RESERVELEVEL&quot;, new Integer(skillAssignment.getClassification()));</span>

<span class="nc" id="L98">						m_dmo.addBatchInsert(&quot;EMPTEMPLATESKILL&quot;, nameValuesSA);</span>
<span class="nc" id="L99">						uniqueSkills.add(skillID);</span>
					}
<span class="nc" id="L101">				}</span>
<span class="nc" id="L102">				m_dmo.executeBatch();</span>
			}

<span class="fc" id="L105">			Collection&lt;ID&gt; shiftPatternIDs = objValue.getShiftPatterns();</span>
<span class="pc bpc" id="L106" title="2 of 4 branches missed.">			if (shiftPatternIDs != null &amp;&amp; !shiftPatternIDs.isEmpty()) {</span>
<span class="fc" id="L107">				HashMap&lt;ID, ID&gt; ShiftPatternHM = getDEIDFromSID(&quot;SHIFTPATTERN&quot;, shiftPatternIDs);</span>
<span class="fc" id="L108">				HashMap&lt;String, Object&gt; nameValuesSP = new HashMap&lt;String, Object&gt;();</span>
<span class="fc bfc" id="L109" title="All 2 branches covered.">				for (Iterator&lt;ID&gt; i = shiftPatternIDs.iterator(); i.hasNext();) {</span>
<span class="fc" id="L110">					nameValuesSP.put(&quot;EMPTEMPLATEID&quot;, DEIDEmpTemplate.toString());</span>
<span class="fc" id="L111">					nameValuesSP.put(&quot;SHIFTPATTERNID&quot;, ShiftPatternHM.get(i.next()).toString());</span>
<span class="fc" id="L112">					nameValuesSP.put(&quot;PREFERENCE&quot;, new Integer(1));</span>
<span class="fc" id="L113">					m_dmo.addBatchInsert(&quot;SHIFTPATTERNEMPTEMPLATE&quot;, nameValuesSP);</span>
				}
<span class="fc" id="L115">				m_dmo.executeBatch();</span>
			}

<span class="fc" id="L118">			Collection&lt;ID&gt; assignmentRuleIDs = objValue.getAssignmentRuleIDs();</span>
<span class="pc bpc" id="L119" title="2 of 4 branches missed.">			if (assignmentRuleIDs != null &amp;&amp; !assignmentRuleIDs.isEmpty()) {</span>
<span class="nc" id="L120">				HashMap&lt;ID, ID&gt; AssignmentRuleHM = getDEIDFromSID(&quot;COMPLEXWORKRULE&quot;, assignmentRuleIDs);</span>
<span class="nc" id="L121">				HashMap&lt;String, String&gt; nameValuesAR = new HashMap&lt;String, String&gt;(2);</span>
<span class="nc bnc" id="L122" title="All 2 branches missed.">				for (Iterator&lt;ID&gt; i = assignmentRuleIDs.iterator(); i.hasNext();) {</span>
<span class="nc" id="L123">					nameValuesAR.put(&quot;EMPTEMPLATEID&quot;, DEIDEmpTemplate.toString());</span>
<span class="nc" id="L124">					nameValuesAR.put(&quot;COMPLEXWORKRULEID&quot;, AssignmentRuleHM.get(i.next()).toString());</span>
<span class="nc" id="L125">					m_dmo.addBatchInsert(&quot;EMPTEMPLATEWORKRULE&quot;, nameValuesAR);</span>
				}
<span class="nc" id="L127">				m_dmo.executeBatch();</span>
			}

<span class="fc" id="L130">			HashMap&lt;String, Object&gt; nameValuesEM = new HashMap&lt;String, Object&gt;(2);</span>
<span class="fc" id="L131">			nameValuesEM.put(&quot;EMPTEMPLATEID&quot;, DEIDEmpTemplate.toString());</span>
<span class="fc" id="L132">			nameValuesEM.put(&quot;NUMBEROFCONNECTIONS&quot;, objValue.getChatSessions());</span>
<span class="fc" id="L133">			nameValuesEM.put(&quot;MEDIAID&quot;, &quot;ID_CHAT&quot;);</span>
<span class="fc" id="L134">			m_dmo.addBatchInsert(&quot;EMPTEMPLATEMEDIA&quot;, nameValuesEM);</span>
<span class="fc" id="L135">			m_dmo.executeBatch();</span>

			// find SID and return
<span class="fc" id="L138">			String stmt = &quot;SELECT SID FROM EMPTEMPLATE WHERE ID ='&quot; + DEIDEmpTemplate + &quot;'&quot;;</span>
<span class="fc" id="L139">			JdmoRowset rs = m_dmo.createRowset(stmt);</span>
<span class="fc" id="L140">			ID createID = new ID();</span>
<span class="pc bpc" id="L141" title="1 of 2 branches missed.">			if (rs.next()) {</span>
<span class="fc" id="L142">				createID = rs.getID(1);</span>
			}
<span class="fc" id="L144">			rs.close();</span>
<span class="fc" id="L145">			return createID;</span>

<span class="nc" id="L147">		} catch (JdmoException ex) {</span>
<span class="nc" id="L148">			throw new BbmCreateException(ex);</span>
		}
	}

	public void updateEmployeeTemplates(Collection&lt;EmployeeTemplate&gt; empTemplateCol) throws MultiUserException,
			BbmException, BbmUpdateException {
		try {
<span class="fc bfc" id="L155" title="All 2 branches covered.">			for (EmployeeTemplate empTemplate : empTemplateCol) {</span>
<span class="fc" id="L156">				updateEmployeeTemplateEx(empTemplate);</span>
<span class="fc" id="L157">			}</span>
<span class="nc" id="L158">		} catch (BbmUpdateException ex) {</span>
<span class="nc" id="L159">			throw ex;</span>
<span class="nc" id="L160">		} catch (BbmException ex) {</span>
<span class="nc" id="L161">			throw new BbmUpdateException(ex);</span>
<span class="fc" id="L162">		}</span>
<span class="fc" id="L163">	}</span>

	private void updateEmployeeTemplateEx(EmployeeTemplate objValue) throws MultiUserException, BbmException {
<span class="fc" id="L166">		ID idEmpTemplate = objValue.getID();</span>
<span class="fc" id="L167">		ID DEIDEmpTemplate = null;</span>
<span class="fc" id="L168">		String stmt = &quot;SELECT ID FROM EMPTEMPLATE WHERE SID='&quot; + idEmpTemplate + &quot;'&quot;;</span>

		try {
			// get DEID to use in sub-objects
<span class="fc" id="L172">			JdmoRowset rs = m_dmo.createRowset(stmt);</span>
<span class="pc bpc" id="L173" title="1 of 2 branches missed.">			if (rs.next()) {</span>
<span class="fc" id="L174">				DEIDEmpTemplate = rs.getID(&quot;ID&quot;);</span>
			}
<span class="fc" id="L176">			rs.close();</span>
			// update the object first
			String strUpdate;
<span class="fc" id="L179">			strUpdate = &quot;UPDATE EMPTEMPLATE SET NAME = '&quot; + objValue.getName() + &quot;', PROFICIENCY = &quot;</span>
<span class="fc" id="L180">					+ objValue.getProficiency() + &quot;, ORGANIZATIONID = '&quot; + objValue.getOrganizationID().toString()</span>
<span class="pc bpc" id="L181" title="1 of 2 branches missed.">					+ &quot;', ISHIDDEN = &quot; + ((objValue.getIsHidden()) ? 1 : 0) + &quot;, WAGE = &quot; + objValue.getWage()</span>
<span class="fc" id="L182">					+ &quot;, CONNECTIONID = &quot; + objValue.getConnectionID() + &quot; WHERE ID = '&quot; + DEIDEmpTemplate + &quot;'&quot;;</span>
<span class="fc" id="L183">			m_dmo.executeCommand(strUpdate.toString());</span>

			// delete the sub-objects and then recreate.
			// Delete the row from the EmployeeType table
			String strSQL;
<span class="fc" id="L188">			strSQL = &quot;delete from EMPTEMPLATESKILL where emptemplateid = '&quot; + DEIDEmpTemplate + &quot;'&quot;;</span>
<span class="fc" id="L189">			m_dmo.executeCommand(strSQL.toString());</span>
<span class="fc" id="L190">			strSQL = &quot;delete from SHIFTPATTERNEMPTEMPLATE where emptemplateid = '&quot; + DEIDEmpTemplate + &quot;'&quot;;</span>
<span class="fc" id="L191">			m_dmo.executeCommand(strSQL.toString());</span>
<span class="fc" id="L192">			strSQL = &quot;delete from EMPTEMPLATEWORKRULE where emptemplateid = '&quot; + DEIDEmpTemplate + &quot;'&quot;;</span>
<span class="fc" id="L193">			m_dmo.executeCommand(strSQL.toString());</span>
<span class="fc" id="L194">			strSQL = &quot;delete from EMPTEMPLATEMEDIA where emptemplateid = '&quot; + DEIDEmpTemplate + &quot;'&quot;;</span>
<span class="fc" id="L195">			m_dmo.executeCommand(strSQL.toString());</span>

<span class="fc" id="L197">			Collection&lt;SkillAssignment&gt; skillAssignments = objValue.getSkillAssignments();</span>
<span class="pc bpc" id="L198" title="2 of 4 branches missed.">			if (skillAssignments != null &amp;&amp; !skillAssignments.isEmpty()) {</span>
<span class="fc" id="L199">				HashMap&lt;ID, ID&gt; SkillIDHM = getDEIDFromSkillAssignments(skillAssignments);</span>
				// need to create the skill assignment for this template in
				// emptemplateskill table
<span class="fc" id="L202">				SkillAssignment skillAssignment = null;</span>
<span class="fc" id="L203">				HashMap&lt;String, Object&gt; nameValues = new HashMap&lt;String, Object&gt;(2);</span>
<span class="fc bfc" id="L204" title="All 2 branches covered.">				for (Iterator&lt;SkillAssignment&gt; i = skillAssignments.iterator(); i.hasNext();) {</span>
<span class="fc" id="L205">					skillAssignment = i.next();</span>
<span class="fc" id="L206">					nameValues.put(&quot;EMPTEMPLATEID&quot;, DEIDEmpTemplate.toString());</span>
<span class="fc" id="L207">					nameValues.put(&quot;SKILLID&quot;, SkillIDHM.get(skillAssignment.getSkillID()).toString());</span>
<span class="fc" id="L208">					nameValues.put(&quot;PROFICIENCY&quot;, new Double(skillAssignment.getProficiency()));</span>
<span class="fc" id="L209">					nameValues.put(&quot;PRIORITY&quot;, new Integer(skillAssignment.getPriority()));</span>
<span class="fc" id="L210">					nameValues.put(&quot;RESERVELEVEL&quot;, new Integer(skillAssignment.getClassification()));</span>

<span class="fc" id="L212">					m_dmo.addBatchInsert(&quot;EMPTEMPLATESKILL&quot;, nameValues);</span>
				}
<span class="fc" id="L214">				m_dmo.executeBatch();</span>
			}

<span class="fc" id="L217">			Collection&lt;ID&gt; shiftPatternIDs = objValue.getShiftPatterns();</span>
<span class="pc bpc" id="L218" title="2 of 4 branches missed.">			if (shiftPatternIDs != null &amp;&amp; !shiftPatternIDs.isEmpty()) {</span>
<span class="fc" id="L219">				HashMap&lt;ID, ID&gt; ShiftPatternHM = getDEIDFromSID(&quot;SHIFTPATTERN&quot;, shiftPatternIDs);</span>
<span class="fc" id="L220">				HashMap&lt;String, Object&gt; nameValues = new HashMap&lt;String, Object&gt;(3);</span>
<span class="fc bfc" id="L221" title="All 2 branches covered.">				for (Iterator&lt;ID&gt; i = shiftPatternIDs.iterator(); i.hasNext();) {</span>
<span class="fc" id="L222">					nameValues.put(&quot;EMPTEMPLATEID&quot;, DEIDEmpTemplate.toString());</span>
<span class="fc" id="L223">					nameValues.put(&quot;SHIFTPATTERNID&quot;, ShiftPatternHM.get(i.next()).toString());</span>
<span class="fc" id="L224">					nameValues.put(&quot;PREFERENCE&quot;, new Integer(1));</span>
<span class="fc" id="L225">					m_dmo.addBatchInsert(&quot;SHIFTPATTERNEMPTEMPLATE&quot;, nameValues);</span>
				}
<span class="fc" id="L227">				m_dmo.executeBatch();</span>
			}

<span class="fc" id="L230">			Collection&lt;ID&gt; assignmentRuleIDs = objValue.getAssignmentRuleIDs();</span>
<span class="pc bpc" id="L231" title="1 of 4 branches missed.">			if (assignmentRuleIDs != null &amp;&amp; !assignmentRuleIDs.isEmpty()) {</span>
<span class="fc" id="L232">				HashMap&lt;ID, ID&gt; AssignmentRuleHM = getDEIDFromSID(&quot;COMPLEXWORKRULE&quot;, assignmentRuleIDs);</span>
<span class="fc" id="L233">				HashMap&lt;String, String&gt; nameValues = new HashMap&lt;String, String&gt;(2);</span>
<span class="fc bfc" id="L234" title="All 2 branches covered.">				for (Iterator&lt;ID&gt; i = assignmentRuleIDs.iterator(); i.hasNext();) {</span>
<span class="fc" id="L235">					nameValues.put(&quot;EMPTEMPLATEID&quot;, DEIDEmpTemplate.toString());</span>
<span class="fc" id="L236">					nameValues.put(&quot;COMPLEXWORKRULEID&quot;, AssignmentRuleHM.get(i.next()).toString());</span>
<span class="fc" id="L237">					m_dmo.addBatchInsert(&quot;EMPTEMPLATEWORKRULE&quot;, nameValues);</span>
				}
<span class="fc" id="L239">				m_dmo.executeBatch();</span>
			}

<span class="fc" id="L242">			HashMap&lt;String, Object&gt; nameValues = new HashMap&lt;String, Object&gt;(2);</span>
<span class="fc" id="L243">			nameValues.put(&quot;EMPTEMPLATEID&quot;, DEIDEmpTemplate.toString());</span>
<span class="fc" id="L244">			nameValues.put(&quot;NUMBEROFCONNECTIONS&quot;, objValue.getChatSessions());</span>
<span class="fc" id="L245">			nameValues.put(&quot;MEDIAID&quot;, &quot;ID_CHAT&quot;);</span>
<span class="fc" id="L246">			m_dmo.addBatchInsert(&quot;EMPTEMPLATEMEDIA&quot;, nameValues);</span>
<span class="fc" id="L247">			m_dmo.executeBatch();</span>
<span class="nc" id="L248">		} catch (Exception e) {</span>
<span class="nc" id="L249">			throw new BbmUpdateException(e);</span>
<span class="fc" id="L250">		}</span>
<span class="fc" id="L251">	}</span>

	public void deleteEmployeeTemplates(Collection&lt;ID&gt; colEmpTemplateIDs) throws BbmRemoveException {
		// phantoms will be cascade deleted
		try {
			// get DEID for sub-objects
<span class="fc" id="L257">			String where = &quot;select id from emptemplate where sid in &quot; + m_dmo.createInClause(colEmpTemplateIDs);</span>

			// delete sub - objects
<span class="fc" id="L260">			DAOUtil.deleteObjects(m_dmo, &quot;EMPTEMPLATESKILL&quot;, where);</span>
<span class="fc" id="L261">			DAOUtil.deleteObjects(m_dmo, &quot;SHIFTPATTERNEMPTEMPLATE&quot;, where);</span>
<span class="fc" id="L262">			DAOUtil.deleteObjects(m_dmo, &quot;EMPTEMPLATEWORKRULE&quot;, where);</span>
<span class="fc" id="L263">			DAOUtil.deleteObjects(m_dmo, &quot;EMPTEMPLATEMEDIA&quot;, where);</span>
<span class="fc" id="L264">			DAOUtil.deleteObjects(m_dmo, getFieldInfo().getTableName(), where);</span>
<span class="nc" id="L265">		} catch (JdmoException ex) {</span>
<span class="nc" id="L266">			throw new BbmRemoveException(ex);</span>
<span class="fc" id="L267">		}</span>
<span class="fc" id="L268">	}</span>

	public void copyEmployeeTemplates(Collection&lt;ID&gt; empTemplateIDs, boolean isOrgMode, ID ownerID,
			LocaleContext localeContext, String currentUser) throws BbmFinderException, BbmCreateException {
<span class="nc" id="L272">		CopyDAO copyDAO = new CopyDAO();</span>
		try {
			// Before we initiate the copy operation we want to clear out the
			// IDs on the input objects and their
			// children and set the create date/user


<span class="nc" id="L279">			ArrayList&lt;EmployeeTemplate&gt; empTemplatesToCopy = new ArrayList&lt;EmployeeTemplate&gt;(</span>
<span class="nc" id="L280">					getEmployeeTemplatesByIDs(empTemplateIDs));</span>

<span class="nc bnc" id="L282" title="All 2 branches missed.">			for (EmployeeTemplate empTemplate : empTemplatesToCopy) {</span>

				// get required copy values : skill, shift pattern, assignment
				// rule, chatsessions

<span class="nc" id="L287">				empTemplate.setName(copyDAO.getNewNameForCopiedValueObject(empTemplate.getName(), &quot;EMPTEMPLATE&quot;,</span>
						localeContext));

<span class="nc bnc" id="L290" title="All 2 branches missed.">				if (isOrgMode) {</span>
<span class="nc" id="L291">					empTemplate.setOrganizationID(ownerID);</span>
				} else {
					// not used in campaign mode
				}

<span class="nc" id="L296">				ID DEIDEmpTemplate = null;</span>
<span class="nc" id="L297">				String idStr = DAOUtil.getDEID(m_dmo);</span>
<span class="nc" id="L298">				DEIDEmpTemplate = new ID(idStr);</span>

<span class="nc" id="L300">				empTemplate.setID(DEIDEmpTemplate);</span>
<span class="nc" id="L301">				empTemplate.setDEID(null);</span>
<span class="nc" id="L302">				empTemplate.setCreatedBy(currentUser);</span>
<span class="nc" id="L303">				empTemplate.setModifiedBy(null);</span>
<span class="nc" id="L304">				empTemplate.setCreatedDate(new Date());</span>
<span class="nc" id="L305">				empTemplate.setModifiedDate(null);</span>

<span class="nc" id="L307">				createObject(empTemplate);</span>

				// copy skill assignments
<span class="nc" id="L310">				Collection&lt;SkillAssignment&gt; skillAssignments = empTemplate.getSkillAssignments();</span>
<span class="nc bnc" id="L311" title="All 4 branches missed.">				if (skillAssignments != null &amp;&amp; !skillAssignments.isEmpty()) {</span>
<span class="nc" id="L312">					HashMap&lt;ID, ID&gt; SkillIDHM = getDEIDFromSkillAssignments(skillAssignments);</span>
					// need to create the skill assignment for this template in
					// emptemplateskill table
<span class="nc" id="L315">					SkillAssignment skillAssignment = null;</span>
<span class="nc" id="L316">					HashMap&lt;String, Object&gt; nameValues = new HashMap&lt;String, Object&gt;(2);</span>
<span class="nc bnc" id="L317" title="All 2 branches missed.">					for (Iterator&lt;SkillAssignment&gt; i = skillAssignments.iterator(); i.hasNext();) {</span>
<span class="nc" id="L318">						skillAssignment = i.next();</span>
<span class="nc" id="L319">						nameValues.put(&quot;EMPTEMPLATEID&quot;, DEIDEmpTemplate.toString());</span>
<span class="nc" id="L320">						nameValues.put(&quot;SKILLID&quot;, SkillIDHM.get(skillAssignment.getSkillID()).toString());</span>
<span class="nc" id="L321">						nameValues.put(&quot;PROFICIENCY&quot;, new Double(skillAssignment.getProficiency()));</span>
<span class="nc" id="L322">						nameValues.put(&quot;PRIORITY&quot;, new Integer(skillAssignment.getPriority()));</span>
<span class="nc" id="L323">						nameValues.put(&quot;RESERVELEVEL&quot;, new Integer(skillAssignment.getClassification()));</span>

<span class="nc" id="L325">						m_dmo.addBatchInsert(&quot;EMPTEMPLATESKILL&quot;, nameValues);</span>
					}
<span class="nc" id="L327">					m_dmo.executeBatch();</span>
				}
				// copy work patterns
<span class="nc" id="L330">				Collection&lt;ID&gt; shiftPatternIDs = empTemplate.getShiftPatterns();</span>
<span class="nc bnc" id="L331" title="All 4 branches missed.">				if (shiftPatternIDs != null &amp;&amp; !shiftPatternIDs.isEmpty()) {</span>
<span class="nc" id="L332">					HashMap&lt;ID, ID&gt; ShiftPatternHM = getDEIDFromSID(&quot;SHIFTPATTERN&quot;, shiftPatternIDs);</span>
<span class="nc" id="L333">					HashMap&lt;String, Object&gt; nameValues = new HashMap&lt;String, Object&gt;(3);</span>
<span class="nc bnc" id="L334" title="All 2 branches missed.">					for (Iterator&lt;ID&gt; i = shiftPatternIDs.iterator(); i.hasNext();) {</span>
<span class="nc" id="L335">						nameValues.put(&quot;EMPTEMPLATEID&quot;, DEIDEmpTemplate.toString());</span>
<span class="nc" id="L336">						nameValues.put(&quot;SHIFTPATTERNID&quot;, ShiftPatternHM.get(i.next()).toString());</span>
<span class="nc" id="L337">						nameValues.put(&quot;PREFERENCE&quot;, new Integer(1));</span>
<span class="nc" id="L338">						m_dmo.addBatchInsert(&quot;SHIFTPATTERNEMPTEMPLATE&quot;, nameValues);</span>
					}
<span class="nc" id="L340">					m_dmo.executeBatch();</span>
				}
				// copy assignment rule
<span class="nc" id="L343">				Collection&lt;ID&gt; assignmentRuleIDs = empTemplate.getAssignmentRuleIDs();</span>
<span class="nc bnc" id="L344" title="All 4 branches missed.">				if (assignmentRuleIDs != null &amp;&amp; !assignmentRuleIDs.isEmpty()) {</span>
<span class="nc" id="L345">					HashMap&lt;ID, ID&gt; AssignmentRuleHM = getDEIDFromSID(&quot;COMPLEXWORKRULE&quot;, assignmentRuleIDs);</span>
<span class="nc" id="L346">					HashMap&lt;String, String&gt; nameValues = new HashMap&lt;String, String&gt;(2);</span>
<span class="nc bnc" id="L347" title="All 2 branches missed.">					for (Iterator&lt;ID&gt; i = assignmentRuleIDs.iterator(); i.hasNext();) {</span>
<span class="nc" id="L348">						nameValues.put(&quot;EMPTEMPLATEID&quot;, DEIDEmpTemplate.toString());</span>
<span class="nc" id="L349">						nameValues.put(&quot;COMPLEXWORKRULEID&quot;, AssignmentRuleHM.get(i.next()).toString());</span>
<span class="nc" id="L350">						m_dmo.addBatchInsert(&quot;EMPTEMPLATEWORKRULE&quot;, nameValues);</span>
					}
<span class="nc" id="L352">					m_dmo.executeBatch();</span>
				}
				// copy chat
<span class="nc" id="L355">				HashMap&lt;String, Object&gt; nameValues = new HashMap&lt;String, Object&gt;(2);</span>
<span class="nc" id="L356">				nameValues.put(&quot;EMPTEMPLATEID&quot;, DEIDEmpTemplate.toString());</span>
<span class="nc" id="L357">				nameValues.put(&quot;NUMBEROFCONNECTIONS&quot;, empTemplate.getChatSessions());</span>
<span class="nc" id="L358">				nameValues.put(&quot;MEDIAID&quot;, &quot;ID_CHAT&quot;);</span>
<span class="nc" id="L359">				m_dmo.addBatchInsert(&quot;EMPTEMPLATEMEDIA&quot;, nameValues);</span>
<span class="nc" id="L360">				m_dmo.executeBatch();</span>
<span class="nc" id="L361">			}</span>
<span class="nc" id="L362">		} catch (BbmFinderException ex) {</span>
<span class="nc" id="L363">			throw new BbmFinderException(ex);</span>
<span class="nc" id="L364">		} catch (JdmoException ex) {</span>
<span class="nc" id="L365">			throw new BbmCreateException(ex);</span>
<span class="nc" id="L366">		} catch (Exception ex) {</span>
<span class="nc" id="L367">			throw new BbmCreateException(ex);</span>
<span class="nc" id="L368">		}</span>
<span class="nc" id="L369">	}</span>

	private HashMap&lt;ID, ID&gt; getDEIDFromSID(String tableName, Collection&lt;ID&gt; colSIDs) throws JdmoException {
<span class="fc" id="L372">		HashMap&lt;ID, ID&gt; SIDToDEIDPair = new HashMap&lt;ID, ID&gt;();</span>
		try {
<span class="fc" id="L374">			String qry = &quot;Select SID, ID from &quot; + tableName + &quot; where SID in &quot; + m_dmo.createInClause(colSIDs);</span>
<span class="fc" id="L375">			JdmoRowset rs = m_dmo.createRowset(new String(qry));</span>
<span class="fc bfc" id="L376" title="All 2 branches covered.">			while (rs.next()) {</span>
<span class="fc" id="L377">				SIDToDEIDPair.put(rs.getID(&quot;SID&quot;), rs.getID(&quot;ID&quot;));</span>
			}
<span class="fc" id="L379">			rs.close();</span>
<span class="nc" id="L380">		} catch (JdmoException ex) {</span>
<span class="nc" id="L381">			throw ex;</span>
<span class="fc" id="L382">		}</span>
<span class="fc" id="L383">		return SIDToDEIDPair;</span>
	}

	private HashMap&lt;ID, ID&gt; getDEIDFromSkillAssignments(Collection&lt;SkillAssignment&gt; skillAssignments) throws JdmoException {
<span class="fc" id="L387">		HashMap&lt;ID, ID&gt; SIDToDEIDPair = new HashMap&lt;ID, ID&gt;();</span>
		try {
<span class="pc bpc" id="L389" title="1 of 2 branches missed.">			if (!skillAssignments.isEmpty()) {</span>
				// need to create the skill assignment for this template in
				// emptemplateskill table
<span class="fc" id="L392">				SkillAssignment skillAssignment = null;</span>
<span class="fc" id="L393">				ArrayList&lt;ID&gt; skillIDs = new ArrayList&lt;ID&gt;();</span>
<span class="fc bfc" id="L394" title="All 2 branches covered.">				for (Iterator&lt;SkillAssignment&gt; i = skillAssignments.iterator(); i.hasNext();) {</span>
<span class="fc" id="L395">					skillAssignment = i.next();</span>
<span class="fc" id="L396">					skillIDs.add(new ID(skillAssignment.getSkillID()));</span>
				}
<span class="fc" id="L398">				SIDToDEIDPair = getDEIDFromSID(&quot;SKILL&quot;, skillIDs);</span>
			}
<span class="nc" id="L400">		} catch (JdmoException ex) {</span>
<span class="nc" id="L401">			throw ex;</span>
<span class="fc" id="L402">		}</span>
<span class="fc" id="L403">		return SIDToDEIDPair;</span>
	}

	public Collection&lt;EmployeeTemplate&gt; getEmployeeTemplatesByIDs(Collection&lt;ID&gt; colIDs) throws BbmFinderException {
		try {
<span class="fc" id="L408">			return getEmployeeTemplates(m_dmo.createInClause(colIDs));</span>
<span class="nc" id="L409">		} catch (JdmoException ex) {</span>
<span class="nc" id="L410">			throw new BbmFinderException(ex);</span>
		}
	}

	/**
	 * get employee templates in a given organization
	 */
	public Collection&lt;EmployeeTemplate&gt; getEmployeeTemplates(String sidWhere) throws BbmFinderException {
		try {
			// load all templates
<span class="fc" id="L420">			HashMap&lt;ID, EmployeeTemplate&gt; hTemplates = new HashMap&lt;ID, EmployeeTemplate&gt;();</span>

<span class="fc" id="L422">			String query = &quot;SELECT ID, SID, NAME, PROFICIENCY, ORGANIZATIONID, WAGE, ISHIDDEN, CONNECTIONID FROM EMPTEMPLATE &quot;</span>
					+ &quot; WHERE SID IN &quot; + sidWhere;
<span class="fc" id="L424">			JdmoRowset r = m_dmo.createRowset(query);</span>

			// -------------------------------------------------
			// get data and create templates
			// -------------------------------------------------

<span class="fc bfc" id="L430" title="All 2 branches covered.">			while (r.next()) {</span>
<span class="fc" id="L431">				ID idTemplate = r.getID(&quot;SID&quot;);</span>
<span class="fc" id="L432">				String sName = r.getString(&quot;NAME&quot;);</span>
<span class="fc" id="L433">				double dProficiency = r.getDouble(&quot;PROFICIENCY&quot;);</span>
<span class="fc" id="L434">				ID idOrg = r.getID(&quot;ORGANIZATIONID&quot;);</span>
<span class="fc" id="L435">				double dWage = r.getDouble(&quot;WAGE&quot;);</span>
<span class="fc" id="L436">				boolean bIsHidden = r.getBoolean(&quot;ISHIDDEN&quot;);</span>
<span class="fc" id="L437">				int nConnectionID = r.getInt(&quot;CONNECTIONID&quot;);</span>

<span class="fc" id="L439">				EmployeeTemplate pTemplate = new EmployeeTemplate();</span>
<span class="fc" id="L440">				pTemplate.setID(idTemplate);</span>
<span class="fc" id="L441">				pTemplate.setName(sName);</span>
<span class="fc" id="L442">				pTemplate.setOrganizationID(idOrg);</span>
<span class="fc" id="L443">				pTemplate.setWage(dWage);</span>
<span class="fc" id="L444">				pTemplate.setIsHidden(bIsHidden);</span>
<span class="fc" id="L445">				pTemplate.setProficiency(dProficiency);</span>
<span class="fc" id="L446">				pTemplate.setConnectionID(nConnectionID);</span>

<span class="fc" id="L448">				hTemplates.put(idTemplate, pTemplate);</span>
<span class="fc" id="L449">			}</span>
<span class="fc" id="L450">			r.close();</span>

			// -------------------------------------------------
			// get Chat Sessions
			// -------------------------------------------------
<span class="fc" id="L455">			query = &quot;SELECT e.SID, m.NUMBEROFCONNECTIONS FROM EMPTEMPLATEMEDIA m,EMPTEMPLATE e &quot;</span>
					+ &quot; WHERE m.EMPTEMPLATEID = e.ID AND e.SID IN &quot; + sidWhere;
<span class="fc" id="L457">			r = m_dmo.createRowset(query);</span>

<span class="fc bfc" id="L459" title="All 2 branches covered.">			while (r.next()) {</span>
<span class="fc" id="L460">				ID idTemplate = r.getID(&quot;SID&quot;);</span>
<span class="fc" id="L461">				int nConns = r.getInt(&quot;NUMBEROFCONNECTIONS&quot;);</span>
<span class="fc" id="L462">				EmployeeTemplate pTemplate = (EmployeeTemplate) hTemplates.get(idTemplate);</span>
<span class="pc bpc" id="L463" title="1 of 2 branches missed.">				if (pTemplate != null) {</span>
<span class="fc" id="L464">					pTemplate.setChatSessions(nConns);</span>
				}
<span class="fc" id="L466">			}</span>
<span class="fc" id="L467">			r.close();</span>

<span class="fc" id="L469">			query = &quot;SELECT EMPTEMPLATE.SID ESID ,SKILL.SID SSID, PRIORITY, EMPTEMPLATESKILL.PROFICIENCY,RESERVELEVEL FROM EMPTEMPLATE,EMPTEMPLATESKILL,SKILL &quot;</span>
					+ &quot; WHERE SKILLID = SKILL.ID AND SKILL.DELETEONDATE is NULL AND EMPTEMPLATEID = EMPTEMPLATE.ID AND EMPTEMPLATE.SID IN &quot;
					+ sidWhere;
<span class="fc" id="L472">			r = m_dmo.createRowset(query);</span>

			// -------------------------------------------------
			// get data and create skill assignments
			// -------------------------------------------------

<span class="fc bfc" id="L478" title="All 2 branches covered.">			while (r.next()) {</span>
<span class="fc" id="L479">				ID idTemplate = r.getID(&quot;ESID&quot;);</span>
<span class="fc" id="L480">				ID idSkill = r.getID(&quot;SSID&quot;);</span>
<span class="fc" id="L481">				int nPriority = r.getInt(&quot;PRIORITY&quot;);</span>
<span class="fc" id="L482">				double dProficiency = r.getDouble(&quot;PROFICIENCY&quot;);</span>
<span class="fc" id="L483">				int nReserve = r.getInt(&quot;RESERVELEVEL&quot;);</span>

<span class="fc" id="L485">				SkillAssignment pSkill = new SkillAssignment();</span>
<span class="fc" id="L486">				pSkill.setSkillID(idSkill);</span>
<span class="fc" id="L487">				pSkill.setWorkResourceID(idTemplate);</span>
<span class="fc" id="L488">				pSkill.setPriority(nPriority);</span>
<span class="fc" id="L489">				pSkill.setProficiency(dProficiency);</span>
<span class="fc" id="L490">				pSkill.setReserve(nReserve);</span>

<span class="fc" id="L492">				EmployeeTemplate pTemplate = (EmployeeTemplate) hTemplates.get(idTemplate);</span>
<span class="pc bpc" id="L493" title="1 of 2 branches missed.">				if (pTemplate != null) {</span>
<span class="fc" id="L494">					pTemplate.getSkillAssignments().add(pSkill);</span>
				}
<span class="fc" id="L496">			}</span>
<span class="fc" id="L497">			r.close();</span>

			// -------------------------------------------------
			// get data and create assignment rules
			// -------------------------------------------------
<span class="fc" id="L502">			query = &quot;SELECT ET.SID ESID, CW.SID CWSID from EMPTEMPLATE ET, EMPTEMPLATEWORKRULE ECW, COMPLEXWORKRULE CW &quot;</span>
					+ &quot; WHERE ET.ID = ECW.EMPTEMPLATEID AND ECW.COMPLEXWORKRULEID = CW.ID AND ET.SID IN &quot; + sidWhere;
<span class="fc" id="L504">			r = m_dmo.createRowset(query);</span>
<span class="fc bfc" id="L505" title="All 2 branches covered.">			while (r.next()) {</span>
<span class="fc" id="L506">				ID idTemplate = r.getID(&quot;ESID&quot;);</span>
<span class="fc" id="L507">				ID idAssignmentRule = r.getID(&quot;CWSID&quot;);</span>
<span class="fc" id="L508">				EmployeeTemplate pTemplate = (EmployeeTemplate) hTemplates.get(idTemplate);</span>
<span class="pc bpc" id="L509" title="1 of 2 branches missed.">				if (pTemplate != null) {</span>
<span class="fc" id="L510">					pTemplate.getAssignmentRuleIDs().add(new ID(idAssignmentRule));</span>
				}
<span class="fc" id="L512">			}</span>
<span class="fc" id="L513">			r.close();</span>

			// -------------------------------------------------
			// get data and create shift pattern
			// -------------------------------------------------
<span class="fc" id="L518">			query = &quot;SELECT ET.SID ESID, SP.SID SPSID from EMPTEMPLATE ET, SHIFTPATTERNEMPTEMPLATE ES, SHIFTPATTERN SP &quot;</span>
					+ &quot; WHERE ET.ID = ES.EMPTEMPLATEID AND ES.SHIFTPATTERNID = SP.ID AND ET.SID IN &quot; + sidWhere;
<span class="fc" id="L520">			r = m_dmo.createRowset(query);</span>

<span class="fc bfc" id="L522" title="All 2 branches covered.">			while (r.next()) {</span>
<span class="fc" id="L523">				ID idTemplate = r.getID(&quot;ESID&quot;);</span>
<span class="fc" id="L524">				ID idShiftPattern = r.getID(&quot;SPSID&quot;);</span>
<span class="fc" id="L525">				EmployeeTemplate pTemplate = (EmployeeTemplate) hTemplates.get(idTemplate);</span>
<span class="pc bpc" id="L526" title="1 of 2 branches missed.">				if (pTemplate != null) {</span>
<span class="fc" id="L527">					pTemplate.getShiftPatterns().add(new ID(idShiftPattern));</span>
				}
<span class="fc" id="L529">			}</span>
<span class="fc" id="L530">			r.close();</span>

<span class="fc" id="L532">			return new ArrayList&lt;EmployeeTemplate&gt;(hTemplates.values());</span>
<span class="nc" id="L533">		} catch (JdmoException e) {</span>
<span class="nc" id="L534">			e.printStackTrace();</span>
<span class="nc" id="L535">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Returns the employee templates that use the given shift pattern id
	 * 
	 * @param shiftPatternId
	 *            Shift Pattern Id
	 * @return Employee Templates
	 * @throws BbmFinderException
	 */
	public Collection&lt;EmployeeTemplate&gt; getEmployeeTemplatesUsingShiftPattern(Collection&lt;ID&gt; shiftPatternIds) throws BbmFinderException {
<span class="pc bpc" id="L548" title="2 of 4 branches missed.">		if (shiftPatternIds == null || shiftPatternIds.size() == 0) {</span>
<span class="nc" id="L549">			return Collections.emptyList();</span>
		}

<span class="fc" id="L552">		StringBuffer sidWhere = new StringBuffer(30);</span>
<span class="fc" id="L553">		sidWhere.append(&quot; (SELECT T.SID FROM EMPTEMPLATE T, SHIFTPATTERNEMPTEMPLATE SPT, &quot;);</span>
<span class="fc" id="L554">		sidWhere.append(&quot;SHIFTPATTERN SP WHERE T.ID = SPT.EMPTEMPLATEID AND SPT.SHIFTPATTERNID = SP.ID &quot;);</span>
<span class="fc" id="L555">		sidWhere.append(&quot;AND SP.SID IN (&quot;).append(JdmoUtil.createIDList(shiftPatternIds)).append(&quot;))&quot;);</span>

<span class="fc" id="L557">		return getEmployeeTemplates(sidWhere.toString());</span>
	}

	/**
	 * get employee templates in a given SP
	 */
	public Collection&lt;EmployeeTemplate&gt; getEmployeeTemplatesInSP(ID spID) throws BbmFinderException {
<span class="nc bnc" id="L564" title="All 2 branches missed.">		if (spID == null) {</span>
<span class="nc" id="L565">			return Collections.emptyList();</span>
		}

		try {
<span class="nc" id="L569">			StringBuffer strWhere = new StringBuffer(30);</span>
<span class="nc" id="L570">			strWhere.append(&quot; (select distinct ET.SID from EMPTEMPLATE ET where ET.ID in &quot;);</span>
<span class="nc" id="L571">			strWhere.append(&quot; (select SPET.EMPTEMPLATEID from SPEMPTEMPLATE SPET where SPET.SPID = &quot;);</span>
<span class="nc" id="L572">			strWhere.append(&quot; (select ID from SP where SID = &quot;).append(spID).append(&quot;)))&quot;);</span>

<span class="nc" id="L574">			return getEmployeeTemplates(strWhere.toString());</span>
<span class="nc" id="L575">		} catch (Exception e) {</span>
<span class="nc" id="L576">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * get employee templates in a set of given organizations
	 */
	public Collection&lt;EmployeeTemplate&gt; getEmployeeTemplatesInOrgs(Collection&lt;ID&gt; colOrgIDs) throws BbmFinderException {
<span class="pc bpc" id="L584" title="2 of 4 branches missed.">		if (colOrgIDs == null || colOrgIDs.isEmpty()) {</span>
<span class="nc" id="L585">			return Collections.emptyList();</span>
		}

		try {
<span class="fc" id="L589">			String inClause = m_dmo.createInClause(colOrgIDs);</span>
<span class="fc" id="L590">			String strWhere = &quot;(SELECT SID FROM EMPTEMPLATE WHERE ORGANIZATIONID IN (&quot; + inClause + &quot;))&quot;;</span>
<span class="fc" id="L591">			return getEmployeeTemplates(strWhere);</span>
<span class="nc" id="L592">		} catch (JdmoException ex) {</span>
<span class="nc" id="L593">			throw new BbmFinderException(ex);</span>
		}
	}

	/**
	 * get employee templates in a given org and all its parent orgs
	 *
	 */
	public Collection&lt;EmployeeTemplate&gt; getAvailableEmployeeTemplatesInOrg(ID idOrg) throws BbmFinderException {
<span class="nc bnc" id="L602" title="All 2 branches missed.">		if (idOrg == null) {</span>
<span class="nc" id="L603">			return Collections.emptyList();</span>
		}
<span class="nc" id="L605">		Collection&lt;ID&gt; colOrgIDs = DAOUtil.getParentOrganizationsCollection(idOrg, m_dmo);</span>
<span class="nc bnc" id="L606" title="All 2 branches missed.">		if (colOrgIDs == null) {</span>
<span class="nc" id="L607">			colOrgIDs = new ArrayList&lt;ID&gt;();</span>
		}

<span class="nc" id="L610">		colOrgIDs.add(idOrg);</span>

<span class="nc" id="L612">		StringBuffer strWhere = new StringBuffer(30);</span>
		try {
<span class="nc" id="L614">			strWhere.append(&quot; A.ID in (select distinct B.ID from WORKRESOURCE B, WORKRESOURCEORGANIZATION C &quot;);</span>
<span class="nc" id="L615">			strWhere.append(&quot; where B.WORKRESTYPE = 'template' and C.ORGANIZATIONID IN &quot;).append(</span>
<span class="nc" id="L616">					m_dmo.createInClause(colOrgIDs));</span>
<span class="nc" id="L617">			strWhere.append(&quot; and B.ID = C.WORKRESOURCEID)&quot;);</span>
<span class="nc" id="L618">		} catch (Exception e) {</span>
<span class="nc" id="L619">			throw new BbmFinderException(e);</span>
<span class="nc" id="L620">		}</span>

<span class="nc" id="L622">		return getObjects(new String(strWhere));</span>
	}

	public void deleteChildlessHiddenEmployeeTemplate() throws BbmRemoveException {
		try {
<span class="nc" id="L627">			String where = &quot;select id from emptemplate where ishidden = 1 and not exists (select * from phantom where emptemplateid=emptemplate.sid)&quot;;</span>
<span class="nc" id="L628">			DAOUtil.deleteObjects(m_dmo, getFieldInfo().getTableName(), where);</span>
<span class="nc" id="L629">		} catch (JdmoException ex) {</span>
<span class="nc" id="L630">			throw new BbmRemoveException(ex);</span>
<span class="nc" id="L631">		}</span>
<span class="nc" id="L632">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>