<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>QueueAttributeFilterPageModel.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.bbm.workload.queue.selection.queueattribute.filter</a> &gt; <span class="el_source">QueueAttributeFilterPageModel.java</span></div><h1>QueueAttributeFilterPageModel.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.bbm.workload.queue.selection.queueattribute.filter;

import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.Collection;
import java.util.Collections;
import java.util.Date;
import java.util.Hashtable;
import java.util.Iterator;
import java.util.ResourceBundle;
import java.util.TimeZone;

import javax.servlet.http.HttpServletRequest;


import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.StringsPair;
import com.bluepumpkin.common.logging.Category;
import com.bluepumpkin.common.util.StringUtil;
import com.bluepumpkin.ejb.bbm.workload.model.Media;
import com.bluepumpkin.ejb.bbm.workload.model.queueattribute.QueueAttributeDefintion;
import com.bluepumpkin.ejb.bbm.workload.model.queueattribute.QueueAttributeDropDown;
import com.bluepumpkin.ejb.bbm.workload.model.queueattribute.QueueAttributeFilter;
import com.bluepumpkin.ejb.bbm.workload.model.queueattribute.QueueAttributeFilterMedia;
import com.bluepumpkin.ejb.bbm.workload.model.queueattribute.QueueAttributeFilterSelectedBooleanValue;
import com.bluepumpkin.ejb.bbm.workload.model.queueattribute.QueueAttributeFilterSelectedDateValue;
import com.bluepumpkin.ejb.bbm.workload.model.queueattribute.QueueAttributeFilterSelectedDropDownValue;
import com.bluepumpkin.ejb.bbm.workload.model.queueattribute.QueueAttributeFilterSelectedNumericValue;
import com.bluepumpkin.ejb.bbm.workload.model.queueattribute.QueueAttributeFilterSelectedOrganization;
import com.bluepumpkin.ejb.bbm.workload.model.queueattribute.QueueAttributeFilterSelectedTextValue;
import com.bluepumpkin.ejb.bbm.workload.model.queueattribute.QueueAttributeType;
import com.bluepumpkin.ejb.bbm.workresource.model.Organization;
import com.bluepumpkin.web.bbm.Log;
import com.bluepumpkin.web.bbm.l10n.BbmWebBundleKey;
import com.bluepumpkin.web.bbm.organization.OrganizationModelHandler;
import com.bluepumpkin.web.bbm.organization.tree.OrganizationTreePC;
import com.bluepumpkin.web.bbm.workload.WorkloadModelHandler;
import com.bluepumpkin.web.bbm.workload.queue.selection.queueattribute.QueueAttributeDefinitionModelHandler;
import com.bluepumpkin.web.core.keys.PageKeys;
import com.bluepumpkin.web.core.pagecomponent.dialogbox.DialogBoxPC;
import com.verint.web.wfm.keys.WfmJavaScriptFileID;
import com.witness.ejb.core.security.PrivilegeKeys;
import com.witness.web.uif.base.Message;
import com.witness.web.uif.jsp.HtmlInput;
import com.witness.web.uif.jsp.HtmlSpan;
import com.witness.web.uif.jsp.HtmlTable;
import com.witness.web.uif.jsp.HtmlTableCell;
import com.witness.web.uif.jsp.HtmlTableRow;
import com.witness.web.uif.keys.JavaScriptFileID;
import com.witness.web.uif.keys.PageAction;
import com.witness.web.uif.keys.UserPreferenceKeys;
import com.witness.web.uif.l10n.UIFWebBundleKey;
import com.witness.web.uif.pagecomponent.DefaultMultiColumnNodeData;
import com.witness.web.uif.pagecomponent.form.FormInputPC;
import com.witness.web.uif.pagecomponent.list.DynamicMultiColListPC;
import com.witness.web.uif.pagecomponent.list.ListBoxPC;
import com.witness.web.uif.pagecomponent.list.OptionData;
import com.witness.web.uif.pagecomponent.picker.date.DateRangePickerPC;
import com.witness.web.uif.pagecomponent.table.TableHeaderPC;
import com.witness.web.uif.pagecomponent.toolbar.DialogTextButton;
import com.witness.web.uif.pagecomponent.toolbar.ToolbarPC;
import com.witness.web.uif.pagecomponent.toolbar.ToolbarTextButton;
import com.witness.web.uif.pagemodel.PopupWindowPM;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.system.manager.impl.DefaultVerticalizationManager;
import com.witness.web.uif.util.HtmlUtil;
import com.witness.web.uif.util.html.HtmlBooleanCheckbox;
import com.witness.web.uif.util.js.JSUtil;
import com.witness.web.uif.validator.IsNonNegativeIntegerFieldValidator;

/**
 * Title: NamedFilterPageModel
 * Description: 
 * Copyright: 
 * Company: Blue Pumpkin Software, Inc
 *
 * @author Sankar Nair
 * @version 1.0
 */


public class QueueAttributeFilterPageModel extends PopupWindowPM {
	private static final String SHOW_ROOT_QUEUES_ONLY_FN = &quot;SHOW_ROOT_QUEUES_ONLY_FN&quot;;
	private static final String QUEUE_ATTRIB_VALUE_HOLDER = &quot;QUEUE_ATTRIB_VALUE_&quot;;
	private static final String APPLICATION_MEDIATOR_CUSTOM_DIRTY = &quot;applicationMediator.customDirty();&quot;;
	private static final String MEDIA_ID = &quot;MEDIAID&quot;;
	private static final String SHOW_ROOT_QUEUES_ONLY_ID = &quot;SHOW_ROOT_QUEUES_ONLY_ID&quot;;
	private static final String SELECTED_TEXT_DD_INDEXES = &quot;SELECTED_TEXT_DD_INDEXES&quot;;
	
	public static final String SELECTED_ORGANIZATIONS_FN = &quot;SELECTED_ORGANIZATIONS_FN&quot;;
	private static final String IS_FILTER_EDITABLE = &quot;IS_FILTER_EDITABLE&quot;; 
	
	public static final String QUEUE_ATTRIB_FILTER_ID_FN = &quot;QUEUE_ATTRIBUTE_FILTER_ID_FN&quot;;
	public static final String QUEUE_ATTRIB_DD_TEST_FN = &quot;QUEUE_ATTRIB_DD_TEST_FN&quot;;
	public static final String NAMED_FILTER_NAME_FN = &quot;NAMED_FILTER_NAME_FN&quot;;
	
	private static final String EXISTING_NAMEDFILTER_NAME_FN = &quot;EXISTING_NAMEDFILTER_NAME_FN&quot;;
	
	public static final String NAMED_FILTER_IS_PUBLIC_FN = &quot;NAMED_FILTER_IS_PUBLIC_FN&quot;;
	public static final String NAMED_FILTER_IS_DEFAULT_FN = &quot;NAMED_FILTER_IS_DEFAULT_FN&quot;;
	public static final String NAMED_FILTER_IS_ACTIVE = &quot;NAMED_FILTER_IS_ACTIVE&quot;;
	
	
<span class="nc" id="L105">	private boolean namedFilterIsPublic = false;</span>
<span class="nc" id="L106">	private boolean isDefaultFilter = false;</span>
	
<span class="fc" id="L108">	private static Category log = Log.initCategory(QueueAttributeFilterPageModel.class.getName());</span>
	private static final String ORG_TREE_PC_NAME = &quot;orgTreePC&quot;;

	public final static String modelKey = &quot;QueueAttributeFilterPageModelKey&quot;;

	
<span class="nc" id="L114">	private Collection&lt;QueueAttributeDefintion&gt; queueAttributeDefinitions = null;</span>

	private ResourceBundle m_bundle;
	private OrganizationTreePC m_orgTreePC;
<span class="nc" id="L118">	private String m_sFilterName = null;</span>
	private String m_sDefaultFilterName;
<span class="nc" id="L120">	private boolean showRootQueueOnly = false;</span>
<span class="nc" id="L121">	private ID namedFilterID = null;</span>

<span class="nc" id="L123">	private DynamicMultiColListPC attributesHolder = null;</span>
	
<span class="nc" id="L125">	private QueueAttributeFilter modelComponent = null;</span>
	private ListBoxPC m_filterNamesPC;

	public static final String CHANGE_FILTER = UIFWebBundleKey.TOOLBAR_CONFIGURE;
	public static final String APPLY_SELECTION = &quot;APPLY_SELECTION&quot;;
	public static final String APPLY_ORG_SELECTION = &quot;APPLY_ORG_SELECTION&quot;;
	public static final String SHOW_DROP_DOWN_OPTIONS = &quot;SHOW_DROP_DOWN_OPTIONS&quot;;
	
	public static final String UPDATE = &quot;UPDATE&quot;;
	private DialogBoxPC m_dialogPC;
	
	private FormInputPC m_inputPCOne;

<span class="nc" id="L138">	private Object[] verticalizationObjectArray = null;</span>
    
    
	public static final String DATE_RANGE_FN = &quot;dateRange&quot;;
<span class="nc" id="L142">	private DateRangePickerPC dateRangePickerPC = null;</span>

<span class="nc" id="L144">	private StringBuffer requiredHtml = null;</span>
<span class="nc" id="L145">	ToolbarTextButton refreshAttributesButton = null;</span>
<span class="nc" id="L146">	ToolbarTextButton applyOrgSelection = null;</span>
<span class="nc" id="L147">	private String namedFilterName = &quot;&quot;;</span>

<span class="nc" id="L149">	private ListBoxPC m_duplicateList = null;</span>
	
	public String getApplySelectionButton() {
<span class="nc" id="L152">		return refreshAttributesButton.getHtmlDisplay();</span>
	}
	
	
	public String getApplyOrgSelectionButton() {
<span class="nc" id="L157">		return applyOrgSelection.getHtmlDisplay();</span>
	}


	public QueueAttributeFilterPageModel(RequestContext context) {
<span class="nc" id="L162">		super(context);</span>
<span class="nc" id="L163">		m_bundle = m_localizer.getBundle(BbmWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L164">		requiredHtml = new StringBuffer(&quot;&quot;);</span>
		
//		 Organization tree panel
<span class="nc" id="L167">		m_orgTreePC = new OrganizationTreePC(m_context);</span>
<span class="nc" id="L168">		m_orgTreePC.setName(ORG_TREE_PC_NAME);</span>
<span class="nc" id="L169">		m_orgTreePC.setInputSelectorEditablePrivID(PrivilegeKeys.CORE_VIEWPEOPLE_ID, Organization.SCOPE_TYPE);</span>
<span class="nc" id="L170">		addChildComponent(m_orgTreePC);</span>

		
<span class="nc" id="L173">		refreshAttributesButton = new ToolbarTextButton(m_toolbar, APPLY_SELECTION, &quot;&lt;b&gt;&quot; + i18n(m_bundle, BbmWebBundleKey.QUEUE_ATTRIBUTE_APPLY_SELECTION) + &quot;&lt;/b&gt;&quot;, ToolbarTextButton.BLUE_BUTTON);</span>
<span class="nc" id="L174">		refreshAttributesButton.setAttribute(&quot;width&quot;, &quot;100%&quot;);</span>
		
<span class="nc" id="L176">		applyOrgSelection = new ToolbarTextButton(m_toolbar, APPLY_ORG_SELECTION, &quot;&lt;b&gt;&quot; + i18n(m_bundle, BbmWebBundleKey.QUEUE_ATTRIBUTE_APPLY_SELECTION) + &quot;&lt;/b&gt;&quot;, ToolbarTextButton.BLUE_BUTTON);</span>
<span class="nc" id="L177">		applyOrgSelection.setAttribute(&quot;width&quot;, &quot;100%&quot;);</span>
<span class="nc" id="L178">		String btnStyle = applyOrgSelection.getButtonTag().getAttribute(&quot;style&quot;) + &quot;; width:100%;&quot;;</span>
<span class="nc" id="L179">		applyOrgSelection.getButtonTag().setAttribute(&quot;style&quot;, btnStyle);</span>

<span class="nc" id="L181">		attributesHolder = initializeAttributeEditorTable(context);</span>
		
<span class="nc" id="L183">		addChildComponent(attributesHolder); </span>

<span class="nc" id="L185">		setName(&quot;applicationMediator&quot;);</span>

//		 validators
<span class="nc" id="L188">		addValidator(new IsNonNegativeIntegerFieldValidator(this, &quot;lastnDays&quot;, BbmWebBundleKey.LastNDaysValidationMessage, BbmWebBundleKey.BUNDLE_NAME));</span>

<span class="nc" id="L190">		addRequiredJavaScriptFile(JavaScriptFileID.MODULE_MULTILINEFILTER);</span>
<span class="nc" id="L191">		addRequiredJavaScriptFile(JavaScriptFileID.MEDIATOR_POPUP);</span>

<span class="nc" id="L193">		setJSMediator(WfmJavaScriptFileID.MODULE_QUEUEATTRIBUTE_MEDIATOR);</span>
		
<span class="nc" id="L195">		addJSVariable(&quot;unsavedAttributeChange&quot;, m_bundle, BbmWebBundleKey.UNSAVED_ATTRIBUTE_CHANGE_MESSAGE);</span>
<span class="nc" id="L196">		addJSVariable(&quot;emptyFilterName&quot;, m_bundle, BbmWebBundleKey.EMPTY_NAMED_FILTER_NAME);</span>
<span class="nc" id="L197">		addJSVariable(&quot;duplicateFilterName&quot;, m_bundle, BbmWebBundleKey.DUPLICATE_NAMED_FILTER_NAME);</span>
<span class="nc" id="L198">		addJSVariable(&quot;noQueuesSelected&quot;, m_bundle, BbmWebBundleKey.NO_QUEUES_SELECTED);</span>
<span class="nc" id="L199">		addJSVariable(&quot;noOrganizationsSelected&quot;, m_bundle, BbmWebBundleKey.NO_ORGS_SELECTED);</span>
<span class="nc" id="L200">		addJSVariable(&quot;noDataSourcesSelected&quot;, m_bundle, BbmWebBundleKey.NO_DATASOURCE_SELECTED);</span>
<span class="nc" id="L201">		addJSVariable(&quot;activeFilterConfirmation&quot;, m_bundle, BbmWebBundleKey.WITS_ACTIVE_NAMED_FILTER_MESSAGE);</span>
<span class="nc" id="L202">		addJSVariable(&quot;numericValueNotEntered&quot;, m_bundle, BbmWebBundleKey.WITS_INVALID_NUMERIC_VALUE);</span>
<span class="nc" id="L203">		addJSVariable(&quot;distinctValueCountWarning&quot;, m_bundle, BbmWebBundleKey.WITS_DISTINCT_RECORD_COUNT);</span>
<span class="nc" id="L204">		addJSVariable(&quot;numericRangeInvalid&quot;, m_bundle, BbmWebBundleKey.WITS_INVALID_NUMERIC_RANGE);</span>
<span class="nc" id="L205">		addJSVariable(&quot;dateStartRangeInvalid&quot;, m_bundle, BbmWebBundleKey.WITS_INVALID_START_DATE_RANGE);</span>
<span class="nc" id="L206">		addJSVariable(&quot;dateEndRangeInvalid&quot;, m_bundle, BbmWebBundleKey.WITS_INVALID_END_DATE_RANGE);</span>
<span class="nc" id="L207">		addJSVariable(&quot;unsavedOrgSelection&quot;, m_bundle, BbmWebBundleKey.QUEUE_ATTRIBUTE_UNSAVED_ORGCHANGE);</span>
		
<span class="nc" id="L209">		m_inputPCOne = new FormInputPC(context); // small input box -</span>
<span class="nc" id="L210">		m_inputPCOne.reset(&quot;&quot;, &quot;&quot;, FormInputPC.TYPE_STRING, false); //$NON-NLS-1$ //$NON-NLS-2$</span>
		// fixed size
<span class="nc" id="L212">		m_inputPCOne.setSize(15);</span>
<span class="nc" id="L213">		addChildComponent(m_inputPCOne);</span>
		
<span class="nc" id="L215">		queueAttributeDefinitions = Collections.emptyList();</span>
	
<span class="nc" id="L217">		m_duplicateList = new ListBoxPC(context);</span>
<span class="nc" id="L218">		addChildComponent(m_duplicateList);</span>
<span class="nc" id="L219">	}</span>
	
	
	private Collection&lt;QueueAttributeFilter&gt; getVisibleFilters() throws Exception {
<span class="nc" id="L223">		Collection orgIDsIDOnly = OrganizationModelHandler.getAllOrgsInUserScope(m_context, m_context.getUser());</span>
<span class="nc bnc" id="L224" title="All 2 branches missed.">		if(orgIDsIDOnly == null)</span>
<span class="nc" id="L225">			orgIDsIDOnly = Collections.emptyList();</span>
<span class="nc" id="L226">		ArrayList&lt;ID&gt; orgIDList = new ArrayList&lt;ID&gt;();</span>
<span class="nc" id="L227">		Iterator orgIter = orgIDsIDOnly.iterator();</span>
<span class="nc bnc" id="L228" title="All 2 branches missed.">		while(orgIter.hasNext()) {</span>
<span class="nc" id="L229">			Organization org = (Organization)orgIter.next();</span>
<span class="nc" id="L230">			orgIDList.add(org.getID());</span>
<span class="nc" id="L231">		}</span>
		
<span class="nc" id="L233">		return QueueAttributeFilterModelHandler.getPublicQueueAttributeFilterForUser(m_context.getUser().getID(), orgIDList);</span>
		
	}
	private void initFilterList() {
<span class="nc" id="L237">		m_filterNamesPC = new ListBoxPC(m_context);</span>
<span class="nc" id="L238">		m_filterNamesPC.setName(&quot;filterList&quot;);</span>
		
<span class="nc" id="L240">		String selectedName = &quot;&quot;;</span>
<span class="nc bnc" id="L241" title="All 2 branches missed.">		if(modelComponent != null)</span>
<span class="nc" id="L242">		selectedName = modelComponent.getName();</span>
		
<span class="nc" id="L244">		ArrayList filters = new ArrayList();</span>

		// Add Default ALL Filter
		try {
<span class="nc bnc" id="L248" title="All 2 branches missed.">		for (Iterator it = getVisibleFilters().iterator(); it.hasNext();) {</span>
<span class="nc" id="L249">			QueueAttributeFilter filter = (QueueAttributeFilter) it.next();</span>
<span class="nc" id="L250">			OptionData data = new OptionData(filter.getName(), filter.getID().toString());</span>
<span class="nc bnc" id="L251" title="All 2 branches missed.">			if (filter.getName().equals(selectedName)) {// || isDefaultALLSelected) {</span>
<span class="nc" id="L252">				data.setSelected(true);</span>
				//if (isDefaultALLSelected) {
					//data.setKey(&quot;all&quot;);
				//}
			}

<span class="nc" id="L258">			filters.add(data);</span>
<span class="nc" id="L259">		}</span>
<span class="nc" id="L260">		m_filterNamesPC.setOptions(filters);</span>
<span class="nc" id="L261">		} catch(Exception e) {</span>
<span class="nc" id="L262">			e.printStackTrace();</span>
			//Not calling the unable to load data 
<span class="nc" id="L264">		}</span>
<span class="nc" id="L265">		addChildComponent(m_filterNamesPC);</span>
<span class="nc" id="L266">	}</span>

	
	private void populateDuplicateCheck() {
<span class="nc" id="L270">		m_duplicateList.setName(&quot;DuplicateNameCheck&quot;);</span>
		//addChildComponent(m_duplicateList);
<span class="nc" id="L272">		m_duplicateList.getWrapper().setAttribute(&quot;style&quot;, &quot;visibility:hidden;&quot;);</span>
		try {
<span class="nc" id="L274">			Collection&lt;String&gt; duplicateNamechecker = QueueAttributeFilterModelHandler.getExistingQueueAttributeFilterNames();</span>
<span class="nc" id="L275">			m_duplicateList.setOptions(duplicateNamechecker);</span>
<span class="nc" id="L276">			HtmlTable table = new HtmlTable(&quot;0&quot;, &quot;0&quot;, &quot;0&quot;);</span>
<span class="nc" id="L277">			HtmlTableRow row = new HtmlTableRow();</span>
			
<span class="nc" id="L279">			HtmlSpan span = new HtmlSpan();</span>
<span class="nc" id="L280">			span.setAttribute(&quot;style&quot;, &quot;visibility:hidden;&quot;);</span>
<span class="nc" id="L281">			row.add(m_duplicateList.getHtmlDisplay());</span>
<span class="nc" id="L282">			table.add(row.toString());</span>
<span class="nc" id="L283">			span.setInnerHtml(table.toString());</span>
<span class="nc" id="L284">			m_contentTitlePC.addAdditionalComponent(span);</span>
			
<span class="nc" id="L286">		} catch(Exception e) {</span>
<span class="nc" id="L287">			e.printStackTrace();</span>
<span class="nc" id="L288">			handleUnableToLoadDataError(log, e);</span>
<span class="nc" id="L289">		}</span>
<span class="nc" id="L290">	}</span>
	
	
	private DynamicMultiColListPC initializeAttributeEditorTable (RequestContext context) {
<span class="nc" id="L294">		DynamicMultiColListPC table = new DynamicMultiColListPC(context);</span>
<span class="nc" id="L295">		table.setName(&quot;ATTRIBUTES_EDITOR_TABLE&quot;);</span>
		// buttons

<span class="nc bnc" id="L298" title="All 2 branches missed.">		if(verticalizationObjectArray == null) {</span>
<span class="nc" id="L299">			verticalizationObjectArray = new Object[1];</span>
<span class="nc" id="L300">			verticalizationObjectArray[0] = m_context.getSystemManagerFactory().getVerticalizationManager().getVerticalizedString(m_context, DefaultVerticalizationManager.QUEUE);</span>
		}
<span class="nc" id="L302">		TableHeaderPC header = table.getHeader();</span>
		
		
	    
<span class="nc" id="L306">		header.addColumnHeaderData(&quot;col1&quot;, m_localizer.i18n(m_bundle, BbmWebBundleKey.QUEUE_ATTRIBUTE_ATTRIBUTES, verticalizationObjectArray));</span>
<span class="nc" id="L307">		header.addColumnHeaderData(&quot;col2&quot;, i18n(m_bundle, m_localizer.i18n(m_bundle, BbmWebBundleKey.QUEUE_ATTRIBUTE_ATTRIBUTE_VALUES, verticalizationObjectArray)));</span>
		
<span class="nc" id="L309">		header.addColumnHeaderData(&quot;&quot;, &quot;&quot;); // for hidden id //$NON-NLS-1$ //$NON-NLS-2$</span>
<span class="nc" id="L310">		header.addColumnHeaderData(&quot;&quot;, &quot;&quot;); // for hidden type</span>
<span class="nc" id="L311">		header.addColumnHeaderData(&quot;&quot;, &quot;&quot;); // for hidden type</span>
<span class="nc" id="L312">		return table;</span>
	}
	
	
    
	/**
	 * Static method constructs an instance of this class properly
	 * loaded with data.
	 */
	public synchronized static QueueAttributeFilterPageModel getInstance(RequestContext context) {
<span class="nc" id="L322">		return (QueueAttributeFilterPageModel)context.getRequest().getAttribute(QueueAttributeFilterPageModel.modelKey);</span>
		
	}

	public boolean extractParameters(HttpServletRequest request) {
<span class="nc" id="L327">		boolean bFlag = super.extractParameters(request);</span>
		//extractAttributesSelection(request);
<span class="nc" id="L329">		return bFlag;</span>
	}
	
	
	
	public String getFilterName() {
		try {
<span class="nc bnc" id="L336" title="All 2 branches missed.">		if (m_sFilterName == null) {</span>
			// if we are creating a new filter, use the 'All' filter
			// to fill the filter with data.
<span class="nc" id="L339">			String sName = m_context.getUserProperty(UserPreferenceKeys.QUEUE_ATTRIBUTE_FILTER);</span>
<span class="nc bnc" id="L340" title="All 2 branches missed.">			m_sFilterName = (sName == null) ? getDefaultFilterName() : sName;</span>
		}
<span class="nc" id="L342">		} catch(Exception e) {</span>
<span class="nc" id="L343">			e.printStackTrace();</span>
<span class="nc" id="L344">		}</span>
<span class="nc" id="L345">		return m_sFilterName;</span>
	}

	public String getDefaultFilterName() {
		try {
<span class="nc bnc" id="L350" title="All 2 branches missed.">		if (m_sDefaultFilterName == null) {</span>
<span class="nc" id="L351">			String sName = m_context.getUserProperty(UserPreferenceKeys.USER_DEFAULT_FILTER);</span>
			// if there is no default, make the 'All' filter the
			// default. We do NOT
			// store it as the default however, because there may be
			// other places in the
			// class that need to know that there was no default
			// set.
<span class="nc bnc" id="L358" title="All 2 branches missed.">			m_sDefaultFilterName = (sName == null) ? PageKeys.DEFAULT_ALL : sName;</span>
		}
<span class="nc" id="L360">		} catch(Exception e) {</span>
<span class="nc" id="L361">			e.printStackTrace();</span>
<span class="nc" id="L362">		}</span>
<span class="nc" id="L363">		return m_sDefaultFilterName;</span>
	}


	public void setFilterName(String sName, boolean bSave) {
<span class="nc" id="L368">		m_sFilterName = sName;</span>
		//if (bSave)
			//m_context.setUserProperty(UserPreferenceKeys.QUEUE_ATTRIBUTE_FILTER, m_sFilterName);
<span class="nc" id="L371">	}</span>

		public String getOrgTree() {
<span class="nc" id="L374">		return m_orgTreePC.toString();</span>
	}

	

	public String getAgeBucketPicker() {
<span class="nc" id="L380">		return attributesHolder.getHtmlDisplay();</span>
		
	}
	
	/**
	 * Return the JavaScript init code required to initialize this
	 * component
	 */
	/*public String getJavaScriptInitCode() {
		StringBuffer jsInit = new StringBuffer(1024);
		jsInit.append(&quot;window.opener.popupManager.setValue(\&quot;namedFilter\&quot;,\&quot;&quot;).append(getFilterName()).append(&quot;\&quot;);\n&quot;);

		if (!m_isNameMode) {
			// It is not in Name Mode. Using ID instead so not
			// refreshing but dynamically populate selector
			setIsRefreshOpenerOnClose(false);
			if (m_savedFilterID != null) {
				jsInit.append(&quot;window.opener.&quot;).append(m_sSelectorName).append(&quot;.forceSelectedOption(\&quot;&quot;).append(m_sFilterName).append(&quot;\&quot;,\&quot;&quot;).append(m_savedFilterID).append(&quot;\&quot;);\n&quot;);
			} else if (m_deletedFilterID != null) {
				jsInit.append(&quot;window.opener.&quot;).append(m_sSelectorName).append(&quot;.deleteOption('&quot;).append(m_deletedFilterID).append(&quot;');\n&quot;);
			}
		} else {//In name mode
			if(getIsDynRendering() &amp;&amp; isCloseAfterLoad()){
				// This block of code is added to support smart refresh of selection pane on employee filter create, update and delete.
				if(m_deletedFilterName == null)
					jsInit.append(&quot;window.opener.&quot;).append(m_sSelectorName).append(&quot;.forceSelectedOption(\&quot;&quot;).append(m_sFilterName).append(&quot;\&quot;,\&quot;&quot;).append(m_sFilterName).append(&quot;\&quot;);\n&quot;);
				else
					jsInit.append(&quot;window.opener.&quot;).append(m_sSelectorName).append(&quot;.deleteOption('&quot;).append(m_deletedFilterName).append(&quot;');\n&quot;);
				jsInit.append(&quot;var oNewActionEvent = new ActionEvent( ACTION_INITIATE_SMART_REFRESH, this );&quot;);
				jsInit.append(&quot;window.opener.pageMediator.raiseActionEvent( oNewActionEvent, window.opener.pageMediator );&quot;);
			}
		}

		jsInit.append(super.getJavaScriptInitCode());

		if (m_bIsDirty)
			jsInit.append(&quot;top.applicationMediator.setPageDirty(true);\n&quot;);

		return jsInit.toString();
	}// getJavaScriptInitCode

	*/
	public String getCustomJavaScript() {
<span class="nc" id="L423">		StringBuffer sb = new StringBuffer(super.getCustomJavaScript());</span>

		// Create Custom Resize Function
<span class="nc" id="L426">		sb.append(JSUtil.CUSTOM_RESIZE_FUNC);</span>
		// Height of Org tree: 33% of total height; Grops height: 23% of total height; (Arrived at number of by trial and erro)
		// Rest of the height on left side is for time frame and border.
		// Height of right side filter attributes: 77% total height. Other 23% is for border and othes.
<span class="nc" id="L430">		JSUtil.resizePCByPercentage(ORG_TREE_PC_NAME, 72, 30, sb);</span>
<span class="nc" id="L431">		sb.append(&quot;}\n&quot;);</span>

<span class="nc" id="L433">		return sb.toString();</span>
	}

	
	private void initTitle() {
		
<span class="nc bnc" id="L439" title="All 2 branches missed.">		if(verticalizationObjectArray == null) {</span>
<span class="nc" id="L440">			verticalizationObjectArray = new Object[1];</span>
<span class="nc" id="L441">			verticalizationObjectArray[0] = m_context.getSystemManagerFactory().getVerticalizationManager().getVerticalizedString(m_context, DefaultVerticalizationManager.QUEUE);</span>
		}
<span class="nc" id="L443">	    m_contentTitlePC.setPageTitle(m_localizer.i18n(m_bundle, BbmWebBundleKey.QUEUE_ATTRIBUTE_FILTERCONFIG_PAGE_TITLE, verticalizationObjectArray));</span>
<span class="nc" id="L444">	    populateDuplicateCheck();</span>
	    
<span class="nc" id="L446">	    HtmlTable table = new HtmlTable(&quot;0&quot;, &quot;0&quot;, &quot;0&quot;);</span>
<span class="nc" id="L447">		HtmlTableRow row = new HtmlTableRow();</span>
<span class="nc bnc" id="L448" title="All 2 branches missed.">	    if (modelComponent.getID() == null) {</span>
<span class="nc" id="L449">			m_contentTitlePC.setItemName(m_localizer.i18n(m_bundle, BbmWebBundleKey.QUEUE_ATTRIBUTE_NEW_QUEUE_FILTER, verticalizationObjectArray));</span>
<span class="nc" id="L450">			HtmlSpan span = new HtmlSpan();</span>
<span class="nc" id="L451">			span.setAttribute(&quot;style&quot;, &quot;visibility:hidden;&quot;);</span>
<span class="nc" id="L452">			m_filterNamesPC.getWrapper().setAttribute(&quot;style&quot;, &quot;visibility:hidden;&quot;);</span>
<span class="nc" id="L453">			row.add(m_filterNamesPC.getHtmlDisplay());</span>
<span class="nc" id="L454">			table.add(row.toString());</span>
<span class="nc" id="L455">			span.setInnerHtml(table.toString());</span>
<span class="nc" id="L456">			m_contentTitlePC.addAdditionalComponent(span);</span>
<span class="nc" id="L457">		} else {</span>
<span class="nc" id="L458">			m_contentTitlePC.setItemName(i18n(m_bundle, modelComponent.getName()));</span>
			
<span class="nc" id="L460">			HtmlTableCell cell = new HtmlTableCell();</span>
<span class="nc" id="L461">			cell.setAttribute(&quot;class&quot;, &quot;headerText2&quot;);</span>
<span class="nc" id="L462">			cell.setInnerHtml(m_localizer.i18n(BbmWebBundleKey.BUNDLE_NAME, BbmWebBundleKey.PEOPLE_FILTER_LIST));</span>
<span class="nc" id="L463">			row.add(cell.toString());</span>
<span class="nc" id="L464">			row.add(m_filterNamesPC.getHtmlDisplay());</span>
<span class="nc" id="L465">			table.add(row.toString());</span>
<span class="nc" id="L466">			m_contentTitlePC.addAdditionalComponent(table);</span>
		}
	    
	    
<span class="nc" id="L470">	}</span>

	
<span class="nc" id="L473">	private String selectedOrganizationList = &quot;&quot;;</span>
	
	public void initComponents() { 
		
<span class="nc" id="L477">		requiredHtml = new StringBuffer(&quot;&quot;); //Resetting the required HTML part</span>
<span class="nc" id="L478">		initFilterList();</span>
<span class="nc" id="L479">		initTitle();</span>
		
<span class="nc" id="L481">		initTableToolbar();</span>
<span class="nc" id="L482">		initDialog();</span>

<span class="nc" id="L484">		initOrgTree();</span>
		
<span class="nc" id="L486">		addAtributesToBeEdited();</span>
		
<span class="nc bnc" id="L488" title="All 4 branches missed.">		if(modelComponent.getUserID() != null &amp;&amp; (!modelComponent.getUserID().equals(m_context.getUser().getID()))) {</span>
<span class="nc" id="L489">			refreshAttributesButton.setEnabled(false);</span>
<span class="nc" id="L490">			applyOrgSelection.setEnabled(false);</span>
<span class="nc" id="L491">			m_context.addGenericHTML(HtmlUtil.makeHiddenInput(IS_FILTER_EDITABLE, &quot;false&quot;));</span>
		} else {
<span class="nc" id="L493">			m_context.addGenericHTML(HtmlUtil.makeHiddenInput(IS_FILTER_EDITABLE, &quot;true&quot;));</span>
		}
		
<span class="nc" id="L496">		m_context.addGenericHTML(HtmlUtil.makeHiddenInput(SELECTED_TEXT_DD_INDEXES, &quot;&quot;));</span>
<span class="nc" id="L497">		m_context.addGenericHTML(HtmlUtil.makeHiddenInput(SELECTED_ORGANIZATIONS_FN, selectedOrganizationList));</span>
<span class="nc" id="L498">		m_context.addGenericHTML(HtmlUtil.makeHiddenInput(NAMED_FILTER_NAME_FN, namedFilterName));</span>
<span class="nc" id="L499">		m_context.addGenericHTML(HtmlUtil.makeHiddenInput(NAMED_FILTER_IS_PUBLIC_FN, namedFilterIsPublic));</span>
<span class="nc" id="L500">		m_context.addGenericHTML(HtmlUtil.makeHiddenInput(NAMED_FILTER_IS_DEFAULT_FN, isDefaultFilter));</span>
<span class="nc" id="L501">		m_context.addGenericHTML(HtmlUtil.makeHiddenInput(QUEUE_ATTRIB_FILTER_ID_FN, namedFilterID));</span>
		//The namedFilterID is set as the value as the URL of the popup page always have the QUEUE_ATTRIB_FILTER_ID_FN=&lt;initially selected filterid&gt;
		//as the URL. This prevents any change to QUEUE_ATTRIB_FILTER_ID_FN from getting reflected. So setting the current named filter ID
		//always as the DD url also.
<span class="nc" id="L505">		m_context.addGenericHTML(HtmlUtil.makeHiddenInput(QUEUE_ATTRIB_DD_TEST_FN, namedFilterID));</span>
<span class="nc" id="L506">	}</span>
	

	
	private void initDialog() {
		// Make an dialog box with the default padding, and dynamic
		// sizing.
<span class="nc" id="L513">		m_dialogPC = new DialogBoxPC(m_context, &quot;SaveAsDlg&quot;);</span>
<span class="nc" id="L514">		m_dialogPC.setWidth(&quot;210&quot;);</span>
<span class="nc" id="L515">		m_dialogPC.getWrapper().setAttribute(&quot;onMouseDown&quot;, &quot;dragStart(event, '&quot; + m_dialogPC.getName() + &quot;Wrapper')&quot;);</span>
		
<span class="nc" id="L517">		HtmlTable table = new HtmlTable(&quot;0&quot;, &quot;0&quot;, &quot;0&quot;);</span>
<span class="nc" id="L518">		table.setAttribute(&quot;align&quot;, &quot;center&quot;);</span>
<span class="nc" id="L519">		table.setAttribute(&quot;valign&quot;, &quot;center&quot;);</span>

<span class="nc" id="L521">		HtmlTableRow row = new HtmlTableRow();</span>
<span class="nc" id="L522">		row.setAttribute(&quot;align&quot;, &quot;center&quot;);</span>
<span class="nc" id="L523">		row.setAttribute(&quot;width&quot;, &quot;100%&quot;);</span>

<span class="nc" id="L525">		HtmlTableCell cell = new HtmlTableCell();</span>
<span class="nc" id="L526">		cell.setAttribute(&quot;align&quot;, &quot;center&quot;);</span>
<span class="nc" id="L527">		cell.setAttribute(&quot;width&quot;, &quot;100%&quot;);</span>

		// insert Title
<span class="nc" id="L530">		cell.setAttribute(&quot;class&quot;, &quot;largelabelText&quot;);</span>
<span class="nc" id="L531">		cell.setInnerHtml(i18n(m_bundle, BbmWebBundleKey.QUEUE_ATTRIBUTE_ENTER_FILTER_NAME));</span>
<span class="nc" id="L532">		row.add(cell.toString());</span>
<span class="nc" id="L533">		table.add(row.toString());</span>

		// insert next row
<span class="nc" id="L536">		row.clear();</span>
<span class="nc" id="L537">		cell.setAttribute(&quot;class&quot;, &quot;labelText&quot;);</span>
<span class="nc" id="L538">		HtmlInput input = new HtmlInput(&quot;saveAsName&quot;);</span>
<span class="nc" id="L539">		input.setAttribute(&quot;maxlength&quot;, &quot;80&quot;);</span>
<span class="nc" id="L540">		input.setAttribute(&quot;width&quot;, &quot;150&quot;);</span>
<span class="nc" id="L541">		input.setAttribute(&quot;class&quot;, &quot;inputText&quot;);</span>
<span class="nc" id="L542">		cell.setInnerHtml(input.toString());</span>
<span class="nc" id="L543">		cell.setAttribute(&quot;nowrap&quot;);</span>
<span class="nc" id="L544">		row.add(cell.toString());</span>
<span class="nc" id="L545">		table.add(row.toString());</span>
<span class="nc" id="L546">		row.clear();</span>
		
<span class="nc" id="L548">		ToolbarPC dlgToolbar = new ToolbarPC(m_context);</span>
<span class="nc" id="L549">		dlgToolbar.setName(&quot;DlgToolbar&quot;);</span>
<span class="nc" id="L550">		dlgToolbar.setEnbleBGColor(false);</span>
<span class="nc" id="L551">		DialogTextButton dlgOK = new DialogTextButton(dlgToolbar, &quot;DIALOG_OK&quot;, m_localizer.i18n(m_common_bundle, UIFWebBundleKey.TOOLBAR_SAVE), ToolbarTextButton.GREEN_BUTTON);</span>
<span class="nc" id="L552">		dlgOK.setActionName(&quot;DIALOG_OK&quot;);</span>
<span class="nc" id="L553">		dlgToolbar.addToolbarElement(dlgOK);</span>
<span class="nc" id="L554">		dlgToolbar.addSpacer(&quot;6&quot;);</span>
		
<span class="nc" id="L556">		DialogTextButton dlgCancel = new DialogTextButton(dlgToolbar, PageAction.CANCEL, m_localizer.i18n(m_common_bundle, UIFWebBundleKey.TOOLBAR_CANCEL), ToolbarTextButton.GREEN_BUTTON);</span>
<span class="nc" id="L557">		dlgCancel.setActionName(&quot;DIALOG_CANCEL&quot;);</span>
<span class="nc" id="L558">		dlgToolbar.addToolbarElement(dlgCancel);</span>
<span class="nc" id="L559">		dlgToolbar.setAlignment(ToolbarPC.ALIGN_CENTER);</span>
<span class="nc" id="L560">		addChildComponent(dlgToolbar);</span>
<span class="nc" id="L561">		row.add(dlgToolbar.getHtmlDisplay());</span>
<span class="nc" id="L562">		table.add(row.toString());</span>

<span class="nc" id="L564">		m_dialogPC.setContents(table.toString());</span>
<span class="nc" id="L565">		addChildComponent(m_dialogPC);</span>
		
		
<span class="nc" id="L568">	}</span>
	
	
	private void initTableToolbar() {
<span class="nc" id="L572">		m_toolbar = new ToolbarPC(m_context);</span>
<span class="nc" id="L573">		m_toolbar.setAlignment(ToolbarPC.ALIGN_NONE);</span>
<span class="nc" id="L574">		m_toolbar.setStyleClass(&quot;toolbarBorder&quot;);</span>
		
<span class="nc" id="L576">		boolean isDisabled = false;</span>
<span class="nc bnc" id="L577" title="All 4 branches missed.">		if(modelComponent.getUserID() != null &amp;&amp; (!modelComponent.getUserID().equals(m_context.getUser().getID())))</span>
<span class="nc" id="L578">			isDisabled = true;</span>
<span class="nc" id="L579">		boolean newFilter = false;</span>
<span class="nc bnc" id="L580" title="All 6 branches missed.">		if(modelComponent == null || modelComponent.getID() == null || new ID(0).equals(modelComponent.getID())) {</span>
<span class="nc" id="L581">			newFilter = true;</span>
		}
<span class="nc" id="L583">		HtmlTableCell cell = new HtmlTableCell();</span>
<span class="nc" id="L584">		cell.setAttribute(&quot;class&quot;, &quot;fText&quot;);</span>
<span class="nc" id="L585">		cell.setAttribute(&quot;nowrap&quot;);</span>
<span class="nc" id="L586">		cell.setInnerHtml(HtmlBooleanCheckbox.makeInput(&quot;isPublicSelector&quot;, i18n(m_bundle, BbmWebBundleKey.QUEUE_ATTRIBUTE_IS_PUBLIC_CAPTION), &quot;applicationMediator.handleIsPublic();&quot;, namedFilterIsPublic, isDisabled));</span>
		
<span class="nc" id="L588">		m_toolbar.addToolbarComponent(cell.toString());</span>
<span class="nc" id="L589">		HtmlTableCell cell1 = new HtmlTableCell();</span>
<span class="nc" id="L590">		cell.setAttribute(&quot;class&quot;, &quot;fText&quot;);</span>
<span class="nc" id="L591">		cell.setAttribute(&quot;nowrap&quot;);</span>
<span class="nc" id="L592">		cell.setInnerHtml(HtmlBooleanCheckbox.makeInput(&quot;isDefaultSelector&quot;, i18n(m_bundle, BbmWebBundleKey.QUEUE_ATTRIBUTE_IS_DEFAULT_CAPTION), &quot;applicationMediator.handleIsDefault();&quot;, isDefaultFilter, isDisabled));</span>
		
<span class="nc" id="L594">		m_toolbar.addToolbarComponent(cell.toString());</span>
<span class="nc" id="L595">		m_toolbar.addSpacer();</span>
		
		
<span class="nc bnc" id="L598" title="All 4 branches missed.">		ToolbarTextButton deleteButton = new ToolbarTextButton(m_toolbar, PageAction.DELETE, m_localizer.i18n(m_common_bundle, UIFWebBundleKey.TOOLBAR_DELETE), ToolbarTextButton.BLUE_BUTTON, (!isDisabled &amp;&amp; !newFilter));</span>
		
<span class="nc" id="L600">		m_toolbar.addToolbarElement(deleteButton);</span>

		
<span class="nc bnc" id="L603" title="All 4 branches missed.">		ToolbarTextButton saveButton = new ToolbarTextButton(m_toolbar, PageAction.SAVE, m_localizer.i18n(m_common_bundle, UIFWebBundleKey.TOOLBAR_SAVE), ToolbarTextButton.BLUE_BUTTON, (!isDisabled  &amp;&amp; !newFilter));</span>
<span class="nc" id="L604">		m_toolbar.addToolbarElement(saveButton);</span>

		
<span class="nc bnc" id="L607" title="All 2 branches missed.">		ToolbarTextButton saveAsButton = new ToolbarTextButton(m_toolbar, PageAction.SAVE_AS,m_localizer.i18n(m_common_bundle, UIFWebBundleKey.TOOLBAR_SAVEAS), ToolbarTextButton.BLUE_BUTTON, !isDisabled);</span>
<span class="nc" id="L608">		m_toolbar.addToolbarElement(saveAsButton);</span>

		
<span class="nc" id="L611">		ToolbarTextButton cancelButton = new ToolbarTextButton(m_toolbar, PageAction.CANCEL, m_localizer.i18n(m_common_bundle, UIFWebBundleKey.TOOLBAR_CANCEL), ToolbarTextButton.BLUE_BUTTON);</span>
<span class="nc" id="L612">		m_toolbar.addToolbarElement(cancelButton);</span>

<span class="nc" id="L614">		m_toolbar.setName(&quot;tableTB&quot;);</span>
<span class="nc" id="L615">		addChildComponent(m_toolbar);</span>
<span class="nc" id="L616">	}</span>

	/**
	 * Initializes the OrganizationTreePC for the Org tree portion
	 * of the page.f
	 */
	public void initOrgTree() {
<span class="nc" id="L623">		m_orgTreePC.setOnSelectAction(OrganizationTreePC.HANDLE_ON_SELECT_SYNC_CHILD);</span>
<span class="nc" id="L624">		Collection temp = null;</span>
		try {
<span class="nc" id="L626">			temp = OrganizationModelHandler.getAllOrgsInUserScopePlusAncestors(m_context, m_context.getUser());</span>
			//temp = QueueAttributeFilterModelHandler.getOrganizations(m_context);
<span class="nc" id="L628">		} catch (Exception e) {</span>
<span class="nc" id="L629">			e.printStackTrace();</span>
<span class="nc" id="L630">			handleUnableToLoadDataError(log, e);</span>
<span class="nc" id="L631">		}</span>
<span class="nc" id="L632">		m_orgTreePC.init(temp);</span>
<span class="nc" id="L633">		m_orgTreePC.getWrapper().setAttribute(&quot;width&quot;, &quot;100%&quot;);</span>
<span class="nc" id="L634">		m_orgTreePC.getWrapper().setAttribute(&quot;style&quot;, &quot;overflow:auto;&quot;);</span>
		
<span class="nc" id="L636">		m_orgTreePC.setOnClickJS(&quot;applicationMediator.handleOrgChange();&quot;);</span>
		
		
		//fit org list within the popup;
<span class="nc" id="L640">		StringBuffer resizeOrgListScript = new StringBuffer();</span>
<span class="nc" id="L641">		resizeOrgListScript.append(&quot;\n&quot;);</span>
<span class="nc" id="L642">		resizeOrgListScript.append(&quot;$('#orgTreePCWrapper').height($('#orgTreePCWrapper').parents('#workAreaWrapper').height() - 50);\n&quot;);</span>
		
<span class="nc" id="L644">		appendJSToJSMain(resizeOrgListScript.toString());</span>
		
<span class="nc bnc" id="L646" title="All 2 branches missed.">		if(!StringUtil.isEmptyOrWhiteSpace(selectedOrganizationList)) {</span>
<span class="nc" id="L647">			String[] orgIDs = selectedOrganizationList.split(&quot;,&quot;);</span>
<span class="nc" id="L648">			ID[] selectedOrgIDList = new ID[orgIDs.length];</span>
<span class="nc bnc" id="L649" title="All 2 branches missed.">			for(int x = 0; x &lt; orgIDs.length; x++) {</span>
<span class="nc" id="L650">				selectedOrgIDList[x] = new ID(orgIDs[x]);</span>
			}
<span class="nc" id="L652">			m_orgTreePC.setCheckedID(selectedOrgIDList);</span>
<span class="nc bnc" id="L653" title="All 4 branches missed.">		} else if(modelComponent != null &amp;&amp; modelComponent.getID() != null) {</span>
<span class="nc bnc" id="L654" title="All 4 branches missed.">			if(modelComponent.getSelectedOrgs() != null &amp;&amp; modelComponent.getSelectedOrgs().size() &gt; 0) {</span>
<span class="nc" id="L655">				StringBuffer orgsBuffer = new StringBuffer();</span>
<span class="nc" id="L656">				ID[] selectedOrgIDList = new ID[modelComponent.getSelectedOrgs().size()];</span>
<span class="nc" id="L657">				int index = 0;</span>
<span class="nc bnc" id="L658" title="All 2 branches missed.">				for (Iterator it = modelComponent.getSelectedOrgs().iterator(); it.hasNext();) {</span>
<span class="nc" id="L659">					QueueAttributeFilterSelectedOrganization org = (QueueAttributeFilterSelectedOrganization)it.next();</span>
<span class="nc" id="L660">					selectedOrgIDList[index++] = org.getQueueAttributeID();</span>
<span class="nc" id="L661">					orgsBuffer.append(org.getQueueAttributeID()).append(&quot;,&quot;);</span>
<span class="nc" id="L662">				}</span>
<span class="nc bnc" id="L663" title="All 2 branches missed.">				if(StringUtil.isEmptyOrWhiteSpace(selectedOrganizationList))</span>
<span class="nc" id="L664">						setOrganizationSelection(orgsBuffer.toString());</span>
				
<span class="nc" id="L666">				m_orgTreePC.setCheckedID(selectedOrgIDList);</span>
<span class="nc" id="L667">			} else {</span>
<span class="nc" id="L668">				m_orgTreePC.setCheckedID(null); // set nor orgs selected.</span>
			}
		} else {
<span class="nc" id="L671">			m_orgTreePC.setCheckedID(null); // set nor orgs selected.</span>
		}
<span class="nc" id="L673">	}</span>
	

	

	public void processDone() {
<span class="nc" id="L679">		setIsCloseAfterLoad(true);</span>
//		if(getIsDynRendering())
		//setIsRefreshOpenerOnClose(true);
<span class="nc" id="L682">		setPageDirty(false);</span>
<span class="nc" id="L683">	}</span>


	public boolean processDelete(ID objNamedFilterID) {
		try {
<span class="nc bnc" id="L688" title="All 2 branches missed.">			if(objNamedFilterID == null)</span>
<span class="nc" id="L689">				throw new NullPointerException(&quot;Named Filter ID is null for deletion&quot;);</span>
<span class="nc" id="L690">			QueueAttributeFilterModelHandler.deleteQueueAttributeFilter(objNamedFilterID);</span>
<span class="nc bnc" id="L691" title="All 2 branches missed.">			if(objNamedFilterID.toString().equals(m_context.getUserProperty(UserPreferenceKeys.QUEUE_ATTRIBUTE_FILTER))) {</span>
<span class="nc" id="L692">				m_context.setUserProperty(UserPreferenceKeys.QUEUE_ATTRIBUTE_FILTER, QueueAttributeFilter.DELETED_ID.toString());</span>
				//m_context.setUserProperty(UserPreferenceKeys.QUEUE_ATTRIBUTE_FILTER, &quot;-1&quot;);
			}
<span class="nc" id="L695">			processDone();</span>
<span class="nc" id="L696">			return true;</span>
<span class="nc" id="L697">		} catch (Exception ex) {</span>
<span class="nc" id="L698">			handleUnableToUpdateInfo(log, ex);</span>
<span class="nc" id="L699">			addPageMessage(Message.ERROR_TYPE, &quot;Failed to delete Queue Attribute Filter&quot;);</span>
		}
<span class="nc" id="L701">		return false;</span>
	}


	/**
	 * Sets Jan 1st 1970 as lower limit and 31st Dec 2078 as upper limit for the date range picker.
	 */
	private void setLowerAndUpperLimit(DateRangePickerPC m_dateRangePicker){
<span class="nc" id="L709">		Calendar calendar = Calendar.getInstance();</span>
<span class="nc" id="L710">		calendar.set(1970, Calendar.JANUARY, 1, 0, 0, 0);</span>
<span class="nc" id="L711">		Date dateLower = calendar.getTime();</span>
<span class="nc" id="L712">		calendar.set(2078,  Calendar.DECEMBER, 31, 0, 0, 0);</span>
<span class="nc" id="L713">		Date dateUpper = calendar.getTime();</span>
<span class="nc" id="L714">		m_dateRangePicker.setLowerAndUpperLimit(dateLower, dateUpper);</span>
<span class="nc" id="L715">	}</span>

	
	public void setOrganizationSelection(String selectedOrganizations) {
<span class="nc" id="L719">		selectedOrganizationList = selectedOrganizations;</span>
<span class="nc" id="L720">	}</span>
	
	public void retrieveQueueAttributes(String selectedOrganizations) {
<span class="nc" id="L723">		setOrganizationSelection(selectedOrganizations);</span>
<span class="nc" id="L724">		String[] orgIDs = selectedOrganizations.split(&quot;,&quot;);</span>
		
<span class="nc" id="L726">		ArrayList&lt;ID&gt; orgIDCol = new ArrayList&lt;ID&gt;();</span>
		//ArrayList&lt;String&gt; orgIDCol = new ArrayList&lt;String&gt;(Arrays.asList(orgIDs));
<span class="nc bnc" id="L728" title="All 2 branches missed.">		for(int x = 0; x &lt; orgIDs.length; x++) {</span>
<span class="nc" id="L729">			orgIDCol.add(new ID(orgIDs[x]));</span>
		}
<span class="nc" id="L731">		loadData(orgIDCol);</span>
<span class="nc" id="L732">	}</span>

	private void loadData(Collection&lt;ID&gt; orgIDs) {
		try {
<span class="nc" id="L736">			queueAttributeDefinitions = QueueAttributeFilterModelHandler.getQueueAttributes(m_context, orgIDs);</span>
<span class="nc" id="L737">		} catch(Exception e) {</span>
<span class="nc" id="L738">			e.printStackTrace();</span>
<span class="nc" id="L739">			handleUnableToLoadDataError(log, e);</span>
<span class="nc" id="L740">		}</span>
<span class="nc" id="L741">	}</span>
	
	

<span class="nc" id="L745">	private ArrayList tempList = null;</span>
	private void addAtributesToBeEdited() {
<span class="nc" id="L747">		ArrayList tableRows = new ArrayList();</span>
		
<span class="nc" id="L749">		Collection&lt;Media&gt; mediaCollection = Collections.emptyList();</span>
		try {
<span class="nc" id="L751">			mediaCollection = WorkloadModelHandler.getAllMedia(m_context);</span>
<span class="nc" id="L752">		} catch (Exception ex) {</span>
<span class="nc" id="L753">			ex.printStackTrace();</span>
<span class="nc" id="L754">			handleUnableToLoadDataError(log, ex);</span>
<span class="nc" id="L755">		}</span>
		
<span class="nc" id="L757">		Iterator&lt;Media&gt; mediaIter = mediaCollection.iterator();</span>
<span class="nc" id="L758">		Collection&lt;StringsPair&gt; mediaPair = new ArrayList&lt;StringsPair&gt;();</span>
<span class="nc" id="L759">		mediaPair.add(new StringsPair(&quot;&quot;, &quot;&quot;));</span>
<span class="nc bnc" id="L760" title="All 2 branches missed.">		while(mediaIter.hasNext()) {</span>
<span class="nc" id="L761">			Media media = mediaIter.next();</span>
<span class="nc" id="L762">			mediaPair.add(new StringsPair(media.getStrID(), media.getName()));</span>
<span class="nc" id="L763">		}</span>
		
<span class="nc" id="L765">		Collection&lt;QueueAttributeFilterMedia&gt; selMedia = modelComponent.getSelectedMedia();</span>
<span class="nc" id="L766">		String[] selectedMedia = {};</span>
<span class="nc bnc" id="L767" title="All 2 branches missed.">		if(selMedia != null) {</span>
<span class="nc" id="L768">			selectedMedia = new String[selMedia.size()];</span>
<span class="nc" id="L769">			Iterator&lt;QueueAttributeFilterMedia&gt; iter = selMedia.iterator();</span>
<span class="nc" id="L770">			int counter = 0;</span>
<span class="nc bnc" id="L771" title="All 2 branches missed.">			while(iter.hasNext()) {</span>
<span class="nc" id="L772">				selectedMedia[counter++] = iter.next().getMediaID();</span>
			}
		}
		                                    
<span class="nc" id="L776">		DefaultMultiColumnNodeData mediaNode = new DefaultMultiColumnNodeData(MEDIA_ID);</span>
<span class="nc" id="L777">		mediaNode.add(i18n(m_bundle, BbmWebBundleKey.MEDIA_TITLE));</span>
<span class="nc" id="L778">		mediaNode.add(HtmlUtil.makeSelectInput(&quot;MEDIA_VALUE_&quot; + MEDIA_ID, &quot;&quot;, selectedMedia, &quot;&quot;, mediaPair, &quot;200&quot;, true, true, true, true));</span>
		//mediaNode.add(HtmlUtil.makeHiddenInput(&quot;ATTRIB_ID&quot;, MEDIA_ID));
		//mediaNode.add(HtmlUtil.makeHiddenInput(&quot;ATTRIB_TYPE_ID_&quot; + MEDIA_ID, &quot;));
<span class="nc" id="L781">		tableRows.add(mediaNode);</span>
		
<span class="nc" id="L783">		Collection&lt;StringsPair&gt; rootQueuePair = new ArrayList&lt;StringsPair&gt;();</span>
<span class="nc" id="L784">		Object[] vertic = new Object[1];</span>
<span class="nc" id="L785">		vertic[0] = m_context.getSystemManagerFactory().getVerticalizationManager().getVerticalizedString(m_context, DefaultVerticalizationManager.QUEUESSMALL);</span>
	
	
<span class="nc" id="L788">		rootQueuePair.add(new StringsPair(&quot;FALSE&quot;, i18n(m_bundle, BbmWebBundleKey.QUEUE_ATTRIBUTE_False)));</span>
<span class="nc" id="L789">		rootQueuePair.add(new StringsPair(&quot;TRUE&quot;, i18n(m_bundle, BbmWebBundleKey.QUEUE_ATTRIBUTE_True)));</span>
<span class="nc" id="L790">		DefaultMultiColumnNodeData rootQueueNode = new DefaultMultiColumnNodeData(SHOW_ROOT_QUEUES_ONLY_FN);</span>
<span class="nc" id="L791">		rootQueueNode.add(m_localizer.i18n(m_bundle, BbmWebBundleKey.QUEUE_ATTRIBUTE_SHOW_ROOT_QUEUE_ONLY, vertic));</span>
<span class="nc" id="L792">		String[] selectedQueue = {};</span>
<span class="nc bnc" id="L793" title="All 2 branches missed.">		if(showRootQueueOnly) {</span>
<span class="nc" id="L794">			selectedQueue = new String[]{&quot;TRUE&quot;};</span>
		}
<span class="nc" id="L796">		rootQueueNode.add(HtmlUtil.makeSelectInput(SHOW_ROOT_QUEUES_ONLY_ID, &quot;&quot;, selectedQueue, &quot;&quot;, rootQueuePair, &quot;200&quot;, true, false, true, false));</span>
<span class="nc" id="L797">		tableRows.add(rootQueueNode);</span>
		
<span class="nc bnc" id="L799" title="All 4 branches missed.">    	if(queueAttributeDefinitions == null || queueAttributeDefinitions.size() &lt;= 0) {</span>
<span class="nc" id="L800">    		attributesHolder.setColumnOneClickable(false);</span>
<span class="nc" id="L801">    		attributesHolder.setRowSelectable(false);</span>
<span class="nc" id="L802">        	attributesHolder.setListModel(tableRows);</span>
<span class="nc" id="L803">        	requiredHtml.append(attributesHolder.getRequiredHTML());</span>
<span class="nc" id="L804">    		return;</span>
    	}
    	
<span class="nc" id="L807">    	Hashtable&lt;ID, Object&gt; selectedValues = new Hashtable&lt;ID, Object&gt;();</span>
<span class="nc bnc" id="L808" title="All 4 branches missed.">		if(modelComponent != null &amp;&amp; modelComponent.getID() != null) {</span>
<span class="nc" id="L809">			Collection&lt;QueueAttributeFilterSelectedTextValue&gt; textValues = modelComponent.getTextValues();</span>
<span class="nc bnc" id="L810" title="All 4 branches missed.">			if(textValues != null &amp;&amp; textValues.size() &gt; 0) {</span>
<span class="nc" id="L811">				Iterator&lt;QueueAttributeFilterSelectedTextValue&gt; iter = textValues.iterator();</span>
<span class="nc bnc" id="L812" title="All 2 branches missed.">				while(iter.hasNext())  {</span>
<span class="nc" id="L813">					QueueAttributeFilterSelectedTextValue val = iter.next();</span>

<span class="nc bnc" id="L815" title="All 2 branches missed.">					if(val == null) {</span>
<span class="nc" id="L816">						continue;</span>
					}
<span class="nc" id="L818">					selectedValues.put(val.getQueueAttributeID(), val);</span>
<span class="nc" id="L819">				}</span>
			}
			
<span class="nc" id="L822">			Collection&lt;QueueAttributeFilterSelectedBooleanValue&gt; boolValues = modelComponent.getBooleanValues();</span>
<span class="nc bnc" id="L823" title="All 4 branches missed.">			if(boolValues != null &amp;&amp; boolValues.size() &gt; 0) {</span>
<span class="nc" id="L824">				Iterator&lt;QueueAttributeFilterSelectedBooleanValue&gt; iter = boolValues.iterator();</span>
<span class="nc bnc" id="L825" title="All 2 branches missed.">				while(iter.hasNext())  {</span>
<span class="nc" id="L826">					QueueAttributeFilterSelectedBooleanValue val = iter.next();</span>
<span class="nc bnc" id="L827" title="All 2 branches missed.">					if(val == null) {</span>
<span class="nc" id="L828">						continue;</span>
					}
<span class="nc" id="L830">					selectedValues.put(val.getQueueAttributeID(), val);</span>
<span class="nc" id="L831">				}</span>
			}
			
<span class="nc" id="L834">			Collection&lt;QueueAttributeFilterSelectedDropDownValue&gt; ddValues = modelComponent.getDropDownValues();</span>
<span class="nc bnc" id="L835" title="All 4 branches missed.">			if(ddValues != null &amp;&amp; ddValues.size() &gt; 0) {</span>
<span class="nc" id="L836">				Iterator&lt;QueueAttributeFilterSelectedDropDownValue&gt; iter = ddValues.iterator();</span>
<span class="nc bnc" id="L837" title="All 2 branches missed.">				while(iter.hasNext())  {</span>
<span class="nc" id="L838">					QueueAttributeFilterSelectedDropDownValue val = iter.next();</span>
<span class="nc bnc" id="L839" title="All 2 branches missed.">					if(val == null) {</span>
<span class="nc" id="L840">						continue;</span>
					}
<span class="nc" id="L842">					selectedValues.put(val.getQueueAttributeID(), val);</span>
<span class="nc" id="L843">				}</span>
			}
			
<span class="nc" id="L846">			Collection&lt;QueueAttributeFilterSelectedNumericValue&gt; numericValues = modelComponent.getNumericValues();</span>
<span class="nc bnc" id="L847" title="All 4 branches missed.">			if(numericValues != null &amp;&amp; numericValues.size() &gt; 0) {</span>
<span class="nc" id="L848">				Iterator&lt;QueueAttributeFilterSelectedNumericValue&gt; iter = numericValues.iterator();</span>
<span class="nc bnc" id="L849" title="All 2 branches missed.">				while(iter.hasNext())  {</span>
<span class="nc" id="L850">					QueueAttributeFilterSelectedNumericValue val = iter.next();</span>
<span class="nc bnc" id="L851" title="All 2 branches missed.">					if(val == null) {</span>
<span class="nc" id="L852">						continue;</span>
					}
<span class="nc" id="L854">					selectedValues.put(val.getQueueAttributeID(), val);</span>
<span class="nc" id="L855">				}</span>
			}
			
<span class="nc" id="L858">			Collection&lt;QueueAttributeFilterSelectedDateValue&gt; dateValues = modelComponent.getDateValues();</span>
<span class="nc bnc" id="L859" title="All 4 branches missed.">			if(dateValues != null &amp;&amp; dateValues.size() &gt; 0) {</span>
<span class="nc" id="L860">				Iterator&lt;QueueAttributeFilterSelectedDateValue&gt; iter = dateValues.iterator();</span>
<span class="nc bnc" id="L861" title="All 2 branches missed.">				while(iter.hasNext())  {</span>
<span class="nc" id="L862">					QueueAttributeFilterSelectedDateValue val = iter.next();</span>
<span class="nc bnc" id="L863" title="All 2 branches missed.">					if(val == null) {</span>
<span class="nc" id="L864">						continue;</span>
					}
<span class="nc" id="L866">					selectedValues.put(val.getQueueAttributeID(), val);</span>
<span class="nc" id="L867">				}</span>
			}
		} 
    	
<span class="nc" id="L871">    	Iterator&lt;QueueAttributeDefintion&gt; iter = queueAttributeDefinitions.iterator();</span>
		
		
<span class="nc bnc" id="L874" title="All 2 branches missed.">		while(iter.hasNext()) {</span>
<span class="nc" id="L875">			QueueAttributeDefintion obj = iter.next();</span>
<span class="nc" id="L876">			DefaultMultiColumnNodeData node = new DefaultMultiColumnNodeData(obj.getID());</span>
			
<span class="nc" id="L878">			node.add(obj.getName());</span>
<span class="nc bnc" id="L879" title="All 2 branches missed.">			if(obj.getType().equals(QueueAttributeType.TYPE_TEXT)) {</span>
<span class="nc bnc" id="L880" title="All 2 branches missed.">				if(selectedValues.containsKey(obj.getID()))</span>
<span class="nc" id="L881">					node.add(HtmlUtil.makeTextInput(QUEUE_ATTRIB_VALUE_HOLDER + obj.getID(),35,50, ((QueueAttributeFilterSelectedTextValue)selectedValues.get(obj.getID())).getSelectedValue(),APPLICATION_MEDIATOR_CUSTOM_DIRTY));</span>
				else
<span class="nc" id="L883">					node.add(HtmlUtil.makeTextInput(QUEUE_ATTRIB_VALUE_HOLDER + obj.getID(),35,50, &quot;&quot;,APPLICATION_MEDIATOR_CUSTOM_DIRTY));</span>
<span class="nc bnc" id="L884" title="All 2 branches missed.">			} else if(obj.getType().equals(QueueAttributeType.TYPE_NUMERIC)) {</span>
<span class="nc" id="L885">    	    	String startValue = &quot;&quot;;</span>
<span class="nc" id="L886">    	    	String endValue = &quot;&quot;;</span>

<span class="nc bnc" id="L888" title="All 2 branches missed.">    	    	if(selectedValues.containsKey(obj.getID())) {</span>
<span class="nc" id="L889">    	    		QueueAttributeFilterSelectedNumericValue v = (QueueAttributeFilterSelectedNumericValue)selectedValues.get(obj.getID());</span>
<span class="nc" id="L890">    	    		startValue = v.getSelectedValueStart() + &quot;&quot;;</span>
<span class="nc" id="L891">    	    		endValue = v.getSelectedValueEnd() + &quot;&quot;;</span>
    	    	}
    	    	
<span class="nc" id="L894">    	    	m_inputPCOne.reset(&quot;NUMERIC_START_&quot; + obj.getID(), startValue, FormInputPC.TYPE_NUMERIC, false);</span>
<span class="nc" id="L895">    	    	m_inputPCOne.setSize(11);</span>
<span class="nc" id="L896">    	    	m_inputPCOne.setMaxLength(4);</span>
<span class="nc" id="L897">    	    	m_inputPCOne.setInputType(FormInputPC.TYPE_NUMERIC);</span>
<span class="nc" id="L898">    	    	m_inputPCOne.setOnChangeJS(APPLICATION_MEDIATOR_CUSTOM_DIRTY);</span>
<span class="nc" id="L899">    	    	String start = m_inputPCOne.getHtmlDisplay();</span>

<span class="nc" id="L901">    	    	m_inputPCOne.reset(&quot;NUMERIC_END_&quot; + obj.getID(), endValue, FormInputPC.TYPE_NUMERIC, false);</span>
<span class="nc" id="L902">    	    	m_inputPCOne.setSize(11);</span>
<span class="nc" id="L903">    	    	m_inputPCOne.setMaxLength(4);</span>
    	    	
<span class="nc" id="L905">    	    	m_inputPCOne.setOnChangeJS(APPLICATION_MEDIATOR_CUSTOM_DIRTY);</span>
<span class="nc" id="L906">    	    	String end = m_inputPCOne.getHtmlDisplay();</span>

<span class="nc" id="L908">    	    	node.add(start + HtmlUtil.NBSP + HtmlUtil.NBSP + i18n(m_bundle, BbmWebBundleKey.QUEUE_ATTRIBUTE_NUMERIC_RANGE) + HtmlUtil.NBSP + HtmlUtil.NBSP + end);</span>

    	    	
<span class="nc bnc" id="L911" title="All 2 branches missed.">			} else if(obj.getType().equals(QueueAttributeType.TYPE_DATE)) {</span>
<span class="nc" id="L912">    	    	dateRangePickerPC = new DateRangePickerPC(m_context, QUEUE_ATTRIB_VALUE_HOLDER + obj.getID());</span>
<span class="nc" id="L913">    	    	dateRangePickerPC.setTimeZone(TimeZone.getTimeZone(&quot;GMT&quot;));</span>
<span class="nc" id="L914">    			dateRangePickerPC.setIsTimeEnabled(false);</span>
    			//setLowerAndUpperLimit(dateRangePickerPC);
<span class="nc" id="L916">    			addChildComponent(dateRangePickerPC);</span>
    			
<span class="nc" id="L918">    			setLowerAndUpperLimit(dateRangePickerPC);</span>
<span class="nc" id="L919">    			dateRangePickerPC.getStartDatePickerPC().setIsTimeEnabled(false);</span>
<span class="nc" id="L920">    			dateRangePickerPC.getEndDatePickerPC().setIsTimeEnabled(false);</span>
    			
<span class="nc" id="L922">    			dateRangePickerPC.setOnChangeJS(APPLICATION_MEDIATOR_CUSTOM_DIRTY);</span>
<span class="nc" id="L923">    			dateRangePickerPC.initForDisplay();</span>
    			
<span class="nc" id="L925">    			Date tempDate = null;</span>
//    			dateRangePickerPC.getStartDatePickerPC().setDate(tempDate);
//				dateRangePickerPC.getEndDatePickerPC().setDate(tempDate);
<span class="nc" id="L928">    			String pattern = m_context.getLocalizer().getDateInputFormat();</span>
<span class="nc" id="L929">    			SimpleDateFormat format = new SimpleDateFormat(pattern, m_context.getLocalizer().getLocaleContext().getRegionalFormatLocale());</span>

<span class="nc" id="L931">				dateRangePickerPC.getStartDatePickerPC().setIsDateValueOptional(true);</span>
<span class="nc" id="L932">				dateRangePickerPC.getEndDatePickerPC().setIsDateValueOptional(true);</span>

				
				
				
				
				
<span class="nc bnc" id="L939" title="All 2 branches missed.">				if(selectedValues.containsKey(obj.getID())) {</span>
<span class="nc" id="L940">					QueueAttributeFilterSelectedDateValue d = (QueueAttributeFilterSelectedDateValue)selectedValues.get(obj.getID());</span>
<span class="nc" id="L941">					dateRangePickerPC.getStartDatePickerPC().setDate(d.getSelectedValueStart());</span>
<span class="nc" id="L942">					dateRangePickerPC.getEndDatePickerPC().setDate(d.getSelectedValueEnd());</span>
				}
    			
<span class="nc" id="L945">				node.add(dateRangePickerPC.getHtmlDisplay());</span>
<span class="nc" id="L946">				requiredHtml.append(dateRangePickerPC.getRequiredHTML());</span>
<span class="nc bnc" id="L947" title="All 2 branches missed.">			} else if(obj.getType().equals(QueueAttributeType.TYPE_DROPDOWN)) {</span>
				try {
<span class="nc" id="L949">					obj = new QueueAttributeDefinitionModelHandler().getQueueAttributeByID(m_context, obj.getID());</span>
<span class="nc" id="L950">				} catch (Exception  e) {</span>
<span class="nc" id="L951">					e.printStackTrace();</span>
<span class="nc" id="L952">					handleUnableToLoadDataError(log, e);</span>
<span class="nc" id="L953">				}</span>
<span class="nc" id="L954">				Collection&lt;QueueAttributeDropDown&gt; colDD = obj.getQueueAttributeDropDown();</span>
<span class="nc" id="L955">				Collection&lt;StringsPair&gt; pairedValue = new ArrayList&lt;StringsPair&gt;();</span>
<span class="nc" id="L956">				pairedValue.add(new StringsPair(&quot;-1&quot;, &quot;&quot;));</span>
<span class="nc" id="L957">				Iterator&lt;QueueAttributeDropDown&gt; ddIter = colDD.iterator();</span>
				
<span class="nc" id="L959">				ArrayList&lt;String&gt; selIDs = new ArrayList&lt;String&gt;();</span>
				
<span class="nc bnc" id="L961" title="All 2 branches missed.">				if(selectedValues.containsKey(obj.getID())) {</span>
<span class="nc" id="L962">					Collection&lt;QueueAttributeFilterSelectedDropDownValue&gt; ddValues = modelComponent.getDropDownValues();</span>
<span class="nc" id="L963">					Iterator&lt;QueueAttributeFilterSelectedDropDownValue&gt; ddSelIter = ddValues.iterator();</span>
<span class="nc bnc" id="L964" title="All 2 branches missed.">					while(ddSelIter.hasNext()) {</span>
<span class="nc" id="L965">						QueueAttributeFilterSelectedDropDownValue tempValue = ddSelIter.next();</span>
<span class="nc bnc" id="L966" title="All 2 branches missed.">						if(tempValue.getQueueAttributeID().equals(obj.getID())) {</span>
<span class="nc" id="L967">							selIDs.add(tempValue.getSelectedValue() + &quot;&quot;);</span>
						}
<span class="nc" id="L969">					}</span>
				}
				
<span class="nc" id="L972">				String[] selDDVal = new String[selIDs.size()];</span>
<span class="nc" id="L973">				selDDVal = selIDs.toArray(selDDVal);</span>
				
<span class="nc" id="L975">				int counter = 0;</span>
<span class="nc bnc" id="L976" title="All 2 branches missed.">				while(ddIter.hasNext()) {</span>
<span class="nc" id="L977">					QueueAttributeDropDown ddVal = ddIter.next();</span>
<span class="nc" id="L978">					pairedValue.add(new StringsPair(ddVal.getID().toString(), ddVal.getValue()));</span>
<span class="nc" id="L979">				}</span>
<span class="nc" id="L980">				node.add(HtmlUtil.makeSelectInput(QUEUE_ATTRIB_VALUE_HOLDER + obj.getID(), &quot;&quot;, selDDVal, APPLICATION_MEDIATOR_CUSTOM_DIRTY, pairedValue, &quot;200&quot;, true, true, true, true));</span>
<span class="nc" id="L981">			} else {</span>
<span class="nc" id="L982">				System.out.println(&quot;\t***********      Not any type &quot;);</span>
			}
			
<span class="nc" id="L985">			node.add(HtmlUtil.makeHiddenInput(&quot;ATTRIB_ID&quot;, obj.getID().toString()));</span>
<span class="nc" id="L986">			node.add(HtmlUtil.makeHiddenInput(&quot;ATTRIB_TYPE_ID_&quot; + obj.getID(), obj.getType().toString()));</span>
<span class="nc" id="L987">			tableRows.add(node);</span>
<span class="nc" id="L988">		}</span>
    		
		
<span class="nc" id="L991">		attributesHolder.setColumnOneClickable(false);</span>
<span class="nc" id="L992">		attributesHolder.setRowSelectable(false);</span>
<span class="nc" id="L993">    	attributesHolder.setListModel(tableRows);</span>
<span class="nc" id="L994">    	requiredHtml.append(attributesHolder.getRequiredHTML());</span>
<span class="nc" id="L995">    }</span>
 
	public String getRequiredHTML() {
<span class="nc bnc" id="L998" title="All 2 branches missed.">		String dialogCode = m_dialogPC == null ? &quot;&quot; : m_dialogPC.toString() + m_dialogPC.getRequiredHTML();</span>
<span class="nc" id="L999">		return dialogCode + requiredHtml.toString();</span>
	}

	public void saveQueueAttributeFilter(HttpServletRequest request) {
		try {
<span class="nc" id="L1004">		ID queueAttributeFilterID = namedFilterID;</span>
		
<span class="nc" id="L1006">		QueueAttributeFilter filter = new QueueAttributeFilter();</span>
<span class="nc bnc" id="L1007" title="All 2 branches missed.">		if(queueAttributeFilterID != null)</span>
<span class="nc" id="L1008">			filter = QueueAttributeFilterModelHandler.getQueueAttributeFilter(queueAttributeFilterID);</span>
		
<span class="nc" id="L1010">		String[] idValues = request.getParameterValues(&quot;ATTRIB_ID&quot;);</span>
		//String[] typeIDs = request.getParameterValues(&quot;ATTRIB_TYPE_ID&quot;);
	
		//String[] queues = request.getParameterValues(&quot;QUEUE_LIST_VALUES&quot;);
	
<span class="nc" id="L1015">		String pattern = m_context.getLocalizer().getDateInputFormat();</span>
<span class="nc" id="L1016">		SimpleDateFormat format = new SimpleDateFormat(pattern, m_context.getLocalizer().getLocaleContext().getRegionalFormatLocale());</span>
		
<span class="nc" id="L1018">		ArrayList&lt;QueueAttributeFilterSelectedTextValue&gt; textValues = new ArrayList&lt;QueueAttributeFilterSelectedTextValue&gt;();</span>
<span class="nc" id="L1019">		ArrayList&lt;QueueAttributeFilterSelectedBooleanValue&gt; booleanValues = new ArrayList&lt;QueueAttributeFilterSelectedBooleanValue&gt;();</span>
<span class="nc" id="L1020">		ArrayList&lt;QueueAttributeFilterSelectedDropDownValue&gt; ddValues = new ArrayList&lt;QueueAttributeFilterSelectedDropDownValue&gt;();</span>
<span class="nc" id="L1021">		ArrayList&lt;QueueAttributeFilterSelectedDateValue&gt; dateValues = new ArrayList&lt;QueueAttributeFilterSelectedDateValue&gt;();</span>
<span class="nc" id="L1022">		ArrayList&lt;QueueAttributeFilterSelectedNumericValue&gt; numericValues = new ArrayList&lt;QueueAttributeFilterSelectedNumericValue&gt;();</span>
		
<span class="nc bnc" id="L1024" title="All 2 branches missed.">		if (idValues != null) {</span>
<span class="nc bnc" id="L1025" title="All 2 branches missed.">			for(int x = 0; x &lt; idValues.length; x++ ) {</span>
				//QueueAttributeFilterSelectedValue value = new QueueAttributeFilterSelectedValue();
				
				
<span class="nc" id="L1029">				ID typeID = new ID(request.getParameter(&quot;ATTRIB_TYPE_ID_&quot; + idValues[x]));</span>
				
<span class="nc bnc" id="L1031" title="All 2 branches missed.">				if(typeID == null) {</span>
<span class="nc" id="L1032">					continue;</span>
				}
	
<span class="nc" id="L1035">				String userValue = request.getParameter(QUEUE_ATTRIB_VALUE_HOLDER+ idValues[x]);</span>
				
<span class="nc bnc" id="L1037" title="All 2 branches missed.">				if(typeID.equals(QueueAttributeType.TYPE_NUMERIC)) {</span>
<span class="nc" id="L1038">					QueueAttributeFilterSelectedNumericValue value = new QueueAttributeFilterSelectedNumericValue();</span>
<span class="nc" id="L1039">					value.setQueueAttributeFilterID(queueAttributeFilterID);</span>
<span class="nc" id="L1040">					value.setQueueAttributeID(new ID(idValues[x]));</span>
<span class="nc" id="L1041">					String start = request.getParameter(&quot;NUMERIC_START_&quot;+ idValues[x]);</span>
<span class="nc" id="L1042">					String end = request.getParameter(&quot;NUMERIC_END_&quot;+ idValues[x]);</span>
					
<span class="nc bnc" id="L1044" title="All 4 branches missed.">					if(!(StringUtil.isEmptyOrWhiteSpace(start) || StringUtil.isEmptyOrWhiteSpace(end))) {</span>
<span class="nc" id="L1045">						value.setSelectedValueStart(new Double(start).doubleValue());</span>
<span class="nc" id="L1046">						value.setSelectedValueEnd(new Double(end).doubleValue());</span>
<span class="nc" id="L1047">						numericValues.add(value);</span>
					}
					continue;
				}
				
<span class="nc bnc" id="L1052" title="All 2 branches missed.">				if(typeID.equals(QueueAttributeType.TYPE_DATE)) {</span>
<span class="nc" id="L1053">					QueueAttributeFilterSelectedDateValue value = new QueueAttributeFilterSelectedDateValue();</span>
<span class="nc" id="L1054">					value.setQueueAttributeFilterID(queueAttributeFilterID);</span>
<span class="nc" id="L1055">					value.setQueueAttributeID(new ID(idValues[x]));</span>
	
<span class="nc" id="L1057">					String start = request.getParameter(QUEUE_ATTRIB_VALUE_HOLDER + idValues[x] + &quot;_START&quot;);</span>
<span class="nc" id="L1058">					String end = request.getParameter(QUEUE_ATTRIB_VALUE_HOLDER + idValues[x] + &quot;_END&quot;);</span>
					
<span class="nc bnc" id="L1060" title="All 4 branches missed.">					if(!(StringUtil.isEmptyOrWhiteSpace(start) || StringUtil.isEmptyOrWhiteSpace(end))) {</span>
<span class="nc" id="L1061">						value.setSelectedValueStart(format.parse(start));</span>
<span class="nc" id="L1062">						value.setSelectedValueEnd(format.parse(end));</span>
<span class="nc" id="L1063">						dateValues.add(value);</span>
					}
					continue;
				}
<span class="nc bnc" id="L1067" title="All 2 branches missed.">				if(typeID.equals(QueueAttributeType.TYPE_DROPDOWN)) {</span>
<span class="nc" id="L1068">					String[] values = request.getParameterValues(QUEUE_ATTRIB_VALUE_HOLDER + idValues[x]);</span>
					//StringBuffer buffer = new StringBuffer();
<span class="nc bnc" id="L1070" title="All 2 branches missed.">					for(int y =0 ; y &lt; values.length; y++) {</span>
<span class="nc bnc" id="L1071" title="All 2 branches missed.">						if(values[y].equals(&quot;-1&quot;))</span>
<span class="nc" id="L1072">							continue;</span>
<span class="nc" id="L1073">						QueueAttributeFilterSelectedDropDownValue value = new QueueAttributeFilterSelectedDropDownValue();</span>
<span class="nc" id="L1074">						value.setQueueAttributeFilterID(queueAttributeFilterID);</span>
<span class="nc" id="L1075">						value.setQueueAttributeID(new ID(idValues[x]));</span>
<span class="nc" id="L1076">						value.setSelectedValue(Integer.parseInt(values[y]));</span>
<span class="nc" id="L1077">						ddValues.add(value);</span>
					}
	
<span class="nc" id="L1080">					continue;</span>
				}
				
				//Text value
<span class="nc bnc" id="L1084" title="All 2 branches missed.">				if(!StringUtil.isEmptyOrWhiteSpace(userValue)) {</span>
<span class="nc" id="L1085">					QueueAttributeFilterSelectedTextValue value = new QueueAttributeFilterSelectedTextValue();</span>
<span class="nc" id="L1086">					value.setQueueAttributeFilterID(queueAttributeFilterID);</span>
<span class="nc" id="L1087">					value.setQueueAttributeID(new ID(idValues[x]));</span>
					
<span class="nc" id="L1089">					value.setSelectedValue(userValue);</span>
<span class="nc" id="L1090">					textValues.add(value);</span>
<span class="nc" id="L1091">					continue;</span>
				}
			}
		}
		
<span class="nc" id="L1096">		String organization = request.getParameter(QueueAttributeFilterPageModel.SELECTED_ORGANIZATIONS_FN);</span>
<span class="nc" id="L1097">		String[] orgs = organization.split(&quot;,&quot;);</span>
<span class="nc" id="L1098">		Collection&lt;QueueAttributeFilterSelectedOrganization&gt; orgList = new ArrayList&lt;QueueAttributeFilterSelectedOrganization&gt;();</span>
<span class="nc bnc" id="L1099" title="All 2 branches missed.">		for(int o = 0; o &lt; orgs.length; o++) {</span>
<span class="nc" id="L1100">			QueueAttributeFilterSelectedOrganization sO = new QueueAttributeFilterSelectedOrganization();</span>
<span class="nc" id="L1101">			sO.setQueueAttributeFilterID(queueAttributeFilterID);</span>
<span class="nc" id="L1102">			sO.setQueueAttributeID(new ID(orgs[o])); //TODO rename it to org</span>
<span class="nc" id="L1103">			orgList.add(sO);</span>
		}
<span class="nc" id="L1105">		filter.setSelectedOrganization(orgList);</span>
		
<span class="nc" id="L1107">		String[] mediaValues = request.getParameterValues(&quot;MEDIA_VALUE_&quot; + MEDIA_ID);</span>
<span class="nc" id="L1108">		Collection&lt;QueueAttributeFilterMedia&gt; mediaList = new ArrayList&lt;QueueAttributeFilterMedia&gt;();</span>
<span class="nc bnc" id="L1109" title="All 2 branches missed.">		if (mediaValues != null) {</span>
<span class="nc bnc" id="L1110" title="All 2 branches missed.">			for(int x = 0 ;x &lt; mediaValues.length; x++) {</span>
<span class="nc bnc" id="L1111" title="All 2 branches missed.">				if(mediaValues[x].equals(&quot;&quot;))</span>
<span class="nc" id="L1112">					continue;</span>
<span class="nc" id="L1113">				QueueAttributeFilterMedia media = new QueueAttributeFilterMedia();</span>
<span class="nc" id="L1114">				media.setFilterID(queueAttributeFilterID);</span>
<span class="nc" id="L1115">				media.setMediaID(mediaValues[x]);</span>
<span class="nc" id="L1116">				mediaList.add(media);</span>
			}
		}
<span class="nc" id="L1119">		filter.setSelectedMedia(mediaList);</span>
<span class="nc" id="L1120">		String showRootQueue = request.getParameter(SHOW_ROOT_QUEUES_ONLY_ID);</span>
<span class="nc bnc" id="L1121" title="All 2 branches missed.">		if(filter.getID() == null) {</span>
<span class="nc" id="L1122">			filter.setUserID(m_context.getUser().getID());</span>
<span class="nc" id="L1123">			filter.setName(request.getParameter(NAMED_FILTER_NAME_FN));</span>
		}
<span class="nc" id="L1125">		filter.setIsPublic(new Boolean(request.getParameter(NAMED_FILTER_IS_PUBLIC_FN)).booleanValue());</span>
<span class="nc" id="L1126">		filter.setIsShowRootQueuesOnly(new Boolean(showRootQueue).booleanValue());</span>
<span class="nc" id="L1127">		filter.setBooleanValues(booleanValues);</span>
<span class="nc" id="L1128">		filter.setTextValues(textValues);</span>
<span class="nc" id="L1129">		filter.setDropDownValues(ddValues);</span>
<span class="nc" id="L1130">		filter.setNumericValues(numericValues);</span>
<span class="nc" id="L1131">		filter.setDateValues(dateValues);</span>
<span class="nc" id="L1132">		ID filterID = QueueAttributeFilterModelHandler.createOrUpdateQueueAttributeFilter(m_context, filter);</span>
		
<span class="nc bnc" id="L1134" title="All 2 branches missed.">		if(filterID == null)</span>
<span class="nc" id="L1135">			filterID = QueueAttributeFilter.DELETED_ID;</span>
		
<span class="nc" id="L1137">		m_context.setUserProperty(UserPreferenceKeys.QUEUE_ATTRIBUTE_FILTER, filterID.toString());</span>
<span class="nc" id="L1138">		m_context.setUserProperty(UserPreferenceKeys.QUEUE_ATTRIBUTE_FILTER_LAST_EDITED, filterID.toString());</span>
		
<span class="nc bnc" id="L1140" title="All 2 branches missed.">		if(new Boolean(request.getParameter(NAMED_FILTER_IS_DEFAULT_FN)).booleanValue()) {</span>
<span class="nc" id="L1141">			m_context.setUserProperty(UserPreferenceKeys.QUEUE_ATTRIBUTE_DEFAULT_FILTER, filterID.toString());</span>
		}
		
<span class="nc" id="L1144">		} catch(Exception e) {</span>
<span class="nc" id="L1145">			e.printStackTrace();</span>
<span class="nc" id="L1146">			handleUnableToLoadDataError(log, e);</span>
<span class="nc" id="L1147">		}</span>
<span class="nc" id="L1148">	}</span>

	public void setIsPublic(boolean flag) {
<span class="nc" id="L1151">		namedFilterIsPublic = flag;</span>
<span class="nc" id="L1152">	}</span>


	public void loadModelData() {
		try {
<span class="nc bnc" id="L1157" title="All 2 branches missed.">		if(namedFilterID != null)</span>
<span class="nc" id="L1158">			modelComponent = QueueAttributeFilterModelHandler.getQueueAttributeFilter(namedFilterID);</span>
		
<span class="nc bnc" id="L1160" title="All 2 branches missed.">			if(modelComponent != null) {</span>
<span class="nc" id="L1161">				Collection&lt;QueueAttributeFilterSelectedOrganization&gt; orgs = modelComponent.getSelectedOrgs();</span>
<span class="nc" id="L1162">				Iterator&lt;QueueAttributeFilterSelectedOrganization&gt; iter = orgs.iterator();</span>
<span class="nc" id="L1163">				Collection&lt;ID&gt; ids = new ArrayList&lt;ID&gt;();</span>
<span class="nc" id="L1164">				StringBuffer orgIDs = new StringBuffer();</span>
<span class="nc bnc" id="L1165" title="All 2 branches missed.">				while(iter.hasNext()) {</span>
<span class="nc" id="L1166">					QueueAttributeFilterSelectedOrganization org = iter.next();</span>
<span class="nc" id="L1167">					ids.add(org.getQueueAttributeID());</span>
<span class="nc" id="L1168">					orgIDs.append(org.getQueueAttributeID()).append(&quot;,&quot;);</span>
<span class="nc" id="L1169">				}</span>
<span class="nc" id="L1170">				retrieveQueueAttributes(orgIDs.toString());</span>
<span class="nc" id="L1171">				namedFilterName = modelComponent.getName();</span>
<span class="nc" id="L1172">				String did = m_context.getUserProperty(UserPreferenceKeys.QUEUE_ATTRIBUTE_DEFAULT_FILTER);</span>
<span class="nc" id="L1173">				isDefaultFilter = modelComponent.getID().toString().equals(did);</span>
				
<span class="nc" id="L1175">			} else {</span>
<span class="nc" id="L1176">				modelComponent = new QueueAttributeFilter();</span>
			}
<span class="nc" id="L1178">			m_context.addGenericHTML(HtmlUtil.makeHiddenInput(EXISTING_NAMEDFILTER_NAME_FN, namedFilterName));</span>
<span class="nc" id="L1179">			namedFilterIsPublic = modelComponent.getIsPublic();</span>
<span class="nc" id="L1180">			showRootQueueOnly = modelComponent.isShowRootQueuesOnly();</span>
			
			
<span class="nc" id="L1183">		} catch(Exception ex) {</span>
<span class="nc" id="L1184">			ex.printStackTrace();</span>
<span class="nc" id="L1185">			handleUnableToLoadDataError(log, ex);</span>
<span class="nc" id="L1186">		}</span>
		
		
<span class="nc" id="L1189">	}</span>
	public void setQueueAttributeFilterID(ID namedFilterID) {
<span class="nc" id="L1191">		this.namedFilterID = namedFilterID;</span>
<span class="nc" id="L1192">	}</span>
	
	

	
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>