<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>QueueAttributeFilterRequestHandler.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.bbm.workload.queue.selection.queueattribute.filter</a> &gt; <span class="el_source">QueueAttributeFilterRequestHandler.java</span></div><h1>QueueAttributeFilterRequestHandler.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.bbm.workload.queue.selection.queueattribute.filter;

import java.util.Map;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.util.StringUtil;

import com.witness.web.uif.base.RequestHandler;
import com.witness.web.uif.keys.PageAction;
import com.witness.web.uif.l10n.UIFWebBundleKey;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.util.reflection.ParameterUtil;
/**
 * Title:
 * Description:
 * Copyright:    Copyright (c) 2001
 * Company:      Blue Pumpkin Software, Inc
 * @author	Sankar Nair
 * @version 1.0
 */
<span class="nc" id="L21">public class QueueAttributeFilterRequestHandler extends RequestHandler {</span>
	private String m_sAction;
	private QueueAttributeFilterPageModel m_model;
	
	
<span class="nc" id="L26">	private String selectedOrganizations = null;</span>

<span class="nc" id="L28">	private String namedFilterID = null;</span>
<span class="nc" id="L29">	private String namedFilterName = null;</span>
<span class="nc" id="L30">	private String dropDownIDSelected = null;</span>
<span class="nc" id="L31">	private String isPublic = null;</span>
	
<span class="nc" id="L33">	private String filterToBeEdited = null;</span>
<span class="nc" id="L34">	private String showDropDownsFor = null;</span>
	
	public void processRequest(RequestContext context) throws Exception {
<span class="nc" id="L37">		m_sAction = context.getRequest().getParameter(&quot;pageAction&quot;);</span>
		//System.out.println(&quot;\n\n\t\tGoing to extract parameters &quot; + m_sAction + &quot; == &quot; + PageAction.REFRESH);
		
<span class="nc" id="L40">		extractUserSelectionParameters(context);</span>

<span class="nc" id="L42">		m_model = new QueueAttributeFilterPageModel(context);</span>
<span class="nc" id="L43">		m_model.extractParameters(context.getRequest());</span>
		
<span class="nc bnc" id="L45" title="All 2 branches missed.">		if(!StringUtil.isEmptyOrWhiteSpace(filterToBeEdited)) {</span>
			//Get the ID for this filter Name
<span class="nc" id="L47">			namedFilterID = filterToBeEdited;</span>
		}
		
<span class="nc bnc" id="L50" title="All 2 branches missed.">		if(!StringUtil.isEmptyOrWhiteSpace(namedFilterID)) {</span>
<span class="nc" id="L51">			m_model.setQueueAttributeFilterID(new ID(namedFilterID));</span>
		}
		
		//This will happen only if the user has selected a different filter from the 
		//drop down on top. If that happens then we need to load this filter.
		//For some reason overwriting the value of QUEUE_ATTRIB_FILTER_ID_FN is getting reverted.
		//So using this new variable to hold the value.
		//The reason is that the page URL still refers to the ID of initial filter selected from the pulse page
<span class="nc bnc" id="L59" title="All 2 branches missed.">		if(!StringUtil.isEmptyOrWhiteSpace(dropDownIDSelected)) {</span>
<span class="nc" id="L60">			namedFilterID = dropDownIDSelected;</span>
<span class="nc" id="L61">			m_model.setQueueAttributeFilterID(new ID(namedFilterID));</span>
<span class="nc" id="L62">			m_model.setPageDirty(false);</span>
		}
		
<span class="nc" id="L65">		m_model.loadModelData();</span>
		
<span class="nc bnc" id="L67" title="All 2 branches missed.">		if(!StringUtil.isEmptyOrWhiteSpace(isPublic)) {</span>
<span class="nc" id="L68">			m_model.setIsPublic(Boolean.valueOf(isPublic).booleanValue());</span>
		}

<span class="nc" id="L71">		m_model.setFilterName(filterToBeEdited, true);</span>
		
<span class="nc bnc" id="L73" title="All 2 branches missed.">		if(!StringUtil.isEmptyOrWhiteSpace(m_sAction)) {</span>
<span class="nc bnc" id="L74" title="All 6 branches missed.">			if(!StringUtil.isEmptyOrWhiteSpace(namedFilterID) &amp;&amp; (m_sAction.equals(PageAction.DELETE) || m_sAction.equals(UIFWebBundleKey.TOOLBAR_DELETE))) { </span>
<span class="nc bnc" id="L75" title="All 2 branches missed.">				if(!m_model.processDelete(new ID(namedFilterID))) {</span>
<span class="nc" id="L76">					m_model.loadModelData();</span>
<span class="nc" id="L77">					m_model.initComponents();</span>
				}
				
				//Org selection is defined. Let's pick the queue attributes for these orgs
<span class="nc bnc" id="L81" title="All 2 branches missed.">			} else if(m_sAction.equals(QueueAttributeFilterPageModel.APPLY_ORG_SELECTION)) {</span>
<span class="nc" id="L82">					m_model.setOrganizationSelection(selectedOrganizations);</span>
<span class="nc" id="L83">					m_model.retrieveQueueAttributes(selectedOrganizations);</span>
<span class="nc" id="L84">					m_model.initComponents();</span>
<span class="nc bnc" id="L85" title="All 4 branches missed.">			} else if(m_sAction.equals(PageAction.SAVE) || m_sAction.equals(PageAction.SAVE_AS)) {</span>
<span class="nc" id="L86">				m_model.setOrganizationSelection(selectedOrganizations);</span>
<span class="nc" id="L87">				m_model.extractParameters(context.getRequest());</span>
<span class="nc" id="L88">				m_model.setIsPublic(Boolean.getBoolean(isPublic));</span>
				try {
<span class="nc bnc" id="L90" title="All 2 branches missed.">					if(m_sAction.equals(PageAction.SAVE_AS))</span>
<span class="nc" id="L91">						m_model.setQueueAttributeFilterID(null);</span>
<span class="nc" id="L92">					m_model.saveQueueAttributeFilter(context.getRequest());</span>
<span class="nc" id="L93">					m_model.processDone();</span>
<span class="nc" id="L94">				} catch (Exception e) {</span>
					// TODO Auto-generated catch block
<span class="nc" id="L96">					e.printStackTrace();</span>
<span class="nc" id="L97">					m_model.initComponents();</span>
<span class="nc" id="L98">					throw e;</span>
<span class="nc" id="L99">				}</span>
			} else {
<span class="nc" id="L101">				m_model.initComponents();</span>
			}
			
		} else {
<span class="nc" id="L105">			m_model.initComponents();</span>
		}
		
<span class="nc" id="L108">		context.getRequest().setAttribute(QueueAttributeFilterPageModel.modelKey, m_model);</span>
	
<span class="nc" id="L110">	}</span>
	
	


	private void extractUserSelectionParameters(RequestContext context) {
<span class="nc" id="L116">		namedFilterID = context.getRequest().getParameter(QueueAttributeFilterPageModel.QUEUE_ATTRIB_FILTER_ID_FN);</span>
<span class="nc" id="L117">		dropDownIDSelected = context.getRequest().getParameter(QueueAttributeFilterPageModel.QUEUE_ATTRIB_DD_TEST_FN);</span>
<span class="nc bnc" id="L118" title="All 2 branches missed.">		if(StringUtil.isEmptyOrWhiteSpace(namedFilterID)) {</span>
<span class="nc" id="L119">			namedFilterID = context.getRequest().getParameter(QueueAttributeFilterPageModel.QUEUE_ATTRIB_FILTER_ID_FN);</span>
		}
<span class="nc" id="L121">		namedFilterName = context.getRequest().getParameter(QueueAttributeFilterPageModel.NAMED_FILTER_NAME_FN);</span>
<span class="nc" id="L122">		isPublic = context.getRequest().getParameter(QueueAttributeFilterPageModel.NAMED_FILTER_IS_PUBLIC_FN);</span>
<span class="nc" id="L123">		String filterName = &quot;filterName&quot;;</span>
<span class="nc" id="L124">		filterName = QueueAttributeFilterUtil.QUEUEATTRIBUTEFILTERIDFROMREPORTPOPUP;</span>
<span class="nc" id="L125">		filterToBeEdited = context.getRequest().getParameter(filterName); //This will be set only when we are invoking this component from the report parameter page.</span>
<span class="nc bnc" id="L126" title="All 2 branches missed.">		if(StringUtil.isEmptyOrWhiteSpace(filterToBeEdited)) {</span>
<span class="nc" id="L127">			filterToBeEdited = &quot;&quot;;</span>
		}
		
<span class="nc" id="L130">		showDropDownsFor = context.getRequest().getParameter(&quot;SHOW_DROP_DOWNS_FOR_FIELDS&quot;);</span>
<span class="nc bnc" id="L131" title="All 2 branches missed.">		if(!StringUtil.isEmptyOrWhiteSpace(showDropDownsFor)) {</span>
<span class="nc bnc" id="L132" title="All 2 branches missed.">			if(showDropDownsFor.trim().equals(&quot;WITSAttribFilter.FREE_FORM_TEXT_DELIMITER&quot;))</span>
<span class="nc" id="L133">				showDropDownsFor = &quot;&quot;;</span>
		}
		
<span class="nc" id="L136">		selectedOrganizations = context.getRequest().getParameter(QueueAttributeFilterPageModel.SELECTED_ORGANIZATIONS_FN);</span>
<span class="nc" id="L137">		selectedOrganizations = removeLastComma(selectedOrganizations);</span>
<span class="nc" id="L138">	}</span>
	
	public static String removeLastComma(String element) {
<span class="nc bnc" id="L141" title="All 6 branches missed.">		if(element != null &amp;&amp; (!element.trim().equals(&quot;,&quot;)) &amp;&amp; (!element.trim().equals(&quot;&quot;)))</span>
<span class="nc bnc" id="L142" title="All 2 branches missed.">			if(element.endsWith(&quot;,&quot;))</span>
<span class="nc" id="L143">				return element.substring(0, element.length() - 1); //Removing the last ,</span>
<span class="nc" id="L144">		return element;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>