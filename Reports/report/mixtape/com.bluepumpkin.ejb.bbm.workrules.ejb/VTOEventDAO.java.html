<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>VTOEventDAO.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.ejb.bbm.workrules.ejb</a> &gt; <span class="el_source">VTOEventDAO.java</span></div><h1>VTOEventDAO.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.ejb.bbm.workrules.ejb;

import java.util.Collection;
import java.util.Comparator;
import java.util.HashMap;
import java.util.LinkedHashMap;
import java.util.List;
import java.util.Map;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.PaginationPair;
import com.bluepumpkin.common.jdmo.Jdmo;
import com.bluepumpkin.common.jdmo.JdmoException;
import com.bluepumpkin.common.jdmo.JdmoRowset;
import com.bluepumpkin.ejb.bbm.activity.model.ActivityFieldInfo;
import com.bluepumpkin.ejb.bbm.base.BbmFinderException;
import com.bluepumpkin.ejb.bbm.campaign.model.CampaignFieldInfo;
import com.bluepumpkin.ejb.bbm.campaign.model.SchedulingPeriod;
import com.bluepumpkin.ejb.bbm.dao.DAOBaseWithAutoIDMapping;
import com.bluepumpkin.ejb.bbm.dao.DAOUtil;
import com.bluepumpkin.ejb.bbm.vo.DBSortField;
import com.bluepumpkin.ejb.bbm.vo.FieldInfo;
import com.bluepumpkin.ejb.bbm.workresource.model.OrganizationFieldInfo;
import com.bluepumpkin.ejb.bbm.workrules.model.VTOEvent;
import com.bluepumpkin.ejb.bbm.workrules.model.VTOEventFieldInfo;
import com.bluepumpkin.ejb.bbm.workrules.model.VTOEventSortField;
import com.bluepumpkin.ejb.bbm.workrules.model.WorkRuleUtil;

public class VTOEventDAO extends DAOBaseWithAutoIDMapping&lt;VTOEvent&gt; {
<span class="fc" id="L30">	private static FieldInfo m_fieldInfo = new VTOEventFieldInfo();	</span>
<span class="fc" id="L31">	protected FieldInfo getFieldInfo() { return m_fieldInfo; }</span>
	
<span class="fc" id="L33">	private ActivityFieldInfo afi = new ActivityFieldInfo();</span>
<span class="fc" id="L34">	private OrganizationFieldInfo ofi = new OrganizationFieldInfo();	</span>
<span class="fc" id="L35">	private final String activitySortFieldKey = afi.getTableName() + &quot;_&quot; +  afi.getFieldName(ActivityFieldInfo.ACTIVITY_NAME);</span>
<span class="fc" id="L36">	private final String organizationSortFieldKey = ofi.getTableName() + &quot;_&quot; + ofi.getFieldName(OrganizationFieldInfo.ORGANIZATION_NAME);</span>
	
	public VTOEventDAO() {
<span class="fc" id="L39">		super();</span>
<span class="fc" id="L40">	}</span>
	
	public VTOEventDAO(Jdmo dmo) {
<span class="fc" id="L43">		super(dmo);</span>
<span class="fc" id="L44">	}</span>
	
	@Override
	protected VTOEvent createValueObject() {
<span class="fc" id="L48">		return new VTOEvent();</span>
	}
	
	public Collection&lt;VTOEvent&gt; getVTOEventsByOrgHierarchy(ID orgID) throws BbmFinderException {
<span class="nc" id="L52">		return getObjects(DAOUtil.getCurrentObjectsByOrgHierarchySQLString(orgID));</span>
	}
	
	public Collection&lt;VTOEvent&gt; getVTOEventsBySchedulingPeriod(SchedulingPeriod sp) throws BbmFinderException {
<span class="nc" id="L56">		return getObjects(DAOUtil.getCurrentObjectsBySchedulingPeriodSQLString(sp));</span>
	}
	
	public PaginationPair&lt;VTOEvent&gt; getCompletePaginationDataSetForOrg(ID orgID,
			boolean isAscendingSort, int pageIDSize, int pageIndex,
			LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap, Collection&lt;ID&gt; filteredIDs)
			throws BbmFinderException {
<span class="fc" id="L63">		return getCompletePaginationDataSet(DAOUtil.getCurrentObjectsByOrgHierarchySQLString(orgID),</span>
				isAscendingSort, pageIDSize, pageIndex, sortFieldMap, filteredIDs);
	}

	public PaginationPair&lt;VTOEvent&gt; getCompletePaginationDataSetForSchedulingPeriod(
			SchedulingPeriod sp, boolean isAscendingSort, int pageIDSize,
			int pageIndex, LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap, Collection&lt;ID&gt; filteredIDs)
			throws BbmFinderException {
<span class="nc" id="L71">		return getCompletePaginationDataSet(DAOUtil.getCurrentObjectsBySchedulingPeriodSQLString(sp),</span>
				isAscendingSort, pageIDSize, pageIndex, sortFieldMap, filteredIDs);	
	}
	
	public HashMap&lt;ID, String&gt; getVTONamesByOrg(ID orgID) throws BbmFinderException {
<span class="fc" id="L76">		HashMap&lt;ID, String&gt; retVal = new HashMap&lt;ID, String&gt;();</span>
		try {
<span class="fc" id="L78">			JdmoRowset r = getDMO().createRowset(&quot;SELECT &quot; + getFieldInfo().getIDFieldName() + &quot;,&quot; + </span>
<span class="fc" id="L79">					getFieldInfo().getFieldName(VTOEventFieldInfo.VTOEVENT_NAME) + &quot; FROM &quot; + getFieldInfo().getTableName() +</span>
<span class="fc" id="L80">					&quot; A WHERE &quot; + DAOUtil.getCurrentObjectsByOrgHierarchySQLString(orgID));</span>
<span class="pc bpc" id="L81" title="1 of 2 branches missed.">			while (r.next()) {</span>
<span class="nc" id="L82">				retVal.put(r.getID(getFieldInfo().getIDFieldName()),</span>
<span class="nc" id="L83">						r.getString(getFieldInfo().getFieldName(VTOEventFieldInfo.VTOEVENT_NAME)));</span>
			}
<span class="nc" id="L85">		} catch (JdmoException ex) {</span>
<span class="nc" id="L86">			throw new BbmFinderException(ex);</span>
<span class="fc" id="L87">		}</span>
<span class="fc" id="L88">		return retVal;</span>
	}
	
	public HashMap&lt;ID, String&gt; getVTONamesBySchedulingPeriod(SchedulingPeriod sp) throws BbmFinderException {
<span class="nc" id="L92">		HashMap&lt;ID, String&gt; retVal = new HashMap&lt;ID, String&gt;();</span>
		try {
<span class="nc" id="L94">			JdmoRowset r = getDMO().createRowset(&quot;SELECT &quot; + getFieldInfo().getIDFieldName() + &quot;,&quot; + </span>
<span class="nc" id="L95">					getFieldInfo().getFieldName(VTOEventFieldInfo.VTOEVENT_NAME) + &quot; FROM &quot; + getFieldInfo().getTableName() +</span>
<span class="nc" id="L96">					&quot; A WHERE &quot; + DAOUtil.getCurrentObjectsBySchedulingPeriodSQLString(sp));</span>
<span class="nc bnc" id="L97" title="All 2 branches missed.">			while (r.next()) {</span>
<span class="nc" id="L98">				retVal.put(r.getID(getFieldInfo().getIDFieldName()),</span>
<span class="nc" id="L99">						r.getString(getFieldInfo().getFieldName(VTOEventFieldInfo.VTOEVENT_NAME)));</span>
			}
<span class="nc" id="L101">		} catch (JdmoException ex) {</span>
<span class="nc" id="L102">			throw new BbmFinderException(ex);</span>
<span class="nc" id="L103">		}</span>
<span class="nc" id="L104">		return retVal;</span>
	}
	
	@Override
	protected void buildSortQuery(List&lt;DBSortField&gt; sortFields, StringBuffer selectQuery, StringBuffer fromQuery,
			StringBuffer whereQuery, StringBuffer groupByQuery, StringBuffer orderByQuery) {
<span class="fc bfc" id="L110" title="All 2 branches covered.">		for (DBSortField sortField : sortFields) {</span>
<span class="pc bpc" id="L111" title="7 of 8 branches missed.">			switch((VTOEventSortField)sortField) {</span>
				case ID:
<span class="fc" id="L113">					WorkRuleUtil.appendCommaIfPassStringIsNotEmpty(orderByQuery).append(getFieldInfo().getIDFieldName());</span>
<span class="fc" id="L114">					break;</span>
				case NAME:
<span class="nc" id="L116">					selectQuery.append(&quot;, A.&quot;).append(getFieldInfo().getFieldName(VTOEventFieldInfo.VTOEVENT_NAME));</span>
<span class="nc" id="L117">					WorkRuleUtil.appendCommaIfPassStringIsNotEmpty(orderByQuery).append(getFieldInfo().getFieldName(VTOEventFieldInfo.VTOEVENT_NAME));</span>
<span class="nc" id="L118">					break;</span>
				case ACTIVITY:
<span class="nc" id="L120">					selectQuery.append(&quot;, (SELECT B.&quot;).append(afi.getFieldName(ActivityFieldInfo.ACTIVITY_NAME)).append(</span>
<span class="nc" id="L121">							&quot; FROM &quot;).append(afi.getTableName()).append(&quot; B WHERE B.&quot;).append(afi.getIDFieldName()).append(</span>
<span class="nc" id="L122">							&quot; = A.&quot;).append(getFieldInfo().getFieldName(VTOEventFieldInfo.VTOEVENT_ACTIVITYID)).append(</span>
<span class="nc" id="L123">							&quot;) AS &quot;).append(afi.getTableName()).append(&quot;_&quot;).append(</span>
<span class="nc" id="L124">							afi.getFieldName(ActivityFieldInfo.ACTIVITY_NAME));</span>
<span class="nc" id="L125">					WorkRuleUtil.appendCommaIfPassStringIsNotEmpty(orderByQuery).append(activitySortFieldKey);</span>
<span class="nc" id="L126">					break;</span>
				case MIN_DURATION:
<span class="nc" id="L128">					selectQuery.append(&quot;, A.&quot;).append(getFieldInfo().getFieldName(VTOEventFieldInfo.VTOEVENT_MINDURATION));</span>
<span class="nc" id="L129">					WorkRuleUtil.appendCommaIfPassStringIsNotEmpty(orderByQuery).append(getFieldInfo().getFieldName(VTOEventFieldInfo.VTOEVENT_MINDURATION));</span>
<span class="nc" id="L130">					break;</span>
				case MAX_DURATION:
<span class="nc" id="L132">					selectQuery.append(&quot;, A.&quot;).append(getFieldInfo().getFieldName(VTOEventFieldInfo.VTOEVENT_MAXDURATION));</span>
<span class="nc" id="L133">					WorkRuleUtil.appendCommaIfPassStringIsNotEmpty(orderByQuery).append(getFieldInfo().getFieldName(VTOEventFieldInfo.VTOEVENT_MAXDURATION));</span>
<span class="nc" id="L134">					break;</span>
				case ORGANIZATION:
<span class="nc" id="L136">					selectQuery.append(&quot;, (SELECT C.&quot;).append(ofi.getFieldName(OrganizationFieldInfo.ORGANIZATION_NAME)).append(</span>
<span class="nc" id="L137">							&quot; FROM &quot;).append(ofi.getTableName()).append(&quot; C WHERE C.&quot;).append(ofi.getIDFieldName()).append(</span>
<span class="nc" id="L138">							&quot; = A.&quot;).append(getFieldInfo().getFieldName(VTOEventFieldInfo.VTOEVENT_ORGANIZATIONID)).append(</span>
<span class="nc" id="L139">							&quot;) AS &quot;).append(organizationSortFieldKey);</span>
<span class="nc" id="L140">					WorkRuleUtil.appendCommaIfPassStringIsNotEmpty(orderByQuery).append(organizationSortFieldKey);					</span>
<span class="nc" id="L141">					break;</span>
				case DESCRIPTION:
<span class="nc" id="L143">					selectQuery.append(&quot;, A.&quot;).append(getFieldInfo().getFieldName(VTOEventFieldInfo.VTOEVENT_DESCRIPTION));</span>
<span class="nc" id="L144">					WorkRuleUtil.appendCommaIfPassStringIsNotEmpty(orderByQuery).append(getFieldInfo().getFieldName(VTOEventFieldInfo.VTOEVENT_DESCRIPTION));						</span>
<span class="nc" id="L145">					break;</span>
				default: break;
			}
<span class="fc" id="L148">		}</span>
<span class="fc" id="L149">	}</span>
	
	protected Object getPaginationDataFieldValue(JdmoRowset rowData, DBSortField sortField) throws JdmoException {
<span class="nc" id="L152">		VTOEventSortField vtoeSortField = (VTOEventSortField)sortField;</span>
<span class="nc bnc" id="L153" title="All 7 branches missed.">		switch(vtoeSortField) {</span>
		case NAME:
<span class="nc" id="L155">			return rowData.getString(getFieldInfo().getFieldName(VTOEventFieldInfo.VTOEVENT_NAME));</span>
		case ACTIVITY:
<span class="nc" id="L157">			return rowData.getString(activitySortFieldKey);</span>
		case MIN_DURATION:
<span class="nc" id="L159">			return rowData.getString(getFieldInfo().getFieldName(VTOEventFieldInfo.VTOEVENT_MINDURATION));</span>
		case MAX_DURATION:
<span class="nc" id="L161">			return rowData.getString(getFieldInfo().getFieldName(VTOEventFieldInfo.VTOEVENT_MAXDURATION));</span>
		case ORGANIZATION:
<span class="nc" id="L163">			return rowData.getString(organizationSortFieldKey);				</span>
		case DESCRIPTION:
<span class="nc" id="L165">			return rowData.getString(getFieldInfo().getFieldName(VTOEventFieldInfo.VTOEVENT_DESCRIPTION));</span>
<span class="nc" id="L166">		default: return null;				</span>
		}
	}
	
	@Override
	protected Map&lt;Integer, ? extends FieldInfo&gt; getForeignKeyFieldInfo() {
<span class="fc" id="L172">		Map&lt;Integer, FieldInfo&gt; retVal = new HashMap&lt;Integer, FieldInfo&gt;();</span>
<span class="fc" id="L173">		retVal.put(VTOEventFieldInfo.VTOEVENT_CAMPAIGNID, new CampaignFieldInfo());</span>
<span class="fc" id="L174">		return retVal;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>