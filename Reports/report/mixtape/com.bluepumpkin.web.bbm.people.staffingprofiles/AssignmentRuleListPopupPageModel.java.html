<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>AssignmentRuleListPopupPageModel.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.bbm.people.staffingprofiles</a> &gt; <span class="el_source">AssignmentRuleListPopupPageModel.java</span></div><h1>AssignmentRuleListPopupPageModel.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.bbm.people.staffingprofiles;

import java.util.ArrayList;
import java.util.Collection;
import java.util.HashMap;
import java.util.HashSet;
import java.util.Iterator;
import java.util.Map;
import java.util.TimeZone;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.util.StringUtil;
import com.bluepumpkin.ejb.bbm.activity.model.Activity;
import com.bluepumpkin.ejb.bbm.campaign.model.Campaign;
import com.bluepumpkin.ejb.bbm.workresource.model.Organization;
import com.bluepumpkin.ejb.bbm.workrules.model.ComplexWorkRule;
import com.bluepumpkin.web.bbm.l10n.BbmWebBundleKey;
import com.bluepumpkin.web.core.l10n.CoreWebBundleKey;
import com.verint.ejb.wfm.WfmManagerFactory;
import com.verint.web.wfm.keys.WfmJavaScriptFileID;
import com.witness.web.uif.keys.JavaScriptFileID;
import com.witness.web.uif.pagecomponent.toolbar.ToolbarTextButton;
import com.witness.web.uif.pagemodel.PopupWindowPM;
import com.witness.web.uif.system.RequestContext;


@SuppressWarnings(&quot;serial&quot;)
public class AssignmentRuleListPopupPageModel extends PopupWindowPM {

	public static final String FORM_ACTION = &quot;staffingprofile_assignmentrule_list_popup&quot;;
	public static final String POPUP_ID = &quot;POPUP_ASSIGNMENTRULE&quot;;
	public static final String POPUP_ARGS = &quot;assignmentRuleIDs,isByOrg,isSelectionPopup,ownerID,selectedIDs&quot;;
	
	private AssignmentRuleListPC m_listPC;
	private Collection&lt;ComplexWorkRule&gt; assignmentRules;
	private boolean isByOrg;
	private ID ownerID;
	private TimeZone optimizationTargetTimeZone;
<span class="fc" id="L39">	private boolean isSelectionPopup = false;</span>
<span class="fc" id="L40">	private HashSet&lt;ID&gt; selectedIDs = new HashSet&lt;ID&gt;();</span>
	
<span class="fc" id="L42">	private Map&lt;ID, Organization&gt; orgMap = new HashMap&lt;ID, Organization&gt;();</span>
<span class="fc" id="L43">	private Map&lt;ID, Campaign&gt; campaignMap = new HashMap&lt;ID, Campaign&gt;();</span>
<span class="fc" id="L44">	private Map&lt;ID, Activity&gt; activityMap = new HashMap&lt;ID, Activity&gt;();</span>
	
	public AssignmentRuleListPopupPageModel(RequestContext context) {
<span class="fc" id="L47">		super(context);</span>

<span class="fc" id="L49">		addRequiredJavaScriptFile(WfmJavaScriptFileID.STAFFING_PROFILE_POPUP);</span>
<span class="fc" id="L50">		addRequiredJavaScriptFile(JavaScriptFileID.JQUERY);</span>
<span class="fc" id="L51">	}</span>
	
	public static AssignmentRuleListPopupPageModel getInstance(RequestContext context) {
<span class="fc" id="L54">		return (com.bluepumpkin.web.bbm.people.staffingprofiles.AssignmentRuleListPopupPageModel)getInstance(context, </span>
				com.bluepumpkin.web.bbm.people.staffingprofiles.AssignmentRuleListPopupPageModel.class);
	}
	
	protected void initializeModel() {
<span class="fc bfc" id="L59" title="All 2 branches covered.">		if (m_isInitialized)</span>
<span class="fc" id="L60">			return;</span>
		else
<span class="fc" id="L62">			m_isInitialized = true;</span>
		try {
<span class="fc" id="L64">			loadData();</span>
<span class="fc" id="L65">			initContentTitle();</span>
<span class="fc" id="L66">			initList();</span>
<span class="pc bpc" id="L67" title="1 of 2 branches missed.">			if (isSelectionPopup) {</span>
<span class="fc" id="L68">				ToolbarTextButton addButton = m_toolbar.createCloseWindowButton(</span>
<span class="fc" id="L69">						&quot;addAssignmentRules&quot;, m_localizer.i18n(BbmWebBundleKey.BUNDLE_NAME,</span>
								BbmWebBundleKey.FS_ADD_ASSIGNMENTRULES), true);
<span class="fc" id="L71">				addButton.setCustomJS(m_toolbar.getName() + &quot;.disableButton('addAssignmentRules'); StaffingProfileSelectionUtil.addAssignmentRules();&quot;);</span>
<span class="fc" id="L72">				m_toolbar.addToolbarElement(addButton);</span>
<span class="fc" id="L73">				m_toolbar.addCloseWindowTextButton(&quot;cancel&quot;, m_localizer.i18n(</span>
						CoreWebBundleKey.BUNDLE_NAME, CoreWebBundleKey.TOOLBAR_CANCEL), true);
			}
<span class="nc" id="L76">		} catch (Exception ex) {</span>
<span class="nc" id="L77">			handleUnableToLoadDataError(log, ex);</span>
<span class="fc" id="L78">		}</span>
<span class="fc" id="L79">	}</span>
	
	protected void initUtilityPane() {
<span class="fc" id="L82">		getUtilityPane().setIsHelpEnabled(false);</span>
<span class="fc" id="L83">	}</span>
	
	protected void initContentTitle() {
<span class="fc" id="L86">		m_contentTitlePC.setPageTitle(getLocalizer().i18n(</span>
				BbmWebBundleKey.BUNDLE_NAME, BbmWebBundleKey.FS_ASSIGNMENTRULES));
<span class="fc" id="L88">	}</span>
	
	protected void loadData() throws Exception {
<span class="pc bpc" id="L91" title="1 of 2 branches missed.">		if (ownerID != null) {</span>
<span class="pc bpc" id="L92" title="1 of 2 branches missed.">			if (isByOrg) {				</span>
<span class="fc" id="L93">				ArrayList&lt;ID&gt; ids = new ArrayList&lt;ID&gt;();</span>
<span class="fc" id="L94">				ids.add(ownerID);</span>
<span class="fc" id="L95">				assignmentRules = WfmManagerFactory.getWorkRuleManager(getRequestContext().isInWhatIfMode()).</span>
<span class="fc" id="L96">						getComplexWorkRulesForOrgs(ids);</span>
			}
		} 
		
		// If we are assigning shifts to some work patterns, filter out the shifts that are already assigned to all work patterns 
<span class="fc bfc" id="L101" title="All 2 branches covered.">		if (selectedIDs.size() &gt; 0) {</span>
<span class="fc" id="L102">			Iterator&lt;ComplexWorkRule&gt; iter = assignmentRules.iterator();</span>
<span class="fc bfc" id="L103" title="All 2 branches covered.">			while (iter.hasNext()) {</span>
<span class="fc" id="L104">				ComplexWorkRule rule = iter.next();</span>
<span class="fc" id="L105">				ID id = rule.getID();</span>
<span class="fc bfc" id="L106" title="All 2 branches covered.">				if (selectedIDs.contains(id)) iter.remove();</span>
<span class="fc" id="L107">			}</span>
		} 
<span class="fc" id="L109">	}</span>

	protected void initList() {
<span class="pc bpc" id="L112" title="1 of 2 branches missed.">		if (assignmentRules != null) {</span>
<span class="fc" id="L113">			m_listPC = new AssignmentRuleListPC(getRequestContext(), assignmentRules, optimizationTargetTimeZone, orgMap, </span>
					campaignMap, activityMap);
<span class="fc" id="L115">			addChildComponent(m_listPC);</span>
		}
<span class="fc" id="L117">	}</span>
	
	public String getHtmlDisplay() {
<span class="fc" id="L120">		return m_listPC.getHtmlDisplay();</span>
	}
	
	public void setOptimizationTargetTimeZoneID(String optimizationTargetTimeZoneID) {
<span class="nc" id="L124">		this.optimizationTargetTimeZone = TimeZone.getTimeZone(optimizationTargetTimeZoneID);</span>
<span class="nc" id="L125">	}</span>
	
	public void setIsByOrg(boolean isByOrg) {
<span class="fc" id="L128">		this.isByOrg = isByOrg;</span>
<span class="fc" id="L129">	}</span>
	
	public void setIsSelectionPopup(boolean isSelectionPopup) {
<span class="fc" id="L132">		this.isSelectionPopup = isSelectionPopup;</span>
<span class="fc" id="L133">	}</span>
	
	public void setOwnerID(String ownerID) {
<span class="fc" id="L136">		this.ownerID = new ID(ownerID);</span>
<span class="fc" id="L137">	}</span>
	
	public void setSelectedIDs(String selectedIDs) {
<span class="fc" id="L140">		this.selectedIDs = new HashSet&lt;ID&gt;(StringUtil.parseIDStringToCollection(selectedIDs));</span>
<span class="fc" id="L141">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>