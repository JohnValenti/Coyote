<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>QueueAttributeFilterDAO.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.ejb.bbm.workload.ejb</a> &gt; <span class="el_source">QueueAttributeFilterDAO.java</span></div><h1>QueueAttributeFilterDAO.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.ejb.bbm.workload.ejb;

/**
 * Title:        Blue Pumpkin Software Basic Business Model
 * Copyright:    Copyright (c) 2001
 * Company:      Blue Pumpkin Software, Inc
 * @author       Sankar Nair
 * @version      1.0
 */

import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.util.ArrayList;
import java.util.Collection;
import java.util.Collections;
import java.util.Iterator;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.jdmo.Jdmo;
import com.bluepumpkin.common.jdmo.JdmoConnection;
import com.bluepumpkin.common.jdmo.JdmoException;
import com.bluepumpkin.common.jdmo.JdmoQuery;
import com.bluepumpkin.common.jdmo.JdmoRowset;
import com.bluepumpkin.ejb.bbm.BbmManagerFactory;
import com.bluepumpkin.ejb.bbm.base.BbmFinderException;
import com.bluepumpkin.ejb.bbm.dao.DAOBase;
import com.bluepumpkin.ejb.bbm.vo.FieldInfo;
import com.bluepumpkin.ejb.bbm.vo.ValueObjectBase;
import com.bluepumpkin.ejb.bbm.workload.model.queueattribute.QueueAttributeFilter;
import com.bluepumpkin.ejb.bbm.workload.model.queueattribute.QueueAttributeFilterFieldInfo;
import com.bluepumpkin.ejb.bbm.workload.model.queueattribute.QueueAttributeFilterSelectedOrganization;
import com.verint.ejb.wfm.WfmManagerFactory;

public class QueueAttributeFilterDAO extends DAOBase {

<span class="fc" id="L36">		private static FieldInfo m_fieldInfo = new QueueAttributeFilterFieldInfo();</span>
<span class="fc" id="L37">		protected FieldInfo getFieldInfo() { return m_fieldInfo; }</span>

		public QueueAttributeFilterDAO() {
<span class="fc" id="L40">            super();</span>
<span class="fc" id="L41">		}</span>

		public QueueAttributeFilterDAO(Jdmo dmo) {
<span class="nc" id="L44">            super(dmo);</span>
<span class="nc" id="L45">		}</span>

		protected ValueObjectBase createValueObject()
		{
<span class="nc" id="L49">            return (new QueueAttributeFilter());</span>
		}
		
		public Collection&lt;ID&gt; getQueues(QueueAttributeFilter filter, ID campaignID, ID spID) throws BbmFinderException {
			Collection&lt;ID&gt; queueIDs;
			//Jdmo jdmo = null;
			try {
<span class="nc bnc" id="L56" title="All 4 branches missed.">				if(filter == null || filter.getID() == null)</span>
<span class="nc" id="L57">					throw new BbmFinderException(new NullPointerException(&quot;Filter object is not defined correctly&quot;));</span>
				
<span class="nc bnc" id="L59" title="All 4 branches missed.">				if(filter.getSelectedOrgs() == null || filter.getSelectedOrgs().size() &lt;= 0)</span>
<span class="nc" id="L60">					throw new BbmFinderException(new NullPointerException(&quot;No Organizations found in the selected filter&quot;));</span>
				
<span class="nc" id="L62">				ID filterID = filter.getID();</span>
				//jdmo = new Jdmo();
<span class="nc" id="L64">				JdmoConnection conn = m_dmo.getConnection();</span>
<span class="nc" id="L65">				StringBuffer queryString = new StringBuffer();</span>
				
<span class="nc" id="L67">				ArrayList&lt;ID&gt; orgIDs = new ArrayList&lt;ID&gt;();</span>
<span class="nc" id="L68">				Iterator&lt;QueueAttributeFilterSelectedOrganization&gt; iter = filter.getSelectedOrgs().iterator();</span>
<span class="nc bnc" id="L69" title="All 2 branches missed.">				while(iter.hasNext()) {</span>
<span class="nc" id="L70">					orgIDs.add(iter.next().getQueueAttributeID());</span>
				}
				
<span class="nc" id="L73">				Collection allOrgsAndParentsToFilter = BbmManagerFactory.getWorkResourceManager().getOrganizationsParentsByIDs(orgIDs);</span>
<span class="nc" id="L74">				allOrgsAndParentsToFilter.addAll(orgIDs);</span>
				
<span class="nc" id="L76">				Collection&lt;ID&gt; rootQueueIDs = null;</span>
<span class="nc bnc" id="L77" title="All 4 branches missed.">				if(filter.isShowRootQueuesOnly() &amp;&amp; spID != null) {</span>
<span class="nc" id="L78">                    Collection spOrgIDs = WfmManagerFactory.getCampaignManager().getLinkedOrgsforSP(spID);</span>
<span class="nc" id="L79">                    Collection parentOrgs = BbmManagerFactory.getWorkResourceManager().getOrganizationsParentsByIDs(spOrgIDs);</span>
<span class="nc" id="L80">                    parentOrgs.addAll(spOrgIDs);</span>
<span class="nc" id="L81">                    rootQueueIDs = getRootLinkedAndNonLinkedQueueIDs(parentOrgs);</span>

<span class="nc bnc" id="L83" title="All 2 branches missed.">				} else if(filter.isShowRootQueuesOnly()) {</span>
					//rootQueueIDs = getRootLinkQueueIDs(filter.getSelectedOrgs());
<span class="nc" id="L85">                    rootQueueIDs = getRootLinkedAndNonLinkedQueueIDs(allOrgsAndParentsToFilter);</span>
				}
				 
				 
				 //Getting queues of the organization
				 //queryString.append(&quot;SELECT DISTINCT Q.SID FROM QUEUE Q INNER JOIN QUEUEATTRIBFILTERSELORGS SO ON Q.ORGANIZATIONID = SO.ORGANIZATIONID AND SO.QUEUEATTRIBUTEFILTERID = &quot;).append(filterID);
				 //Removing the join to QUEUEATTRIBFILTERSELORGS table to include parent organizations of the currently selected orgs also
<span class="nc" id="L92">				 queryString.append(&quot;SELECT DISTINCT Q.SID FROM QUEUE Q &quot;);</span>

<span class="nc bnc" id="L94" title="All 4 branches missed.">				 if(campaignID != null &amp;&amp; spID == null) {</span>
					 //queryString.append(&quot; INNER JOIN SPCALLCENTER SPC ON Q.ORGANIZATIONID = SPC.ORGANIZATIONID INNER JOIN SP ON SPC.SPID = SP.ID INNER JOIN CAMPAIGN C ON SP.CAMPAIGNID = C.ID AND C.SID = &quot;).append(campaignID);
<span class="nc" id="L96">					 queryString.append(&quot; INNER JOIN SPQUEUE SPQ ON Q.ID = SPQ.QUEUEID INNER JOIN SP ON SP.ID = SPQ.SPID INNER JOIN CAMPAIGN C ON SP.CAMPAIGNID = C.ID AND C.SID = &quot;).append(campaignID);</span>

				 }
				 
<span class="nc bnc" id="L100" title="All 2 branches missed.">				 if(spID != null) {</span>
					 //queryString.append(&quot; INNER JOIN SPCALLCENTER SPC ON Q.ORGANIZATIONID = SPC.ORGANIZATIONID INNER JOIN SP ON SPC.SPID = SP.ID AND SP.SID = &quot;).append(spID);
<span class="nc" id="L102">					 queryString.append(&quot; INNER JOIN SPQUEUE SPQ ON Q.ID = SPQ.QUEUEID AND SPID IN (SELECT ID FROM SP WHERE SID = &quot;).append(spID).append(&quot;)&quot;);</span>
				 }
				 
<span class="nc bnc" id="L105" title="All 4 branches missed.">				 if(filter.getSelectedMedia() != null &amp;&amp; filter.getSelectedMedia().size() &gt; 0) {</span>
					 //Getting queues of the selected media type one
<span class="nc" id="L107">					 queryString.append(&quot; INNER JOIN  QUEUEATTRIBFILTERMEDIA SM ON Q.MEDIAID = SM.MEDIAID AND SM.QUEUEATTRIBUTEFILTERID = &quot;).append(filterID);</span>
				 }
				 
<span class="nc bnc" id="L110" title="All 4 branches missed.">				 if(filter.getTextValues() != null &amp;&amp; filter.getTextValues().size() &gt; 0) {</span>
					 //Getting the queues with the user specified text values only
<span class="nc" id="L112">					 queryString.append(&quot; INNER JOIN QUEUEATTRIBUTEPAIRVALUETEXT PTEXT ON PTEXT.QUEUEID = Q.SID&quot;);</span>
<span class="nc" id="L113">					 queryString.append(&quot; AND PTEXT.QUEUEID in (SELECT PTEXT1.QUEUEID FROM QUEUEATTRIBUTEPAIRVALUETEXT PTEXT1 &quot;);</span>
<span class="nc" id="L114">					 queryString.append(&quot; INNER JOIN QUEUEATTRIBFILTERSELTEXT STEXT ON PTEXT1.VALUE LIKE '%' + STEXT.SELECTEDVALUE + '%'&quot;);</span>
<span class="nc" id="L115">					 queryString.append(&quot; AND PTEXT1.QUEUEATTRIBUTEID = STEXT.QUEUEATTRIBUTEID AND STEXT.QUEUEATTRIBUTEFILTERID = &quot;).append(filterID);</span>
<span class="nc" id="L116">					 queryString.append(&quot; GROUP BY PTEXT1.QUEUEID HAVING COUNT(PTEXT1.ID) = (select COUNT(ID) From QUEUEATTRIBFILTERSELTEXT where QUEUEATTRIBUTEFILTERID = &quot;).append(filterID).append(&quot; ))&quot;);</span>
				 }
				 
<span class="nc bnc" id="L119" title="All 4 branches missed.">				 if(filter.getNumericValues() != null &amp;&amp; filter.getNumericValues().size() &gt; 0) {</span>
					 //Getting the queues with the user specified numeric values only
<span class="nc" id="L121">					 queryString.append(&quot; INNER JOIN QUEUEATTRIBUTEPAIRVALUENUM PNUMERIC ON PNUMERIC.QUEUEID = Q.SID &quot;);</span>
<span class="nc" id="L122">					 queryString.append(&quot; AND PNUMERIC.QUEUEID IN (SELECT PNUMERIC1.QUEUEID FROM QUEUEATTRIBUTEPAIRVALUENUM PNUMERIC1&quot;);</span>
<span class="nc" id="L123">					 queryString.append(&quot; INNER JOIN QUEUEATTRIBFILTERSELNUMERIC SNUMERIC ON PNUMERIC1.VALUE BETWEEN SNUMERIC.SELECTEDVALUESTART AND SNUMERIC.SELECTEDVALUEEND&quot;);</span>
<span class="nc" id="L124">					 queryString.append(&quot; AND PNUMERIC1.QUEUEATTRIBUTEID = SNUMERIC.QUEUEATTRIBUTEID AND SNUMERIC.QUEUEATTRIBUTEFILTERID = &quot;).append(filterID);</span>
<span class="nc" id="L125">					 queryString.append(&quot; GROUP BY PNUMERIC1.QUEUEID HAVING COUNT(PNUMERIC1.ID) = (SELECT COUNT(ID) FROM QUEUEATTRIBFILTERSELNUMERIC WHERE QUEUEATTRIBUTEFILTERID = &quot;).append(filterID).append(&quot; ))&quot;);</span>
				 }

<span class="nc bnc" id="L128" title="All 4 branches missed.">				 if(filter.getDateValues() != null &amp;&amp; filter.getDateValues().size() &gt; 0) {</span>
					 //Getting the queues with the user specified date values only
<span class="nc" id="L130">					 queryString.append(&quot; INNER JOIN QUEUEATTRIBUTEPAIRVALUEDATE PDATE ON PDATE.QUEUEID = Q.SID&quot;);</span>
<span class="nc" id="L131">					 queryString.append(&quot; AND PDATE.QUEUEID IN (SELECT PDATE1.QUEUEID FROM QUEUEATTRIBUTEPAIRVALUEDATE PDATE1&quot;);</span>
<span class="nc" id="L132">					 queryString.append(&quot; INNER JOIN QUEUEATTRIBFILTERSELDATE SDATE ON PDATE1.VALUE BETWEEN SDATE.SELECTEDVALUESTART AND SDATE.SELECTEDVALUEEND&quot;);</span>
<span class="nc" id="L133">					 queryString.append(&quot; AND PDATE1.QUEUEATTRIBUTEID = SDATE.QUEUEATTRIBUTEID &quot;);</span>
<span class="nc" id="L134">					 queryString.append(&quot; AND SDATE.QUEUEATTRIBUTEFILTERID = &quot;).append(filterID);</span>
<span class="nc" id="L135">					 queryString.append(&quot; GROUP BY PDATE1.QUEUEID HAVING COUNT(PDATE1.ID) = (SELECT COUNT(ID) FROM QUEUEATTRIBFILTERSELDATE WHERE QUEUEATTRIBUTEFILTERID = &quot;).append(filterID).append(&quot; ))&quot;);</span>
				 }
				 
<span class="nc bnc" id="L138" title="All 4 branches missed.">				 if(filter.getDropDownValues() != null &amp;&amp; filter.getDropDownValues().size() &gt; 0) {</span>
					 //Getting the queues with the user specified drop down values only
<span class="nc" id="L140">					 String querySoFar = queryString.toString();</span>
					 //For Drop Down values, there is a bug that the selection condition is acting like an OR rather than AND
					 //Create Queue Attribute

					 //1. DD1 as drop down list add value as A and B
					 //2. DD2 as drop down list add value as C and D

					 //Then assigned to queue as
					 //Q1:DD1 = A and DD2 = C
					 //Q2:DD1 = B and DD2 = D

					 //Filter with DD1 as A and DD2 as D
					 //Earlier was showing both Q1 and Q2. But ideally no queue should appear 
					 //as Q1 and Q2 both don't qualify the filter criteria
					 

<span class="nc" id="L156">					 queryString.append(&quot; INNER JOIN QUEUEATTRIBUTEPAIRVALUEDD PDD ON PDD.QUEUEID = Q.SID  AND PDD.QUEUEID IN (&quot;);</span>
<span class="nc" id="L157">					 queryString.append(&quot; SELECT PDD.QUEUEID FROM QUEUEATTRIBUTEPAIRVALUEDD PDD &quot;);</span>
<span class="nc" id="L158">					 queryString.append(&quot; INNER JOIN QUEUEATTRIBFILTERSELDD SDD on SDD.QUEUEATTRIBUTEID = PDD.QUEUEATTRIBUTEID AND PDD.VALUE = SDD.SELECTEDVALUE &quot;);</span>
<span class="nc" id="L159">					 queryString.append(&quot; WHERE SDD.QUEUEATTRIBUTEFILTERID = &quot;).append(filterID);</span>
<span class="nc" id="L160">					 queryString.append(&quot; GROUP by PDD.QUEUEID&quot;);</span>
<span class="nc" id="L161">					 queryString.append(&quot; HAVING COUNT(PDD.ID) = (select COUNT(ID) From QUEUEATTRIBFILTERSELDD where QUEUEATTRIBUTEFILTERID = &quot;).append(filterID).append(&quot; ))&quot;);</span>
				 }
				 
<span class="nc bnc" id="L164" title="All 4 branches missed.">				 if(filter.getBooleanValues() != null &amp;&amp; filter.getBooleanValues().size() &gt; 0) {</span>
					 //Getting the queues with the user specified boolean values only
<span class="nc" id="L166">					 queryString.append(&quot; INNER JOIN QUEUEATTRIBPAIRVALUEBOOL PBOOL ON PBOOL.QUEUEID = Q.SID&quot;);</span>
<span class="nc" id="L167">					 queryString.append(&quot; INNER JOIN QUEUEATTRIBFILTERSELBOOL SBOOL ON PBOOL.VALUE = SBOOL.SELECTEDVALUE AND PBOOL.QUEUEATTRIBUTEID = SBOOL.QUEUEATTRIBUTEID AND SBOOL.QUEUEATTRIBUTEFILTERID = &quot;).append(filterID);</span>
				 }

<span class="nc" id="L170">				queryString.append(&quot; WHERE Q.ORGANIZATIONID IN &quot;).append(m_dmo.createInClause(allOrgsAndParentsToFilter));			</span>
				
<span class="nc" id="L172">				 PreparedStatement pstmt = conn.prepareStatement(queryString.toString());</span>

<span class="nc" id="L174">				 ResultSet r = pstmt.executeQuery();</span>
<span class="nc" id="L175">				 queueIDs = new ArrayList&lt;ID&gt;();</span>
<span class="nc bnc" id="L176" title="All 2 branches missed.">				 while(r.next()) {</span>
<span class="nc" id="L177">					 ID qID = new ID(r.getInt(1));</span>
<span class="nc bnc" id="L178" title="All 2 branches missed.">					 if(filter.isShowRootQueuesOnly()) {</span>
<span class="nc bnc" id="L179" title="All 4 branches missed.">						 if(rootQueueIDs != null &amp;&amp; rootQueueIDs.contains(qID))</span>
<span class="nc" id="L180">							 queueIDs.add(qID);</span>
					 } else {
<span class="nc" id="L182">						 queueIDs.add(qID); </span>
					 }
<span class="nc" id="L184">				 }</span>
<span class="nc" id="L185">				 return queueIDs;</span>
<span class="nc" id="L186">			} catch (Exception e) {</span>
<span class="nc" id="L187">				e.printStackTrace();</span>
<span class="nc" id="L188">				throw new BbmFinderException(e);</span>
<span class="nc" id="L189">			} finally {</span>
//		        if (jdmo != null) {
//		        	jdmo.cleanUp();
//		        	jdmo = null;
//		        }

			}
		}
		
		
		/**
		 * Takes the user ID and the orgs in scope for that user and returns the named filter which matches the criteria.
		 * @param userID - User for whom the Named Filter list needs to be published
		 * @param orgIDsInScope - Collection of IDs of the Orgs which the user has permission
		 * @return
		 * @throws BbmFinderException
		 */
		public Collection getQueueAttributeFiltersForUser(ID userID, Collection orgIDsInScope) throws BbmFinderException	{
//			Jdmo jdmo = new Jdmo();
<span class="pc bpc" id="L208" title="1 of 2 branches missed.">			if (userID == null) return Collections.EMPTY_LIST;</span>
<span class="pc bpc" id="L209" title="2 of 4 branches missed.">			if(orgIDsInScope == null || orgIDsInScope.size() &lt; 1) return Collections.EMPTY_LIST;</span>
			
<span class="fc" id="L211">			StringBuffer query = new StringBuffer(&quot;&quot;);</span>
			
			try {
<span class="fc" id="L214">				query.append(&quot; SELECT DISTINCT ID, NAME, ISPUBLIC, USERID, SHOWROOTQUEUESONLY FROM QUEUEATTRIBUTEFILTER, &quot;); </span>
<span class="fc" id="L215">				query.append(&quot; (SELECT QUEUEATTRIBUTEFILTERID NFID, COUNT(*) AS REC FROM QUEUEATTRIBFILTERSELORGS&quot;);</span>
<span class="fc" id="L216">				query.append(&quot; WHERE ORGANIZATIONID IN &quot;).append(m_dmo.createInClause(orgIDsInScope));</span>
<span class="fc" id="L217">				query.append(&quot; GROUP BY QUEUEATTRIBUTEFILTERID) X&quot;);</span>
<span class="fc" id="L218">				query.append(&quot; WHERE (X.NFID = ID AND REC = (SELECT COUNT(*) FROM QUEUEATTRIBFILTERSELORGS WHERE QUEUEATTRIBUTEFILTERID = X.NFID))&quot;);</span>
<span class="fc" id="L219">				query.append(&quot; AND (ISPUBLIC = 1 OR USERID = &quot;).append(userID.toString()).append(&quot;) ORDER BY NAME&quot;);</span>
<span class="nc" id="L220">			} catch (JdmoException e1) {</span>
<span class="nc" id="L221">				e1.printStackTrace();</span>
<span class="nc" id="L222">				throw new BbmFinderException(e1);</span>
<span class="nc" id="L223">			} finally {</span>
//				if (jdmo != null) {
//		        	jdmo.cleanUp();
//		        	jdmo = null;
//		        }
<span class="fc" id="L228">			}</span>

//			jdmo = new Jdmo();
			
<span class="fc" id="L232">			ArrayList&lt;QueueAttributeFilter&gt; filters = new ArrayList&lt;QueueAttributeFilter&gt;();</span>
			
			try {
<span class="fc" id="L235">				JdmoRowset r = m_dmo.createRowset(query.toString());</span>
<span class="pc bpc" id="L236" title="1 of 2 branches missed.">				while (r.next()) {</span>
<span class="nc" id="L237">					QueueAttributeFilter filter = new QueueAttributeFilter();</span>
<span class="nc" id="L238">					filter.setID(r.getID(&quot;ID&quot;));</span>
<span class="nc" id="L239">					filter.setName(r.getString(&quot;NAME&quot;));</span>
<span class="nc" id="L240">					filter.setUserID(r.getID(&quot;USERID&quot;));</span>
<span class="nc" id="L241">					filter.setIsPublic(r.getBoolean(&quot;ISPUBLIC&quot;));</span>
<span class="nc" id="L242">					filter.setIsShowRootQueuesOnly(r.getBoolean(&quot;SHOWROOTQUEUESONLY&quot;));</span>
<span class="nc" id="L243">					filters.add(filter);</span>
<span class="nc" id="L244">				}</span>
<span class="nc" id="L245">			} catch (JdmoException e) {</span>
<span class="nc" id="L246">				e.printStackTrace();</span>
<span class="nc" id="L247">				throw new BbmFinderException(e);</span>
<span class="nc" id="L248">			} finally {</span>
//				if (jdmo != null) {
//					jdmo.cleanUp();
//					jdmo = null;
//			    }	
<span class="fc" id="L253">			}</span>
			
<span class="fc" id="L255">			return filters;</span>
		}

		public Collection&lt;String&gt; getQueueAttributeFilterNames() throws BbmFinderException {
			
//			Jdmo jdmo = new Jdmo();
			
<span class="nc" id="L262">			ArrayList&lt;String&gt; filterNames = new ArrayList&lt;String&gt;();</span>
<span class="nc" id="L263">			StringBuffer query = new StringBuffer(&quot;&quot;);</span>
<span class="nc" id="L264">			query.append(&quot;SELECT NAME FROM QUEUEATTRIBUTEFILTER&quot;);</span>

			try {
<span class="nc" id="L267">				JdmoRowset r = m_dmo.createRowset(query.toString());</span>
<span class="nc bnc" id="L268" title="All 2 branches missed.">				while (r.next()) {</span>
<span class="nc" id="L269">					filterNames.add(r.getString(&quot;NAME&quot;));</span>
				}
<span class="nc" id="L271">			} catch (JdmoException e) {</span>
<span class="nc" id="L272">				e.printStackTrace();</span>
<span class="nc" id="L273">				throw new BbmFinderException(e);</span>
<span class="nc" id="L274">			} finally {</span>
//				if (jdmo != null) {
//					jdmo.cleanUp();
//					jdmo = null;
//			    }
<span class="nc" id="L279">			}</span>
			
<span class="nc" id="L281">			return filterNames;</span>

		}
		
		public static Collection&lt;ID&gt; getRootLinkQueueIDs(Collection&lt;QueueAttributeFilterSelectedOrganization&gt; organizationID) throws JdmoException {
<span class="nc" id="L286">			Jdmo jdmo = new Jdmo();</span>
			try {
<span class="nc" id="L288">				ArrayList&lt;ID&gt; orgIDs = new ArrayList&lt;ID&gt;();</span>
<span class="nc" id="L289">				Iterator&lt;QueueAttributeFilterSelectedOrganization&gt; iter = organizationID.iterator();</span>
<span class="nc bnc" id="L290" title="All 2 branches missed.">				while(iter.hasNext()) {</span>
<span class="nc" id="L291">					orgIDs.add(iter.next().getQueueAttributeID());</span>
				}
<span class="nc" id="L293">				StringBuffer pStmt = new StringBuffer(</span>
					&quot;SELECT	DISTINCT Q.SID FROM VCTCHAIN VC, VCTCHAINQUEUE VCQ, &quot;);
				
<span class="nc" id="L296">					pStmt.append(&quot;VCTQUEUECONFIGURATION VQC, QUEUE Q, QUEUE Q2,  &quot;);</span>
<span class="nc" id="L297">					pStmt.append(&quot;VCTQUEUECONFIGURATION VQC2, MEDIA M &quot;);</span>
<span class="nc" id="L298">					pStmt.append(&quot;WHERE VCQ.VCTCHAINID = VC.ID &quot;); </span>
<span class="nc" id="L299">					pStmt.append(&quot;AND M.ID = Q.MEDIAID AND VQC.ID = VC.VCTQUEUECONFIGURATIONID &quot;);  </span>
<span class="nc" id="L300">					pStmt.append(&quot;AND VQC.QUEUEID = Q.SID  &quot;);</span>
<span class="nc" id="L301">					pStmt.append(&quot;AND Q.ORGANIZATIONID IN &quot;).append(jdmo.createInClause(orgIDs));</span>
<span class="nc" id="L302">					pStmt.append(&quot; AND ISMULTISELECT = 0 AND &quot;);</span>
<span class="nc" id="L303">					pStmt.append(&quot;Q2.SID = VCQ.QUEUEID AND VQC2.QUEUEID = VCQ.QUEUEID &quot;);  </span>
<span class="nc" id="L304">					pStmt.append(&quot;AND ((VC.TARGETEVENT = 1) OR &quot;);</span>
<span class="nc" id="L305">					pStmt.append(&quot;(VC.TARGETEVENT = 3 AND VQC2.COLLECTIONTYPE = 3)) &quot;);</span>
<span class="nc" id="L306">					pStmt.append(&quot;AND VQC.QUEUEID NOT IN (SELECT QUEUEID FROM VCTCHAINQUEUE) &quot;);</span>

<span class="nc" id="L308">				ArrayList&lt;ID&gt; queueIDs = new ArrayList&lt;ID&gt;();</span>
<span class="nc" id="L309">				JdmoQuery jq = jdmo.createQuery(pStmt.toString(), Jdmo.PARAM_QUERY);</span>
<span class="nc" id="L310">				JdmoRowset rs = jdmo.createRowset(jq, Jdmo.FORWARD_ONLY, Jdmo.READ_ONLY);</span>
<span class="nc bnc" id="L311" title="All 2 branches missed.">				while (rs.next())</span>
				{
<span class="nc" id="L313">					queueIDs.add(rs.getID(1));</span>
				}
<span class="nc" id="L315">				return queueIDs;</span>
			} finally {
<span class="nc" id="L317">				jdmo.cleanUp();</span>
<span class="nc" id="L318">				jdmo = null;</span>
			}
		}


    public static Collection getRootLinkedAndNonLinkedQueueIDs(Collection orgIDs)
            throws JdmoException   {
<span class="nc" id="L325">        Jdmo jdmo = new Jdmo();</span>
        try {

<span class="nc" id="L328">            StringBuffer pStmt = new StringBuffer(&quot;SELECT SID FROM QUEUE Q WHERE Q.ORGANIZATIONID IN &quot;);</span>
<span class="nc" id="L329">            pStmt.append(jdmo.createInClause(orgIDs));</span>
<span class="nc" id="L330">            pStmt.append(&quot; AND Q.SID NOT IN (SELECT QUEUEID FROM VCTCHAINQUEUE)&quot;);</span>

<span class="nc" id="L332">            ArrayList&lt;ID&gt; queueIDs = new ArrayList&lt;ID&gt;();</span>
<span class="nc" id="L333">            JdmoQuery jq = jdmo.createQuery(pStmt.toString(), Jdmo.PARAM_QUERY);</span>
<span class="nc" id="L334">            JdmoRowset rs = jdmo.createRowset(jq, Jdmo.FORWARD_ONLY, Jdmo.READ_ONLY);</span>
<span class="nc bnc" id="L335" title="All 2 branches missed.">            while (rs.next())</span>
            {
<span class="nc" id="L337">                queueIDs.add(rs.getID(1));</span>
            }
<span class="nc" id="L339">            return queueIDs;</span>
        } finally {
<span class="nc" id="L341">            jdmo.cleanUp();</span>
<span class="nc" id="L342">            jdmo = null;</span>
        }
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>