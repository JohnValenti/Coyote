<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>SchedulableActivityRepository.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.verint.web.rest.wfm.resource.activity</a> &gt; <span class="el_source">SchedulableActivityRepository.java</span></div><h1>SchedulableActivityRepository.java</h1><pre class="source lang-java linenums">package com.verint.web.rest.wfm.resource.activity;

import com.bluepumpkin.ejb.bbm.base.BbmFinderException;
import com.google.common.collect.Lists;
import com.verint.web.rest.wfm.repository.RepositoryLogger;
import com.verint.web.rest.wfm.repository.WfoResourceRepository;
import io.katharsis.queryParams.QueryParams;
import io.katharsis.repository.annotations.JsonApiResourceRepository;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import javax.inject.Inject;
import javax.ws.rs.container.ContainerRequestContext;
import java.rmi.RemoteException;
import java.util.Collection;
import java.util.stream.Collectors;

@JsonApiResourceRepository(SchedulableActivityEntity.class)
<span class="nc" id="L19">public class SchedulableActivityRepository extends WfoResourceRepository&lt;Integer, SchedulableActivityEntity&gt; {</span>

<span class="nc" id="L21">	private final static Logger log = LoggerFactory.getLogger(SchedulableActivityRepository.class.getName());</span>
	final static String RESOURCE_NAME = &quot;schedulableactivities&quot;;
<span class="nc" id="L23">	private final static String ENTITY_NAME = SchedulableActivityEntity.class.getSimpleName();</span>

	@Inject
	private ActivityRepository activityRepository;

	@Override
	protected Logger logger() {
<span class="nc" id="L30">		return log;</span>
	}

	@Override
	@RepositoryLogger
	public SchedulableActivityEntity findOne(Integer integer, QueryParams queryParams, ContainerRequestContext requestContext) {
<span class="nc" id="L36">		ActivityEntity entity = activityRepository.findOne(integer, queryParams, requestContext);</span>

<span class="nc" id="L38">		return SchedulableActivityMapper.INSTANCE.activityToSchedulableActivity(entity);</span>
	}

	/**
	 * Returns the set of all activities with an additional field set on them: isSchedulable.  This field will be set to true
	 * if the user has permissions to use this activity when modifying schedules.
	 * See {@link ActivityRepository#filterActivitiesWithScheduleEditPermissionsForCurrentUser} for more details.
	 */
	@Override
	@RepositoryLogger
	public Iterable&lt;SchedulableActivityEntity&gt; findAll(QueryParams queryParams, ContainerRequestContext requestContext) {
		try {
<span class="nc" id="L50">			Iterable&lt;ActivityEntity&gt; allActivities = activityRepository.findAll(queryParams, requestContext);</span>

<span class="nc" id="L52">			Collection&lt;SchedulableActivityEntity&gt; allEntities =</span>
<span class="nc" id="L53">					SchedulableActivityMapper.INSTANCE.activitiesToSchedulableActivities(Lists.newArrayList(allActivities));</span>

<span class="nc" id="L55">			Collection&lt;ActivityEntity&gt; schedulableEntities =</span>
<span class="nc" id="L56">					activityRepository.filterActivitiesWithScheduleEditPermissionsForCurrentUser(</span>
<span class="nc" id="L57">							Lists.newArrayList(allActivities), requestContext);</span>

<span class="nc" id="L59">			setSchedulableFields(allEntities,</span>
<span class="nc" id="L60">					schedulableEntities.stream().map(ActivityEntity::getID).collect(Collectors.toList()));</span>
<span class="nc" id="L61">			return allEntities;</span>
<span class="nc" id="L62">		} catch (RemoteException e) {</span>
<span class="nc" id="L63">			throw handleRemoteException(ENTITY_NAME, null, e);</span>
<span class="nc" id="L64">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L65">			throw handleBbmFinderException(ENTITY_NAME, null, e);</span>
		}
	}

	@Override
	@RepositoryLogger
	public Iterable&lt;SchedulableActivityEntity&gt; findAll(Iterable&lt;Integer&gt; integers, QueryParams queryParams, ContainerRequestContext requestContext) {
<span class="nc" id="L72">		Iterable&lt;ActivityEntity&gt; entities = activityRepository.findAll(integers, queryParams, requestContext);</span>

<span class="nc" id="L74">		return SchedulableActivityMapper.INSTANCE.activitiesToSchedulableActivities(</span>
<span class="nc" id="L75">				Lists.newArrayList(entities));</span>
	}

	@Override
	public &lt;S extends SchedulableActivityEntity&gt; S save(S entity, ContainerRequestContext requestContext) {
		//TODO:
<span class="nc" id="L81">		return activityRepository.save(entity, requestContext);</span>
	}

	@Override
	public void delete(Integer integer, ContainerRequestContext requestContext) {
<span class="nc" id="L86">		activityRepository.delete(integer, requestContext);</span>
<span class="nc" id="L87">	}</span>

	@Override
	protected String getResourceName() {
<span class="nc" id="L91">		return RESOURCE_NAME;</span>
	}

	/**
	 * Modifies the entities collection by setting the &quot;isSchedulable&quot; field to
	 * true if an ID matching the entity's ID is present in scheduleableActivityIds.
	 */
	private void setSchedulableFields(Collection&lt;SchedulableActivityEntity&gt; entities,
			Collection&lt;Integer&gt; schedulableActivityIds) {

<span class="nc" id="L101">		entities.forEach(entity -&gt; {</span>
<span class="nc bnc" id="L102" title="All 2 branches missed.">			if (schedulableActivityIds.contains(entity.getID())) {</span>
<span class="nc" id="L103">				entity.setSchedulable(true);</span>
			}
<span class="nc" id="L105">		});</span>
<span class="nc" id="L106">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>