<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>SimpleSchedulePreference.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.ejb.bbm.schedulepref.model</a> &gt; <span class="el_source">SimpleSchedulePreference.java</span></div><h1>SimpleSchedulePreference.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.ejb.bbm.schedulepref.model;

/**
 * Title:        Blue Pumpkin Software Basic Business Model
 * Description:  holds data about simple schedule preference
 * Copyright:    Copyright (c) 2001
 * Company:      Blue Pumpkin Software, inc
 * @author       lixin zhang
 * @version      1.0
 */

import java.util.Date;
import java.util.Collection;
import java.util.ArrayList;
import java.util.Iterator;

import com.bluepumpkin.common.datatypes.*;
import com.bluepumpkin.common.util.NumberFactory;
import com.bluepumpkin.ejb.bbm.vo.*;
import com.bluepumpkin.ejb.bbm.effectivity.*;

public class SimpleSchedulePreference extends ValueObjectEffectivityNode
{
	/**
	 * 
	 */
	private static final long serialVersionUID = 1L;
<span class="nc" id="L28">	private static FieldInfo m_fieldInfo = new SimpleSchedulePreferenceFieldInfo();</span>
<span class="nc" id="L29">	protected FieldInfo getFieldInfo() { return m_fieldInfo; }</span>

<span class="nc" id="L31">	public static short PREFERRED_START_NON = 0;</span>
<span class="nc" id="L32">	public static short PREFERRED_START_EARLY = 1;</span>
<span class="nc" id="L33">	public static short PREFERRED_START_LATE = 2;</span>

<span class="nc" id="L35">	public static short PREFER_DAYOFF_OVER_STARTTIME = 0;</span>
<span class="nc" id="L36">	public static short PREFER_STARTTIME_OVER_DAYOFF = 1;</span>
<span class="nc" id="L37">	public static short PREFER_DAYOFF_EQUAL_STARTTIME = 2;</span>

	// hold the start, end offset for the time ranges
<span class="nc" id="L40">	public static int PREFERENCE_INTERVAL_COUNT = 7 * 3;</span>
<span class="nc" id="L41">	private int m_startOffset[] = new int[PREFERENCE_INTERVAL_COUNT];</span>
<span class="nc" id="L42">	private int m_endOffset[] = new int[PREFERENCE_INTERVAL_COUNT];</span>

	public SimpleSchedulePreference() {
<span class="nc" id="L45">		super();</span>

<span class="nc bnc" id="L47" title="All 2 branches missed.">		for (int i = 0; i &lt; PREFERENCE_INTERVAL_COUNT; i++)</span>
<span class="nc" id="L48">		   m_startOffset[i] = m_endOffset[i] = -1;</span>

<span class="nc bnc" id="L50" title="All 2 branches missed.">		for (int i = 1; i &lt;=7; i++)</span>
<span class="nc" id="L51">		   setFieldValue(SimpleSchedulePreferenceFieldInfo.SIMPLESCHEDPREF_SUNPREF - 1 + i, (short) 100);</span>

<span class="nc" id="L53">		setType(false);</span>
<span class="nc" id="L54">	}</span>

	public ID getEmployeeID()
	{
<span class="nc" id="L58">		return getFieldValueID(SimpleSchedulePreferenceFieldInfo.SIMPLESCHEDPREF_EMPLOYEEID);</span>
	}

	public Date getStartTime()
	{
<span class="nc" id="L63">		return getFieldValueDate(SimpleSchedulePreferenceFieldInfo.SIMPLESCHEDPREF_STARTTIME);</span>
	}

	public Date getEndTime()
	{
<span class="nc" id="L68">		return getFieldValueDate(SimpleSchedulePreferenceFieldInfo.SIMPLESCHEDPREF_ENDTIME);</span>
	}

	public void setEmployeeID(ID id)
	{
<span class="nc" id="L73">		setFieldValue(SimpleSchedulePreferenceFieldInfo.SIMPLESCHEDPREF_EMPLOYEEID, id);</span>
<span class="nc" id="L74">	}</span>

	public void setStartTime(Date dt)
	{
<span class="nc" id="L78">		setFieldValue(SimpleSchedulePreferenceFieldInfo.SIMPLESCHEDPREF_STARTTIME, dt);</span>
<span class="nc" id="L79">	}</span>

	public void setEndTime(Date dt)
	{
<span class="nc" id="L83">		setFieldValue(SimpleSchedulePreferenceFieldInfo.SIMPLESCHEDPREF_ENDTIME, dt);</span>
<span class="nc" id="L84">	}</span>

	private void setType(boolean bValue)
	{
<span class="nc" id="L88">		setFieldValue(SimpleSchedulePreferenceFieldInfo.SIMPLESCHEDPREF_ISADVANCEDPREFERENCE, bValue);</span>
<span class="nc" id="L89">	}</span>

	public boolean isOverridden()
	{
<span class="nc" id="L93">		return getFieldValueBoolean(SimpleSchedulePreferenceFieldInfo.SIMPLESCHEDPREF_ISOVERRIDDEN);</span>
	}

	public boolean getPerferOvertime()
	{
<span class="nc" id="L98">		return getFieldValueBoolean(SimpleSchedulePreferenceFieldInfo.SIMPLESCHEDPREF_PREFEROVERTIME);</span>
	}

	public void setPreferOvertime(boolean bValue)
	{
<span class="nc" id="L103">		setFieldValue(SimpleSchedulePreferenceFieldInfo.SIMPLESCHEDPREF_PREFEROVERTIME, bValue);</span>
<span class="nc" id="L104">	}</span>

	public void setOverridden(boolean bValue)
	{
<span class="nc" id="L108">		setFieldValue(SimpleSchedulePreferenceFieldInfo.SIMPLESCHEDPREF_ISOVERRIDDEN, bValue);</span>
<span class="nc" id="L109">	}</span>

	public short getPreferredStart()
	{
<span class="nc" id="L113">		return getFieldValueShort(SimpleSchedulePreferenceFieldInfo.SIMPLESCHEDPREF_PREFERREDSTART);</span>
	}

	public void setPreferredStart(short sValue)
	{
<span class="nc" id="L118">		setFieldValue(SimpleSchedulePreferenceFieldInfo.SIMPLESCHEDPREF_PREFERREDSTART, sValue);</span>
<span class="nc" id="L119">	}</span>

	public short getPreferDayOff()
	{
<span class="nc" id="L123">		return getFieldValueShort(SimpleSchedulePreferenceFieldInfo.SIMPLESCHEDPREF_PREFERDAYOFF);</span>
	}

	public void setPreferDayOff(short sValue)
	{
<span class="nc" id="L128">		setFieldValue(SimpleSchedulePreferenceFieldInfo.SIMPLESCHEDPREF_PREFERDAYOFF, sValue);</span>
<span class="nc" id="L129">	}</span>

	// access preference value in bulk
	public int[] getStartOffset()
	{
<span class="nc" id="L134">		return m_startOffset;</span>
	}

	public void setStartOffset(int arrValue[])
	{
<span class="nc" id="L139">		System.arraycopy(arrValue, 0, m_startOffset, 0, PREFERENCE_INTERVAL_COUNT);</span>
<span class="nc" id="L140">	}</span>

	public int[] getEndOffset()
	{
<span class="nc" id="L144">		return m_endOffset;</span>
	}

	public void setEndOffset(int arrValue[])
	{
<span class="nc" id="L149">		System.arraycopy(arrValue, 0, m_endOffset, 0, PREFERENCE_INTERVAL_COUNT);</span>
<span class="nc" id="L150">	}</span>

	/**
	 *  get start offset for start time preference
	 *  @param iDay  1..7 means Sun, Mon, ... Sat.
	 *  @param iLevel 0, 1, 2 means first, second, third
	 *
	 *  @return start offset of the time range, 100 means blank
	 */
	public int getStartTimePreferenceStart(int iDay, int iLevel)
	{
<span class="nc bnc" id="L161" title="All 2 branches missed.">		if (iDay &lt; 1) iDay = 1;</span>
<span class="nc bnc" id="L162" title="All 2 branches missed.">		if (iDay &gt; 7) iDay = 7;</span>

<span class="nc bnc" id="L164" title="All 2 branches missed.">		if (iLevel &lt; 0) iLevel = 0;</span>
<span class="nc bnc" id="L165" title="All 2 branches missed.">		if (iLevel &gt; 2) iLevel = 2;</span>

<span class="nc" id="L167">		return m_startOffset[(iDay - 1) + iLevel * 7];</span>
	}

   /**
	 *  get end offset for start time preference
	 *  @param iDay  1..7 means Sun, Mon, ... Sat.
	 *  @param iLevel 0, 1, 2 means first, second, third
	 *
	 *  @return end offset of the time range, 100 means blank
	 */
	public int getStartTimePreferenceEnd(int iDay, int iLevel)
	{
<span class="nc bnc" id="L179" title="All 2 branches missed.">		if (iDay &lt; 1) iDay = 1;</span>
<span class="nc bnc" id="L180" title="All 2 branches missed.">		if (iDay &gt; 7) iDay = 7;</span>

<span class="nc bnc" id="L182" title="All 2 branches missed.">		if (iLevel &lt; 0) iLevel = 0;</span>
<span class="nc bnc" id="L183" title="All 2 branches missed.">		if (iLevel &gt; 2) iLevel = 2;</span>

<span class="nc" id="L185">		return m_endOffset[(iDay - 1) + iLevel * 7];</span>
	}

	/**
	 *  set start offset for start time preference
	 *  @param iDay  1..7 means Sun, Mon, ... Sat.
	 *  @param iLevel 0, 1, 2 means first, second, third
	 *  @param iStart, iEnd : minutes offset to midnights
	 */
	public void setStartTimePreference(int iDay, int iLevel, int iStart, int iEnd)
	{
<span class="nc bnc" id="L196" title="All 2 branches missed.">		if (iDay &lt; 1) iDay = 1;</span>
<span class="nc bnc" id="L197" title="All 2 branches missed.">		if (iDay &gt; 7) iDay = 7;</span>

<span class="nc bnc" id="L199" title="All 2 branches missed.">		if (iLevel &lt; 0) iLevel = 0;</span>
<span class="nc bnc" id="L200" title="All 2 branches missed.">		if (iLevel &gt; 2) iLevel = 2;</span>

<span class="nc" id="L202">		m_startOffset[(iDay - 1) + iLevel * 7] = iStart;</span>
<span class="nc" id="L203">		m_endOffset[(iDay - 1) + iLevel * 7] = iEnd;</span>
<span class="nc" id="L204">	}</span>

	/**
	 *  get day off preference, return a collection of integers 1, 2, ... 7
	 *  representing week days in the descending order of the preference values
	 */
	public Collection getDayOffPreference()
	{
<span class="nc" id="L212">		Object arr[] = new Object[7];</span>

<span class="nc" id="L214">		int iBaseField = SimpleSchedulePreferenceFieldInfo.SIMPLESCHEDPREF_SUNPREF - 1;</span>
<span class="nc bnc" id="L215" title="All 2 branches missed.">		for (int i = 1; i &lt;=7; i++) {</span>
<span class="nc" id="L216">			int iField = iBaseField + i;</span>
<span class="nc" id="L217">			int iValue = this.getFieldValueShort(iField);</span>
<span class="nc bnc" id="L218" title="All 4 branches missed.">			if (iValue &lt; 1 || iValue &gt; 7) continue;</span>

<span class="nc" id="L220">			arr[iValue - 1] = NumberFactory.newInteger(i);</span>
		}

		// remove null entry column in arr
<span class="nc" id="L224">		ArrayList arrResult = new ArrayList(7);</span>
<span class="nc bnc" id="L225" title="All 2 branches missed.">		for (int i = 0; i &lt; 7; i++) {</span>
<span class="nc bnc" id="L226" title="All 2 branches missed.">			if (arr[i] != null)</span>
<span class="nc" id="L227">			   arrResult.add(arr[i]);</span>
		}

<span class="nc" id="L230">		return arrResult;</span>
	}

	/**
	 *  set day off preference, pass in a collection of integers 1, 2, ... 7
	 *  representing week days in the descending order of the preference values
	 */
	public void setDayOffPreference(Collection colPreferences)
	{
<span class="nc" id="L239">		int iBaseField = SimpleSchedulePreferenceFieldInfo.SIMPLESCHEDPREF_SUNPREF - 1;</span>
<span class="nc bnc" id="L240" title="All 2 branches missed.">		for (int i = 1; i &lt;=7; i++) {</span>
<span class="nc" id="L241">			int iField = iBaseField + i;</span>
<span class="nc" id="L242">			setFieldValue(iField, (short) 100);</span>
		}

<span class="nc bnc" id="L245" title="All 4 branches missed.">		if (colPreferences == null || colPreferences.isEmpty()) return;</span>

<span class="nc" id="L247">		Iterator it = colPreferences.iterator();</span>
<span class="nc" id="L248">		int iPref = 0;</span>
<span class="nc bnc" id="L249" title="All 2 branches missed.">		while (it.hasNext()) {</span>
<span class="nc" id="L250">			iPref++;</span>
<span class="nc" id="L251">			int iDay = ((Integer) it.next()).intValue();</span>
<span class="nc bnc" id="L252" title="All 2 branches missed.">			if (iDay &lt; 1) iDay = 1;</span>
<span class="nc bnc" id="L253" title="All 2 branches missed.">			if (iDay &gt; 7) iDay = 7;</span>
<span class="nc" id="L254">			setFieldValue(iBaseField + iDay, (short) iPref);</span>
<span class="nc" id="L255">		}</span>

<span class="nc" id="L257">	}</span>

	// extract preference data and put it in an array
	public void processPreferenceDataAfterLoad()
	{
<span class="nc" id="L262">		Collection col = getChildObjects(SimpleSchedulePreferenceFieldInfo.CHILD_STARTTIME_PREF);</span>
<span class="nc bnc" id="L263" title="All 4 branches missed.">		if (col == null || col.isEmpty()) return;</span>

<span class="nc" id="L265">		Iterator it = col.iterator();</span>
<span class="nc bnc" id="L266" title="All 2 branches missed.">		while (it.hasNext())</span>
		{
<span class="nc" id="L268">			SimpleStartTimePreference item = (SimpleStartTimePreference) it.next();</span>
<span class="nc" id="L269">			setStartTimePreference(item.getWeekDay(), item.getPreferenceLevel(),</span>
<span class="nc" id="L270">								   item.getStartOffset(), item.getEndOffset());</span>
<span class="nc" id="L271">		}</span>

<span class="nc" id="L273">		clearChildObjectMap(SimpleSchedulePreferenceFieldInfo.CHILD_STARTTIME_PREF);</span>
<span class="nc" id="L274">	}</span>

	// process preference data before update
	public void processPreferenceDataBeforeUpdate()
	{
<span class="nc" id="L279">		super.clearCreatedChildObjectMap(SimpleSchedulePreferenceFieldInfo.CHILD_STARTTIME_PREF);</span>
<span class="nc bnc" id="L280" title="All 2 branches missed.">		for (int i = 0; i &lt; PREFERENCE_INTERVAL_COUNT; i++)</span>
		{
<span class="nc bnc" id="L282" title="All 2 branches missed.">			if (m_startOffset[i] == -1) continue;</span>

<span class="nc" id="L284">			SimpleStartTimePreference item = new SimpleStartTimePreference();</span>
<span class="nc" id="L285">			item.setWeekDay((short) (i % 7 + 1));</span>
<span class="nc" id="L286">			item.setPreferenceLevel((short) (i / 7));</span>
<span class="nc" id="L287">			item.setStartOffset(m_startOffset[i]);</span>
<span class="nc" id="L288">			item.setEndOffset(m_endOffset[i]);</span>

<span class="nc" id="L290">			createChildObject(SimpleSchedulePreferenceFieldInfo.CHILD_STARTTIME_PREF, item);</span>
		}

		// SimpleStartTimePreference object will override the delete method
		// to delete all start time preference data before insert any.
<span class="nc bnc" id="L295" title="All 2 branches missed.">		if (getID() != null)</span>
<span class="nc" id="L296">		   deleteChildObject(SimpleSchedulePreferenceFieldInfo.CHILD_STARTTIME_PREF, getID());</span>
<span class="nc" id="L297">	}</span>

	// clone the assignment object without the ID field
	public TimePeriod cloneTimePeriod()
	{
<span class="nc" id="L302">		SimpleSchedulePreference item = new SimpleSchedulePreference();</span>

<span class="nc" id="L304">		item.setEmployeeID(getEmployeeID());</span>
<span class="nc" id="L305">		item.setStartTime(getStartTime());</span>
<span class="nc" id="L306">		item.setEndTime(getEndTime());</span>
<span class="nc" id="L307">		item.setPreferDayOff(this.getPreferDayOff());</span>
<span class="nc" id="L308">		item.setPreferredStart(this.getPreferredStart());</span>
<span class="nc" id="L309">		item.setPreferOvertime(this.getPerferOvertime());</span>

		// day off preference
<span class="nc" id="L312">		int iBaseField = SimpleSchedulePreferenceFieldInfo.SIMPLESCHEDPREF_SUNPREF - 1;</span>
<span class="nc bnc" id="L313" title="All 2 branches missed.">		for (int i = 1; i &lt;=7; i++) {</span>
<span class="nc" id="L314">			int iField = iBaseField + i;</span>
<span class="nc" id="L315">			item.setFieldValue(iField, getFieldValueShort(iField));</span>
		}

		// start, end time preference
<span class="nc" id="L319">		item.setStartOffset(getStartOffset());</span>
<span class="nc" id="L320">		item.setEndOffset(getEndOffset());</span>

<span class="nc" id="L322">		return item;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>