<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>WorkResourceWorkRuleDAO.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.ejb.bbm.empworkrule.ejb</a> &gt; <span class="el_source">WorkResourceWorkRuleDAO.java</span></div><h1>WorkResourceWorkRuleDAO.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.ejb.bbm.empworkrule.ejb;

/**
 * Title:        Blue Pumpkin Software Basic Business Model
 * Description:  dao object to serialize WorkResourceWorkRule object
 * Copyright:    Copyright (c) 2001
 * Company:      Blue Pumpkin Software, Inc
 * @author       lixin zhang
 * @version      1.0
 */

import java.util.Collection;
import java.util.Collections;
import java.util.HashMap;
import java.util.Iterator;
import java.util.Map;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.jdmo.Jdmo;
import com.bluepumpkin.common.jdmo.JdmoException;
import com.bluepumpkin.ejb.bbm.base.BbmCreateException;
import com.bluepumpkin.ejb.bbm.base.BbmFinderException;
import com.bluepumpkin.ejb.bbm.base.BbmRemoveException;
import com.bluepumpkin.ejb.bbm.dao.DAOEffectivity;
import com.bluepumpkin.ejb.bbm.empworkrule.model.WorkResourceWorkRule;
import com.bluepumpkin.ejb.bbm.empworkrule.model.WorkResourceWorkRuleFieldInfo;
import com.bluepumpkin.ejb.bbm.vo.FieldInfo;
import com.bluepumpkin.ejb.bbm.vo.ValueObjectBase;
import com.bluepumpkin.ejb.bbm.vo.ValueObjectUtil;

public class WorkResourceWorkRuleDAO extends DAOEffectivity {

<span class="nc" id="L33">    private static FieldInfo m_fieldInfo = new WorkResourceWorkRuleFieldInfo();</span>
<span class="nc" id="L34">    protected FieldInfo getFieldInfo() { return m_fieldInfo; }</span>

    public WorkResourceWorkRuleDAO() {
<span class="nc" id="L37">         super();</span>
<span class="nc" id="L38">    }</span>

    public WorkResourceWorkRuleDAO(Jdmo dmo) {
<span class="nc" id="L41">         super(dmo);</span>
<span class="nc" id="L42">    }</span>

    protected ValueObjectBase createValueObject()
    {
<span class="nc" id="L46">        return (new WorkResourceWorkRule());</span>
    } 
    
   /**
     *   get a given work resource's work rule assignments
     *   
     *   @param idWorkResource work resource id
     *   @param dtStart, @dtEnd: the time period, null date means a open period
     *   
     *   @return a collection of work rule ids that assigned to the work resource
     */
    public Collection getWorkRuleAssignments(ID idWorkResource) throws BbmFinderException
    {
<span class="nc bnc" id="L59" title="All 2 branches missed.">        if (idWorkResource == null) return Collections.EMPTY_LIST;</span>
        
<span class="nc" id="L61">        String strFieldName = getFieldInfo().getFieldName(WorkResourceWorkRuleFieldInfo.WRKRESWORKRULE_WORKRESOURCEID);</span>
<span class="nc" id="L62">        StringBuffer strWhere = new StringBuffer(30);</span>
<span class="nc" id="L63">        strWhere.append(&quot;A.&quot;).append(strFieldName).append(&quot;=&quot;).append(idWorkResource);</span>
        
<span class="nc" id="L65">        Collection col = getObjects(strWhere.toString());</span>
        
<span class="nc" id="L67">        return ValueObjectUtil.collect(WorkResourceWorkRuleFieldInfo.WRKRESWORKRULE_WORKRULEID, col);</span>
    }    
        
    /**
     *   get work rule assignments for a collection of work resource ids
     *   
     *   @param colWorkResourceIDs  a collection of work resource ids
     *   
     *   @return a HashMap of following pairs 
     *            (idWorkResource, collection of work rule ids)
     */
    public HashMap getWorkRuleAssignments(Collection colWorkResourceIDs) throws BbmFinderException
    {
<span class="nc bnc" id="L80" title="All 4 branches missed.">        if (colWorkResourceIDs == null || colWorkResourceIDs.size() &lt; 1) return new HashMap();</span>
        
        try
        {
<span class="nc" id="L84">            StringBuffer strWhere = new StringBuffer(30);</span>
<span class="nc" id="L85">            int iField = WorkResourceWorkRuleFieldInfo.WRKRESWORKRULE_WORKRESOURCEID;</span>
<span class="nc" id="L86">            strWhere.append(&quot;A.&quot;).append(getFieldInfo().getFieldName(iField));</span>
<span class="nc" id="L87">            strWhere.append(&quot; in &quot;).append(m_dmo.createInClause(colWorkResourceIDs));</span>
<span class="nc" id="L88">            strWhere.append(&quot; ORDER BY A.&quot;).append(getFieldInfo().getFieldName(iField));</span>
            
<span class="nc" id="L90">            Collection items = getObjects(strWhere.toString()); </span>
<span class="nc bnc" id="L91" title="All 4 branches missed.">            if (items == null || items.size() &lt; 1) return new HashMap();</span>
            
<span class="nc" id="L93">            HashMap map = ValueObjectUtil.groupByField(iField, items);  </span>
<span class="nc bnc" id="L94" title="All 2 branches missed.">            if (map.isEmpty()) return map;</span>
                        
<span class="nc" id="L96">            HashMap mapResult = new HashMap();</span>
<span class="nc" id="L97">            int iWorkRuleField = WorkResourceWorkRuleFieldInfo.WRKRESWORKRULE_WORKRULEID;</span>
<span class="nc" id="L98">            Iterator it = map.entrySet().iterator();</span>
<span class="nc bnc" id="L99" title="All 2 branches missed.">            while (it.hasNext())</span>
            {
<span class="nc" id="L101">                Map.Entry entry = (Map.Entry) it.next();</span>
<span class="nc" id="L102">                mapResult.put(entry.getKey(), </span>
<span class="nc" id="L103">                  ValueObjectUtil.collect(iWorkRuleField, (Collection) entry.getValue()));</span>
<span class="nc" id="L104">            }</span>
<span class="nc" id="L105">            return mapResult;</span>
        }
<span class="nc" id="L107">        catch(JdmoException e)</span>
        {
<span class="nc" id="L109">            throw new BbmFinderException(e);</span>
        }  
    }    
    
    /** create work rule assignments */
    public void createWorkRuleAssignments(ID idWorkResource, Collection colWorkRuleIDs) throws BbmCreateException
    {
        try
        {
<span class="nc bnc" id="L118" title="All 6 branches missed.">            if (colWorkRuleIDs == null || colWorkRuleIDs.isEmpty() || idWorkResource == null) return;            </span>
<span class="nc" id="L119">            deleteWorkRuleAssignments(idWorkResource, colWorkRuleIDs);</span>
            
            
<span class="nc" id="L122">            Iterator it = colWorkRuleIDs.iterator();</span>
<span class="nc bnc" id="L123" title="All 2 branches missed.">            while (it.hasNext())</span>
            {
<span class="nc" id="L125">                WorkResourceWorkRule item = new WorkResourceWorkRule();</span>
<span class="nc" id="L126">                item.setWorkResourceID(idWorkResource);</span>
<span class="nc" id="L127">                item.setWorkRuleID((ID) it.next());</span>
<span class="nc" id="L128">                createObject(item);</span>
<span class="nc" id="L129">            }</span>
        }
<span class="nc" id="L131">        catch(BbmRemoveException e) {</span>
<span class="nc" id="L132">            throw new BbmCreateException(e);</span>
<span class="nc" id="L133">        }</span>
<span class="nc" id="L134">    }    </span>
   
    /** delete work rules assignments */
    public void deleteWorkRuleAssignments(ID idWorkResource, Collection colWorkRuleIDs) throws BbmRemoveException
    {
         try
         {
<span class="nc" id="L141">             StringBuffer strSQL = new StringBuffer(30);</span>
<span class="nc" id="L142">             strSQL.append(&quot; delete &quot;).append(getFieldInfo().getTableName());</span>
<span class="nc" id="L143">             strSQL.append(&quot; where WORKRESOURCEID = &quot;).append(idWorkResource);</span>
<span class="nc" id="L144">             strSQL.append(&quot; and WORKRULEID in &quot;).append(m_dmo.createInClause(colWorkRuleIDs));</span>
         
<span class="nc" id="L146">             m_dmo.executeCommand(strSQL.toString());</span>
         }
<span class="nc" id="L148">         catch(Exception e) {</span>
<span class="nc" id="L149">            throw new BbmRemoveException(e);</span>
<span class="nc" id="L150">         }</span>
<span class="nc" id="L151">    }	    </span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>