<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>RequestFormPopupPM.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.rm.requests</a> &gt; <span class="el_source">RequestFormPopupPM.java</span></div><h1>RequestFormPopupPM.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.rm.requests;

import java.util.*;

import com.bluepumpkin.common.datatypes.*;
import com.bluepumpkin.common.util.*;
import com.bluepumpkin.common.l10n.RegionalFormatBundleKey;
import com.witness.web.uif.util.HtmlUtil;
import com.witness.web.uif.l10n.UIFWebBundleKey;
import com.witness.web.uif.pagemodel.*;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.pagecomponent.*;
import com.witness.web.uif.pagecomponent.list.MultiColListPC;
import com.witness.web.uif.pagecomponent.table.TableHeaderPC;
import com.witness.web.uif.pagecomponent.toolbar.*;

import com.bluepumpkin.ejb.bbm.workresource.model.EmployeeName;
import com.bluepumpkin.ejb.rm.requests.common.model.RequestAggregate;
import com.bluepumpkin.ejb.rm.requests.common.model.RequestAggregateDummy;
import com.bluepumpkin.ejb.rm.requests.common.model.Request;
import com.bluepumpkin.ejb.rm.requests.common.validation.ValidationResult;
import com.bluepumpkin.web.rm.keys.*;
import com.bluepumpkin.web.rm.l10n.RmWebBundleKey;
import com.witness.web.uif.pagecomponent.container.MultiColCollapsibleContainerPC;

/**
 * Title:		     RequestFormPopupPM
 * Description:  Base class for Request relate popup Forms
 * Copyright:    Copyright (c) 2001
 * Company:      Blue Pumpkin Software, inc
 * @author       David Su
 * @version      1.0
 */
public abstract class RequestFormPopupPM extends PopupWindowPM {
	protected static final String INDENT_STYLE = &quot;padding-left:20px;&quot;;
	protected static final String REQUEST_ID_FN   = &quot;requestID&quot;;
	protected static final String COMMENT_FN      = &quot;comment&quot;;
	protected static final String REQUEST_VERSION_FN = &quot;requestVersion&quot;;
	protected static final String REQUEST_TYPE_FN = &quot;requestType&quot;;
	protected static final String ORG_REQUEST_ID_FN = &quot;orgRequestID&quot;;

<span class="fc" id="L42">	protected String m_pageMode = RmKeys.RP_MODE_AGENT;</span>
	protected ID m_empID;
	protected String m_formAction;
	protected String m_comment;
	protected String m_requestType;
	protected ResourceBundle m_bundle;
	protected RequestAggregate m_request;
	protected TimeZone m_view_tz;
<span class="fc" id="L50">	protected boolean m_isShowDoneInsteadOfCancelBtn = false;</span>
	protected ID m_orgRequestID;
	
	//for validation alerts (optional in request forms, but should usually be in details forms).
	protected MultiColCollapsibleContainerPC m_alertListPC;
<span class="fc" id="L55">	protected Collection m_valResults = Collections.EMPTY_LIST;</span>
	
	/**
	 * Constructor
	 */
	public RequestFormPopupPM(RequestContext context, String formAction) {
<span class="fc" id="L61">		super(context);</span>
<span class="fc" id="L62">		m_bundle = m_localizer.getBundle(RmWebBundleKey.BUNDLE_NAME);</span>
<span class="fc" id="L63">		m_view_tz = m_context.getViewingTimeZone();</span>
<span class="fc" id="L64">		m_formAction = formAction;</span>

<span class="fc" id="L66">		m_empID = RequestUtil.getEmpIDAndAddMsgIfNotAvailable(m_context, this);</span>

<span class="fc" id="L68">		m_request = new RequestAggregateDummy();</span>
<span class="fc" id="L69">	}</span>

	/**
	 * Return Employee Name
	 */
	protected String getEmployeeName(ID empID, Map eNameMap) {
<span class="nc bnc" id="L75" title="All 4 branches missed.">		if (eNameMap==null || eNameMap.isEmpty()) return &quot;&quot;;</span>
<span class="nc" id="L76">		EmployeeName eName = (EmployeeName)eNameMap.get(empID);</span>
<span class="nc bnc" id="L77" title="All 2 branches missed.">		return (eName!=null)?m_localizer.formatName(eName):empID.toString();</span>
	}

	/**
	 * Add Row Data to List Model
	 */
	protected void addDataRow(String content, List listModel) {
<span class="nc" id="L84">		DefaultMultiColumnNodeData node = new DefaultMultiColumnNodeData();		</span>
<span class="nc" id="L85">		node.add(content + &quot;&lt;br&gt;&lt;br&gt;&quot;, INDENT_STYLE);</span>
<span class="nc" id="L86">		listModel.add(node);		</span>
<span class="nc" id="L87">	}</span>

	/**
	 * Create View Option
	 */
	protected StringsPair createViewOption(String value, String rbKey) {
<span class="nc" id="L93">		return new StringsPair(value, i18n(m_bundle, rbKey));</span>
	}

	/**
	 * Format Date
	 */
	protected String formatDate(Date date) {
<span class="nc" id="L100">		return m_localizer.formatDate(date, m_view_tz, RegionalFormatBundleKey.DATE_FORMAT);</span>
	}

	/**
	 * Format Date Time
	 */
	protected String formatDateTime(Date date) {
<span class="nc" id="L107">		return m_localizer.formatDateTime(date, m_view_tz);</span>
	}

	/**
	 * Return URL for HTML Form Action
	 */
	public String getFormAction() {
<span class="fc" id="L114">		return m_formAction;</span>
	}

<span class="nc" id="L117">	protected boolean isSaveButtonEnabled() { return true; }</span>

	/**
	 * Prepare toolbar for rendering
	 */
	protected void initToolbar(){
<span class="fc" id="L123">		ToolbarUtil.addValidateSaveBtn(m_toolbar, isSaveButtonEnabled());</span>
<span class="fc bfc" id="L124" title="All 2 branches covered.">		if (m_isShowDoneInsteadOfCancelBtn) {</span>
<span class="fc" id="L125">			ToolbarUtil.addCloseWindowDoneBtn(m_toolbar, true);</span>
		} else {
<span class="fc" id="L127">			ToolbarUtil.addCloseWindowCancelBtn(m_toolbar, true);</span>
		}
<span class="fc" id="L129">		ToolbarUtil.addResetBtn(m_toolbar, true);</span>
<span class="fc" id="L130">	}</span>

	/**
	 * Initialize Toolbar
	 */
	protected void initToolbar(boolean isNormal) {
<span class="pc bpc" id="L136" title="1 of 2 branches missed.">		if (isNormal) {</span>
<span class="fc" id="L137">			initToolbar();</span>
		} else {
<span class="nc" id="L139">			super.initToolbar();</span>
		}
<span class="fc" id="L141">	}</span>

	/**
	 * Specify the ID of the request that was just saved.
	 * It specify to the popup to show the 'Done' button instead of Cancel
	 * and refresh Opener on Close.
	 *
	 * @param requestID
	 */
	public void setSavedRequestID(ID requestID) {
<span class="fc" id="L151">		setRequestID(requestID);</span>
<span class="fc" id="L152">		setIsRefreshOpenerOnClose(true);</span>
<span class="fc" id="L153">		m_isShowDoneInsteadOfCancelBtn = true;</span>
<span class="fc" id="L154">	}</span>

	/**
	 * Set Request ID
	 */
	public void setRequestID(ID id) {
<span class="fc" id="L160">        m_orgRequestID = id;</span>
<span class="pc bpc" id="L161" title="1 of 2 branches missed.">		if (m_request!=null) m_request.setID(id);</span>
<span class="fc" id="L162">	}</span>

	/**
	 * Return Request ID
	 */
	public ID getRequestID() {
<span class="pc bpc" id="L168" title="1 of 2 branches missed.">		return (m_request!=null)?m_request.getID():null;</span>
	}

	/**
	 * Set Request ID
	 */
	public void setOrgRequestID(ID id) {
<span class="fc" id="L175">        m_orgRequestID = id;</span>
<span class="fc" id="L176">	}</span>

	/**
	 * Return Request ID
	 */
	public ID getOrgRequestID() {
<span class="fc" id="L182">		return m_orgRequestID;</span>
	}

	/**
	 * Set Request Value Object Version
	 */
	public void setRequestVersion(String version) {
<span class="pc bpc" id="L189" title="1 of 2 branches missed.">		if (m_request!=null) m_request.setObjectVersionNumber(version);</span>
<span class="fc" id="L190">	}</span>

	/**
	 * Return Request Value Object Version 
	 */
	public String getRequestVersion() {
<span class="pc bpc" id="L196" title="1 of 2 branches missed.">		return (m_request!=null)?m_request.getObjectVersionNumber():&quot;&quot;;</span>
	}

	/**
	 * Specify the REquest Type
	 */
	public void setRequestType(String type) {
<span class="fc" id="L203">		m_requestType = type;</span>
<span class="fc" id="L204">	}</span>

	/**
	 * Return Request Type
	 */
	public String getRequestType() {
<span class="pc bpc" id="L210" title="1 of 2 branches missed.">		if (m_request!=null) {</span>
<span class="fc" id="L211">			String rType = m_request.getRequestType();</span>
<span class="pc bpc" id="L212" title="1 of 4 branches missed.">			if (!StringUtil.isEmpty(rType) &amp;&amp; !Request.REQUESTTYPE_ALL.equals(rType)) {</span>
<span class="fc" id="L213">				m_requestType = rType;</span>
			}
		}

<span class="fc" id="L217">		return m_requestType;</span>
	}

	/**
	 * Set Comment
	 */
	public void setComment(String comment) {
<span class="fc" id="L224">		m_comment = comment;</span>
<span class="fc" id="L225">	}</span>

	/**
	 * Return Comment
	 */
	public String getComment() {
<span class="fc" id="L231">		return m_comment;</span>
	}

	/**
	 * Return True if Request is New
	 */
	public boolean isNew() {
<span class="fc bfc" id="L238" title="All 2 branches covered.">		return m_orgRequestID == null;</span>
	}

	/**
	 * return true if it is in manager mode
	 */
	public boolean isManagerMode() {
<span class="fc" id="L245">		return RmKeys.RP_MODE_MGR.equals(m_pageMode);</span>
	}

	/**
	 * Set Page Mode whether to render page for Agent or Manager
	 */
	public void setPageMode(String mode) {
<span class="fc" id="L252">		m_pageMode = mode;</span>
<span class="fc" id="L253">	}</span>

	/**
	 * Return Page Mode whether to render page for Agent or Manager
	 */
	public String getPageMode() {
<span class="nc" id="L259">		return m_pageMode;</span>
	}



	/**
	 * Return Required HTML
	 */
	public String getRequiredHTML() {			
<span class="fc" id="L268">		return super.getRequiredHTML() + getRequestRequiredHTML();</span>
	}

	/**
	 * Return Required HTML for Request Popups
	 */
	protected String getRequestRequiredHTML() {
<span class="fc" id="L275">		String rID = &quot;&quot;;</span>
<span class="pc bpc" id="L276" title="1 of 4 branches missed.">		if (!isNew() &amp;&amp; m_request != null)</span>
<span class="fc" id="L277">			rID = getRequestID().toString();</span>

<span class="fc" id="L279">		return HtmlUtil.makeHiddenInput(REQUEST_ID_FN, rID) +</span>
<span class="fc" id="L280">				HtmlUtil.makeHiddenInput(REQUEST_VERSION_FN, getRequestVersion()) +</span>
<span class="fc" id="L281">				HtmlUtil.makeHiddenInput(REQUEST_TYPE_FN, getRequestType()) +</span>
<span class="fc" id="L282">				HtmlUtil.makeHiddenInput(ORG_REQUEST_ID_FN, getOrgRequestID()) +</span>
<span class="fc" id="L283">				HtmlUtil.makeHiddenInput(RmKeys.PAGE_MODE_FN, m_pageMode);</span>
	}
	
	/**
	 * Initialize Alert List
	 */
	protected void initAlertList() {
<span class="nc" id="L290">		m_alertListPC = createAlertsList();</span>
<span class="nc" id="L291">		m_alertListPC.getMultiColListPC().setHeightInPixels(150);</span>

<span class="nc" id="L293">		TableHeaderPC header = m_alertListPC.getMultiColListPC().getHeader();</span>
<span class="nc" id="L294">		header.addColumnHeaderData(&quot;&quot;, i18n(m_common_bundle, UIFWebBundleKey.ALERTS));</span>
<span class="nc" id="L295">		header.addColumnHeaderData(&quot;&quot;, i18n(m_common_bundle, UIFWebBundleKey.DESCRIPTION));</span>
<span class="nc" id="L296">		m_alertListPC.setIsBorderEnabled(true);</span>
<span class="nc" id="L297">		m_alertListPC.setEnabled(true);</span>

<span class="nc bnc" id="L299" title="All 2 branches missed.">		if (!m_valResults.isEmpty()) {</span>
<span class="nc" id="L300">			ArrayList listModel = new ArrayList(m_valResults.size());</span>
<span class="nc bnc" id="L301" title="All 2 branches missed.">			for(Iterator it=m_valResults.iterator(); it.hasNext(); ) {</span>
<span class="nc" id="L302">				ValidationResult vr = (ValidationResult)it.next();</span>
<span class="nc" id="L303">				DefaultMultiColumnNodeData node = new DefaultMultiColumnNodeData();</span>
<span class="nc" id="L304">				node.add( RequestUtil.createAlertIcon(vr, m_localizer) );</span>
<span class="nc" id="L305">				node.add( vr.getLocalizedMessage(m_localizer, m_view_tz) );</span>
<span class="nc" id="L306">				listModel.add(node);</span>
<span class="nc" id="L307">			}</span>
<span class="nc" id="L308">			m_alertListPC.getMultiColListPC().setListModel(listModel);</span>
		}
<span class="nc" id="L310">	}	</span>
	
	/** 
	 * Create New List PC. To be overridden in interested implementations.
	 */
	protected MultiColListPC createNewList() {
<span class="nc" id="L316">		return null;</span>
	}
	
	/**
	 * Create the collapsible Alert List PC. Overrides parent class.
	 */
	protected MultiColCollapsibleContainerPC createAlertsList() {
<span class="nc" id="L323">		MultiColCollapsibleContainerPC listPC = new MultiColCollapsibleContainerPC(m_context);</span>
<span class="nc" id="L324">		listPC.setTitle(i18n(m_common_bundle, UIFWebBundleKey.ALERTS));</span>
<span class="nc" id="L325">		listPC.setEnabled(true);</span>
<span class="nc" id="L326">		listPC.setIsBorderEnabled(true);</span>
<span class="nc" id="L327">		listPC.getMultiColListPC().setTableAttribute(&quot;summary&quot;, i18n(m_bundle, RmWebBundleKey.ALERTS_TABLE));</span>
<span class="nc" id="L328">		return listPC;</span>
	}
	
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>