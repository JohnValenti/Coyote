<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>QuestionPC.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.verint.web.fs.workrules.assignmentrules.ui</a> &gt; <span class="el_source">QuestionPC.java</span></div><h1>QuestionPC.java</h1><pre class="source lang-java linenums">package com.verint.web.fs.workrules.assignmentrules.ui;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import javax.servlet.http.HttpServletRequest;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.ejb.bbm.base.BbmException;
import com.verint.web.fs.widgets.RadioSelectionGroupPC;
import com.verint.web.fs.workrules.AssignmentRulesRH;
import com.verint.web.fs.workrules.assignmentrules.Response;
import com.verint.web.fs.workrules.assignmentrules.ResponseParam;
import com.verint.web.fs.workrules.assignmentrules.question.Question;
import com.witness.web.uif.pagecomponent.CompositePC;
import com.witness.web.uif.pagecomponent.PageComponent;
import com.witness.web.uif.system.RequestContext;

@SuppressWarnings(&quot;serial&quot;)
public class QuestionPC extends CompositePC {

	private RadioSelectionGroupPC&lt;Response&gt; pc_radioSelection;
<span class="fc" id="L25">	private Map&lt;ResponseParam, PageComponent&gt; paramPCs = new HashMap&lt;ResponseParam, PageComponent&gt;();</span>
	private Question data_question;
<span class="fc" id="L27">	private Response data_newAnswer = null;</span>
	private ID data_orgID;
	private boolean m_ignoreInitialAnswer;

	/**
	 * 
	 * @param context
	 * @param orgID
	 * @param name
	 * @param question
	 * @param ignoreInitialAnswer true if this PC should not preselect the initial answer. When editing an existing assignment rule, this should be false until the user changes any answer. At that point, the value should be true because we ant to force the user to pick new values for the questions.
	 * @throws BbmException
	 */
	public QuestionPC(RequestContext context, ID orgID, String name, Question question, boolean ignoreInitialAnswer) throws BbmException {
<span class="fc" id="L41">		super(context);</span>
<span class="fc" id="L42">		setName(name);</span>
<span class="fc" id="L43">		this.data_question = question;</span>
<span class="fc" id="L44">		this.data_orgID = orgID;</span>
<span class="fc" id="L45">		this.m_ignoreInitialAnswer = ignoreInitialAnswer;</span>

		// Create main radio selection component
<span class="fc" id="L48">		pc_radioSelection = new RadioSelectionGroupPC&lt;Response&gt;(context, name + &quot;__rsg&quot;);</span>
<span class="fc" id="L49">		this.addChildComponent(pc_radioSelection);</span>

		// Create any response parameter components
<span class="fc" id="L52">		List&lt;? extends Response&gt; responses = question.getResponses();</span>
<span class="fc bfc" id="L53" title="All 2 branches covered.">		for (Response response : responses) {</span>
<span class="fc bfc" id="L54" title="All 2 branches covered.">			for (ResponseParam param : response.getResponseParameters()) {</span>
<span class="fc" id="L55">				PageComponent pc = ARParamPCUtil.getPageComponent(context, orgID, question, response, param);</span>
<span class="fc" id="L56">				paramPCs.put(param, pc);</span>
<span class="fc" id="L57">				this.addChildComponent(pc);</span>
<span class="fc" id="L58">			}</span>
<span class="fc" id="L59">		}</span>

//		extractParameters(context.getRequest());
//		initForDisplay();
<span class="fc" id="L63">	}</span>

<span class="fc" id="L65">	private boolean initted = false;</span>

	@Override
	public void initForDisplay() {
<span class="fc bfc" id="L69" title="All 2 branches covered.">		if (initted)</span>
<span class="fc" id="L70">			return;</span>
<span class="fc" id="L71">		initted = true;</span>

<span class="fc" id="L73">		super.initForDisplay();</span>

<span class="fc" id="L75">		QuestionI18N i18n = QuestionI18NFactory.getI18NInfo(data_question.getQuestionType());</span>

<span class="fc" id="L77">		Response answerToSelect = getAnswer(); </span>
<span class="fc bfc" id="L78" title="All 2 branches covered.">		for (Response response : data_question.getResponses()) {</span>
			// Get HTML for all response parameters
<span class="fc" id="L80">			List&lt;String&gt; paramHTMLList = new ArrayList&lt;String&gt;();</span>
<span class="fc bfc" id="L81" title="All 2 branches covered.">			for (ResponseParam param : response.getResponseParameters()) {</span>
<span class="fc" id="L82">				PageComponent pc = paramPCs.get(param);</span>
<span class="fc" id="L83">				paramHTMLList.add(pc.getHtmlDisplay());</span>
<span class="fc" id="L84">			}</span>
			// Create radio selector option for response
<span class="fc" id="L86">			String onChangeJS = pc_radioSelection.getName() + &quot;.refreshPageWithAction('&quot;</span>
				+ AssignmentRulesRH.PAGE_ACTION_SUBMIT_STEP + &quot;', true);&quot;;
			
			// Don't add inputs inside the label, standards mode clicking the label selects the radio
			// and all the consequences that come with it.  It is a little messy here for 508 because
			// the label would be read for the radio option but we have to make it functional.
<span class="fc" id="L92">			pc_radioSelection.addRadioOption(</span>
<span class="fc" id="L93">					response.getIDStr(),</span>
<span class="fc bfc" id="L94" title="All 2 branches covered.">					(paramHTMLList.size() == 0 ? i18n.getResponseText(m_localizer, response, paramHTMLList.toArray()) : &quot;&quot;),</span>
<span class="fc bfc" id="L95" title="All 2 branches covered.">					(paramHTMLList.size() == 0 ? &quot;&quot; : i18n.getResponseText(m_localizer, response, paramHTMLList.toArray())),</span>
					response,
<span class="fc" id="L97">					response.equals(answerToSelect),</span>
					onChangeJS);
<span class="fc" id="L99">		}</span>
<span class="fc" id="L100">	}</span>

	@Override
	public boolean extractParameters(HttpServletRequest request) {
<span class="fc" id="L104">		boolean retVal = super.extractParameters(request);</span>

		// Get new Answer
<span class="fc" id="L107">		String responseTypeStr = pc_radioSelection.getSelectedID();</span>
<span class="fc bfc" id="L108" title="All 2 branches covered.">		for (Response response : data_question.getResponses()) {</span>
<span class="fc bfc" id="L109" title="All 2 branches covered.">			if (response.getIDStr().equals(responseTypeStr)) {</span>
<span class="fc" id="L110">				data_newAnswer = response;</span>
<span class="fc" id="L111">				break;</span>
			}
<span class="fc" id="L113">		}</span>
		
		// Auto-select the option if it is the only one.
<span class="fc bfc" id="L116" title="All 2 branches covered.">		if (data_question.getResponses().size() == 1) {</span>
<span class="fc" id="L117">			data_newAnswer = data_question.getResponses().iterator().next();</span>
		}

		try {
			// Update any Response Parameter values
<span class="fc bfc" id="L122" title="All 2 branches covered.">			for (Response response : data_question.getResponses()) {</span>
<span class="fc bfc" id="L123" title="All 2 branches covered.">				for (ResponseParam param : response.getResponseParameters()) {</span>
<span class="fc" id="L124">					Object val = ARParamPCUtil.getParameterValue(m_context, data_orgID, data_question, response, param);</span>
<span class="fc bfc" id="L125" title="All 2 branches covered.">					if (val != null)</span>
<span class="fc" id="L126">						param.setValue(val);</span>
<span class="fc" id="L127">				}</span>
<span class="fc" id="L128">			}</span>
<span class="nc" id="L129">		} catch (BbmException e) {</span>
<span class="nc" id="L130">			retVal = false;</span>
<span class="nc" id="L131">			log.error(&quot;&quot;, e);</span>
<span class="fc" id="L132">		}</span>
<span class="fc" id="L133">		return retVal;</span>
	}

	public Response getAnswer() {
<span class="fc bfc" id="L137" title="All 2 branches covered.">		Response initialAnswer = m_ignoreInitialAnswer ? null : data_question.getInitialAnswer();</span>
<span class="fc bfc" id="L138" title="All 2 branches covered.">		return data_newAnswer != null ? data_newAnswer : initialAnswer;</span>
	}

	@Override
	public String getHtmlDisplay() {
<span class="fc" id="L143">		initForDisplay();</span>
<span class="fc" id="L144">		return pc_radioSelection.getHtmlDisplay();</span>
	}

	public String getText() {
<span class="fc" id="L148">		QuestionI18N i18n = QuestionI18NFactory.getI18NInfo(data_question.getQuestionType());</span>
<span class="fc" id="L149">		return i18n.getQuestionText(m_localizer, data_question);</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>