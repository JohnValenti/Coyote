<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>WorkPatternMasterDetailListPC.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.verint.web.fs.workrules</a> &gt; <span class="el_source">WorkPatternMasterDetailListPC.java</span></div><h1>WorkPatternMasterDetailListPC.java</h1><pre class="source lang-java linenums">package com.verint.web.fs.workrules;

import java.util.ArrayList;
import java.util.Collection;
import java.util.Comparator;
import java.util.Date;
import java.util.LinkedHashMap;
import java.util.Map;
import java.util.TimeZone;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.localization.Localizer;
import com.bluepumpkin.ejb.bbm.activity.model.Activity;
import com.bluepumpkin.ejb.bbm.campaign.model.Campaign;
import com.bluepumpkin.ejb.bbm.vo.DBSortField;
import com.bluepumpkin.ejb.bbm.workresource.model.EmployeeType;
import com.bluepumpkin.ejb.bbm.workresource.model.Organization;
import com.bluepumpkin.ejb.bbm.workrules.model.ShiftPattern;
import com.bluepumpkin.ejb.bbm.workrules.model.ShiftPatternSortField;
import com.bluepumpkin.web.fs.l10n.FsWebBundleKey;
import com.verint.web.fs.widgets.MasterDetailRow;
import com.verint.web.fs.widgets.MultiColMasterDetailListPC;
import com.verint.web.fs.widgets.ToggleVisiblePC;
import com.witness.web.uif.jsp.HtmlTableRow;
import com.witness.web.uif.l10n.UIFWebBundleKey;
import com.witness.web.uif.pagecomponent.DefaultMultiColumnNodeData;
import com.witness.web.uif.pagecomponent.MultiColumnNodeData;
import com.witness.web.uif.pagecomponent.table.TableHeaderPC;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.util.js.JSUtil;

public class WorkPatternMasterDetailListPC extends MultiColMasterDetailListPC {
	private static final long serialVersionUID = 1L;
	public static final String WORKPATTERN_LIST_SORTCOLUMN = &quot;WORKPATTERN_LIST_SORTCOLUMN&quot;;
	public static final String WORKPATTERN_LIST_SORTORDER = &quot;WORKPATTERN_LIST_SORTORDER&quot;;
	public static final String WORKPATTERN_LISTPOPUP_SORTCOLUMN = &quot;WORKPATTERN_LISTPOPUP_SORTCOLUMN&quot;;
	public static final String WORKPATTERN_LISTPOPUP_SORTORDER = &quot;WORKPATTERN_LISTPOPUP_SORTORDER&quot;;
	public static final String WORKPATTERN_SELECTIONPOPUP_SORTCOLUMN = &quot;WORKPATTERN_SELECTIONPOPUP_SORTCOLUMN&quot;;
	public static final String WORKPATTERN_SELECTIONPOPUP_SORTORDER = &quot;WORKPATTERN_SELECTIONPOPUP_SORTORDER&quot;;
	public static final int USED_IN_LIST = 0;
	public static final int USED_IN_LISTPOPUP = 1;
	public static final int USED_IN_SELECTIONPOPUP = 2;
	//m_usedType=0: This component will be used in WorkPatternListPM
	//m_usedType=1: This component will be used in WorkPatternListPopupPM
	//m_usedType=2: This component will be used in WorkPatternSelectionPopupPM
	private int m_usedType; 
	
	ToggleVisiblePC toggleAll;
	private boolean isByOrg;
	private TimeZone optimizationTargetTimeZone;
	private Date timeZoneEffectiveDate;
	
<span class="fc" id="L53">	private Map&lt;ID, Organization&gt; orgMap = null;</span>
<span class="fc" id="L54">	private Map&lt;ID, Campaign&gt; campaignMap = null;</span>
<span class="fc" id="L55">	private Map&lt;ID, Activity&gt; activityMap = null;</span>
<span class="fc" id="L56">	private Map&lt;ID, EmployeeType&gt; empTypeMap = null;</span>
	
	
	public WorkPatternMasterDetailListPC(RequestContext context, int usedType) {
<span class="fc" id="L60">		super(context);</span>
<span class="fc" id="L61">		toggleAll = new ToggleVisiblePC(m_context, &quot;toggleAll&quot;);</span>
<span class="fc" id="L62">		this.addChildComponent(toggleAll);</span>
<span class="fc" id="L63">		m_usedType = usedType; //Must be assign before initHeader</span>
<span class="fc" id="L64">		initHeader();</span>
<span class="fc" id="L65">	}</span>
	public WorkPatternMasterDetailListPC(RequestContext context, Collection&lt;ShiftPattern&gt; shiftPatterns, 
			TimeZone optimizationTargetTimeZone, Date timeZoneEffectiveDate, boolean isByOrg, Map&lt;ID, Organization&gt; orgMap,
			Map&lt;ID, Campaign&gt; campaignMap, Map&lt;ID, Activity&gt; activityMap, Map&lt;ID, EmployeeType&gt; empTypeMap, int usedType) {
<span class="fc" id="L69">		this(context,usedType);</span>
<span class="fc" id="L70">		setFirstColumnWidth(&quot;2.5%&quot;);</span>
<span class="fc" id="L71">		setData(shiftPatterns, optimizationTargetTimeZone, timeZoneEffectiveDate, isByOrg, orgMap, campaignMap, activityMap, empTypeMap);</span>
<span class="fc" id="L72">	}</span>
	
	public void setData(Collection&lt;ShiftPattern&gt; shiftPatterns, 
			TimeZone optimizationTargetTimeZone, Date timeZoneEffectiveDate, boolean isByOrg, Map&lt;ID, Organization&gt; orgMap,
			Map&lt;ID, Campaign&gt; campaignMap, Map&lt;ID, Activity&gt; activityMap, Map&lt;ID, EmployeeType&gt; empTypeMap) {
<span class="fc" id="L77">		this.isByOrg = isByOrg;</span>
<span class="fc" id="L78">		this.orgMap = orgMap;</span>
<span class="fc" id="L79">		this.campaignMap = campaignMap;</span>
<span class="fc" id="L80">		this.activityMap = activityMap;</span>
<span class="fc" id="L81">		this.empTypeMap = empTypeMap;</span>
<span class="fc" id="L82">		this.optimizationTargetTimeZone = optimizationTargetTimeZone;</span>
<span class="fc" id="L83">		this.timeZoneEffectiveDate = timeZoneEffectiveDate;</span>
<span class="fc" id="L84">		initRows(shiftPatterns);</span>

<span class="fc" id="L86">	}</span>
	
	private void initHeader() {
<span class="fc" id="L89">		TableHeaderPC header = getHeader();</span>
<span class="fc" id="L90">		Localizer localizer = m_context.getLocalizer();</span>
<span class="fc" id="L91">		header.setPartialSortable(true);</span>
<span class="fc" id="L92">		header.addColumnHeaderData(&quot;toggleAll&quot;, toggleAll.getHtmlDisplay(), false);</span>
<span class="fc" id="L93">		header.addColumnHeaderData(UIFWebBundleKey.LIST_HEADER_NAME, localizer.i18n(UIFWebBundleKey.BUNDLE_NAME, UIFWebBundleKey.LIST_HEADER_NAME), true);</span>
<span class="fc" id="L94">		header.addColumnHeaderData(FsWebBundleKey.FS_CONSISTENCY_TOLERANCE, localizer.i18n(FsWebBundleKey.BUNDLE_NAME, FsWebBundleKey.FS_CONSISTENCY_TOLERANCE), true);</span>
<span class="fc" id="L95">		header.addColumnHeaderData(FsWebBundleKey.FS_EMPLOYEE_TYPE, localizer.i18n(FsWebBundleKey.BUNDLE_NAME, FsWebBundleKey.FS_EMPLOYEE_TYPE), true);</span>
<span class="fc" id="L96">		header.addColumnHeaderData(FsWebBundleKey.FS_SHIFT_ORG_SELECTOR, localizer.i18n(FsWebBundleKey.BUNDLE_NAME, FsWebBundleKey.FS_SHIFT_ORG_SELECTOR), true);</span>
<span class="fc" id="L97">		header.addColumnHeaderData(UIFWebBundleKey.LIST_HEADER_DESCRIPTION, localizer.i18n(UIFWebBundleKey.BUNDLE_NAME, UIFWebBundleKey.LIST_HEADER_DESCRIPTION), true);</span>
<span class="pc bpc" id="L98" title="1 of 2 branches missed.">		if (WorkRulesUtil.areMonthlyWorkRulesLicensed()) {</span>
<span class="nc" id="L99">			header.addColumnHeaderData(FsWebBundleKey.FS_WORK_PATTERN_TYPE_HEADER,</span>
<span class="nc" id="L100">					localizer.i18n(FsWebBundleKey.BUNDLE_NAME, FsWebBundleKey.FS_WORK_PATTERN_TYPE_HEADER));</span>
		}
<span class="fc" id="L102">		setPersitedSortHeader(m_usedType, header);</span>
<span class="fc" id="L103">	}</span>
	
	private void initRows(Collection&lt;ShiftPattern&gt; shiftPatterns) {
<span class="fc" id="L106">		Collection&lt;MultiColumnNodeData&gt; rows = super.getListModel();</span>
		
<span class="fc bfc" id="L108" title="All 2 branches covered.">		if (shiftPatterns != null) {</span>
<span class="fc bfc" id="L109" title="All 2 branches covered.">			for (ShiftPattern shiftPattern : shiftPatterns) {</span>
<span class="fc bfc" id="L110" title="All 2 branches covered.">				boolean hasOTExtensions = shiftPattern.getOTExtensionStartTimes().size() &gt; 0;</span>
<span class="fc bfc" id="L111" title="All 2 branches covered.">				boolean hasVTOEvents = shiftPattern.getVTOEventStartTimes().size() &gt; 0;</span>
<span class="pc bpc" id="L112" title="1 of 2 branches missed.">				boolean hasShifts = shiftPattern.getShiftPatternShiftAttributes().size() &gt; 0;</span>
				
<span class="fc" id="L114">				DefaultMultiColumnNodeData rowData = new DefaultMultiColumnNodeData(shiftPattern.getID());</span>
<span class="fc" id="L115">				ArrayList&lt;String&gt; detailRowIDs = new ArrayList&lt;String&gt;();</span>
				
<span class="pc bpc" id="L117" title="1 of 2 branches missed.">				if (hasShifts) {</span>
<span class="fc" id="L118">					detailRowIDs.add(getName() + &quot;__shiftDetail&quot; + shiftPattern.getID());</span>
				}
<span class="fc bfc" id="L120" title="All 2 branches covered.">				if (hasVTOEvents) {</span>
<span class="fc" id="L121">					detailRowIDs.add(getName() + &quot;__vtoEventDetail&quot; + shiftPattern.getID());</span>
				}
<span class="fc bfc" id="L123" title="All 2 branches covered.">				if (hasOTExtensions) {</span>
<span class="fc" id="L124">					detailRowIDs.add(getName() + &quot;__otExtensionDetail&quot; + shiftPattern.getID());</span>
				}
	
				// Toggle
<span class="pc bpc" id="L128" title="5 of 6 branches missed.">				if (hasShifts || hasVTOEvents || hasOTExtensions) {</span>
<span class="fc" id="L129">					ToggleVisiblePC toggle = new ToggleVisiblePC(m_context, &quot;toggle&quot; + shiftPattern.getID(), detailRowIDs);</span>
<span class="fc" id="L130">					toggleAll.addChildComponent(toggle);</span>
<span class="fc" id="L131">					rowData.add(toggle.getHtmlDisplay());</span>
<span class="fc" id="L132">				} else {</span>
<span class="nc" id="L133">					rowData.add(&quot;&quot;);</span>
				}
				
				//Name
<span class="fc" id="L137">				rowData.add(shiftPattern.getName());</span>
				
				//Consistency Tolerance
<span class="fc" id="L140">				rowData.add(m_localizer.formatDurationInMins(shiftPattern.getConsistentStartsTolerance()));</span>
				
				//Employee Type
<span class="fc" id="L143">				EmployeeType et = empTypeMap.get(shiftPattern.getEmployeeTypeID());</span>
<span class="pc bpc" id="L144" title="1 of 2 branches missed.">				rowData.add(et == null ? &quot;&quot; : et.getDescription());</span>
				
				//Organization
<span class="fc" id="L147">				ID orgID = shiftPattern.getOrganizationID();</span>
<span class="fc" id="L148">				Organization org = null;</span>
<span class="pc bpc" id="L149" title="1 of 2 branches missed.">				if (orgID != null) {</span>
<span class="fc" id="L150">					org = orgMap.get(shiftPattern.getOrganizationID());</span>
<span class="fc" id="L151">					rowData.add(org.getName());</span>
				} else {
<span class="nc" id="L153">					rowData.add(m_localizer.i18n(FsWebBundleKey.BUNDLE_NAME, FsWebBundleKey.LOCAL));</span>
				}
				
				//Description
<span class="fc" id="L157">				rowData.add(shiftPattern.getDescription());</span>
				
				//Period type
<span class="pc bpc" id="L160" title="1 of 2 branches missed.">				if (WorkRulesUtil.areMonthlyWorkRulesLicensed()) {</span>
<span class="pc bnc" id="L161" title="All 6 branches missed.">					switch(shiftPattern.getPeriod()) {</span>
					case Week:
<span class="nc" id="L163">						rowData.add(m_localizer.i18n(FsWebBundleKey.BUNDLE_NAME, FsWebBundleKey.FS_WORK_PATTERN_PERIOD_WEEK));</span>
<span class="nc" id="L164">						break;</span>
					case TwentyEightDayMonth:
<span class="nc" id="L166">						rowData.add(m_localizer.i18n(FsWebBundleKey.BUNDLE_NAME, FsWebBundleKey.FS_WORK_PATTERN_PERIOD_28_DAY_MONTH));</span>
<span class="nc" id="L167">						break;</span>
					case TwentyNineDayMonth:
<span class="nc" id="L169">						rowData.add(m_localizer.i18n(FsWebBundleKey.BUNDLE_NAME, FsWebBundleKey.FS_WORK_PATTERN_PERIOD_29_DAY_MONTH));</span>
<span class="nc" id="L170">						break;</span>
					case ThirtyDayMonth:
<span class="nc" id="L172">						rowData.add(m_localizer.i18n(FsWebBundleKey.BUNDLE_NAME, FsWebBundleKey.FS_WORK_PATTERN_PERIOD_30_DAY_MONTH));</span>
<span class="nc" id="L173">						break;</span>
					case ThirtyOneDayMonth:
<span class="nc" id="L175">						rowData.add(m_localizer.i18n(FsWebBundleKey.BUNDLE_NAME, FsWebBundleKey.FS_WORK_PATTERN_PERIOD_31_DAY_MONTH));</span>
<span class="nc" id="L176">						break;</span>
					default:
						break;
					}
				}				
				
<span class="fc" id="L182">				setRowAttributes(rowData, shiftPattern);</span>
				
<span class="pc bpc" id="L184" title="1 of 6 branches missed.">				if (!hasOTExtensions &amp;&amp; !hasVTOEvents &amp;&amp; !hasShifts) {</span>
<span class="nc" id="L185">					rows.add(rowData);</span>
				} else {
<span class="fc" id="L187">					ArrayList&lt;MultiColumnNodeData&gt; rowDetails = new ArrayList&lt;MultiColumnNodeData&gt;();</span>
	
<span class="pc bpc" id="L189" title="1 of 2 branches missed.">					if (hasShifts) {				</span>
<span class="fc" id="L190">						DefaultMultiColumnNodeData mcndDetail = new DefaultMultiColumnNodeData(shiftPattern.getID());</span>
<span class="fc" id="L191">						String detailRowID = getName() + &quot;__shiftDetail&quot; + shiftPattern.getID();</span>
<span class="fc" id="L192">						mcndDetail.setNodeAttribute(&quot;isDetail&quot;, &quot;true&quot;);</span>
<span class="fc" id="L193">						mcndDetail.setNodeAttribute(&quot;multiSelectGroup&quot;, &quot;detail&quot;);</span>
						
<span class="fc" id="L195">						WorkDaysListPC wdlpc = new WorkDaysListPC(m_context,</span>
<span class="fc" id="L196">								&quot;shiftPattern&quot; + JSUtil.getJSSuffix(shiftPattern.getID().toString()) + &quot;_shift&quot;,</span>
								shiftPattern, optimizationTargetTimeZone, timeZoneEffectiveDate, isByOrg, orgMap, campaignMap);
<span class="fc" id="L198">						wdlpc.setIsBorderEnabled(true);</span>
<span class="fc" id="L199">						wdlpc.setRowSelectable(false);</span>
<span class="fc" id="L200">						this.addChildComponent(wdlpc);</span>
						
<span class="fc" id="L202">						HtmlTableRow row = new HtmlTableRow();</span>
<span class="fc" id="L203">						row.add(&quot;&lt;td colspan='11'&gt;&quot; + wdlpc + &quot;&lt;/td&gt;&quot;); // Hard code the colspan for now, since we init selectable items before the header because of the toggles</span>
<span class="fc" id="L204">						mcndDetail.setNodeAttribute(&quot;id&quot;, detailRowID);</span>
<span class="fc" id="L205">						mcndDetail.setNodeAttribute(&quot;masterID&quot;, shiftPattern.getID().toString());</span>
<span class="fc" id="L206">						mcndDetail.setNodeAttribute(&quot;style&quot;, &quot;display: none;&quot;);</span>
<span class="fc" id="L207">						mcndDetail.add(row);</span>
<span class="fc" id="L208">						rowDetails.add(mcndDetail);</span>
					}
<span class="fc bfc" id="L210" title="All 2 branches covered.">					if (hasVTOEvents) {				</span>
<span class="fc" id="L211">						DefaultMultiColumnNodeData mcndDetail = new DefaultMultiColumnNodeData(shiftPattern.getID());</span>
<span class="fc" id="L212">						String detailRowID = getName() + &quot;__vtoEventDetail&quot; + shiftPattern.getID();</span>
<span class="fc" id="L213">						mcndDetail.setNodeAttribute(&quot;isDetail&quot;, &quot;true&quot;);</span>
<span class="fc" id="L214">						mcndDetail.setNodeAttribute(&quot;multiSelectGroup&quot;, &quot;detail&quot;);</span>
						
<span class="fc" id="L216">						VTOEventListPC vtolpc = new VTOEventListPC(m_context,</span>
<span class="fc" id="L217">								&quot;shiftPattern&quot; + JSUtil.getJSSuffix(shiftPattern.getID().toString()) + &quot;_vtoEvents&quot;,</span>
								shiftPattern, timeZoneEffectiveDate, orgMap, campaignMap, activityMap, true);
<span class="fc" id="L219">						vtolpc.setIsBorderEnabled(true);</span>
<span class="fc" id="L220">						vtolpc.setRowSelectable(false);</span>
<span class="fc" id="L221">						vtolpc.setIsUserSortable(false);</span>
<span class="fc" id="L222">						this.addChildComponent(vtolpc);</span>
						
<span class="fc" id="L224">						HtmlTableRow row = new HtmlTableRow();</span>
<span class="fc" id="L225">						row.add(&quot;&lt;td colspan='7'&gt;&quot; + vtolpc + &quot;&lt;/td&gt;&quot;); // Hard code the colspan for now, since we init selectable items before the header because of the toggles</span>
<span class="fc" id="L226">						mcndDetail.setNodeAttribute(&quot;id&quot;, detailRowID);</span>
<span class="fc" id="L227">						mcndDetail.setNodeAttribute(&quot;masterID&quot;, shiftPattern.getID().toString());</span>
<span class="fc" id="L228">						mcndDetail.setNodeAttribute(&quot;style&quot;, &quot;display: none;&quot;);</span>
<span class="fc" id="L229">						mcndDetail.add(row);</span>
<span class="fc" id="L230">						rowDetails.add(mcndDetail);</span>
					}
<span class="fc bfc" id="L232" title="All 2 branches covered.">					if (hasOTExtensions) {</span>
<span class="fc" id="L233">						DefaultMultiColumnNodeData mcndDetail = new DefaultMultiColumnNodeData(shiftPattern.getID());</span>
<span class="fc" id="L234">						String detailRowID = getName() + &quot;__otExtensionDetail&quot; + shiftPattern.getID();</span>
<span class="fc" id="L235">						mcndDetail.setNodeAttribute(&quot;isDetail&quot;, &quot;true&quot;);</span>
<span class="fc" id="L236">						mcndDetail.setNodeAttribute(&quot;multiSelectGroup&quot;, &quot;detail&quot;);</span>
						
<span class="fc" id="L238">						OTExtensionListPC otelpc = new OTExtensionListPC(m_context,</span>
<span class="fc" id="L239">								&quot;shiftPattern&quot; + JSUtil.getJSSuffix(shiftPattern.getID().toString()) + &quot;_otExtensions&quot;,</span>
								shiftPattern, optimizationTargetTimeZone, timeZoneEffectiveDate, orgMap, campaignMap,
								activityMap, isByOrg, true);
<span class="fc" id="L242">						otelpc.setIsUserSortable(false);</span>
<span class="fc" id="L243">						otelpc.setIsBorderEnabled(true);</span>
<span class="fc" id="L244">						otelpc.setRowSelectable(false);</span>
<span class="fc" id="L245">						this.addChildComponent(otelpc);</span>
						
<span class="fc" id="L247">						HtmlTableRow row = new HtmlTableRow();</span>
<span class="fc" id="L248">						row.add(&quot;&lt;td colspan='8'&gt;&quot; + otelpc + &quot;&lt;/td&gt;&quot;); // Hard code the colspan for now, since we init selectable items before the header because of the toggles</span>
<span class="fc" id="L249">						mcndDetail.setNodeAttribute(&quot;id&quot;, detailRowID);</span>
<span class="fc" id="L250">						mcndDetail.setNodeAttribute(&quot;masterID&quot;, shiftPattern.getID().toString());</span>
<span class="fc" id="L251">						mcndDetail.setNodeAttribute(&quot;style&quot;, &quot;display: none;&quot;);</span>
<span class="fc" id="L252">						mcndDetail.add(row);	</span>
<span class="fc" id="L253">						rowDetails.add(mcndDetail);			</span>
					}
	
<span class="fc" id="L256">					MasterDetailRow mdr = new MasterDetailRow(rowData, rowDetails);</span>
<span class="fc" id="L257">					rows.add(mdr);</span>
				}
<span class="fc" id="L259">			}</span>
		}
<span class="fc" id="L261">	}</span>

<span class="fc" id="L263">	protected void setRowAttributes(DefaultMultiColumnNodeData rowData, ShiftPattern shiftPattern) {}</span>
	
	public LinkedHashMap&lt;DBSortField, Comparator&gt; getSortComparators() {
<span class="fc" id="L266">		LinkedHashMap&lt;DBSortField, Comparator&gt; comparators =</span>
			new LinkedHashMap&lt;DBSortField, Comparator&gt;();
<span class="fc bfc" id="L268" title="All 2 branches covered.">		for (ShiftPatternSortField sortField : getDBSortFieldIndices()) {</span>
<span class="pc bpc" id="L269" title="6 of 7 branches missed.">			switch (sortField) {</span>
				case ID:
<span class="fc" id="L271">					comparators.put(ShiftPatternSortField.ID, null);</span>
<span class="fc" id="L272">					break;</span>
				case NAME:
<span class="nc" id="L274">					comparators.put(ShiftPatternSortField.NAME, null);</span>
<span class="nc" id="L275">					break;</span>
				case EMPLOYEE_TYPE:
<span class="nc" id="L277">					comparators.put(ShiftPatternSortField.EMPLOYEE_TYPE, null);</span>
<span class="nc" id="L278">					break;</span>
				case CONSISTENCY_TOLERANCE:
<span class="nc" id="L280">					comparators.put(ShiftPatternSortField.CONSISTENCY_TOLERANCE, null);</span>
<span class="nc" id="L281">					break;</span>
				case ORGANIZATION:
<span class="nc" id="L283">					comparators.put(ShiftPatternSortField.ORGANIZATION, new OrganizationCampaignNameComparator(getLocalizer()));</span>
<span class="nc" id="L284">					break;</span>
				case DESCRIPTION:
<span class="nc" id="L286">					comparators.put(ShiftPatternSortField.DESCRIPTION, null);</span>
					break;
			}
<span class="fc" id="L289">		}</span>
		
<span class="fc" id="L291">		return comparators;</span>
	}
	
	public ArrayList&lt;ShiftPatternSortField&gt; getDBSortFieldIndices() {
<span class="fc" id="L295">		ArrayList&lt;ShiftPatternSortField&gt; retVal = new ArrayList&lt;ShiftPatternSortField&gt;();</span>
<span class="fc" id="L296">		TableHeaderPC header = getHeader();</span>
<span class="fc" id="L297">		setPersitedSortHeader(m_usedType, header);</span>
<span class="pc bpc" id="L298" title="1 of 2 branches missed.">		if (header.getSortColumnIndexes() == null) {</span>
			//Default sort index is by ID (chronological order in which object was created)
<span class="fc" id="L300">			retVal.add(ShiftPatternSortField.ID);</span>
		} else {
<span class="nc bnc" id="L302" title="All 2 branches missed.">			for (int sortField : header.getSortColumnIndexes()) {</span>
<span class="nc bnc" id="L303" title="All 6 branches missed.">				switch (sortField) {</span>
					case 1: 
<span class="nc" id="L305">						retVal.add(ShiftPatternSortField.NAME);</span>
<span class="nc" id="L306">						break;</span>
					case 2: 
<span class="nc" id="L308">						retVal.add(ShiftPatternSortField.CONSISTENCY_TOLERANCE);</span>
<span class="nc" id="L309">						break;</span>
					case 3: 
<span class="nc" id="L311">						retVal.add(ShiftPatternSortField.EMPLOYEE_TYPE);</span>
<span class="nc" id="L312">						break;</span>
					case 4: 
<span class="nc" id="L314">						retVal.add(ShiftPatternSortField.ORGANIZATION);</span>
<span class="nc" id="L315">						break;</span>
					case 5: 
<span class="nc" id="L317">						retVal.add(ShiftPatternSortField.DESCRIPTION);</span>
<span class="nc" id="L318">						break;</span>
					default: break;
				}
			}
		}
<span class="fc" id="L323">		return retVal;</span>
	}
	private void setPersitedSortHeader(int usedType,TableHeaderPC header) {
<span class="fc" id="L326">		String sortColumn = null;</span>
<span class="fc" id="L327">		String sortOrder = null;</span>
<span class="fc bfc" id="L328" title="All 2 branches covered.">		if (usedType==USED_IN_LISTPOPUP)</span>
		{
<span class="fc" id="L330">			sortColumn = m_context.getUserProperty(WORKPATTERN_LISTPOPUP_SORTCOLUMN);</span>
<span class="fc" id="L331">			sortOrder = m_context.getUserProperty(WORKPATTERN_LISTPOPUP_SORTORDER);</span>
<span class="fc bfc" id="L332" title="All 2 branches covered.">		} else if (usedType==USED_IN_SELECTIONPOPUP){</span>
<span class="fc" id="L333">			sortColumn = m_context.getUserProperty(WORKPATTERN_SELECTIONPOPUP_SORTCOLUMN);</span>
<span class="fc" id="L334">			sortOrder = m_context.getUserProperty(WORKPATTERN_SELECTIONPOPUP_SORTORDER);</span>
		}else
		{
<span class="fc" id="L337">			sortColumn = m_context.getUserProperty(WORKPATTERN_LIST_SORTCOLUMN);</span>
<span class="fc" id="L338">			sortOrder = m_context.getUserProperty(WORKPATTERN_LIST_SORTORDER);</span>
		}
	
<span class="pc bpc" id="L341" title="1 of 2 branches missed.">		if (sortColumn != null) {</span>
<span class="nc" id="L342">			header.setSortColumn(sortColumn);</span>
		}
<span class="pc bpc" id="L344" title="1 of 2 branches missed.">		if (sortOrder != null) {</span>
<span class="nc" id="L345">			header.setSortOrder(sortOrder);</span>
		}
<span class="fc" id="L347">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>