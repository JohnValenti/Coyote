<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>WorkPatternMasterDetailListPC.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.verint.web.fs.workrules</a> &gt; <span class="el_source">WorkPatternMasterDetailListPC.java</span></div><h1>WorkPatternMasterDetailListPC.java</h1><pre class="source lang-java linenums">package com.verint.web.fs.workrules;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.localization.Localizer;
import com.bluepumpkin.ejb.bbm.activity.model.Activity;
import com.bluepumpkin.ejb.bbm.campaign.model.Campaign;
import com.bluepumpkin.ejb.bbm.vo.DBSortField;
import com.bluepumpkin.ejb.bbm.workresource.model.EmployeeType;
import com.bluepumpkin.ejb.bbm.workresource.model.Organization;
import com.bluepumpkin.ejb.bbm.workrules.model.ShiftPattern;
import com.bluepumpkin.ejb.bbm.workrules.model.ShiftPatternSortField;
import com.bluepumpkin.web.fs.l10n.FsWebBundleKey;
import com.verint.web.fs.widgets.MasterDetailRow;
import com.verint.web.fs.widgets.MultiColMasterDetailListPC;
import com.verint.web.fs.widgets.ToggleVisiblePC;
import com.witness.web.uif.jsp.HtmlTableRow;
import com.witness.web.uif.l10n.UIFWebBundleKey;
import com.witness.web.uif.pagecomponent.DefaultMultiColumnNodeData;
import com.witness.web.uif.pagecomponent.MultiColumnNodeData;
import com.witness.web.uif.pagecomponent.table.TableHeaderPC;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.util.js.JSUtil;

import java.util.*;

public class WorkPatternMasterDetailListPC extends MultiColMasterDetailListPC {
	private static final long serialVersionUID = 1L;
	public static final String WORKPATTERN_LIST_SORTCOLUMN = &quot;WORKPATTERN_LIST_SORTCOLUMN&quot;;
	public static final String WORKPATTERN_LIST_SORTORDER = &quot;WORKPATTERN_LIST_SORTORDER&quot;;
	public static final String WORKPATTERN_LISTPOPUP_SORTCOLUMN = &quot;WORKPATTERN_LISTPOPUP_SORTCOLUMN&quot;;
	public static final String WORKPATTERN_LISTPOPUP_SORTORDER = &quot;WORKPATTERN_LISTPOPUP_SORTORDER&quot;;
	public static final String WORKPATTERN_SELECTIONPOPUP_SORTCOLUMN = &quot;WORKPATTERN_SELECTIONPOPUP_SORTCOLUMN&quot;;
	public static final String WORKPATTERN_SELECTIONPOPUP_SORTORDER = &quot;WORKPATTERN_SELECTIONPOPUP_SORTORDER&quot;;
	public static final int USED_IN_LIST = 0;
	public static final int USED_IN_LISTPOPUP = 1;
	public static final int USED_IN_SELECTIONPOPUP = 2;
	private int m_usedType;

	ToggleVisiblePC toggleAll;
	private boolean isByOrg;
	private TimeZone optimizationTargetTimeZone;
	private Date timeZoneEffectiveDate;

<span class="fc" id="L44">	private Map&lt;ID, Organization&gt; orgMap = null;</span>
<span class="fc" id="L45">	private Map&lt;ID, Campaign&gt; campaignMap = null;</span>
<span class="fc" id="L46">	private Map&lt;ID, Activity&gt; activityMap = null;</span>
<span class="fc" id="L47">	private Map&lt;ID, EmployeeType&gt; empTypeMap = null;</span>


	public WorkPatternMasterDetailListPC(RequestContext context, int usedType) {
<span class="fc" id="L51">		super(context);</span>
<span class="fc" id="L52">		toggleAll = new ToggleVisiblePC(m_context, &quot;toggleAll&quot;);</span>
<span class="fc" id="L53">		this.addChildComponent(toggleAll);</span>
<span class="fc" id="L54">		m_usedType = usedType; //Must be assign before initHeader</span>
<span class="fc" id="L55">		initHeader();</span>
<span class="fc" id="L56">	}</span>

	public WorkPatternMasterDetailListPC(RequestContext context, Collection&lt;ShiftPattern&gt; shiftPatterns,
			TimeZone optimizationTargetTimeZone, Date timeZoneEffectiveDate, boolean isByOrg, Map&lt;ID, Organization&gt; orgMap,
			Map&lt;ID, Campaign&gt; campaignMap, Map&lt;ID, Activity&gt; activityMap, Map&lt;ID, EmployeeType&gt; empTypeMap, int usedType) {
<span class="fc" id="L61">		this(context, usedType);</span>
<span class="fc" id="L62">		setFirstColumnWidth(&quot;2.5%&quot;);</span>
<span class="fc" id="L63">		setData(shiftPatterns, optimizationTargetTimeZone, timeZoneEffectiveDate, isByOrg, orgMap, campaignMap, activityMap, empTypeMap);</span>
<span class="fc" id="L64">	}</span>

	public void setData(Collection&lt;ShiftPattern&gt; shiftPatterns,
			TimeZone optimizationTargetTimeZone, Date timeZoneEffectiveDate, boolean isByOrg, Map&lt;ID, Organization&gt; orgMap,
			Map&lt;ID, Campaign&gt; campaignMap, Map&lt;ID, Activity&gt; activityMap, Map&lt;ID, EmployeeType&gt; empTypeMap) {
<span class="fc" id="L69">		this.isByOrg = isByOrg;</span>
<span class="fc" id="L70">		this.orgMap = orgMap;</span>
<span class="fc" id="L71">		this.campaignMap = campaignMap;</span>
<span class="fc" id="L72">		this.activityMap = activityMap;</span>
<span class="fc" id="L73">		this.empTypeMap = empTypeMap;</span>
<span class="fc" id="L74">		this.optimizationTargetTimeZone = optimizationTargetTimeZone;</span>
<span class="fc" id="L75">		this.timeZoneEffectiveDate = timeZoneEffectiveDate;</span>
<span class="fc" id="L76">		initRows(shiftPatterns);</span>

<span class="fc" id="L78">	}</span>

	private void initHeader() {
<span class="fc" id="L81">		TableHeaderPC header = getHeader();</span>
<span class="fc" id="L82">		Localizer localizer = m_context.getLocalizer();</span>
<span class="fc" id="L83">		header.setPartialSortable(true);</span>
<span class="fc" id="L84">		header.addColumnHeaderData(&quot;toggleAll&quot;, toggleAll.getHtmlDisplay(), false);</span>
<span class="fc" id="L85">		header.addColumnHeaderData(UIFWebBundleKey.LIST_HEADER_NAME, localizer.i18n(UIFWebBundleKey.BUNDLE_NAME, UIFWebBundleKey.LIST_HEADER_NAME), true);</span>
<span class="fc" id="L86">		header.addColumnHeaderData(FsWebBundleKey.FS_CONSISTENCY_TOLERANCE, localizer.i18n(FsWebBundleKey.BUNDLE_NAME, FsWebBundleKey.FS_CONSISTENCY_TOLERANCE), true);</span>
<span class="fc" id="L87">		header.addColumnHeaderData(FsWebBundleKey.FS_EMPLOYEE_TYPE, localizer.i18n(FsWebBundleKey.BUNDLE_NAME, FsWebBundleKey.FS_EMPLOYEE_TYPE), true);</span>
<span class="fc" id="L88">		header.addColumnHeaderData(FsWebBundleKey.FS_SHIFT_ORG_SELECTOR, localizer.i18n(FsWebBundleKey.BUNDLE_NAME, FsWebBundleKey.FS_SHIFT_ORG_SELECTOR), true);</span>
<span class="fc" id="L89">		header.addColumnHeaderData(UIFWebBundleKey.LIST_HEADER_DESCRIPTION, localizer.i18n(UIFWebBundleKey.BUNDLE_NAME, UIFWebBundleKey.LIST_HEADER_DESCRIPTION), true);</span>
<span class="pc bpc" id="L90" title="1 of 2 branches missed.">		if (WorkRulesUtil.areMonthlyWorkRulesLicensed()) {</span>
<span class="nc" id="L91">			header.addColumnHeaderData(FsWebBundleKey.FS_WORK_PATTERN_TYPE_HEADER,</span>
<span class="nc" id="L92">					localizer.i18n(FsWebBundleKey.BUNDLE_NAME, FsWebBundleKey.FS_WORK_PATTERN_TYPE_HEADER));</span>
		}
<span class="fc" id="L94">		setPersitedSortHeader(m_usedType, header);</span>
<span class="fc" id="L95">	}</span>

	private void initRows(Collection&lt;ShiftPattern&gt; shiftPatterns) {
<span class="fc" id="L98">		Collection&lt;MultiColumnNodeData&gt; rows = super.getListModel();</span>

<span class="fc bfc" id="L100" title="All 2 branches covered.">		if (shiftPatterns != null) {</span>
<span class="fc bfc" id="L101" title="All 2 branches covered.">			for (ShiftPattern shiftPattern : shiftPatterns) {</span>
<span class="pc bpc" id="L102" title="1 of 2 branches missed.">				boolean hasOTExtensions = shiftPattern.getOTExtensionStartTimes().size() &gt; 0;</span>
<span class="pc bpc" id="L103" title="1 of 2 branches missed.">				boolean hasVTOEvents = shiftPattern.getVTOEventStartTimes().size() &gt; 0;</span>
<span class="pc bpc" id="L104" title="1 of 2 branches missed.">				boolean hasShifts = shiftPattern.getShiftPatternShiftAttributes().size() &gt; 0;</span>

<span class="fc" id="L106">				DefaultMultiColumnNodeData rowData = new DefaultMultiColumnNodeData(shiftPattern.getID());</span>
<span class="fc" id="L107">				ArrayList&lt;String&gt; detailRowIDs = new ArrayList&lt;String&gt;();</span>

<span class="pc bpc" id="L109" title="1 of 2 branches missed.">				if (hasShifts) {</span>
<span class="fc" id="L110">					detailRowIDs.add(getName() + &quot;__shiftDetail&quot; + shiftPattern.getID());</span>
				}
<span class="pc bpc" id="L112" title="1 of 2 branches missed.">				if (hasVTOEvents) {</span>
<span class="nc" id="L113">					detailRowIDs.add(getName() + &quot;__vtoEventDetail&quot; + shiftPattern.getID());</span>
				}
<span class="pc bpc" id="L115" title="1 of 2 branches missed.">				if (hasOTExtensions) {</span>
<span class="nc" id="L116">					detailRowIDs.add(getName() + &quot;__otExtensionDetail&quot; + shiftPattern.getID());</span>
				}

				// Toggle
<span class="pc bpc" id="L120" title="5 of 6 branches missed.">				if (hasShifts || hasVTOEvents || hasOTExtensions) {</span>
<span class="fc" id="L121">					ToggleVisiblePC toggle = new ToggleVisiblePC(m_context, &quot;toggle&quot; + shiftPattern.getID(), detailRowIDs);</span>
<span class="fc" id="L122">					toggleAll.addChildComponent(toggle);</span>
<span class="fc" id="L123">					rowData.add(toggle.getHtmlDisplay());</span>
<span class="fc" id="L124">				} else {</span>
<span class="nc" id="L125">					rowData.add(&quot;&quot;);</span>
				}

				//Name
<span class="fc" id="L129">				rowData.add(shiftPattern.getName());</span>

				//Consistency Tolerance
<span class="fc" id="L132">				rowData.add(m_localizer.formatDurationInMins(shiftPattern.getConsistentStartsTolerance()));</span>

				//Employee Type
<span class="fc" id="L135">				EmployeeType et = empTypeMap.get(shiftPattern.getEmployeeTypeID());</span>
<span class="pc bpc" id="L136" title="1 of 2 branches missed.">				rowData.add(et == null ? &quot;&quot; : et.getDescription());</span>

				//Organization
<span class="fc" id="L139">				ID orgID = shiftPattern.getOrganizationID();</span>
<span class="fc" id="L140">				Organization org = null;</span>
<span class="pc bpc" id="L141" title="1 of 2 branches missed.">				if (orgID != null) {</span>
<span class="fc" id="L142">					org = orgMap.get(shiftPattern.getOrganizationID());</span>
<span class="fc" id="L143">					rowData.add(org.getName());</span>
				} else {
<span class="nc" id="L145">					rowData.add(m_localizer.i18n(FsWebBundleKey.BUNDLE_NAME, FsWebBundleKey.LOCAL));</span>
				}

				//Description
<span class="fc" id="L149">				rowData.add(shiftPattern.getDescription());</span>

				//Period type
<span class="pc bpc" id="L152" title="1 of 2 branches missed.">				if (WorkRulesUtil.areMonthlyWorkRulesLicensed()) {</span>
<span class="pc bnc" id="L153" title="All 6 branches missed.">					switch (shiftPattern.getPeriod()) {</span>
						case Week:
<span class="nc" id="L155">							rowData.add(m_localizer.i18n(FsWebBundleKey.BUNDLE_NAME, FsWebBundleKey.FS_WORK_PATTERN_PERIOD_WEEK));</span>
<span class="nc" id="L156">							break;</span>
						case TwentyEightDayMonth:
<span class="nc" id="L158">							rowData.add(m_localizer.i18n(FsWebBundleKey.BUNDLE_NAME, FsWebBundleKey.FS_WORK_PATTERN_PERIOD_28_DAY_MONTH));</span>
<span class="nc" id="L159">							break;</span>
						case TwentyNineDayMonth:
<span class="nc" id="L161">							rowData.add(m_localizer.i18n(FsWebBundleKey.BUNDLE_NAME, FsWebBundleKey.FS_WORK_PATTERN_PERIOD_29_DAY_MONTH));</span>
<span class="nc" id="L162">							break;</span>
						case ThirtyDayMonth:
<span class="nc" id="L164">							rowData.add(m_localizer.i18n(FsWebBundleKey.BUNDLE_NAME, FsWebBundleKey.FS_WORK_PATTERN_PERIOD_30_DAY_MONTH));</span>
<span class="nc" id="L165">							break;</span>
						case ThirtyOneDayMonth:
<span class="nc" id="L167">							rowData.add(m_localizer.i18n(FsWebBundleKey.BUNDLE_NAME, FsWebBundleKey.FS_WORK_PATTERN_PERIOD_31_DAY_MONTH));</span>
<span class="nc" id="L168">							break;</span>
						default:
							break;
					}
				}

<span class="fc" id="L174">				setRowAttributes(rowData, shiftPattern);</span>

<span class="pc bpc" id="L176" title="3 of 6 branches missed.">				if (!hasOTExtensions &amp;&amp; !hasVTOEvents &amp;&amp; !hasShifts) {</span>
<span class="nc" id="L177">					rows.add(rowData);</span>
				} else {
<span class="fc" id="L179">					ArrayList&lt;MultiColumnNodeData&gt; rowDetails = new ArrayList&lt;MultiColumnNodeData&gt;();</span>

<span class="pc bpc" id="L181" title="1 of 2 branches missed.">					if (hasShifts) {</span>
<span class="fc" id="L182">						DefaultMultiColumnNodeData mcndDetail = new DefaultMultiColumnNodeData(shiftPattern.getID());</span>
<span class="fc" id="L183">						String detailRowID = getName() + &quot;__shiftDetail&quot; + shiftPattern.getID();</span>
<span class="fc" id="L184">						mcndDetail.setNodeAttribute(&quot;isDetail&quot;, &quot;true&quot;);</span>
<span class="fc" id="L185">						mcndDetail.setNodeAttribute(&quot;multiSelectGroup&quot;, &quot;detail&quot;);</span>

<span class="fc" id="L187">						WorkDaysListPC wdlpc = new WorkDaysListPC(m_context,</span>
<span class="fc" id="L188">								&quot;shiftPattern&quot; + JSUtil.getJSSuffix(shiftPattern.getID().toString()) + &quot;_shift&quot;,</span>
								shiftPattern, optimizationTargetTimeZone, timeZoneEffectiveDate, isByOrg, orgMap, campaignMap);
<span class="fc" id="L190">						wdlpc.setIsBorderEnabled(true);</span>
<span class="fc" id="L191">						wdlpc.setRowSelectable(false);</span>
<span class="fc" id="L192">						this.addChildComponent(wdlpc);</span>

<span class="fc" id="L194">						HtmlTableRow row = new HtmlTableRow();</span>
<span class="fc" id="L195">						row.add(&quot;&lt;td colspan='11'&gt;&quot; + wdlpc + &quot;&lt;/td&gt;&quot;); // Hard code the colspan for now, since we init selectable items before the header because of the toggles</span>
<span class="fc" id="L196">						mcndDetail.setNodeAttribute(&quot;id&quot;, detailRowID);</span>
<span class="fc" id="L197">						mcndDetail.setNodeAttribute(&quot;masterID&quot;, shiftPattern.getID().toString());</span>
<span class="fc" id="L198">						mcndDetail.setNodeAttribute(&quot;style&quot;, &quot;display: none;&quot;);</span>
<span class="fc" id="L199">						mcndDetail.add(row);</span>
<span class="fc" id="L200">						rowDetails.add(mcndDetail);</span>
					}
<span class="pc bpc" id="L202" title="1 of 2 branches missed.">					if (hasVTOEvents) {</span>
<span class="nc" id="L203">						DefaultMultiColumnNodeData mcndDetail = new DefaultMultiColumnNodeData(shiftPattern.getID());</span>
<span class="nc" id="L204">						String detailRowID = getName() + &quot;__vtoEventDetail&quot; + shiftPattern.getID();</span>
<span class="nc" id="L205">						mcndDetail.setNodeAttribute(&quot;isDetail&quot;, &quot;true&quot;);</span>
<span class="nc" id="L206">						mcndDetail.setNodeAttribute(&quot;multiSelectGroup&quot;, &quot;detail&quot;);</span>

<span class="nc" id="L208">						VTOEventListPC vtolpc = new VTOEventListPC(m_context,</span>
<span class="nc" id="L209">								&quot;shiftPattern&quot; + JSUtil.getJSSuffix(shiftPattern.getID().toString()) + &quot;_vtoEvents&quot;,</span>
								shiftPattern, timeZoneEffectiveDate, orgMap, campaignMap, activityMap, true);
<span class="nc" id="L211">						vtolpc.setIsBorderEnabled(true);</span>
<span class="nc" id="L212">						vtolpc.setRowSelectable(false);</span>
<span class="nc" id="L213">						vtolpc.setIsUserSortable(false);</span>
<span class="nc" id="L214">						this.addChildComponent(vtolpc);</span>

<span class="nc" id="L216">						HtmlTableRow row = new HtmlTableRow();</span>
<span class="nc" id="L217">						row.add(&quot;&lt;td colspan='7'&gt;&quot; + vtolpc + &quot;&lt;/td&gt;&quot;); // Hard code the colspan for now, since we init selectable items before the header because of the toggles</span>
<span class="nc" id="L218">						mcndDetail.setNodeAttribute(&quot;id&quot;, detailRowID);</span>
<span class="nc" id="L219">						mcndDetail.setNodeAttribute(&quot;masterID&quot;, shiftPattern.getID().toString());</span>
<span class="nc" id="L220">						mcndDetail.setNodeAttribute(&quot;style&quot;, &quot;display: none;&quot;);</span>
<span class="nc" id="L221">						mcndDetail.add(row);</span>
<span class="nc" id="L222">						rowDetails.add(mcndDetail);</span>
					}
<span class="pc bpc" id="L224" title="1 of 2 branches missed.">					if (hasOTExtensions) {</span>
<span class="nc" id="L225">						DefaultMultiColumnNodeData mcndDetail = new DefaultMultiColumnNodeData(shiftPattern.getID());</span>
<span class="nc" id="L226">						String detailRowID = getName() + &quot;__otExtensionDetail&quot; + shiftPattern.getID();</span>
<span class="nc" id="L227">						mcndDetail.setNodeAttribute(&quot;isDetail&quot;, &quot;true&quot;);</span>
<span class="nc" id="L228">						mcndDetail.setNodeAttribute(&quot;multiSelectGroup&quot;, &quot;detail&quot;);</span>

<span class="nc" id="L230">						OTExtensionListPC otelpc = new OTExtensionListPC(m_context,</span>
<span class="nc" id="L231">								&quot;shiftPattern&quot; + JSUtil.getJSSuffix(shiftPattern.getID().toString()) + &quot;_otExtensions&quot;,</span>
								shiftPattern, optimizationTargetTimeZone, timeZoneEffectiveDate, orgMap, campaignMap,
								activityMap, isByOrg, true);
<span class="nc" id="L234">						otelpc.setIsUserSortable(false);</span>
<span class="nc" id="L235">						otelpc.setIsBorderEnabled(true);</span>
<span class="nc" id="L236">						otelpc.setRowSelectable(false);</span>
<span class="nc" id="L237">						this.addChildComponent(otelpc);</span>

<span class="nc" id="L239">						HtmlTableRow row = new HtmlTableRow();</span>
<span class="nc" id="L240">						row.add(&quot;&lt;td colspan='8'&gt;&quot; + otelpc + &quot;&lt;/td&gt;&quot;); // Hard code the colspan for now, since we init selectable items before the header because of the toggles</span>
<span class="nc" id="L241">						mcndDetail.setNodeAttribute(&quot;id&quot;, detailRowID);</span>
<span class="nc" id="L242">						mcndDetail.setNodeAttribute(&quot;masterID&quot;, shiftPattern.getID().toString());</span>
<span class="nc" id="L243">						mcndDetail.setNodeAttribute(&quot;style&quot;, &quot;display: none;&quot;);</span>
<span class="nc" id="L244">						mcndDetail.add(row);</span>
<span class="nc" id="L245">						rowDetails.add(mcndDetail);</span>
					}

<span class="fc" id="L248">					MasterDetailRow mdr = new MasterDetailRow(rowData, rowDetails);</span>
<span class="fc" id="L249">					rows.add(mdr);</span>
				}
<span class="fc" id="L251">			}</span>
		}
<span class="fc" id="L253">	}</span>

	protected void setRowAttributes(DefaultMultiColumnNodeData rowData, ShiftPattern shiftPattern) {
<span class="fc" id="L256">	}</span>

	public LinkedHashMap&lt;DBSortField, Comparator&gt; getSortComparators() {
<span class="fc" id="L259">		LinkedHashMap&lt;DBSortField, Comparator&gt; comparators =</span>
				new LinkedHashMap&lt;DBSortField, Comparator&gt;();
<span class="fc bfc" id="L261" title="All 2 branches covered.">		for (ShiftPatternSortField sortField : getDBSortFieldIndices()) {</span>
<span class="pc bpc" id="L262" title="6 of 7 branches missed.">			switch (sortField) {</span>
				case ID:
<span class="fc" id="L264">					comparators.put(ShiftPatternSortField.ID, null);</span>
<span class="fc" id="L265">					break;</span>
				case NAME:
<span class="nc" id="L267">					comparators.put(ShiftPatternSortField.NAME, null);</span>
<span class="nc" id="L268">					break;</span>
				case EMPLOYEE_TYPE:
<span class="nc" id="L270">					comparators.put(ShiftPatternSortField.EMPLOYEE_TYPE, null);</span>
<span class="nc" id="L271">					break;</span>
				case CONSISTENCY_TOLERANCE:
<span class="nc" id="L273">					comparators.put(ShiftPatternSortField.CONSISTENCY_TOLERANCE, null);</span>
<span class="nc" id="L274">					break;</span>
				case ORGANIZATION:
<span class="nc" id="L276">					comparators.put(ShiftPatternSortField.ORGANIZATION, new OrganizationCampaignNameComparator(getLocalizer()));</span>
<span class="nc" id="L277">					break;</span>
				case DESCRIPTION:
<span class="nc" id="L279">					comparators.put(ShiftPatternSortField.DESCRIPTION, null);</span>
					break;
			}
<span class="fc" id="L282">		}</span>

<span class="fc" id="L284">		return comparators;</span>
	}

	public ArrayList&lt;ShiftPatternSortField&gt; getDBSortFieldIndices() {
<span class="fc" id="L288">		ArrayList&lt;ShiftPatternSortField&gt; retVal = new ArrayList&lt;ShiftPatternSortField&gt;();</span>
<span class="fc" id="L289">		TableHeaderPC header = getHeader();</span>
<span class="fc" id="L290">		setPersitedSortHeader(m_usedType, header);</span>
<span class="pc bpc" id="L291" title="1 of 2 branches missed.">		if (header.getSortColumnIndexes() == null) {</span>
			//Default sort index is by ID (chronological order in which object was created)
<span class="fc" id="L293">			retVal.add(ShiftPatternSortField.ID);</span>
		} else {
<span class="nc bnc" id="L295" title="All 2 branches missed.">			for (int sortField : header.getSortColumnIndexes()) {</span>
<span class="nc bnc" id="L296" title="All 6 branches missed.">				switch (sortField) {</span>
					case 1:
<span class="nc" id="L298">						retVal.add(ShiftPatternSortField.NAME);</span>
<span class="nc" id="L299">						break;</span>
					case 2:
<span class="nc" id="L301">						retVal.add(ShiftPatternSortField.CONSISTENCY_TOLERANCE);</span>
<span class="nc" id="L302">						break;</span>
					case 3:
<span class="nc" id="L304">						retVal.add(ShiftPatternSortField.EMPLOYEE_TYPE);</span>
<span class="nc" id="L305">						break;</span>
					case 4:
<span class="nc" id="L307">						retVal.add(ShiftPatternSortField.ORGANIZATION);</span>
<span class="nc" id="L308">						break;</span>
					case 5:
<span class="nc" id="L310">						retVal.add(ShiftPatternSortField.DESCRIPTION);</span>
<span class="nc" id="L311">						break;</span>
					default:
						break;
				}
			}
		}
<span class="fc" id="L317">		return retVal;</span>
	}

	private void setPersitedSortHeader(int usedType, TableHeaderPC header) {
<span class="fc" id="L321">		String sortColumn = null;</span>
<span class="fc" id="L322">		String sortOrder = null;</span>
<span class="fc bfc" id="L323" title="All 2 branches covered.">		if (usedType == USED_IN_LISTPOPUP) {</span>
<span class="fc" id="L324">			sortColumn = m_context.getUserProperty(WORKPATTERN_LISTPOPUP_SORTCOLUMN);</span>
<span class="fc" id="L325">			sortOrder = m_context.getUserProperty(WORKPATTERN_LISTPOPUP_SORTORDER);</span>
<span class="pc bpc" id="L326" title="1 of 2 branches missed.">		} else if (usedType == USED_IN_SELECTIONPOPUP) {</span>
<span class="nc" id="L327">			sortColumn = m_context.getUserProperty(WORKPATTERN_SELECTIONPOPUP_SORTCOLUMN);</span>
<span class="nc" id="L328">			sortOrder = m_context.getUserProperty(WORKPATTERN_SELECTIONPOPUP_SORTORDER);</span>
		} else {
<span class="fc" id="L330">			sortColumn = m_context.getUserProperty(WORKPATTERN_LIST_SORTCOLUMN);</span>
<span class="fc" id="L331">			sortOrder = m_context.getUserProperty(WORKPATTERN_LIST_SORTORDER);</span>
		}

<span class="pc bpc" id="L334" title="1 of 2 branches missed.">		if (sortColumn != null) {</span>
<span class="nc" id="L335">			header.setSortColumn(sortColumn);</span>
		}
<span class="pc bpc" id="L337" title="1 of 2 branches missed.">		if (sortOrder != null) {</span>
<span class="nc" id="L338">			header.setSortOrder(sortOrder);</span>
		}
<span class="fc" id="L340">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>