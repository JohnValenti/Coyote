<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>WorkRulesModelHandler.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.verint.web.fs.workrules</a> &gt; <span class="el_source">WorkRulesModelHandler.java</span></div><h1>WorkRulesModelHandler.java</h1><pre class="source lang-java linenums">package com.verint.web.fs.workrules;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.PaginationPair;
import com.bluepumpkin.common.datatypes.Pair;
import com.bluepumpkin.common.datatypes.ScopeID;
import com.bluepumpkin.common.localization.LocaleContext;
import com.bluepumpkin.ejb.bbm.BbmEJBCreateException;
import com.bluepumpkin.ejb.bbm.BbmManagerFactory;
import com.bluepumpkin.ejb.bbm.activity.ejb.ActivityManager;
import com.bluepumpkin.ejb.bbm.activity.model.Activity;
import com.bluepumpkin.ejb.bbm.base.*;
import com.bluepumpkin.ejb.bbm.campaign.ejb.CampaignManager;
import com.bluepumpkin.ejb.bbm.campaign.model.Campaign;
import com.bluepumpkin.ejb.bbm.campaign.model.CampaignWorkResource;
import com.bluepumpkin.ejb.bbm.campaign.model.SchedulingPeriod;
import com.bluepumpkin.ejb.bbm.config.ConfigKey;
import com.bluepumpkin.ejb.bbm.empworkrule.ejb.EmpWorkRuleManager;
import com.bluepumpkin.ejb.bbm.empworkrule.model.*;
import com.bluepumpkin.ejb.bbm.vo.DBSortField;
import com.bluepumpkin.ejb.bbm.workresource.ejb.WorkResourceManager;
import com.bluepumpkin.ejb.bbm.workresource.model.Organization;
import com.bluepumpkin.ejb.bbm.workrules.ejb.WorkRuleManager;
import com.bluepumpkin.ejb.bbm.workrules.ejb.WorkRuleManager.AssignmentRuleValidationError;
import com.bluepumpkin.ejb.bbm.workrules.model.*;
import com.bluepumpkin.ejb.core.CoreManagerFactory;
import com.bluepumpkin.web.core.setup.general.GeneralSetupModelHandler;
import com.verint.ejb.wfm.WfmManagerFactory;
import com.witness.ejb.core.licensing.LicenseKeys;
import com.witness.ejb.core.licensing.ejb.LicenseManager;
import com.witness.web.uif.system.RequestContext;

import java.rmi.RemoteException;
import java.util.*;

// TODO: Auto-generated Javadoc

/**
 * The Class WorkRulesModelHandler.
 */
<span class="nc" id="L41">public class WorkRulesModelHandler {</span>

	/**
	 * Gets the work rule manager.
	 *
	 * @param context the context
	 * @return the work rule manager
	 * @throws BbmException the bbm exception
	 */
	public static WorkRuleManager getWorkRuleManager(RequestContext context) throws BbmException {
<span class="fc" id="L51">		return WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
	}

	//Shift Patterns

	/**
	 * Gets the shift patterns.
	 *
	 * @param context the context
	 * @param ids     the ids
	 * @return the shift patterns
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Collection&lt;ShiftPattern&gt; getShiftPatterns(RequestContext context, Collection&lt;ID&gt; ids) throws BbmFinderException {
		try {
<span class="fc" id="L66">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L67">			return wrm.getShiftPatternsByIDs(ids);</span>
<span class="nc" id="L68">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L69">			throw e;</span>
<span class="nc" id="L70">		} catch (Exception e) {</span>
<span class="nc" id="L71">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Gets the shift patterns by org hierarchy.
	 *
	 * @param context         the context
	 * @param orgID           the org id
	 * @param isAscendingSort the is ascending sort
	 * @param pageIDSize      the page id size
	 * @param pageIndex       the page index
	 * @param sortFieldMap    the sort field map
	 * @param filteredIDs     the filtered i ds
	 * @return the shift patterns by org hierarchy
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static PaginationPair&lt;ShiftPattern&gt; getShiftPatternsByOrgHierarchy(RequestContext context, ID orgID, boolean isAscendingSort, int pageIDSize,
			int pageIndex, LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap, Collection&lt;ID&gt; filteredIDs)
			throws BbmFinderException {
		try {
<span class="nc" id="L92">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L93">			return wrm.getCurrentShiftPatternsByOrgHierarchy(orgID, isAscendingSort, pageIDSize, pageIndex,</span>
					sortFieldMap, filteredIDs);
<span class="nc" id="L95">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L96">			throw e;</span>
<span class="nc" id="L97">		} catch (Exception e) {</span>
<span class="nc" id="L98">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Gets the shift patterns by org hierarchy.
	 *
	 * @param context         the context
	 * @param orgID           the org id
	 * @param isAscendingSort the is ascending sort
	 * @param pageIDSize      the page id size
	 * @param pageIndex       the page index
	 * @param sortFieldMap    the sort field map
	 * @param filteredIDs     the filtered i ds
	 * @param filterByName    the filter by name
	 * @return the shift patterns by org hierarchy
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static PaginationPair&lt;ShiftPattern&gt; getShiftPatternsByOrgHierarchy(RequestContext context, ID orgID, boolean isAscendingSort, int pageIDSize,
			int pageIndex, LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap, Collection&lt;ID&gt; filteredIDs, String filterByName)
			throws BbmFinderException {
		try {
<span class="fc" id="L120">			WorkRuleManager wrm = getWorkRuleManager(context);</span>
<span class="fc" id="L121">			return wrm.getCurrentShiftPatternsByOrgHierarchy(orgID, isAscendingSort, pageIDSize, pageIndex,</span>
					sortFieldMap, filteredIDs, filterByName);
<span class="nc" id="L123">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L124">			throw e;</span>
<span class="nc" id="L125">		} catch (Exception e) {</span>
<span class="nc" id="L126">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Returns the current weekly shift patterns (excluding monthly pattern types) for a given organization and it's hierarchy.
	 *
	 * @param context         {@link com.witness.web.uif.system.RequestContext RequestContext}
	 * @param orgID           Organization ID
	 * @param isAscendingSort Ascending/Descending sort order
	 * @param pageIDSize      Size of pages
	 * @param pageIndex       Page index
	 * @param sortFieldMap    Sorting map of {@link com.bluepumpkin.ejb.bbm.vo.DBSortField DBSortField} and {@link java.util.Comparator Comparator}
	 * @param filteredIDs     Ids to filter
	 * @return {@link com.bluepumpkin.common.datatypes.PaginationPair PaginationPair}
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static PaginationPair&lt;ShiftPattern&gt; getWeeklyShiftPatternsByOrgHierarchy(RequestContext context, ID orgID, boolean isAscendingSort, int pageIDSize,
			int pageIndex, LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap, Collection&lt;ID&gt; filteredIDs)
			throws BbmFinderException {
		try {
<span class="nc" id="L147">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L148">			return wrm.getCurrentWeeklyShiftPatternsByOrgHierarchy(orgID, isAscendingSort, pageIDSize, pageIndex,</span>
					sortFieldMap, filteredIDs);
<span class="nc" id="L150">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L151">			throw e;</span>
<span class="nc" id="L152">		} catch (Exception e) {</span>
<span class="nc" id="L153">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Returns the current weekly shift patterns (excluding monthly pattern types) for a given organization and it's hierarchy.
	 *
	 * @param context         {@link com.witness.web.uif.system.RequestContext RequestContext}
	 * @param orgID           Organization ID
	 * @param isAscendingSort Ascending/Descending sort order
	 * @param pageIDSize      Size of pages
	 * @param pageIndex       Page index
	 * @param sortFieldMap    Sorting map of {@link com.bluepumpkin.ejb.bbm.vo.DBSortField DBSortField} and {@link java.util.Comparator Comparator}
	 * @param filteredIDs     Ids to filter
	 * @param filterByName    to filter (For Find functionality)
	 * @return {@link com.bluepumpkin.common.datatypes.PaginationPair PaginationPair}
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static PaginationPair&lt;ShiftPattern&gt; getWeeklyShiftPatternsByOrgHierarchy(RequestContext context, ID orgID, boolean isAscendingSort, int pageIDSize,
			int pageIndex, LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap, Collection&lt;ID&gt; filteredIDs, String filterByName)
			throws BbmFinderException {
		try {
<span class="nc" id="L175">			WorkRuleManager wrm = getWorkRuleManager(context);</span>
<span class="nc" id="L176">			return wrm.getCurrentWeeklyShiftPatternsByOrgHierarchy(orgID, isAscendingSort, pageIDSize, pageIndex,</span>
					sortFieldMap, filteredIDs, filterByName);
<span class="nc" id="L178">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L179">			throw e;</span>
<span class="nc" id="L180">		} catch (Exception e) {</span>
<span class="nc" id="L181">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Returns the shift patterns defined for a specific organization (excluding hierarchy org scoped items).
	 *
	 * @param context the context
	 * @param orgID   Organization ID
	 * @return Collection collection of shift patterns
	 * @throws BbmFinderException If the organization cannot be found
	 * @see ShiftPattern
	 */
	public static Collection&lt;ShiftPattern&gt; getShiftPatternsByOrg(RequestContext context, ID orgID)
			throws BbmFinderException {
		try {
<span class="nc" id="L197">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L198">			return wrm.getCurrentShiftPatternsByOrg(orgID);</span>
<span class="nc" id="L199">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L200">			throw e;</span>
<span class="nc" id="L201">		} catch (Exception e) {</span>
<span class="nc" id="L202">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Gets the shift patterns by scheduling period.
	 *
	 * @param context         the context
	 * @param sp              the sp
	 * @param isAscendingSort the is ascending sort
	 * @param pageIDSize      the page id size
	 * @param pageIndex       the page index
	 * @param sortFieldMap    the sort field map
	 * @param filteredIDs     the filtered i ds
	 * @return the shift patterns by scheduling period
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static PaginationPair&lt;ShiftPattern&gt; getShiftPatternsBySchedulingPeriod(RequestContext context, SchedulingPeriod sp,
			boolean isAscendingSort, int pageIDSize, int pageIndex,
			LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap, Collection&lt;ID&gt; filteredIDs)
			throws BbmFinderException {
		try {
<span class="nc" id="L224">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L225">			return wrm.getCurrentShiftPatternsBySchedulingPeriod(sp, isAscendingSort, pageIDSize, pageIndex,</span>
					sortFieldMap, filteredIDs);
<span class="nc" id="L227">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L228">			throw e;</span>
<span class="nc" id="L229">		} catch (Exception e) {</span>
<span class="nc" id="L230">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Gets the shift patterns by scheduling period.
	 *
	 * @param context         the context
	 * @param sp              the sp
	 * @param isAscendingSort the is ascending sort
	 * @param pageIDSize      the page id size
	 * @param pageIndex       the page index
	 * @param sortFieldMap    the sort field map
	 * @param filteredIDs     the filtered i ds
	 * @param filterByName    the filter by name
	 * @return the shift patterns by scheduling period
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static PaginationPair&lt;ShiftPattern&gt; getShiftPatternsBySchedulingPeriod(RequestContext context, SchedulingPeriod sp,
			boolean isAscendingSort, int pageIDSize, int pageIndex,
			LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap, Collection&lt;ID&gt; filteredIDs, String filterByName)
			throws BbmFinderException {
		try {
<span class="nc" id="L253">			WorkRuleManager wrm = getWorkRuleManager(context);</span>
<span class="nc" id="L254">			return wrm.getCurrentShiftPatternsBySchedulingPeriod(sp, isAscendingSort, pageIDSize, pageIndex,</span>
					sortFieldMap, filteredIDs, filterByName);
<span class="nc" id="L256">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L257">			throw e;</span>
<span class="nc" id="L258">		} catch (Exception e) {</span>
<span class="nc" id="L259">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Returns the shift patterns for a scheduling period that have been defined in the campaign only (not the organizations that participate).
	 *
	 * @param context Request context
	 * @param sp      Scheduling period
	 * @return Collection of shift patterns
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Collection&lt;ShiftPattern&gt; getShiftPatternsBySchedulingPeriodCampaignOnly(RequestContext context, SchedulingPeriod sp)
			throws BbmFinderException {
		try {
<span class="nc" id="L274">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L275">			return wrm.getCurrentShiftPatternsBySchedulingPeriodCampaignOnly(sp);</span>
<span class="nc" id="L276">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L277">			throw e;</span>
<span class="nc" id="L278">		} catch (Exception e) {</span>
<span class="nc" id="L279">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Gets the available shift patterns for employees.
	 *
	 * @param context                  the context
	 * @param workResourceIDs          the work resource i ds
	 * @param startDate                the start date
	 * @param endDate                  the end date
	 * @param employeeTypeID           the employee type id
	 * @param selectedSchedulingPeriod the selected scheduling period
	 * @param isAscendingSort          the is ascending sort
	 * @param pageIDSize               the page id size
	 * @param pageIndex                the page index
	 * @param sortFieldMap             the sort field map
	 * @param filteredIDs              the filtered i ds
	 * @return the available shift patterns for employees
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static PaginationPair&lt;ShiftPattern&gt; getAvailableShiftPatternsForEmployees(RequestContext context, Collection&lt;ID&gt; workResourceIDs,
			Date startDate, Date endDate, ID employeeTypeID, SchedulingPeriod selectedSchedulingPeriod, boolean isAscendingSort,
			int pageIDSize, int pageIndex, LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap, Collection&lt;ID&gt; filteredIDs)
			throws BbmFinderException {
		try {
<span class="nc" id="L305">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L306">			return wrm.getAvailableShiftPatternsForEmployees(workResourceIDs,</span>
					startDate, endDate, employeeTypeID, selectedSchedulingPeriod, isAscendingSort, pageIDSize,
					pageIndex, sortFieldMap, filteredIDs, null);
<span class="nc" id="L309">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L310">			throw e;</span>
<span class="nc" id="L311">		} catch (Exception e) {</span>
<span class="nc" id="L312">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Gets the available shift patterns for employees.
	 *
	 * @param context                  the context
	 * @param workResourceIDs          the work resource i ds
	 * @param startDate                the start date
	 * @param endDate                  the end date
	 * @param employeeTypeID           the employee type id
	 * @param selectedSchedulingPeriod the selected scheduling period
	 * @param isAscendingSort          the is ascending sort
	 * @param pageIDSize               the page id size
	 * @param pageIndex                the page index
	 * @param sortFieldMap             the sort field map
	 * @param filteredIDs              the filtered i ds
	 * @param filterByName             the filter by name
	 * @return the available shift patterns for employees
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static PaginationPair&lt;ShiftPattern&gt; getAvailableShiftPatternsForEmployees(RequestContext context, Collection&lt;ID&gt; workResourceIDs,
			Date startDate, Date endDate, ID employeeTypeID, SchedulingPeriod selectedSchedulingPeriod, boolean isAscendingSort,
			int pageIDSize, int pageIndex, LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap, Collection&lt;ID&gt; filteredIDs, String filterByName)
			throws BbmFinderException {
		try {
<span class="fc" id="L339">			WorkRuleManager wrm = getWorkRuleManager(context);</span>
<span class="fc" id="L340">			return wrm.getAvailableShiftPatternsForEmployees(workResourceIDs,</span>
					startDate, endDate, employeeTypeID, selectedSchedulingPeriod, isAscendingSort, pageIDSize,
					pageIndex, sortFieldMap, filteredIDs, filterByName);
<span class="nc" id="L343">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L344">			throw e;</span>
<span class="nc" id="L345">		} catch (Exception e) {</span>
<span class="nc" id="L346">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Delete shift patterns.
	 *
	 * @param context         the context
	 * @param shiftPatternIDs the shift pattern i ds
	 * @throws BbmRemoveException the bbm remove exception
	 */
	public static void deleteShiftPatterns(RequestContext context, Collection&lt;ID&gt; shiftPatternIDs) throws BbmRemoveException {
		try {
<span class="nc" id="L359">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L360">			wrm.deleteShiftPatterns(shiftPatternIDs);</span>
<span class="nc" id="L361">		} catch (BbmEJBCreateException e) {</span>
<span class="nc" id="L362">			throw new BbmRemoveException(e);</span>
<span class="nc" id="L363">		} catch (RemoteException e) {</span>
<span class="nc" id="L364">			throw new BbmRemoveException(e);</span>
<span class="nc" id="L365">		}</span>
<span class="nc" id="L366">	}</span>

	/**
	 * Copy shift patterns.
	 *
	 * @param context         the context
	 * @param shiftPatternIDs the shift pattern i ds
	 * @param isOrgMode       the is org mode
	 * @param ownerID         the owner id
	 * @param localeContext   the locale context
	 * @throws BbmException the bbm exception
	 */
	public static void copyShiftPatterns(RequestContext context, Collection&lt;ID&gt; shiftPatternIDs, boolean isOrgMode, ID ownerID,
			LocaleContext localeContext) throws BbmException {
		try {
<span class="nc" id="L381">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L382">			wrm.copyShiftPatterns(shiftPatternIDs, isOrgMode, ownerID, localeContext);</span>
<span class="nc" id="L383">		} catch (RemoteException ex) {</span>
<span class="nc" id="L384">			throw new BbmException(ex);</span>
<span class="nc" id="L385">		}</span>
<span class="nc" id="L386">	}</span>

	/**
	 * Creates the shift pattern.
	 *
	 * @param context      the context
	 * @param shiftPattern the shift pattern
	 * @return the shift pattern
	 * @throws BbmException              the bbm exception
	 * @throws BbmDuplicateNameException the bbm duplicate name exception
	 */
	public static ShiftPattern createShiftPattern(RequestContext context, ShiftPattern shiftPattern) throws BbmException, BbmDuplicateNameException {
		try {
<span class="fc" id="L399">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L400">			return wrm.createShiftPattern(shiftPattern);</span>
<span class="nc" id="L401">		} catch (RemoteException ex) {</span>
<span class="nc" id="L402">			throw new BbmException(ex);</span>
		}
	}

	/**
	 * Update shift patterns.
	 *
	 * @param context       the context
	 * @param shiftPatterns the shift patterns
	 * @throws BbmUpdateException        the bbm update exception
	 * @throws BbmDuplicateNameException the bbm duplicate name exception
	 */
	public static void updateShiftPatterns(RequestContext context, Collection&lt;ShiftPattern&gt; shiftPatterns) throws BbmUpdateException, BbmDuplicateNameException {
		try {
<span class="fc" id="L416">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L417">			wrm.updateShiftPatterns(shiftPatterns);</span>
<span class="nc" id="L418">		} catch (Exception ex) {</span>
<span class="nc bnc" id="L419" title="All 2 branches missed.">			if (ex instanceof BbmUpdateException) {</span>
<span class="nc" id="L420">				throw (BbmUpdateException) ex;</span>
			}
<span class="nc bnc" id="L422" title="All 2 branches missed.">			if (ex instanceof BbmDuplicateNameException) {</span>
<span class="nc" id="L423">				throw (BbmDuplicateNameException) ex;</span>
			} else {
<span class="nc" id="L425">				throw new BbmUpdateException(ex);</span>
			}
<span class="fc" id="L427">		}</span>
<span class="fc" id="L428">	}</span>

	/**
	 * Gets the possible days off shift.
	 *
	 * @param context the context
	 * @return the possible days off shift
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Shift getPossibleDaysOffShift(RequestContext context) throws BbmFinderException {
		try {
<span class="fc" id="L439">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L440">			Collection&lt;Shift&gt; shifts = wrm.getShiftsByIDs(</span>
<span class="fc" id="L441">					Collections.singleton(new ID(ShiftFieldInfo.POSSIBLE_DAYS_OFF_SHIFT_ID)));</span>
<span class="pc bpc" id="L442" title="2 of 4 branches missed.">			if (shifts != null &amp;&amp; !shifts.isEmpty()) {</span>
<span class="fc" id="L443">				return shifts.iterator().next();</span>
			}
<span class="nc" id="L445">			return null;</span>
<span class="nc" id="L446">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L447">			throw e;</span>
<span class="nc" id="L448">		} catch (Exception e) {</span>
<span class="nc" id="L449">			throw new BbmFinderException(e);</span>
		}
	}

	//Shifts

	/**
	 * Gets the shifts by i ds.
	 *
	 * @param context the context
	 * @param ids     the ids
	 * @return the shifts by i ds
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Collection&lt;Shift&gt; getShiftsByIDs(RequestContext context, Collection&lt;ID&gt; ids) throws BbmFinderException {
		try {
<span class="fc" id="L465">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L466">			return wrm.getShiftsByIDs(ids);</span>
<span class="nc" id="L467">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L468">			throw e;</span>
<span class="nc" id="L469">		} catch (Exception e) {</span>
<span class="nc" id="L470">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Returns a shift with the given ID.
	 *
	 * @param context Request context
	 * @param shiftId ID of the shift
	 * @return the shift
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Shift getShift(RequestContext context, ID shiftId) throws BbmFinderException {
		try {
<span class="fc" id="L484">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L485">			return wrm.getShift(shiftId);</span>
<span class="nc" id="L486">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L487">			throw e;</span>
<span class="nc" id="L488">		} catch (Exception e) {</span>
<span class="nc" id="L489">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Gets the shifts by name.
	 *
	 * @param context the context
	 * @param scope   the scope
	 * @param names   the names
	 * @return the shifts by name
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Collection&lt;Shift&gt; getShiftsByName(RequestContext context, ScopeID scope, Collection&lt;String&gt; names) throws BbmFinderException {
		try {
<span class="nc" id="L504">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L505">			return wrm.getShiftsByName(scope, names);</span>
<span class="nc" id="L506">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L507">			throw e;</span>
<span class="nc" id="L508">		} catch (Exception e) {</span>
<span class="nc" id="L509">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Gets the shift names by org.
	 *
	 * @param context the context
	 * @param orgID   the org id
	 * @return the shift names by org
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static HashMap&lt;ID, String&gt; getShiftNamesByOrg(RequestContext context, ID orgID) throws BbmFinderException {
		try {
<span class="fc" id="L523">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L524">			return wrm.getShiftNamesByOrg(orgID);</span>
<span class="nc" id="L525">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L526">			throw e;</span>
<span class="nc" id="L527">		} catch (Exception e) {</span>
<span class="nc" id="L528">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Returns the shift events scoped at an organization keyed by name (no inherited shift events).
	 *
	 * @param context        the context
	 * @param organizationID the organization id
	 * @return the shift events by org
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Map&lt;String, ShiftEvent&gt; getShiftEventsByOrg(RequestContext context, ID organizationID) throws BbmFinderException {
		try {
<span class="nc" id="L542">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L543">			Map&lt;String, ShiftEvent&gt; result = new HashMap&lt;String, ShiftEvent&gt;();</span>
<span class="nc" id="L544">			Collection&lt;ShiftEvent&gt; shiftEvents = wrm.getShiftEventsByOrg(organizationID);</span>
<span class="nc bnc" id="L545" title="All 2 branches missed.">			for (ShiftEvent shiftEvent : shiftEvents) {</span>
<span class="nc" id="L546">				result.put(shiftEvent.getName(), shiftEvent);</span>
<span class="nc" id="L547">			}</span>
<span class="nc" id="L548">			return result;</span>
<span class="nc" id="L549">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L550">			throw e;</span>
<span class="nc" id="L551">		} catch (Exception e) {</span>
<span class="nc" id="L552">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Returns the shift events scoped at an organization keyed by name (no inherited shift events).
	 *
	 * @param context      the context
	 * @param shiftEventID the shift event id
	 * @return the shift event
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static ShiftEvent getShiftEvent(RequestContext context, ID shiftEventID) throws BbmFinderException {
		try {
<span class="nc" id="L566">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L567">			return wrm.getShiftEvent(shiftEventID);</span>
<span class="nc" id="L568">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L569">			throw e;</span>
<span class="nc" id="L570">		} catch (Exception e) {</span>
<span class="nc" id="L571">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Gets the shift names by scheduling period.
	 *
	 * @param context the context
	 * @param sp      the sp
	 * @return the shift names by scheduling period
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static HashMap&lt;ID, String&gt; getShiftNamesBySchedulingPeriod(RequestContext context, SchedulingPeriod sp) throws BbmFinderException {
		try {
<span class="nc" id="L585">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L586">			return wrm.getShiftNamesBySchedulingPeriod(sp);</span>
<span class="nc" id="L587">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L588">			throw e;</span>
<span class="nc" id="L589">		} catch (Exception e) {</span>
<span class="nc" id="L590">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Gets the shift list by org.
	 *
	 * @param context         the context
	 * @param orgID           the org id
	 * @param isAscendingSort the is ascending sort
	 * @param pageIDSize      the page id size
	 * @param pageIndex       the page index
	 * @param sortFieldMap    the sort field map
	 * @param filteredIDs     the filtered i ds
	 * @param filterByName    the filter by name
	 * @return the shift list by org
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static PaginationPair&lt;Shift&gt; getShiftListByOrg(RequestContext context, ID orgID, boolean isAscendingSort, int pageIDSize,
			int pageIndex, LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap, Collection&lt;ID&gt; filteredIDs,
			String filterByName)
			throws BbmFinderException {
		try {
<span class="fc" id="L613">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L614">			return wrm.getCurrentShiftsByOrgHierarchy(orgID, isAscendingSort, pageIDSize, pageIndex, sortFieldMap,</span>
					filteredIDs, filterByName);
<span class="nc" id="L616">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L617">			throw e;</span>
<span class="nc" id="L618">		} catch (Exception e) {</span>
<span class="nc" id="L619">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Returns a map of ID/Name for Shifts in an organization.
	 * @param context	RequestContext
	 * @param orgID		Organization Id
	 * @return map of shift ID/Name
	 * @throws BbmFinderException
	 */
	public static Map&lt;ID, String&gt; getShiftIDNameListByOrg(RequestContext context, ID orgID)
			throws BbmFinderException {
		try {
<span class="fc" id="L633">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L634">			return wrm.getShiftNamesByOrg(orgID);</span>
<span class="nc" id="L635">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L636">			throw e;</span>
<span class="nc" id="L637">		} catch (Exception e) {</span>
<span class="nc" id="L638">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Gets the shift list by scheduling period.
	 *
	 * @param context         the context
	 * @param sp              the sp
	 * @param isAscendingSort the is ascending sort
	 * @param pageIDSize      the page id size
	 * @param pageIndex       the page index
	 * @param sortFieldMap    the sort field map
	 * @param filteredIDs     the filtered i ds
	 * @param filterByName    the filter by name
	 * @return the shift list by scheduling period
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static PaginationPair&lt;Shift&gt; getShiftListBySchedulingPeriod(RequestContext context, SchedulingPeriod sp,
			boolean isAscendingSort, int pageIDSize, int pageIndex,
			LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap, Collection&lt;ID&gt; filteredIDs, String filterByName)
			throws BbmFinderException {
		try {
<span class="nc" id="L661">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L662">			return wrm.getCurrentShiftsBySchedulingPeriod(sp, isAscendingSort, pageIDSize, pageIndex, sortFieldMap,</span>
					filteredIDs, filterByName);
<span class="nc" id="L664">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L665">			throw e;</span>
<span class="nc" id="L666">		} catch (Exception e) {</span>
<span class="nc" id="L667">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Delete shifts.
	 *
	 * @param context  the context
	 * @param shiftIDs the shift i ds
	 * @throws BbmRemoveException the bbm remove exception
	 */
	public static void deleteShifts(RequestContext context, Collection&lt;ID&gt; shiftIDs) throws BbmRemoveException {
		try {
<span class="nc" id="L680">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L681">			wrm.deleteShifts(shiftIDs);</span>
<span class="nc" id="L682">		} catch (BbmEJBCreateException e) {</span>
<span class="nc" id="L683">			throw new BbmRemoveException(e);</span>
<span class="nc" id="L684">		} catch (RemoteException e) {</span>
<span class="nc" id="L685">			throw new BbmRemoveException(e);</span>
<span class="nc" id="L686">		}</span>
<span class="nc" id="L687">	}</span>

	/**
	 * Copy shifts.
	 *
	 * @param context       the context
	 * @param shiftIDs      the shift i ds
	 * @param isOrgMode     the is org mode
	 * @param ownerID       the owner id
	 * @param localeContext the locale context
	 * @throws BbmException the bbm exception
	 */
	public static void copyShifts(RequestContext context, Collection&lt;ID&gt; shiftIDs, boolean isOrgMode, ID ownerID,
			LocaleContext localeContext) throws BbmException {
		try {
<span class="nc" id="L702">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L703">			wrm.copyShifts(shiftIDs, isOrgMode, ownerID, localeContext);</span>
<span class="nc" id="L704">		} catch (RemoteException ex) {</span>
<span class="nc" id="L705">			throw new BbmException(ex);</span>
<span class="nc" id="L706">		}</span>
<span class="nc" id="L707">	}</span>

	/**
	 * Creates the shift.
	 *
	 * @param context the context
	 * @param shift   the shift
	 * @return the shift
	 * @throws BbmException the bbm exception
	 */
	public static Shift createShift(RequestContext context, Shift shift) throws BbmException {
		try {
<span class="fc" id="L719">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L720">			return wrm.createShift(shift);</span>
<span class="nc" id="L721">		} catch (RemoteException ex) {</span>
<span class="nc" id="L722">			throw new BbmException(ex);</span>
		}
	}

	/**
	 * Update shifts.
	 *
	 * @param context the context
	 * @param shifts  the shifts
	 * @throws BbmUpdateException the bbm update exception
	 */
	public static void updateShifts(RequestContext context, Collection&lt;Shift&gt; shifts) throws BbmUpdateException {
		try {
<span class="nc" id="L735">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L736">			wrm.updateShifts(shifts);</span>
<span class="nc" id="L737">		} catch (BbmUpdateException ex) {</span>
<span class="nc" id="L738">			throw ex;</span>
<span class="nc" id="L739">		} catch (Exception ex) {</span>
<span class="nc" id="L740">			throw new BbmUpdateException(ex);</span>
<span class="nc" id="L741">		}</span>
<span class="nc" id="L742">	}</span>

	//Shift Events

	/**
	 * Gets the shift events by org hierarchy.
	 *
	 * @param context         the context
	 * @param orgID           the org id
	 * @param isAscendingSort the is ascending sort
	 * @param pageIDSize      the page id size
	 * @param pageIndex       the page index
	 * @param sortFieldMap    the sort field map
	 * @param filteredIDs     the filtered i ds
	 * @param filterByName    the filter by name
	 * @return the shift events by org hierarchy
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static PaginationPair&lt;ShiftEvent&gt; getShiftEventsByOrgHierarchy(RequestContext context, ID orgID, boolean isAscendingSort,
			int pageIDSize, int pageIndex, LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap,
			Collection&lt;ID&gt; filteredIDs, String filterByName) throws BbmFinderException {
		try {
<span class="fc" id="L764">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L765">			return wrm.getShiftEventsByOrgHierarchy(orgID, isAscendingSort, pageIDSize, pageIndex, sortFieldMap,</span>
					filteredIDs, filterByName);
<span class="nc" id="L767">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L768">			throw e;</span>
<span class="nc" id="L769">		} catch (Exception e) {</span>
<span class="nc" id="L770">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Gets the shift events by scheduling period.
	 *
	 * @param context         the context
	 * @param sp              the sp
	 * @param isAscendingSort the is ascending sort
	 * @param pageIDSize      the page id size
	 * @param pageIndex       the page index
	 * @param sortFieldMap    the sort field map
	 * @param filteredIDs     the filtered i ds
	 * @param filterByName    the filter by name
	 * @return the shift events by scheduling period
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static PaginationPair&lt;ShiftEvent&gt; getShiftEventsBySchedulingPeriod(RequestContext context, SchedulingPeriod sp,
			boolean isAscendingSort, int pageIDSize, int pageIndex,
			LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap, Collection&lt;ID&gt; filteredIDs, String filterByName)
			throws BbmFinderException {
		try {
<span class="nc" id="L793">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L794">			return wrm.getShiftEventsBySchedulingPeriod(sp, isAscendingSort, pageIDSize, pageIndex, sortFieldMap,</span>
					filteredIDs, filterByName);
<span class="nc" id="L796">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L797">			throw e;</span>
<span class="nc" id="L798">		} catch (Exception e) {</span>
<span class="nc" id="L799">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Gets the shift events.
	 *
	 * @param context the context
	 * @param ids     the ids
	 * @return the shift events
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Collection&lt;ShiftEvent&gt; getShiftEvents(RequestContext context, Collection&lt;ID&gt; ids) throws BbmFinderException {
		try {
<span class="fc" id="L813">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L814">			return wrm.getShiftEvents(ids);</span>
<span class="nc" id="L815">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L816">			throw e;</span>
<span class="nc" id="L817">		} catch (Exception e) {</span>
<span class="nc" id="L818">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Creates the shift event.
	 *
	 * @param context    the context
	 * @param shiftEvent the shift event
	 * @return the shift event
	 * @throws BbmException the bbm exception
	 */
	public static ShiftEvent createShiftEvent(RequestContext context, ShiftEvent shiftEvent)
			throws BbmException {
		try {
<span class="fc" id="L833">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L834">			return wrm.createShiftEvent(shiftEvent);</span>
<span class="nc" id="L835">		} catch (RemoteException ex) {</span>
<span class="nc" id="L836">			throw new BbmException(ex);</span>
		}
	}

	/**
	 * Update shift events.
	 *
	 * @param context     the context
	 * @param shiftEvents the shift events
	 * @throws BbmUpdateException the bbm update exception
	 */
	public static void updateShiftEvents(RequestContext context, Collection&lt;ShiftEvent&gt; shiftEvents) throws BbmUpdateException {
		try {
<span class="nc" id="L849">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L850">			wrm.updateShiftEvents(shiftEvents);</span>
<span class="nc" id="L851">		} catch (Exception ex) {</span>
<span class="nc bnc" id="L852" title="All 2 branches missed.">			if (ex instanceof BbmUpdateException) {</span>
<span class="nc" id="L853">				throw (BbmUpdateException) ex;</span>
			} else {
<span class="nc" id="L855">				throw new BbmUpdateException(ex);</span>
			}
<span class="nc" id="L857">		}</span>
<span class="nc" id="L858">	}</span>

	/**
	 * Delete shift events.
	 *
	 * @param context       the context
	 * @param shiftEventIDs the shift event i ds
	 * @throws BbmRemoveException the bbm remove exception
	 */
	public static void deleteShiftEvents(RequestContext context, Collection&lt;ID&gt; shiftEventIDs) throws BbmRemoveException {
		try {
<span class="nc" id="L869">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L870">			wrm.deleteShiftEvents(shiftEventIDs);</span>
<span class="nc" id="L871">		} catch (Exception e) {</span>
<span class="nc" id="L872">			throw new BbmRemoveException(e);</span>
<span class="nc" id="L873">		}</span>
<span class="nc" id="L874">	}</span>

	/**
	 * Copy shift events.
	 *
	 * @param context       the context
	 * @param shiftEventIDs the shift event i ds
	 * @param isOrgMode     the is org mode
	 * @param ownerID       the owner id
	 * @param localeContext the locale context
	 * @throws BbmException the bbm exception
	 */
	public static void copyShiftEvents(RequestContext context, Collection&lt;ID&gt; shiftEventIDs, boolean isOrgMode, ID ownerID,
			LocaleContext localeContext) throws BbmException {
		try {
<span class="nc" id="L889">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L890">			wrm.copyShiftEvents(shiftEventIDs, isOrgMode, ownerID, localeContext);</span>
<span class="nc" id="L891">		} catch (RemoteException ex) {</span>
<span class="nc" id="L892">			throw new BbmException(ex);</span>
<span class="nc" id="L893">		}</span>
<span class="nc" id="L894">	}</span>

	//OT Extensions

	/**
	 * Gets the shift ot extensions by org hierarchy.
	 *
	 * @param context         the context
	 * @param orgID           the org id
	 * @param isAscendingSort the is ascending sort
	 * @param pageIDSize      the page id size
	 * @param pageIndex       the page index
	 * @param sortFieldMap    the sort field map
	 * @param filteredIDs     the filtered i ds
	 * @return the shift ot extensions by org hierarchy
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static PaginationPair&lt;ShiftOTExtension&gt; getShiftOTExtensionsByOrgHierarchy(RequestContext context, ID orgID, boolean isAscendingSort,
			int pageIDSize, int pageIndex, LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap,
			Collection&lt;ID&gt; filteredIDs) throws BbmFinderException {
		try {
<span class="fc" id="L915">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L916">			return wrm.getShiftOTExtensionsByOrgHierarchy(orgID, isAscendingSort, pageIDSize, pageIndex,</span>
					sortFieldMap, filteredIDs);
<span class="nc" id="L918">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L919">			throw e;</span>
<span class="nc" id="L920">		} catch (Exception e) {</span>
<span class="nc" id="L921">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Gets the shift ot extensions by scheduling period.
	 *
	 * @param context         the context
	 * @param sp              the sp
	 * @param isAscendingSort the is ascending sort
	 * @param pageIDSize      the page id size
	 * @param pageIndex       the page index
	 * @param sortFieldMap    the sort field map
	 * @param filteredIDs     the filtered i ds
	 * @return the shift ot extensions by scheduling period
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static PaginationPair&lt;ShiftOTExtension&gt; getShiftOTExtensionsBySchedulingPeriod(RequestContext context, SchedulingPeriod sp,
			boolean isAscendingSort, int pageIDSize, int pageIndex,
			LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap, Collection&lt;ID&gt; filteredIDs)
			throws BbmFinderException {
		try {
<span class="nc" id="L943">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L944">			return wrm.getShiftOTExtensionsBySchedulingPeriod(sp, isAscendingSort, pageIDSize, pageIndex,</span>
					sortFieldMap, filteredIDs);
<span class="nc" id="L946">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L947">			throw e;</span>
<span class="nc" id="L948">		} catch (Exception e) {</span>
<span class="nc" id="L949">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Gets the shift ot extension by id.
	 *
	 * @param context            the context
	 * @param shiftOTExtensionID the shift ot extension id
	 * @return the shift ot extension by id
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static ShiftOTExtension getShiftOTExtensionByID(RequestContext context, ID shiftOTExtensionID) throws BbmFinderException {
		try {
<span class="nc" id="L963">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L964">			return wrm.getShiftOTExtensionByID(shiftOTExtensionID);</span>
<span class="nc" id="L965">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L966">			throw e;</span>
<span class="nc" id="L967">		} catch (Exception e) {</span>
<span class="nc" id="L968">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Gets the shift ot extensions by i ds.
	 *
	 * @param context             the context
	 * @param shiftOTExtensionIDs the shift ot extension i ds
	 * @return the shift ot extensions by i ds
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Collection&lt;ShiftOTExtension&gt; getShiftOTExtensionsByIDs(RequestContext context, Collection&lt;ID&gt; shiftOTExtensionIDs)
			throws BbmFinderException {
		try {
<span class="nc" id="L983">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L984">			return wrm.getShiftOTExtensionsByIDs(shiftOTExtensionIDs);</span>
<span class="nc" id="L985">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L986">			throw e;</span>
<span class="nc" id="L987">		} catch (Exception e) {</span>
<span class="nc" id="L988">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Delete ot extensions.
	 *
	 * @param context        the context
	 * @param otextensionIDs the otextension i ds
	 * @throws BbmRemoveException the bbm remove exception
	 * @throws RemoteException    the remote exception
	 */
	public static void deleteOTExtensions(RequestContext context, Collection&lt;ID&gt; otextensionIDs) throws BbmRemoveException, RemoteException {
		try {
<span class="nc" id="L1002">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1003">			wrm.deleteOTExtensions(otextensionIDs);</span>
<span class="nc" id="L1004">		} catch (BbmEJBCreateException e) {</span>
<span class="nc" id="L1005">			throw new BbmRemoveException(e);</span>
<span class="nc" id="L1006">		} catch (RemoteException e) {</span>
<span class="nc" id="L1007">			throw new BbmRemoveException(e);</span>
<span class="nc" id="L1008">		}</span>
<span class="nc" id="L1009">	}</span>


	/**
	 * Copy ot extensions.
	 *
	 * @param context        the context
	 * @param otextensionIDs the otextension i ds
	 * @param isOrgMode      the is org mode
	 * @param ownerID        the owner id
	 * @param localeContext  the locale context
	 * @throws BbmException the bbm exception
	 */
	public static void copyOTExtensions(RequestContext context, Collection&lt;ID&gt; otextensionIDs, boolean isOrgMode, ID ownerID,
			LocaleContext localeContext) throws BbmException {
		try {
<span class="nc" id="L1025">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1026">			wrm.copyOTExtensions(otextensionIDs, isOrgMode, ownerID, localeContext);</span>
<span class="nc" id="L1027">		} catch (RemoteException ex) {</span>
<span class="nc" id="L1028">			throw new BbmException(ex);</span>
<span class="nc" id="L1029">		}</span>
<span class="nc" id="L1030">	}</span>

	/**
	 * Creates the ot extension.
	 *
	 * @param context     the context
	 * @param otExtension the ot extension
	 * @return the id
	 * @throws BbmException the bbm exception
	 */
	public static ID createOTExtension(RequestContext context, ShiftOTExtension otExtension) throws BbmException {
		try {
<span class="nc" id="L1042">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1043">			return wrm.createOTExtension(otExtension);</span>
<span class="nc" id="L1044">		} catch (RemoteException ex) {</span>
<span class="nc" id="L1045">			throw new BbmException(ex);</span>
		}
	}

	/**
	 * Update ot extensions.
	 *
	 * @param context      the context
	 * @param otExtensions the ot extensions
	 * @throws BbmUpdateException the bbm update exception
	 * @throws RemoteException    the remote exception
	 */
	public static void updateOTExtensions(RequestContext context, Collection&lt;ShiftOTExtension&gt; otExtensions) throws BbmUpdateException, RemoteException {
		try {
<span class="nc" id="L1059">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1060">			wrm.updateOTExtensions(otExtensions);</span>
<span class="nc" id="L1061">		} catch (Exception ex) {</span>
<span class="nc bnc" id="L1062" title="All 2 branches missed.">			if (ex instanceof BbmUpdateException) {</span>
<span class="nc" id="L1063">				throw (BbmUpdateException) ex;</span>
			} else {
<span class="nc" id="L1065">				throw new BbmUpdateException(ex);</span>
			}
<span class="nc" id="L1067">		}</span>
<span class="nc" id="L1068">	}</span>

	/**
	 * Gets the OT extension names by org.
	 *
	 * @param context the context
	 * @param orgID   the org id
	 * @return the OT extension names by org
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static HashMap&lt;ID, String&gt; getOTExtensionNamesByOrg(RequestContext context, ID orgID) throws BbmFinderException {
		try {
<span class="nc" id="L1080">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1081">			return wrm.getOTExtensionNamesByOrg(orgID);</span>
<span class="nc" id="L1082">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1083">			throw e;</span>
<span class="nc" id="L1084">		} catch (Exception e) {</span>
<span class="nc" id="L1085">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Gets the OT extension names by scheduling period.
	 *
	 * @param context the context
	 * @param sp      the sp
	 * @return the OT extension names by scheduling period
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static HashMap&lt;ID, String&gt; getOTExtensionNamesBySchedulingPeriod(RequestContext context, SchedulingPeriod sp) throws BbmFinderException {
		try {
<span class="nc" id="L1099">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1100">			return wrm.getOTExtensionNamesBySchedulingPeriod(sp);</span>
<span class="nc" id="L1101">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1102">			throw e;</span>
<span class="nc" id="L1103">		} catch (Exception e) {</span>
<span class="nc" id="L1104">			throw new BbmFinderException(e);</span>
		}
	}
	//VTO Events

	/**
	 * Gets the VTO events by org hierarchy.
	 *
	 * @param context         the context
	 * @param orgID           the org id
	 * @param isAscendingSort the is ascending sort
	 * @param pageIDSize      the page id size
	 * @param pageIndex       the page index
	 * @param sortFieldMap    the sort field map
	 * @param filteredIDs     the filtered i ds
	 * @return the VTO events by org hierarchy
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static PaginationPair&lt;VTOEvent&gt; getVTOEventsByOrgHierarchy(RequestContext context, ID orgID, boolean isAscendingSort,
			int pageIDSize, int pageIndex, LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap,
			Collection&lt;ID&gt; filteredIDs) throws BbmFinderException {
		try {
<span class="fc" id="L1126">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L1127">			return wrm.getVTOEventsByOrgHierarchy(orgID, isAscendingSort, pageIDSize, pageIndex, sortFieldMap,</span>
					filteredIDs);
<span class="nc" id="L1129">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1130">			throw e;</span>
<span class="nc" id="L1131">		} catch (Exception e) {</span>
<span class="nc" id="L1132">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Gets the VTO events by scheduling period.
	 *
	 * @param context         the context
	 * @param sp              the sp
	 * @param isAscendingSort the is ascending sort
	 * @param pageIDSize      the page id size
	 * @param pageIndex       the page index
	 * @param sortFieldMap    the sort field map
	 * @param filteredIDs     the filtered i ds
	 * @return the VTO events by scheduling period
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static PaginationPair&lt;VTOEvent&gt; getVTOEventsBySchedulingPeriod(RequestContext context, SchedulingPeriod sp,
			boolean isAscendingSort, int pageIDSize, int pageIndex,
			LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap, Collection&lt;ID&gt; filteredIDs)
			throws BbmFinderException {
		try {
<span class="nc" id="L1154">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1155">			return wrm.getVTOEventsBySchedulingPeriod(sp, isAscendingSort, pageIDSize, pageIndex, sortFieldMap,</span>
					filteredIDs);
<span class="nc" id="L1157">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1158">			throw e;</span>
<span class="nc" id="L1159">		} catch (Exception e) {</span>
<span class="nc" id="L1160">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Gets the VTO events by i ds.
	 *
	 * @param context     the context
	 * @param vtoEventIDs the vto event i ds
	 * @return the VTO events by i ds
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Collection&lt;VTOEvent&gt; getVTOEventsByIDs(RequestContext context, Collection&lt;ID&gt; vtoEventIDs)
			throws BbmFinderException {
		try {
<span class="nc" id="L1175">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1176">			return wrm.getVTOEventsByIDs(vtoEventIDs);</span>
<span class="nc" id="L1177">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1178">			throw e;</span>
<span class="nc" id="L1179">		} catch (Exception e) {</span>
<span class="nc" id="L1180">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Gets the VTO event by id.
	 *
	 * @param context    the context
	 * @param vtoEventID the vto event id
	 * @return the VTO event by id
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static VTOEvent getVTOEventByID(RequestContext context, ID vtoEventID)
			throws BbmFinderException {
		try {
<span class="nc" id="L1195">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1196">			return wrm.getVTOEventByID(vtoEventID);</span>
<span class="nc" id="L1197">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1198">			throw e;</span>
<span class="nc" id="L1199">		} catch (Exception e) {</span>
<span class="nc" id="L1200">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Creates the vto event.
	 *
	 * @param context  the context
	 * @param vtoEvent the vto event
	 * @return the id
	 * @throws BbmException the bbm exception
	 */
	public static ID createVTOEvent(RequestContext context, VTOEvent vtoEvent)
			throws BbmException {
		try {
<span class="nc" id="L1215">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1216">			return wrm.createVTOEvent(vtoEvent);</span>
<span class="nc" id="L1217">		} catch (RemoteException ex) {</span>
<span class="nc" id="L1218">			throw new BbmException(ex);</span>
		}
	}

	/**
	 * Update vto events.
	 *
	 * @param context   the context
	 * @param vtoEvents the vto events
	 * @throws BbmUpdateException the bbm update exception
	 */
	public static void updateVTOEvents(RequestContext context, Collection&lt;VTOEvent&gt; vtoEvents) throws BbmUpdateException {
		try {
<span class="nc" id="L1231">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1232">			wrm.updateVTOEvents(vtoEvents);</span>
<span class="nc" id="L1233">		} catch (Exception ex) {</span>
<span class="nc bnc" id="L1234" title="All 2 branches missed.">			if (ex instanceof BbmUpdateException) {</span>
<span class="nc" id="L1235">				throw (BbmUpdateException) ex;</span>
			} else {
<span class="nc" id="L1237">				throw new BbmUpdateException(ex);</span>
			}
<span class="nc" id="L1239">		}</span>
<span class="nc" id="L1240">	}</span>

	/**
	 * Delete vto events.
	 *
	 * @param context     the context
	 * @param vtoEventIDs the vto event i ds
	 * @throws BbmRemoveException the bbm remove exception
	 */
	public static void deleteVTOEvents(RequestContext context, Collection&lt;ID&gt; vtoEventIDs) throws BbmRemoveException {
		try {
<span class="nc" id="L1251">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1252">			wrm.deleteVTOEvents(vtoEventIDs);</span>
<span class="nc" id="L1253">		} catch (Exception e) {</span>
<span class="nc" id="L1254">			throw new BbmRemoveException(e);</span>
<span class="nc" id="L1255">		}</span>
<span class="nc" id="L1256">	}</span>

	/**
	 * Copy vto events.
	 *
	 * @param context       the context
	 * @param vtoEventIDs   the vto event i ds
	 * @param isOrgMode     the is org mode
	 * @param ownerID       the owner id
	 * @param localeContext the locale context
	 * @throws BbmException the bbm exception
	 */
	public static void copyVTOEvents(RequestContext context, Collection&lt;ID&gt; vtoEventIDs, boolean isOrgMode, ID ownerID,
			LocaleContext localeContext) throws BbmException {
		try {
<span class="nc" id="L1271">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1272">			wrm.copyVTOEvents(vtoEventIDs, isOrgMode, ownerID, localeContext);</span>
<span class="nc" id="L1273">		} catch (RemoteException ex) {</span>
<span class="nc" id="L1274">			throw new BbmException(ex);</span>
<span class="nc" id="L1275">		}</span>
<span class="nc" id="L1276">	}</span>

	/**
	 * Gets the VTO names by org.
	 *
	 * @param context the context
	 * @param orgID   the org id
	 * @return the VTO names by org
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static HashMap&lt;ID, String&gt; getVTONamesByOrg(RequestContext context, ID orgID) throws BbmFinderException {
		try {
<span class="nc" id="L1288">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1289">			return wrm.getVTONamesByOrg(orgID);</span>
<span class="nc" id="L1290">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1291">			throw e;</span>
<span class="nc" id="L1292">		} catch (Exception e) {</span>
<span class="nc" id="L1293">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Gets the VTO names by scheduling period.
	 *
	 * @param context the context
	 * @param sp      the sp
	 * @return the VTO names by scheduling period
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static HashMap&lt;ID, String&gt; getVTONamesBySchedulingPeriod(RequestContext context, SchedulingPeriod sp) throws BbmFinderException {
		try {
<span class="nc" id="L1307">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1308">			return wrm.getVTONamesBySchedulingPeriod(sp);</span>
<span class="nc" id="L1309">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1310">			throw e;</span>
<span class="nc" id="L1311">		} catch (Exception e) {</span>
<span class="nc" id="L1312">			throw new BbmFinderException(e);</span>
		}
	}

	//Work Pattern employee assignment

	/**
	 * Gets the work pattern assignments for employees.
	 *
	 * @param context     the context
	 * @param employeeIDs the employee i ds
	 * @param startDate   the start date
	 * @param endDate     the end date
	 * @return the work pattern assignments for employees
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static HashMap&lt;ID, Collection&lt;WorkResourceWorkPattern&gt;&gt; getWorkPatternAssignmentsForEmployees(RequestContext context, Collection&lt;ID&gt; employeeIDs,
			Date startDate, Date endDate) throws BbmFinderException {
		try {
<span class="fc" id="L1331">			EmpWorkRuleManager wrm = WfmManagerFactory.getEmpWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L1332">			return wrm.getWorkPatternAssignments(employeeIDs, startDate, endDate);</span>
<span class="nc" id="L1333">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1334">			throw e;</span>
<span class="nc" id="L1335">		} catch (Exception e) {</span>
<span class="nc" id="L1336">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Gets the work pattern assignments for employee.
	 *
	 * @param context    the context
	 * @param employeeID the employee id
	 * @param startDate  the start date
	 * @param endDate    the end date
	 * @return the work pattern assignments for employee
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Collection&lt;WorkResourceWorkPattern&gt; getWorkPatternAssignmentsForEmployee(RequestContext context, ID employeeID,
			Date startDate, Date endDate) throws BbmFinderException {
		try {
<span class="nc" id="L1353">			EmpWorkRuleManager wrm = WfmManagerFactory.getEmpWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1354">			return wrm.getWorkPatternAssignmentsForEmployee(employeeID, startDate, endDate);</span>
<span class="nc" id="L1355">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1356">			throw e;</span>
<span class="nc" id="L1357">		} catch (Exception e) {</span>
<span class="nc" id="L1358">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * This method will delete the work pattern assignments in assignmentsToDelete, and will
	 * create new assignments for the assignments in assignmentsToCreate.
	 *
	 * @param context             the context
	 * @param assignmentsToDelete the assignments to delete
	 * @param assignmentsToCreate the assignments to create
	 * @throws BbmException the bbm exception
	 */
	public static void saveWorkPatternAssignments(RequestContext context,
			Collection&lt;WorkResourceWorkPattern&gt; assignmentsToDelete,
			Collection&lt;WorkResourceWorkPattern&gt; assignmentsToCreate) throws BbmException {
		try {
<span class="pc bpc" id="L1375" title="3 of 6 branches missed.">			if ((assignmentsToDelete != null &amp;&amp; !assignmentsToDelete.isEmpty()) ||</span>
<span class="pc bpc" id="L1376" title="1 of 2 branches missed.">					(assignmentsToCreate != null &amp;&amp; !assignmentsToCreate.isEmpty())) {</span>
<span class="fc" id="L1377">				EmpWorkRuleManager wrm = WfmManagerFactory.getEmpWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L1378">				wrm.saveWorkPatternAssignments(assignmentsToDelete, assignmentsToCreate);</span>
			}
<span class="nc" id="L1380">		} catch (Exception e) {</span>
<span class="nc" id="L1381">			throw new BbmException(e);</span>
<span class="fc" id="L1382">		}</span>
<span class="fc" id="L1383">	}</span>

	//Work Rule Employee Assignment

	/**
	 * Gets the complex work rule assignments.
	 *
	 * @param context     the context
	 * @param employeeIDs the employee i ds
	 * @return the complex work rule assignments
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static HashMap&lt;ID, Collection&lt;WorkResourceComplexWorkRule&gt;&gt; getComplexWorkRuleAssignments(RequestContext context, Collection&lt;ID&gt; employeeIDs)
			throws BbmFinderException {
		try {
<span class="fc" id="L1398">			EmpWorkRuleManager wrm = WfmManagerFactory.getEmpWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L1399">			return wrm.getComplexWorkRuleAssignments(employeeIDs);</span>
<span class="nc" id="L1400">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1401">			throw e;</span>
<span class="nc" id="L1402">		} catch (Exception e) {</span>
<span class="nc" id="L1403">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Gets the complex work rule assignments by cwri ds.
	 *
	 * @param context            the context
	 * @param complexWorkRuleIDs the complex work rule i ds
	 * @return the complex work rule assignments by cwri ds
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Map&lt;ID, ? extends Collection&lt;WorkResourceComplexWorkRule&gt;&gt; getComplexWorkRuleAssignmentsByCWRIDs(RequestContext context, Collection&lt;ID&gt; complexWorkRuleIDs) throws BbmFinderException {
		try {
<span class="fc" id="L1417">			EmpWorkRuleManager wrm = WfmManagerFactory.getEmpWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L1418">			return wrm.getComplexWorkRuleAssignmentsByCWRIDs(complexWorkRuleIDs);</span>
<span class="nc" id="L1419">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1420">			throw e;</span>
<span class="nc" id="L1421">		} catch (Exception e) {</span>
<span class="nc" id="L1422">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Gets the rotation assignments by rotation i ds.
	 *
	 * @param context     the context
	 * @param rotationIDs the rotation i ds
	 * @return the rotation assignments by rotation i ds
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Map&lt;ID, ? extends Collection&lt;WorkResourceRotation&gt;&gt; getRotationAssignmentsByRotationIDs(RequestContext context, Collection&lt;ID&gt; rotationIDs) throws BbmFinderException {
		try {
<span class="nc" id="L1436">			EmpWorkRuleManager wrm = WfmManagerFactory.getEmpWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1437">			return wrm.getRotationAssignmentsByRotationIDs(rotationIDs);</span>
<span class="nc" id="L1438">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1439">			throw e;</span>
<span class="nc" id="L1440">		} catch (Exception e) {</span>
<span class="nc" id="L1441">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Gets the complex work rules by i ds.
	 *
	 * @param context     the context
	 * @param workRuleIDs the work rule i ds
	 * @return the complex work rules by i ds
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Collection&lt;ComplexWorkRule&gt; getComplexWorkRulesByIDs(RequestContext context, Collection&lt;ID&gt; workRuleIDs)
			throws BbmFinderException {
		try {
<span class="fc" id="L1456">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L1457">			return wrm.getComplexWorkRulesByIDs(workRuleIDs);</span>
<span class="nc" id="L1458">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1459">			throw e;</span>
<span class="nc" id="L1460">		} catch (Exception e) {</span>
<span class="nc" id="L1461">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Gets the available complex work rules for employees.
	 *
	 * @param context         the context
	 * @param workResourceIDs the work resource i ds
	 * @param startDate       the start date
	 * @param endDate         the end date
	 * @param isAscendingSort the is ascending sort
	 * @param pageIDSize      the page id size
	 * @param pageIndex       the page index
	 * @param sortFieldMap    the sort field map
	 * @param filteredIDs     the filtered i ds
	 * @return the available complex work rules for employees
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static PaginationPair&lt;ComplexWorkRule&gt; getAvailableComplexWorkRulesForEmployees(RequestContext context, Collection&lt;ID&gt; workResourceIDs,
			Date startDate, Date endDate, boolean isAscendingSort, int pageIDSize, int pageIndex,
			LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap, Collection&lt;ID&gt; filteredIDs)
			throws BbmFinderException {
		try {
<span class="fc" id="L1485">			EmpWorkRuleManager wrm = WfmManagerFactory.getEmpWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L1486">			return wrm.getAvailableComplexWorkRulesForEmployees(workResourceIDs, startDate, endDate,</span>
					isAscendingSort, pageIDSize, pageIndex, sortFieldMap, filteredIDs);
<span class="nc" id="L1488">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1489">			throw e;</span>
<span class="nc" id="L1490">		} catch (Exception e) {</span>
<span class="nc" id="L1491">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Creates the complex work rule assignments.
	 *
	 * @param context the context
	 * @param wrcwrs  the wrcwrs
	 * @return the collection
	 * @throws BbmException the bbm exception
	 */
	public static Collection&lt;ID&gt; createComplexWorkRuleAssignments(RequestContext context, Collection&lt;WorkResourceComplexWorkRule&gt; wrcwrs)
			throws BbmException {
		try {
<span class="fc" id="L1506">			EmpWorkRuleManager wrm = WfmManagerFactory.getEmpWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L1507">			return wrm.createComplexWorkRuleAssignments(wrcwrs);</span>
<span class="nc" id="L1508">		} catch (Exception e) {</span>
<span class="nc" id="L1509">			throw new BbmException(e);</span>
		}
	}

	/**
	 * Update complex work rule assignments.
	 *
	 * @param context the context
	 * @param wrcwrs  the wrcwrs
	 * @throws BbmUpdateException the bbm update exception
	 */
	public static void updateComplexWorkRuleAssignments(RequestContext context, Collection&lt;WorkResourceComplexWorkRule&gt; wrcwrs)
			throws BbmUpdateException {
		try {
<span class="nc" id="L1523">			EmpWorkRuleManager wrm = WfmManagerFactory.getEmpWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1524">			wrm.updateComplexWorkRuleAssignments(wrcwrs);</span>
<span class="nc" id="L1525">		} catch (Exception ex) {</span>
<span class="nc bnc" id="L1526" title="All 2 branches missed.">			if (ex instanceof BbmUpdateException) {</span>
<span class="nc" id="L1527">				throw (BbmUpdateException) ex;</span>
			} else {
<span class="nc" id="L1529">				throw new BbmUpdateException(ex);</span>
			}
<span class="nc" id="L1531">		}</span>
<span class="nc" id="L1532">	}</span>

	/**
	 * Delete complex work rule assignments.
	 *
	 * @param context                        the context
	 * @param workResourceComplexWorkRuleIDs the work resource complex work rule i ds
	 * @throws BbmRemoveException the bbm remove exception
	 */
	public static void deleteComplexWorkRuleAssignments(RequestContext context, Collection&lt;ID&gt; workResourceComplexWorkRuleIDs)
			throws BbmRemoveException {
		try {
<span class="nc" id="L1544">			EmpWorkRuleManager wrm = WfmManagerFactory.getEmpWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1545">			wrm.deleteComplexWorkRuleAssignments(workResourceComplexWorkRuleIDs);</span>
<span class="nc" id="L1546">		} catch (Exception e) {</span>
<span class="nc" id="L1547">			throw new BbmRemoveException(e);</span>
<span class="nc" id="L1548">		}</span>
<span class="nc" id="L1549">	}</span>

	//Rotation employee assignment

	/**
	 * Gets the rotations by i ds.
	 *
	 * @param context     the context
	 * @param rotationIDs the rotation i ds
	 * @return the rotations by i ds
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Collection&lt;Rotation&gt; getRotationsByIDs(RequestContext context, Collection&lt;ID&gt; rotationIDs)
			throws BbmFinderException {
		try {
<span class="nc" id="L1564">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1565">			return wrm.getRotationsByIDs(rotationIDs);</span>
<span class="nc" id="L1566">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1567">			throw e;</span>
<span class="nc" id="L1568">		} catch (Exception e) {</span>
<span class="nc" id="L1569">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Gets the rotation assignments.
	 *
	 * @param context     the context
	 * @param employeeIDs the employee i ds
	 * @return the rotation assignments
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static HashMap&lt;ID, Collection&lt;WorkResourceRotation&gt;&gt; getRotationAssignments(RequestContext context, Collection&lt;ID&gt; employeeIDs)
			throws BbmFinderException {
		try {
<span class="fc" id="L1584">			EmpWorkRuleManager wrm = WfmManagerFactory.getEmpWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L1585">			return wrm.getRotationAssignments(employeeIDs);</span>
<span class="nc" id="L1586">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1587">			throw e;</span>
<span class="nc" id="L1588">		} catch (Exception e) {</span>
<span class="nc" id="L1589">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Return the work rules associated to the filtered org set - all common orgs or common parent orgs
	 * that also have the same start week offset as the employee's orgs.
	 *
	 * @param context         the context
	 * @param workResourceIDs the work resource i ds
	 * @param startDate       the start date
	 * @param endDate         the end date
	 * @param isAscendingSort the is ascending sort
	 * @param pageIDSize      the page id size
	 * @param pageIndex       the page index
	 * @param sortFieldMap    the sort field map
	 * @param filteredIDs     the filtered i ds
	 * @return the available rotations for employees
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static PaginationPair&lt;Rotation&gt; getAvailableRotationsForEmployees(RequestContext context, Collection&lt;ID&gt; workResourceIDs,
			Date startDate, Date endDate, boolean isAscendingSort, int pageIDSize, int pageIndex,
			LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap, Collection&lt;ID&gt; filteredIDs)
			throws BbmFinderException {
		try {
<span class="nc" id="L1614">			EmpWorkRuleManager wrm = WfmManagerFactory.getEmpWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1615">			return wrm.getAvailableRotationsForEmployees(workResourceIDs, startDate, endDate, isAscendingSort, pageIDSize,</span>
					pageIndex, sortFieldMap, filteredIDs);
<span class="nc" id="L1617">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1618">			throw e;</span>
<span class="nc" id="L1619">		} catch (Exception e) {</span>
<span class="nc" id="L1620">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Return the work rules associated to the filtered org set - all common orgs or common parent orgs
	 * that also have the same start week offset as the employee's orgs.
	 *
	 * @param context         the context
	 * @param workResourceIDs the work resource i ds
	 * @param startDate       the start date
	 * @param endDate         the end date
	 * @param isAscendingSort the is ascending sort
	 * @param pageIDSize      the page id size
	 * @param pageIndex       the page index
	 * @param sortFieldMap    the sort field map
	 * @param filteredIDs     the filtered i ds
	 * @param filterByName    the filter by name
	 * @return the available rotations for employees
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static PaginationPair&lt;Rotation&gt; getAvailableRotationsForEmployees(RequestContext context, Collection&lt;ID&gt; workResourceIDs,
			Date startDate, Date endDate, boolean isAscendingSort, int pageIDSize, int pageIndex,
			LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap, Collection&lt;ID&gt; filteredIDs, String filterByName)
			throws BbmFinderException {
		try {
<span class="nc" id="L1646">			EmpWorkRuleManager wrm = WfmManagerFactory.getEmpWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1647">			return wrm.getAvailableRotationsForEmployees(workResourceIDs, startDate, endDate, isAscendingSort, pageIDSize,</span>
					pageIndex, sortFieldMap, filteredIDs, filterByName);
<span class="nc" id="L1649">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1650">			throw e;</span>
<span class="nc" id="L1651">		} catch (Exception e) {</span>
<span class="nc" id="L1652">			throw new BbmFinderException(e);</span>
		}

	}

	/**
	 * Creates the rotation assignments.
	 *
	 * @param context             the context
	 * @param rotationAssignments the rotation assignments
	 * @return the collection
	 * @throws BbmException the bbm exception
	 */
	public static Collection&lt;ID&gt; createRotationAssignments(RequestContext context, Collection&lt;WorkResourceRotation&gt; rotationAssignments)
			throws BbmException {
		try {
<span class="nc" id="L1668">			EmpWorkRuleManager wrm = WfmManagerFactory.getEmpWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1669">			return wrm.createRotationAssignments(rotationAssignments);</span>
<span class="nc" id="L1670">		} catch (Exception e) {</span>
<span class="nc" id="L1671">			throw new BbmException(e);</span>
		}
	}

	/**
	 * Update rotation assignments.
	 *
	 * @param context             the context
	 * @param rotationAssignments the rotation assignments
	 * @throws BbmUpdateException the bbm update exception
	 */
	public static void updateRotationAssignments(RequestContext context, Collection&lt;WorkResourceRotation&gt; rotationAssignments)
			throws BbmUpdateException {
		try {
<span class="nc" id="L1685">			EmpWorkRuleManager wrm = WfmManagerFactory.getEmpWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1686">			wrm.updateRotationAssignments(rotationAssignments);</span>
<span class="nc" id="L1687">		} catch (Exception ex) {</span>
<span class="nc bnc" id="L1688" title="All 2 branches missed.">			if (ex instanceof BbmUpdateException) {</span>
<span class="nc" id="L1689">				throw (BbmUpdateException) ex;</span>
			} else {
<span class="nc" id="L1691">				throw new BbmUpdateException(ex);</span>
			}
<span class="nc" id="L1693">		}</span>
<span class="nc" id="L1694">	}</span>

	/**
	 * Delete rotation assignments.
	 *
	 * @param context               the context
	 * @param rotationAssignmentIDs the rotation assignment i ds
	 * @throws BbmRemoveException the bbm remove exception
	 */
	public static void deleteRotationAssignments(RequestContext context, Collection&lt;ID&gt; rotationAssignmentIDs) throws BbmRemoveException {
		try {
<span class="nc" id="L1705">			EmpWorkRuleManager wrm = WfmManagerFactory.getEmpWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1706">			wrm.deleteRotationAssignments(rotationAssignmentIDs);</span>
<span class="nc" id="L1707">		} catch (Exception e) {</span>
<span class="nc" id="L1708">			throw new BbmRemoveException(e);</span>
<span class="nc" id="L1709">		}</span>
<span class="nc" id="L1710">	}</span>

	/**
	 * Delete rotations.
	 *
	 * @param context     the context
	 * @param rotationIDs the rotation i ds
	 * @throws BbmRemoveException the bbm remove exception
	 */
	public static void deleteRotations(RequestContext context, Collection&lt;ID&gt; rotationIDs) throws BbmRemoveException {
		try {
<span class="nc" id="L1721">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1722">			wrm.deleteRotations(rotationIDs);</span>
<span class="nc" id="L1723">		} catch (Exception e) {</span>
<span class="nc bnc" id="L1724" title="All 2 branches missed.">			if (e instanceof BbmRemoveException) {</span>
<span class="nc" id="L1725">				throw (BbmRemoveException) e;</span>
			}
<span class="nc" id="L1727">			throw new BbmRemoveException(e);</span>
<span class="nc" id="L1728">		}</span>
<span class="nc" id="L1729">	}</span>

	/**
	 * Copy rotations to org.
	 *
	 * @param context       the context
	 * @param rotationIDs   the rotation i ds
	 * @param orgID         the org id
	 * @param localeContext the locale context
	 * @throws BbmCreateException the bbm create exception
	 */
	public static void copyRotationsToOrg(RequestContext context, Collection&lt;ID&gt; rotationIDs, ID orgID, LocaleContext localeContext) throws BbmCreateException {
		try {
<span class="nc" id="L1742">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1743">			wrm.copyRotationsToOrg(rotationIDs, orgID, localeContext);</span>
<span class="nc" id="L1744">		} catch (Exception e) {</span>
<span class="nc bnc" id="L1745" title="All 2 branches missed.">			if (e instanceof BbmCreateException) {</span>
<span class="nc" id="L1746">				throw (BbmCreateException) e;</span>
			} else {
<span class="nc" id="L1748">				throw new BbmCreateException(e);</span>
			}
<span class="nc" id="L1750">		}</span>
<span class="nc" id="L1751">	}</span>

	/**
	 * Gets the time bank assignments.
	 *
	 * @param context     the context
	 * @param employeeIDs the employee i ds
	 * @param startDate   the start date
	 * @param endDate     the end date
	 * @return the time bank assignments
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static HashMap&lt;ID, Collection&lt;EmpTimeBank&gt;&gt; getTimeBankAssignments(RequestContext context,
			Collection&lt;ID&gt; employeeIDs, Date startDate, Date endDate) throws BbmFinderException {
		try {
<span class="fc" id="L1766">			EmpWorkRuleManager wrm = WfmManagerFactory.getEmpWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L1767">			return wrm.getTimeBankAssignments(employeeIDs, startDate, endDate);</span>
<span class="nc" id="L1768">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1769">			throw e;</span>
<span class="nc" id="L1770">		} catch (Exception e) {</span>
<span class="nc" id="L1771">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Gets the time banks by i ds.
	 *
	 * @param context     the context
	 * @param timeBankIDs the time bank i ds
	 * @return the time banks by i ds
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Collection&lt;TimeBank&gt; getTimeBanksByIDs(RequestContext context,
			Collection&lt;ID&gt; timeBankIDs) throws BbmFinderException {
		try {
<span class="fc" id="L1786">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L1787">			return wrm.getTimeBanks(timeBankIDs);</span>
<span class="nc" id="L1788">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1789">			throw e;</span>
<span class="nc" id="L1790">		} catch (Exception e) {</span>
<span class="nc" id="L1791">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Returns a collection of PaginationPair objects with TimeBank data (used for pagination).
	 * The time banks returned will be the time banks that are available to be assigned to ALL of the given employees (workResourceIDs)
	 * for the date range between startDate and endDate.  This is used when adding new time bank assignments to employees.
	 *
	 * @param context         the context
	 * @param workResourceIDs the work resource i ds
	 * @param startDate       the start date
	 * @param endDate         the end date
	 * @param isAscendingSort the is ascending sort
	 * @param pageIDSize      the page id size
	 * @param pageIndex       the page index
	 * @param sortFieldMap    the sort field map
	 * @param filteredIDs     the filtered i ds
	 * @return the available time banks for employees
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static PaginationPair&lt;TimeBank&gt; getAvailableTimeBanksForEmployees(RequestContext context, Collection&lt;ID&gt; workResourceIDs,
			Date startDate, Date endDate, boolean isAscendingSort, int pageIDSize, int pageIndex,
			LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap, Collection&lt;ID&gt; filteredIDs)
			throws BbmFinderException {
		try {
<span class="nc" id="L1817">			EmpWorkRuleManager wrm = WfmManagerFactory.getEmpWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1818">			return wrm.getAvailableTimeBanksForEmployees(workResourceIDs, startDate, endDate, isAscendingSort,</span>
					pageIDSize, pageIndex, sortFieldMap, filteredIDs);
<span class="nc" id="L1820">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1821">			throw e;</span>
<span class="nc" id="L1822">		} catch (Exception e) {</span>
<span class="nc" id="L1823">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Creates the time bank assignments.
	 *
	 * @param context             the context
	 * @param timeBankAssignments the time bank assignments
	 * @return the collection
	 * @throws BbmException the bbm exception
	 */
	public static Collection&lt;ID&gt; createTimeBankAssignments(RequestContext context, Collection&lt;EmpTimeBank&gt; timeBankAssignments)
			throws BbmException {
		try {
<span class="nc" id="L1838">			EmpWorkRuleManager wrm = WfmManagerFactory.getEmpWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1839">			Collection&lt;ID&gt; retVal = new ArrayList&lt;ID&gt;();</span>
<span class="nc bnc" id="L1840" title="All 2 branches missed.">			for (EmpTimeBank etb : timeBankAssignments) {</span>
<span class="nc" id="L1841">				retVal.add(wrm.createTimeBankAssignmentWithNoOverlap(etb));</span>
<span class="nc" id="L1842">			}</span>
<span class="nc" id="L1843">			return retVal;</span>
<span class="nc" id="L1844">		} catch (Exception e) {</span>
<span class="nc" id="L1845">			throw new BbmException(e);</span>
		}
	}

	/**
	 * Delete time bank assignments.
	 *
	 * @param context               the context
	 * @param timeBankAssignmentIDs the time bank assignment i ds
	 * @throws BbmRemoveException the bbm remove exception
	 */
	public static void deleteTimeBankAssignments(RequestContext context, Collection&lt;ID&gt; timeBankAssignmentIDs) throws BbmRemoveException {
		try {
<span class="nc" id="L1858">			EmpWorkRuleManager wrm = WfmManagerFactory.getEmpWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1859">			wrm.deleteTimeBankAssignments(timeBankAssignmentIDs);</span>
<span class="nc" id="L1860">		} catch (Exception e) {</span>
<span class="nc" id="L1861">			throw new BbmRemoveException(e);</span>
<span class="nc" id="L1862">		}</span>
<span class="nc" id="L1863">	}</span>

	/**
	 * Gets the org i ds linked to sp.
	 *
	 * @param context the context
	 * @param spID    the sp id
	 * @return the org i ds linked to sp
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Collection&lt;ID&gt; getOrgIDsLinkedToSP(RequestContext context, ID spID) throws BbmFinderException {
		try {
<span class="nc" id="L1875">			CampaignManager cm = WfmManagerFactory.getCampaignManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1876">			return cm.getLinkedOrgsforSP(spID);</span>
<span class="nc" id="L1877">		} catch (Exception e) {</span>
<span class="nc" id="L1878">			throw new BbmFinderException(e);</span>
		}
	}

	// -- Utility Methods -- //

	/**
	 * Gets the activities.
	 *
	 * @param context     the context
	 * @param activityIDs the activity i ds
	 * @return the activities
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Map&lt;ID, Activity&gt; getActivities(RequestContext context, Collection&lt;ID&gt; activityIDs) throws BbmFinderException {
		try {
<span class="fc" id="L1894">			ActivityManager am = WfmManagerFactory.getActivityManager(context.isInWhatIfMode());</span>
<span class="fc" id="L1895">			Map&lt;ID, Activity&gt; activityMap = new HashMap&lt;ID, Activity&gt;();</span>
<span class="fc" id="L1896">			Collection&lt;Activity&gt; activities = am.findActivities(activityIDs);</span>
<span class="fc bfc" id="L1897" title="All 2 branches covered.">			for (Activity a : activities) {</span>
<span class="fc" id="L1898">				activityMap.put(a.getID(), a);</span>
<span class="fc" id="L1899">			}</span>
<span class="fc" id="L1900">			return activityMap;</span>
<span class="nc" id="L1901">		} catch (BbmEJBCreateException e) {</span>
<span class="nc" id="L1902">			throw new BbmFinderException(e);</span>
<span class="nc" id="L1903">		} catch (RemoteException e) {</span>
<span class="nc" id="L1904">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Gets the organization activities.
	 *
	 * @param context         the context
	 * @param organizationIds the organization ids
	 * @return the organization activities
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Map&lt;ID, Activity&gt; getOrganizationActivities(RequestContext context, Collection&lt;ID&gt; organizationIds) throws BbmFinderException {
		try {
<span class="nc" id="L1918">			ActivityManager am = WfmManagerFactory.getActivityManager(context.isInWhatIfMode());</span>
<span class="nc" id="L1919">			Map&lt;ID, Activity&gt; activityMap = new HashMap&lt;ID, Activity&gt;();</span>
<span class="nc" id="L1920">			Collection&lt;Activity&gt; activities = am.findOrganizationActivities(organizationIds, true);</span>
<span class="nc bnc" id="L1921" title="All 2 branches missed.">			for (Activity a : activities) {</span>
<span class="nc" id="L1922">				activityMap.put(a.getID(), a);</span>
<span class="nc" id="L1923">			}</span>
<span class="nc" id="L1924">			return activityMap;</span>
<span class="nc" id="L1925">		} catch (BbmEJBCreateException e) {</span>
<span class="nc" id="L1926">			throw new BbmFinderException(e);</span>
<span class="nc" id="L1927">		} catch (RemoteException e) {</span>
<span class="nc" id="L1928">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Returns a map of organizations keyed on their IDs.
	 *
	 * @param context the context
	 * @param orgIDs  the org i ds
	 * @return the orgs
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Map&lt;ID, Organization&gt; getOrgs(RequestContext context, Collection&lt;ID&gt; orgIDs) throws BbmFinderException {
		try {
<span class="fc" id="L1942">			WorkResourceManager wrm = BbmManagerFactory.getWorkResourceManager(context.isInWhatIfMode());</span>
<span class="fc" id="L1943">			Map&lt;ID, Organization&gt; orgMap = new HashMap&lt;ID, Organization&gt;();</span>
<span class="fc" id="L1944">			Collection&lt;Organization&gt; orgs = wrm.getOrganizationsByIDs(orgIDs);</span>
<span class="fc bfc" id="L1945" title="All 2 branches covered.">			for (Organization org : orgs) {</span>
<span class="fc" id="L1946">				orgMap.put(org.getID(), org);</span>
<span class="fc" id="L1947">			}</span>
<span class="fc" id="L1948">			return orgMap;</span>
<span class="nc" id="L1949">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1950">			throw e;</span>
<span class="nc" id="L1951">		} catch (Exception e) {</span>
<span class="nc" id="L1952">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Takes a collection of campaign IDs, returns a map of Campaign IDs -&gt; Campaigns.
	 *
	 * @param context     the context
	 * @param campaignIDs the campaign i ds
	 * @return Map of Campaign IDs -&gt; Campaigns
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Map&lt;ID, Campaign&gt; getCampaigns(RequestContext context, Collection&lt;ID&gt; campaignIDs) throws BbmFinderException {
		try {
<span class="fc" id="L1966">			CampaignManager cm = WfmManagerFactory.getCampaignManager(context.isInWhatIfMode());</span>
<span class="fc" id="L1967">			Map&lt;ID, Campaign&gt; cMap = new HashMap&lt;ID, Campaign&gt;();</span>
<span class="fc" id="L1968">			Collection&lt;Campaign&gt; campaigns = cm.getCampaignsByIDs(campaignIDs);</span>
<span class="pc bpc" id="L1969" title="1 of 2 branches missed.">			for (Campaign c : campaigns) {</span>
<span class="nc" id="L1970">				cMap.put(c.getID(), c);</span>
<span class="nc" id="L1971">			}</span>
<span class="fc" id="L1972">			return cMap;</span>
<span class="nc" id="L1973">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L1974">			throw e;</span>
<span class="nc" id="L1975">		} catch (Exception e) {</span>
<span class="nc" id="L1976">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Returns the resources that are linked to the given campaign over the given time period.  Because employees are not literally linked
	 * to the campaign, this returns the employees that are linked to the SPs in the given campaign that span the given time period.
	 * If the campaign is a distributed campaign, this method will also return the employees that are linked in the sub campaigns.
	 *
	 * @param context    the context
	 * @param campaignID the campaign id
	 * @param startDate  the start date
	 * @param endDate    the end date
	 * @return the campaign work resource assignments
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Collection&lt;CampaignWorkResource&gt; getCampaignWorkResourceAssignments(RequestContext context, ID campaignID, Date startDate, Date endDate) throws BbmFinderException {
		try {
<span class="fc" id="L1994">			List&lt;CampaignWorkResource&gt; retVal = new ArrayList&lt;CampaignWorkResource&gt;();</span>
<span class="fc" id="L1995">			CampaignManager cm = WfmManagerFactory.getCampaignManager(context.isInWhatIfMode());</span>

			//If a distributed campaign ID was handed in, we need to also retrieve the work resource assignments for the sub campaigns
<span class="fc" id="L1998">			Collection&lt;ID&gt; campaignIDs = cm.getSubCampaignIDs(campaignID);</span>
<span class="pc bpc" id="L1999" title="1 of 2 branches missed.">			if (campaignIDs == null) {</span>
<span class="nc" id="L2000">				campaignIDs = new ArrayList&lt;ID&gt;();</span>
			}
<span class="fc" id="L2002">			campaignIDs.add(campaignID);</span>

<span class="fc bfc" id="L2004" title="All 2 branches covered.">			for (ID id : campaignIDs) {</span>
<span class="fc" id="L2005">				Collection&lt;CampaignWorkResource&gt; assignments = cm.getCampaignWorkResourceAssignments(id, startDate, endDate);</span>
<span class="pc bpc" id="L2006" title="1 of 2 branches missed.">				if (assignments != null) {</span>
<span class="fc" id="L2007">					retVal.addAll(assignments);</span>
				}
<span class="fc" id="L2009">			}</span>

<span class="fc" id="L2011">			return retVal;</span>
<span class="nc" id="L2012">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L2013">			throw e;</span>
<span class="nc" id="L2014">		} catch (Exception e) {</span>
<span class="nc" id="L2015">			throw new BbmFinderException(e);</span>
		}
	}
	//Projects

	/**
	 * Gets the project rules list by org.
	 *
	 * @param context         the context
	 * @param orgID           the org id
	 * @param isAscendingSort the is ascending sort
	 * @param pageIDSize      the page id size
	 * @param pageIndex       the page index
	 * @param sortFieldMap    the sort field map
	 * @param filteredIDs     the filtered i ds
	 * @param filterByName    the filter by name
	 * @return the project rules list by org
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static PaginationPair&lt;ProjectRules&gt; getProjectRulesListByOrg(RequestContext context, ID orgID, boolean isAscendingSort, int pageIDSize,
			int pageIndex, LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap, Collection&lt;ID&gt; filteredIDs,
			String filterByName)
			throws BbmFinderException {
		try {
<span class="nc" id="L2039">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L2040">			return wrm.getProjectRulesByOrgHierarchy(orgID, isAscendingSort, pageIDSize, pageIndex, sortFieldMap,</span>
					filteredIDs, filterByName);
<span class="nc" id="L2042">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L2043">			throw e;</span>
<span class="nc" id="L2044">		} catch (Exception e) {</span>
<span class="nc" id="L2045">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Gets the project list by scheduling period.
	 *
	 * @param context         the context
	 * @param sp              the sp
	 * @param isAscendingSort the is ascending sort
	 * @param pageIDSize      the page id size
	 * @param pageIndex       the page index
	 * @param sortFieldMap    the sort field map
	 * @param filteredIDs     the filtered i ds
	 * @param filterByName    the filter by name
	 * @return the project list by scheduling period
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static PaginationPair&lt;ProjectRules&gt; getProjectListBySchedulingPeriod(RequestContext context, SchedulingPeriod sp,
			boolean isAscendingSort, int pageIDSize, int pageIndex,
			LinkedHashMap&lt;DBSortField, Comparator&gt; sortFieldMap, Collection&lt;ID&gt; filteredIDs, String filterByName)
			throws BbmFinderException {
		try {
<span class="nc" id="L2068">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L2069">			return wrm.getCurrentProjectsBySchedulingPeriod(sp, isAscendingSort, pageIDSize, pageIndex, sortFieldMap,</span>
					filteredIDs, filterByName);
<span class="nc" id="L2071">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L2072">			throw e;</span>
<span class="nc" id="L2073">		} catch (Exception e) {</span>
<span class="nc" id="L2074">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Delete project rules.
	 *
	 * @param context        the context
	 * @param projectRuleIDs the project rule i ds
	 * @throws BbmRemoveException the bbm remove exception
	 */
	public static void deleteProjectRules(RequestContext context, Collection&lt;ID&gt; projectRuleIDs) throws BbmRemoveException {
		try {
<span class="nc" id="L2087">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L2088">			wrm.deleteProjects(projectRuleIDs);</span>
<span class="nc" id="L2089">		} catch (BbmEJBCreateException e) {</span>
<span class="nc" id="L2090">			throw new BbmRemoveException(e);</span>
<span class="nc" id="L2091">		} catch (RemoteException e) {</span>
<span class="nc" id="L2092">			throw new BbmRemoveException(e);</span>
<span class="nc" id="L2093">		}</span>
<span class="nc" id="L2094">	}</span>

	/**
	 * Creates the project.
	 *
	 * @param context  the context
	 * @param projRule the proj rule
	 * @return the id
	 * @throws BbmException the bbm exception
	 */
	public static ID createProject(RequestContext context, ProjectRules projRule) throws BbmException {
		try {
<span class="nc" id="L2106">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L2107">			return wrm.createProjectRule(projRule);</span>
<span class="nc" id="L2108">		} catch (RemoteException ex) {</span>
<span class="nc" id="L2109">			throw new BbmException(ex);</span>
		}
	}

	/**
	 * Update projects.
	 *
	 * @param context  the context
	 * @param projRule the proj rule
	 * @throws BbmUpdateException the bbm update exception
	 */
	public static void updateProjects(RequestContext context, Collection&lt;ProjectRules&gt; projRule) throws BbmUpdateException {
		try {
<span class="nc" id="L2122">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L2123">			wrm.updateProjectRule(projRule);</span>
<span class="nc" id="L2124">		} catch (BbmUpdateException e) {</span>
<span class="nc" id="L2125">			throw e;</span>
<span class="nc" id="L2126">		} catch (Exception ex) {</span>
<span class="nc" id="L2127">			throw new BbmUpdateException(ex);</span>
<span class="nc" id="L2128">		}</span>
<span class="nc" id="L2129">	}</span>

	/**
	 * Copy projects.
	 *
	 * @param context       the context
	 * @param shiftIDs      the shift i ds
	 * @param isOrgMode     the is org mode
	 * @param ownerID       the owner id
	 * @param localeContext the locale context
	 * @throws BbmException the bbm exception
	 */
	public static void copyProjects(RequestContext context, Collection&lt;ID&gt; shiftIDs, boolean isOrgMode, ID ownerID,
			LocaleContext localeContext) throws BbmException {
		try {
<span class="nc" id="L2144">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L2145">			wrm.copyProjects(shiftIDs, isOrgMode, ownerID, localeContext);</span>
<span class="nc" id="L2146">		} catch (RemoteException ex) {</span>
<span class="nc" id="L2147">			throw new BbmException(ex);</span>
<span class="nc" id="L2148">		}</span>
<span class="nc" id="L2149">	}</span>


	/**
	 * Gets the project rules by id.
	 *
	 * @param context the context
	 * @param ids     the ids
	 * @return the project rules by id
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Collection&lt;ProjectRules&gt; getProjectRulesByID(RequestContext context, Collection&lt;ID&gt; ids) throws BbmFinderException {
		try {
<span class="nc" id="L2162">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L2163">			return wrm.getProjectRulesByID(ids);</span>
<span class="nc" id="L2164">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L2165">			throw e;</span>
<span class="nc" id="L2166">		} catch (Exception e) {</span>
<span class="nc" id="L2167">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Returns the currently active shifts for an organization (no hierarchy inherited items).
	 *
	 * @param context the context
	 * @param orgID   the org id
	 * @return the current shifts by org
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Collection&lt;Shift&gt; getCurrentShiftsByOrg(RequestContext context, ID orgID) throws BbmFinderException {
		try {
<span class="nc" id="L2181">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L2182">			return wrm.getCurrentShiftsByOrg(orgID);</span>
<span class="nc" id="L2183">		} catch (BbmFinderException ex) {</span>
<span class="nc" id="L2184">			throw ex;</span>
<span class="nc" id="L2185">		} catch (Exception ex) {</span>
<span class="nc" id="L2186">			throw new BbmFinderException(ex);</span>
		}
	}

	/**
	 * Returns the currently active shifts for an organization hierarchy.
	 *
	 * @param context the context
	 * @param orgID   the org id
	 * @return the current shifts by org hierarchy
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Collection&lt;Shift&gt; getCurrentShiftsByOrgHierarchy(RequestContext context, ID orgID) throws BbmFinderException {
		try {
<span class="nc" id="L2200">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L2201">			return wrm.getCurrentShiftsByOrgHierarchy(orgID);</span>
<span class="nc" id="L2202">		} catch (BbmFinderException ex) {</span>
<span class="nc" id="L2203">			throw ex;</span>
<span class="nc" id="L2204">		} catch (Exception ex) {</span>
<span class="nc" id="L2205">			throw new BbmFinderException(ex);</span>
		}
	}

	/**
	 * Returns the currently active shifts for a schedule period.
	 *
	 * @param context the context
	 * @param spID    the sp id
	 * @return the current shifts by scheduling period
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Collection&lt;Shift&gt; getCurrentShiftsBySchedulingPeriod(RequestContext context, ID spID) throws BbmFinderException {
		try {
<span class="nc" id="L2219">			CampaignManager campaignMgr = WfmManagerFactory.getCampaignManager(context.isInWhatIfMode());</span>
<span class="nc" id="L2220">			SchedulingPeriod schedulingPeriod = campaignMgr.getSchedulingPeriodByID(spID);</span>
<span class="nc" id="L2221">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L2222">			return wrm.getCurrentShiftsBySchedulingPeriod(schedulingPeriod);</span>
<span class="nc" id="L2223">		} catch (BbmFinderException ex) {</span>
<span class="nc" id="L2224">			throw ex;</span>
<span class="nc" id="L2225">		} catch (Exception ex) {</span>
<span class="nc" id="L2226">			throw new BbmFinderException(ex);</span>
		}
	}

	/**
	 * Returns the currently active shifts for a schedule period campaign only (aka local).
	 *
	 * @param context the context
	 * @param spID    the sp id
	 * @return the current shifts by scheduling period campaign only
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Collection&lt;Shift&gt; getCurrentShiftsBySchedulingPeriodCampaignOnly(RequestContext context, ID spID) throws BbmFinderException {
		try {
<span class="nc" id="L2240">			CampaignManager campaignMgr = WfmManagerFactory.getCampaignManager(context.isInWhatIfMode());</span>
<span class="nc" id="L2241">			SchedulingPeriod schedulingPeriod = campaignMgr.getSchedulingPeriodByID(spID);</span>
<span class="nc" id="L2242">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L2243">			return wrm.getCurrentShiftsBySchedulingPeriodCampaignOnly(schedulingPeriod);</span>
<span class="nc" id="L2244">		} catch (BbmFinderException ex) {</span>
<span class="nc" id="L2245">			throw ex;</span>
<span class="nc" id="L2246">		} catch (Exception ex) {</span>
<span class="nc" id="L2247">			throw new BbmFinderException(ex);</span>
		}
	}

	/**
	 * Returns the shift events for an organization hierarchy.
	 *
	 * @param context Request Context
	 * @param orgID   Organization ID
	 * @return Collection of Shift Events
	 * @throws BbmFinderException the bbm finder exception
	 * @see ShiftEvent
	 */
	public static Collection&lt;ShiftEvent&gt; getShiftEventsByOrgHierarchy(RequestContext context, ID orgID) throws BbmFinderException {
		try {
<span class="fc" id="L2262">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L2263">			return wrm.getShiftEventsByOrgHierarchy(orgID);</span>
<span class="nc" id="L2264">		} catch (BbmFinderException ex) {</span>
<span class="nc" id="L2265">			throw ex;</span>
<span class="nc" id="L2266">		} catch (Exception ex) {</span>
<span class="nc" id="L2267">			throw new BbmFinderException(ex);</span>
		}
	}

	/**
	 * Returns the shift events for a scheduling period.
	 *
	 * @param context Request Context
	 * @param spID    Scheduling Period ID
	 * @return Collection of Shift Events
	 * @throws BbmFinderException the bbm finder exception
	 * @see ShiftEvent
	 */
	public static Collection&lt;ShiftEvent&gt; getShiftEventsBySchedulingPeriod(RequestContext context, ID spID) throws BbmFinderException {
		try {
<span class="nc" id="L2282">			CampaignManager campaignMgr = WfmManagerFactory.getCampaignManager(context.isInWhatIfMode());</span>
<span class="nc" id="L2283">			SchedulingPeriod schedulingPeriod = campaignMgr.getSchedulingPeriodByID(spID);</span>
<span class="nc" id="L2284">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L2285">			return wrm.getShiftEventsBySchedulingPeriod(schedulingPeriod);</span>
<span class="nc" id="L2286">		} catch (BbmFinderException ex) {</span>
<span class="nc" id="L2287">			throw ex;</span>
<span class="nc" id="L2288">		} catch (Exception ex) {</span>
<span class="nc" id="L2289">			throw new BbmFinderException(ex);</span>
		}
	}

	/**
	 * Returns the shift events for a scheduling period campaign only (aka local).
	 *
	 * @param context Request Context
	 * @param spID    Scheduling Period ID
	 * @return Collection of Shift Events
	 * @throws BbmFinderException the bbm finder exception
	 * @see ShiftEvent
	 */
	public static Collection&lt;ShiftEvent&gt; getShiftEventsBySchedulingPeriodCampaignOnly(RequestContext context, ID spID) throws BbmFinderException {
		try {
<span class="nc" id="L2304">			CampaignManager campaignMgr = WfmManagerFactory.getCampaignManager(context.isInWhatIfMode());</span>
<span class="nc" id="L2305">			SchedulingPeriod schedulingPeriod = campaignMgr.getSchedulingPeriodByID(spID);</span>
<span class="nc" id="L2306">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L2307">			return wrm.getShiftEventsBySchedulingPeriodCampaignOnly(schedulingPeriod);</span>
<span class="nc" id="L2308">		} catch (BbmFinderException ex) {</span>
<span class="nc" id="L2309">			throw ex;</span>
<span class="nc" id="L2310">		} catch (Exception ex) {</span>
<span class="nc" id="L2311">			throw new BbmFinderException(ex);</span>
		}
	}

	/**
	 * Save rotation.
	 *
	 * @param context the context
	 * @param rot     the rot
	 * @throws BbmUpdateException the bbm update exception
	 * @throws BbmCreateException the bbm create exception
	 */
	public static void saveRotation(RequestContext context, Rotation rot) throws BbmUpdateException, BbmCreateException {
		try {
<span class="nc" id="L2325">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L2326">			wrm.saveRotation(rot);</span>
<span class="nc" id="L2327">		} catch (BbmEJBCreateException e) {</span>
<span class="nc" id="L2328">			throw new BbmCreateException(e);</span>
<span class="nc" id="L2329">		} catch (RemoteException e) {</span>
<span class="nc" id="L2330">			throw new BbmCreateException(e);</span>
<span class="nc" id="L2331">		}</span>
<span class="nc" id="L2332">	}</span>

	/**
	 * Save assignment rule.
	 *
	 * @param context        the context
	 * @param assignmentRule the assignment rule
	 * @return the collection
	 * @throws BbmCreateException the bbm create exception
	 */
	public static Collection&lt;Pair&lt;AssignmentRuleValidationError, List&lt;?&gt;&gt;&gt; saveAssignmentRule(RequestContext context,
			ComplexWorkRule assignmentRule) throws BbmCreateException {
		try {
<span class="fc" id="L2345">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L2346">			return wrm.saveAssignmentRule(assignmentRule);</span>
<span class="nc" id="L2347">		} catch (BbmCreateException e) {</span>
<span class="nc" id="L2348">			throw e;</span>
<span class="nc" id="L2349">		} catch (Exception e) {</span>
<span class="nc" id="L2350">			throw new BbmCreateException(e);</span>
		}
	}

	/**
	 * Copy assignment rules to org.
	 *
	 * @param context                        the context
	 * @param performActionOnIDsAsCollection the perform action on i ds as collection
	 * @param selectedIDObject               the selected id object
	 * @param localeContext                  the locale context
	 * @throws BbmCreateException the bbm create exception
	 */
	public static void copyAssignmentRulesToOrg(RequestContext context,
			Collection&lt;ID&gt; performActionOnIDsAsCollection, ID selectedIDObject,
			LocaleContext localeContext) throws BbmCreateException {
		try {
<span class="nc" id="L2367">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L2368">			wrm.copyAssignmentRulesToOrg(performActionOnIDsAsCollection, selectedIDObject, localeContext);</span>
<span class="nc" id="L2369">		} catch (BbmCreateException e) {</span>
<span class="nc" id="L2370">			throw e;</span>
<span class="nc" id="L2371">		} catch (Exception e) {</span>
<span class="nc" id="L2372">			throw new BbmCreateException(e);</span>
<span class="nc" id="L2373">		}</span>
<span class="nc" id="L2374">	}</span>

	/**
	 * Delete complex work rule.
	 *
	 * @param context                        the context
	 * @param performActionOnIDsAsCollection the perform action on i ds as collection
	 * @throws BbmRemoveException the bbm remove exception
	 */
	public static void deleteComplexWorkRule(RequestContext context,
			Collection&lt;ID&gt; performActionOnIDsAsCollection) throws BbmRemoveException {
		try {
<span class="nc" id="L2386">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="nc" id="L2387">			wrm.deleteAssignmentRules(performActionOnIDsAsCollection);</span>
<span class="nc" id="L2388">		} catch (BbmRemoveException e) {</span>
<span class="nc" id="L2389">			throw e;</span>
<span class="nc" id="L2390">		} catch (Exception e) {</span>
<span class="nc" id="L2391">			throw new BbmRemoveException(e);</span>
<span class="nc" id="L2392">		}</span>
<span class="nc" id="L2393">	}</span>

	/**
	 * Gets the time periods of day.
	 *
	 * @param context the context
	 * @return the time periods of day
	 * @throws BbmFinderException the bbm finder exception
	 */
	public static Collection&lt;TimePeriodOfDay&gt; getTimePeriodsOfDay(RequestContext context) throws BbmFinderException {
		try {
<span class="fc" id="L2404">			WorkRuleManager wrm = WfmManagerFactory.getWorkRuleManager(context.isInWhatIfMode());</span>
<span class="fc" id="L2405">			return wrm.getTimePeriodsOfDay();</span>
<span class="nc" id="L2406">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L2407">			throw e;</span>
<span class="nc" id="L2408">		} catch (Exception e) {</span>
<span class="nc" id="L2409">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Checks if is multi week rules enabled.
	 *
	 * @return true, if is multi week rules enabled
	 * @throws Exception the exception
	 */
	public static boolean isMultiWeekRulesEnabled() throws Exception {
		// MultiWeekOptimization is set to '1' in BPCONFIG
<span class="fc" id="L2421">		return &quot;1&quot;.equals(GeneralSetupModelHandler.getGenericDbValue(ConfigKey.DE_MULTI_WEEK_OPTIMIZATION));</span>
	}

	/**
	 * Checks if is monthly rules enabled.
	 *
	 * @return true, if is monthly rules enabled
	 * @throws Exception the exception
	 */
	public static boolean isMonthlyRulesEnabled() throws Exception {
<span class="fc" id="L2431">		LicenseManager licenseManager = CoreManagerFactory.getLicenseManager();</span>
<span class="fc" id="L2432">		return licenseManager.isLicensed(LicenseKeys.APP_MONTHLY_FORECAST_AND_RULES);</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>