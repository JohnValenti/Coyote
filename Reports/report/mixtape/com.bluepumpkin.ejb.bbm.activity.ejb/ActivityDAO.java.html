<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>ActivityDAO.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.ejb.bbm.activity.ejb</a> &gt; <span class="el_source">ActivityDAO.java</span></div><h1>ActivityDAO.java</h1><pre class="source lang-java linenums">/**
 * Title:        ActivityDAO
 * Description:
 * Copyright:    Copyright (c) 2002, 2011
 * Company:      Verint Systems, Inc.
 */

package com.bluepumpkin.ejb.bbm.activity.ejb;

import java.util.ArrayList;
import java.util.Collection;
import java.util.HashSet;
import java.util.Iterator;
import java.util.Set;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.jdmo.Jdmo;
import com.bluepumpkin.common.jdmo.JdmoException;
import com.bluepumpkin.common.jdmo.JdmoRowset;
import com.bluepumpkin.common.util.StringUtil;
import com.bluepumpkin.ejb.bbm.Filter.Filter;
import com.bluepumpkin.ejb.bbm.activity.model.Activity;
import com.bluepumpkin.ejb.bbm.activity.model.ActivityFieldInfo;
import com.bluepumpkin.ejb.bbm.activity.model.ActivityFilter;
import com.bluepumpkin.ejb.bbm.activity.model.ActivityFilterDAO;
import com.bluepumpkin.ejb.bbm.activity.model.ActivityProperties;
import com.bluepumpkin.ejb.bbm.base.BbmFinderException;
import com.bluepumpkin.ejb.bbm.dao.DAOBase;
import com.bluepumpkin.ejb.bbm.dao.DAOUtil;
import com.bluepumpkin.ejb.bbm.vo.FieldInfo;
import com.bluepumpkin.ejb.bbm.vo.ValueObjectBase;
import com.witness.ejb.core.licensing.LicenseKeys;

public class ActivityDAO extends DAOBase&lt;Activity&gt; {

	// meta data information
<span class="fc" id="L37">	private static FieldInfo m_fieldInfo = new ActivityFieldInfo();</span>
	@Override
<span class="fc" id="L39">	public FieldInfo getFieldInfo() { return m_fieldInfo; }		//Making this public for the relationship to ShiftEventDAO</span>

	ActivityDAO() {
<span class="fc" id="L42">		super();</span>
<span class="fc" id="L43">	}</span>

	public ActivityDAO(Jdmo dmo) {
<span class="fc" id="L46">		super(dmo);</span>
<span class="fc" id="L47">	}</span>

	@Override
	protected Activity createValueObject() {
<span class="fc" id="L51">		return new Activity();</span>
	}

	protected Collection findActivities(Collection ids) throws BbmFinderException {
		try {
<span class="nc" id="L56">			StringBuffer strWhere = new StringBuffer(30);</span>
<span class="nc" id="L57">			strWhere.append(&quot;A.ID in &quot;).append(m_dmo.createInClause(ids));</span>
<span class="nc" id="L58">			return checkLicense(getObjects(new String(strWhere)));</span>
<span class="nc" id="L59">		} catch(JdmoException e) {</span>
<span class="nc" id="L60">			throw new BbmFinderException(e);</span>
		}
	}

	// find organization (and its parents) activities
	protected Collection&lt;Activity&gt; findOrganizationActivities(Collection&lt;ID&gt; organizationIdCol, ActivityFilter activityFilter)
		throws BbmFinderException {
<span class="fc" id="L67">		Collection parentOrgs = DAOUtil.getParentOrganizationsCollection(organizationIdCol, m_dmo);</span>
<span class="fc" id="L68">		parentOrgs.addAll(organizationIdCol);</span>
<span class="fc" id="L69">		return findOrganizationActivities(parentOrgs, activityFilter, false);</span>
	}


	private static String replaceFieldWithCase(String selectStatement, String fieldName) {
<span class="fc" id="L74">		String replacement = String.format( &quot;case when ACTIVITYCATEGORY.%s &gt; 0 then ACTIVITYCATEGORY.%s	else A.%s end as %s&quot;,</span>
					fieldName,fieldName,fieldName,fieldName );
<span class="fc" id="L76">		return selectStatement.replace( &quot;A.&quot;+fieldName, replacement);</span>
	}

	private Set&lt;ID&gt; getAllOrgIds(Collection&lt;ID&gt; orgIds, boolean findParentOrgs) {
<span class="fc" id="L80">		HashSet&lt;ID&gt; allOrgs = new HashSet&lt;ID&gt;(orgIds);</span>
<span class="fc bfc" id="L81" title="All 2 branches covered.">		if(findParentOrgs) {</span>
<span class="fc" id="L82">			HashSet&lt;ID&gt; parentOrgs = DAOUtil.getParentOrganizationsCollection(orgIds, m_dmo);</span>
<span class="fc" id="L83">			allOrgs.addAll(parentOrgs);</span>
		}
<span class="fc" id="L85">		return allOrgs;</span>
	}


	/**
	 * Similar to findOrganizationActivities, but findOrganizationActivitiesCheckCategory
	 *  also checks for the values of fields ISDELETED and ISTIMEOFFWITHALLOTMENT
	 * in the ActivityCategory table in addition to the values in Activity table.
	 * This is needed since a value of  ISTIMEOFFWITHALLOTMENT = 1 in the ActivityCategory table
	 * implies that all activities that have this category will also have a value of 1.
	 * @param orgIds
	 * @param activityFilter
	 * @param findParentOrgs
	 * @return
	 * @throws BbmFinderException
	 */
	protected Collection&lt;Activity&gt; findOrganizationActivitiesCheckCategory( Collection&lt;ID&gt; orgIds,
			ActivityFilter activityFilter, boolean findParentOrgs) throws BbmFinderException {
		try {
<span class="fc" id="L104">			String fullSql = getOrganizationActvitiesSql(orgIds,activityFilter,findParentOrgs, ActivityProperties.FLEX_TIME_INVALID);</span>
<span class="fc" id="L105">			return checkLicense(getObjectsGivenFullSqlQueryStr(fullSql));</span>
<span class="nc" id="L106">		} catch(JdmoException e) {</span>
<span class="nc" id="L107">			throw new BbmFinderException(e);</span>
		}

	}

	/**
	 * This method appends all the possible conditions to attain the final sql that would return the org related categories.
	 * Major change from previous version of this method is to filter flex and time off activities based on FLEXTIMEOFF value
	 * @param orgIds
	 * @param activityFilter
	 * @param findParentOrgs
	 * @param flexType -
	 * @return
	 * @throws JdmoException
	 */
	private String getOrganizationActvitiesSql(Collection&lt;ID&gt; orgIds,
			ActivityFilter activityFilter, boolean findParentOrgs, int flexType) throws JdmoException {

<span class="fc" id="L125">		Set&lt;ID&gt; allOrgs = getAllOrgIds(orgIds, findParentOrgs);</span>
		//Select field1,field2...
<span class="fc" id="L127">		StringBuffer selectFieldBuffer = getSelectStatement();</span>
<span class="fc" id="L128">		appendSystemFieldsToSelect(selectFieldBuffer);</span>

		//replace fields that need to be checked against ACTIVITYCATEGORY with case statements
<span class="fc" id="L131">		String selectFields = selectFieldBuffer.toString();</span>
<span class="fc" id="L132">		selectFields = replaceFieldWithCase(selectFields, &quot;ISDELETED&quot;);</span>
<span class="fc" id="L133">		selectFields = replaceFieldWithCase(selectFields, &quot;ISTIMEOFFWITHALLOTMENT&quot;);</span>

<span class="fc" id="L135">		StringBuilder whereAndOrder = new StringBuilder(128);</span>
<span class="fc" id="L136">		whereAndOrder.append(&quot;Where A.ORGANIZATIONID IN &quot;).append(m_dmo.createInClause(allOrgs));</span>

<span class="fc" id="L138">		String strFilter = getFilterStr(activityFilter);</span>

<span class="pc bpc" id="L140" title="1 of 2 branches missed.">		if(!StringUtil.isEmpty(strFilter)) {</span>
<span class="fc" id="L141">			whereAndOrder.append(&quot; AND &quot;).append(strFilter);</span>
		}

		//filtering flex and TO request types
<span class="fc" id="L145">		checkFlexType(flexType, whereAndOrder);</span>

<span class="fc" id="L147">		String orderBy = getDefaultOrderByStatement();</span>
<span class="pc bpc" id="L148" title="1 of 2 branches missed.">		if(!StringUtil.isEmpty(orderBy)) {</span>
<span class="fc" id="L149">			whereAndOrder.append(&quot; &quot;).append(orderBy);</span>
		}

<span class="fc" id="L152">		return String.format( &quot;Select A.* from ( %s  FROM ACTIVITY A  inner join ACTIVITYCATEGORY  on ACTIVITYCATEGORY.ID = A.ACTIVITYCATEGORYID ) A %s &quot;,</span>
				selectFields,
				whereAndOrder );
	}

	/**
	 * This method is used for appending the where clause with the condition on FLEXTIMEOFF column
	 * Based on whether the request is for pulling flex acitivites or time off activities
	 * Possible valid values are: 1=flex, 0=TimeOff and Activity.FLEX_TIME_INVALID = do nothing
	 * @param flexType
	 * @param whereAndOrder
	 */
	protected void checkFlexType(int flexType, StringBuilder whereAndOrder) {
<span class="fc bfc" id="L165" title="All 2 branches covered.">		if(ActivityProperties.FLEX_TIME_INVALID != flexType) {</span>
<span class="fc" id="L166">			whereAndOrder.append(&quot; AND &quot;);</span>
<span class="fc bfc" id="L167" title="All 2 branches covered.">			if(ActivityProperties.TIME_OFF_TIME == flexType) {</span>
<span class="fc" id="L168">					whereAndOrder.append(&quot;NOT &quot;);</span>
			}
<span class="fc" id="L170">			whereAndOrder.append(&quot;EXISTS (SELECT 1 FROM ACTIVITYPROPERTIES WHERE FLEXTIMEOFF = 1 AND ID = A.ID ) &quot;);</span>
		}
<span class="fc" id="L172">	}</span>

	/**
	 * Similar to findOrganizationActivities, but findOrganizationActivitiesCheckCategory
	 *  also checks for the values of fields ISDELETED and ISTIMEOFFWITHALLOTMENT
	 * in the ActivityCategory table in addition to the values in Activity table.
	 * This is needed since a value of  ISTIMEOFFWITHALLOTMENT = 1 in the ActivityCategory table
	 * implies that all activities that have this category will also have a value of 1.
	 * @param orgIds
	 * @param activityFilter
	 * @param findParentOrgs
	 * @param flexType
	 * @return
	 * @throws BbmFinderException
	 */
	protected Collection&lt;Activity&gt; findOrganizationActivitiesCheckCategory( Collection&lt;ID&gt; orgIds, ActivityFilter activityFilter,
			boolean findParentOrgs, int flexType) throws BbmFinderException {
		try {
<span class="fc" id="L190">			String fullSql = getOrganizationActvitiesSql(orgIds,activityFilter,findParentOrgs, flexType);</span>
<span class="fc" id="L191">			return checkLicense(getObjectsGivenFullSqlQueryStr(fullSql));</span>
<span class="nc" id="L192">		} catch(JdmoException e) {</span>
<span class="nc" id="L193">			throw new BbmFinderException(e);</span>
		}

	}



	// no parent lookup is performed here
	protected Collection&lt;Activity&gt; findOrganizationActivities( Collection&lt;ID&gt; orgIds, ActivityFilter activityFilter, boolean findParentOrgs)
		throws BbmFinderException {
<span class="fc" id="L203">		Set&lt;ID&gt; allOrgs = getAllOrgIds(orgIds, findParentOrgs);</span>
<span class="fc" id="L204">		StringBuffer strWhere = new StringBuffer(128);</span>
		try {
<span class="fc" id="L206">			strWhere.append(&quot;A.ORGANIZATIONID IN &quot;).append(m_dmo.createInClause(allOrgs));</span>
<span class="fc" id="L207">			String strFilter = getFilterStr(activityFilter);</span>
<span class="fc bfc" id="L208" title="All 2 branches covered.">			if(!StringUtil.isEmpty(strFilter)) {</span>
<span class="fc" id="L209">				strWhere.append(&quot; AND &quot;).append(strFilter);</span>
			}
<span class="fc" id="L211">			return checkLicense(getObjects(strWhere.toString(), getDefaultOrderByStatement()));</span>
<span class="nc" id="L212">		} catch(JdmoException e) {</span>
<span class="nc" id="L213">			throw new BbmFinderException(e);</span>
		}
	}

	// no parent lookup is performed here
	protected Collection&lt;Activity&gt; findOrganizationActivities( Collection&lt;ID&gt; orgIds, ActivityFilter activityFilter, boolean findParentOrgs,
			int flexType) throws BbmFinderException {
<span class="nc" id="L220">		Set&lt;ID&gt; allOrgs = getAllOrgIds(orgIds, findParentOrgs);</span>
<span class="nc" id="L221">		StringBuilder strWhere = new StringBuilder(128);</span>
		try {
<span class="nc" id="L223">			strWhere.append(&quot;A.ORGANIZATIONID IN &quot;).append(m_dmo.createInClause(allOrgs));</span>
<span class="nc" id="L224">			String strFilter = getFilterStr(activityFilter);</span>
<span class="nc bnc" id="L225" title="All 2 branches missed.">			if(!StringUtil.isEmpty(strFilter)) {</span>
<span class="nc" id="L226">				strWhere.append(&quot; AND &quot;).append(strFilter);</span>
			}

			//filtering flex and TO request types
<span class="nc" id="L230">			checkFlexType(flexType, strWhere);</span>

<span class="nc" id="L232">			return checkLicense(getObjects(strWhere.toString(), getDefaultOrderByStatement()));</span>
<span class="nc" id="L233">		} catch(JdmoException e) {</span>
<span class="nc" id="L234">			throw new BbmFinderException(e);</span>
		}
	}


	protected Collection findOrganizationActivitiesByCategory(Collection organizationIdCol, ID activityCategoryId, ActivityFilter activityFilter)
		throws BbmFinderException {
<span class="nc" id="L241">		activityFilter.setActivityCategoryId(activityCategoryId, Filter.OP_EQUAL);</span>
<span class="nc" id="L242">		return findOrganizationActivities(organizationIdCol, activityFilter);</span>
	}


	protected Collection&lt;Activity&gt; findActivities(ActivityFilter activityFilter) throws BbmFinderException {
<span class="fc" id="L247">		return checkLicense(getObjects(getFilterStr(activityFilter), getDefaultOrderByStatement()));</span>
	}


	protected Collection&lt;ID&gt; findActivitiesIds(ActivityFilter activityFilter) throws BbmFinderException {
		try {
			// create the sql statement
<span class="fc" id="L254">			StringBuffer sqlQuery = new StringBuffer(128);</span>
<span class="fc" id="L255">			sqlQuery.append(&quot;SELECT &quot;).append(&quot;A.&quot;).append(m_fieldInfo.getFieldName(ActivityFieldInfo.ACTIVITY_ID));</span>
<span class="fc" id="L256">			appendFromWhereStatement(sqlQuery);</span>
<span class="fc" id="L257">			String filterStr = getFilterStr(activityFilter);</span>
<span class="fc bfc" id="L258" title="All 2 branches covered.">			if(!StringUtil.isEmpty(filterStr)) {</span>
<span class="fc" id="L259">				sqlQuery.append(&quot;WHERE &quot;).append(filterStr);</span>
			}

			// fetch the data
			// fetch the data
<span class="fc" id="L264">			return fetchActivitiesIds(sqlQuery.toString());</span>
<span class="nc" id="L265">		} catch (JdmoException e) {</span>
<span class="nc" id="L266">			throw new BbmFinderException(e);</span>
<span class="nc" id="L267">		} catch (Exception e) {</span>
<span class="nc" id="L268">			throw new BbmFinderException(e);</span>
		}
	}

	protected Collection findOrganizationActivitiesIds(ID organizationId, ActivityFilter activityFilter)
		throws BbmFinderException {
		try {
			// create the sql statement
<span class="nc" id="L276">			StringBuffer sqlQuery = new StringBuffer(128);</span>
<span class="nc" id="L277">			sqlQuery.append(&quot;SELECT &quot;).append(&quot;A.&quot;).append(m_fieldInfo.getFieldName(ActivityFieldInfo.ACTIVITY_ID));</span>
<span class="nc" id="L278">			appendFromWhereStatement(sqlQuery);</span>
			// where clause
<span class="nc" id="L280">			sqlQuery.append(&quot;WHERE &quot;);</span>
<span class="nc" id="L281">			Collection parentOrgs = DAOUtil.getParentOrganizationsCollection(organizationId, m_dmo);</span>
<span class="nc" id="L282">			parentOrgs.add(organizationId);</span>
<span class="nc" id="L283">			sqlQuery.append(&quot;A.ORGANIZATIONID IN &quot;).append(m_dmo.createInClause(parentOrgs));</span>
<span class="nc" id="L284">			String strFilter = getFilterStr(activityFilter);</span>
<span class="nc bnc" id="L285" title="All 2 branches missed.">			if(!StringUtil.isEmpty(strFilter)) {</span>
<span class="nc" id="L286">				sqlQuery.append(&quot; AND &quot;).append(strFilter);</span>
			}

			// fetch the data
<span class="nc" id="L290">			return fetchActivitiesIds(sqlQuery.toString());</span>
<span class="nc" id="L291">		} catch (JdmoException e) {</span>
<span class="nc" id="L292">			throw new BbmFinderException(e);</span>
<span class="nc" id="L293">		} catch (Exception e) {</span>
<span class="nc" id="L294">			throw new BbmFinderException(e);</span>
		}
	}


	private Collection&lt;ID&gt; fetchActivitiesIds(String sqlQuery)
	throws Exception
	{
		// fetch the data
<span class="fc" id="L303">		ArrayList&lt;ID&gt; activityIds = new ArrayList&lt;ID&gt;();</span>
<span class="fc" id="L304">		ID id = null;</span>
<span class="fc" id="L305">		JdmoRowset rs = m_dmo.createRowset(sqlQuery);</span>
<span class="fc bfc" id="L306" title="All 2 branches covered.">		while(rs.next()){</span>
<span class="fc" id="L307">			id = rs.getID(m_fieldInfo.getFieldName(ActivityFieldInfo.ACTIVITY_ID));</span>
<span class="fc" id="L308">			activityIds.add(id);</span>
		}
<span class="fc" id="L310">		return checkLicense(activityIds);</span>
	}


	private String getDefaultOrderByStatement() {
<span class="fc" id="L315">		StringBuffer sb = new StringBuffer(32);</span>
<span class="fc" id="L316">		sb.append(&quot; ORDER BY A.&quot;).append(m_fieldInfo.getFieldName(ActivityFieldInfo.ACTIVITY_NAME)).append(&quot; ASC &quot;);</span>
<span class="fc" id="L317">		return sb.toString();</span>
	}

	private String getFilterStr(ActivityFilter activityFilter) {
<span class="fc bfc" id="L321" title="All 2 branches covered.">		if(activityFilter != null) {</span>
<span class="fc" id="L322">			ActivityFilterDAO activityFilterDAO = new ActivityFilterDAO(activityFilter);</span>
<span class="fc" id="L323">			String strFilter = new String(activityFilterDAO.getFilterText());</span>
<span class="fc" id="L324">			strFilter = strFilter.trim();</span>
<span class="fc bfc" id="L325" title="All 2 branches covered.">			if(strFilter.length() &gt; 0) {</span>
<span class="fc" id="L326">				return strFilter;</span>
			}
		}
<span class="fc" id="L329">		return &quot;&quot;;</span>
	}

	public Collection getAllNonSeedActivities() throws BbmFinderException {
<span class="nc" id="L333">		return getObjects(&quot; ID not like '-%'&quot;);</span>
	}
	


	private &lt;T&gt; Collection&lt;T&gt; checkLicense(Collection&lt;T&gt; col) throws BbmFinderException {
<span class="fc" id="L339">		boolean m_hasOutboundLicense = ActivityMediaDAO.checkLicense(LicenseKeys.APP_MEDIA_OUTBOUND);</span>
<span class="fc" id="L340">		boolean m_hasMultiSideLicense = ActivityMediaDAO.checkLicense(LicenseKeys.APP_MULTIMEDIA);</span>
<span class="fc" id="L341">		boolean m_hasDeskTopLicense = ActivityMediaDAO.checkLicense(LicenseKeys.APP_DESKTOPMONITORING);</span>

<span class="pc bpc" id="L343" title="3 of 6 branches missed.">		if (m_hasOutboundLicense &amp;&amp; m_hasMultiSideLicense &amp;&amp; m_hasDeskTopLicense)</span>
<span class="nc" id="L344">			return col;</span>
<span class="fc" id="L345">		Object obj = null;</span>
<span class="fc bfc" id="L346" title="All 2 branches covered.">		for (Iterator&lt;T&gt; i = col.iterator(); i.hasNext(); ) {</span>
<span class="fc" id="L347">			obj = i.next();</span>
<span class="pc bpc" id="L348" title="1 of 2 branches missed.">			if (!m_hasOutboundLicense) {</span>
<span class="nc bnc" id="L349" title="All 4 branches missed.">				if (obj instanceof ID &amp;&amp; ((ID)obj).toInt() == -4138) { //predefined outbound id</span>
<span class="nc" id="L350">					i.remove();</span>
<span class="nc" id="L351">					continue;</span>
				}
<span class="nc bnc" id="L353" title="All 4 branches missed.">				if (obj instanceof Activity &amp;&amp; ((Activity)obj).getID().toInt() == -4138) {</span>
<span class="nc" id="L354">					i.remove();</span>
<span class="nc" id="L355">					continue;</span>
				}
			}
<span class="pc bpc" id="L358" title="1 of 2 branches missed.">			if (!m_hasMultiSideLicense) {</span>
<span class="nc bnc" id="L359" title="All 6 branches missed.">				if (obj instanceof ID &amp;&amp; (((ID)obj).toInt() == -4102 || ((ID)obj).toInt() == -4103)) { //predefined deferred and blended</span>
<span class="nc" id="L360">					i.remove();</span>
<span class="nc" id="L361">					continue;</span>
				}
<span class="nc bnc" id="L363" title="All 6 branches missed.">				if (obj instanceof Activity &amp;&amp; (((Activity)obj).getID().toInt() == -4102 || ((Activity)obj).getID().toInt() == -4103)) {</span>
<span class="nc" id="L364">					i.remove();</span>
<span class="nc" id="L365">					continue;</span>
				}
			}
<span class="pc bpc" id="L368" title="1 of 2 branches missed.">			if (!m_hasDeskTopLicense) {</span>
<span class="fc" id="L369">				ID id = null;</span>
<span class="fc bfc" id="L370" title="All 2 branches covered.">				if (obj instanceof ID)</span>
<span class="fc" id="L371">					id = (ID)obj;</span>
<span class="pc bpc" id="L372" title="1 of 2 branches missed.">				else if (obj instanceof Activity)</span>
<span class="fc" id="L373">					id = ((Activity)obj).getID();</span>

				//id from -4140 to -4165 are desktop activities
<span class="pc bpc" id="L376" title="1 of 6 branches missed.">				if (id != null &amp;&amp; id.toInt() &lt;= -4140 &amp;&amp; id.toInt() &gt;= -4164) {</span>
<span class="fc" id="L377">					i.remove();</span>
<span class="fc" id="L378">					continue;</span>
				}
<span class="fc" id="L380">			}</span>
		}
<span class="fc" id="L382">		return col;</span>
	}

	protected Collection&lt;ID&gt; getDailyPoolAllotmentActivityIDs(boolean checkTimeOffWithAllotment) throws BbmFinderException {
		try {
<span class="nc" id="L387">			String sql = &quot;select A.ID from ACTIVITY A inner join ACTIVITYPROPERTIES AP on AP.ID = A.ID where AP.USEDAILYTOPOOL = 1 &quot;;</span>

<span class="nc bnc" id="L389" title="All 2 branches missed.">			if (checkTimeOffWithAllotment) {</span>
<span class="nc" id="L390">				sql += &quot; AND ISTIMEOFFWITHALLOTMENT = 1&quot;;</span>
			}
<span class="nc" id="L392">			return fetchActivitiesIds(sql);</span>
<span class="nc" id="L393">		} catch (JdmoException e) {</span>
<span class="nc" id="L394">			throw new BbmFinderException(e);</span>
<span class="nc" id="L395">		} catch (Exception e) {</span>
<span class="nc" id="L396">			throw new BbmFinderException(e);</span>
		}
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>