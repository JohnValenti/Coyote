<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>ScheduleSummaryPM.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.fs.schedule.summary</a> &gt; <span class="el_source">ScheduleSummaryPM.java</span></div><h1>ScheduleSummaryPM.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.fs.schedule.summary;

import java.util.ArrayList;
import java.util.Calendar;
import java.util.Collection;
import java.util.HashMap;
import java.util.Iterator;
import java.util.Map;
import java.util.ResourceBundle;
import java.util.TimeZone;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.l10n.RegionalFormatBundleKey;
import com.bluepumpkin.ejb.rm.base.RmHardValidationException;
import com.bluepumpkin.ejb.rm.util.LicenseUtil;
import com.bluepumpkin.web.bbm.l10n.BbmWebBundleKey;
import com.bluepumpkin.web.fs.l10n.FsWebBundleKey;
import com.bluepumpkin.web.fs.schedule.ScheduleViewMH;
import com.bluepumpkin.web.fs.schedule.ScheduleViewPM;
import com.bluepumpkin.web.fs.schedule.ScheduleViewShiftDisplayInfo;
import com.bluepumpkin.web.fs.schedule.ScheduleViewUtil;
import com.witness.ejb.core.security.PrivilegeKeys;
import com.witness.ejb.core.security.model.User;
import com.witness.web.uif.base.Message;
import com.witness.web.uif.keys.JavaScriptFileID;
import com.witness.web.uif.keys.PageAction;
import com.witness.web.uif.l10n.UIFWebBundleKey;
import com.witness.web.uif.pagecomponent.DefaultMultiColumnNodeData;
import com.witness.web.uif.pagecomponent.container.CollapsibleContainerPC;
import com.witness.web.uif.pagecomponent.list.MultiColListPC;
import com.witness.web.uif.pagecomponent.table.TableHeaderPC;
import com.witness.web.uif.pagemodel.ContainersInRowsPM;
import com.witness.web.uif.pagemodel.PageModel;
import com.witness.web.uif.pagemodel.WorkpanePageModel;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.util.ContainerList;
import com.witness.web.uif.util.TimeZoneHelper;
import com.witness.web.uif.util.html.CSSUtil;

/**
 * Title:        ScheduleSummaryPM
 * Description:  Page Model for Schedule summary viewing.
 * Copyright:    Copyright (c) 2001
 * Company:      Blue Pumpkin Software, inc
 * @author       Chris King; Pavel Bosin; David Su
 * @version      1.0
 */
public class ScheduleSummaryPM extends WorkpanePageModel implements ContainersInRowsPM {
	public static final String FORM_ACTION = &quot;schedulesummary&quot;;

<span class="fc" id="L51">	private static final String[] SS_HEADER_RB_KEYS = new String[] {</span>
		FsWebBundleKey.SS_SUMMARY_POSTINGS,
		FsWebBundleKey.SUMMARY_REQUESTS_TOTAL,
		FsWebBundleKey.SUMMARY_REQUESTS_EXPIRED,
		FsWebBundleKey.SUMMARY_REQUESTS_IMCOMPLETE,
		FsWebBundleKey.SUMMARY_REQUESTS_PENDING,
		FsWebBundleKey.SUMMARY_REQUESTS_APPROVED,
		FsWebBundleKey.SUMMARY_REQUESTS_DENIED,
		FsWebBundleKey.SUMMARY_REQUESTS_INVALID
	};

<span class="fc" id="L62">	private static final String[] SB_HEADER_RB_KEYS = new String[] {</span>
		FsWebBundleKey.SB_SUMMARY_AUCTIONS,
		FsWebBundleKey.SUMMARY_REQUESTS_TOTAL,
		FsWebBundleKey.SUMMARY_REQUESTS_EXPIRED,
		FsWebBundleKey.SUMMARY_REQUESTS_PENDING,
		FsWebBundleKey.SUMMARY_REQUESTS_APPROVED,
		FsWebBundleKey.SUMMARY_REQUESTS_DENIED,
		FsWebBundleKey.SUMMARY_REQUESTS_INVALID
	};

	//containers
	private ContainerList m_containerList;
<span class="nc" id="L74">	private CollapsibleContainerPC m_thisWeekSchedulePC = null;</span>
<span class="nc" id="L75">	private TimeOffSummaryPC m_TOSummaryPC = null;</span>
<span class="nc" id="L76">	private FlexTimeSummaryPC flexTimeSummaryPC = null;</span>
<span class="nc" id="L77">	private CollapsibleContainerPC m_SSSummaryPC = null;</span>
<span class="nc" id="L78">	private OneWayShiftSwapSummaryPC oneWaySSSummaryPC = null;</span>
<span class="nc" id="L79">	private CollapsibleContainerPC m_SBSummaryPC = null;</span>
<span class="nc" id="L80">	private TimeBankSummaryPC m_TBSummaryPC = null;    </span>

	private ResourceBundle m_bundle;
	private User m_user;

	/**
	 * Constructor
	 */
	public ScheduleSummaryPM(RequestContext context) {
<span class="nc" id="L89">		super(context, PageModel.BASIC_MODEL);</span>

		// === member variables
<span class="nc" id="L92">		m_bundle = m_localizer.getBundle(FsWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L93">		m_user = context.getUser();</span>
<span class="nc" id="L94">		m_containerList = new ContainerList(this, 3);</span>

<span class="nc" id="L96">		m_TOSummaryPC = new TimeOffSummaryPC(m_context);</span>
<span class="nc" id="L97">		addChildComponent(m_TOSummaryPC);</span>

<span class="nc" id="L99">		flexTimeSummaryPC = new FlexTimeSummaryPC(m_context);</span>
<span class="nc" id="L100">		addChildComponent(flexTimeSummaryPC);</span>

<span class="nc" id="L102">		oneWaySSSummaryPC = new OneWayShiftSwapSummaryPC(m_context);</span>
<span class="nc" id="L103">		addChildComponent(oneWaySSSummaryPC);</span>

<span class="nc" id="L105">		m_TBSummaryPC = new TimeBankSummaryPC(m_context);</span>
<span class="nc" id="L106">		addChildComponent(m_TBSummaryPC);</span>

		// === specific required JavaScript Files
<span class="nc" id="L109">		setJSMediator(JavaScriptFileID.MEDIATOR_WORKPANE_GENERIC);</span>
<span class="nc" id="L110">	}// constructor</span>

	/**
	 * Return instance of Model which is ready to be rendered
	 */
	public static PageModel getInstance(RequestContext context)	throws Exception {
<span class="nc" id="L116">		return getInstance(context, ScheduleSummaryPM.class);</span>
	}//getInstance

	/**
	 * Initialize Model with Data
	 */
	@Override
	protected void initializeModel() {
<span class="nc bnc" id="L124" title="All 2 branches missed.">		if (m_isInitialized) </span>
<span class="nc" id="L125">            return; </span>
        else 
<span class="nc" id="L127">            m_isInitialized = true;</span>

		try {
			//--- check if valid employee
<span class="nc bnc" id="L131" title="All 2 branches missed.">			if(m_user.getEmployeeID() == null){</span>
<span class="nc" id="L132">				addPageMessage(Message.INFO_TYPE, BbmWebBundleKey.NO_PERSON_INFO,BbmWebBundleKey.BUNDLE_NAME);</span>
			} else {
<span class="nc" id="L134">				HashMap theData = ScheduleSummaryMH.getData(m_context);</span>
<span class="nc" id="L135">				populateThisWeekSchedule(theData);</span>
<span class="nc" id="L136">				populateTimeOffSummary();</span>
<span class="nc" id="L137">				populateFlexTimeSummary(theData);</span>
<span class="nc" id="L138">				populateShiftSwapSummary(theData);</span>
<span class="nc" id="L139">				populateOneWayShiftSwapSummary(theData);</span>
<span class="nc" id="L140">				populateShiftBiddingSummary(theData);</span>
<span class="nc" id="L141">				populateTimeBankingSummary(theData);</span>
			}
<span class="nc" id="L143">		} catch (RmHardValidationException ex) {</span>
<span class="nc" id="L144">			Message msg = handleUnableToLoadDataError(log, ex);</span>
<span class="nc" id="L145">			msg.setAssociatedMessage(ex.getLocalizedMessage(m_localizer, m_context.getViewingTimeZone()));			</span>
<span class="nc" id="L146">		} catch (Exception ex) {</span>
<span class="nc" id="L147">			handleUnableToLoadDataError(log, ex);</span>
		} finally {
<span class="nc" id="L149">			initToolbar();</span>
<span class="nc" id="L150">			initContentTitle();</span>
<span class="nc" id="L151">		}</span>
<span class="nc" id="L152">	}//populateModel</span>

	//=========== initialize Schedule container =================
	/**
	 * Populate This Week Schedule PC
	 * @param theData has the data to populate the component
	 */
	private void populateThisWeekSchedule(Map theData) 
	{
		try 
		{
<span class="nc" id="L163">			m_thisWeekSchedulePC = createContainerPC(&quot;ScheduleContainer&quot;);</span>
<span class="nc" id="L164">			String titleData =</span>
<span class="nc" id="L165">				i18n(m_bundle, FsWebBundleKey.SCHED_SUMMARY_THIS_WEEK_SCHEDULE) + &quot; - &quot; +</span>
<span class="nc" id="L166">				i18n(m_common_bundle, UIFWebBundleKey.TIMEZONE_VIEWING) + &quot;: &quot; +</span>
<span class="nc" id="L167">				TimeZoneHelper.getDisplayTimeZone(m_context.getViewingTimeZone().getID(), m_localizer);</span>
<span class="nc" id="L168">			m_thisWeekSchedulePC.setTitle(titleData);</span>

			//--- data from the map
<span class="nc" id="L171">			Collection thisWeekScheduleData = (Collection)theData.get(ScheduleSummaryMH.THIS_WEEK_SCHEDULE_KEY);</span>
<span class="nc" id="L172">			Calendar thisWeekStart = (Calendar)theData.get(ScheduleSummaryMH.THIS_WEEK_START_DATE_KEY);</span>

			//--- multi column list PC object
<span class="nc" id="L175">			MultiColListPC theListPC = initContianerAndCreateList(m_context, m_thisWeekSchedulePC);</span>

			//--- set column headers with dates and day-of-week
<span class="nc" id="L178">			setScheduleListHeaders(theListPC,thisWeekStart);</span>
			
<span class="nc" id="L180">			Map&lt;ID, String&gt; campaignNamesBySPID = (Map&lt;ID, String&gt;)theData.get(ScheduleViewMH.CAMPAIGN_NAMES_BY_SP_ID_KEY);</span>
			
			//--- set this week data into theListPC
<span class="nc" id="L183">			createScheduleListModel(theListPC, thisWeekScheduleData, thisWeekStart, campaignNamesBySPID);</span>
		} 
<span class="nc" id="L185">		catch (Exception ex) </span>
		{
<span class="nc" id="L187">			handlePopulateContainerError(FsWebBundleKey.MSG_SCHED_SUMMARY_NO_THISWEEK_SCHEDULE, ex);</span>
<span class="nc" id="L188">		}</span>
<span class="nc" id="L189">	}//populateThisWeekSchedule</span>

	/**
	 * create list headers for this week schedule list
	 */
	private void setScheduleListHeaders(MultiColListPC theListPC, Calendar thisWeekStart){
<span class="nc" id="L195">		TableHeaderPC header = theListPC.getHeader();</span>
<span class="nc" id="L196">		Calendar aCal = (Calendar)thisWeekStart.clone();</span>
<span class="nc" id="L197">		TimeZone tz = m_context.getViewingTimeZone();</span>
<span class="nc" id="L198">		boolean dstAdjustment = false;</span>
<span class="nc bnc" id="L199" title="All 2 branches missed.">		for (int i = 0; i &lt;7; i++){</span>
<span class="nc" id="L200">			header.addColumnHeaderData(null, m_localizer.formatDate(aCal.getTime(),</span>
					tz,RegionalFormatBundleKey.DATE_NOYEAR_DAYINWEEKFULL_FORMAT));

			//QC46598 java bug for Brazil DST transition 10/18/09
			//aCal.add(Calendar.DATE, 1);
<span class="nc" id="L205">			dstAdjustment = ScheduleViewUtil.nextDay(aCal, dstAdjustment);</span>
		}
<span class="nc" id="L207">	}//setScheduleListHeaders</span>

	/**
     * Add a tooltip to an HTML element
     */
    public String addTooltip(String html, String tooltip)
    {
<span class="nc" id="L214">        return &quot;&lt;span title=\&quot;&quot; + tooltip + &quot;\&quot;&gt;&quot; + html + &quot;&lt;/span&gt;&quot;;</span>
    }
    
	/**
	 * set Schedule List Data items
     * @param campaignIdNames - Map of campaignID-&gt;campaignName.
	 */
	private void createScheduleListModel(MultiColListPC theListPC,
			Collection thisWeekScheduleData, Calendar thisWeekStart, Map&lt;ID, String&gt; campaignNamesBySPID)
	{
<span class="nc bnc" id="L224" title="All 4 branches missed.">		if (thisWeekScheduleData == null || thisWeekScheduleData.size() == 0) </span>
<span class="nc" id="L225">		    return;</span>

		// Create the list model and one row data
<span class="nc" id="L228">		ArrayList listModel = new ArrayList(1);</span>
<span class="nc" id="L229">		DefaultMultiColumnNodeData row_data = new DefaultMultiColumnNodeData();</span>
		// add nodes to the row
<span class="nc" id="L231">		TimeZone tz = m_context.getViewingTimeZone();</span>

<span class="nc bnc" id="L233" title="All 2 branches missed.">		for(Iterator it = thisWeekScheduleData.iterator(); it.hasNext();) </span>
		{
			//entries &quot;unpublished&quot; or &quot;no shift&quot; or &quot;hh:mm am - hh:mm pm&quot; or &quot;day off&quot;
<span class="nc" id="L236">			DailyScheduleSummary oneDaySchedule = (DailyScheduleSummary) it.next();</span>
			
<span class="nc bnc" id="L238" title="All 2 branches missed.">			if (!oneDaySchedule.isPublished())</span>
			{
<span class="nc" id="L240">				row_data.add(i18n(m_bundle,FsWebBundleKey.SCHED_SUMMARY_UNPUBLISHED));</span>
			} 
            else
            {
                // GMT clients may have custom strings in BPCONFIG
<span class="nc" id="L245">                String verticalizedString = verticalize(m_bundle, FsWebBundleKey.FS_CAL_TITLEBAR_CAMPAIGN);</span>
<span class="nc" id="L246">                String tooltip = verticalizedString +</span>
<span class="nc" id="L247">                        ScheduleViewUtil.getCampaignName(campaignNamesBySPID, oneDaySchedule);</span>

<span class="nc bnc" id="L249" title="All 2 branches missed.">                if (oneDaySchedule.isDayOff())</span>
			{
<span class="nc" id="L251">                	String defaultAbsentString= i18n(m_bundle,FsWebBundleKey.SCHED_SUMMARY_DAY_OFF);</span>
<span class="nc" id="L252">      				String absentStringOverride = ScheduleSummaryMH.getAbsentStringOverride();</span>
<span class="nc bnc" id="L253" title="All 4 branches missed.">      				if(absentStringOverride!=null &amp;&amp; absentStringOverride.equals(FsWebBundleKey.FS_CUSTOM_TIME_OFF)) //The value is specific for France Telecom, Story 34046</span>
<span class="nc" id="L254">      					absentStringOverride = i18n(m_bundle,FsWebBundleKey.FS_CUSTOM_TIME_OFF);</span>
<span class="nc bnc" id="L255" title="All 2 branches missed.">      				absentStringOverride = absentStringOverride==null ? defaultAbsentString : absentStringOverride;</span>
<span class="nc" id="L256">				row_data.add(addTooltip(absentStringOverride,tooltip));</span>
<span class="nc" id="L257">			}</span>
<span class="nc bnc" id="L258" title="All 2 branches missed.">			else if (oneDaySchedule.isClosed())</span>
			{
<span class="nc" id="L260">				row_data.add(addTooltip(i18n(m_bundle,FsWebBundleKey.SCHED_SUMMARY_CLOSED),tooltip));</span>
			} 
<span class="nc bnc" id="L262" title="All 2 branches missed.">			else if (oneDaySchedule.hasShift())</span>
			{
<span class="nc" id="L264">				String shiftString = &quot;&quot;;</span>
<span class="nc" id="L265">				ScheduleViewShiftDisplayInfo shiftStrings = ScheduleViewPM.getShiftDisplayInfo(oneDaySchedule, m_localizer, tz);</span>
<span class="nc bnc" id="L266" title="All 2 branches missed.">				if (shiftStrings != null)</span>
				{
<span class="nc" id="L268">					shiftString += shiftStrings.getPreviousDayIcon();</span>
<span class="nc" id="L269">					shiftString += shiftStrings.getShiftString();</span>
<span class="nc" id="L270">					shiftString += shiftStrings.getNextDayIcon();</span>
				}
<span class="nc" id="L272">				row_data.add(addTooltip(shiftString,tooltip));</span>
<span class="nc" id="L273">			} </span>
			else 
			{
<span class="nc" id="L276">				row_data.add(i18n(m_bundle,FsWebBundleKey.SCHED_SUMMARY_OFF));</span>
			}
            }

<span class="nc" id="L280">		}</span>
<span class="nc" id="L281">		listModel.add(row_data);</span>
<span class="nc" id="L282">		theListPC.setListModel(listModel);</span>
<span class="nc" id="L283">	}//createScheduleListModel</span>


	private void populateTimeOffSummary() {
<span class="nc bnc" id="L287" title="All 2 branches missed.">		if (m_user.isAuthorized(PrivilegeKeys.TOM_VIEWPERSONALSUMMARY) ) {</span>
<span class="nc" id="L288">			m_containerList.add(m_TOSummaryPC, false);</span>
<span class="nc" id="L289">			m_TOSummaryPC.init();</span>
		}
<span class="nc" id="L291">	}</span>

	//=========== initialize Shift Swap container =================
	/**
	 * Populate Shift Swap Summary PC
	 * @param theData has the data to populate the component
	 */
	private void populateShiftSwapSummary(Map theData) {
		try {
<span class="nc bnc" id="L300" title="All 2 branches missed.">			if( ScheduleViewPM.getBooleanFromMap(theData, ScheduleSummaryMH.SHOW_SS_SUMMARY)){</span>
<span class="nc" id="L301">				m_SSSummaryPC = createContainerPC(&quot;SSContainer&quot;);</span>
<span class="nc" id="L302">				m_SSSummaryPC.setTitle(i18n(m_bundle, FsWebBundleKey.SCHED_SUMMARY_SS_SUMMARY));</span>

<span class="nc" id="L304">				MultiColListPC theListPC = initContianerAndCreateList(m_context, m_SSSummaryPC);</span>
<span class="nc" id="L305">				initHeader(theListPC, SS_HEADER_RB_KEYS);</span>

<span class="nc" id="L307">				ShiftSwapSummaryData data = (ShiftSwapSummaryData)theData.get(ScheduleSummaryMH.SS_SUMMARY_DATA_KEY);</span>
<span class="nc" id="L308">				createSSListModel(theListPC,data);</span>
			}
<span class="nc" id="L310">		} catch (Exception ex) {</span>
<span class="nc" id="L311">			handlePopulateContainerError(FsWebBundleKey.MSG_SCHED_SUMMARY_NO_SS_SUMMARY, ex);</span>
<span class="nc" id="L312">		}</span>
<span class="nc" id="L313">	}//populateShiftSwapSummary</span>

	/**
	 * set Shift Swap Summary List model
	 */
	private void createSSListModel(MultiColListPC theListPC, ShiftSwapSummaryData data){
<span class="nc bnc" id="L319" title="All 2 branches missed.">		if (data == null) return;</span>

		// Create the list model
<span class="nc" id="L322">		ArrayList listModel = new ArrayList(1);</span>
<span class="nc" id="L323">		DefaultMultiColumnNodeData row_data = new DefaultMultiColumnNodeData();</span>
<span class="nc" id="L324">		addNumData(data.getPostings(), row_data);</span>
<span class="nc" id="L325">		addNumData(data.getRequestsTotal(), row_data);</span>
<span class="nc" id="L326">		addNumData(data.getRequestsExpired(), row_data);</span>
<span class="nc" id="L327">		addNumData(data.getRequestsNegotiation(), row_data);</span>
<span class="nc" id="L328">		addNumData(data.getRequestsPending(), row_data);</span>
<span class="nc" id="L329">		addNumData(data.getRequestsApproved(), row_data);</span>
<span class="nc" id="L330">		addNumData(data.getRequestsDenied(), row_data);</span>
<span class="nc" id="L331">		addNumData(data.getRequestsInvalid(), row_data);</span>

<span class="nc" id="L333">		listModel.add(row_data);</span>
<span class="nc" id="L334">		theListPC.setListModel(listModel);</span>
<span class="nc" id="L335">	}</span>

	//=========== initialize One-Way Shift Swap container =================

	/**
	 * Populate One-Way Shift Swap Summary PC
	 * @param theData has the data to populate the component
	 */
	private void populateOneWayShiftSwapSummary(Map theData) 
	{
		try {
<span class="nc bnc" id="L346" title="All 2 branches missed.">			if (ScheduleViewPM.getBooleanFromMap(theData, ScheduleSummaryMH.SHOW_ONE_WAY_SS_SUMMARY)) {</span>
<span class="nc" id="L347">				OneWayShiftSwapSummaryData data = (OneWayShiftSwapSummaryData)theData.get(ScheduleSummaryMH.ONE_WAY_SS_SUMMARY_DATA_KEY);</span>
<span class="nc bnc" id="L348" title="All 2 branches missed.">				if (data != null) {</span>
<span class="nc" id="L349">					oneWaySSSummaryPC.init(data);</span>
<span class="nc" id="L350">					m_containerList.add(oneWaySSSummaryPC, false);</span>
				}
			}
		} 
<span class="nc" id="L354">		catch (Exception ex) {</span>
<span class="nc" id="L355">			handlePopulateContainerError(FsWebBundleKey.MSG_SCHED_SUMMARY_NO_ONE_WAY_SS_SUMMARY, ex);</span>
<span class="nc" id="L356">		}</span>
<span class="nc" id="L357">	}</span>

	private void populateFlexTimeSummary(Map theData) 
	{
		try {
<span class="nc bnc" id="L362" title="All 2 branches missed.">			if (ScheduleViewPM.getBooleanFromMap(theData, ScheduleSummaryMH.SHOW_TO_FLEX_TIME_SUMMARY)) {</span>
<span class="nc" id="L363">				FlexTimeSummaryData data = (FlexTimeSummaryData)theData.get(ScheduleSummaryMH.FLEX_TIME_DATA_KEY);</span>
				
<span class="nc bnc" id="L365" title="All 2 branches missed.">				if (data != null) {</span>
<span class="nc" id="L366">					flexTimeSummaryPC.init(data);</span>
<span class="nc" id="L367">					m_containerList.add(flexTimeSummaryPC, false);</span>
				}
			}
		} 
<span class="nc" id="L371">		catch (Exception ex) {</span>
<span class="nc" id="L372">			handlePopulateContainerError(FsWebBundleKey.MSG_SCHED_SUMMARY_NO_ONE_WAY_SS_SUMMARY, ex);</span>
<span class="nc" id="L373">		}</span>
<span class="nc" id="L374">	}</span>
	
	//=========== initialize Shift Bidding container =================
	/**
	 * Populate Shift Bidding Summary PC
	 */
	private void populateShiftBiddingSummary(Map theData) {
		try {
			//--- content
<span class="nc bnc" id="L383" title="All 2 branches missed.">			if (ScheduleViewPM.getBooleanFromMap(theData, ScheduleSummaryMH.SHOW_SB_SUMMARY)) {</span>
<span class="nc" id="L384">				m_SBSummaryPC = createContainerPC(&quot;SBContainer&quot;);</span>
<span class="nc" id="L385">				m_SBSummaryPC.setTitle(i18n(m_bundle, FsWebBundleKey.SCHED_SUMMARY_SB_SUMMARY));</span>

<span class="nc" id="L387">				MultiColListPC theListPC = initContianerAndCreateList(m_context, m_SBSummaryPC);</span>
<span class="nc" id="L388">				initHeader(theListPC, SB_HEADER_RB_KEYS);</span>

<span class="nc" id="L390">				ShiftBidSummaryData data = (ShiftBidSummaryData)theData.get(ScheduleSummaryMH.SB_SUMMARY_DATA_KEY);</span>
<span class="nc" id="L391">				createSBListModel(theListPC, data);</span>
			}
<span class="nc" id="L393">		} catch (Exception ex) {</span>
<span class="nc" id="L394">			handlePopulateContainerError(FsWebBundleKey.MSG_SCHED_SUMMARY_NO_SB_SUMMARY, ex);</span>
<span class="nc" id="L395">		}</span>
<span class="nc" id="L396">	}</span>

	/**
	 * set Shift Swap Summary List model
	 */
	private void createSBListModel(MultiColListPC theListPC, ShiftBidSummaryData data){
<span class="nc bnc" id="L402" title="All 2 branches missed.">		if (data == null) return;</span>

		// Create the list model
<span class="nc" id="L405">		ArrayList listModel = new ArrayList(1);</span>
<span class="nc" id="L406">		DefaultMultiColumnNodeData row_data = new DefaultMultiColumnNodeData();</span>
<span class="nc" id="L407">		addNumData(data.getAuctions(), row_data);</span>
<span class="nc" id="L408">		addNumData(data.getRequestsTotal(), row_data);</span>
<span class="nc" id="L409">		addNumData(data.getRequestsExpired(), row_data);</span>
<span class="nc" id="L410">		addNumData(data.getRequestsPending(), row_data);</span>
<span class="nc" id="L411">		addNumData(data.getRequestsApproved(), row_data);</span>
<span class="nc" id="L412">		addNumData(data.getRequestsDenied(), row_data);</span>
<span class="nc" id="L413">		addNumData(data.getRequestsInvalid(), row_data);</span>

<span class="nc" id="L415">		listModel.add(row_data);</span>
<span class="nc" id="L416">		theListPC.setListModel(listModel);</span>
<span class="nc" id="L417">	}//createSSListModel</span>

    //=========== initialize Time Banking container =================

    /**
     * Populate Time Banking Summary PC
     */
    private void populateTimeBankingSummary(Map theData) 
    {
        try 
        {
            //--- content
<span class="nc bnc" id="L429" title="All 2 branches missed.">            if (ScheduleViewPM.getBooleanFromMap(theData, ScheduleSummaryMH.SHOW_TB_SUMMARY)) </span>
            {
<span class="nc" id="L431">                TimeBankSummaryData data = (TimeBankSummaryData)theData.get(ScheduleSummaryMH.TB_SUMMARY_DATA_KEY);</span>
<span class="nc bnc" id="L432" title="All 2 branches missed.">                if (data != null)</span>
                {
<span class="nc" id="L434">                    m_TBSummaryPC.init(data);</span>
<span class="nc" id="L435">                    m_containerList.add(m_TBSummaryPC, false);</span>
                }
            }
        } 
<span class="nc" id="L439">        catch (Exception ex) </span>
        {
<span class="nc" id="L441">            handlePopulateContainerError(FsWebBundleKey.MSG_SCHED_SUMMARY_NO_TB_SUMMARY, ex);</span>
<span class="nc" id="L442">        }</span>
<span class="nc" id="L443">    }</span>
    
	//====== Initialize Content Title, Toolbar ===============
	/**
	 * Initialize Content Title
	 */
	@Override
	protected void initContentTitle()
	{
<span class="nc" id="L452">		String employeeName = &quot;&quot;;</span>
		try {			
<span class="nc" id="L454">            ID employeeID = m_context.getUser().getEmployeeID();</span>
<span class="nc" id="L455">			employeeName = ScheduleViewMH.getEmployeeDisplayName(m_context, employeeID, m_localizer);</span>
<span class="nc" id="L456">		} catch (Exception ex) {</span>
<span class="nc" id="L457">			handleUnableToLoadDataError(log, ex);</span>
<span class="nc" id="L458">		} </span>

<span class="nc" id="L460">		m_contentTitlePC.setProperties(i18n(m_bundle, FsWebBundleKey.MYSCHEDULE_SUMMARY_PAGETITLE), employeeName);</span>
		
<span class="nc" id="L462">	}//initContentTitle</span>

	/**
	 * Initialize Toolbar
	 */
	@Override
	protected void initToolbar()	{
<span class="nc" id="L469">		m_toolbar.addSubmitTextButton(PageAction.REFRESH, i18n(m_bundle, FsWebBundleKey.REFRESH), true);</span>
<span class="nc" id="L470">	}//initToolbar</span>

	//======= Getters/Setters =====================
	/**
	 * Return URL for HTML Form Action
	 */
	@Override
	public String getFormAction() {
<span class="nc" id="L478">		return FORM_ACTION;</span>
	}

	/** Return List of Containers
	 * NOTE: Items in the Collection will be treated either as Page Components or
	 *       just as Objects.
	 */
	public Collection getContainers() {
<span class="nc" id="L486">		return m_containerList;</span>
	}

	//////////////////////////////////////////////////////////////////////////////
	// Helper Methods
	//////////////////////////////////////////////////////////////////////////////
	private final CollapsibleContainerPC createContainerPC(String name) {
<span class="nc" id="L493">		CollapsibleContainerPC containerPC = new CollapsibleContainerPC(m_context);</span>
<span class="nc" id="L494">		containerPC.setName(name);</span>
<span class="nc" id="L495">		m_containerList.add(containerPC);</span>
<span class="nc" id="L496">		return containerPC;</span>
	}

	private void initHeader(MultiColListPC theListPC, String[] rbKeys){
<span class="nc" id="L500">		TableHeaderPC header = theListPC.getHeader();</span>
<span class="nc bnc" id="L501" title="All 2 branches missed.">		for(int i=0; i&lt;rbKeys.length; i++) {</span>
<span class="nc" id="L502">			String label = i18n(m_bundle,rbKeys[i]);</span>
<span class="nc" id="L503">			header.addColumnHeaderData(null, label, CSSUtil.CLASS_INNER_HEADER_BORDER_NUMERIC);</span>
		}
<span class="nc" id="L505">	}</span>
    
	private static final MultiColListPC initContianerAndCreateList(RequestContext context, CollapsibleContainerPC parentPC) 
    {
		// List for Display purpose
<span class="nc" id="L510">		MultiColListPC theListPC = new MultiColListPC(context,false);</span>
<span class="nc" id="L511">		theListPC.setEnabled(false);</span>
<span class="nc" id="L512">        theListPC.setHasRowHeaders(false); //508</span>

		// Initialize Container
<span class="nc" id="L515">		parentPC.setStyleClass(CSSUtil.CLASS_BORDER_DEFAULT);</span>
<span class="nc" id="L516">		parentPC.setTemplate(&quot;{0}&quot;);</span>
<span class="nc" id="L517">		parentPC.addComponent(theListPC);</span>

<span class="nc" id="L519">		return theListPC;</span>
	}

	private void handlePopulateContainerError(String rbKey, Exception ex) {
<span class="nc" id="L523">		log.l7dError(rbKey, ex);</span>
<span class="nc" id="L524">		addPageMessage(Message.ERROR_TYPE, rbKey,	FsWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L525">	}</span>

	private void addNumData(int num, DefaultMultiColumnNodeData row_data) {
<span class="nc" id="L528">		row_data.add( m_localizer.formatNumber(num), CSSUtil.STYLE_NUMERIC );</span>
<span class="nc" id="L529">	}</span>

}//class ScheduleSummaryPM
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>