<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>TimeBankSummaryPC.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.fs.schedule.summary</a> &gt; <span class="el_source">TimeBankSummaryPC.java</span></div><h1>TimeBankSummaryPC.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.fs.schedule.summary;

import java.util.ArrayList;
import java.util.Date;
import java.util.ResourceBundle;
import java.util.TimeZone;
import javax.servlet.http.HttpServletRequest;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.l10n.RegionalFormatBundleKey;
import com.bluepumpkin.common.logging.Category;
import com.bluepumpkin.common.util.BPMessageFormat;
import com.bluepumpkin.web.fs.Log;
import com.bluepumpkin.web.fs.l10n.FsWebBundleKey;
import com.witness.web.uif.base.Message;
import com.witness.web.uif.pagecomponent.DefaultMultiColumnNodeData;
import com.witness.web.uif.pagecomponent.container.CollapsibleContainerPC;
import com.witness.web.uif.pagecomponent.list.MultiColListPC;
import com.witness.web.uif.pagecomponent.table.TableHeaderPC;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.util.html.CSSUtil;

/**
 * Title:        TimeBankSummaryPC
 * Description:  Display Time Bank Summary
 * Copyright:    Copyright (c) 2009
 * Company:      Verint Systems, Inc
 * @author       Gonzalo Quintanar
 */
public class TimeBankSummaryPC extends CollapsibleContainerPC {
<span class="nc" id="L31">    private static Category m_log = Log.initCategory(TimeBankSummaryPC.class.getName());</span>

    private final ResourceBundle m_bundle;
    private final ID m_empID;
    private final String m_empName;//Show employee name on title, if it's not set to null
<span class="nc" id="L36">    private boolean m_isAgentView = true;</span>
    private TimeBankSummaryData m_tbSummary;
    
    //Time Banking column headers for agent view
<span class="nc" id="L40">    private static final String[] TB_HEADER_RB_KEYS_AGENT = new String[] {</span>
        FsWebBundleKey.SUMMARY_TB_TARGET_HOURS,
        FsWebBundleKey.SUMMARY_TB_PR_TARGET_HOURS,
        FsWebBundleKey.SUMMARY_TB_SCHEDULED_HOURS,
        FsWebBundleKey.SUMMARY_TB_ADJUSTED_HOURS,
        FsWebBundleKey.SUMMARY_TB_BALANCE_HOURS
    };
    
    //Time Banking column headers for manager view
<span class="nc" id="L49">    private static final String[] TB_HEADER_RB_KEYS_MANAGER = new String[] {</span>
        FsWebBundleKey.SUMMARY_TB_NAME,
        FsWebBundleKey.SUMMARY_TB_TARGET_HOURS,
        FsWebBundleKey.SUMMARY_TB_PR_TARGET_HOURS,
        FsWebBundleKey.SUMMARY_TB_SCHEDULED_HOURS,
        FsWebBundleKey.SUMMARY_TB_ADJUSTED_HOURS,
        FsWebBundleKey.SUMMARY_TB_BALANCE_HOURS
    };

    //Time Banking column headers for agent view for when no Time Bank was found
<span class="nc" id="L59">    private static final String[] TB_HEADER_RB_KEYS2_AGENT = new String[] {</span>
        FsWebBundleKey.SUMMARY_TB_TARGET_HOURS,
        FsWebBundleKey.SUMMARY_TB_PR_TARGET_HOURS2,
        FsWebBundleKey.SUMMARY_TB_SCHEDULED_HOURS2,
        FsWebBundleKey.SUMMARY_TB_ADJUSTED_HOURS,
        FsWebBundleKey.SUMMARY_TB_BALANCE_HOURS
    };
    //Time Banking column headers for manager view for when no Time Bank was found
<span class="nc" id="L67">    private static final String[] TB_HEADER_RB_KEYS2_MANAGER = new String[] {</span>
        FsWebBundleKey.SUMMARY_TB_NAME,
        FsWebBundleKey.SUMMARY_TB_TARGET_HOURS,
        FsWebBundleKey.SUMMARY_TB_PR_TARGET_HOURS2,
        FsWebBundleKey.SUMMARY_TB_SCHEDULED_HOURS2,
        FsWebBundleKey.SUMMARY_TB_ADJUSTED_HOURS,
        FsWebBundleKey.SUMMARY_TB_BALANCE_HOURS
    };


    /**
     * Creates a new instance of TimeBankummaryPC
     * @param context
     */
    public TimeBankSummaryPC(RequestContext context) {
<span class="nc" id="L82">        this(context, context.getUser().getEmployeeID(), null, true, null);</span>
<span class="nc" id="L83">    }//constructor</span>

    public TimeBankSummaryPC(RequestContext context, ID empID, String empName, boolean isAgentView, TimeBankSummaryData tbSummary) 
    {
<span class="nc" id="L87">        super(context);</span>
<span class="nc" id="L88">        m_bundle = m_localizer.getBundle(FsWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L89">        m_empID = empID;</span>
<span class="nc" id="L90">        m_empName = empName;</span>
<span class="nc" id="L91">        m_isAgentView = isAgentView;</span>
<span class="nc" id="L92">        m_tbSummary = tbSummary;</span>
<span class="nc" id="L93">        setName(&quot;tbSummaryPC_&quot; + m_empID);</span>
<span class="nc" id="L94">    }</span>

    /**
     * Initialize with default Data
     */
    public void init(TimeBankSummaryData tbSummary) 
    {
        try 
        {
<span class="nc" id="L103">            m_tbSummary = tbSummary;</span>
        } 
<span class="nc" id="L105">        catch (Exception ex) </span>
        {
<span class="nc" id="L107">            m_log.l7dError(FsWebBundleKey.MSG_SCHED_SUMMARY_NO_TB_SUMMARY, ex);</span>
<span class="nc" id="L108">            addPageMessage(Message.ERROR_TYPE, FsWebBundleKey.MSG_SCHED_SUMMARY_NO_TB_SUMMARY,</span>
                    FsWebBundleKey.BUNDLE_NAME);
<span class="nc" id="L110">        }   </span>
<span class="nc" id="L111">    }//init</span>

    /**
     * Initialize Component For Display
     */   
    public void initForDisplay() 
    {
<span class="nc bnc" id="L118" title="All 2 branches missed.">        if (m_isInitializedForDisplay) </span>
<span class="nc" id="L119">            return; </span>
        else 
        {        
<span class="nc" id="L122">            super.initForDisplay();</span>
<span class="nc" id="L123">            initContent();</span>
        }
<span class="nc" id="L125">    }//initForDisplay</span>

    /**
     * Initialize Content
     */
    private void initContent() 
    {
<span class="nc" id="L132">        MultiColListPC theListPC = initContianerAndCreateList(m_context, this);</span>
<span class="nc" id="L133">        createTBListModel(theListPC, m_tbSummary);</span>
        String title;
        
<span class="nc bnc" id="L136" title="All 4 branches missed.">        if (m_tbSummary==null || m_tbSummary.getStartDate()==null)</span>
        {
            //no current time bank found
<span class="nc bnc" id="L139" title="All 2 branches missed.">            if (m_isAgentView)</span>
<span class="nc" id="L140">                initHeader(theListPC, TB_HEADER_RB_KEYS2_AGENT);</span>
            else
<span class="nc" id="L142">                initHeader(theListPC, TB_HEADER_RB_KEYS2_MANAGER);</span>
                
<span class="nc bnc" id="L144" title="All 2 branches missed.">            if (m_empName == null)</span>
            {
                //do not show employee name in title
<span class="nc" id="L147">                title = i18n(m_bundle, FsWebBundleKey.SCHED_SUMMARY_TB_SUMMARY2);</span>
            }
            else
            {
                //show employee name in title
<span class="nc" id="L152">                String template = i18n(m_bundle, FsWebBundleKey.SCHED_SUMMARY_TB_SUMMARY2_EMP);</span>
<span class="nc" id="L153">                Object[] args = new Object[] {m_empName};     </span>
<span class="nc" id="L154">                title = BPMessageFormat.format(template, args);</span>
<span class="nc" id="L155">            }</span>
        }
        else
        {
            //get the &quot;up to&quot; date
<span class="nc" id="L160">            Date prDate = new Date(m_tbSummary.getProRateDate().getTime()-1); //subtract 1 millisecond to get the end of the previous day</span>
<span class="nc" id="L161">            String proRateDate =  m_localizer.formatDate(prDate,</span>
<span class="nc" id="L162">                    m_context.getViewingTimeZone(),RegionalFormatBundleKey.DATE_FORMAT);</span>
            
<span class="nc bnc" id="L164" title="All 2 branches missed.">            if (m_isAgentView)</span>
<span class="nc" id="L165">                initHeader(theListPC, TB_HEADER_RB_KEYS_AGENT, proRateDate);</span>
            else
<span class="nc" id="L167">                initHeader(theListPC, TB_HEADER_RB_KEYS_MANAGER, proRateDate);</span>
                                
            
            String template;            
<span class="nc bnc" id="L171" title="All 2 branches missed.">            if (m_empName == null)</span>
            {
                //do not show employee name in title
<span class="nc" id="L174">                template = i18n(m_bundle, FsWebBundleKey.SCHED_SUMMARY_TB_SUMMARY);</span>
            }
            else
            {
                //show employee name in title
<span class="nc" id="L179">                template = i18n(m_bundle, FsWebBundleKey.SCHED_SUMMARY_TB_SUMMARY_EMP);</span>
            }
            
<span class="nc" id="L182">            TimeZone tbTimeZone = m_context.getViewingTimeZone(); //TimeZone.getTimeZone(&quot;GMT&quot;);</span>
<span class="nc" id="L183">            String start =  m_localizer.formatDate(m_tbSummary.getStartDate(),</span>
                    tbTimeZone, RegionalFormatBundleKey.DATE_FORMAT);
<span class="nc" id="L185">            String end =  m_localizer.formatDate(m_tbSummary.getEndDate(),</span>
                    tbTimeZone, RegionalFormatBundleKey.DATE_FORMAT);
<span class="nc" id="L187">            Object[] args = new Object[] {start, end, m_empName};     </span>
<span class="nc" id="L188">            title = BPMessageFormat.format(template, args);</span>
        }
        
<span class="nc" id="L191">        setTitle(title);</span>
<span class="nc" id="L192">    }//initContent</span>

    /**
     * set Time Banking Summary List model
     */
    private void createTBListModel(MultiColListPC theListPC, TimeBankSummaryData tbsData)
    {
<span class="nc bnc" id="L199" title="All 2 branches missed.">        if (tbsData == null) </span>
<span class="nc" id="L200">            return;</span>

        // Create the list model
<span class="nc" id="L203">        ArrayList listModel = new ArrayList(1);</span>
<span class="nc" id="L204">        DefaultMultiColumnNodeData row_data = new DefaultMultiColumnNodeData();</span>
        
<span class="nc bnc" id="L206" title="All 2 branches missed.">        if (!m_isAgentView)</span>
<span class="nc" id="L207">            addStringData(tbsData.getTimeBankName(), row_data);</span>
        
<span class="nc" id="L209">        addDurationData(tbsData.getTargetHours(), row_data);</span>
<span class="nc" id="L210">        addDurationData(tbsData.getPrTargetHours(), row_data);</span>
<span class="nc" id="L211">        addDurationData(tbsData.getScheduledHours(), row_data);</span>
<span class="nc" id="L212">        addDurationData(tbsData.getAdjustedHours(), row_data);</span>
<span class="nc" id="L213">        addDurationData(tbsData.getBalance(), row_data);</span>

<span class="nc" id="L215">        listModel.add(row_data);</span>
<span class="nc" id="L216">        theListPC.setListModel(listModel);</span>
<span class="nc" id="L217">    }//createTBListModel</span>


    public boolean extractParameters(HttpServletRequest request) 
    {
<span class="nc" id="L222">        boolean result = super.extractParameters(request);</span>
<span class="nc" id="L223">        return result;</span>
    }
    
    private void initHeader(MultiColListPC theListPC, String[] rbKeys){
<span class="nc" id="L227">        TableHeaderPC header = theListPC.getHeader();</span>
<span class="nc bnc" id="L228" title="All 2 branches missed.">        for(int i=0; i&lt;rbKeys.length; i++) {</span>
<span class="nc" id="L229">            String label = i18n(m_bundle,rbKeys[i]);</span>
<span class="nc" id="L230">            header.addColumnHeaderData(null, label, CSSUtil.CLASS_INNER_HEADER_BORDER_NUMERIC);</span>
        }
<span class="nc" id="L232">    }</span>
    
    private void initHeader(MultiColListPC theListPC, String[] rbKeys, String upToDate)
    {
<span class="nc" id="L236">        TableHeaderPC header = theListPC.getHeader();</span>
<span class="nc bnc" id="L237" title="All 2 branches missed.">        for(int i=0; i&lt;rbKeys.length; i++) </span>
        {
<span class="nc" id="L239">            String template = i18n(m_bundle,rbKeys[i]);</span>
<span class="nc" id="L240">            Object[] args = new Object[] {upToDate};     </span>
<span class="nc" id="L241">            String label = BPMessageFormat.format(template, args);            </span>
<span class="nc" id="L242">            header.addColumnHeaderData(null, label, CSSUtil.CLASS_INNER_HEADER_BORDER_NUMERIC);</span>
        }
<span class="nc" id="L244">    }</span>

    private static final MultiColListPC initContianerAndCreateList(RequestContext context, CollapsibleContainerPC parentPC) 
    {
        // List for Display purpose
<span class="nc" id="L249">        MultiColListPC theListPC = new MultiColListPC(context,false);</span>
<span class="nc" id="L250">        theListPC.setEnabled(false);</span>
<span class="nc" id="L251">        theListPC.setHasRowHeaders(false); //508</span>

        // Initialize Container
<span class="nc" id="L254">        parentPC.setStyleClass(CSSUtil.CLASS_BORDER_DEFAULT);</span>
<span class="nc" id="L255">        parentPC.setTemplate(&quot;{0}&quot;);</span>
<span class="nc" id="L256">        parentPC.addComponent(theListPC);</span>

<span class="nc" id="L258">        return theListPC;</span>
    }

    private void addDurationData(int num, DefaultMultiColumnNodeData row_data) {
<span class="nc" id="L262">        row_data.add( m_localizer.formatDurationInMins(num), CSSUtil.STYLE_NUMERIC );</span>
<span class="nc" id="L263">    }</span>
    
    private void addStringData(String name, DefaultMultiColumnNodeData row_data) {
<span class="nc" id="L266">        row_data.add( name, CSSUtil.STYLE_NUMERIC );</span>
<span class="nc" id="L267">    }</span>

}//class
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>