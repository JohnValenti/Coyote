<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>QueueModelHandler.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.bbm.workload.queue</a> &gt; <span class="el_source">QueueModelHandler.java</span></div><h1>QueueModelHandler.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.bbm.workload.queue;

/**
 * Title:        QueueModelHandler
 * Description:  Get and Populate the OrganizationPageModel.
 * Copyright:    Copyright (c) 2001
 * Company:      Blue Pumpkin Software, inc
 * @author       Sankar R V
 * @version      1.0
 */

import java.rmi.RemoteException;
import java.util.ArrayList;
import java.util.Collection;
import java.util.Collections;
import java.util.Iterator;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.StringsPair;
/*//TODO[DS] - Need to be refactored to support modular build: 
import com.bluepumpkin.ejb.am.AmEJBCreateException;
import com.bluepumpkin.ejb.am.AmManagerFactory;
import com.bluepumpkin.ejb.am.vct.ejb.VCTManager;
 */
import com.bluepumpkin.ejb.bbm.base.BbmException;
import com.bluepumpkin.web.bbm.workload.WorkloadModelHandler;
import com.bluepumpkin.web.bbm.workresource.WorkResourceModelHandler;
import com.witness.web.uif.system.RequestContext;


/**
 * Model handler for model &quot;OrganizationPageModel&quot;.
 * This class is used to retrieve a model from the cache, and use EJB managers to get value objects
 * into the model, and update the database by building value objects from the model data.
 * If you wish to automate model pre-loading via the xml &quot;load-model&quot; mapping,
 * you must include the getModel() method.
 * The page model contains certain members which correspond to jsp page data elements, like a pagebean.
 * It is vital that all of these members are set properly in the model either via getModel() the first
 * time the model is created, or via extractParameters() from the request handler, because the
 * model data is loaded from the EJB facade by using the model's &quot;pagebean-like&quot; members.
 * For example, the model data may include a list of all organizations which are children of an org id
 * entered from the jsp page.  When getModel() is called and finds that a new model must be created,
 * the value of &quot;selectedOrgId&quot; could be set to ROOT_ORG_ID via the setModelPageDefaults() method,
 * and to the value of &quot;selectedOrgId&quot; from the jsp page when its request handler executed the
 * extractParameters() method.  When getting a model from the request cache, it is assumed that a
 * request handler has already populated the model with the jsp pagebean elements from the request.&lt;br&gt;&lt;br&gt;
 * EJB accessors:
 *  Get Value Object: Collection of Organizations
 *  Put Value Object: Organization
 *  Delete Value Object: List of Org Ids
 * todo exceptions and errors need proper handling or direction back to mainservlet.
 * todo handle BbmCreateException and BbmDeleteException here.
 * todo Possible synchronization of tree on root node, since it is not thread-safe(?)
 */
<span class="nc" id="L55">public class QueueModelHandler extends WorkResourceModelHandler {</span>

	/**
	 * Return Queue Objects assigned to specified Campaign for the time range
	 * @param isSubQueuesIncluded - Specify whether Sub Queues are included
	 */
	public static Collection getQueuesAssignedToOrganization(RequestContext context, ID organizationID, boolean isSubQueuesIncluded) throws RemoteException, BbmException {
<span class="nc" id="L62">		Collection queues = Collections.EMPTY_LIST;</span>

<span class="nc" id="L64">		Collection queueIDs = getQueueIDsAssignedToOrganization(context, organizationID);</span>
		
<span class="nc bnc" id="L66" title="All 2 branches missed.">		if (!queueIDs.isEmpty()) {</span>
			// Fetch Sub Queue ID as well if needed
<span class="nc bnc" id="L68" title="All 2 branches missed.">			if (isSubQueuesIncluded) {</span>
<span class="nc" id="L69">				Collection subQueueIDs = WorkloadModelHandler.getSubQueues(context, queueIDs);</span>
<span class="nc bnc" id="L70" title="All 2 branches missed.">				if (!subQueueIDs.isEmpty()) {</span>
<span class="nc" id="L71">					ArrayList tmpQIDs = new ArrayList(queueIDs.size() + subQueueIDs.size());</span>
<span class="nc" id="L72">					tmpQIDs.addAll(queueIDs);</span>
<span class="nc" id="L73">					tmpQIDs.addAll(subQueueIDs);</span>
<span class="nc" id="L74">					queueIDs = tmpQIDs;</span>
				}
			}

<span class="nc" id="L78">			queues = WorkloadModelHandler.getQueuesByIDs(context, queueIDs);</span>
		}

<span class="nc" id="L81">		return queues;</span>
	}
	
	public static Collection getQueuesAssignedToOrganizations(RequestContext context, Collection orgIDs, boolean isSubQueuesIncluded)  throws RemoteException, BbmException {
<span class="nc" id="L85">		Collection queues = Collections.EMPTY_LIST;</span>
<span class="nc" id="L86">		Collection queueIDs = getQueueIDsAssignedToOrganizations(context, orgIDs);</span>
		
<span class="nc bnc" id="L88" title="All 4 branches missed.">		if (queueIDs != null &amp;&amp; !queueIDs.isEmpty()) {</span>
			// Fetch Sub Queue ID as well if needed
<span class="nc bnc" id="L90" title="All 2 branches missed.">			if (isSubQueuesIncluded) {</span>
<span class="nc" id="L91">				Collection subQueueIDs = WorkloadModelHandler.getSubQueues(context, queueIDs);</span>
<span class="nc bnc" id="L92" title="All 2 branches missed.">				if (!subQueueIDs.isEmpty()) {</span>
<span class="nc" id="L93">					ArrayList tmpQIDs = new ArrayList(queueIDs.size() + subQueueIDs.size());</span>
<span class="nc" id="L94">					tmpQIDs.addAll(queueIDs);</span>
<span class="nc" id="L95">					tmpQIDs.addAll(subQueueIDs);</span>
<span class="nc" id="L96">					queueIDs = tmpQIDs;</span>
				}
			}

<span class="nc" id="L100">			queues = WorkloadModelHandler.getQueuesByIDs(context, queueIDs);</span>
		}

<span class="nc" id="L103">		return queues;</span>
	}
	
	
	public static Collection getQueueIDsAssignedToOrganizations(RequestContext context, Collection orgIDs) throws RemoteException, BbmException {
<span class="nc" id="L108">		Collection queueList = Collections.EMPTY_LIST;</span>
		//TODO[DS] - Need to be refactored to support modular build:  queueList = getQueueOrgManager().getQueuesAssignedToOrganizations(orgIDs);
		
<span class="nc" id="L111">		return queueList;</span>
	}
	
	/**
	 * Return Queue ID Objects assigned to specified Campaign for the time range
	 */
	public static Collection getQueueIDsAssignedToOrganization(RequestContext context, ID organizationID) throws RemoteException, BbmException {
<span class="nc" id="L118">		Collection queueList = Collections.EMPTY_LIST;</span>
		//TODO[DS] - Need to be refactored to support modular build: queueList = getQueueOrgManager().getQueuesAssignedToOrganization(organizationID);
		
<span class="nc" id="L121">		return queueList;</span>
	}
	

	public static Collection getAllQueuesAssigedToOrganizations(RequestContext context) throws RemoteException , BbmException {
<span class="nc" id="L126">		ArrayList queueIDs = new ArrayList();</span>
<span class="nc" id="L127">		Collection queueDetails = null;//TODO[DS] - Need to be refactored to support modular build: getQueueOrgManager().getAllTrackedQueues();</span>
<span class="nc bnc" id="L128" title="All 2 branches missed.">		if(queueDetails == null)</span>
<span class="nc" id="L129">			return queueIDs;</span>
<span class="nc" id="L130">		Iterator eachQueue = queueDetails.iterator();</span>
<span class="nc bnc" id="L131" title="All 2 branches missed.">		while(eachQueue.hasNext()) {</span>
<span class="nc" id="L132">			Object temp = eachQueue.next();</span>
<span class="nc" id="L133">			StringsPair pair = (StringsPair)temp;</span>
<span class="nc" id="L134">			queueIDs.add(new ID(pair.getKey()));</span>
			
			
<span class="nc" id="L137">		}</span>
	
<span class="nc" id="L139">		return WorkloadModelHandler.getQueuesByIDs(context, queueIDs);</span>
	}
	
	
	/*//TODO[DS] - Need to be refactored to support modular build: 
	public static VCTManager getQueueOrgManager() throws BbmException {
		VCTManager m_vctManager = null;
		try {
			m_vctManager = AmManagerFactory.getVCTManager();
		} catch (AmEJBCreateException e) {
			return m_vctManager;
		}
		return m_vctManager;
	}*/
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>