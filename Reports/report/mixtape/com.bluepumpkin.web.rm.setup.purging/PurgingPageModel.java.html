<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>PurgingPageModel.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.rm.setup.purging</a> &gt; <span class="el_source">PurgingPageModel.java</span></div><h1>PurgingPageModel.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.rm.setup.purging;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.LocalDate;
import com.bluepumpkin.common.datatypes.StringsPair;

import com.bluepumpkin.common.logging.Category;

import com.witness.ejb.core.security.PrivilegeKeys;

import com.bluepumpkin.web.bbm.organization.OrgWorkpaneFormPageModel;
import com.bluepumpkin.web.bbm.l10n.BbmWebBundleKey;

import com.witness.web.uif.base.*;
import com.witness.web.uif.keys.*;
import com.witness.web.uif.l10n.UIFWebBundleKey;
import com.witness.web.uif.pagecomponent.container.ListContainerPC;
import com.witness.web.uif.pagecomponent.picker.date.DateRangePickerPC;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.util.HtmlUtil;
import com.witness.web.uif.util.html.HtmlChoiceInput;
import com.witness.web.uif.util.js.*;
import com.witness.web.uif.validator.IsPosIntegerFieldValidator;
import com.witness.web.uif.pagemodel.PageModel;

import com.bluepumpkin.web.rm.Log;
import com.bluepumpkin.web.rm.l10n.RmWebBundleKey;
import com.bluepumpkin.ejb.bbm.workresource.OrganizationScopeManagerProxy;

import java.util.*;
import javax.servlet.http.HttpServletRequest;

/**
 * Title          PurgingPageModel
 * Description    Displays the Purging page
 * Copyright      Copyright (c) 2002
 * Company        Blue Pumpkin Software, Inc
 * @author        Howard Mullings
 * @version       1.0
 */
@SuppressWarnings(&quot;serial&quot;)
public class PurgingPageModel extends OrgWorkpaneFormPageModel {
<span class="fc" id="L43">	private static final Category m_log = Log.initCategory(PurgingPageModel.class.getName());</span>

	private static final String REQUEST_TYPE_FN  = &quot;requestType&quot;;
	private static final String WHAT_REQUEST_FN  = &quot;whatRequest&quot;;
	private static final String APPLY_DELETE_FN  = &quot;applyDelete&quot;;
	private static final String ADVANCE_COUNT_FN = &quot;advanceCount&quot;;
	private static final String DATE_RANGE_FN    = &quot;dateRange&quot;;
	private static final String REQUEST_START_DATE_RANGE_FN    = &quot;requestStartDateRange&quot;;

	public static final String WHAT_REQ_DATE_VAL = &quot;dates&quot;;
	public static final String WHAT_REQ_All_VAL = &quot;allTypes&quot;;
	public static final String WHAT_REQ_ADVANCE_DAYS_VAL = &quot;advanceDays&quot;;
	public static final String WHAT_REQ_START_DATE_VAL = &quot;startDates&quot;;
	public static final String APPLY_TO_CURRENT_ORGANIZATION_VAL = &quot;0&quot;;
	public static final String APPLY_TO_ORGANIZATION_BRANCH_VAL = &quot;1&quot;;

<span class="fc" id="L59">	private HashMap           m_reqData = new HashMap(13);</span>
	private DateRangePickerPC m_dateRangePC;
	private DateRangePickerPC m_startDateRangePC;
	@SuppressWarnings(&quot;rawtypes&quot;)
	private List              m_requestTypes;
	private ListContainerPC   m_purgingPC;
	private ResourceBundle    m_rmBundle;

	/**
	 * Constuctor
	 */
	public PurgingPageModel(RequestContext context) {
<span class="fc" id="L71">		super(context);</span>

<span class="fc" id="L73">		m_rmBundle = m_localizer.getBundle(RmWebBundleKey.BUNDLE_NAME);</span>

		// Component specific required JavaScript Files
<span class="fc" id="L76">		addRequiredJavaScriptFile(JavaScriptFileID.MEDIATOR_WORKPANE);</span>
<span class="fc" id="L77">		setJSMediator(JavaScriptFileID.MEDIATOR_WORKPANE_GENERIC);</span>

<span class="fc" id="L79">		addJSVariable(DELETE_CONFIRMATION,</span>
				m_rmBundle,
				RmWebBundleKey.PURGE_REQUEST_CONFIRMATION);

<span class="fc" id="L83">		m_purgingPC = new ListContainerPC(m_context);</span>

<span class="fc" id="L85">		m_dateRangePC = new DateRangePickerPC(context,</span>
				DATE_RANGE_FN,
<span class="fc" id="L87">				context.getViewingTimeZone());</span>

<span class="fc" id="L89">		m_startDateRangePC = new DateRangePickerPC(context,</span>
				REQUEST_START_DATE_RANGE_FN,
<span class="fc" id="L91">				context.getViewingTimeZone());</span>

<span class="fc" id="L93">		addChildComponent(m_purgingPC);</span>
<span class="fc" id="L94">		addChildComponent(m_dateRangePC);</span>
<span class="fc" id="L95">		addChildComponent(m_startDateRangePC);</span>
<span class="fc" id="L96">		setIsIgnorePageDirty(false);</span>
<span class="fc" id="L97">	}</span>

	/**
	 * Return an instance of PurgingPageModel ready to be rendered in JSP
	 * @param   context RequestContext
	 * @return  PurgingPageModel  instance of PurgingPageModel
	 */
	public static PageModel getInstance(RequestContext context) throws Exception {
<span class="fc" id="L105">		return getInstance(context, PurgingPageModel.class);</span>
	}

	/**
	 * Create Form Model
	 */
	protected void createFormModel() {
		try {
<span class="pc bpc" id="L113" title="1 of 2 branches missed.">			if (!isAuthorizedToConfigure()) {</span>
				String key;
<span class="nc" id="L115">				key = BbmWebBundleKey.NOT_AUTHORIZED_TO_CONFIG_SELECTED_ORG;</span>
<span class="nc" id="L116">				String msg = i18n(m_bbmBundle, key);</span>
<span class="nc" id="L117">				addPageMessage(Message.RESPONSE_TYPE, msg);</span>
			}

			// Get the request type list data
<span class="fc" id="L121">			m_requestTypes = PurgingModelHandler.getRequestTypes(getSelectedIDObject(),</span>
					m_rmBundle, m_localizer);
<span class="nc" id="L123">		} catch (Exception ex) {</span>
<span class="nc" id="L124">			handleUnableToLoadDataError(m_log, ex);</span>
<span class="fc" id="L125">		}</span>
<span class="fc" id="L126">	}</span>

	/**
	 * Initialize Form Display, sets the form elements
	 */
	protected void initForm() {
<span class="fc" id="L132">		setForm(m_purgingPC);</span>
<span class="fc" id="L133">		m_purgingPC.setTitle(getFormTitle());</span>
<span class="pc bpc" id="L134" title="2 of 4 branches missed.">		if (m_requestTypes == null || m_requestTypes.size() == 0)  {</span>
<span class="nc" id="L135">			return;</span>
		}

<span class="fc" id="L138">		ArrayList applyToList = getApplyOrgStatus();</span>


		// The requestType array list is assumed to have items in the
		// following order:
		// 1) All
		// 2) Shift Bid
		// 3) Shift swap
		// 4) Custom Shift
		// 5) Time Off	 *
		// 6) Flex Time *
		//
		// When shift bidding is added this logic must be changed.
<span class="pc bpc" id="L151" title="4 of 6 branches missed.">		if (isAuthorizedToConfigureTOM() &amp;&amp; isAuthorizedToConfigureFT() &amp;&amp; isAuthorizedToConfigureSS() &amp;&amp;</span>
<span class="nc bnc" id="L152" title="All 4 branches missed.">				isAuthorizedToConfigureSB() &amp;&amp; isAuthorizedToConfigureCS()) {</span>
			// no modifications are necessary since the user is authorized to
			// do everything.

			@SuppressWarnings(&quot;unchecked&quot;)
<span class="nc" id="L157">			List&lt;StringsPair&gt; timeOffEntries = (List&lt;StringsPair&gt;) m_requestTypes.remove(4); // remove 'time-off' entries</span>
			@SuppressWarnings(&quot;unchecked&quot;)
<span class="nc" id="L159">			List&lt;StringsPair&gt; flexTimeEntries = (List&lt;StringsPair&gt;) m_requestTypes.remove(4); // remove 'flex-time' entries</span>
<span class="nc" id="L160">			m_requestTypes.addAll(timeOffEntries);</span>
<span class="nc" id="L161">			m_requestTypes.addAll(flexTimeEntries);</span>
<span class="pc bpc" id="L162" title="5 of 6 branches missed.">		} else if (!isAuthorizedToConfigureTOM() &amp;&amp; !isAuthorizedToConfigureFT() &amp;&amp; !isAuthorizedToConfigureSS() &amp;&amp;</span>
<span class="nc bnc" id="L163" title="All 4 branches missed.">				!isAuthorizedToConfigureSB() &amp;&amp; !isAuthorizedToConfigureCS()) {</span>
			// not authorized to purge anything...
<span class="nc" id="L165">			m_requestTypes.clear();</span>
<span class="nc" id="L166">			applyToList.clear();</span>
		}
		else {
<span class="fc" id="L169">			m_requestTypes.remove(0); // remove 'all'</span>
<span class="fc" id="L170">			StringsPair shiftBidEntry = (StringsPair) m_requestTypes.remove(0); // remove 'shift-bid'</span>
<span class="fc" id="L171">			StringsPair shiftSwapEntry = (StringsPair) m_requestTypes.remove(0); // remove 'shift-swap'</span>
<span class="fc" id="L172">			StringsPair customShiftEntry = (StringsPair) m_requestTypes.remove(0); // remove 'cust-shift'</span>
			@SuppressWarnings(&quot;unchecked&quot;)
<span class="fc" id="L174">			List&lt;StringsPair&gt; timeOffEntries = (List&lt;StringsPair&gt;) m_requestTypes.remove(0); // remove 'time-off' entries</span>
			@SuppressWarnings(&quot;unchecked&quot;)
<span class="fc" id="L176">			List&lt;StringsPair&gt; flexTimeEntries = (List&lt;StringsPair&gt;) m_requestTypes.remove(0); // remove 'flex-time' entries</span>
<span class="fc" id="L177">			List&lt;Object&gt; newRequestTypes = new ArrayList&lt;Object&gt;();</span>
<span class="pc bpc" id="L178" title="1 of 2 branches missed.">			if (isAuthorizedToConfigureSB()) {</span>
<span class="fc" id="L179">				newRequestTypes.add(shiftBidEntry);</span>
			}

<span class="pc bpc" id="L182" title="1 of 2 branches missed.">			if (isAuthorizedToConfigureSS()) {</span>
<span class="fc" id="L183">				newRequestTypes.add(shiftSwapEntry);</span>
			}

<span class="pc bpc" id="L186" title="1 of 2 branches missed.">			if (isAuthorizedToConfigureCS()) {</span>
<span class="fc" id="L187">				newRequestTypes.add(customShiftEntry);</span>
			}

<span class="pc bpc" id="L190" title="1 of 2 branches missed.">			if (isAuthorizedToConfigureTOM()) {</span>
<span class="fc" id="L191">				newRequestTypes.addAll(timeOffEntries);</span>
			}

<span class="pc bpc" id="L194" title="1 of 2 branches missed.">			if (isAuthorizedToConfigureFT()) {</span>
<span class="nc" id="L195">				newRequestTypes.addAll(flexTimeEntries);</span>
			}

<span class="fc" id="L198">			m_requestTypes = newRequestTypes;</span>
		}

<span class="fc" id="L201">		String selReqTypeValue = &quot;&quot;;</span>
<span class="fc" id="L202">		String selApplyValue = &quot;&quot;;</span>
<span class="pc bpc" id="L203" title="1 of 2 branches missed.">		if (m_requestTypes.size() != 0)</span>
<span class="fc" id="L204">			selReqTypeValue = ((StringsPair)m_requestTypes.get(0)).getValue();</span>

<span class="pc bpc" id="L206" title="1 of 2 branches missed.">		if (applyToList.size() != 0)</span>
<span class="fc" id="L207">			selApplyValue = ((StringsPair)applyToList.get(0)).getValue();</span>

		// add the selection row that contains the Request Type list and the apply to list
<span class="fc" id="L210">		Object args[] = new Object[]{</span>
<span class="fc" id="L211">			HtmlUtil.makeSelectInput(REQUEST_TYPE_FN,selReqTypeValue,m_requestTypes),</span>
<span class="fc" id="L212">			HtmlUtil.makeSelectInput(APPLY_DELETE_FN,selApplyValue,applyToList)</span>
			};
<span class="fc" id="L214">		String strRow = m_localizer.i18n(m_rmBundle,RmWebBundleKey.ORG_RM_PURGING_TYPE_AND_ORG_PHRASE, args);</span>
<span class="fc" id="L215">		m_purgingPC.addRowData(strRow);</span>

		// add the selection row that contains the All option
<span class="fc" id="L218">		m_purgingPC.addRowData(</span>
<span class="fc" id="L219">				HtmlChoiceInput.makeRadioInput(WHAT_REQUEST_FN,</span>
					WHAT_REQUEST_FN,
					&quot; &quot;,
					false,
<span class="pc bpc" id="L223" title="1 of 2 branches missed.">					!isAuthorizedToConfigure(),</span>
					JSUtil.ON_CHANGE)
<span class="fc" id="L225">				+ i18n(m_rmBundle,RmWebBundleKey.ORG_RM_PURGING_ALL_REQ_LABEL));</span>

		// add the selection row that contains the Advance Days option
<span class="fc" id="L228">		args = new Object[]{</span>
<span class="fc" id="L229">			HtmlUtil.makeTextInput(ADVANCE_COUNT_FN,5,3,&quot;14&quot;,JSUtil.ON_CHANGE,isAuthorizedToConfigure())</span>
			};
<span class="fc" id="L231">		String label = m_localizer.i18n(m_rmBundle, RmWebBundleKey.ORG_RM_PURGING_PAST_DAYS_PHRASE,args);</span>
<span class="fc" id="L232">		m_purgingPC.addRowData(</span>
<span class="fc" id="L233">				HtmlChoiceInput.makeRadioInput(WHAT_REQUEST_FN,</span>
					WHAT_REQ_ADVANCE_DAYS_VAL,
					&quot; &quot;,
<span class="fc" id="L236">					isAuthorizedToConfigure(),</span>
<span class="pc bpc" id="L237" title="1 of 2 branches missed.">					!isAuthorizedToConfigure(),</span>
					JSUtil.ON_CHANGE)
				+ label);

		// have to call this method before converting this object to a string.
<span class="fc" id="L242">		m_dateRangePC.setIsPickerEnabled(isAuthorizedToConfigure());</span>
<span class="fc" id="L243">		m_dateRangePC.initForDisplay();</span>

		// add the selection row that contains the Date range option
<span class="fc" id="L246">		args = new Object[]{m_dateRangePC};</span>
<span class="fc" id="L247">		label = m_localizer.i18n(m_rmBundle,RmWebBundleKey.ORG_RM_PURGING_FROM_TO_PHRASE,args);</span>
<span class="fc" id="L248">		m_purgingPC.addRowData(</span>
<span class="fc" id="L249">				HtmlChoiceInput.makeRadioInput(WHAT_REQUEST_FN,</span>
					WHAT_REQ_DATE_VAL,
					&quot; &quot;,
					false,
<span class="pc bpc" id="L253" title="1 of 2 branches missed.">					!isAuthorizedToConfigure(),</span>
					JSUtil.ON_CHANGE)
				+ label);

		//purge requests starting during range
		//		 have to call this method before converting this object to a string.
<span class="fc" id="L259">		m_startDateRangePC.setIsPickerEnabled(isAuthorizedToConfigure());</span>
<span class="fc" id="L260">		m_startDateRangePC.initForDisplay();</span>

		// add the selection row that contains the Date range option
<span class="fc" id="L263">		args = new Object[]{m_startDateRangePC};</span>
<span class="fc" id="L264">		label = m_localizer.i18n(m_rmBundle,RmWebBundleKey.ORG_RM_PURGING_FROM_TO_REQ_START_PHRASE,args);</span>
<span class="fc" id="L265">		m_purgingPC.addRowData(</span>
<span class="fc" id="L266">				HtmlChoiceInput.makeRadioInput(WHAT_REQUEST_FN,</span>
						WHAT_REQ_START_DATE_VAL,
					&quot; &quot;,
					false,
<span class="pc bpc" id="L270" title="1 of 2 branches missed.">					!isAuthorizedToConfigure(),</span>
					JSUtil.ON_CHANGE)
				+ label);

<span class="fc" id="L274">		m_purgingPC.setLastRowType(ListContainerPC.LAST_ROW_NONE);</span>
<span class="fc" id="L275">	}</span>


	/**
	 * Set Request Type Name
	 * @param   name String
	 */
	public void setRequestType(String name) {
<span class="fc" id="L283">		m_reqData.put(&quot;REQUEST_TYPE_FN&quot;,name);</span>
<span class="fc" id="L284">	}</span>

	/**
	 * Returns the request type selected
	 * @return  String Identifes the request type
	 */
	public String getRequestType() {
<span class="fc" id="L291">		return (String)m_reqData.get(&quot;REQUEST_TYPE_FN&quot;);</span>
	}

	/**
	 * Sets the OrganizationID
	 * @param orgID	Identifies the OrganizationID
	 */
	public void setOrgID(ID orgID) {
<span class="fc" id="L299">		m_reqData.put(&quot;ORGANIZATION_ID&quot;,orgID);</span>
<span class="fc" id="L300">	}</span>

	/**
	 * Gets the OrganizationID
	 * @return  ID Identifes the OrganizationID
	 */
	public ID getOrgID() {
<span class="fc" id="L307">		return (ID)m_reqData.get(&quot;ORGANIZATION_ID&quot;);</span>
	}


	/**
	 * Identifies if the request is applied to the current organization or the branch
	 * @param   name String
	 */
	public void setApplyDelete(String name) {
<span class="fc" id="L316">		m_reqData.put(&quot;APPLY_DELETE_FN&quot;,name);</span>
<span class="fc" id="L317">	}</span>

	/**
	 * @return  String
	 */
	public String getApplyDelete() {
<span class="fc" id="L323">		return (String)m_reqData.get(&quot;APPLY_DELETE_FN&quot;);</span>
	}

	public boolean isForBranch() {
<span class="fc" id="L327">		return getApplyDelete().equals(APPLY_TO_ORGANIZATION_BRANCH_VAL);</span>
	}


	/**
	 * Sets the Request subtype
	 * @param   name String Identifies the Request subtype
	 */
	public void setWhatRequest(String name) {
<span class="fc" id="L336">		m_reqData.put(&quot;WHAT_REQUEST_FN&quot;,name);</span>
<span class="fc" id="L337">	}</span>

	/**
	 * Returns the Request subtype selected
	 * @return  String Identifies the Request subtype
	 */
	public String getWhatRequest() {
<span class="fc" id="L344">		return (String)m_reqData.get(&quot;WHAT_REQUEST_FN&quot;);</span>
	}

	/**
	 * Sets the advance count
	 * @param   name String Identifies the advance count
	 */
	public void setAdvanceCount(String name) {
<span class="fc" id="L352">		m_reqData.put(&quot;ADVANCE_COUNT_FN&quot;,name);</span>
<span class="fc" id="L353">	}</span>

	/**
	 * Returns the advance count
	 * @return  String Identifies the advance count
	 */
	public String getAdvanceCount() {
<span class="fc" id="L360">		return (String)m_reqData.get(&quot;ADVANCE_COUNT_FN&quot;);</span>
	}

	/**
	 * Sets the start date
	 * @param sDate String Identifies the start date
	 */
	public void setStartDate(LocalDate sDate) {
<span class="fc" id="L368">		m_reqData.put(&quot;START_DATE_FN&quot;,sDate);</span>

<span class="fc" id="L370">	}</span>

	/**
	 * Returns the start date
	 * @return  String Identifies the start date
	 */
	public LocalDate getStartDate() {
<span class="fc" id="L377">		return (LocalDate)m_reqData.get(&quot;START_DATE_FN&quot;);</span>
	}

	/**
	 * Sets the end date
	 * @param eDate String Identifies the end date
	 */
	public void setEndDate(LocalDate eDate) {
<span class="fc" id="L385">		m_reqData.put(&quot;END_DATE_FN&quot;,eDate);</span>
<span class="fc" id="L386">	}</span>

	/**
	 * Returns the end date
	 * @return  String Identifies the end date
	 */
	public LocalDate getEndDate() {
<span class="fc" id="L393">		return (LocalDate)m_reqData.get(&quot;END_DATE_FN&quot;);</span>
	}

	/**
	 * Sets the start date
	 * @param sDate String Identifies the start date
	 */
	public void setRequestStartDate(LocalDate sDate) {
<span class="fc" id="L401">		m_reqData.put(&quot;REQUEST_START_DATE_FN&quot;,sDate);</span>

<span class="fc" id="L403">	}</span>

	/**
	 * Returns the request start date
	 * @return  String Identifies the start date
	 */
	public LocalDate getRequestStartDate() {
<span class="nc" id="L410">		return (LocalDate)m_reqData.get(&quot;REQUEST_START_DATE_FN&quot;);</span>
	}

	/**
	 * Sets the request start date
	 * @param sDate String Identifies the start date
	 */
	public void setRequestEndDate(LocalDate sDate) {
<span class="fc" id="L418">		m_reqData.put(&quot;REQUEST_END_DATE_FN&quot;,sDate);</span>

<span class="fc" id="L420">	}</span>

	/**
	 * Returns the request start date
	 * @return  String Identifies the start date
	 */
	public LocalDate getRequestEndDate() {
<span class="nc" id="L427">		return (LocalDate)m_reqData.get(&quot;REQUEST_END_DATE_FN&quot;);</span>
	}

	/**
	 * Initialize the Toolbar
	 * Adds the Delete Requests and Revert button
	 */
	protected void initToolbar() {
<span class="fc" id="L435">		String deleteLabel = i18n(m_rmBundle,</span>
				RmWebBundleKey.ORG_RM_PURGING_DELETE_ACTION);
<span class="fc" id="L437">		String revertLabel = i18n(m_common_bundle,</span>
				UIFWebBundleKey.TOOLBAR_RESET);

<span class="fc" id="L440">		m_toolbar.setName(getName() + &quot;_toolbar&quot;);</span>

<span class="fc" id="L442">		m_toolbar.addDeleteTextButton(PageAction.DELETE,</span>
				deleteLabel,
<span class="fc" id="L444">				isAuthorizedToConfigure());</span>

<span class="fc" id="L446">		m_toolbar.addResetTextButton(PageAction.RESET,</span>
				revertLabel,
<span class="fc" id="L448">				isAuthorizedToConfigure());</span>
<span class="fc" id="L449">	}</span>

	/**
	 * Adds the IntegerFiledValidator for Advance Count Field
	 */
	protected void initFieldValidators() {
		// Add Field Validators
<span class="fc" id="L456">		addValidator(new IsPosIntegerFieldValidator(this,</span>
				ADVANCE_COUNT_FN, RmWebBundleKey.ORG_RM_PURGING_DAYS_SUFFIX_LABEL,
				RmWebBundleKey.BUNDLE_NAME));
<span class="fc" id="L459">	}</span>

	/**
	 * Return the form title
	 * @return form title
	 */
	public String getFormTitle() {
<span class="fc" id="L466">		return i18n(m_rmBundle,RmWebBundleKey.ORG_RM_PURGING_TITLE);</span>
	}

	/**
	 * Gets entity name. Used for title.
	 * @return String Identifies the title entity
	 */
	protected String getTitleEntityType() {
<span class="fc" id="L474">		return getEntityName();</span>
	}

	/**
	 * Returns an entity name. Used for title.
	 * @return String Identifies the entity name
	 */
	protected String getEntityName() {
<span class="fc" id="L482">		return i18n(m_rmBundle, RmWebBundleKey.ORG_RM_PURGING_LABEL);</span>
	}

	/**
	 * Return URL for HTML Form Action
	 */
	public String getFormAction() {
<span class="fc" id="L489">		return &quot;request_processing_purging&quot;;</span>
	}

	/**
	 * Override extract Parameters to handle date input
	 */
	public boolean extractParameters(HttpServletRequest request) {
<span class="fc" id="L496">		boolean success = super.extractParameters(request);</span>

<span class="fc" id="L498">		setOrgID(getSelectedIDObject());</span>

<span class="fc" id="L500">		m_dateRangePC.extractParameters(request);</span>
<span class="fc" id="L501">		setStartDate(m_dateRangePC.getStartDatePickerPC().getLocalDate());</span>
<span class="fc" id="L502">		setEndDate(m_dateRangePC.getEndDatePickerPC().getLocalDate());</span>

<span class="fc" id="L504">		m_startDateRangePC.extractParameters(request);</span>
<span class="fc" id="L505">		setRequestStartDate(m_startDateRangePC.getStartDatePickerPC().getLocalDate());</span>
<span class="fc" id="L506">		setRequestEndDate(m_startDateRangePC.getEndDatePickerPC().getLocalDate());</span>

<span class="fc" id="L508">		return success;</span>
	}

	/**
	 * Custom validation for Start/End Date Range
	 */
	public boolean validate() {
<span class="fc" id="L515">		boolean success = super.validate();</span>

		// Validate Start/End Date Range
<span class="fc" id="L518">		LocalDate startDate = getStartDate();</span>
<span class="fc" id="L519">		LocalDate endDate = getEndDate();</span>

<span class="pc bpc" id="L521" title="3 of 6 branches missed.">		if (startDate != null &amp;&amp; endDate != null &amp;&amp; startDate.after(endDate)) {</span>
<span class="nc" id="L522">			addPageMessage(Message.ERROR_TYPE,</span>
					UIFWebBundleKey.DATE_DEF_ERROR_SDATE_AFTER_EDATE,
					UIFWebBundleKey.BUNDLE_NAME);
<span class="nc" id="L525">			success = false;</span>
		}

<span class="fc" id="L528">		return success;</span>
	}

	/**
	 * Returns a collection of Apply to status
	 */
	private ArrayList getApplyOrgStatus()
	{
<span class="fc" id="L536">		ArrayList applyOrg = new ArrayList();</span>

<span class="fc" id="L538">		applyOrg.add(new StringsPair(APPLY_TO_CURRENT_ORGANIZATION_VAL,</span>
<span class="fc" id="L539">				i18n(m_rmBundle, RmWebBundleKey.ORG_RM_PURGING_CURRENT_ORG)));</span>
<span class="fc" id="L540">		applyOrg.add(new StringsPair(APPLY_TO_ORGANIZATION_BRANCH_VAL,</span>
<span class="fc" id="L541">				i18n(m_rmBundle, RmWebBundleKey.ORG_RM_PURGING_ORG_BRANCH)));</span>

<span class="fc" id="L543">		return applyOrg;</span>
	}

	protected boolean isAuthorizedToView() {
<span class="nc bnc" id="L547" title="All 6 branches missed.">		return isAuthorizedToViewTOM() || isAuthorizedToViewFT() || isAuthorizedToViewSS()</span>
<span class="nc bnc" id="L548" title="All 2 branches missed.">				|| isAuthorizedToViewSB()</span>
<span class="nc bnc" id="L549" title="All 2 branches missed.">				|| isAuthorizedToViewCS();</span>
	}

	protected boolean isAuthorizedToViewTOM() {
<span class="nc bnc" id="L553" title="All 2 branches missed.">		return isValidSelectedOrg() &amp;&amp;</span>
<span class="nc bnc" id="L554" title="All 2 branches missed.">				m_context.getUser().isAuthorized(</span>
<span class="nc" id="L555">						PrivilegeKeys.TOM_PURGEREQUESTS, OrganizationScopeManagerProxy.getScopeID(getSelectedIDObject()));</span>
	}

	protected boolean isAuthorizedToViewFT() {
<span class="nc bnc" id="L559" title="All 2 branches missed.">		return isValidSelectedOrg() &amp;&amp;</span>
<span class="nc bnc" id="L560" title="All 2 branches missed.">				m_context.getUser().isAuthorized(</span>
<span class="nc" id="L561">						PrivilegeKeys.FT_PURGEREQUESTS, OrganizationScopeManagerProxy.getScopeID(getSelectedIDObject()));</span>
	}

	protected boolean isAuthorizedToViewSB() {
<span class="nc bnc" id="L565" title="All 2 branches missed.">		return isValidSelectedOrg() &amp;&amp;</span>
<span class="nc bnc" id="L566" title="All 2 branches missed.">				m_context.getUser().isAuthorized(</span>
<span class="nc" id="L567">						PrivilegeKeys.SB_PURGEREQUESTS, OrganizationScopeManagerProxy.getScopeID(getSelectedIDObject()));</span>
	}

	protected boolean isAuthorizedToViewSS() {
<span class="nc bnc" id="L571" title="All 2 branches missed.">		return isValidSelectedOrg() &amp;&amp;</span>
<span class="nc bnc" id="L572" title="All 2 branches missed.">				m_context.getUser().isAuthorized(</span>
<span class="nc" id="L573">						PrivilegeKeys.SS_PURGEREQUESTS, OrganizationScopeManagerProxy.getScopeID(getSelectedIDObject()));</span>
	}

	protected boolean isAuthorizedToViewCS() {
<span class="nc bnc" id="L577" title="All 2 branches missed.">		return isValidSelectedOrg() &amp;&amp;</span>
<span class="nc bnc" id="L578" title="All 2 branches missed.">				m_context.getUser().isAuthorized(</span>
<span class="nc" id="L579">						PrivilegeKeys.CS_PURGEREQUESTS, OrganizationScopeManagerProxy.getScopeID(getSelectedIDObject()));</span>
	}

	protected boolean isAuthorizedToConfigure() {
<span class="pc bpc" id="L583" title="1 of 2 branches missed.">		return isAuthorizedToConfigureTOM() ||</span>
<span class="nc bnc" id="L584" title="All 2 branches missed.">				isAuthorizedToConfigureFT() ||</span>
<span class="nc bnc" id="L585" title="All 2 branches missed.">				isAuthorizedToConfigureSS() ||</span>
<span class="nc bnc" id="L586" title="All 2 branches missed.">				isAuthorizedToConfigureSB() ||</span>
<span class="pc bnc" id="L587" title="All 2 branches missed.">				isAuthorizedToConfigureCS() ;</span>
	}

	protected boolean isAuthorizedToConfigureTOM() {
<span class="pc bpc" id="L591" title="1 of 2 branches missed.">		return isValidSelectedOrg() &amp;&amp;</span>
<span class="pc bpc" id="L592" title="1 of 2 branches missed.">				m_context.getUser().isAuthorized(</span>
<span class="fc" id="L593">						PrivilegeKeys.TOM_PURGEREQUESTS, OrganizationScopeManagerProxy.getScopeID(getSelectedIDObject()));</span>
	}

	protected boolean isAuthorizedToConfigureFT() {
<span class="pc bpc" id="L597" title="1 of 2 branches missed.">		return isValidSelectedOrg() &amp;&amp;</span>
<span class="pc bpc" id="L598" title="1 of 2 branches missed.">				m_context.getUser().isAuthorized(</span>
<span class="fc" id="L599">						PrivilegeKeys.FT_PURGEREQUESTS, OrganizationScopeManagerProxy.getScopeID(getSelectedIDObject()));</span>
	}

	protected boolean isAuthorizedToConfigureSS() {
<span class="pc bpc" id="L603" title="1 of 2 branches missed.">		return isValidSelectedOrg() &amp;&amp;</span>
<span class="pc bpc" id="L604" title="1 of 2 branches missed.">				m_context.getUser().isAuthorized(</span>
<span class="fc" id="L605">						PrivilegeKeys.SS_PURGEREQUESTS, OrganizationScopeManagerProxy.getScopeID(getSelectedIDObject()));</span>
	}

	protected boolean isAuthorizedToConfigureSB() {
<span class="pc bpc" id="L609" title="1 of 2 branches missed.">		return isValidSelectedOrg() &amp;&amp;</span>
<span class="pc bpc" id="L610" title="1 of 2 branches missed.">				m_context.getUser().isAuthorized(</span>
<span class="fc" id="L611">						PrivilegeKeys.SB_PURGEREQUESTS, OrganizationScopeManagerProxy.getScopeID(getSelectedIDObject()));</span>
	}

	protected boolean isAuthorizedToConfigureCS() {
<span class="pc bpc" id="L615" title="1 of 2 branches missed.">		return isValidSelectedOrg() &amp;&amp;</span>
<span class="pc bpc" id="L616" title="1 of 2 branches missed.">				m_context.getUser().isAuthorized(</span>
<span class="fc" id="L617">						PrivilegeKeys.CS_PURGEREQUESTS, OrganizationScopeManagerProxy.getScopeID(getSelectedIDObject()));</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>