<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>AgentsCustomShiftRequestsPM.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.rm.requests.custshift</a> &gt; <span class="el_source">AgentsCustomShiftRequestsPM.java</span></div><h1>AgentsCustomShiftRequestsPM.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.rm.requests.custshift;

import java.util.*;

import com.witness.web.uif.base.Message;
import com.witness.web.uif.data.wrapper.DateWrapper;
import com.witness.web.uif.data.wrapper.NumberWrapper;
import com.witness.web.uif.keys.PageKeys;
import com.witness.web.uif.l10n.*;
import com.witness.web.uif.pagemodel.*;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.listconfig.*;
import com.witness.web.uif.pagecomponent.*;
import com.witness.web.uif.pagecomponent.table.*;
import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.l10n.RegionalFormatBundleKey;
import com.bluepumpkin.common.localization.Localizer;
import com.bluepumpkin.ejb.bbm.workresource.model.Employee;
import com.bluepumpkin.ejb.rm.requests.common.model.*;
import com.bluepumpkin.ejb.rm.requests.custshift.model.*;
import com.bluepumpkin.ejb.rm.requests.timeoff.model.TORequest;
import com.bluepumpkin.web.rm.l10n.*;
import com.bluepumpkin.web.rm.keys.*;
import com.bluepumpkin.web.rm.requests.*;
import com.bluepumpkin.web.rm.requests.timeoff.TimeOffRequestsMH;
import com.bluepumpkin.ejb.rm.requests.custshift.validation.CustShiftValidationCache;
import com.bluepumpkin.ejb.bbm.workrules.model.Shift;
import com.bluepumpkin.ejb.bbm.activity.model.Activity;
import com.bluepumpkin.ejb.bbm.workrules.model.ShiftOTExtension;
import com.bluepumpkin.ejb.bbm.campaign.model.Campaign;
import com.bluepumpkin.common.util.BPMessageFormat;
import com.bluepumpkin.ejb.rm.setup.settings.model.OrganizationSetting;

/**
 * Title:        AgentsCustomShiftRequestsPM
 * Description:  Handle Agents Custom SHift Requests Filter
 * Copyright:    Copyright (c) 2011
 * Company:      Verint Systems, Inc.
 * @author       Gonzalo Quintanar
 */
public class AgentsCustomShiftRequestsPM extends AgentsRequestsPM 
{
	/**
	 * Constructor
	 */
	public AgentsCustomShiftRequestsPM(RequestContext context)	
	{
<span class="nc" id="L48">		super(context, Request.REQUESTTYPE_CUSTSHIFT);</span>
<span class="nc" id="L49">	}</span>

	/**
	 * Add Page Not Enabled Message
	 */
	protected void addPageNotEnabledMsg() 
	{
<span class="nc" id="L56">		CustomShiftUtil.addCSNotEnabledMsg(this);</span>
<span class="nc" id="L57">	}</span>

	/**
	 * Return an instance of AgentsRequestsPM ready to be rendered in JSP
	 */
	public static PageModel getInstance(RequestContext context) throws Exception 
	{
<span class="nc" id="L64">		return getInstance(context, AgentsCustomShiftRequestsPM.class);</span>
	}

	/**
	 * To be overwritten to load Page specific data
	 */
	protected void loadSpecifyData() throws Exception {
		/*Silk issue# 94537; Sameet Jan 2007, Filter for viewing Shift Swap creates error
        Commenting this since the manager should always be able to see the Shiftswap requests
        that he is entitled to even if his own org doesnot have shift swap enabled.*/
        //if (m_orgSetting!=null) m_isPageEnabled = m_orgSetting.getEnableShiftSwap();
		
<span class="nc bnc" id="L76" title="All 2 branches missed.">		if (m_empID!=null) </span>
		{
<span class="nc bnc" id="L78" title="All 2 branches missed.">			if (m_orgSetting!=null) {</span>
<span class="nc" id="L79">				m_isPageEnabled = CustomShiftUtil.isWorkflowEnabled(m_orgSetting);</span>
			}
		}
<span class="nc" id="L82">	}</span>
	
	/**
	 * Return Campaign name Display
	 */
	private String getCampaignName(CustShiftReq csr) 
	{
		try
		{
<span class="nc" id="L91">			CustShiftValidationCache cache = csr.getCache();</span>
<span class="nc" id="L92">			Campaign camp = cache.getCampaign();</span>
<span class="nc bnc" id="L93" title="All 2 branches missed.">			return camp==null ? &quot;&quot; : camp.getName();</span>
		}
<span class="nc" id="L95">		catch (Exception ex)</span>
		{
<span class="nc" id="L97">			String sentence_template = i18n(m_bundle, RmWebBundleKey.CSR_CAMPAIGN_NOT_FOUND_ERROR);</span>
<span class="nc" id="L98">			Object[] args = new Object[] {csr.getID().toString()};</span>
<span class="nc" id="L99">			addPageMessage(Message.ERROR_TYPE, BPMessageFormat.format(sentence_template, args));</span>
<span class="nc" id="L100">			return &quot;&quot;;</span>
		}
	}
	
	/**
	 * Return Shift Type Display
	 */
	private String getShiftName(CustShiftReq csr) 
	{
		try
		{
<span class="nc" id="L111">			CustShiftValidationCache cache = csr.getCache();</span>
<span class="nc" id="L112">			Shift shift = cache.getShift();</span>
<span class="nc bnc" id="L113" title="All 2 branches missed.">			return shift==null ? &quot;&quot; : shift.getName();</span>
		}
<span class="nc" id="L115">		catch (Exception ex)</span>
		{
<span class="nc" id="L117">			String sentence_template = i18n(m_bundle, RmWebBundleKey.CSR_SHIFT_NOT_FOUND_ERROR);</span>
<span class="nc" id="L118">			Object[] args = new Object[] {csr.getID().toString()};</span>
<span class="nc" id="L119">			addPageMessage(Message.ERROR_TYPE, BPMessageFormat.format(sentence_template, args));</span>
<span class="nc" id="L120">			return &quot;&quot;;</span>
		}
	}

	/**
	 * Return Activity Type Display
	 */
	private String getActivityName(CustShiftReq csr) 
	{
		try
		{
<span class="nc" id="L131">			CustShiftValidationCache cache = csr.getCache();</span>
<span class="nc" id="L132">			Activity act = cache.getActivity();</span>
<span class="nc bnc" id="L133" title="All 2 branches missed.">			return act==null ? &quot;&quot; : act.getName();</span>
		}
<span class="nc" id="L135">		catch (Exception ex)</span>
		{
<span class="nc" id="L137">			String sentence_template = i18n(m_bundle, RmWebBundleKey.CSR_ACTIVITY_NOT_FOUND_ERROR);</span>
<span class="nc" id="L138">			Object[] args = new Object[] {csr.getID().toString()};</span>
<span class="nc" id="L139">			addPageMessage(Message.ERROR_TYPE, BPMessageFormat.format(sentence_template, args));</span>
<span class="nc" id="L140">			return &quot;&quot;;</span>
		}
	}
	
	/**
	 * Return OT Extension Before Display
	 */
	private String getExtensionBeforeName(CustShiftReq csr) 
	{
		try
		{
<span class="nc" id="L151">			CustShiftValidationCache cache = csr.getCache();</span>
<span class="nc" id="L152">			ShiftOTExtension ext = cache.getExtensionBefore();</span>
<span class="nc bnc" id="L153" title="All 2 branches missed.">			return ext==null ? &quot;&quot; : ext.getName();</span>
		}
<span class="nc" id="L155">		catch (Exception ex)</span>
		{
<span class="nc" id="L157">			String sentence_template = i18n(m_bundle, RmWebBundleKey.CSR_EXTBEFORE_NOT_FOUND_ERROR);</span>
<span class="nc" id="L158">			Object[] args = new Object[] {csr.getID().toString()};</span>
<span class="nc" id="L159">			addPageMessage(Message.ERROR_TYPE, BPMessageFormat.format(sentence_template, args));</span>
<span class="nc" id="L160">			return &quot;&quot;;</span>
		}
	}

	/**
	 * Return OT Extension After Display
	 */
	private String getExtensionAfterName(CustShiftReq csr) 
	{
		try
		{
<span class="nc" id="L171">			CustShiftValidationCache cache = csr.getCache();</span>
<span class="nc" id="L172">			ShiftOTExtension ext = cache.getExtensionAfter();</span>
<span class="nc bnc" id="L173" title="All 2 branches missed.">			return ext==null ? &quot;&quot; : ext.getName();</span>
		}
<span class="nc" id="L175">		catch (Exception ex)</span>
		{
<span class="nc" id="L177">			String sentence_template = i18n(m_bundle, RmWebBundleKey.CSR_EXTAFTER_NOT_FOUND_ERROR);</span>
<span class="nc" id="L178">			Object[] args = new Object[] {csr.getID().toString()};</span>
<span class="nc" id="L179">			addPageMessage(Message.ERROR_TYPE, BPMessageFormat.format(sentence_template, args));</span>
<span class="nc" id="L180">			return &quot;&quot;;</span>
		}
	}

	/**
	 * Return OT Extension Before Activity Display
	 */
	private String getExtensionBeforeActivityName(CustShiftReq csr) 
	{
		try
		{
<span class="nc" id="L191">			CustShiftValidationCache cache = csr.getCache();</span>
<span class="nc" id="L192">			Activity act = cache.getExtensionBeforeActivity();</span>
<span class="nc bnc" id="L193" title="All 2 branches missed.">			return act==null ? &quot;&quot; : act.getName();</span>
		}
<span class="nc" id="L195">		catch (Exception ex)</span>
		{
<span class="nc" id="L197">			String sentence_template = i18n(m_bundle, RmWebBundleKey.CSR_EXTBEFORE_NOT_FOUND_ERROR);</span>
<span class="nc" id="L198">			Object[] args = new Object[] {csr.getID().toString()};</span>
<span class="nc" id="L199">			addPageMessage(Message.ERROR_TYPE, BPMessageFormat.format(sentence_template, args));</span>
<span class="nc" id="L200">			return &quot;&quot;;</span>
		}
	}
	
	/**
	 * Return OT Extension After Activity Display
	 */
	private String getExtensionAfterActivityName(CustShiftReq csr) 
	{
		try
		{
<span class="nc" id="L211">			CustShiftValidationCache cache = csr.getCache();</span>
<span class="nc" id="L212">			Activity act = cache.getExtensionAfterActivity();</span>
<span class="nc bnc" id="L213" title="All 2 branches missed.">			return act==null ? &quot;&quot; : act.getName();</span>
		}
<span class="nc" id="L215">		catch (Exception ex)</span>
		{
<span class="nc" id="L217">			String sentence_template = i18n(m_bundle, RmWebBundleKey.CSR_EXTAFTER_NOT_FOUND_ERROR);</span>
<span class="nc" id="L218">			Object[] args = new Object[] {csr.getID().toString()};</span>
<span class="nc" id="L219">			addPageMessage(Message.ERROR_TYPE, BPMessageFormat.format(sentence_template, args));</span>
<span class="nc" id="L220">			return &quot;&quot;;</span>
		}
	}
	
	/**
	 * Initialize Request Collection
	 */
	protected void initRequestCollection() throws Exception 
	{
<span class="nc bnc" id="L229" title="All 2 branches missed.">		if (isAuthToViewCSRqts()) </span>
		{
<span class="nc" id="L231">			super.initRequestCollection();</span>
		}
<span class="nc" id="L233">	}</span>

	/**
	 * Return Unique Employee IDs for the specified Requests
	 */
	protected Collection getUniqueEmpIDs(Collection requests) 
	{
<span class="nc" id="L240">		return CustomShiftRequestsMH.getUniqueEmpIDs(requests);</span>
	}

	/**
	 * Create Instanse of ListConfigSelectedPC
	 */
	protected ListConfigSelectorPC createListConfigSelectorPC() 
	{
<span class="nc" id="L248">		return new ListConfigSelectorPC(m_context, AgentsCustomShiftRequestsListConfig.class);</span>
	}

	/**
	 * Add Cell Data for the specified List Config Field Property
	 */
	protected void addCellData(String rowID, RequestAggregate request, ListConfigFP fp,
			DefaultMultiColumnNodeData row_data) 
	{
<span class="nc" id="L257">		CustShiftReq csRequest = (CustShiftReq)request;		</span>
		
<span class="nc bnc" id="L259" title="All 2 branches missed.">		if (fp.hasFieldName(Request.SORT_CS_SUBTYPE)) </span>
		{
<span class="nc" id="L261">			row_data.add( getRequestSubTypeString(csRequest) );</span>
		}
<span class="nc bnc" id="L263" title="All 2 branches missed.">		else if (fp.hasFieldName(Request.SORT_CS_CAMPAIGN)) </span>
		{
<span class="nc" id="L265">			row_data.add( getCampaignName(csRequest) );</span>
		}
<span class="nc bnc" id="L267" title="All 2 branches missed.">		else if (fp.hasFieldName(Request.SORT_CS_STARTTIME)) </span>
		{
<span class="nc" id="L269">			row_data.add(createDataWrapper(csRequest.getStartTime()) );</span>
		} 
<span class="nc bnc" id="L271" title="All 2 branches missed.">		else if (fp.hasFieldName(Request.SORT_CS_ENDTIME)) </span>
		{
<span class="nc" id="L273">			row_data.add(createDataWrapper(csRequest.getEndTime()) );</span>
		} 
		
<span class="nc bnc" id="L276" title="All 2 branches missed.">		else if (fp.hasFieldName(Request.SORT_CS_SHIFTID)) </span>
		{
<span class="nc bnc" id="L278" title="All 2 branches missed.">			row_data.add( CustomShiftUtil.hasShift(csRequest) ? getShiftName(csRequest) : &quot;&quot;);</span>
		}
<span class="nc bnc" id="L280" title="All 2 branches missed.">		else if (fp.hasFieldName(Request.SORT_CS_ACTIVITYID)) </span>
		{
<span class="nc bnc" id="L282" title="All 2 branches missed.">			row_data.add( CustomShiftUtil.hasShift(csRequest) ? getActivityName(csRequest) : &quot;&quot;);</span>
		}
<span class="nc bnc" id="L284" title="All 2 branches missed.">		else if (fp.hasFieldName(Request.SORT_CS_ISOT)) </span>
		{
<span class="nc bnc" id="L286" title="All 2 branches missed.">			row_data.add( CustomShiftUtil.hasShift(csRequest) ? m_localizer.formatYesNo(csRequest.isOT()) : &quot;&quot; );			</span>
		}
		
<span class="nc bnc" id="L289" title="All 2 branches missed.">		else if (fp.hasFieldName(Request.SORT_CS_EXTBEFOREID)) </span>
		{
<span class="nc bnc" id="L291" title="All 2 branches missed.">			row_data.add( CustomShiftUtil.hasExtBefore(csRequest) ? getExtensionBeforeName(csRequest) : &quot;&quot; );</span>
		}
<span class="nc bnc" id="L293" title="All 2 branches missed.">		else if (fp.hasFieldName(Request.SORT_CS_EXTBEFOREACTIVITYID)) </span>
		{
<span class="nc bnc" id="L295" title="All 2 branches missed.">			row_data.add( CustomShiftUtil.hasExtBefore(csRequest) ? getExtensionBeforeActivityName(csRequest) : &quot;&quot; );</span>
		}
<span class="nc bnc" id="L297" title="All 2 branches missed.">		else if (fp.hasFieldName(Request.SORT_CS_EXTBEFOREISOT)) </span>
		{
<span class="nc bnc" id="L299" title="All 2 branches missed.">			row_data.add( CustomShiftUtil.hasExtBefore(csRequest) ? m_localizer.formatYesNo(csRequest.getExtBeforeIsOT()) : &quot;&quot; );			</span>
		}
		
<span class="nc bnc" id="L302" title="All 2 branches missed.">		else if (fp.hasFieldName(Request.SORT_CS_EXTAFTERID)) </span>
		{
<span class="nc bnc" id="L304" title="All 2 branches missed.">			row_data.add( CustomShiftUtil.hasExtAfter(csRequest) ? getExtensionAfterName(csRequest) : &quot;&quot;);</span>
		}
<span class="nc bnc" id="L306" title="All 2 branches missed.">		else if (fp.hasFieldName(Request.SORT_CS_EXTAFTERACTIVITYID)) </span>
		{
<span class="nc bnc" id="L308" title="All 2 branches missed.">			row_data.add( CustomShiftUtil.hasExtAfter(csRequest) ? getExtensionAfterActivityName(csRequest) : &quot;&quot;);</span>
		}
<span class="nc bnc" id="L310" title="All 2 branches missed.">		else if (fp.hasFieldName(Request.SORT_CS_EXTAFTERISOT)) </span>
		{
<span class="nc bnc" id="L312" title="All 2 branches missed.">			row_data.add( CustomShiftUtil.hasExtAfter(csRequest) ? m_localizer.formatYesNo(csRequest.getExtAfterIsOT()) : &quot;&quot;);			</span>
		}		
		
		else 
		{
<span class="nc" id="L317">			super.addCellData(rowID, request, fp, row_data);</span>
		}
<span class="nc" id="L319">	}</span>
	
	/**
	 * Get Request Sub Type string.
	 * @return either &quot;New Shift&quot; or &quot;Shift Change&quot;.
	 */
	protected String getRequestSubTypeString(CustShiftReq csr) 
	{
		String key;
<span class="nc bnc" id="L328" title="All 2 branches missed.">		if (CustomShiftUtil.isShiftChangeSubType(csr))</span>
<span class="nc" id="L329">			key = RmWebBundleKey.CSR_SUBTYPE_SHIFT_CHANGE;</span>
		else
<span class="nc" id="L331">			key = RmWebBundleKey.CSR_SUBTYPE_NEW_SHIFT;</span>
		
<span class="nc" id="L333">		return m_localizer.i18n(m_bundle, key);</span>
	}

	/**
	 * Return Content Title Item Name
	 */
	protected String getContentTitleItemName() 
	{
<span class="nc" id="L341">		return i18n(m_bundle, RmWebBundleKey.REQUEST_TYPE_CUSTOM_SHIFT);</span>
	}

	/**
	 * Add Create Request Button
	 */
	protected void addCreateRequestButton() 
	{
<span class="nc bnc" id="L349" title="All 4 branches missed.">		boolean isBtnEnabled = m_isPageEnabled &amp;&amp; isAuthToEditCSRqts();</span>
<span class="nc" id="L350">		String newRequestLabel = i18n(m_bundle, RmWebBundleKey.CREATE_NEW_REQUEST);</span>
<span class="nc" id="L351">		m_toolbar.addPopupWindowTextButton(RmPageAction.POPUP_CUSTSHIFT_REQUEST_FORM_ACTION,</span>
				newRequestLabel, isBtnEnabled);
<span class="nc" id="L353">	}</span>

	/**
	 * Return URL for HTML Form Action
	 */
	public String getFormAction() 
	{
<span class="nc bnc" id="L360" title="All 2 branches missed.">		if (isAuthToViewCSRqts()) </span>
		{
<span class="nc" id="L362">			return RmKeys.RH_AG_REQUEST_CUSTSHIFT_LIST;</span>
		} 
		else 
		{
<span class="nc" id="L366">			return RmKeys.RH_AG_REQUEST_ALL_LIST; </span>
		}
	}
	
	/**
	 * Return true if Tentative Actions are enabled
	 */
	protected boolean isTentativeActionEnabled() 
	{
<span class="nc" id="L375">		return false; // Not enabled for Custom Shift Requests</span>
	}
	
	/**
	 * Get Selected Filter. To be overridden by subclasses.
	 * Subclasses should return m_rfilterBoxPC.getSelectedFilterName().
	 */
	public String getSelectedFilterName() {
<span class="nc" id="L383">		return m_rfilterBoxPC.getSelectedFilterName();</span>
	}
	
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>