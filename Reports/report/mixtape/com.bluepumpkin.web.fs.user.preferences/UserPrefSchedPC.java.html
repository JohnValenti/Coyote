<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>UserPrefSchedPC.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.fs.user.preferences</a> &gt; <span class="el_source">UserPrefSchedPC.java</span></div><h1>UserPrefSchedPC.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.fs.user.preferences;

import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.user.preferences.UserPrefPC;
import com.witness.web.uif.keys.JavaScriptFileID;
import com.witness.web.uif.l10n.UIFWebBundleKey;
import com.witness.web.uif.util.HtmlUtil;
import com.witness.web.uif.util.html.HtmlBooleanCheckbox;
import com.witness.ejb.core.security.PrivilegeKeys;
import com.witness.ejb.core.licensing.ejb.LicenseManager;
import com.witness.ejb.core.licensing.LicenseKeys;
import com.bluepumpkin.ejb.core.CoreManagerFactory;
import com.bluepumpkin.common.datatypes.ID;

import java.util.*;

/**
 * Title:
 * Description:
 * Copyright:   Copyright (c) 2004
 * Company:     Blue Pumpkin Software, Inc
 *
 * @author David Su, dsu
 * @version 1.0
 *          Created on Nov 9, 2004, 4:28:18 PM
 */
public class UserPrefSchedPC extends UserPrefPC {
	private LicenseManager m_licManager;
<span class="nc" id="L29">	private static final String[] KEYS_ARR = new String[] {</span>
		USER_SHOW_UNAVAILABLE,
		USER_SHOW_TIMEOFF,
		USER_SHOW_NETSTAFFING,
		USER_SHOW_NETSTAFFING_HALF_HEIGHT,
		USER_NS_SURPLUS_COLOR,
		USER_NS_SHORTAGE_COLOR,
		USER_NS_NEUTRAL_COLOR,
		USER_NS_CELL_SELECTION_COLOR		
	};
<span class="nc" id="L39">	private static final Collection KEYS = Arrays.asList(KEYS_ARR);</span>

	public static final String DEFAULT_NS_SURPLUS_COLOR = &quot;63C584&quot;; //green
	public static final String DEFAULT_NS_SHORTAGE_COLOR = &quot;FD3B3B&quot;; //red
	public static final String DEFAULT_NS_NEUTRAL_COLOR = &quot;999999&quot;; //grey
	public static final String DEFAULT_NS_CELL_SELECTION_COLOR = &quot;FFFF00&quot;; //yellow

	private boolean m_isShowUnavailableSched;
	private boolean m_isShowTimeoffSched;
	
	//Net Staffing preferences
	private boolean m_isShowNetStaffing;	
	private boolean m_isShowNetStaffingHalfHeight;
	private String m_nsSurplusColor;
	private String m_nsShortageColor;
	private String m_nsNeutralColor;
	private String m_nsCellSelectionColor;
	
	//Net Staffing Calendar Colors Container	
	//private ColorGenericPC m_netStaffingColorPC;

	public UserPrefSchedPC(RequestContext context) {
<span class="nc" id="L61">		super(context);</span>
<span class="nc" id="L62">		setTitle(i18n(m_common_bundle, UIFWebBundleKey.USER_PREF_SCHED));</span>
<span class="nc" id="L63">	}</span>

	public Collection getUserPrefKey() {
<span class="nc" id="L66">		return KEYS;</span>
	}

	protected void initSupportData() throws Exception {
<span class="nc" id="L70">		m_isShowUnavailableSched = getBooleanPreference(USER_SHOW_UNAVAILABLE, false);</span>
<span class="nc" id="L71">		m_isShowTimeoffSched = getBooleanPreference(USER_SHOW_TIMEOFF, false);</span>
		
<span class="nc" id="L73">		m_isShowNetStaffing = getBooleanPreference(USER_SHOW_NETSTAFFING, false);</span>
<span class="nc" id="L74">		m_isShowNetStaffingHalfHeight = getBooleanPreference(USER_SHOW_NETSTAFFING_HALF_HEIGHT, true);	</span>
<span class="nc" id="L75">		m_nsSurplusColor = getPreference(USER_NS_SURPLUS_COLOR);</span>
<span class="nc" id="L76">		m_nsShortageColor = getPreference(USER_NS_SHORTAGE_COLOR);</span>
<span class="nc" id="L77">		m_nsNeutralColor = getPreference(USER_NS_NEUTRAL_COLOR);</span>
<span class="nc" id="L78">		m_nsCellSelectionColor = getPreference(USER_NS_CELL_SELECTION_COLOR);</span>
<span class="nc" id="L79">	}</span>

	protected void initContent() throws Exception 
	{
<span class="nc" id="L83">		ID empID = m_user.getEmployeeID(); //must be an employee to view schedules</span>
		
<span class="nc bnc" id="L85" title="All 4 branches missed.">		if (isLicensed(LicenseKeys.APP_FS) &amp;&amp; empID!=null) </span>
		{
			// Show Unavailable only if administrator: uncomment after new schema
<span class="nc bnc" id="L88" title="All 2 branches missed.">			if (m_user.isAuthorized(PrivilegeKeys.FS_CONFIGUREUNAVAILABILITYDISPLAY_ID)) {</span>
<span class="nc" id="L89">				HtmlBooleanCheckbox input = HtmlBooleanCheckbox.createInput(</span>
<span class="nc" id="L90">						USER_SHOW_UNAVAILABLE, i18n(m_bundle, UIFWebBundleKey.SHOW_UNAVAILABLE),</span>
						onChangeJS, m_isShowUnavailableSched, false);
<span class="nc" id="L92">				addRow(input.getLabelDisplay(), input.getInputDisplay());</span>
			}

			// Show Timeoff
<span class="nc bnc" id="L96" title="All 2 branches missed.">			if (m_user.isAuthorized(PrivilegeKeys.FS_CONFIGURETIMEOFFEVENTSDISPLAY_ID)) {</span>
<span class="nc" id="L97">				HtmlBooleanCheckbox input = HtmlBooleanCheckbox.createInput(</span>
<span class="nc" id="L98">						USER_SHOW_TIMEOFF, i18n(m_bundle, UIFWebBundleKey.SHOW_TIMEOFF),</span>
						onChangeJS, m_isShowTimeoffSched, false);
<span class="nc" id="L100">				addRow(input.getLabelDisplay(), input.getInputDisplay());</span>
			}
			
			//Net Staffing preferences
			
			//get the employee's organization RM settings
			/*
			boolean allowNewShifts = false;   //allow new shift requests?
			boolean allowShiftChanges = false; //allow shift change requests?
			ID orgID = getOrganizationIDForEmp(m_context, empID);
			if (orgID != null)
			{
				OrganizationSetting orgSetting = getOrgSetting(orgID);
				if (orgSetting != null)
				{
					allowNewShifts = orgSetting.getEnableCustomShiftRequests();   //allow new shift requests
					allowShiftChanges = orgSetting.getAllowShiftChangeRequests(); //allow shift change requests
				}
			}
			*/
			
<span class="nc bnc" id="L121" title="All 2 branches missed.">			if (m_user.isAuthorized(PrivilegeKeys.FS_CONFIGURENETSTAFFINGDISPLAY_ID)) // &amp;&amp; (allowNewShifts || allowShiftChanges))</span>
			{
				//Show Net Staffing
				{
<span class="nc" id="L125">					HtmlBooleanCheckbox input = HtmlBooleanCheckbox.createInput(</span>
<span class="nc" id="L126">							USER_SHOW_NETSTAFFING, i18n(m_bundle, UIFWebBundleKey.SHOW_NETSTAFFING),</span>
							onChangeJS, m_isShowNetStaffing, false);
<span class="nc" id="L128">					addRow(input.getLabelDisplay(), input.getInputDisplay());</span>
				}				
				
				/*
				//Show Net Staffing Half-Height
				{
					HtmlBooleanCheckbox input = HtmlBooleanCheckbox.createInput(
							USER_SHOW_NETSTAFFING_HALF_HEIGHT, i18n(m_bundle, UIFWebBundleKey.SHOW_NETSTAFFING_HALF_HEIGHT),
							onChangeJS, m_isShowNetStaffingHalfHeight, false);
					addRow(input.getLabelDisplay(), input.getInputDisplay());
				}
				*/
				
				//Net Staffing Colors
<span class="nc" id="L142">				addRequiredJavaScriptFile(JavaScriptFileID.MEDIATOR_DIALOG);</span>
<span class="nc" id="L143">				addRequiredJavaScriptFile(JavaScriptFileID.MODULE_DIALOGBOX);</span>
<span class="nc" id="L144">				addRequiredJavaScriptFile(JavaScriptFileID.DIALOG_PICKERS);</span>
				
				//m_netStaffingColorPC = new ColorGenericPC(m_context);
				//m_netStaffingColorPC.setTitle(i18n(m_bundle, UIFWebBundleKey.NET_STAFFING));
				//m_netStaffingColorPC.setName(&quot;netStaffingColorPC&quot;);
				
				//m_netStaffingColorPC.setWidth(&quot;99%&quot;);
				
<span class="nc" id="L152">				boolean enabled = true;</span>
				
				{
<span class="nc" id="L155">					String nameKey = USER_NS_SURPLUS_COLOR;</span>
<span class="nc" id="L156">					String label = i18n(m_bundle, UIFWebBundleKey.NS_SURPLUS_COLOR);</span>
<span class="nc" id="L157">					String value = m_nsSurplusColor;;</span>
<span class="nc bnc" id="L158" title="All 2 branches missed.">					if (value == null) {</span>
<span class="nc" id="L159">						value = DEFAULT_NS_SURPLUS_COLOR;</span>
					}
					//m_netStaffingColorPC.addColorFields(nameKey, label, value, enabled);
					
<span class="nc bnc" id="L163" title="All 2 branches missed.">					addRowWithLabelKey(label,</span>
<span class="nc" id="L164">							HtmlUtil.makeColorPickerCaller(nameKey, value, &quot;&quot;, !enabled, m_localizer));</span>
					
				}
				{
<span class="nc" id="L168">					String nameKey = USER_NS_SHORTAGE_COLOR;</span>
<span class="nc" id="L169">					String label = i18n(m_bundle, UIFWebBundleKey.NS_SHORTAGE_COLOR);</span>
<span class="nc" id="L170">					String value = m_nsShortageColor;</span>
<span class="nc bnc" id="L171" title="All 2 branches missed.">					if (value == null) {</span>
<span class="nc" id="L172">						value = DEFAULT_NS_SHORTAGE_COLOR;</span>
					}
					//m_netStaffingColorPC.addColorFields(nameKey, label, value, enabled);
					
<span class="nc bnc" id="L176" title="All 2 branches missed.">					addRowWithLabelKey(label,</span>
<span class="nc" id="L177">							HtmlUtil.makeColorPickerCaller(nameKey, value, &quot;&quot;, !enabled, m_localizer));</span>
				}
				{
<span class="nc" id="L180">					String nameKey = USER_NS_NEUTRAL_COLOR;</span>
<span class="nc" id="L181">					String label = i18n(m_bundle, UIFWebBundleKey.NS_NEUTRAL_COLOR);</span>
<span class="nc" id="L182">					String value = m_nsNeutralColor;</span>
<span class="nc bnc" id="L183" title="All 2 branches missed.">					if (value == null) {</span>
<span class="nc" id="L184">						value = DEFAULT_NS_NEUTRAL_COLOR;</span>
					}
					//m_netStaffingColorPC.addColorFields(nameKey, label, value, enabled);
					
<span class="nc bnc" id="L188" title="All 2 branches missed.">					addRowWithLabelKey(label,</span>
<span class="nc" id="L189">							HtmlUtil.makeColorPickerCaller(nameKey, value, &quot;&quot;, !enabled, m_localizer));</span>
				}
				/*
				{
					String nameKey = USER_NS_CELL_SELECTION_COLOR;
					String label = i18n(m_bundle, UIFWebBundleKey.NS_CELL_SELECTION_COLOR);
					String value = m_nsCellSelectionColor;
					if (value == null) {
						value = DEFAULT_NS_CELL_SELECTION_COLOR;
					}
					//m_netStaffingColorPC.addColorFields(nameKey, label, value, enabled);
					
					addRowWithLabelKey(label,
							HtmlUtil.makeColorPickerCaller(nameKey, value, &quot;&quot;, !enabled, m_localizer));
				}
				*/
				
			}
		}
<span class="nc" id="L208">	}</span>
	
	/**
	 * Overrode this method to add the color picker to the
	 * html data.
	 */
	public String getRequiredHTML() {
<span class="nc" id="L215">		StringBuffer sb = new StringBuffer(128);</span>
<span class="nc" id="L216">		sb.append(super.getRequiredHTML());</span>
		
<span class="nc bnc" id="L218" title="All 2 branches missed.">		if (isLicensed(LicenseKeys.APP_RM_TOM))</span>
<span class="nc" id="L219">			sb.append(HtmlUtil.makeColorPicker());</span>
		
<span class="nc" id="L221">		return sb.toString();</span>
	}
	
	/**
	 * Get the employee's organizationID.
	 * @return the employye's current org assignment.
	 *
	public static ID getOrganizationIDForEmp(RequestContext context, ID employeeID)
	{
		ID orgID = null;
		try
		{
			Date now = new Date();
			WorkResourceManager workResourceManager = WorkResourceModelHandler.getWorkResourceManager(context);
			Collection assignments = workResourceManager.getWorkResourceAssignments(employeeID,	now, now, false);

			for (Iterator i = assignments.iterator(); i.hasNext();){
				WorkResourceAssignment assignment = (WorkResourceAssignment) i.next();
				if (assignment != null) {
					orgID = assignment.getOrganizationID();
					break; //take the first of assignments in the time range
				}
			}
		}
		catch (Exception ex)
		{
			log.l7dError(UIFWebBundleKey.UNABLE_TO_LOAD_DATA, ex);
		}

		return orgID;
	}
	*/
	
	/**
	 * Return OrganizationSetting for specified Organization ID
	 *
	public static OrganizationSetting getOrgSetting(ID orgID)
			throws RemoteException, BbmFinderException, BbmCreateException {
		return getOrgConfigManager().getConfiguration(orgID);
	}
	
	protected static OrganizationConfigManager getOrgConfigManager() throws BbmCreateException {
		return RmManagerFactory.getInstance().getOrganizationConfigManager();
	}
	*/

	protected boolean isLicensed(String app) {
<span class="nc" id="L268">		boolean result=false;</span>
		try {
<span class="nc bnc" id="L270" title="All 2 branches missed.">			if (m_licManager==null) m_licManager=CoreManagerFactory.getLicenseManager();</span>
<span class="nc bnc" id="L271" title="All 4 branches missed.">			result=(m_licManager!=null &amp;&amp; m_licManager.isLicensed(app));</span>
<span class="nc" id="L272">		} catch(Exception ex) {}</span>

<span class="nc" id="L274">		return result;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>