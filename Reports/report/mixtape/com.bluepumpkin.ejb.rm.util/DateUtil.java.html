<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>DateUtil.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.ejb.rm.util</a> &gt; <span class="el_source">DateUtil.java</span></div><h1>DateUtil.java</h1><pre class="source lang-java linenums">/*
 * Created on Oct 7, 2008
 *
 * To change this generated comment go to
 * Window&gt;Preferences&gt;Java&gt;Code Generation&gt;Code and Comments
 */
package com.bluepumpkin.ejb.rm.util;

import java.text.ParsePosition;
import java.text.SimpleDateFormat;
import java.util.Calendar;
import java.util.Date;
import java.util.Random;
import java.util.TimeZone;

import com.bluepumpkin.common.datatypes.Pair;
import com.bluepumpkin.common.datatypes.TimeRange;
import com.bluepumpkin.common.logging.Category;
import com.bluepumpkin.common.util.TimeZoneUtil;
import com.bluepumpkin.ejb.bbm.timeoffcalculator.TOCalcUtil;
import com.bluepumpkin.ejb.rm.DSTTransitionMode;
import com.bluepumpkin.ejb.rm.Log;

public class DateUtil {
<span class="fc" id="L25">	private static final Category LOG = Log.initCategory(DateUtil.class.getName());</span>

	public static final long HOUR_IN_MSECS = 3600000L;
	public static final long MINUTE_IN_MSECS = 60000L;
	public static final int TIME_INTERVAL = 15;
	public static final int INTERVALS_IN_HOUR = 4;
	public static final int INTERVALS_IN_DAY = INTERVALS_IN_HOUR * 24;

<span class="fc" id="L33">	private static final Random rand = new Random();</span>
<span class="fc" id="L34">	private static final int[] DAY_OF_MONTH = { 14, 15, 16, 1, 5, 30 };</span>
<span class="fc" id="L35">	private static final int[] YEARS = { 2007, 2008, 2009 };</span>
<span class="fc" id="L36">	private static final int[] MONTH = { 1, 3, 6, 9, 11, 12 };</span>
	private static final String DATEFORMAT = &quot;MM/dd/yyyy HH:mm:ss&quot;;

<span class="nc" id="L39">	private DateUtil() {</span>
<span class="nc" id="L40">	}</span>

	public static void main(String[] args) {
<span class="nc bnc" id="L43" title="All 2 branches missed.">		for (int i = 0; i &lt; 10;) {</span>
<span class="nc" id="L44">			TimeZone tz = Calendar.getInstance().getTimeZone();</span>
<span class="nc" id="L45">			Calendar start = getRandomCalendar(tz);</span>
<span class="nc" id="L46">			Calendar end = getRandomCalendar(tz);</span>
<span class="nc bnc" id="L47" title="All 2 branches missed.">			if (start.after(end)) {</span>
<span class="nc" id="L48">				continue;</span>
			}
			//getDaysInBetween(tz, start, calEnd.getTime()); // NOSONAR
			//getSemiMonthCountInBetween(tz,start, calEnd.getTime()); // NOSONAR
			//getMonthsInBetween(tz,start, calEnd.getTime()); // NOSONAR
			//getYearsInBetween(tz,start, calEnd.getTime(), 9, 15); // NOSONAR
<span class="nc" id="L54">			i++; // NOSONAR</span>
<span class="nc" id="L55">		}</span>
<span class="nc" id="L56">	}</span>

	private static Calendar getRandomCalendar(TimeZone tz) {
<span class="nc" id="L59">		int mon = MONTH[rand.nextInt(MONTH.length)];</span>
<span class="nc" id="L60">		int yr = YEARS[rand.nextInt(YEARS.length)];</span>
<span class="nc" id="L61">		int dy = DAY_OF_MONTH[rand.nextInt(DAY_OF_MONTH.length)];</span>
<span class="nc" id="L62">		Calendar ca = Calendar.getInstance(tz);</span>
<span class="nc" id="L63">		ca.set(Calendar.YEAR, yr);</span>
<span class="nc" id="L64">		ca.set(Calendar.MONTH, mon);</span>
<span class="nc" id="L65">		ca.set(Calendar.DAY_OF_MONTH, dy);</span>
<span class="nc" id="L66">		ca.set(Calendar.HOUR, 0);</span>
<span class="nc" id="L67">		ca.set(Calendar.MINUTE, 0);</span>
<span class="nc" id="L68">		ca.set(Calendar.SECOND, 0);</span>
<span class="nc" id="L69">		return ca;</span>
	}

	public static final int getMonthCountInBetween(Calendar calStart, Calendar calEnd) {
<span class="nc" id="L73">		SimpleDateFormat dateFormat = new SimpleDateFormat(DATEFORMAT);</span>
<span class="nc" id="L74">		dateFormat.setTimeZone(calStart.getTimeZone());</span>
<span class="nc" id="L75">		Date start = calStart.getTime();</span>
<span class="nc" id="L76">		initCalendarToStartOfDay(calStart);</span>
<span class="nc" id="L77">		calStart.set(Calendar.DAY_OF_MONTH, 1);</span>
<span class="nc" id="L78">		int count = 0;</span>
		while (true) {
<span class="nc bnc" id="L80" title="All 4 branches missed.">			if (calStart.getTime().after(start) &amp;&amp; !calStart.getTime().after(calEnd.getTime())) {</span>
<span class="nc" id="L81">				count++;</span>
			}
<span class="nc" id="L83">			Date before = calStart.getTime();</span>
<span class="nc" id="L84">			calStart.add(Calendar.MONTH, 1);</span>
<span class="nc" id="L85">			LOG.debug(&quot;\t count= &quot; + count + &quot;;before=&quot; + dateFormat.format(before) + &quot;; after=&quot; + dateFormat.format(calStart.getTime()) +</span>
<span class="nc" id="L86">					&quot;; END DATE=&quot; + dateFormat.format(calEnd.getTime()));</span>
<span class="nc bnc" id="L87" title="All 2 branches missed.">			if (calStart.getTime().after(calEnd.getTime())) {</span>
<span class="nc" id="L88">				break;</span>
			}
<span class="nc" id="L90">		}</span>
<span class="nc" id="L91">		LOG.debug(&quot;FROM: &quot; + dateFormat.format(start) + &quot; - &quot; + dateFormat.format(calEnd.getTime()) + &quot; ; Month count=&quot; + count);</span>
<span class="nc" id="L92">		return count;</span>
	}

	private static void initCalendarToStartOfDay(Calendar calStart) {
<span class="nc" id="L96">		calStart.set(Calendar.HOUR_OF_DAY, 0);</span>
<span class="nc" id="L97">		calStart.set(Calendar.MINUTE, 0);</span>
<span class="nc" id="L98">		calStart.set(Calendar.SECOND, 0);</span>
<span class="nc" id="L99">		calStart.set(Calendar.MILLISECOND, 0);</span>
<span class="nc" id="L100">	}</span>

	public static final int getDayCountInBetween(TimeZone tz, Date start, Date end) {

<span class="nc" id="L104">		Calendar calStart = Calendar.getInstance(tz);</span>
<span class="nc" id="L105">		calStart.setTime(start);</span>
<span class="nc" id="L106">		Calendar calEnd = Calendar.getInstance(tz);</span>
<span class="nc" id="L107">		calEnd.setTime(end);</span>
<span class="nc" id="L108">		return getDayCountInBetween(calStart, calEnd);</span>
	}

	public static final int getDayCountInBetween(Calendar calStart, Calendar calEnd) {
<span class="nc" id="L112">		SimpleDateFormat dateFormat = new SimpleDateFormat(DATEFORMAT);</span>
<span class="nc" id="L113">		dateFormat.setTimeZone(calStart.getTimeZone());</span>
<span class="nc" id="L114">		Date start = calStart.getTime();</span>
<span class="nc" id="L115">		initCalendarToStartOfDay(calStart);</span>
<span class="nc" id="L116">		int count = 0;</span>
		while (true) {
<span class="nc bnc" id="L118" title="All 4 branches missed.">			if (calStart.getTime().after(start) &amp;&amp; !calStart.getTime().after(calEnd.getTime())) {</span>
<span class="nc" id="L119">				count++;</span>
			}
<span class="nc" id="L121">			calStart.add(Calendar.DAY_OF_MONTH, 1);</span>
<span class="nc bnc" id="L122" title="All 2 branches missed.">			if (calStart.getTime().after(calEnd.getTime())) {</span>
<span class="nc" id="L123">				break;</span>
			}
		}
<span class="nc" id="L126">		return count;</span>
	}

	/*
	finds out exact number of days between the start date and end date
	returns   0 if the number of days is exactly the same
			-ve number if allowedDays is less than days between the start date and end date
	        +ve number if allowedDays is greater than days between the start date and end date
	*/
	public static final long compareDayDiffWithAllowedCount(TimeZone tz, Date start, Date end, int allowedDays) {
<span class="nc" id="L136">		Calendar calStart = Calendar.getInstance(tz);</span>
<span class="nc" id="L137">		calStart.setTime(start);</span>
<span class="nc" id="L138">		calStart.add(Calendar.DAY_OF_MONTH, allowedDays);</span>
<span class="nc" id="L139">		Calendar calEnd = Calendar.getInstance(tz);</span>
<span class="nc" id="L140">		calEnd.setTime(end);</span>
<span class="nc bnc" id="L141" title="All 2 branches missed.">		if (calStart.equals(calEnd)) {</span>
<span class="nc" id="L142">			return 0;</span>
		} else {
<span class="nc bnc" id="L144" title="All 2 branches missed.">			return calStart.after(calEnd) ? -1 : 1;</span>
		}
	}

	public static final int getYearsCountInBetween(Calendar calStart, Calendar calEnd, int month, int day) {
<span class="nc" id="L149">		SimpleDateFormat dateFormat = new SimpleDateFormat(DATEFORMAT);</span>
<span class="nc" id="L150">		dateFormat.setTimeZone(calStart.getTimeZone());</span>
		//check EMP TO year start in this case
<span class="nc" id="L152">		Date start = calStart.getTime();</span>
<span class="nc" id="L153">		initCalendarToStartOfDay(calStart);</span>
<span class="nc" id="L154">		calStart.set(Calendar.MONTH, month);</span>
<span class="nc" id="L155">		calStart.set(Calendar.DAY_OF_MONTH, day);</span>

<span class="nc" id="L157">		int count = 0;</span>
		while (true) {
<span class="nc bnc" id="L159" title="All 4 branches missed.">			if (calStart.getTime().after(start) &amp;&amp; !calStart.getTime().after(calEnd.getTime())) {</span>
<span class="nc" id="L160">				count++;</span>
			}
			//System.out.println(&quot;\t count= &quot; + count + &quot;; calYrStart&quot; + dateFormat.format(calStart.getTime()));
<span class="nc" id="L163">			calStart.set(Calendar.YEAR, calStart.get(Calendar.YEAR) + 1);</span>
<span class="nc bnc" id="L164" title="All 2 branches missed.">			if (calStart.getTime().after(calEnd.getTime())) {</span>
<span class="nc" id="L165">				break;</span>
			}
		}
		//System.out.println(&quot;FROM: &quot; + dateFormat.format(start) + &quot; - &quot; + dateFormat.format(calEnd.getTime()) + &quot; ; Yr count=&quot; + count + &quot; ;YR ST =&quot; + dateFormat.format(calStart.getTime()) + &quot;: days=&quot; + ((calEnd.getTime().getTime() - start.getTime()) / (60 * 60 * 1000 * 24)));
<span class="nc" id="L169">		return count;</span>
	}

	//Every 15th of the month
	public static final int getSemiMonthCountInBetween(Calendar calStart, Calendar calEnd) {
<span class="nc" id="L174">		SimpleDateFormat dateFormat = new SimpleDateFormat(DATEFORMAT);</span>
<span class="nc" id="L175">		dateFormat.setTimeZone(calStart.getTimeZone());</span>
<span class="nc" id="L176">		Date start = calStart.getTime();</span>
<span class="nc" id="L177">		int count = 0;</span>
<span class="nc" id="L178">		initCalendarToStartOfDay(calStart);</span>
		while (true) {
<span class="nc bnc" id="L180" title="All 4 branches missed.">			if (calStart.getTime().after(start) &amp;&amp; !calStart.getTime().after(calEnd.getTime())) {</span>
<span class="nc" id="L181">				count++;</span>
			}
			//System.out.println(&quot;\t count= &quot;+count +&quot;;&quot; + dateFormat.format(calStart.getTime()) );
<span class="nc bnc" id="L184" title="All 2 branches missed.">			if (calStart.get(Calendar.DAY_OF_MONTH) &gt;= 15) {</span>
<span class="nc" id="L185">				calStart.set(Calendar.DAY_OF_MONTH, 1);</span>
<span class="nc" id="L186">				calStart.add(Calendar.MONTH, 1);</span>
			} else {
<span class="nc" id="L188">				calStart.set(Calendar.DAY_OF_MONTH, 15);</span>
			}
<span class="nc bnc" id="L190" title="All 2 branches missed.">			if (calStart.getTime().after(calEnd.getTime())) {</span>
<span class="nc" id="L191">				break;</span>
			}
		}
		//System.out.println(&quot;FROM: &quot; + dateFormat.format(start) + &quot; - &quot; + dateFormat.format(calEnd.getTime()) + &quot; ; Semi Month count=&quot; + count);
<span class="nc" id="L195">		return count;</span>
	}

	/**
	 * Converts a date in GMT to the same clock time in toTimeZone.
	 * 2013/10/01 00:00 GMT to 2013/10/01 00:00 America/Chicago
	 * The source and returned Date instances may represent a different instant of time.
	 *
	 * See convertClockTimeToTimeZone for example.
	 *
	 * @param date
	 *            The source date that has the proper clock time.
	 * @param toTimeZone
	 *            The TimeZone for the resulting clock time.
	 * @return A new Date instance that has the same clock time as the input date but in toTimeZone.
	 */
	public static Date convertGmtClockTimeToTimeZone(Date date, TimeZone toTimeZone) {
<span class="nc" id="L212">		return convertClockTimeToTimeZone(date, TimeZoneUtil.GMT_TIMEZONE, toTimeZone);</span>
	}

	/**
	 * Converts a date in fromTimeZone to the same clock time in toTimeZone.
	 * 2013/10/01 00:00 GMT to 2013/10/01 00:00 America/Chicago
	 * The source and returned Date instances both represent a different instant of time.
	 *
	 * Example: The database stores a time relative to some entity such as an organization.
	 * The date instance is obtained from the database in GMT not the organization's TimeZone.
	 * Therefore, the date instance doesn't represent the proper instant of time.
	 * date: 2013/10/01 00:00 GMT
	 * fromTimeZone: GMT
	 * toTimeZone: America/Chicago
	 * result: 2013/10/01 00:00 America/Chicago
	 *
	 * @param date
	 *            The source date that has the proper clock time.
	 * @param fromTimeZone
	 *            The TimeZone date represents.
	 * @param toTimeZone
	 *            The TimeZone for the resulting clock time.
	 * @return A new Date instance that has the same clock time as the input date but in toTimeZone.
	 */
	public static Date convertClockTimeToTimeZone(Date date, TimeZone fromTimeZone, TimeZone toTimeZone) {
		/*
		 * Dates represent an unambiguous instant of time (ticks since epoch). They contain no TimeZone information.
		 * Calendar's set &amp; get methods will treat the values in the Calendar's time zone.
		 * We set cal1 to the localDate and tell the Calendar it is in GMT. This way when we pull out
		 * the individual pieces of the date &amp; time using the get method, they essentially won't be translated (GMT -&gt; GMT).
		 * We set cal2's date &amp; time to the specific point in time relative to localTimeZone via cal1.
		 * Therefore, the result Date instance obtained via getTime will represent the proper GMT date &amp; time.
		 */
<span class="nc" id="L245">		Calendar fromCal = Calendar.getInstance(fromTimeZone);</span>
<span class="nc" id="L246">		fromCal.setTime(date);</span>

<span class="nc" id="L248">		Calendar toCal = Calendar.getInstance(toTimeZone);</span>
<span class="nc" id="L249">		toCal.set(Calendar.DATE, fromCal.get(Calendar.DATE));</span>
<span class="nc" id="L250">		toCal.set(Calendar.MONTH, fromCal.get(Calendar.MONTH));</span>
<span class="nc" id="L251">		toCal.set(Calendar.YEAR, fromCal.get(Calendar.YEAR));</span>
<span class="nc" id="L252">		toCal.set(Calendar.HOUR_OF_DAY, fromCal.get(Calendar.HOUR_OF_DAY));</span>
<span class="nc" id="L253">		toCal.set(Calendar.MINUTE, fromCal.get(Calendar.MINUTE));</span>
<span class="nc" id="L254">		toCal.set(Calendar.SECOND, fromCal.get(Calendar.SECOND));</span>
<span class="nc" id="L255">		toCal.set(Calendar.MILLISECOND, fromCal.get(Calendar.MILLISECOND));</span>

<span class="nc" id="L257">		return toCal.getTime();</span>
	}

	/**
	 * Returns a Calendar for the specified TimeZone and Date.
	 */
	public static Calendar getCalendar(TimeZone timeZone, Date time) {
<span class="nc" id="L264">		Calendar cal = Calendar.getInstance(timeZone);</span>
<span class="nc" id="L265">		cal.setTime(time);</span>
<span class="nc" id="L266">		return cal;</span>
	}

	public static Date roundDownToInterval(Date date) {
<span class="nc bnc" id="L270" title="All 2 branches missed.">		if(date == null) {</span>
<span class="nc" id="L271">			return null;</span>
		}
<span class="nc" id="L273">		Calendar cal = Calendar.getInstance(TimeZoneUtil.GMT_TIMEZONE);</span>
<span class="nc" id="L274">		cal.setTime(date);</span>
<span class="nc" id="L275">		cal.set(Calendar.SECOND, 0);</span>
<span class="nc" id="L276">		cal.set(Calendar.MILLISECOND, 0);</span>
<span class="nc" id="L277">		cal.set(Calendar.MINUTE, roundDownToInterval(cal.get(Calendar.MINUTE)));</span>
<span class="nc" id="L278">		return cal.getTime();</span>
	}

	public static int roundDownToInterval(int minutes) {
<span class="nc" id="L282">		return minutes / TIME_INTERVAL * TIME_INTERVAL;</span>
	}

	public static Date roundUpToInterval(Date date) {
<span class="nc bnc" id="L286" title="All 2 branches missed.">		if(date == null) {</span>
<span class="nc" id="L287">			return null;</span>
		}
<span class="nc" id="L289">		Calendar cal = Calendar.getInstance(TimeZoneUtil.GMT_TIMEZONE);</span>
<span class="nc" id="L290">		cal.setTime(date);</span>
<span class="nc" id="L291">		cal.set(Calendar.SECOND, 0);</span>
<span class="nc" id="L292">		cal.set(Calendar.MILLISECOND, 0);</span>
<span class="nc" id="L293">		cal.set(Calendar.MINUTE, roundUpToInterval(cal.get(Calendar.MINUTE)));</span>
<span class="nc" id="L294">		return cal.getTime();</span>
	}

	public static int roundUpToInterval(int minutes) {
<span class="nc bnc" id="L298" title="All 2 branches missed.">		if (minutes % TIME_INTERVAL &gt; 0) {</span>
<span class="nc" id="L299">			return ((minutes / TIME_INTERVAL) + 1) * TIME_INTERVAL;</span>
		}
<span class="nc" id="L301">		return minutes;</span>
	}

	/**
	 * Rounds the date to the nearest interval.
	 */
	public static Date roundToNearestInterval(Date date) {
<span class="nc" id="L308">		Date result = null;</span>
<span class="nc bnc" id="L309" title="All 2 branches missed.">		if (date != null) {</span>
<span class="nc" id="L310">			Calendar aCal = Calendar.getInstance(TimeZoneUtil.GMT_TIMEZONE);</span>
<span class="nc" id="L311">			aCal.setTime(date);</span>
<span class="nc" id="L312">			int min = aCal.get(Calendar.MINUTE);</span>
<span class="nc" id="L313">			int remainder = min % TIME_INTERVAL;</span>

<span class="nc bnc" id="L315" title="All 2 branches missed.">			if (remainder == 0) {</span>
<span class="nc" id="L316">				result = date;</span>
			} else {
<span class="nc bnc" id="L318" title="All 2 branches missed.">				int diff = (remainder &gt; (TIME_INTERVAL / 2)) ? (TIME_INTERVAL - remainder) : (0 - remainder);</span>
<span class="nc" id="L319">				min += diff;</span>
<span class="nc" id="L320">				aCal.set(Calendar.MINUTE, min);</span>
<span class="nc" id="L321">				result = aCal.getTime();</span>
			}
		}
<span class="nc" id="L324">		return result;</span>
	}

	public static boolean isBeforeOrEqual(Date first, Date second) {
<span class="nc bnc" id="L328" title="All 2 branches missed.">		return first.compareTo(second) &lt;= 0;</span>
	}

	public static boolean isAfterOrEqual(Date first, Date second) {
<span class="nc bnc" id="L332" title="All 2 branches missed.">		return first.compareTo(second) &gt;= 0;</span>
	}

	/**
	 * Does the intervals [start1,end1) intersect with [start2,end2) ?
	 * Both intervals are start inclusive and end exclusive and nulls for end means the interval is forever
	 */
	public static boolean intervalsIntersect(Date start1, Date end1, Date start2, Date end2) {
<span class="nc bnc" id="L340" title="All 2 branches missed.">		long endTime1 = end1 == null ? Long.MAX_VALUE : end1.getTime();</span>
<span class="nc bnc" id="L341" title="All 2 branches missed.">		long endTime2 = end2 == null ? Long.MAX_VALUE : end2.getTime();</span>
<span class="nc bnc" id="L342" title="All 4 branches missed.">		return start1.getTime() &lt; endTime2 &amp;&amp; endTime1 &gt; start2.getTime();</span>
	}

	/**
	 * Does the intervals [start1,end1] intersect with [start2,end2]?
	 * Both intervals are start and end inclusive.  Nulls for end means the interval is forever.
	 */
	public static boolean intersectsInclusive(Date start1, Date end1, Date start2, Date end2) {
<span class="nc bnc" id="L350" title="All 2 branches missed.">		long endTime1 = end1 == null ? Long.MAX_VALUE : end1.getTime();</span>
<span class="nc bnc" id="L351" title="All 2 branches missed.">		long endTime2 = end2 == null ? Long.MAX_VALUE : end2.getTime();</span>
<span class="nc bnc" id="L352" title="All 4 branches missed.">		return start1.getTime() &lt;= endTime2 &amp;&amp; endTime1 &gt;= start2.getTime();</span>
	}

	public static boolean intersectsExclusiveEnd(Date start, Date endExclusive, Date date) {
<span class="nc bnc" id="L356" title="All 4 branches missed.">		return isBeforeOrEqual(start, date) &amp;&amp; endExclusive.after(date);</span>
	}

	/**
	 * @return
	 * The start of day for the date according to time zone set for the calendar.
	 * Note that the calendar's time is also set to the start of day.
	 */
	public static Date getDayStart(Date dt, Calendar cal) {
<span class="fc" id="L365">		cal.setTime(dt);</span>
<span class="fc" id="L366">		cal.set(Calendar.HOUR_OF_DAY, 0);</span>
<span class="fc" id="L367">		cal.set(Calendar.MINUTE, 0);</span>
<span class="fc" id="L368">		cal.set(Calendar.SECOND, 0);</span>
<span class="fc" id="L369">		cal.set(Calendar.MILLISECOND, 0);</span>
<span class="fc" id="L370">		return cal.getTime();</span>
	}

	public static Date getDayStart(Date dt, TimeZone timeZone) {
<span class="fc" id="L374">		return getDayStart(dt, Calendar.getInstance(timeZone));</span>
	}

	/**
	 * @return
	 * The time from start of day according to the time zone set for the calendar.
	 * Note that the calendar's time is set to dt on return
	 */
	public static int getTimeInMinutesFromStartOfDay(Date dt, Calendar cal) {
<span class="nc" id="L383">		cal.setTime(dt);</span>
<span class="nc" id="L384">		return cal.get(Calendar.HOUR_OF_DAY) * 60 + cal.get(Calendar.MINUTE);</span>
	}

	public static Calendar getCalendar(TimeZone timeZone, int year, int month, int day) {
<span class="nc" id="L388">		Calendar cal = Calendar.getInstance(timeZone);</span>
<span class="nc" id="L389">		cal.clear();</span>
<span class="nc" id="L390">		cal.set(year, month, day);</span>
<span class="nc" id="L391">		return cal;</span>
	}

	public static Date getDateGMT(int year, int month, int day, int hourOfDay, int minute) {
<span class="nc" id="L395">		return getCalendarGMT(year, month, day, hourOfDay, minute).getTime();</span>
	}

	//Copied from sfpDateUtil.java
	public static Calendar getCalendarGMT(int year, int month, int day, int hourOfDay, int minute) {
<span class="nc" id="L400">		Calendar cal = Calendar.getInstance(TimeZoneUtil.GMT_TIMEZONE);</span>
<span class="nc" id="L401">		cal.clear();</span>
<span class="nc" id="L402">		cal.set(year, month, day, hourOfDay, minute);</span>
<span class="nc" id="L403">		return cal;</span>
	}

	//Copied from sfpDateUtil.java
	public static Calendar getCalendarGMT(int year, int month, int day) {
<span class="nc" id="L408">		Calendar cal = Calendar.getInstance(TimeZoneUtil.GMT_TIMEZONE);</span>
<span class="nc" id="L409">		cal.clear();</span>
<span class="nc" id="L410">		cal.set(year, month, day);</span>
<span class="nc" id="L411">		return cal;</span>
	}

	//Copied from sfpDateUtil.java
	public static Date getDateGMT(int year, int month, int day) {
<span class="nc" id="L416">		return getCalendarGMT(year, month, day).getTime();</span>
	}

	/**
	 * Gets the DST transition between the two dates.
	 */
	public static DSTTransitionMode getDSTTransitionMode(Date startTime, Date endTime, TimeZone timeZone) {
<span class="nc" id="L423">		boolean prevIsInDst = timeZone.inDaylightTime(startTime);</span>
<span class="nc" id="L424">		boolean isInDst = timeZone.inDaylightTime(endTime);</span>
<span class="nc bnc" id="L425" title="All 4 branches missed.">		if (prevIsInDst &amp;&amp; !isInDst) {</span>
			// Fall Back / DST Ends (25 hour day)
<span class="nc" id="L427">			return DSTTransitionMode.FALLBACK;</span>
		}
<span class="nc bnc" id="L429" title="All 4 branches missed.">		if (!prevIsInDst &amp;&amp; isInDst) {</span>
			// Spring Forward / DST Starts (23 hour day)
<span class="nc" id="L431">			return DSTTransitionMode.SPRINGFORWARD;</span>
		}
<span class="nc" id="L433">		return DSTTransitionMode.NEUTRAL;</span>
	}

	/**
	 * Gets hours from the minutes value.  Null is returned if minutes is null.
	 * @param minutes
	 * @return
	 */
	public static Float getHoursFromMinutes(Float minutes) {
<span class="nc bnc" id="L442" title="All 2 branches missed.">		if (minutes == null) {</span>
<span class="nc" id="L443">			return minutes;</span>
		}
<span class="nc" id="L445">		return minutes / 60.0f;</span>
	}

	public static void toMidnight(Calendar cal) {
<span class="nc" id="L449">		cal.set(Calendar.HOUR_OF_DAY, 0);</span>
<span class="nc" id="L450">		cal.set(Calendar.MINUTE, 0);</span>
<span class="nc" id="L451">		cal.set(Calendar.SECOND, 0);</span>
<span class="nc" id="L452">		cal.set(Calendar.MILLISECOND, 0);</span>
<span class="nc" id="L453">	}</span>

	/**
	 * Adds the specified number of days to the calendar and sets the offset.
	 */
	public static void addDays(Calendar cal, int numberOfDays, int offsetMinutes) {
<span class="nc" id="L459">		TOCalcUtil.addDaysToCalendar(cal, numberOfDays);</span>
<span class="nc" id="L460">		TOCalcUtil.setCalMinsOffsetFromMidnight(cal, offsetMinutes);</span>
<span class="nc" id="L461">	}</span>

	// Copied from sfpDateUtil.java
	public static Date addDays(Date date, int numberOfDays) {
<span class="nc" id="L465">		Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L466">		cal.setTime(date);</span>
<span class="nc" id="L467">		cal.add(Calendar.DATE, numberOfDays);</span>
<span class="nc" id="L468">		return cal.getTime();</span>
	}

	/**
	 * Gets the start and end times based on the date, org offset, and the time minutes.
	 */
	public static Pair&lt;Date, Date&gt; getTimes(TimeZone timeZone, int orgDayBoundaryOffset, Date date, int startTimeInMinutes,
			int endTimeInMinutes) {
<span class="nc" id="L476">		Pair&lt;Date, Date&gt; result = new Pair&lt;Date, Date&gt;();</span>
<span class="nc" id="L477">		Calendar cal = Calendar.getInstance(timeZone);</span>
<span class="nc" id="L478">		cal.setTime(date);</span>
<span class="nc" id="L479">		DateUtil.toMidnight(cal);</span>
<span class="nc" id="L480">		Date dateAtMidnight = cal.getTime();</span>
<span class="nc" id="L481">		int startHour = startTimeInMinutes / 60;</span>
<span class="nc" id="L482">		int endHour = endTimeInMinutes / 60;</span>
		// we can't add minutes here because it will go too far when passing the skipped DST hour. Use set instead.

<span class="nc bnc" id="L485" title="All 2 branches missed.">		if (orgDayBoundaryOffset &lt;= startTimeInMinutes) {</span>
			// start time is on the date
<span class="nc" id="L487">			cal.set(Calendar.HOUR_OF_DAY, startHour);</span>
<span class="nc" id="L488">			cal.set(Calendar.MINUTE, startTimeInMinutes % 60);</span>
<span class="nc" id="L489">			result.setFirst(cal.getTime());</span>

<span class="nc" id="L491">			cal.setTime(dateAtMidnight);</span>
<span class="nc bnc" id="L492" title="All 2 branches missed.">			if (endTimeInMinutes &lt;= startTimeInMinutes) {</span>
				// end is on the next date
<span class="nc" id="L494">				cal.add(Calendar.DATE, 1);</span>
			}
<span class="nc" id="L496">			cal.set(Calendar.HOUR_OF_DAY, endHour);</span>
<span class="nc" id="L497">			cal.set(Calendar.MINUTE, endTimeInMinutes % 60);</span>
<span class="nc" id="L498">			result.setSecond(cal.getTime());</span>
		} else {
			// both times are on the next day
<span class="nc" id="L501">			cal.add(Calendar.DATE, 1);</span>
<span class="nc" id="L502">			cal.set(Calendar.HOUR_OF_DAY, startHour);</span>
<span class="nc" id="L503">			cal.set(Calendar.MINUTE, startTimeInMinutes % 60);</span>
<span class="nc" id="L504">			result.setFirst(cal.getTime());</span>

<span class="nc" id="L506">			cal.setTime(dateAtMidnight);</span>
<span class="nc" id="L507">			cal.add(Calendar.DATE, 1);</span>
<span class="nc" id="L508">			cal.set(Calendar.HOUR_OF_DAY, endHour);</span>
<span class="nc" id="L509">			cal.set(Calendar.MINUTE, endTimeInMinutes % 60);</span>
<span class="nc" id="L510">			result.setSecond(cal.getTime());</span>
		}

<span class="nc" id="L513">		return result;</span>
	}

	/**
	 * This method duplicated with the WFM-RM-WEB\FormatUtils.java
	 *
	 * @param strDate
	 * @return
	 */
	public static Date iso8601SecPrecisionStringToDate(String strDate, TimeZone orgTZ) {
<span class="nc bnc" id="L523" title="All 2 branches missed.">		if (strDate != null) {</span>
<span class="nc" id="L524">			SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyyy-MM-dd'T'HH:mm:ss.SSS'Z'&quot;);</span>
<span class="nc" id="L525">			sdf.setTimeZone(orgTZ);</span>
<span class="nc" id="L526">			Date dt = sdf.parse(strDate, new ParsePosition(0));</span>
<span class="nc" id="L527">			return dt;</span>
		} else {
<span class="nc" id="L529">			return null;</span>
		}
	}

	public static Date getFirstDateOfCurrentCalendarYear(TimeZone orgTZ) {
<span class="nc" id="L534">		Calendar cal = Calendar.getInstance(orgTZ);</span>
<span class="nc" id="L535">		cal.set(Calendar.MONTH, 0);</span>
<span class="nc" id="L536">		cal.set(Calendar.DAY_OF_MONTH, 1);</span>
<span class="nc" id="L537">		cal.set(Calendar.HOUR_OF_DAY, 0);</span>
<span class="nc" id="L538">		cal.set(Calendar.MINUTE, 0);</span>
<span class="nc" id="L539">		cal.set(Calendar.SECOND, 0);</span>
<span class="nc" id="L540">		cal.set(Calendar.MILLISECOND, 0);</span>
<span class="nc" id="L541">		return cal.getTime();</span>
	}

	public static TimeRange getFiscalRange(Date firstDayOfYear, Date dateInside, int durationInMonths, TimeZone tz) {
<span class="nc bnc" id="L545" title="All 2 branches missed.">		if (dateInside.before(firstDayOfYear)) {</span>
<span class="nc" id="L546">			return null;</span>
		}

<span class="nc" id="L549">		Calendar startPeriod = Calendar.getInstance(tz);</span>
<span class="nc" id="L550">		Calendar endPeriod = Calendar.getInstance(tz);</span>

<span class="nc" id="L552">		int monthOffset = 0;</span>
		do {
<span class="nc" id="L554">			startPeriod.setTime(firstDayOfYear);</span>
<span class="nc" id="L555">			startPeriod.add(Calendar.MONTH, monthOffset);</span>
<span class="nc" id="L556">			endPeriod.setTime(firstDayOfYear);</span>
<span class="nc" id="L557">			endPeriod.add(Calendar.MONTH, monthOffset + durationInMonths);</span>

<span class="nc bnc" id="L559" title="All 2 branches missed.">			if (startPeriod.getTime().getTime() &lt;= dateInside.getTime()</span>
<span class="nc bnc" id="L560" title="All 2 branches missed.">					&amp;&amp; endPeriod.getTime().getTime() &gt; dateInside.getTime()) {</span>
<span class="nc" id="L561">				return new TimeRange(startPeriod.getTime(), endPeriod.getTime());</span>
			}

<span class="nc" id="L564">			monthOffset += durationInMonths;</span>
<span class="nc bnc" id="L565" title="All 2 branches missed.">		} while (startPeriod.getTime().getTime() &lt; dateInside.getTime());</span>

<span class="nc" id="L567">		return null;</span>
	}

	public static TimeRange getInclusiveEnd(TimeRange range) {
<span class="nc" id="L571">		Calendar cal = Calendar.getInstance(TimeZoneUtil.GMT_TIMEZONE);</span>
<span class="nc" id="L572">		cal.setTime(range.getEndDate());</span>
<span class="nc" id="L573">		cal.add(Calendar.MILLISECOND, -1);</span>
<span class="nc" id="L574">		return new TimeRange(range.getStartDate(), cal.getTime());</span>
	}

	/**
	 * Return the minimum non-null Date.
	 */
	public static Date minOfTwoDates(Date d1, Date d2) {
<span class="nc bnc" id="L581" title="All 4 branches missed.">		if (d1 == null &amp;&amp; d2 == null) {</span>
<span class="nc" id="L582">			return null;</span>
		}

<span class="nc bnc" id="L585" title="All 2 branches missed.">		if (d1 == null) {</span>
<span class="nc" id="L586">			return d2;</span>
		}

<span class="nc bnc" id="L589" title="All 2 branches missed.">		if (d2 == null) {</span>
<span class="nc" id="L590">			return d1;</span>
		}

<span class="nc bnc" id="L593" title="All 2 branches missed.">		if (d1.before(d2)) {</span>
<span class="nc" id="L594">			return d1;</span>
		}

<span class="nc" id="L597">		return d2;</span>
	}

	/**
	 * Return the maximum non-null Date.
	 */
	public static Date maxOfTwoDates(Date d1, Date d2) {
<span class="nc bnc" id="L604" title="All 4 branches missed.">		if (d1 == null &amp;&amp; d2 == null) {</span>
<span class="nc" id="L605">			return null;</span>
		}

<span class="nc bnc" id="L608" title="All 2 branches missed.">		if (d1 == null) {</span>
<span class="nc" id="L609">			return d2;</span>
		}

<span class="nc bnc" id="L612" title="All 2 branches missed.">		if (d2 == null) {</span>
<span class="nc" id="L613">			return d1;</span>
		}

<span class="nc bnc" id="L616" title="All 2 branches missed.">		if (d1.after(d2)) {</span>
<span class="nc" id="L617">			return d1;</span>
		}

<span class="nc" id="L620">		return d2;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>