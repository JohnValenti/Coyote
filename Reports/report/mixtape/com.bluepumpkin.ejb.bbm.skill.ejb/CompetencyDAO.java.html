<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>CompetencyDAO.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.ejb.bbm.skill.ejb</a> &gt; <span class="el_source">CompetencyDAO.java</span></div><h1>CompetencyDAO.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.ejb.bbm.skill.ejb;

/**
 * Title:        Blue Pumpkin Software Basic Business Model
 * Description:  DAO object to serialize Skill object
 * Copyright:    Copyright (c) 2001
 * Company:      Blue Pumpkin Software, Inc
 * @author       lixin zhang
 * @version      1.0
 */

import java.util.ArrayList;
import java.util.Collection;
import java.util.HashMap;
import java.util.Iterator;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.jdmo.Jdmo;
import com.bluepumpkin.common.jdmo.JdmoException;
import com.bluepumpkin.ejb.bbm.base.BbmCreateException;
import com.bluepumpkin.ejb.bbm.base.BbmFinderException;
import com.bluepumpkin.ejb.bbm.base.BbmUpdateException;
import com.bluepumpkin.ejb.bbm.dao.DAOBase;
import com.bluepumpkin.ejb.bbm.skill.model.Competency;
import com.bluepumpkin.ejb.bbm.skill.model.CompetencyFieldInfo;
import com.bluepumpkin.ejb.bbm.vo.FieldInfo;
import com.bluepumpkin.ejb.bbm.vo.ValueObjectBase;

public class CompetencyDAO extends DAOBase {

<span class="nc" id="L31">	private static FieldInfo m_fieldInfo = new CompetencyFieldInfo();</span>
<span class="nc" id="L32">	protected FieldInfo getFieldInfo() { return m_fieldInfo; }</span>

	public CompetencyDAO() {
<span class="nc" id="L35">		super();</span>
<span class="nc" id="L36">	}</span>

	public CompetencyDAO(Jdmo dmo) {
<span class="nc" id="L39">		super(dmo);</span>
<span class="nc" id="L40">	}</span>

	protected ValueObjectBase createValueObject()
	{
<span class="nc" id="L44">		return (new Competency());</span>
	}


	public Collection saveCompetencies(Collection compColl)
		throws 	BbmCreateException, 
				BbmFinderException,
				BbmUpdateException
	{
<span class="nc bnc" id="L53" title="All 4 branches missed.">		if( compColl == null || compColl.size() &lt;= 0 )</span>
<span class="nc" id="L54">			return compColl;</span>
		
<span class="nc" id="L56">		HashMap hmInsert = new HashMap();</span>
<span class="nc" id="L57">		HashMap hmUpdate = new HashMap();</span>
<span class="nc" id="L58">		HashMap hmDelete = new HashMap();</span>
	
		try 
		{
<span class="nc" id="L62">			Collection coll = this.getObjects(&quot;&quot;);</span>
<span class="nc bnc" id="L63" title="All 2 branches missed.">			if( coll != null )</span>
			{
<span class="nc" id="L65">				Iterator iter = coll.iterator();</span>
<span class="nc bnc" id="L66" title="All 2 branches missed.">				while( iter.hasNext() )</span>
				{
<span class="nc" id="L68">					Competency obj = (Competency)iter.next();</span>
<span class="nc" id="L69">					obj.setIsDeleted(true);</span>
<span class="nc" id="L70">					hmDelete.put(obj.getExternalIdent(), obj );</span>
<span class="nc" id="L71">				}</span>
			}
			
<span class="nc" id="L74">			Iterator iter = compColl.iterator();</span>
<span class="nc bnc" id="L75" title="All 2 branches missed.">			while( iter.hasNext() )</span>
			{
<span class="nc" id="L77">				Competency newObj = (Competency)iter.next();</span>
<span class="nc" id="L78">				String ident = newObj.getExternalIdent();</span>

<span class="nc" id="L80">				Competency obj = (Competency)hmDelete.get(ident);</span>
<span class="nc bnc" id="L81" title="All 2 branches missed.">				if( obj != null ) </span>
				{
<span class="nc" id="L83">					obj.setIsDeleted( newObj.getIsDeleted()  );</span>
<span class="nc" id="L84">					obj.setDescription( newObj.getDescription() );</span>
<span class="nc" id="L85">					obj.setModificationTime( newObj.getModificationTime() );</span>
<span class="nc" id="L86">					obj.setCreationTime( newObj.getCreationTime() );</span>
<span class="nc" id="L87">					obj.setName( newObj.getName() );</span>
<span class="nc" id="L88">					hmUpdate.put(ident, obj);</span>
<span class="nc" id="L89">					hmDelete.remove(ident);</span>
				}
				else 
				{
<span class="nc bnc" id="L93" title="All 4 branches missed.">					if( ident == null || ident.length() &lt;= 0 )</span>
<span class="nc" id="L94">						continue;</span>
<span class="nc" id="L95">					String name = newObj.getName();</span>
<span class="nc bnc" id="L96" title="All 4 branches missed.">					if( name == null || name.length() &lt;= 0 )</span>
<span class="nc" id="L97">						continue;</span>
					
<span class="nc" id="L99">					hmInsert.put(ident, newObj);</span>
				}
<span class="nc" id="L101">			}</span>
				
<span class="nc bnc" id="L103" title="All 2 branches missed.">			if( hmInsert.size() &gt; 0 )</span>
			{
				try
				{
<span class="nc" id="L107">					this.insertBatchObjects( hmInsert.values());</span>
				}
<span class="nc" id="L109">				catch( Exception ex )</span>
				{
<span class="nc" id="L111">					throw new BbmCreateException(ex);</span>
<span class="nc" id="L112">				}</span>
			}
			
<span class="nc bnc" id="L115" title="All 2 branches missed.">			if( hmUpdate.size() &gt; 0 )</span>
			{
				try
				{
<span class="nc" id="L119">					this.updateBatchObjects(hmUpdate.values());</span>
				}
<span class="nc" id="L121">				catch( Exception ex )</span>
				{
<span class="nc" id="L123">					throw new BbmCreateException(ex);</span>
<span class="nc" id="L124">				}</span>
			}

<span class="nc bnc" id="L127" title="All 2 branches missed.">			if( hmDelete.size() &gt; 0 )</span>
			{
				try
				{
<span class="nc" id="L131">					this.updateBatchObjects(hmDelete.values());</span>
				}
<span class="nc" id="L133">				catch( Exception ex )</span>
				{
<span class="nc" id="L135">					throw new BbmCreateException(ex);</span>
<span class="nc" id="L136">				}</span>
			}

			try
			{
<span class="nc" id="L141">				this.executeBatch();</span>
			}
<span class="nc" id="L143">			catch( Exception ex )</span>
			{
<span class="nc" id="L145">				throw new BbmCreateException(ex);</span>
<span class="nc" id="L146">			}</span>
				
<span class="nc" id="L148">			ArrayList retVal = new ArrayList();</span>
<span class="nc" id="L149">			retVal.addAll( hmInsert.values() );</span>
			
<span class="nc" id="L151">			return retVal;</span>
		} 
		finally 
		{
<span class="nc" id="L155">			this.cleanUp();</span>
		}
	}

	private void insertBatchObjects(Collection coll) throws JdmoException
	{
<span class="nc" id="L161">		String tblName = this.getDaoFieldInfo().getTableName();</span>
		
<span class="nc" id="L163">		Iterator iter = coll.iterator();</span>
<span class="nc bnc" id="L164" title="All 2 branches missed.">		while( iter.hasNext() )</span>
		{
<span class="nc" id="L166">			Competency obj = (Competency)iter.next();</span>
<span class="nc" id="L167">			this.m_dmo.addBatchInsert(tblName, getMap(obj));</span>
<span class="nc" id="L168">		}</span>
<span class="nc" id="L169">	}</span>

	private void updateBatchObjects(Collection coll) throws JdmoException
	{
<span class="nc" id="L173">		String tblName = this.getDaoFieldInfo().getTableName();</span>
		
<span class="nc" id="L175">		Iterator iter = coll.iterator();</span>
<span class="nc bnc" id="L176" title="All 2 branches missed.">		while( iter.hasNext() )</span>
		{
<span class="nc" id="L178">			Competency obj = (Competency)iter.next();</span>
<span class="nc" id="L179">			this.m_dmo.addBatchUpdate(tblName, getMap(obj));</span>
<span class="nc" id="L180">		}</span>
<span class="nc" id="L181">	}</span>

	private HashMap getMap( Competency obj )
	{
<span class="nc" id="L185">		HashMap map = new HashMap();</span>
		
<span class="nc" id="L187">		ID id = obj.getID();</span>
<span class="nc bnc" id="L188" title="All 2 branches missed.">		if( id != null )</span>
		{
<span class="nc" id="L190">			map.put(&quot;ID&quot;, id); </span>
		}
	
<span class="nc" id="L193">		map.put(CompetencyFieldInfo.getColumnName(CompetencyFieldInfo.COMPETENCY_EXTERNALIDENT), </span>
<span class="nc" id="L194">				obj.getExternalIdent() );</span>
		
<span class="nc" id="L196">		map.put(CompetencyFieldInfo.getColumnName(CompetencyFieldInfo.COMPETENCY_NAME), </span>
<span class="nc" id="L197">				obj.getName() );</span>

<span class="nc" id="L199">		map.put(CompetencyFieldInfo.getColumnName(CompetencyFieldInfo.COMPETENCY_DESCRIPTION), </span>
<span class="nc" id="L200">				obj.getDescription() );</span>

<span class="nc" id="L202">		map.put(CompetencyFieldInfo.getColumnName(CompetencyFieldInfo.COMPETENCY_CREATIONTIME), </span>
<span class="nc" id="L203">						obj.getCreationTime() );</span>

<span class="nc" id="L205">		map.put(CompetencyFieldInfo.getColumnName(CompetencyFieldInfo.COMPETENCY_MODIFICATIONTIME), </span>
<span class="nc" id="L206">				obj.getModificationTime() );</span>

<span class="nc" id="L208">		map.put(CompetencyFieldInfo.getColumnName(CompetencyFieldInfo.COMPETENCY_ISDELETED), </span>
<span class="nc" id="L209">				new Boolean(obj.getIsDeleted()) );</span>

		 
<span class="nc" id="L212">		return map;</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>