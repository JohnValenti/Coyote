<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>GenericSkillAssignmentDAO.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.ejb.bbm.skill.ejb</a> &gt; <span class="el_source">GenericSkillAssignmentDAO.java</span></div><h1>GenericSkillAssignmentDAO.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.ejb.bbm.skill.ejb;

/**
 * Title:        Blue Pumpkin Software Basic Business Model
 * Description:  dao object to serialize GenericSkillAssignment object
 * Copyright:    Copyright (c) 2001
 * Company:      Blue Pumpkin Software, Inc
 * @author       lixin zhang
 * @version      1.0
 */

import java.util.ArrayList;
import java.util.Collection;
import java.util.Date;
import java.util.HashMap;
import java.util.Iterator;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.TimeRange;
import com.bluepumpkin.common.jdmo.Jdmo;
import com.bluepumpkin.ejb.bbm.base.BbmCreateException;
import com.bluepumpkin.ejb.bbm.base.BbmFinderException;
import com.bluepumpkin.ejb.bbm.base.BbmRemoveException;
import com.bluepumpkin.ejb.bbm.base.BbmUpdateException;
import com.bluepumpkin.ejb.bbm.dao.DAOEffectivity;
import com.bluepumpkin.ejb.bbm.skill.model.EmployeeSkillChangeObject;
import com.bluepumpkin.ejb.bbm.skill.model.GenericSkillAssignment;
import com.bluepumpkin.ejb.bbm.skill.model.GenericSkillAssignmentFieldInfo;
import com.bluepumpkin.ejb.bbm.vo.FieldInfo;
import com.bluepumpkin.ejb.bbm.vo.ValueObjectBase;
import com.bluepumpkin.ejb.core.CoreManagerFactory;
import com.bluepumpkin.ejb.core.base.MultiUserException;
import com.bluepumpkin.ejb.core.change.ejb.ChangeManager;


public class GenericSkillAssignmentDAO extends DAOEffectivity {

<span class="nc" id="L38">    private static FieldInfo m_fieldInfo = new GenericSkillAssignmentFieldInfo();</span>
<span class="nc" id="L39">    protected FieldInfo getFieldInfo() { return m_fieldInfo; }</span>

<span class="nc" id="L41">    private ChangeManager m_changeManager = null;</span>
    
    public GenericSkillAssignmentDAO() {
<span class="nc" id="L44">         super();</span>
<span class="nc" id="L45">    }</span>

    public GenericSkillAssignmentDAO(Jdmo dmo) {
<span class="nc" id="L48">         super(dmo);</span>
<span class="nc" id="L49">    }</span>

    protected ValueObjectBase createValueObject()
    {
<span class="nc" id="L53">        return (new GenericSkillAssignment());</span>
    } 
    
   /**
     *   get a given work resource's skill assignment
     *   
     *   @idWorkResource work resource id
     *   @dtStart, @dtEnd: the time period, null date means a open period
     *   
     *   @return a collection of SkillAssignment objects which hold the assignment information
     */
    public Collection getSkillAssignments(ID idWorkResource, Date dtStart, Date dtEnd) throws BbmFinderException
    {
<span class="nc" id="L66">        return super.getEffectivityAssignments(idWorkResource, </span>
          GenericSkillAssignmentFieldInfo.GSKILLASSIGNMENT_WORKRESOURCEID, dtStart, dtEnd);     
    }    
        
    /**
     *   get skill assignments for a list of work resources 
     *   
     *   @colWorkResourceIDs  a collection of work resource ids
     *   @dtStart, @dtEnd: the time period, null date means a open period
     *   
     *   @return a HashMap of following pairs 
     *            (idWorkResource, array list of skill assignments)
     */
    public HashMap getSkillAssignments(Collection colWorkResourceIDs, Date dtStart, Date dtEnd) throws BbmFinderException
    {
<span class="nc" id="L81">        return super.getEffectivityAssignments(colWorkResourceIDs, GenericSkillAssignmentFieldInfo.GSKILLASSIGNMENT_WORKRESOURCEID,</span>
                             dtStart, dtEnd);
    }    
    
    /** create a skill assignment */
    public ID createSkillAssignment(GenericSkillAssignment objValue) throws BbmCreateException
    {
<span class="nc" id="L88">        ID id = super.createNoOverlapAssignment(objValue, GenericSkillAssignmentFieldInfo.GSKILLASSIGNMENT_WORKRESOURCEID, </span>
              -1);
        
        try {
<span class="nc" id="L92">            this.notifyChangeManager(objValue);</span>
<span class="nc" id="L93">        } catch(Exception e) {</span>
<span class="nc" id="L94">            throw new BbmCreateException(e);</span>
<span class="nc" id="L95">        }</span>
        
<span class="nc" id="L97">        return id;</span>
    }    
    	
    /** 
     *  save a skill assignment 
     *  @param bSaveAsNew where save as new assignment or replace existing one
     * 
     */
    public void updateSkillAssignment(GenericSkillAssignment objValue, boolean bSaveAsNew) throws MultiUserException, BbmUpdateException
    {
<span class="nc" id="L107">        super.updateNoOverlapAssignment(objValue, GenericSkillAssignmentFieldInfo.GSKILLASSIGNMENT_WORKRESOURCEID, </span>
              -1, bSaveAsNew);
              
        try {
<span class="nc" id="L111">            this.notifyChangeManager(objValue);</span>
<span class="nc" id="L112">        } catch(Exception e) {</span>
<span class="nc" id="L113">            throw new BbmUpdateException(e);</span>
<span class="nc" id="L114">        }</span>
<span class="nc" id="L115">    }</span>
   
    /** delete skill assignments given their assignment ids */
    public void deleteSkillAssignments(Collection colIDAssignments) throws BbmRemoveException
    {
         Collection colAssignments;
         try {
<span class="nc" id="L122">            colAssignments = this.getObjectsByIDs(colIDAssignments);</span>
<span class="nc bnc" id="L123" title="All 4 branches missed.">            if (colAssignments == null || colAssignments.isEmpty()) return;</span>
<span class="nc" id="L124">         } catch (Exception e) {</span>
<span class="nc" id="L125">            throw new BbmRemoveException(e);</span>
<span class="nc" id="L126">         }</span>
         
<span class="nc" id="L128">         deleteObjects(colIDAssignments);</span>
         
         try {
<span class="nc" id="L131">             Iterator it = colAssignments.iterator();</span>
<span class="nc bnc" id="L132" title="All 2 branches missed.">             while (it.hasNext())</span>
<span class="nc" id="L133">                this.notifyChangeManager((GenericSkillAssignment) it.next());</span>
<span class="nc" id="L134">         } catch (Exception e) {</span>
<span class="nc" id="L135">            throw new BbmRemoveException(e);</span>
<span class="nc" id="L136">         }</span>
<span class="nc" id="L137">    }	</span>
    
    public Collection getSkillAssignmentsByIDs(Collection colIDSAs) throws BbmFinderException
    {
<span class="nc" id="L141">        return this.getObjectsByIDs(colIDSAs);</span>
    }
    
    public void notifyChangeManager(GenericSkillAssignment assignment) 
        throws Exception
    {
<span class="nc bnc" id="L147" title="All 2 branches missed.">        if (m_changeManager == null)</span>
<span class="nc" id="L148">           m_changeManager = CoreManagerFactory.getChangeManager();</span>
           
<span class="nc" id="L150">        ArrayList arrIDs = new ArrayList(1);</span>
<span class="nc" id="L151">        arrIDs.add(assignment.getWorkResourceID());</span>
        
<span class="nc" id="L153">        TimeRange range = new TimeRange(assignment.getStartTime(), </span>
<span class="nc bnc" id="L154" title="All 2 branches missed.">           assignment.getEndTime() == null ? </span>
<span class="nc" id="L155">           new Date(TimeRange.FAR_FUTURE) : assignment.getEndTime());</span>
           
<span class="nc" id="L157">        EmployeeSkillChangeObject vo = new EmployeeSkillChangeObject();</span>
<span class="nc" id="L158">      	vo.setAffectedObjects(EmployeeSkillChangeObject.EMPLOYEE_TYPE, arrIDs);</span>
<span class="nc" id="L159">		vo.setAffectedTimeRange(range);</span>
<span class="nc" id="L160">		m_changeManager.onChange(vo);								</span>
<span class="nc" id="L161">	}</span>
    
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>