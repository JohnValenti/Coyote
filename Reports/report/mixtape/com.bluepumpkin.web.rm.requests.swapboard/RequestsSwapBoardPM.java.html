<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>RequestsSwapBoardPM.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.rm.requests.swapboard</a> &gt; <span class="el_source">RequestsSwapBoardPM.java</span></div><h1>RequestsSwapBoardPM.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.rm.requests.swapboard;

import java.rmi.RemoteException;
import java.util.ArrayList;
import java.util.Collection;
import java.util.Collections;
import java.util.Date;
import java.util.List;
import java.util.Map;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.Pair;
import com.bluepumpkin.ejb.bbm.base.BbmException;
import com.bluepumpkin.ejb.rm.base.RmHardValidationException;
import com.bluepumpkin.ejb.rm.requests.swap.posting.model.SSPostingCollection;
import com.bluepumpkin.ejb.rm.requests.swap.posting.model.ShiftSwapPosting;
import com.bluepumpkin.web.fs.schedule.personal.PersonalTextSchedulePM;
import com.bluepumpkin.web.rm.keys.RmImageFileID;
import com.bluepumpkin.web.rm.keys.RmJavaScriptFileID;
import com.bluepumpkin.web.rm.keys.RmKeys;
import com.bluepumpkin.web.rm.keys.RmPageAction;
import com.bluepumpkin.web.rm.l10n.RmWebBundleKey;
import com.bluepumpkin.web.rm.requests.RequestUtil;
import com.bluepumpkin.web.rm.requests.RequestsPM;
import com.bluepumpkin.web.rm.requests.SwapUtil;
import com.bluepumpkin.web.rm.requests.shiftswap.ShiftSwapRequestsMH;
import com.witness.ejb.core.security.PrivilegeKeys;
import com.witness.web.uif.base.Message;
import com.witness.web.uif.keys.ImageFileID;
import com.witness.web.uif.keys.PageAction;
import com.witness.web.uif.l10n.UIFWebBundleKey;
import com.witness.web.uif.pagecomponent.DefaultMultiColumnNodeData;
import com.witness.web.uif.pagecomponent.picker.date.DatePickerPC;
import com.witness.web.uif.pagecomponent.table.TableHeaderPC;
import com.witness.web.uif.pagemodel.PageModel;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.util.HtmlUtil;
import com.witness.web.uif.util.SortUtil;
import com.witness.web.uif.util.html.HtmlChoiceInput;
import com.witness.web.uif.util.js.JSUtil;

/**
 * Title:        RequestsSwapBoardPM
 * Description:  My Shift Swap bulletin board.
 * Copyright:    Copyright (c) 2001
 * Company:      Blue Pumpkin Software, inc
 * @author       Zhibo, David Su
 * @version      1.0
 */
public class RequestsSwapBoardPM extends RequestsPM {
	private static final String POPUP_FORM_ACTION = RmPageAction.POPUP_SWAPBOARD_POSTING_FORM_ACTION;
	private static final String FORM_ACTION = &quot;my_requests_swapboard&quot;;
	private static final String VIEW_MODE_FN = &quot;viewMode&quot;;
	private static final String POSTING_ID_FN = &quot;postingID&quot;;

	private DatePickerPC m_datePicker;
<span class="nc" id="L57">	private Map m_eNameMap = Collections.EMPTY_MAP;</span>
<span class="nc" id="L58">	private Map m_eOrgMap = Collections.EMPTY_MAP;</span>
	private String m_viewMode;
	private ID m_postingID;
<span class="nc" id="L61">	private boolean m_isAuthorized=false;</span>
<span class="nc" id="L62">	protected boolean m_isIncludePartial = true;</span>
<span class="nc" id="L63">	private List&lt;DefaultMultiColumnNodeData&gt; multiColListModel = Collections.emptyList();</span>

	public static final String ALL_POSTINGS = &quot;ALL_POSTINGS&quot;;
	public static final String MY_POSTINGS = &quot;MY_POSTINGS&quot;;
	public static final String POSTING_BY_ORG = &quot;POSTING_BY_ORG&quot;;
	public static final String POSTING_BY_CAMP = &quot;POSTING_BY_CAMP&quot;;

	/**
	 * Constructs a schedule view page model shell.
	 */
	public RequestsSwapBoardPM(RequestContext context) {
<span class="nc" id="L74">		super(context);</span>

<span class="nc" id="L76">		m_isAuthorized = isAuthorized();</span>
<span class="nc" id="L77">		m_viewMode = RequestUtil.getCachedSwapBoardViewMode(m_context);</span>

<span class="nc" id="L79">		setDefaultPageIDSize(50);</span>
<span class="nc" id="L80">	}</span>

	/**
	 * Initialize Component For Display
	 */
	@Override
	public void initForDisplay() {
<span class="nc bnc" id="L87" title="All 2 branches missed.">		if (m_isInitializedForDisplay) return;</span>
		else {
<span class="nc" id="L89">			super.initForDisplay();</span>

<span class="nc" id="L91">			setJSMediator(RmJavaScriptFileID.MEDIATOR_POSTING);</span>
<span class="nc" id="L92">			addJSVariable(&quot;WITHDRAW_CONFIRMATION&quot;, m_bundle,</span>
					RmWebBundleKey.SWAPBOARD_POSTING_WITHDRAW_CONFIRMATION);
<span class="nc" id="L94">			addJSVariableAsString(&quot;VIEW_SCHEDULE_URL&quot;,</span>
					PersonalTextSchedulePM.FORM_ACTION);

<span class="nc" id="L97">			initShiftSwapPopupWindowArgs();</span>
		}
<span class="nc" id="L99">	}</span>

	/**
	 * Add Page Not Enabled Message
	 */
	@Override
	protected void addPageNotEnabledMsg() {
<span class="nc" id="L106">		SwapUtil.addSSNotEnabledMsg(this);</span>
<span class="nc" id="L107">	}</span>

	/**
	 * Return instance of Model which is ready to be rendered
	 */
	public static PageModel getInstance(RequestContext context) throws Exception {
<span class="nc" id="L113">		return getInstance(context, RequestsSwapBoardPM.class);</span>
	}
	
	private SSPostingCollection getPostingCollection() throws RmHardValidationException, RemoteException, BbmException{
<span class="nc" id="L117">		int pageIDSize = Integer.MAX_VALUE;</span>
<span class="nc" id="L118">		SSPostingCollection result = null;</span>
		
<span class="nc bnc" id="L120" title="All 2 branches missed.">		if (ALL_POSTINGS.equals(m_viewMode)) {</span>
<span class="nc" id="L121">			result = RequestsSwapBoardMH.getAllPostings(m_empID, pageIDSize, m_isIncludePartial);</span>
<span class="nc bnc" id="L122" title="All 2 branches missed.">		} else if ( POSTING_BY_CAMP.equals(m_viewMode) ) {</span>
<span class="nc" id="L123">			result = RequestsSwapBoardMH.getMyCampaignPostings(m_empID, pageIDSize, m_isIncludePartial);</span>
<span class="nc bnc" id="L124" title="All 2 branches missed.">		} else if ( POSTING_BY_ORG.equals(m_viewMode) ) {</span>
<span class="nc" id="L125">			result = RequestsSwapBoardMH.getMyOrgPostings(m_empID, pageIDSize, m_isIncludePartial);</span>
		} else {
<span class="nc" id="L127">			result = RequestsSwapBoardMH.getMyPostings(m_empID, pageIDSize, m_isIncludePartial);</span>
		}
		
<span class="nc" id="L130">		return result;</span>
	}
	
	/*
	 * The first element in the returned pair is the list of all posting ids sorted per the current selection
	 * The second element is the list model for the current page that is being displayed 
	 */
	private Pair&lt;List&lt;ID&gt;, List&lt;DefaultMultiColumnNodeData&gt; &gt; sortAndPaginate(Collection&lt;ShiftSwapPosting&gt; allPostings){
		
<span class="nc" id="L139">		List&lt;DefaultMultiColumnNodeData&gt; listModel = getListModelFromPostings(allPostings);</span>
		
		//sort on currently selected column
<span class="nc" id="L142">		TableHeaderPC header = m_list.getHeader();</span>
<span class="nc" id="L143">		int[] sortColumnIndexes = header.getSortColumnIndexes();</span>
<span class="nc bnc" id="L144" title="All 4 branches missed.">		if(listModel == null || listModel.isEmpty() ) {</span>
<span class="nc" id="L145">			return new Pair&lt;List&lt;ID&gt;, List&lt;DefaultMultiColumnNodeData&gt; &gt;( Collections.&lt;ID&gt;emptyList(), Collections.&lt;DefaultMultiColumnNodeData&gt;emptyList());</span>
		}
		
<span class="nc" id="L148">		boolean isAscending = header.isAscending();</span>
<span class="nc bnc" id="L149" title="All 2 branches missed.">		if( sortColumnIndexes != null){</span>
<span class="nc" id="L150">			SortUtil.sort(listModel, sortColumnIndexes, isAscending, m_localizer);</span>
		}
		
		
<span class="nc" id="L154">		List&lt;ID&gt; sortedPostingIds = new ArrayList&lt;ID&gt;(listModel.size());</span>
<span class="nc bnc" id="L155" title="All 2 branches missed.">		for(DefaultMultiColumnNodeData rowData: listModel){</span>
<span class="nc" id="L156">			ID postingId = new ID(  Integer.parseInt(rowData.getID()));</span>
<span class="nc" id="L157">			sortedPostingIds.add(postingId);</span>
<span class="nc" id="L158">		}</span>
		
		//now get the current page
<span class="nc" id="L161">		int pageSize = getPageIDSize();</span>
		//getPagePaginationIndex() does not seem to return the value of the current page. Use getEditIndex instead
<span class="nc bnc" id="L163" title="All 2 branches missed.">		int pageNumber = pageSize&gt;0? getEditIndex()/pageSize : 0; </span>
<span class="nc" id="L164">		List&lt;DefaultMultiColumnNodeData&gt; pagedModel =  com.verint.web.rm.rest.util.RmUtils.pageList(listModel, pageSize, pageNumber);</span>

<span class="nc" id="L166">		return new Pair&lt;List&lt;ID&gt;, List&lt;DefaultMultiColumnNodeData&gt; &gt;(sortedPostingIds,pagedModel);</span>
	}
	
	


	/**
	 * Populate Model
	 */
	@Override
	protected void loadData() throws Exception {
<span class="nc bnc" id="L177" title="All 2 branches missed.">		if (m_isAuthorized) {</span>
<span class="nc" id="L178">			m_orgSetting = ShiftSwapRequestsMH.getOrgSettingForEmployee(m_context, m_empID);</span>
<span class="nc bnc" id="L179" title="All 2 branches missed.">			if (m_orgSetting == null){</span>
<span class="nc" id="L180">				this.addPageMessage(Message.ERROR_TYPE, RmWebBundleKey.EMP_NO_ORG,</span>
    					RmWebBundleKey.BUNDLE_NAME);
<span class="nc" id="L182">            	return;</span>
			}
<span class="nc" id="L184">			m_isPageEnabled = m_orgSetting.getEnableShiftSwap();</span>

<span class="nc bnc" id="L186" title="All 2 branches missed.">			if (m_isPageEnabled) {</span>
				try {
<span class="nc" id="L188">					initDatePicker();</span>
					//headers are initialized here since we need to sort based on the sort column header to paginate correctly
<span class="nc" id="L190">					initHeader();</span>
					Collection&lt;ShiftSwapPosting&gt; postings;

<span class="nc bnc" id="L193" title="All 2 branches missed.">					if (isPaginationNavPressed()) {</span>
						//the user clicked one of the page buttons (next,previous, etc..)
<span class="nc" id="L195">						postings = RequestsSwapBoardMH.getPostings(getPageIDs());</span>
<span class="nc" id="L196">						setupNameAndOrgMap(postings);</span>
<span class="nc" id="L197">						multiColListModel = getListModelFromPostings(postings);</span>
					} else {
<span class="nc" id="L199">						SSPostingCollection result = getPostingCollection();</span>
<span class="nc" id="L200">						postings = result.getPostings();</span>
<span class="nc" id="L201">						setupNameAndOrgMap(postings);</span>
<span class="nc" id="L202">						Pair&lt;List&lt;ID&gt;, List&lt;DefaultMultiColumnNodeData&gt; &gt;  pagedData =  sortAndPaginate(postings);</span>
<span class="nc" id="L203">						setPaginationIDs(pagedData.getFirst());</span>
<span class="nc" id="L204">						multiColListModel = pagedData.getSecond();</span>
					}
					
<span class="nc" id="L207">				} catch (RmHardValidationException ex) {</span>
<span class="nc" id="L208">					Message msg = handleUnableToLoadDataError(log, ex);</span>
<span class="nc" id="L209">					msg.setAssociatedMessage(ex.getLocalizedMessage(m_localizer, m_context.getViewingTimeZone()));</span>
<span class="nc" id="L210">				}</span>
			}
		}
<span class="nc" id="L213">	}</span>
	
	
	private void setupNameAndOrgMap(Collection&lt;ShiftSwapPosting&gt; postings) throws RemoteException, BbmException{
<span class="nc" id="L217">		Collection&lt;ID&gt; empIDList = RequestsSwapBoardMH.getUniqueEmpIDsForPostings(postings);</span>
<span class="nc" id="L218">		m_eNameMap = RequestsSwapBoardMH.getEmpNameMap(m_context, empIDList);</span>
<span class="nc" id="L219">		m_eOrgMap = RequestsSwapBoardMH.getEmpOrgMap(m_context, empIDList);</span>
<span class="nc" id="L220">	}</span>
	

	/**
	 * Initialize Popup Window Arguments for Shift Swap
	 */
	@Override
	protected void initShiftSwapPopupWindowArgs() {
<span class="nc" id="L228">		addPopupArgs(RmPageAction.POPUP_AGENT_SKILLS_ACTION, RmKeys.RH_AGENT_SKILLS,</span>
				null, &quot;employeeID,shiftDate1,shiftDate2&quot;, &quot;450,350,ctr,ctr&quot;, true, 1);

<span class="nc" id="L231">		addPopupArgs(RmPageAction.POPUP_SHIFTSWAP_REQUEST_FORM_ACTION, RmKeys.RH_SHIFTSWAP_FORM,</span>
				null, &quot;postingID&quot;, &quot;560,545,ctr,ctr&quot;, true, 1);

<span class="nc" id="L234">		addPopupArgs(POPUP_FORM_ACTION, RmKeys.RH_SWAPBOARD_FORM,</span>
				null, &quot;postingID&quot;, &quot;560,500,ctr,ctr&quot;, true, 1);
<span class="nc" id="L236">	}</span>

	/**
	 * Initialize Date Picker used to create Date Input Value for View Schedule
	 */
	protected void initDatePicker() {
<span class="nc" id="L242">		m_datePicker = new DatePickerPC(m_context, &quot;&quot;);</span>
<span class="nc" id="L243">	}</span>

	/**
	 * Initialize Header
	 */
	@Override
	protected void initHeader() {
<span class="nc" id="L250">		TableHeaderPC header = m_list.getHeader();</span>
<span class="nc" id="L251">		Collection headers = header.getHeaders();</span>
<span class="nc bnc" id="L252" title="All 4 branches missed.">		if(headers!=null &amp;&amp; headers.size()!=0){</span>
<span class="nc" id="L253">			return;</span>
		}
		
<span class="nc" id="L256">		header.setPartialSortable(true);</span>

<span class="nc" id="L258">		addHeaderData(header, m_common_bundle, UIFWebBundleKey.NAME, true);</span>
<span class="nc" id="L259">		addHeaderData(header, m_bundle, RmWebBundleKey.SHIFT_DATE, true);</span>
<span class="nc" id="L260">		addHeaderData(header, m_common_bundle, UIFWebBundleKey.START, false);</span>
<span class="nc" id="L261">		addHeaderData(header, m_common_bundle, UIFWebBundleKey.END, false);</span>
<span class="nc" id="L262">		addHeaderData(header, m_bundle, RmWebBundleKey.POST_EXPIRES, true);</span>
<span class="nc bnc" id="L263" title="All 2 branches missed.">		if (m_isIncludePartial)</span>
<span class="nc" id="L264">			addHeaderData(header, m_bundle, RmWebBundleKey.PARTIAL_SHIFT, true);</span>
<span class="nc" id="L265">		addHeaderData(header, m_common_bundle, UIFWebBundleKey.CONFIRM, true);</span>
<span class="nc" id="L266">		addHeaderData(header, m_bundle, RmWebBundleKey.SWAPTYPE, true);</span>
<span class="nc" id="L267">		addHeaderData(header, m_common_bundle, UIFWebBundleKey.COMMENTS, false);</span>
<span class="nc" id="L268">		addHeaderData(header, m_common_bundle, UIFWebBundleKey.ACTIONS, false);</span>
<span class="nc" id="L269">	}</span>
	
	
	private List&lt;DefaultMultiColumnNodeData&gt; getListModelFromPostings(Collection&lt;ShiftSwapPosting&gt; postings){
<span class="nc" id="L273">		List&lt;DefaultMultiColumnNodeData&gt; listModel = new ArrayList&lt;DefaultMultiColumnNodeData&gt;();</span>
<span class="nc" id="L274">		ID myEmpID = m_user.getEmployeeID();</span>
		
<span class="nc bnc" id="L276" title="All 2 branches missed.">		for(ShiftSwapPosting posting: postings) {</span>
			// Create the row data
<span class="nc" id="L278">			String rowID = posting.getID().toString();</span>
<span class="nc" id="L279">			DefaultMultiColumnNodeData row_data = new DefaultMultiColumnNodeData(rowID);</span>

<span class="nc" id="L281">			SwapUtil.addAgentName(m_user, posting, m_eNameMap, m_eOrgMap, m_localizer, row_data);</span>
<span class="nc" id="L282">			SwapUtil.addShiftDates(posting, m_localizer, m_view_tz, m_common_bundle, row_data);</span>
<span class="nc" id="L283">			SwapUtil.addPostExpirationDate(posting, m_localizer, m_view_tz, row_data);</span>
<span class="nc bnc" id="L284" title="All 2 branches missed.">			if (m_isIncludePartial)</span>
<span class="nc" id="L285">				SwapUtil.addIsPartial(posting, m_localizer, row_data);</span>
<span class="nc" id="L286">			SwapUtil.addConfirmData(posting, m_localizer, row_data);</span>
<span class="nc" id="L287">			SwapUtil.addSwapTypeImage(posting.getSwapType(), m_bundle, m_localizer, row_data);</span>
<span class="nc" id="L288">			addComment(posting, row_data);</span>
<span class="nc" id="L289">			addItemActions(posting, myEmpID, rowID, row_data);</span>

			// Add row data to list model
<span class="nc" id="L292">			listModel.add(row_data);</span>
<span class="nc" id="L293">		}</span>
<span class="nc" id="L294">		return listModel;</span>
	}

	/**
	 * Initialize Selectable Items
	 */
	@Override
	protected void initSelectableItems() {
<span class="nc bnc" id="L302" title="All 4 branches missed.">		if (multiColListModel==null || multiColListModel.isEmpty()){</span>
<span class="nc" id="L303">			return;</span>
		}

		// Initialize Date Picker used to create Date input Value for View Schedule
		
<span class="nc" id="L308">		m_list.setListModel(multiColListModel);</span>
<span class="nc" id="L309">		m_list.setIsAutoSortEnabled(true);</span>
<span class="nc" id="L310">        m_list.setHasRowHeaders(false); //508</span>
<span class="nc" id="L311">	}</span>

	/**
	 * Add Posting Comment
	 */
	protected void addComment(ShiftSwapPosting posting, DefaultMultiColumnNodeData row_data) {
<span class="nc" id="L317">		m_messagePC.clear();</span>

<span class="nc" id="L319">		Message msg = new Message(Message.INFO_TYPE, posting.getComment());</span>
<span class="nc" id="L320">		m_messagePC.addMessage(msg);</span>
<span class="nc" id="L321">		String data = m_messagePC.getHtmlDisplay();</span>
<span class="nc" id="L322">		row_data.add( data );</span>
<span class="nc" id="L323">	}</span>

	/**
	 * Add List Item Actions
	 */
	protected void addItemActions(ShiftSwapPosting posting, ID myEmpID,
			String rowID, DefaultMultiColumnNodeData row_data) {
<span class="nc" id="L330">		StringBuffer sb = new StringBuffer(100);</span>
<span class="nc" id="L331">		sb.append(&quot;&lt;nobr&gt;&quot;);</span>
<span class="nc" id="L332">		appendItemAction(posting, PageAction.EDIT, rowID, sb);</span>
<span class="nc" id="L333">		appendItemAction(posting, PageAction.WITHDRAW, rowID, sb);</span>
<span class="nc" id="L334">		appendItemAction(posting, RmPageAction.PICKUP_POSTING, rowID, sb);		</span>
<span class="nc" id="L335">		appendViewScheduleAction(posting, sb);</span>
<span class="nc" id="L336">		sb.append(&quot;&lt;/nobr&gt;&quot;);</span>

<span class="nc" id="L338">		row_data.add(sb);</span>
<span class="nc" id="L339">	}</span>

	/**
	 * Return Image for specified Action
	 */
	@Override
	protected String getImageForAction(String action) {		
<span class="nc bnc" id="L346" title="All 2 branches missed.">		if (RmPageAction.PICKUP_POSTING.equals(action)) {</span>
<span class="nc" id="L347">			return RmImageFileID.SWAP_BOARD_PICKUP;</span>
		} else {
<span class="nc" id="L349">			return super.getImageForAction(action);</span>
		}	
	}

	/**
	 * Return Image Alt text for specified Action
	 */
	@Override
	protected String getImageAltForAction(String action) {
<span class="nc bnc" id="L358" title="All 2 branches missed.">		if (RmPageAction.PICKUP_POSTING.equals(action)) {</span>
<span class="nc" id="L359">			return i18n(m_bundle, RmWebBundleKey.PICKUP_POSTING);</span>
<span class="nc bnc" id="L360" title="All 2 branches missed.">		} else  if (PageAction.VIEW_SCHEDULE.equals(action)) {</span>
<span class="nc" id="L361">			return i18n(m_bundle, RmWebBundleKey.VIEW_PERSONAL_SCHEDULE);</span>
		} else {
<span class="nc" id="L363">			return super.getImageAltForAction(action);</span>
		}		
	}

	/**
	 * Create List Item Action Icon
	 */
	protected String createActionIcon(String action, String rowID) {
<span class="nc" id="L371">		String src = getImageForAction(action);</span>
<span class="nc" id="L372">		String alt = getImageAltForAction(action);</span>
<span class="nc" id="L373">		String onClickJS = &quot;pageMediator.handleListAction('&quot;+ action +&quot;','&quot;+ rowID+&quot;');&quot;;		</span>
<span class="nc" id="L374">		return createIconButton(src, alt, onClickJS);</span>
	}

	/**
	 * Determine whether the specified action for the Posting is enabled
	 */
	protected boolean isItemActionEnabled(ShiftSwapPosting posting, String action) {
<span class="nc" id="L381">		boolean isMyPosting = m_empID.equals(posting.getEmployeeID());</span>

<span class="nc" id="L383">		if (</span>
<span class="nc bnc" id="L384" title="All 4 branches missed.">				PageAction.VIEW_SCHEDULE.equals(action)</span>
				||
<span class="nc bnc" id="L386" title="All 6 branches missed.">				( isMyPosting &amp;&amp; (PageAction.EDIT.equals(action) || PageAction.WITHDRAW.equals(action)))</span>
				||
<span class="nc bnc" id="L388" title="All 2 branches missed.">				( !isMyPosting &amp;&amp;	RmPageAction.PICKUP_POSTING.equals(action) )</span>
<span class="nc" id="L389">		) return true;</span>

<span class="nc" id="L391">		return false;</span>
	}

	/**    
	 * Append Item Action if enabled
	 */
	protected void appendItemAction(ShiftSwapPosting posting, String action, String rowID, StringBuffer sb) {
<span class="nc bnc" id="L398" title="All 2 branches missed.">		String itemAction = isItemActionEnabled(posting, action)?</span>
<span class="nc" id="L399">				createActionIcon(action, rowID):</span>
<span class="nc" id="L400">				createIconButton(ImageFileID.BLANK_SPACER, null, null);</span>
<span class="nc" id="L401">		sb.append( itemAction );</span>
<span class="nc" id="L402">	}</span>

	/**
	 * Append View Schedule Action
	 */
	protected void appendViewScheduleAction(ShiftSwapPosting posting, StringBuffer sb) {
<span class="nc" id="L408">		String action = PageAction.VIEW_SCHEDULE;</span>
<span class="nc" id="L409">		String src = getImageForAction(action);</span>
<span class="nc" id="L410">		String alt = getImageAltForAction(action);</span>

<span class="nc" id="L412">		String dateVal = getShiftDateInputValue(posting);</span>
<span class="nc" id="L413">		String onClickJS = &quot;pageMediator.viewSchedule('&quot;+ dateVal + &quot;');&quot;;</span>
<span class="nc" id="L414">		String itemAction = createIconButton(src, alt, onClickJS);</span>
<span class="nc" id="L415">		sb.append(itemAction);</span>
<span class="nc" id="L416">	}</span>

	/**
	 * Return Shift Date Value which will be used for Date Picker
	 */
	protected String getShiftDateInputValue(ShiftSwapPosting posting) {
<span class="nc" id="L422">		Date shiftDate = posting.getShiftSwapItem().getStartDate();</span>
<span class="nc" id="L423">		m_datePicker.setDate(shiftDate);		</span>
<span class="nc" id="L424">		return m_datePicker.getDateDisplay();</span>
	}

	/**
	 * Initialize Content Title
	 */
	@Override
	public void initContentTitle()	{
		// Initialize Content Title
<span class="nc" id="L433">		String pageTitle = i18n(m_bundle, RmWebBundleKey.RM_MYSCHEDULE_SWAPBOARD);</span>
<span class="nc" id="L434">		m_contentTitlePC.setPageTitle(pageTitle);</span>

<span class="nc" id="L436">        String showOnlyFullPostings = i18n(m_bundle, RmWebBundleKey.SWAPBOARD_SHOW_ONLY_FULL_POSTINGS);</span>
<span class="nc bnc" id="L437" title="All 2 branches missed.">        String checkbox = HtmlChoiceInput.makeChkBoxInput(&quot;isIncludePartial&quot;, &quot;true&quot;, </span>
                showOnlyFullPostings, !m_isIncludePartial, JSUtil.REFRESH_PAGE);
<span class="nc" id="L439">		m_contentTitlePC.setItemName(checkbox);</span>
        
		// View Option
<span class="nc bnc" id="L442" title="All 2 branches missed.">		if (m_isAuthorized) {</span>
<span class="nc" id="L443">			String viewLabel = i18n(m_common_bundle, UIFWebBundleKey.VIEW);</span>
<span class="nc" id="L444">			m_contentTitlePC.setActiveComponent(viewLabel, makeViewDropDown() + &quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&quot;);  //ESR#4234460</span>
		}
<span class="nc" id="L446">	}</span>
	
	/**
	 * Specify whether Expired Requests are included
	 */
	public void setIsIncludePartial(boolean bValue) {
<span class="nc bnc" id="L452" title="All 2 branches missed.">		m_isIncludePartial = !bValue;</span>
<span class="nc" id="L453">	}</span>

	/**
	 * Initialize Toolbar
	 */
	@Override
	protected void initToolbar() {
<span class="nc bnc" id="L460" title="All 4 branches missed.">		boolean isBtnEnabled  = m_isPageEnabled &amp;&amp; m_isAuthorized;</span>
<span class="nc" id="L461">		String newPostingLabel = i18n(m_bundle, RmWebBundleKey.CREATE_NEW_POSTING);</span>
<span class="nc" id="L462">		m_toolbar.addPopupWindowTextButton(POPUP_FORM_ACTION,	newPostingLabel, isBtnEnabled);</span>
<span class="nc" id="L463">		enableToolbarPagination();</span>
<span class="nc" id="L464">	}</span>

	/**
	 * Create HTML for Drop down for View selection
	 */
	private String makeViewDropDown() {
<span class="nc" id="L470">		String onChangeJS = JSUtil.REFRESH_PAGE;</span>

<span class="nc" id="L472">		ArrayList options = new ArrayList();</span>
<span class="nc" id="L473">		options.add(createViewOption(MY_POSTINGS, RmWebBundleKey.SWAPBOARD_VIEW_MY_POSTINGS));</span>
<span class="nc" id="L474">		options.add(createViewOption(ALL_POSTINGS, RmWebBundleKey.SWAPBOARD_VIEW_ALL_POSTINGS));</span>
<span class="nc" id="L475">		options.add(createViewOption(POSTING_BY_CAMP, RmWebBundleKey.SWAPBOARD_VIEW_POSTING_BY_CAMP));</span>
<span class="nc" id="L476">		options.add(createViewOption(POSTING_BY_ORG, RmWebBundleKey.SWAPBOARD_VIEW_POSTING_BY_ORG));</span>

<span class="nc" id="L478">		return HtmlUtil.makeSelectInput(VIEW_MODE_FN, m_viewMode, onChangeJS, options, false);</span>
	}

	/**
	 * Return true if Authorized to this Page
	 */
	public boolean isAuthorized() {
<span class="nc bnc" id="L485" title="All 2 branches missed.">		return isValidEmployee() &amp;&amp;</span>
<span class="nc bnc" id="L486" title="All 2 branches missed.">				m_user.isAuthorized(PrivilegeKeys.SS_READWRITETOSWAPBOARD_ID);</span>
	}

	/**
	 * Set Selected Posting ID
	 */
	public void setPostingID(ID id) {
<span class="nc" id="L493">		m_postingID = id;</span>
<span class="nc" id="L494">	}</span>

	/**
	 * Return selected Posting ID
	 */
	public ID getPostingID() {
<span class="nc" id="L500">		return m_postingID;</span>
	}

	/**
	 * Set View Mode
	 */
	public void setViewMode(String mode) {
<span class="nc" id="L507">		m_viewMode = mode;</span>
<span class="nc" id="L508">		RequestUtil.cacheSwapBoardViewMode(m_context, mode);</span>
<span class="nc" id="L509">	}</span>

	/**
	 * Return View Mode
	 */
	public String getViewMode() {
<span class="nc" id="L515">		return m_viewMode;</span>
	}

	/**
	 * Return URL for HTML Form Action
	 */
	@Override
	public String getFormAction() {
<span class="nc" id="L523">		return FORM_ACTION;</span>
	}

	/**
	 * Create Hidden Input HTML
	 */
	@Override
	public String getRequiredHTML() {
<span class="nc" id="L531">		return super.getRequiredHTML() + HtmlUtil.makeHiddenInput(POSTING_ID_FN,&quot;&quot;);</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>