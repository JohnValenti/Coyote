<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>CustShiftReq.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.ejb.rm.requests.custshift.model</a> &gt; <span class="el_source">CustShiftReq.java</span></div><h1>CustShiftReq.java</h1><pre class="source lang-java linenums">/*
 * CustShiftReq.java
 *
 * Copyright:    Copyright (c) 2011
 * Company:      Verint Inc
 * @author       Sameet Joshi
 * All rights reserved.
 */
package com.bluepumpkin.ejb.rm.requests.custshift.model;

import java.util.Calendar;
import java.util.Collection;
import java.util.Collections;
import java.util.Date;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.Pair;
import com.bluepumpkin.common.datatypes.TimeRange;
import com.bluepumpkin.ejb.bbm.schedule.model.ShiftAssignment;
import com.bluepumpkin.ejb.bbm.vo.FieldInfo;
import com.bluepumpkin.ejb.rm.requests.common.model.Request;
import com.bluepumpkin.ejb.rm.requests.common.model.RequestAggregate;
import com.bluepumpkin.ejb.rm.requests.common.validation.ValidationCache;
import com.bluepumpkin.ejb.rm.requests.custshift.validation.CustShiftValidationCache;

/**
 * Class represents CustShiftReqs.
 * &lt;p/&gt;
 */
public class CustShiftReq extends RequestAggregate {
	private static final long serialVersionUID = 6909127108854014755L;
<span class="nc" id="L32">	private static final FieldInfo m_fieldInfo = new CustShiftReqFieldInfo();</span>
<span class="nc" id="L33">	private transient ValidationCache m_validationCache = null;</span>

<span class="nc" id="L35">	public static final ID REQUEST_SUB_TYPE_REG_NEW_SHIFT = new ID(1);</span>
<span class="nc" id="L36">	public static final ID REQUEST_SUB_TYPE_OT_NEW_SHIFT = new ID(2);</span>
<span class="nc" id="L37">	public static final ID REQUEST_SUB_TYPE_REG_SHIFT_CHANGE = new ID(4);</span>
<span class="nc" id="L38">	public static final ID REQUEST_SUB_TYPE_OT_SHIFT_CHANGE = new ID(8);</span>

	//These value constants are used by the custom shift request filter
	public static final String CS_SUBTYPE_NEW_SHIFT = &quot;CS_SUBTYPE_NEW_SHIFT&quot;;
	public static final String CS_SUBTYPE_SHIFT_CHANGE = &quot;CS_SUBTYPE_SHIFT_CHANGE&quot;;
	public static final String CS_OVERTIME_YES = &quot;1&quot;;
	public static final String CS_OVERTIME_NO = &quot;0&quot;;

	/**
	 * Creates a new instance of RequestAggregate
	 */
	public CustShiftReq(String pReqType, long detailLevel) {
<span class="nc" id="L50">		super(pReqType, detailLevel);</span>
<span class="nc" id="L51">	}</span>

	public CustShiftReq(long detailLevel) {
<span class="nc" id="L54">		super(Request.REQUESTTYPE_CUSTSHIFT, detailLevel);</span>
<span class="nc" id="L55">	}</span>

	public static long getDetailLevelForValidation() {
<span class="nc" id="L58">		return DL_BASIC;</span>
	}

	@Override
	public ValidationCache getValidationCache() {
<span class="nc bnc" id="L63" title="All 2 branches missed.">		if (m_validationCache == null) {</span>
<span class="nc" id="L64">			m_validationCache = new CustShiftValidationCache(this);</span>
		}
<span class="nc" id="L66">		return m_validationCache;</span>
	}

	public CustShiftValidationCache getCache() {
<span class="nc" id="L70">		return (CustShiftValidationCache) getValidationCache();</span>
	}

	@Override
	public Collection&lt;Pair&lt;ID, TimeRange&gt;&gt; getEmpIDTimeRangePairs() {
<span class="nc" id="L75">		return Collections.singletonList(new Pair&lt;ID, TimeRange&gt;(getEmployeeID(), new TimeRange(getStartTime(), getEndTime())));</span>
	}

	@Override
	public FieldInfo getFieldInfo() {
<span class="nc" id="L80">		return m_fieldInfo;</span>
	}

	@Override
	public Collection getValidationTimeRanges() {
<span class="nc" id="L85">		return null;</span>
	}

	@Override
	public ID getID() {
<span class="nc" id="L90">		return getFieldValueID(CustShiftReqFieldInfo.CUSTSHIFTREQ_I_ID);</span>
	}

	public ID getSPID() {
<span class="nc" id="L94">		return getFieldValueID(CustShiftReqFieldInfo.CUSTSHIFTREQ_I_SPID);</span>
	}

	public ID getShiftID() {
<span class="nc" id="L98">		return getFieldValueID(CustShiftReqFieldInfo.CUSTSHIFTREQ_I_SHIFTID);</span>
	}

	public ID getActivityID() {
<span class="nc" id="L102">		return getFieldValueID(CustShiftReqFieldInfo.CUSTSHIFTREQ_I_ACTIVITYID);</span>
	}

	public Date getStartTime() {
<span class="nc" id="L106">		return getFieldValueDate(CustShiftReqFieldInfo.CUSTSHIFTREQ_D_STARTTIME);</span>
	}

	public Date getEndTime() {
<span class="nc" id="L110">		return getFieldValueDate(CustShiftReqFieldInfo.CUSTSHIFTREQ_D_ENDTIME);</span>
	}

	public boolean isOT() {
<span class="nc" id="L114">		return getFieldValueBoolean(CustShiftReqFieldInfo.CUSTSHIFTREQ_B_ISOT);</span>
	}

	public ID getExtBeforeID() {
<span class="nc" id="L118">		return getFieldValueID(CustShiftReqFieldInfo.CUSTSHIFTREQ_I_EXTBEFOREID);</span>
	}

	public ID getExtBeforeActivityID() {
<span class="nc" id="L122">		return getFieldValueID(CustShiftReqFieldInfo.CUSTSHIFTREQ_I_EXTBEFOREACTIVITYID);</span>
	}

	public boolean getExtBeforeIsOT() {
<span class="nc" id="L126">		return getFieldValueBoolean(CustShiftReqFieldInfo.CUSTSHIFTREQ_B_EXTBEFOREISOT);</span>
	}

	public int getExtBeforeGap() {
<span class="nc" id="L130">		return getFieldValueInt(CustShiftReqFieldInfo.CUSTSHIFTREQ_N_EXTBEFOREGAP);</span>
	}

	public ID getExtAfterID() {
<span class="nc" id="L134">		return getFieldValueID(CustShiftReqFieldInfo.CUSTSHIFTREQ_I_EXTAFTERID);</span>
	}

	public ID getExtAfterActivityID() {
<span class="nc" id="L138">		return getFieldValueID(CustShiftReqFieldInfo.CUSTSHIFTREQ_I_EXTAFTERACTIVITYID);</span>
	}

	public boolean getExtAfterIsOT() {
<span class="nc" id="L142">		return getFieldValueBoolean(CustShiftReqFieldInfo.CUSTSHIFTREQ_B_EXTAFTERISOT);</span>
	}

	public int getExtAfterGap() {
<span class="nc" id="L146">		return getFieldValueInt(CustShiftReqFieldInfo.CUSTSHIFTREQ_N_EXTAFTERGAP);</span>
	}

	public String getHashCodeForUndrlyngShift() {
<span class="nc" id="L150">		return (String) getFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_S_HASHCODE);</span>
	}

	public int getSubType() {
<span class="nc" id="L154">		return getFieldValueInt(CustShiftReqFieldInfo.CUSTSHIFTREQ_N_SUBTYPE);</span>
	}

	@Override
	public ID getRequestSubType() {
<span class="nc" id="L159">		return new ID(getSubType());</span>
	}

	public Date getShiftStartTime() {
<span class="nc" id="L163">		return getFieldValueDate(CustShiftReqFieldInfo.CUSTSHIFTREQ_D_SHIFTSTARTTIME);</span>
	}

	public Date getShiftEndTime() {
<span class="nc" id="L167">		return getFieldValueDate(CustShiftReqFieldInfo.CUSTSHIFTREQ_D_SHIFTENDTIME);</span>
	}

	@Override
	public void setID(ID val) {
<span class="nc" id="L172">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_I_ID, val);</span>
<span class="nc" id="L173">	}</span>

	public void setSPID(ID val) {
<span class="nc" id="L176">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_I_SPID, val);</span>
<span class="nc" id="L177">	}</span>

	public void setShiftID(ID val) {
<span class="nc" id="L180">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_I_SHIFTID, val);</span>
<span class="nc" id="L181">	}</span>

	public void setActivityID(ID val) {
<span class="nc" id="L184">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_I_ACTIVITYID, val);</span>
<span class="nc" id="L185">	}</span>

	public void setStartTime(Date val) {
<span class="nc" id="L188">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_D_STARTTIME, val);</span>
<span class="nc" id="L189">	}</span>

	public void setEndTime(Date val) {
<span class="nc" id="L192">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_D_ENDTIME, val);</span>
<span class="nc" id="L193">	}</span>


	public void setIsOT(boolean val) {
<span class="nc" id="L197">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_B_ISOT, val);</span>
<span class="nc" id="L198">	}</span>

	public void setExtBeforeID(ID val) {
<span class="nc" id="L201">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_I_EXTBEFOREID, val);</span>
<span class="nc" id="L202">	}</span>

	public void setExtBeforeActivityID(ID val) {
<span class="nc" id="L205">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_I_EXTBEFOREACTIVITYID, val);</span>
<span class="nc" id="L206">	}</span>

	public void setExtBeforeIsOT(boolean val) {
<span class="nc" id="L209">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_B_EXTBEFOREISOT, val);</span>
<span class="nc" id="L210">	}</span>

	public void setExtBeforeGap(int val) {
<span class="nc" id="L213">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_N_EXTBEFOREGAP, val);</span>
<span class="nc" id="L214">	}</span>


	public void setExtAfterID(ID val) {
<span class="nc" id="L218">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_I_EXTAFTERID, val);</span>
<span class="nc" id="L219">	}</span>

	public void setExtAfterActivityID(ID val) {
<span class="nc" id="L222">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_I_EXTAFTERACTIVITYID, val);</span>
<span class="nc" id="L223">	}</span>

	public void setExtAfterIsOT(boolean val) {
<span class="nc" id="L226">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_B_EXTAFTERISOT, val);</span>
<span class="nc" id="L227">	}</span>

	public void setExtAfterGap(int val) {
<span class="nc" id="L230">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_N_EXTAFTERGAP, val);</span>
<span class="nc" id="L231">	}</span>

	public void setHashCodeForUndrlyngShift(String val) {
<span class="nc" id="L234">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_S_HASHCODE, val);</span>
<span class="nc" id="L235">	}</span>

	public void setSubType(int val) {
<span class="nc" id="L238">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_N_SUBTYPE, val);</span>
<span class="nc" id="L239">	}</span>

	public void setShiftStartTime(Date val) {
<span class="nc" id="L242">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_D_SHIFTSTARTTIME, val);</span>
<span class="nc" id="L243">	}</span>

	public void setShiftEndTime(Date val) {
<span class="nc" id="L246">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_D_SHIFTENDTIME, val);</span>
<span class="nc" id="L247">	}</span>



	/**
	 * Get the duration of the request, which is only the delta of what is changing from the current ShiftAssignment.
	 * If there is no current ShiftAssignment (i.e., this is a New Shift request), then the duration is simply
	 * the entire shift, plus any extensions.
	 */
	public int getDurationinMinutes() {
<span class="nc" id="L257">		int dur = 0;</span>
<span class="nc bnc" id="L258" title="All 6 branches missed.">		if (getShiftID() == null &amp;&amp; getExtAfterID() != null &amp;&amp; getExtBeforeID() != null) {</span>
<span class="nc" id="L259">			dur = getExtAfterDuration() + getExtAfterGap() + getExtBeforeDuration() + getExtBeforeGap();</span>
		} else {
<span class="nc" id="L261">			dur = (int) ((getEndTime().getTime() - getStartTime().getTime()) / ShiftAssignment.MILLIS_IN_ONE_MIN);</span>
		}
<span class="nc" id="L263">		return dur;</span>
	}

	/**
	 * Get the duration of the main shift, which does not include the extension before or after.
	 */
	public int getShiftDurationinMinutes() {
<span class="nc bnc" id="L270" title="All 4 branches missed.">		if (getShiftEndTime() == null || getShiftStartTime() == null) {</span>
<span class="nc" id="L271">			return 0;</span>
		}
<span class="nc" id="L273">		return (int) ((getShiftEndTime().getTime() - getShiftStartTime().getTime()) / ShiftAssignment.MILLIS_IN_ONE_MIN);</span>
	}

	/**
	 * while requesting Extension into Gap, the request start and end date are stored as gap start and end date
	 * instead of the request start = gap start and request end = startofGap+gapofGap+DurationofReqInGap
	 * So while displaying the list and view detail and notification, call this method for actual req dates
	 * if there is a combination of extension before and gap:  startdate = beforeStartDate, endDate = gapEndDate
	 * Combination of ext after and gap: startDate = gapStartDate, endDate = afterEndDate
	 * if only ext into gap, then startDate = gapStartDate, endDate = startofGap+gapofGap+DurationofReqInGap
	 * for other cases, it would work as it was in legacy
	 */
	public TimeRange getCSRequestDisplayRange() {
<span class="nc" id="L286">		Date startTime = getStartTime();</span>
<span class="nc" id="L287">		Date endTime = getEndTime();</span>
<span class="nc" id="L288">		TimeRange displayRange = new TimeRange(startTime, endTime);</span>
		// fetch the data in gap data
		@SuppressWarnings(&quot;unchecked&quot;)
<span class="nc" id="L291">		Collection&lt;CustShiftReqGap&gt; gapsInReq = getChildObjects(CustShiftReqFieldInfo.CUSTREQGAP_CHILD_TYPE);</span>
<span class="nc bnc" id="L292" title="All 2 branches missed.">		if (! gapsInReq.isEmpty()) {</span>
<span class="nc" id="L293">			CustShiftReqGap reqGap = gapsInReq.iterator().next();</span>
<span class="nc" id="L294">			Date gapStartTime = reqGap.getExtGapStartTime();</span>
<span class="nc" id="L295">			Calendar gapCal = Calendar.getInstance();</span>
<span class="nc" id="L296">			gapCal.setTime(gapStartTime);</span>
<span class="nc" id="L297">			gapCal.add(Calendar.MINUTE, reqGap.getExtGapGap() + reqGap.getExtGapDuration());</span>
<span class="nc" id="L298">			Date gapEndTime = gapCal.getTime();</span>
<span class="nc bnc" id="L299" title="All 4 branches missed.">			if (getExtBeforeDuration() == 0 &amp;&amp; getExtAfterDuration() == 0) { // only into gap</span>
<span class="nc" id="L300">				displayRange = new TimeRange(gapStartTime, gapEndTime);</span>
<span class="nc bnc" id="L301" title="All 4 branches missed.">			} else if (getExtBeforeDuration() != 0 &amp;&amp; getExtAfterDuration() == 0) { // before and into gap means end date should change</span>
<span class="nc" id="L302">				displayRange = new TimeRange(startTime, gapEndTime);</span>
<span class="nc bnc" id="L303" title="All 4 branches missed.">			} else if (getExtBeforeDuration() == 0 &amp;&amp; getExtAfterDuration() != 0) { // after and into gap means start date should change</span>
<span class="nc" id="L304">				displayRange = new TimeRange(gapStartTime, endTime);</span>
			}
		}
<span class="nc" id="L307">		return displayRange;</span>
	}

	/*
	public int getDuration() {
		return getFieldValueInt(CustShiftReqFieldInfo.CUSTSHIFTREQ_I_DURATION);
	}
	*/

	public int getExtBeforeDuration() {
<span class="nc" id="L317">		return getFieldValueInt(CustShiftReqFieldInfo.CUSTSHIFTREQ_N_EXTBEFOREDURATION);</span>
	}

	public int getExtAfterDuration() {
<span class="nc" id="L321">		return getFieldValueInt(CustShiftReqFieldInfo.CUSTSHIFTREQ_N_EXTAFTERDURATION);</span>
	}

	/*
	public void setDuration(int val) {
		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_I_DURATION, val);
	}
	*/

	public void setExtBeforeDuration(int val) {
<span class="nc" id="L331">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_N_EXTBEFOREDURATION, val);</span>
<span class="nc" id="L332">	}</span>

	public void setExtAfterDuration(int val) {
<span class="nc" id="L335">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_N_EXTAFTERDURATION, val);</span>
<span class="nc" id="L336">	}</span>

	public void setShiftAssignmentID(ID val) {
<span class="nc" id="L339">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_I_SHIFTASSIGNMENTID, val);</span>
<span class="nc" id="L340">	}</span>

	public ID getShiftAssignmentID() {
<span class="nc" id="L343">		return getFieldValueID(CustShiftReqFieldInfo.CUSTSHIFTREQ_I_SHIFTASSIGNMENTID);</span>
	}

	public void setShiftAssignmentChangeCounter(int val) {
<span class="nc" id="L347">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_I_CHGCOUNTER, val);</span>
<span class="nc" id="L348">	}</span>

	public int getShiftAssignmentChangeCounter() {
<span class="nc" id="L351">		return getFieldValueInt(CustShiftReqFieldInfo.CUSTSHIFTREQ_I_CHGCOUNTER);</span>
	}

	/**
	 * Is this shift change request for the ship in the past
	 *
	 * @return
	 */
	public boolean isInPastDate() {
<span class="nc" id="L360">		return this.getShiftStartTime().before(this.getSubmittedOn());</span>
	}

	public Collection&lt;CustShiftReqGap&gt; getCustShiftReqGaps() {
<span class="nc" id="L364">		return getChildObjects(CustShiftReqFieldInfo.CUSTREQGAP_CHILD_TYPE);</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>