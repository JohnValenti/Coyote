<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>OrganizationConfigManagerEJB.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.ejb.rm.setup.settings.ejb</a> &gt; <span class="el_source">OrganizationConfigManagerEJB.java</span></div><h1>OrganizationConfigManagerEJB.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.ejb.rm.setup.settings.ejb;

import java.util.Arrays;
import java.util.Collection;
import java.util.HashMap;
import java.util.HashSet;
import java.util.Iterator;
import java.util.Map;
import java.util.Set;

import com.bluepumpkin.common.cache.Cache;
import com.bluepumpkin.common.cache.CacheFactory;
import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.logging.Category;
import com.bluepumpkin.ejb.bbm.BbmManagerFactory;
import com.bluepumpkin.ejb.bbm.activity.model.Activity;
import com.bluepumpkin.ejb.bbm.base.BbmCreateException;
import com.bluepumpkin.ejb.bbm.base.BbmFinderException;
import com.bluepumpkin.ejb.bbm.base.BbmRemoveException;
import com.bluepumpkin.ejb.bbm.base.BbmUpdateException;
import com.bluepumpkin.ejb.bbm.config.ConfigCacheUtil;
import com.bluepumpkin.ejb.bbm.config.ConfigKey;
import com.bluepumpkin.ejb.bbm.workresource.model.Organization;
import com.bluepumpkin.ejb.core.base.SessionEJBBase; //OUTSIDE_CONTAINER
import com.bluepumpkin.ejb.rm.Log;
import com.bluepumpkin.ejb.rm.RmManagerFactory;
import com.bluepumpkin.ejb.rm.l10n.RmSettingKey;
import com.bluepumpkin.ejb.rm.requests.common.ejb.RequestUtil;
import com.bluepumpkin.ejb.rm.requests.timeoff.hoursperday.ejb.TimeOffHoursManagerBridgeImpl;
import com.bluepumpkin.ejb.rm.setup.settings.model.OrganizationSetting;
import com.bluepumpkin.ejb.rm.requests.timeoff.requiredpayperiodhours.RequiredPayPeriodHoursUtil;
import com.bluepumpkin.ejb.rm.util.RmUtil;

/**
 * Title:        OrganizationConfigManagerEJB
 * Description:  EJB for OrganizationConfig
 * Copyright:    Copyright (c) 2002
 * Company:      Blue Pumpkin Software, Inc.
 *
 * @author Sameet Joshi rewritten in Nov 2010 ; Shailendra Sharma
 * @version 1.0
 */
<span class="fc" id="L43">public class OrganizationConfigManagerEJB extends SessionEJBBase { //OUTSIDE_CONTAINER</span>

<span class="fc" id="L45">	private static Category m_cat = Log.initCategory(OrganizationConfigManagerEJB.class.getName());</span>
<span class="fc" id="L46">	private Cache m_OrgSettingCache = null;</span>
<span class="fc" id="L47">	private boolean lastCheckStatus = true;</span>

	/**
	 * Override the base class to provide the appropriate logging category
	 */
	@Override
	protected Category getCategory() {
<span class="fc" id="L54">		return m_cat;</span>
	}

	private void initCache() throws BbmFinderException {
<span class="fc" id="L58">		Boolean init = (Boolean) m_OrgSettingCache.get(&quot;INITIALIZED&quot;);</span>
<span class="pc bpc" id="L59" title="1 of 4 branches missed.">		if (init != null &amp;&amp; init.booleanValue()) {</span>
<span class="fc" id="L60">			return;</span>
		}
		// initialize the cache, load all Org Settings
		try {
<span class="fc" id="L64">			refreshCache(Organization.ROOT_ORG_ID_OBJ);</span>
<span class="fc" id="L65">			m_OrgSettingCache.put(&quot;INITIALIZED&quot;, Boolean.TRUE);</span>
<span class="nc" id="L66">		} catch (Exception e) {</span>
<span class="nc" id="L67">			m_cat.error(e);</span>
<span class="nc" id="L68">			m_OrgSettingCache.remove(&quot;INITIALIZED&quot;);</span>
<span class="nc" id="L69">			throw new BbmFinderException();</span>
<span class="fc" id="L70">		}</span>
<span class="fc" id="L71">	}</span>

	private void refreshCache(ID orgIDToRefresh) throws BbmFinderException {

<span class="fc" id="L75">		Set orgIDSet = new HashSet();</span>
<span class="fc" id="L76">		orgIDSet.add(orgIDToRefresh);</span>
<span class="fc" id="L77">		long startTime = System.currentTimeMillis();</span>
<span class="fc" id="L78">		ID orgID = null;</span>
		try {
			//orgIDSet.addAll(BbmManagerFactory.getWorkResourceManager().getOrganizationsChildrenByIDs(Collections.singleton(orgIDToRefresh)));
<span class="fc bfc" id="L81" title="All 2 branches covered.">			for (Iterator iterator = orgIDSet.iterator(); iterator.hasNext();) {</span>
<span class="fc" id="L82">				orgID = (ID) iterator.next();</span>
<span class="fc" id="L83">				HashMap ancestorMap = new HashMap();</span>
<span class="fc" id="L84">				HashMap&lt;String, ID&gt; ancestorIDsMap = new HashMap&lt;String, ID&gt;();</span>
<span class="fc" id="L85">				Map propertyMap = getPropertyList(orgID, getSettingProperties(), ancestorMap, ancestorIDsMap, false);</span>
<span class="fc" id="L86">				OrganizationSetting orgSetting = new OrganizationSetting(propertyMap, orgID.toString());</span>
<span class="fc" id="L87">				orgSetting.setAncestors(ancestorMap);</span>
<span class="fc" id="L88">				orgSetting.setAncestorIDs(ancestorIDsMap);</span>
<span class="fc" id="L89">				m_OrgSettingCache.put(orgID, orgSetting);</span>
<span class="fc" id="L90">			}</span>
<span class="nc" id="L91">		} catch (Exception e) {</span>
<span class="nc" id="L92">			m_cat.info(&quot;Caught Exception  orgID= &quot; + orgID);</span>
<span class="nc" id="L93">			handleException(e);</span>
<span class="nc" id="L94">			throw RequestUtil.createBbmFinderExceptionWrapper(e, m_cat);</span>
		} finally {
<span class="pc" id="L96">			m_cat.info(&quot;OrganizationSetting refreshCache  TIME=&quot; + (System.currentTimeMillis() - startTime) + &quot; msecs :orgIDSet=&quot; + RmUtil.dumpCommaSeparated(orgIDSet));</span>
<span class="fc" id="L97">		}</span>
<span class="fc" id="L98">	}</span>

	@SuppressWarnings(&quot;unchecked&quot;)
	private void clearCache(Collection&lt;ID&gt; orgIDsToRefresh) throws BbmFinderException {
<span class="fc" id="L102">		Set&lt;ID&gt; orgIDSet = new HashSet&lt;ID&gt;();</span>
<span class="fc" id="L103">		orgIDSet.addAll(orgIDsToRefresh);</span>
<span class="fc" id="L104">		long startTime = System.currentTimeMillis();</span>
<span class="fc" id="L105">		ID orgID = null;</span>
		try {
<span class="fc" id="L107">			orgIDSet.addAll(BbmManagerFactory.getWorkResourceManager().getOrganizationsChildrenByIDs(orgIDsToRefresh));</span>
<span class="fc bfc" id="L108" title="All 2 branches covered.">			for (Iterator&lt;ID&gt; iterator = orgIDSet.iterator(); iterator.hasNext();) {</span>
<span class="fc" id="L109">				orgID = iterator.next();</span>
<span class="fc" id="L110">				m_OrgSettingCache.remove(orgID);</span>
			}
<span class="nc" id="L112">		} catch (Exception e) {</span>
<span class="nc" id="L113">			m_cat.info(&quot;Caught Exception  orgID= &quot; + orgID);</span>
<span class="nc" id="L114">			handleException(e);</span>
<span class="nc" id="L115">			throw RequestUtil.createBbmFinderExceptionWrapper(e, m_cat);</span>
		} finally {
<span class="pc" id="L117">			m_cat.info(&quot;OrganizationSetting clearCache  TIME=&quot; + (System.currentTimeMillis() - startTime) + &quot; msecs :orgIDSet=&quot; + RmUtil.dumpCommaSeparated(orgIDSet));</span>
<span class="fc" id="L118">		}</span>
<span class="fc" id="L119">	}</span>

	private boolean cacheUsed() {
		// If Cache is null, then cache is not used
<span class="fc" id="L123">		boolean currentStatus = false;</span>
		try {
			// If cache is never instantiated, give it a chance to get initialized
			// If ConfigManager is cache aware, then always check it dynamically
<span class="pc bpc" id="L127" title="1 of 4 branches missed.">			if (m_OrgSettingCache == null || BbmManagerFactory.getDBConfigManager().cacheUsed()) {</span>
				// Access ConfigManager for the cache setting
<span class="pc bpc" id="L129" title="1 of 2 branches missed.">				if (ConfigCacheUtil.isCacheEnabled(BbmManagerFactory.getDBConfigManager(), ConfigKey.ORGANIZATIONSETTING_CACHE_USAGE)) {</span>
					// If Cache is null, initialize it
<span class="fc bfc" id="L131" title="All 2 branches covered.">					if (m_OrgSettingCache == null) {</span>
<span class="fc" id="L132">						m_OrgSettingCache = CacheFactory.getCache(RmManagerFactory.RM_ORGANIZATIONCONFIGMANAGER_EJBHOME, OrganizationConfigManagerEJB.class.getClassLoader());</span>
					}
<span class="fc" id="L134">					currentStatus = true;</span>
				} else {
<span class="nc" id="L136">					currentStatus = false;</span>
				}
			} else {
				// Or if m_TimeRecordCache is available, we think cache is enabled
<span class="nc bnc" id="L140" title="All 2 branches missed.">				currentStatus = (m_OrgSettingCache != null);</span>
			}
<span class="nc" id="L142">		} catch (Exception e) {</span>
<span class="nc" id="L143">			currentStatus = false;</span>
<span class="fc" id="L144">		}</span>
		// If there is state transition, we need flush cache content
<span class="pc bpc" id="L146" title="1 of 2 branches missed.">		if (lastCheckStatus != currentStatus) {</span>
			// If from Cache turn on to off, or vice versa, we will flush cache content
<span class="nc bnc" id="L148" title="All 2 branches missed.">			if (m_OrgSettingCache != null) {</span>
<span class="nc" id="L149">				m_OrgSettingCache.clear();</span>
				try {
					// if cache enabled, preload content
<span class="nc bnc" id="L152" title="All 2 branches missed.">					if (currentStatus) {</span>
<span class="nc" id="L153">						initCache();</span>
					}
<span class="nc" id="L155">				} catch (Exception e) {</span>
<span class="nc" id="L156">					m_cat.error(e.getMessage());</span>
<span class="nc" id="L157">				}</span>
			}
<span class="nc" id="L159">			lastCheckStatus = currentStatus;</span>
		}
<span class="fc" id="L161">		return currentStatus;</span>
	}

	{
<span class="fc" id="L165">		super.init(OrganizationConfigManagerEJB.class.getName());</span>
<span class="fc" id="L166">	}</span>

	/**
	 * Returns a Value Object that contains settings of the
	 * OrganizationId passed as argument. We get &quot;deep&quot; settings,
	 * meaning that the inheritted settings are also returned.
	 *
	 * @param orgId - Organisation ID object.
	 * @return OrganizationSetting Returns a value object that contains
	 *         settings of the requested organization.
	 * @throws BbmFinderException if there is a database error
	 */
	public OrganizationSetting getConfiguration(ID orgId) throws BbmFinderException {
<span class="fc" id="L179">		final String l_MethodName = &quot;getConfiguration&quot;;</span>
<span class="fc" id="L180">		methodStart(l_MethodName, orgId);</span>
		try {
<span class="pc bpc" id="L182" title="1 of 2 branches missed.">			if (cacheUsed()) {</span>
<span class="fc" id="L183">				initCache();</span>
<span class="fc" id="L184">				OrganizationSetting orgSetting = (OrganizationSetting) m_OrgSettingCache.get(orgId);</span>
<span class="fc bfc" id="L185" title="All 2 branches covered.">				if (orgSetting == null) {</span>
<span class="fc" id="L186">					refreshCache(orgId);</span>
<span class="fc" id="L187">					orgSetting = (OrganizationSetting) m_OrgSettingCache.get(orgId);</span>
				}
<span class="pc bpc" id="L189" title="1 of 2 branches missed.">				if (orgSetting != null) {</span>
<span class="fc" id="L190">					return orgSetting;</span>
				}
<span class="nc" id="L192">				m_cat.info(&quot;Failed to find OrganizationSetting for ID=&quot; + orgId + &quot; in the cache.&quot;);</span>
			}

<span class="nc" id="L195">			HashMap ancestorMap = new HashMap();</span>
<span class="nc" id="L196">			HashMap&lt;String, ID&gt; ancestorIDsMap = new HashMap&lt;String, ID&gt;();</span>
<span class="nc" id="L197">			Map propertyMap = getPropertyList(orgId, getSettingProperties(), ancestorMap, ancestorIDsMap, false);</span>
<span class="nc" id="L198">			OrganizationSetting orgSetting = new OrganizationSetting(propertyMap, orgId.toString());</span>
<span class="nc" id="L199">			orgSetting.setAncestors(ancestorMap);</span>
<span class="nc" id="L200">			orgSetting.setAncestorIDs(ancestorIDsMap);</span>
<span class="nc" id="L201">			return orgSetting;</span>

<span class="nc" id="L203">		} catch (Exception e) {</span>
<span class="nc" id="L204">			handleException(e);</span>
<span class="nc" id="L205">			throw RequestUtil.createBbmFinderExceptionWrapper(e, m_cat);</span>
		} finally {
<span class="pc" id="L207">			methodFinish();</span>
		}
	}

	/**
	 * Sets the configuration properties for an Organization.
	 *
	 * @param orgId      -  ID for Organization.
	 * @param orgSetting - value object
	 * @param shallow    - true if you want to update only this org, false to update children too.
	 * @throws BbmCreateException if there is a database error
	 * @throws BbmUpdateException if there is a database error
	 */
	public void setConfiguration(ID orgId, OrganizationSetting orgSetting, boolean shallow)
			throws BbmCreateException, BbmUpdateException {
<span class="fc" id="L222">		final String l_MethodName = &quot;setConfiguration&quot;;</span>

<span class="fc" id="L224">		methodStart(l_MethodName, orgId, orgSetting);</span>
		try {
<span class="fc" id="L226">			setPropertyList(orgId, orgSetting.getValues(), shallow); //default was false before. For V11, we give the user the option</span>
		} finally {
<span class="pc" id="L228">			methodFinish();</span>
<span class="fc" id="L229">		}</span>
<span class="fc" id="L230">	}</span>

	/**
	 * Returns the HashMap of OrganizationConfig object for the OrganizationId
	 * and HashMap of ID for the property passed as argument.
	 *
	 * @param orgId        - Organisation ID object.
	 * @param pPropertyMap - A Map that contains PROPERTY-KEYs mapped to PROPERTY-VALUEs
	 * @param pAncestorMap - A Map that contains PROPERTY-KEYs mapped to ancestor org names
	 * @param pAncestorIDsMap - A Map that contains PROPERTY-KEYs mapped to ancestor org IDs
	 * @param shallow      - true if you want to get custom settings only for this org,
	 *                     false to get inheritted settings as well.
	 * @return We return the pPropertyMap with the mapped values. We also modify pPropertyMap
	 *         and pAncestorMap, so you can get the return values from there.
	 * @throws BbmFinderException if there is an error while executing database
	 *                            query
	 */
	private Map getPropertyList(ID orgId, Map pPropertyMap, Map pAncestorMap, Map&lt;String, ID&gt; pAncestorIDsMap, boolean shallow) throws BbmFinderException {

<span class="fc" id="L249">		final String l_MethodName = &quot;getPropertyList&quot;;</span>
<span class="fc" id="L250">		methodStart(l_MethodName, orgId, pPropertyMap);</span>

<span class="fc" id="L252">		OrganizationConfigDAO orgCfgDAO = null;</span>
		try {
<span class="fc" id="L254">			orgCfgDAO = new OrganizationConfigDAO();</span>
<span class="fc" id="L255">			orgCfgDAO.getPropertyList(orgId, pPropertyMap, pAncestorMap, pAncestorIDsMap, shallow);</span>

<span class="nc" id="L257">		} catch (Exception e) {</span>
<span class="nc" id="L258">			handleException(e);</span>
<span class="nc" id="L259">			throw RequestUtil.createBbmFinderExceptionWrapper(e, m_cat);</span>
		} finally {
<span class="pc bpc" id="L261" title="3 of 4 branches missed.">			if (orgCfgDAO != null) {</span>
<span class="pc" id="L262">				orgCfgDAO.cleanUp();</span>
			}
<span class="pc" id="L264">			methodFinish();</span>
<span class="fc" id="L265">		}</span>
<span class="fc" id="L266">		return pPropertyMap;</span>
	}

	/**
	 * Set the property list for an Organization. The method will split
	 * the propertyMap into a set of properties to update and a set to
	 * insert. The value of the properties are copied to all children if
	 * shallow==false. This will overwrite the values of the children.
	 *
	 * @param pOrgId                 -  ID for OrganizationConfig object.
	 * @param pOrgConfigPropertyList - HashMap contains PROPERTY-KEY and PROPERTY-VALUE
	 * @param shallow                - true if you want to update only this org, false to update children too.
	 * @throws BbmCreateException if there is an error while executing database query
	 * @throws BbmUpdateException if there is an error while executing database query
	 * @throws BbmRemoveException if there is an error while executing database query
	 */
	private void setPropertyList(ID pOrgId, Map pOrgConfigPropertyList, boolean shallow) throws BbmUpdateException {

<span class="fc" id="L284">		final String l_MethodName = &quot;setPropertyList&quot;;</span>
<span class="fc" id="L285">		methodStart(l_MethodName, pOrgId, pOrgConfigPropertyList);</span>
<span class="fc" id="L286">		OrganizationConfigDAO dao = new OrganizationConfigDAO();</span>
		try {
<span class="fc" id="L288">			dao.setPropertyList(pOrgId, pOrgConfigPropertyList, shallow);</span>
<span class="pc bpc" id="L289" title="1 of 2 branches missed.">			if (!shallow) {</span>
<span class="fc" id="L290">				dao.deleteAllPropertiesFromChildren(pOrgId);</span>
			}
			//always refresh OrgSetting for passed org and all its children. irrespective of the shallow flag
<span class="pc bpc" id="L293" title="1 of 2 branches missed.">			if (cacheUsed()) {</span>
<span class="fc" id="L294">				clearCache(Arrays.asList(pOrgId));</span>
			}
<span class="nc" id="L296">		} catch (Exception e) {</span>
<span class="nc" id="L297">			handleException(e);</span>
<span class="nc" id="L298">			throw RequestUtil.createBbmUpdateExceptionWrapper(e, m_cat);</span>
		} finally {
<span class="pc" id="L300">			methodFinish();</span>
<span class="pc" id="L301">			dao.cleanUp();</span>
<span class="fc" id="L302">		}</span>
<span class="fc" id="L303">	}</span>


	/**
	 * Get Map of all possible settings
	 */
	private static Map&lt;String, Object&gt; getSettingProperties() {
<span class="fc" id="L310">		Map&lt;String, Object&gt; lHashMap = new HashMap&lt;String, Object&gt;();</span>
		
		
<span class="fc" id="L313">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_REQUIRED_PAY_PERIOD_TRACK, &quot;false&quot;);</span>
<span class="fc" id="L314">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_REQUIRED_PAY_PERIOD_PERIOD, RequiredPayPeriodHoursUtil.PERIOD_WEEKLY);</span>
<span class="fc" id="L315">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_REQUIRED_PAY_PERIOD_STARTDATE, &quot;0&quot;);</span>

<span class="fc" id="L317">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_PROCESS_VACATION_REQUEST, &quot;true&quot;);</span>
<span class="fc" id="L318">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_REQUEST_VACATION, &quot;true&quot;);</span>
<span class="fc" id="L319">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_TIME_OFF_CHOICES_COUNT, &quot;1&quot;);</span>
<span class="fc" id="L320">		lHashMap.put(RmSettingKey.ORG_RM_TIME_OFF_TIME_INTERVAL, &quot;15&quot;);</span>
<span class="fc" id="L321">		lHashMap.put(RmSettingKey.ORG_RM_ALLOW_COPY_TIME_OFF_BID_REQUEST, &quot;false&quot;);</span>


<span class="fc" id="L324">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_ALLOW_ESCALATION, &quot;true&quot;);</span>
<span class="fc" id="L325">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_SHOW_AUTOPROCESSING_RULES, &quot;true&quot;);</span>
<span class="fc" id="L326">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_SHOW_SCHEDULED_TIMEOFF, &quot;true&quot;);</span>
<span class="fc" id="L327">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_SHOW_PENDING_TIMEOFF, &quot;true&quot;);</span>

<span class="fc" id="L329">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_ANIVERSARY_DATE, &quot;true&quot;);</span>

<span class="fc" id="L331">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_FIXED_DATE_MONTH, &quot;0&quot;);</span>
<span class="fc" id="L332">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_FIXED_DATE_DAY, &quot;1&quot;);</span>

<span class="fc" id="L334">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_ACCRUAL_DAY_OF_MONTH, &quot;1&quot;);</span>
<span class="fc" id="L335">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_ACCRUAL_DAY_OF_WEEK, &quot;1&quot;);</span>


<span class="fc" id="L338">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_TO_AVAILABLE_COLOR, &quot;63C584&quot;);</span>
<span class="fc" id="L339">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_TO_WORKING_COLOR, &quot;FBC44D&quot;);</span>
<span class="fc" id="L340">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_TO_PENDING_COLOR, &quot;C4FB4D&quot;);</span>
<span class="fc" id="L341">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_TO_SCHEDULED_COLOR, &quot;C44DFB&quot;);</span>
<span class="fc" id="L342">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_TO_NO_AVAILABLE_COLOR, &quot;BCEFFA&quot;);</span>
<span class="fc" id="L343">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_TO_NON_OPERATION_COLOR, &quot;FFE4E1&quot;);</span>
<span class="fc" id="L344">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_TO_BLACKOUT_COLOR, &quot;FD3B3B&quot;);</span>
<span class="fc" id="L345">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_TO_NON_WORKING_COLOR, &quot;8CA8E2&quot;);</span>

<span class="fc" id="L347">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_TO_POLICY, null);</span>
<span class="fc" id="L348">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_SS_POLICY, null);</span>
<span class="fc" id="L349">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_SB_POLICY, null);</span>
<span class="fc" id="L350">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_CS_POLICY, null);</span>
<span class="fc" id="L351">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_FT_POLICY, null);</span>

<span class="fc" id="L353">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_ENABLE_SHIFT_SWAP, &quot;true&quot;);</span>
<span class="fc" id="L354">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_DISABLE_ONE_WAY_SHIFT_SWAP, &quot;false&quot;);</span>
<span class="fc" id="L355">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_SHIFT_SWAP_ORG_LIST, &quot;&quot;);</span>
<span class="fc" id="L356">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_GROUP_VIEW_ORG_LIST, &quot;&quot;);</span>
<span class="fc" id="L357">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_ALLOW_PARTIAL_SHIFT_SWAP, &quot;false&quot;);</span>
<span class="fc" id="L358">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_ALLOW_PARTIAL_SHIFT_PICKUP, &quot;false&quot;);</span>
<span class="fc" id="L359">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_MAX_SWAP_NEGOTIATIONS, &quot;5&quot;);</span>

		// shift bidding keys
<span class="fc" id="L362">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_MAX_PREFERENCE_VALUE, &quot;1&quot;);</span>
<span class="fc" id="L363">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_ENFORCE_UNIQUE_PREFERENCE, &quot;false&quot;);</span>
<span class="fc" id="L364">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_MAX_BIDS_PER_EMPLOYEE, &quot;100&quot;);</span>
<span class="fc" id="L365">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_SENIORITY_FACTOR, &quot;10.0&quot;);</span>
<span class="fc" id="L366">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_RANK_FACTOR, &quot;2.0&quot;);</span>
<span class="fc" id="L367">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_BONUSPOINT_FACTOR, &quot;5.0&quot;);</span>
<span class="fc" id="L368">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_FILTER_BID_OPTIONS_BY_EMPLOYEE_TYPE, &quot;false&quot;);</span>
<span class="fc" id="L369">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_DISPLAY_TEMPLATE_DESCRIPTION, &quot;false&quot;);</span>

		// custom shift request keys
<span class="fc" id="L372">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_ENABLE_CUSTOM_SHIFT_REQUESTS, &quot;true&quot;);</span>
<span class="fc" id="L373">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_ALLOW_OT_BEFORE_SHIFT, &quot;true&quot;);</span>
<span class="fc" id="L374">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_ALLOW_OT_AFTER_SHIFT, &quot;true&quot;);</span>
<span class="fc" id="L375">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_ALLOW_ENTIRE_OT_SHIFT, &quot;true&quot;);</span>
<span class="fc" id="L376">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_ALLOW_REGULAR_EXTENSION_BEFORE_SHIFT, &quot;true&quot;);</span>
<span class="fc" id="L377">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_ALLOW_REGULAR_EXTENSION_AFTER_SHIFT, &quot;true&quot;);</span>
<span class="fc" id="L378">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_ALLOW_REGULAR_EXTENSION_DURING_GAP, &quot;true&quot;);</span>
<span class="fc" id="L379">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_ALLOW_ENTIRE_REGULAR_SHIFT, &quot;true&quot;);</span>
<span class="fc" id="L380">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_ALLOW_SHIFT_CHANGE_REQUESTS, &quot;true&quot;);</span>
<span class="fc" id="L381">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_ALLOW_EDIT_OT_REQUESTS_GAP, &quot;true&quot;);</span>
<span class="fc" id="L382">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_ALLOW_EDIT_OT_REQUESTS_DURATION, &quot;true&quot;);</span>



		//Special activity attribute override keys
<span class="fc bfc" id="L387" title="All 2 branches covered.">		for (int i=0; i&lt;TimeOffHoursManagerBridgeImpl.specialActivityIDs.length; i++)</span>
		{
<span class="fc" id="L389">			ID activityID = TimeOffHoursManagerBridgeImpl.specialActivityIDs[i];</span>
<span class="fc" id="L390">			lHashMap.put(Activity.getMaxDurationOverrideKey(activityID), null);</span>
<span class="fc" id="L391">			lHashMap.put(Activity.getAdherenceToleranceOverrideKey(activityID), null);</span>
		}

		//Vacation special activity override key
<span class="fc" id="L395">		lHashMap.put(Activity.ACTIVITY_VACATION.toString(), null);</span>


		//FS Org settings keys
<span class="fc" id="L399">		lHashMap.put(RmSettingKey.ORG_FS_SETTINGS_CONTACT_QUEUE_ABOVE_REQ_TOLERANCE, &quot;10&quot;);</span>
<span class="fc" id="L400">		lHashMap.put(RmSettingKey.ORG_FS_SETTINGS_CONTACT_QUEUE_BELOW_REQ_TOLERANCE, &quot;10&quot;);</span>
<span class="fc" id="L401">		lHashMap.put(RmSettingKey.ORG_FS_SETTINGS_PROJECT_QUEUE_ABOVE_REQ_TOLERANCE, &quot;10&quot;);</span>
<span class="fc" id="L402">		lHashMap.put(RmSettingKey.ORG_FS_SETTINGS_PROJECT_QUEUE_BELOW_REQ_TOLERANCE, &quot;10&quot;);</span>

		// BackOffice settings keys
<span class="fc" id="L405">		lHashMap.put(RmSettingKey.ORG_BACKOFFICE_SETTINGS_DISALLOW_VCT_DECIMAL, &quot;false&quot;);</span>

		//Flex Time keys
<span class="fc" id="L408">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_ALLOW_MAKEUP_BEFORE_SHIFT, &quot;true&quot;);</span>
<span class="fc" id="L409">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_ALLOW_MAKEUP_AFTER_SHIFT, &quot;true&quot;);</span>
<span class="fc" id="L410">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_ALLOW_MAKEUP_IN_GAP, &quot;true&quot;);</span>
<span class="fc" id="L411">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_LIMIT_FLEX_TIMEOFF_TO_START_SHIFT_BLOCK, &quot;true&quot;);</span>

<span class="fc" id="L413">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_ALLOW_CONSEC_FLEX, &quot;false&quot;);</span>
<span class="fc" id="L414">		return lHashMap;</span>
	}

	/**
	 * Delete all PROPERTY-KEYs specified in Map for the pParentOrgId
	 * and all it's child Organization.
	 *
	 * @param pParentOrgId - Organisation ID object.
	 * @param pPropertyMap - A Map that contains PROPERTY-KEY
	 *                  and PROPERTY-VALUE
	 * @throws BbmRemoveException if there is an error while executing database
	 *                     query
	 * @deprecated Use the {@link #deletePropertyListForOrgs} method
	 */
	@Deprecated
	@SuppressWarnings({ &quot;unchecked&quot;, &quot;rawtypes&quot; })
	public void deletePropertyList(ID orgId, Set pPropertySet) throws BbmFinderException {
<span class="nc" id="L431">		deletePropertyListForOrgs(new HashSet&lt;ID&gt;(Arrays.asList(orgId)), pPropertySet);</span>
<span class="nc" id="L432">	}</span>

	/**
	 * Delete all specified PROPERTY-KEYs belong to provided organizations
	 * and all their child organizations.
	 *
	 * @param orgIds - organizations
	 * @param pPropertySet - PROPERTY-KEYs to be deleted
	 * @throws BbmRemoveException if there is an error while executing database query
	 */
	public void deletePropertyListForOrgs(Set&lt;ID&gt; orgIds, Set&lt;String&gt; pPropertySet) throws BbmFinderException {
<span class="nc" id="L443">		methodStart(&quot;deletePropertyListForOrgs&quot;, orgIds, pPropertySet);</span>

<span class="nc" id="L445">		OrganizationConfigDAO orgCfgDAO = null;</span>
		try {
<span class="nc" id="L447">			orgCfgDAO = new OrganizationConfigDAO();</span>
<span class="nc" id="L448">			orgCfgDAO.deletePropertyList(orgIds, pPropertySet);</span>

<span class="nc bnc" id="L450" title="All 2 branches missed.">			if (cacheUsed()) {</span>
<span class="nc" id="L451">				initCache();</span>
<span class="nc" id="L452">				clearCache(orgIds);</span>
			}
<span class="nc" id="L454">		} catch (Exception e) {</span>
<span class="nc" id="L455">			handleException(e);</span>
<span class="nc" id="L456">			throw RequestUtil.createBbmFinderExceptionWrapper(e, m_cat);</span>
		} finally {
<span class="nc bnc" id="L458" title="All 4 branches missed.">			if (orgCfgDAO != null) {</span>
<span class="nc" id="L459">				orgCfgDAO.cleanUp();</span>
			}
<span class="nc" id="L461">			methodFinish();</span>
<span class="nc" id="L462">		}</span>
<span class="nc" id="L463">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>