<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>SwapUtil.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.rm.requests</a> &gt; <span class="el_source">SwapUtil.java</span></div><h1>SwapUtil.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.rm.requests;

import java.rmi.RemoteException;
import java.util.Collection;
import java.util.Date;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.ResourceBundle;
import java.util.TimeZone;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.Pair;
import com.bluepumpkin.common.l10n.RegionalFormatBundleKey;
import com.bluepumpkin.common.localization.Localizer;
import com.bluepumpkin.common.logging.Category;
import com.bluepumpkin.common.util.DateTimeUtil;
import com.bluepumpkin.common.util.StringUtil;
import com.bluepumpkin.ejb.bbm.activity.model.Event;
import com.bluepumpkin.ejb.bbm.schedule.model.ShiftAssignment;
import com.bluepumpkin.ejb.bbm.workresource.model.Employee;
import com.bluepumpkin.ejb.bbm.workresource.model.EmployeeName;
import com.bluepumpkin.ejb.core.base.CoreException;
import com.bluepumpkin.ejb.rm.RmManagerFactory;
import com.bluepumpkin.ejb.rm.l10n.RmEjbBundleKey;
import com.bluepumpkin.ejb.rm.requests.common.model.RequestAuditTrail;
import com.bluepumpkin.ejb.rm.requests.common.validation.ValidationUtil;
import com.bluepumpkin.ejb.rm.requests.swap.posting.model.ShiftSwapPosting;
import com.bluepumpkin.ejb.rm.requests.swap.request.ejb.ShiftSwapRequestManager;
import com.bluepumpkin.ejb.rm.requests.swap.request.model.ShiftSwapRequest;
import com.bluepumpkin.ejb.rm.requests.swap.shiftitem.model.ShiftSwapItem;
import com.bluepumpkin.web.bbm.l10n.BbmWebBundleKey;
import com.bluepumpkin.web.bbm.people.skill.PeopleSkillUtil;
import com.bluepumpkin.web.fs.schedule.ScheduleViewUtil;
import com.bluepumpkin.web.rm.IHavePageMessage;
import com.bluepumpkin.web.rm.Log;
import com.bluepumpkin.web.rm.keys.RmImageFileID;
import com.bluepumpkin.web.rm.keys.RmPageAction;
import com.bluepumpkin.web.rm.l10n.RmWebBundleKey;
import com.bluepumpkin.web.rm.l10n.RmWebLogBundleKey;
import com.witness.ejb.core.security.model.User;
import com.witness.web.uif.base.Message;
import com.witness.web.uif.data.wrapper.BasicWrapper;
import com.witness.web.uif.data.wrapper.DateWrapper;
import com.witness.web.uif.jsp.HtmlCode;
import com.witness.web.uif.pagecomponent.DefaultMultiColumnNodeData;
import com.witness.web.uif.pagecomponent.dialog.DialogToolbarMenuPC;
import com.witness.web.uif.pagecomponent.toolbar.ToolbarPC;
import com.witness.web.uif.pagemodel.PageModel;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.util.HtmlUtil;
import com.witness.web.uif.util.html.CSSUtil;
import com.witness.web.uif.util.html.HtmlLinkUtil;

/**
 * Title:        SwapUtil
 * Description:  Utility Class used by Shift Swap and Swap Board
 * Copyright:    Copyright (c) 2002
 * Company:      Blue Pumpkin Software, Inc
 * @author       David Su, dsu
 * @version      1.0
 *
 * Created on November 12, 2002, 5:08 PM
 */
public class SwapUtil {
<span class="nc" id="L66">	private static Category LOG = Log.initCategory(SwapUtil.class.getName());</span>

	private static final String SKILL_POPUP_FUNC_START = &quot;pageMediator.popupAgentsSkills( new Array('&quot;;
	//QC(96672) changes
	private static final String SKILL_POPUP_FUNC_START_New = &quot;pageMediator.popupAgentsSkillsNew( new Array('&quot;;
	private static final String SKILL_POPUP_FUNC_END = &quot;') );&quot;;
	//QC(96672) changes
	private static final String SKILL_POPUP_FUNC_END_New = &quot;);&quot;;

	private static final String TIME_OFF = ShiftSwapItem.SWAPITEMTYPE_TIMEOFF;
	private static final String SHIFT = ShiftSwapItem.SWAPITEMTYPE_SHIFT;

	/** Creates a new instance of ShiftSwapRequestUtil */
<span class="nc" id="L79">	private SwapUtil() {}</span>

  /**
   * Add Shift Swap Not Enabled Message
   */
  public static void addSSNotEnabledMsg(PageModel model) {
<span class="nc" id="L85">    model.addPageMessage(Message.INFO_TYPE,</span>
      RmWebBundleKey.SHIFT_SWAP_NOT_ENABLED, RmWebBundleKey.BUNDLE_NAME);
<span class="nc" id="L87">  }</span>

  /**
   * Return true if Skill Link is enabled for the current User and Employee ID
   */
  public static boolean isSkillLinkEnabled(User user, ID empID, Map eOrgMap) {
<span class="nc" id="L93">    return PeopleSkillUtil.isAuthToViewEmpSkillInfo(user, empID, eOrgMap);</span>
  }

	/**
	 * Create Skill Popup Link if User has privilege
	 *
	 * @param user The Current User
	 * @param empID The employee ID used to find display Name
	 * @param eNameMap The Map containing employee ID and EmployeeName
	 * @param eOrgMap The Map containing employee and organization IDs
	 * @param localizer The localizer used to localized Employee Name
	 * @param empIDs The list of employee IDs separated by &quot;','&quot; including the quotes
	 */
	public static String createSkillPopupLink(User user, ID empID, Map eNameMap,
	Map eOrgMap, String empIDs, Localizer localizer) {
<span class="nc" id="L108">		EmployeeName empName = (EmployeeName)eNameMap.get(empID);</span>
<span class="nc" id="L109">		String eNameDisplay = localizer.formatName(empName);</span>
<span class="nc" id="L110">		String result = eNameDisplay;</span>

<span class="nc bnc" id="L112" title="All 2 branches missed.">		if (isSkillLinkEnabled(user, empID, eOrgMap)) {</span>
<span class="nc" id="L113">      String alt = localizer.i18n(BbmWebBundleKey.BUNDLE_NAME, BbmWebBundleKey.BBM_PEOPLE_SKILLS);</span>
<span class="nc" id="L114">			String onClickJS = SKILL_POPUP_FUNC_START + empIDs + SKILL_POPUP_FUNC_END;</span>
<span class="nc" id="L115">			result = HtmlLinkUtil.createActiveLink(eNameDisplay, alt, &quot;&quot;, onClickJS);</span>
		}

<span class="nc" id="L118">		return result;</span>
	}

	/**
	 * add Agent Name with onClickJS popup Skills
	 */
	public static void addAgentName(User user, ShiftSwapPosting ssPosting, Map&lt;ID, EmployeeName&gt; eNameMap, Map&lt;ID, ID&gt; eOrgMap,
			Localizer localizer, DefaultMultiColumnNodeData row_data) {
<span class="nc" id="L126">		addAgentName(user, ssPosting, eNameMap, eOrgMap, localizer, row_data, null);</span>
<span class="nc" id="L127">	}</span>

	/**
	 * add Agent Name with onClickJS popup Skills
	 */
	public static void addAgentName(User user, ShiftSwapPosting ssPosting, Map&lt;ID, EmployeeName&gt; eNameMap, Map&lt;ID, ID&gt; eOrgMap,
			Localizer localizer, DefaultMultiColumnNodeData rowData, String instructionMessage) {
<span class="nc" id="L134">		ID empID = ssPosting.getEmployeeID();</span>
<span class="nc" id="L135">		ShiftSwapItem item = ssPosting.getShiftSwapItem();</span>
<span class="nc" id="L136">		Date shiftDate = item.getStartDate();</span>
<span class="nc" id="L137">		long shiftStartDate = shiftDate.getTime();</span>
<span class="nc" id="L138">		String empIDStr = empID.toString();</span>
<span class="nc" id="L139">		String data = createSkillPopupLinkNew(user, empID, eNameMap, eOrgMap, empIDStr, localizer,</span>
				shiftStartDate, shiftStartDate, instructionMessage);

<span class="nc" id="L142">		EmployeeName empName = eNameMap.get(empID);</span>
<span class="nc" id="L143">		String eNameDisplay = localizer.formatName(empName);</span>
		// wrap the employee name so it will sort on it not the html
<span class="nc" id="L145">		BasicWrapper wrapper = new BasicWrapper(eNameDisplay, HtmlCode.fromHtml(data));</span>

<span class="nc" id="L147">		rowData.add(wrapper);</span>
<span class="nc" id="L148">	}</span>

	/**
	 * Create Agent Names with onClickJS popup Skills
	 */
	public static String createAgentNames(User user, ShiftSwapRequest ssRequest, Map eNameMap, Map eOrgMap, Localizer localizer) {
<span class="nc" id="L154">		return createAgentNames(user, ssRequest, eNameMap, eOrgMap, localizer, null);</span>
	}
	
	public static String createAgentNames(User user, ShiftSwapRequest ssRequest, Map eNameMap, Map eOrgMap,
			Localizer localizer, String instructionMessage) {
<span class="nc" id="L159">		List empIDList = ssRequest.getEmployees();</span>
<span class="nc bnc" id="L160" title="All 4 branches missed.">		if (empIDList == null || empIDList.isEmpty())</span>
<span class="nc" id="L161">			return &quot;&quot;;</span>

<span class="nc" id="L163">		ID empID1 = (ID)empIDList.get(0);</span>
<span class="nc" id="L164">		ID empID2 = (ID)empIDList.get(1);</span>
		// QC(96672) changes -- getting the shift date of agents swaping their
		// shifts .
<span class="nc" id="L167">        List items = ssRequest.getShiftSwapItems();</span>
<span class="nc" id="L168">		ShiftSwapItem item1 = (ShiftSwapItem)items.get(0);</span>
<span class="nc" id="L169">	    ShiftSwapItem item2 = (ShiftSwapItem)items.get(1);</span>
<span class="nc" id="L170">	    Map map = new HashMap() ;</span>
<span class="nc" id="L171">	    ID item1empId = item1.getEmployeeID();</span>
<span class="nc" id="L172">	    ID item2empId = item2.getEmployeeID();</span>
<span class="nc" id="L173">        map.put(item1empId, item2.getStartDate()) ;</span>
<span class="nc" id="L174">        map.put(item2empId, item1.getStartDate()) ;</span>
<span class="nc" id="L175">        long empID1ShiftDate = ((Date) map.get(empID1)).getTime();</span>
<span class="nc" id="L176">        long empID2ShiftDate = ((Date) map.get(empID2)).getTime();</span>

<span class="nc" id="L178">		String sLink1 = &quot;&quot;;</span>
<span class="nc" id="L179">		String sLink2 = &quot;&quot;;</span>
<span class="nc bnc" id="L180" title="All 4 branches missed.">		if (isSkillLinkEnabled(user, empID1, eOrgMap) &amp;&amp; isSkillLinkEnabled(user, empID2, eOrgMap)) {</span>
<span class="nc" id="L181">			String empIDStr = empID1 + &quot;','&quot; + empID2;</span>
			// QC(96672) changes -- passed shift date as arg to
			// createSkillPopupLinkNew fuction which will in turn add the shift
			// date in the request params
<span class="nc" id="L185">			sLink1 = createSkillPopupLinkNew(user, empID1, eNameMap, eOrgMap, empIDStr, localizer, empID1ShiftDate,</span>
					empID2ShiftDate);
<span class="nc" id="L187">			sLink2 = createSkillPopupLinkNew(user, empID2, eNameMap, eOrgMap, empIDStr, localizer, empID1ShiftDate,</span>
					empID2ShiftDate, instructionMessage);
<span class="nc" id="L189">		} else {</span>
			//QC(96672)changes
<span class="nc" id="L191">			sLink1 = createSkillPopupLinkNew(user, empID1, eNameMap, eOrgMap, empID1.toString(), localizer,</span>
					empID1ShiftDate, empID2ShiftDate);
<span class="nc" id="L193">			sLink2 = createSkillPopupLinkNew(user, empID2, eNameMap, eOrgMap, empID2.toString(), localizer,</span>
					empID1ShiftDate, empID2ShiftDate, instructionMessage);
		}

<span class="nc" id="L197">	  return createTwoRow(sLink1, sLink2);</span>
	}

	
		
	/**
	 * Add Shift Dates for Shift Swap Posting
	 */
	public static void addShiftDates(ShiftSwapPosting ssPosting, Localizer localizer, TimeZone tz, DefaultMultiColumnNodeData row_data) {
<span class="nc" id="L206">		String nonWorkLabel = localizer.i18n(RmWebBundleKey.BUNDLE_NAME, RmWebBundleKey.SS_NON_WORK);</span>
<span class="nc" id="L207">		String timeLabel = localizer.i18n(RmWebBundleKey.BUNDLE_NAME, RmWebBundleKey.SS_TIME);</span>

<span class="nc" id="L209">		Date startDate = ssPosting.getDisplayStartDate();</span>
<span class="nc" id="L210">		DateWrapper dw = new DateWrapper(startDate, localizer, tz, RegionalFormatBundleKey.DATE_FORMAT);</span>
<span class="nc" id="L211">		row_data.add( dw, CSSUtil.STYLE_NOWRAP );</span>

		//ShiftType
<span class="nc" id="L214">		Date endDate = ssPosting.getEndDate();</span>
<span class="nc" id="L215">		String shiftType = ssPosting.getShiftSwapItem().getShiftType();</span>
<span class="nc bnc" id="L216" title="All 2 branches missed.">		if (TIME_OFF.equals(shiftType)) {</span>
<span class="nc" id="L217">			row_data.add(nonWorkLabel);</span>
<span class="nc" id="L218">			row_data.add(timeLabel);</span>
		}	else {
<span class="nc" id="L220">			row_data.add( timeSecs(startDate, localizer, tz) );</span>
<span class="nc" id="L221">			row_data.add( timeSecs(endDate, localizer, tz) );</span>
		}
<span class="nc" id="L223">	}</span>

	/**
	 * Add Shift Dates
	 */
	public static void addShiftDates(ShiftSwapRequest ssRequest,
			ResourceBundle bundle, Localizer localizer, TimeZone tz,
			DefaultMultiColumnNodeData row_data) {
<span class="nc" id="L231">		String nonWorkLabel = localizer.i18n(bundle, RmWebBundleKey.SS_NON_WORK);</span>
<span class="nc" id="L232">		String timeLabel = localizer.i18n(bundle, RmWebBundleKey.SS_TIME);</span>

		//Shift &amp; Start &amp; End Date
<span class="nc" id="L235">		Date startDate1 = (Date) (ssRequest.getDisplayStartDates()).get(0);</span>
<span class="nc" id="L236">		Date startDate2 = (Date) (ssRequest.getDisplayStartDates()).get(1);</span>
<span class="nc bnc" id="L237" title="All 4 branches missed.">		if (TIME_OFF.equals(ssRequest.getShiftTypes().get(0)) &amp;&amp; SHIFT.equals(ssRequest.getShiftTypes().get(1))) {</span>
<span class="nc" id="L238">			startDate1 = startDate2;</span>
<span class="nc bnc" id="L239" title="All 4 branches missed.">		} else if (SHIFT.equals(ssRequest.getShiftTypes().get(0)) &amp;&amp; TIME_OFF.equals(ssRequest.getShiftTypes().get(1))) {</span>
<span class="nc" id="L240">			startDate2 = startDate1;</span>
		}
<span class="nc" id="L242">		row_data.add(format(startDate1, startDate2, localizer, tz, RegionalFormatBundleKey.DATE_FORMAT));</span>

		//ShiftTypes
<span class="nc" id="L245">		Date endDate1 = (Date) (ssRequest.getEndDates()).get(0);</span>
<span class="nc" id="L246">		Date endDate2 = (Date) (ssRequest.getEndDates()).get(1);</span>
<span class="nc" id="L247">		String shiftType1 = (String) ssRequest.getShiftTypes().get(0);</span>
<span class="nc" id="L248">		String shiftType2 = (String) ssRequest.getShiftTypes().get(1);</span>
<span class="nc bnc" id="L249" title="All 4 branches missed.">		if (TIME_OFF.equals(shiftType1) &amp;&amp; SHIFT.equals(shiftType2)) {</span>
<span class="nc" id="L250">			row_data.add(nonWorkLabel + &quot;&lt;br&gt;&quot; + timeSecs(startDate2, localizer, tz));</span>
<span class="nc" id="L251">			row_data.add(timeLabel + &quot;&lt;br&gt;&quot; + timeSecs(endDate2, localizer, tz));</span>
<span class="nc bnc" id="L252" title="All 4 branches missed.">		} else if (SHIFT.equals(shiftType1) &amp;&amp; TIME_OFF.equals(shiftType2)) {</span>
<span class="nc" id="L253">			row_data.add(timeSecs(startDate1, localizer, tz) + &quot;&lt;br&gt;&quot; + nonWorkLabel);</span>
<span class="nc" id="L254">			row_data.add(timeSecs(endDate1, localizer, tz) + &quot;&lt;br&gt;&quot; + timeLabel);</span>
		} else {
<span class="nc" id="L256">			row_data.add(format(startDate1, startDate2, localizer, tz, RegionalFormatBundleKey.TIME_FORMAT));</span>
<span class="nc" id="L257">			row_data.add(format(endDate1, endDate2, localizer, tz, RegionalFormatBundleKey.TIME_FORMAT));</span>
		}
<span class="nc" id="L259">	}</span>

  /**
   * Format Shift Date
   *
   * @param ssItem The Shift Swap Item
   * @param localizer Localzier
	 * @param tz TimeZone
   * @return the formatted display
   */
  public static String formatShiftDate(ShiftSwapItem ssItem, Localizer localizer, TimeZone tz) {
<span class="nc" id="L270">    String result = &quot;&quot;;</span>

<span class="nc" id="L272">    String shiftType = ssItem.getShiftType();</span>
<span class="nc" id="L273">    Date startDate = ssItem.getDisplayStartDate();</span>
<span class="nc bnc" id="L274" title="All 2 branches missed.">    if (TIME_OFF.equals(shiftType)) {</span>
<span class="nc" id="L275">      result = localizer.formatDate(startDate, tz, RegionalFormatBundleKey.DATE_FORMAT);</span>
    } else {
<span class="nc" id="L277">      Date endDate = ssItem.getEndDate();</span>
<span class="nc" id="L278">      result = localizer.formatDate(startDate, tz, RegionalFormatBundleKey.DATE_FORMAT) +</span>
<span class="nc" id="L279">        &quot; &quot; + localizer.formatDate(startDate, tz, RegionalFormatBundleKey.TIME_FORMAT) +</span>
<span class="nc" id="L280">        &quot;-&quot; + localizer.formatDate(endDate,  tz, RegionalFormatBundleKey.TIME_FORMAT);</span>
    }
<span class="nc" id="L282">    return result;</span>
  }

	/**
	 * Add Post Expiration Date
	 */
	public static void addPostExpirationDate(ShiftSwapPosting ssPosting,
	Localizer localizer, TimeZone tz, DefaultMultiColumnNodeData row_data) {
		//Post Expiration Date
<span class="nc" id="L291">		Date expireDate = ssPosting.getExpirationDate();</span>
<span class="nc" id="L292">		DateWrapper dw = new DateWrapper(expireDate, localizer, tz, RegionalFormatBundleKey.DATE_FORMAT,  RegionalFormatBundleKey.TIME_FORMAT);</span>
<span class="nc" id="L293">		row_data.add( dw, CSSUtil.STYLE_NOWRAP );</span>
<span class="nc" id="L294">	}</span>

	/**
	 * Add Post Expiration Date
	 */
	public static void addPostExpirationDate(ShiftSwapRequest ssRequest,
	Localizer localizer, TimeZone tz, DefaultMultiColumnNodeData row_data) {
		//Post Expiration Date
<span class="nc" id="L302">		Date expireDate1 = (Date)(ssRequest.getExpirationDates()).get(0);</span>
<span class="nc" id="L303">		Date expireDate2 = (Date)(ssRequest.getExpirationDates()).get(1);</span>
<span class="nc" id="L304">		row_data.add(formatDateTime(expireDate1, expireDate2, localizer, tz, RegionalFormatBundleKey.DATE_FORMAT, RegionalFormatBundleKey.TIME_SEC_FORMAT));</span>
<span class="nc" id="L305">	}</span>


	/**
	 * Add Confirm Data
	 */
	public static void addConfirmData(ShiftSwapPosting ssPosting,
			Localizer localizer, DefaultMultiColumnNodeData row_data) {
<span class="nc" id="L313">		String data = localizer.formatYesNo(ssPosting.getNegotiation());</span>
<span class="nc" id="L314">		row_data.add( data );</span>
<span class="nc" id="L315">	}</span>

	/**
	 * Add Partial info
	 */
	public static void addIsPartial(ShiftSwapPosting ssPosting,
			Localizer localizer, DefaultMultiColumnNodeData row_data) {
<span class="nc" id="L322">		String data = localizer.formatYesNo(ssPosting.getIsPartial());</span>
<span class="nc" id="L323">		row_data.add( data );</span>
<span class="nc" id="L324">	}</span>

	/**
	 * Add Is partial Shift Data
	 */
	public static void addIsPartialData(ShiftSwapRequest ssRequest,
		Localizer localizer, DefaultMultiColumnNodeData row_data) {
<span class="nc" id="L331">		Boolean b1 = new Boolean(ssRequest.getShiftSwapItems().get(0).getIsPartial());</span>
<span class="nc" id="L332">		Boolean b2 = new Boolean(ssRequest.getShiftSwapItems().get(1).getIsPartial());</span>
<span class="nc" id="L333">		String data = localizer.formatYesNo(b1.booleanValue()) + &quot;&lt;br&gt;&quot; +</span>
<span class="nc" id="L334">			localizer.formatYesNo(b2.booleanValue());</span>
<span class="nc" id="L335">		row_data.add( data );</span>
<span class="nc" id="L336">	}</span>

	/**
	 * Add Confirm Data
	 */
	public static void addConfirmData(ShiftSwapRequest ssRequest,
			Localizer localizer, DefaultMultiColumnNodeData row_data) {
<span class="nc" id="L343">		Boolean b1 = (Boolean)ssRequest.getNegotiations().get(0);</span>
<span class="nc" id="L344">		Boolean b2 = (Boolean)ssRequest.getNegotiations().get(1);</span>
<span class="nc" id="L345">		String data = localizer.formatYesNo(b1.booleanValue()) + &quot;&lt;br&gt;&quot; +</span>
<span class="nc" id="L346">			localizer.formatYesNo(b2.booleanValue());</span>
<span class="nc" id="L347">		row_data.add( data );</span>
<span class="nc" id="L348">	}</span>

	/**
	 * Add Seniority Data for emp1 and emp2 to the Seniority column of the Shift Swap Requests list
	 */
	public static void addSeniorityData(ShiftSwapRequest ssRequest,
		Localizer localizer, DefaultMultiColumnNodeData row_data, TimeZone tz)
	{
<span class="nc" id="L356">		ID empID1 = ssRequest.getShiftSwapItems().get(0).getEmployeeID();</span>
<span class="nc" id="L357">		ID empID2 = ssRequest.getShiftSwapItems().get(1).getEmployeeID();</span>

<span class="nc" id="L359">		String data = &quot;&amp;nbsp;&quot;;</span>
<span class="nc bnc" id="L360" title="All 4 branches missed.">		if (empID1 != null &amp;&amp; empID2 != null)</span>
		{
<span class="nc" id="L362">			Employee emp1 = getBasicEmployee(empID1);</span>
<span class="nc" id="L363">			Employee emp2 = getBasicEmployee(empID2);</span>

<span class="nc bnc" id="L365" title="All 4 branches missed.">			if (emp1 != null &amp;&amp; emp2 != null)</span>
			{
<span class="nc" id="L367">				Date date1 = emp1.getStartTime();</span>
<span class="nc" id="L368">				Date date2 = emp2.getStartTime();</span>

<span class="nc" id="L370">				data = new DateWrapper(date1, localizer, tz, RegionalFormatBundleKey.DATE_FORMAT) + &quot;&lt;br&gt;&quot; +</span>
				       new DateWrapper(date2, localizer, tz, RegionalFormatBundleKey.DATE_FORMAT);
			}
		}
<span class="nc" id="L374">		row_data.add( data );</span>
<span class="nc" id="L375">	}</span>

	/**
	 * Add Rank Data for emp1 and emp2 to the Rank column of the Shift Swap Requests list
	 */
	public static void addRankData(ShiftSwapRequest ssRequest,
		Localizer localizer, DefaultMultiColumnNodeData row_data)
	{
<span class="nc" id="L383">		ID empID1 = ssRequest.getShiftSwapItems().get(0).getEmployeeID();</span>
<span class="nc" id="L384">		ID empID2 = ssRequest.getShiftSwapItems().get(1).getEmployeeID();</span>

<span class="nc" id="L386">		String data = &quot;&amp;nbsp;&quot;;</span>
<span class="nc bnc" id="L387" title="All 4 branches missed.">		if (empID1 != null &amp;&amp; empID2 != null)</span>
		{
<span class="nc" id="L389">			Employee emp1 = getEmployee(empID1, Employee.DETAIL_LEVEL_EMPLOYEE_TIMEBASEDPROPERTY);</span>
<span class="nc" id="L390">			Employee emp2 = getEmployee(empID2, Employee.DETAIL_LEVEL_EMPLOYEE_TIMEBASEDPROPERTY);</span>

<span class="nc bnc" id="L392" title="All 4 branches missed.">			if (emp1 != null &amp;&amp; emp2 != null)</span>
			{
<span class="nc" id="L394">				int rank1 = emp1.getRank();</span>
<span class="nc" id="L395">				int rank2 = emp2.getRank();</span>

<span class="nc" id="L397">				data = &quot;&quot; + rank1 + &quot;&lt;br&gt;&quot; + rank2;</span>
			}
		}
<span class="nc" id="L400">		row_data.add( data );</span>
<span class="nc" id="L401">	}</span>

	/**
	 * Get an employee, using Employee.DETAIL_LEVEL_EMPLOYEE_BASIC
	 */
	public static Employee getEmployee(ID empID, int detailLevel)
	{
<span class="nc" id="L408">		Employee emp = null;</span>
        try
        {
<span class="nc" id="L411">            emp = ValidationUtil.getEmployeeByID(empID, null, detailLevel);</span>
        }
<span class="nc" id="L413">        catch (Exception ex)</span>
        {
<span class="nc" id="L415">        }</span>
<span class="nc" id="L416">        return emp;</span>
	}

	/**
	 * Get an employee, using Employee.DETAIL_LEVEL_EMPLOYEE_BASIC
	 */
	public static Employee getBasicEmployee(ID empID)
	{
<span class="nc" id="L424">		Employee emp = null;</span>
        try
        {
<span class="nc" id="L427">            emp = ValidationUtil.getEmployeeByID(empID, null, Employee.DETAIL_LEVEL_EMPLOYEE_BASIC);</span>
        }
<span class="nc" id="L429">        catch (Exception ex)</span>
        {
<span class="nc" id="L431">        }</span>
<span class="nc" id="L432">        return emp;</span>
	}
	


	/**
	 * Add Swap Type Image
	 */
	public static void addSwapTypeImage(String swapType, ResourceBundle bundle, Localizer localizer,
			DefaultMultiColumnNodeData row_data, boolean isAccessibilityComplianceMode) {
		// Swap Type Image
<span class="nc" id="L443">		String swapImage = &quot;&quot;;</span>
		boolean isTabbable, useAriaTooltip;
<span class="nc" id="L445">		isTabbable = useAriaTooltip = isAccessibilityComplianceMode;</span>
<span class="nc bnc" id="L446" title="All 2 branches missed.">		if (ShiftSwapRequest.SHIFTSWAP_TYPE_ONEWAY.equals(swapType)) {</span>
<span class="nc" id="L447">			String alt = localizer.i18n(bundle, RmWebBundleKey.SWAPTYPE_ONEWAY);</span>
<span class="nc" id="L448">			swapImage = HtmlUtil.imageTag(null, RmImageFileID.SWAP_BOARD_ONEWAY, null, null, alt, null, null, true,</span>
					null, isTabbable, useAriaTooltip);
<span class="nc bnc" id="L450" title="All 2 branches missed.">		} else if (ShiftSwapRequest.SHIFTSWAP_TYPE_TWOWAY.equals(swapType)) {</span>
<span class="nc" id="L451">			String alt = localizer.i18n(bundle, RmWebBundleKey.SWAPTYPE_TWOWAY);</span>
<span class="nc" id="L452">			swapImage = HtmlUtil.imageTag(null, RmImageFileID.SWAP_BOARD_TWOWAY, null, null, alt, null, null, true,</span>
					null, isTabbable, useAriaTooltip);
		}

<span class="nc" id="L456">	  String data = &quot;&lt;center&gt;&quot; + swapImage + &quot;&lt;/center&gt;&quot;;</span>
<span class="nc" id="L457">		row_data.add( data );</span>
<span class="nc" id="L458">	}</span>

	/**
	 * Add Swap Type Image
	 */
	public static void addSwapTypeImage(String swapType, ResourceBundle bundle, Localizer localizer,
			DefaultMultiColumnNodeData row_data) {
<span class="nc" id="L465">		addSwapTypeImage(swapType, bundle, localizer, row_data, false);</span>
<span class="nc" id="L466">	}</span>

	/**
	 * Create Two Row of display where each row does not have breaks
	 */
	public static String createTwoRow(String item1, String item2) {
<span class="nc" id="L472">		return &quot;&lt;nobr&gt;&quot; + item1 + &quot;&lt;/nobr&gt;&lt;br&gt;&lt;nobr&gt;&quot; + item2 + &quot;&lt;/nobr&gt;&quot;;</span>
	}

	/**
	 * Return Time with Second for specififed date
	 */
	private static String timeSecs(Date date, Localizer localizer, TimeZone tz) {
<span class="nc" id="L479">		return localizer.formatDate(date,tz, RegionalFormatBundleKey.TIME_SEC_FORMAT);</span>
	}

	/**
	 * Format the Specified dates in Two Rows
	 */
	private static String format(Date date1, Date date2, Localizer localizer, TimeZone tz,
			String patternKey) {
<span class="nc" id="L487">		String d1 = localizer.formatDate(date1, tz, patternKey);</span>
<span class="nc" id="L488">		String d2 = localizer.formatDate(date2, tz, patternKey);</span>
<span class="nc" id="L489">		return createTwoRow(d1, d2);</span>
	}

	/**
	 * Format the Specified dates in Two Rows
	 */
	private static String formatDateTime(Date date1, Date date2, Localizer localizer, TimeZone tz,
			String datePatternKey, String timePatternKey) {
<span class="nc" id="L497">		String d1 = localizer.formatDate(date1, tz, datePatternKey, timePatternKey);</span>
<span class="nc" id="L498">		String d2 = localizer.formatDate(date2, tz, datePatternKey, timePatternKey);</span>
<span class="nc" id="L499">		return createTwoRow(d1, d2);</span>
	}


	/**
	 * Return true if Shift Swap Item contains a Time Off Shift
	 */
	public static boolean isTimeOffShift(ShiftSwapItem item) {
<span class="nc" id="L507">		String shiftType = item.getShiftType();</span>
<span class="nc" id="L508">		return ShiftSwapItem.SWAPITEMTYPE_TIMEOFF.equals(shiftType);</span>
	}

	/**
	 * Return true if shift Type is Time Off
	 */
	public static boolean isTimeOffShift(String shiftType) {
<span class="nc" id="L515">		return ShiftSwapItem.SWAPITEMTYPE_TIMEOFF.equals(shiftType);</span>
	}

	public static boolean isShift(ShiftSwapItem item) {
<span class="nc" id="L519">		return ShiftSwapItem.SWAPITEMTYPE_SHIFT.equalsIgnoreCase(item.getShiftType());</span>
	}

	public static boolean isShift(String shiftType) {
<span class="nc" id="L523">		return ShiftSwapItem.SWAPITEMTYPE_SHIFT.equalsIgnoreCase(shiftType);</span>
	}

	public static boolean isOneWay(String swapType) {
<span class="nc" id="L527">		return ShiftSwapRequest.SHIFTSWAP_TYPE_ONEWAY.equalsIgnoreCase(swapType);</span>
	}

	public static boolean isTwoWay(String swapType) {
<span class="nc" id="L531">		return ShiftSwapRequest.SHIFTSWAP_TYPE_TWOWAY.equalsIgnoreCase(swapType);</span>
	}

	/**
	 * Adjust Shift Swap Item Dates with Scheduled Shift or Day Off
	 * Start and End Dates
	 *
	 * It automatically adds error message to page model if any.
	 */
	public static boolean adjustShiftSwapItemDates(ShiftSwapItem item, Date shiftDate,
	Localizer localizer, TimeZone tz, IHavePageMessage model) {
<span class="nc" id="L542">		boolean success = true;</span>

		try {
<span class="nc" id="L545">			ID empID = item.getEmployeeID();</span>
<span class="nc" id="L546">			Event event = RequestsMH.findShiftAssignmentEvent(empID, shiftDate, tz);</span>

<span class="nc" id="L548">			boolean isTimeOffShift = isTimeOffShift(item);</span>
<span class="nc bnc" id="L549" title="All 2 branches missed.">			success = isTimeOffShift</span>
<span class="nc" id="L550">			  ? adjustShiftSwapItemForDayOff(item, shiftDate, tz, event)</span>
<span class="nc" id="L551">				: adjustShiftSwapItemForShift(item, event);</span>

<span class="nc bnc" id="L553" title="All 2 branches missed.">			if (!success) {</span>
<span class="nc bnc" id="L554" title="All 2 branches missed.">				String rbKey = isTimeOffShift</span>
				  ? RmWebBundleKey.NO_DAYOFF_ON_DATE : RmWebBundleKey.NO_SHIFT_ON_DATE;

<span class="nc" id="L557">				String[] args = new String[] {</span>
<span class="nc" id="L558">					localizer.formatDate(shiftDate, tz, RegionalFormatBundleKey.DATE_FORMAT)</span>
				};
<span class="nc" id="L560">				model.addPageMessage(Message.ERROR_TYPE, rbKey,</span>
				  RmWebBundleKey.BUNDLE_NAME, args);
			}
<span class="nc" id="L563">		} catch (Exception ex) {</span>
<span class="nc" id="L564">			success=false;</span>
<span class="nc" id="L565">			LOG.l7dError(RmWebLogBundleKey.ERROR_FINDING_SHIFT, ex);</span>
<span class="nc" id="L566">			model.addPageMessage(Message.ERROR_TYPE, RmWebBundleKey.ERROR_FINDING_SHIFT,</span>
				RmWebBundleKey.BUNDLE_NAME);
<span class="nc" id="L568">		}</span>

<span class="nc" id="L570">		return success;</span>
	}

	/**
	 * Adjust Shift Swap Item Dates with Scheduled Shift Start and End Dates
	 */
	public static boolean adjustShiftSwapItemForShift(ShiftSwapItem item, Event event) {
<span class="nc bnc" id="L577" title="All 4 branches missed.">		if(item!=null &amp;&amp; event!=null){</span>
<span class="nc" id="L578">			item.setStartDate( ScheduleViewUtil.getDisplayStartTime((ShiftAssignment)event) );</span>
<span class="nc" id="L579">			item.setEndDate( event.getEndTime() );</span>
<span class="nc" id="L580">			return true;</span>
		}
<span class="nc" id="L582">		return false;</span>
	}

	/**
	 * Adjust Shift Swap item Start and End Date for Day Off
	 */
	public static boolean adjustShiftSwapItemForDayOff(ShiftSwapItem item, Date shiftDate, TimeZone tz, Event event) {
<span class="nc bnc" id="L589" title="All 2 branches missed.">		if(item!=null){</span>
<span class="nc" id="L590">			Date dayStart = DateTimeUtil.getDayStart(shiftDate, tz);</span>
<span class="nc" id="L591">			Date dayEnd = DateTimeUtil.getDayEnd(shiftDate, tz);</span>
<span class="nc" id="L592">			item.setStartDate(dayStart);</span>
<span class="nc" id="L593">			item.setEndDate(dayEnd);</span>
<span class="nc" id="L594">			return true;</span>
		}
<span class="nc" id="L596">		return false;</span>
	}

  /**
   * Create Shift Swap Menu PC
   */
  public static DialogToolbarMenuPC createShiftSwapMenu(RequestContext context, ToolbarPC toolbar, String name) {
<span class="nc" id="L603">    DialogToolbarMenuPC newSwapMenuPC = new DialogToolbarMenuPC(context, toolbar);</span>
<span class="nc" id="L604">    newSwapMenuPC.setName(name);</span>

<span class="nc" id="L606">		Localizer localizer = context.getLocalizer();</span>
<span class="nc" id="L607">    ResourceBundle bundle = localizer.getBundle(RmWebBundleKey.BUNDLE_NAME);</span>

    // Initialize Title
<span class="nc" id="L610">    String title = localizer.i18n(bundle, RmWebBundleKey.REQUEST_TYPE_SHIFT_SWAP);</span>
<span class="nc" id="L611">    newSwapMenuPC.setHeader(title);</span>

    // Initialize Menu Buttons
<span class="nc" id="L614">    newSwapMenuPC.addPopupWindowButton(RmPageAction.POPUP_SWAPBOARD_POSTING_FORM_ACTION,</span>
<span class="nc" id="L615">      localizer.i18n(bundle, RmWebBundleKey.CREATE_NEW_POSTING), true);</span>

<span class="nc" id="L617">    newSwapMenuPC.addPopupWindowButton(RmPageAction.POPUP_SHIFTSWAP_REQUEST_FORM_ACTION,</span>
<span class="nc" id="L618">      localizer.i18n(bundle, RmWebBundleKey.CREATE_NEW_REQUEST), true);</span>

<span class="nc" id="L620">    return newSwapMenuPC;</span>
  }

	/**
	 * Can the current user submit the shift swap request to the manager?
	 * We must check that isNegotiationRequired is FALSE for the SECOND ShiftSwapItem
	 * @param request The Shift Swap Request object
	 * @return true if the current user can submit the shift swap request to the manager, false otherwise.
	 */
	public static boolean canUserSubmitShiftSwapToManager(ID empID, ShiftSwapRequest request)
	{
<span class="nc" id="L631">		List ssItems = request.getShiftSwapItems();</span>
<span class="nc" id="L632">		ShiftSwapItem ssItem1 = (ShiftSwapItem)ssItems.get(0);</span>
<span class="nc" id="L633">		ShiftSwapItem ssItem2 = (ShiftSwapItem)ssItems.get(1);</span>

		//item2 should be the ShiftSwapItem for the other employee
<span class="nc bnc" id="L636" title="All 2 branches missed.">		if (!empID.equals(ssItem1.getEmployeeID()) &amp;&amp;</span>
<span class="nc bnc" id="L637" title="All 2 branches missed.">			 empID.equals(ssItem2.getEmployeeID()))</span>
		{
<span class="nc" id="L639">			ssItem2 = ssItem1;</span>
		}
<span class="nc bnc" id="L641" title="All 2 branches missed.">		return !ssItem2.getNegotiation();</span>
	}


	//QC(96672) changes -- created duplicate of createSkillPopupLink() function
	public static String createSkillPopupLinkNew(User user, ID empID, Map&lt;ID, EmployeeName&gt; eNameMap, Map&lt;ID, ID&gt; eOrgMap, String empIDs,
			Localizer localizer, long emp1ShiftDate, long emp2ShiftDate) {
<span class="nc" id="L648">		return createSkillPopupLinkNew(user, empID, eNameMap, eOrgMap, empIDs, localizer, emp1ShiftDate, emp2ShiftDate, null);</span>
	}
	
	public static String createSkillPopupLinkNew(User user, ID empID, Map&lt;ID, EmployeeName&gt; eNameMap, Map&lt;ID, ID&gt; eOrgMap, String empIDs,
			Localizer localizer, long emp1ShiftDate, long emp2ShiftDate, String instructionMessage) {
<span class="nc" id="L653">		EmployeeName empName = eNameMap.get(empID);</span>
<span class="nc" id="L654">		String eNameDisplay = localizer.formatName(empName);</span>
<span class="nc" id="L655">		String result = eNameDisplay;</span>

<span class="nc bnc" id="L657" title="All 2 branches missed.">		if (isSkillLinkEnabled(user, empID, eOrgMap)) {</span>
<span class="nc" id="L658">			String alt = localizer.i18n(BbmWebBundleKey.BUNDLE_NAME, BbmWebBundleKey.BBM_PEOPLE_SKILLS);</span>
<span class="nc" id="L659">			String onClickJS = SKILL_POPUP_FUNC_START_New + empIDs + &quot;'),&quot; + emp1ShiftDate + &quot;,&quot; + emp2ShiftDate</span>
					+ SKILL_POPUP_FUNC_END_New;
<span class="nc bnc" id="L661" title="All 2 branches missed.">			if (!StringUtil.isEmpty(instructionMessage)) {</span>
<span class="nc" id="L662">				result = HtmlLinkUtil.createActiveLink(eNameDisplay, alt, &quot;&quot;, onClickJS, instructionMessage);</span>
			} else {
<span class="nc" id="L664">				result = HtmlLinkUtil.createActiveLink(eNameDisplay, alt, &quot;&quot;, onClickJS);</span>
			}			
		}

<span class="nc" id="L668">		return result;</span>
	}

	/**
	 * Gets the employee items from the request where the firstEmployeeID's item is the first of the pair.
	 */
	public static Pair&lt;ShiftSwapItem, ShiftSwapItem&gt; getEmployeeItems(ShiftSwapRequest request, ID firstEmployeeID) {
<span class="nc" id="L675">		List&lt;ShiftSwapItem&gt; ssItems = request.getShiftSwapItems();</span>
<span class="nc" id="L676">		ShiftSwapItem ssItem1 = ssItems.get(0);</span>
<span class="nc" id="L677">		ShiftSwapItem ssItem2 = ssItems.get(1);</span>

<span class="nc bnc" id="L679" title="All 2 branches missed.">		if (firstEmployeeID.equals(ssItem1.getEmployeeID())) {</span>
<span class="nc" id="L680">			return new Pair&lt;ShiftSwapItem, ShiftSwapItem&gt;(ssItem1, ssItem2);</span>
		}
<span class="nc" id="L682">		return new Pair&lt;ShiftSwapItem, ShiftSwapItem&gt;(ssItem2, ssItem1);</span>
	}

	/**
	 * Gets the negotiation counts for the shift swap items in the request.  First Count is for the first item.
	 * The second count is for the second item.
	 */
	public static Pair&lt;Integer, Integer&gt; getNegotiationCounts(Localizer localizer, ShiftSwapRequest request)
			throws RemoteException, CoreException {
		// logic from ShiftSwapRequestFormPopupPM.addNegotiatioCommentRow
<span class="nc" id="L692">		ID emp1ID = request.getFirstEmployeeID();</span>
<span class="nc" id="L693">		ID emp2ID = request.getSecondEmployeeID();</span>
<span class="nc" id="L694">		int emp1Count = 0;</span>
<span class="nc" id="L695">		int emp2Count = 0;</span>

		// get the &quot;Updated&quot; note string
<span class="nc" id="L698">		String sUpdatedNote = localizer.i18n(RmEjbBundleKey.BUNDLE_NAME, RmEjbBundleKey.UPDATED);</span>

<span class="nc" id="L700">		Map&lt;ID, User&gt; userMap = RequestsMH.getUserMapForRequest(request);</span>
<span class="nc" id="L701">		Collection&lt;RequestAuditTrail&gt; auditTrails = request.getAuditTrail();</span>

<span class="nc bnc" id="L703" title="All 2 branches missed.">		for (RequestAuditTrail rat : auditTrails) {</span>
<span class="nc" id="L704">			User user = userMap.get(rat.getBpUserId());</span>
<span class="nc bnc" id="L705" title="All 4 branches missed.">			if (rat.getNote().equals(sUpdatedNote) &amp;&amp; user != null) {</span>
				// It seems like this old logic won't work once these are properly localized
<span class="nc" id="L707">				ID employeeID = user.getEmployeeID();</span>
<span class="nc bnc" id="L708" title="All 2 branches missed.">				if (employeeID.equals(emp1ID)) {</span>
<span class="nc" id="L709">					emp1Count++;</span>
<span class="nc bnc" id="L710" title="All 2 branches missed.">				} else if (emp2ID.equals(employeeID)) {</span>
<span class="nc" id="L711">					emp2Count++;</span>
				}
			}
<span class="nc" id="L714">		}</span>
<span class="nc" id="L715">		return new Pair&lt;Integer, Integer&gt;(emp1Count, emp2Count);</span>
	}

	public static boolean isWithdrawalNegotiation(ShiftSwapRequest request) {
<span class="nc bnc" id="L719" title="All 2 branches missed.">		return request.getWithdrawInfo() != null</span>
<span class="nc bnc" id="L720" title="All 2 branches missed.">				&amp;&amp; request.getWithdrawInfo().getRequestStatus().equalsIgnoreCase(RequestAuditTrail.STATUS_WITHDRAW_NEGOTIATION);</span>
	}

	
	//jt

	public static Date getEarliestDateOneWay(boolean isSwapOutPartial, Date swapOutPartialStartDate,
			Date swapOutStartDate) {
		
		Date earliestDate;

<span class="nc bnc" id="L731" title="All 2 branches missed.">		if (isSwapOutPartial) {</span>
<span class="nc" id="L732">			earliestDate = swapOutPartialStartDate;</span>
		} else {
<span class="nc" id="L734">			earliestDate = swapOutStartDate;</span>
		}
		
		
<span class="nc bnc" id="L738" title="All 2 branches missed.">		return earliestDate != null ? earliestDate : new Date();</span>
		
	}

	public static Date getEarliestDateTwoWay(boolean isSwapOutPartial, boolean isSwapInPartial, Date partialSwapOutStartDate,
			Date partialSwapInStartDate, Date swapOutDate, Date swapInDate) {
		Date earliestDate;
<span class="nc bnc" id="L745" title="All 4 branches missed.">		if (!isSwapOutPartial &amp;&amp; !isSwapInPartial) {</span>
<span class="nc" id="L746">			earliestDate = getEarliestDateFull(swapOutDate, swapInDate);</span>
		} else {
<span class="nc" id="L748">			earliestDate = getEarliestDatePartial(isSwapOutPartial,isSwapInPartial, partialSwapOutStartDate,partialSwapInStartDate, swapOutDate, swapInDate);</span>
		}
		
		
<span class="nc bnc" id="L752" title="All 2 branches missed.">		return earliestDate != null ? earliestDate : new Date();</span>
		
	}
	
	
	public static Date getEarliestDateFull(Date swapOut, Date swapIn) {
		// Both request dates should be valid.
<span class="nc bnc" id="L759" title="All 2 branches missed.">		Date date1 = swapOut != null ? swapOut : new Date();</span>
<span class="nc bnc" id="L760" title="All 2 branches missed.">		Date date2 = swapIn != null ? swapIn : new Date();</span>

<span class="nc bnc" id="L762" title="All 2 branches missed.">		if (date1.before(date2)) {</span>
<span class="nc" id="L763">			return date1;</span>
		}
<span class="nc" id="L765">		return date2;</span>
	}
	
	public static Date getEarliestDatePartial(boolean isSwapOutPartial, boolean isSwapInPartial, Date partialSwapOutStartDate,
			Date partialSwapInStartDate, Date swapOutDate, Date swapInDate) {
		//Partials enabled
		Date date1;
		Date date2;

<span class="nc bnc" id="L774" title="All 2 branches missed.">		if (isSwapOutPartial) {</span>
<span class="nc" id="L775">			date1 = partialSwapOutStartDate;</span>
		} else {
<span class="nc" id="L777">			date1 = swapOutDate;</span>
		}

		//What we pickup
<span class="nc bnc" id="L781" title="All 2 branches missed.">		if (isSwapInPartial) {</span>
<span class="nc" id="L782">			date2 = partialSwapInStartDate;</span>
		} else {
<span class="nc" id="L784">			date2 = swapInDate;</span>
		}

<span class="nc bnc" id="L787" title="All 6 branches missed.">		if (date1 != null &amp;&amp; date2 != null &amp;&amp; date1.before(date2)) {</span>
<span class="nc" id="L788">			return date1;</span>
		} else {
<span class="nc" id="L790">			return date2;</span>
		}
	
	}

	public static boolean canSwapWith(ID employeeID, ID employeeID2, Date effectiveDate) {

<span class="nc" id="L797">		RmManagerFactory rmf = RmManagerFactory.getInstance();</span>

		ShiftSwapRequestManager ssrm;
		try {
<span class="nc" id="L801">			ssrm = rmf.getShiftSwapRequestManager();</span>

			@SuppressWarnings(&quot;unchecked&quot;)
<span class="nc" id="L804">			List&lt;Employee&gt; empList = (List&lt;Employee&gt;) ssrm.getEmployeesOneCanSwapWith(employeeID, effectiveDate);</span>
<span class="nc bnc" id="L805" title="All 2 branches missed.">			for (Employee emp : empList) {</span>
<span class="nc bnc" id="L806" title="All 2 branches missed.">				if (emp.getID().equals(employeeID2)) {</span>
<span class="nc" id="L807">					return true;</span>
				}
<span class="nc" id="L809">			}</span>
<span class="nc" id="L810">		} catch (Exception e) {</span>
<span class="nc" id="L811">			LOG.error(e.getMessage(), e);</span>
<span class="nc" id="L812">			return false;</span>
<span class="nc" id="L813">		}</span>

<span class="nc" id="L815">		return false;</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>