<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>QueueAttributeFilterDAO.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.ejb.bbm.workload.ejb</a> &gt; <span class="el_source">QueueAttributeFilterDAO.java</span></div><h1>QueueAttributeFilterDAO.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.ejb.bbm.workload.ejb;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.jdmo.*;
import com.bluepumpkin.ejb.bbm.BbmManagerFactory;
import com.bluepumpkin.ejb.bbm.base.BbmFinderException;
import com.bluepumpkin.ejb.bbm.dao.DAOBase;
import com.bluepumpkin.ejb.bbm.vo.FieldInfo;
import com.bluepumpkin.ejb.bbm.vo.ValueObjectBase;
import com.bluepumpkin.ejb.bbm.workload.model.queueattribute.QueueAttributeFilter;
import com.bluepumpkin.ejb.bbm.workload.model.queueattribute.QueueAttributeFilterFieldInfo;
import com.bluepumpkin.ejb.bbm.workload.model.queueattribute.QueueAttributeFilterSelectedOrganization;
import com.verint.ejb.wfm.WfmManagerFactory;

import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.util.ArrayList;
import java.util.Collection;
import java.util.Collections;

public class QueueAttributeFilterDAO extends DAOBase {

<span class="fc" id="L23">	private static FieldInfo m_fieldInfo = new QueueAttributeFilterFieldInfo();</span>

	protected FieldInfo getFieldInfo() {
<span class="fc" id="L26">		return m_fieldInfo;</span>
	}

	public QueueAttributeFilterDAO() {
<span class="fc" id="L30">		super();</span>
<span class="fc" id="L31">	}</span>

	public QueueAttributeFilterDAO(Jdmo dmo) {
<span class="nc" id="L34">		super(dmo);</span>
<span class="nc" id="L35">	}</span>

	protected ValueObjectBase createValueObject() {
<span class="nc" id="L38">		return new QueueAttributeFilter();</span>
	}

	public Collection&lt;ID&gt; getQueues(QueueAttributeFilter filter, ID campaignID, ID spID) throws BbmFinderException {
		Collection&lt;ID&gt; queueIDs;
		try {
<span class="nc bnc" id="L44" title="All 4 branches missed.">			if (filter == null || filter.getID() == null) {</span>
<span class="nc" id="L45">				throw new BbmFinderException(new NullPointerException(&quot;Filter object is not defined correctly&quot;));</span>
			}

<span class="nc bnc" id="L48" title="All 4 branches missed.">			if (filter.getSelectedOrgs() == null || filter.getSelectedOrgs().isEmpty()) {</span>
<span class="nc" id="L49">				throw new BbmFinderException(new NullPointerException(&quot;No Organizations found in the selected filter&quot;));</span>
			}

<span class="nc" id="L52">			ID filterID = filter.getID();</span>
<span class="nc" id="L53">			JdmoConnection conn = m_dmo.getConnection();</span>
<span class="nc" id="L54">			StringBuilder queryString = new StringBuilder();</span>

<span class="nc" id="L56">			ArrayList&lt;ID&gt; orgIDs = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L57" title="All 2 branches missed.">			for (QueueAttributeFilterSelectedOrganization queueAttributeFilterSelectedOrganization : filter.getSelectedOrgs</span>
<span class="nc" id="L58">				()) {</span>
<span class="nc" id="L59">				orgIDs.add(queueAttributeFilterSelectedOrganization.getQueueAttributeID());</span>
<span class="nc" id="L60">			}</span>

<span class="nc" id="L62">			Collection allOrgsAndParentsToFilter = BbmManagerFactory.getWorkResourceManager().getOrganizationsParentsByIDs</span>
<span class="nc" id="L63">				(orgIDs);</span>
<span class="nc" id="L64">			allOrgsAndParentsToFilter.addAll(orgIDs);</span>

<span class="nc" id="L66">			Collection&lt;ID&gt; rootQueueIDs = null;</span>
<span class="nc bnc" id="L67" title="All 4 branches missed.">			if (filter.isShowRootQueuesOnly() &amp;&amp; spID != null) {</span>
<span class="nc" id="L68">				Collection spOrgIDs = WfmManagerFactory.getCampaignManager().getLinkedOrgsforSP(spID);</span>
<span class="nc" id="L69">				Collection parentOrgs = BbmManagerFactory.getWorkResourceManager().getOrganizationsParentsByIDs(spOrgIDs);</span>
<span class="nc" id="L70">				parentOrgs.addAll(spOrgIDs);</span>
<span class="nc" id="L71">				rootQueueIDs = getRootLinkedAndNonLinkedQueueIDs(parentOrgs);</span>
<span class="nc bnc" id="L72" title="All 2 branches missed.">			} else if (filter.isShowRootQueuesOnly()) {</span>
<span class="nc" id="L73">				rootQueueIDs = getRootLinkedAndNonLinkedQueueIDs(allOrgsAndParentsToFilter);</span>
			}

<span class="nc" id="L76">			queryString.append(&quot;SELECT DISTINCT Q.SID FROM QUEUE Q &quot;);</span>

<span class="nc bnc" id="L78" title="All 4 branches missed.">			if (campaignID != null &amp;&amp; spID == null) {</span>
<span class="nc" id="L79">				queryString.append(&quot; INNER JOIN SPQUEUE SPQ ON Q.ID = SPQ.QUEUEID INNER JOIN SP ON SP.ID = SPQ.SPID INNER &quot; </span>
<span class="nc" id="L80">					+ &quot;JOIN CAMPAIGN C ON SP.CAMPAIGNID = C.ID AND C.SID = &quot;).append(campaignID);</span>

			}

<span class="nc bnc" id="L84" title="All 2 branches missed.">			if (spID != null) {</span>
<span class="nc" id="L85">				queryString.append(&quot; INNER JOIN SPQUEUE SPQ ON Q.ID = SPQ.QUEUEID AND SPID IN (SELECT ID FROM SP WHERE SID &quot; </span>
<span class="nc" id="L86">					+ &quot;= &quot;).append(spID).append(&quot;)&quot;);</span>
			}

<span class="nc bnc" id="L89" title="All 4 branches missed.">			if (filter.getSelectedMedia() != null &amp;&amp; !filter.getSelectedMedia().isEmpty()) {</span>
				//Getting queues of the selected media type one
<span class="nc" id="L91">				queryString.append(&quot; INNER JOIN  QUEUEATTRIBFILTERMEDIA SM ON Q.MEDIAID = SM.MEDIAID AND SM&quot; </span>
<span class="nc" id="L92">					+ &quot;.QUEUEATTRIBUTEFILTERID = &quot;).append(filterID);</span>
			}

<span class="nc bnc" id="L95" title="All 4 branches missed.">			if (filter.getTextValues() != null &amp;&amp; !filter.getTextValues().isEmpty()) {</span>
				//Getting the queues with the user specified text values only
<span class="nc" id="L97">				queryString.append(&quot; INNER JOIN QUEUEATTRIBUTEPAIRVALUETEXT PTEXT ON PTEXT.QUEUEID = Q.SID&quot;);</span>
<span class="nc" id="L98">				queryString.append(&quot; AND PTEXT.QUEUEID in (SELECT PTEXT1.QUEUEID FROM QUEUEATTRIBUTEPAIRVALUETEXT PTEXT1 &quot;);</span>
<span class="nc" id="L99">				queryString.append(&quot; INNER JOIN QUEUEATTRIBFILTERSELTEXT STEXT ON PTEXT1.VALUE LIKE '%' + STEXT&quot; </span>
					+ &quot;.SELECTEDVALUE + '%'&quot;);
<span class="nc" id="L101">				queryString.append(&quot; AND PTEXT1.QUEUEATTRIBUTEID = STEXT.QUEUEATTRIBUTEID AND STEXT.QUEUEATTRIBUTEFILTERID &quot; </span>
<span class="nc" id="L102">					+ &quot;= &quot;).append(filterID);</span>
<span class="nc" id="L103">				queryString.append(&quot; GROUP BY PTEXT1.QUEUEID HAVING COUNT(PTEXT1.ID) = (select COUNT(ID) From &quot; </span>
<span class="nc" id="L104">					+ &quot;QUEUEATTRIBFILTERSELTEXT where QUEUEATTRIBUTEFILTERID = &quot;).append(filterID).append(&quot; ))&quot;);</span>
			}

<span class="nc bnc" id="L107" title="All 4 branches missed.">			if (filter.getNumericValues() != null &amp;&amp; !filter.getNumericValues().isEmpty()) {</span>
				//Getting the queues with the user specified numeric values only
<span class="nc" id="L109">				queryString.append(&quot; INNER JOIN QUEUEATTRIBUTEPAIRVALUENUM PNUMERIC ON PNUMERIC.QUEUEID = Q.SID &quot;);</span>
<span class="nc" id="L110">				queryString.append(&quot; AND PNUMERIC.QUEUEID IN (SELECT PNUMERIC1.QUEUEID FROM QUEUEATTRIBUTEPAIRVALUENUM &quot; </span>
					+ &quot;PNUMERIC1&quot;);
<span class="nc" id="L112">				queryString.append(&quot; INNER JOIN QUEUEATTRIBFILTERSELNUMERIC SNUMERIC ON PNUMERIC1.VALUE BETWEEN SNUMERIC&quot; </span>
					+ &quot;.SELECTEDVALUESTART AND SNUMERIC.SELECTEDVALUEEND&quot;);
<span class="nc" id="L114">				queryString.append(&quot; AND PNUMERIC1.QUEUEATTRIBUTEID = SNUMERIC.QUEUEATTRIBUTEID AND SNUMERIC&quot; </span>
<span class="nc" id="L115">					+ &quot;.QUEUEATTRIBUTEFILTERID = &quot;).append(filterID);</span>
<span class="nc" id="L116">				queryString.append(&quot; GROUP BY PNUMERIC1.QUEUEID HAVING COUNT(PNUMERIC1.ID) = (SELECT COUNT(ID) FROM &quot; </span>
<span class="nc" id="L117">					+ &quot;QUEUEATTRIBFILTERSELNUMERIC WHERE QUEUEATTRIBUTEFILTERID = &quot;).append(filterID).append(&quot; ))&quot;);</span>
			}

<span class="nc bnc" id="L120" title="All 4 branches missed.">			if (filter.getDateValues() != null &amp;&amp; !filter.getDateValues().isEmpty()) {</span>
				//Getting the queues with the user specified date values only
<span class="nc" id="L122">				queryString.append(&quot; INNER JOIN QUEUEATTRIBUTEPAIRVALUEDATE PDATE ON PDATE.QUEUEID = Q.SID&quot;);</span>
<span class="nc" id="L123">				queryString.append(&quot; AND PDATE.QUEUEID IN (SELECT PDATE1.QUEUEID FROM QUEUEATTRIBUTEPAIRVALUEDATE PDATE1&quot;);</span>
<span class="nc" id="L124">				queryString.append(&quot; INNER JOIN QUEUEATTRIBFILTERSELDATE SDATE ON PDATE1.VALUE BETWEEN SDATE&quot; </span>
					+ &quot;.SELECTEDVALUESTART AND SDATE.SELECTEDVALUEEND&quot;);
<span class="nc" id="L126">				queryString.append(&quot; AND PDATE1.QUEUEATTRIBUTEID = SDATE.QUEUEATTRIBUTEID &quot;);</span>
<span class="nc" id="L127">				queryString.append(&quot; AND SDATE.QUEUEATTRIBUTEFILTERID = &quot;).append(filterID);</span>
<span class="nc" id="L128">				queryString.append(&quot; GROUP BY PDATE1.QUEUEID HAVING COUNT(PDATE1.ID) = (SELECT COUNT(ID) FROM &quot; </span>
<span class="nc" id="L129">					+ &quot;QUEUEATTRIBFILTERSELDATE WHERE QUEUEATTRIBUTEFILTERID = &quot;).append(filterID).append(&quot; ))&quot;);</span>
			}

<span class="nc bnc" id="L132" title="All 4 branches missed.">			if (filter.getDropDownValues() != null &amp;&amp; !filter.getDropDownValues().isEmpty()) {</span>
				//Getting the queues with the user specified drop down values only
				//For Drop Down values, there is a bug that the selection condition is acting like an OR rather than AND
				//Create Queue Attribute

				//1. DD1 as drop down list add value as A and B
				//2. DD2 as drop down list add value as C and D

				//Then assigned to queue as
				//Q1:DD1 = A and DD2 = C
				//Q2:DD1 = B and DD2 = D

				//Filter with DD1 as A and DD2 as D
				//Earlier was showing both Q1 and Q2. But ideally no queue should appear 
				//as Q1 and Q2 both don't qualify the filter criteria


<span class="nc" id="L149">				queryString.append(&quot; INNER JOIN QUEUEATTRIBUTEPAIRVALUEDD PDD ON PDD.QUEUEID = Q.SID  AND PDD.QUEUEID IN &quot; </span>
					+ &quot;(&quot;);
<span class="nc" id="L151">				queryString.append(&quot; SELECT PDD.QUEUEID FROM QUEUEATTRIBUTEPAIRVALUEDD PDD &quot;);</span>
<span class="nc" id="L152">				queryString.append(&quot; INNER JOIN QUEUEATTRIBFILTERSELDD SDD on SDD.QUEUEATTRIBUTEID = PDD.QUEUEATTRIBUTEID &quot; </span>
					+ &quot;AND PDD.VALUE = SDD.SELECTEDVALUE &quot;);
<span class="nc" id="L154">				queryString.append(&quot; WHERE SDD.QUEUEATTRIBUTEFILTERID = &quot;).append(filterID);</span>
<span class="nc" id="L155">				queryString.append(&quot; GROUP by PDD.QUEUEID&quot;);</span>
<span class="nc" id="L156">				queryString.append(&quot; HAVING COUNT(PDD.ID) = (select COUNT(ID) From QUEUEATTRIBFILTERSELDD where &quot; </span>
<span class="nc" id="L157">					+ &quot;QUEUEATTRIBUTEFILTERID = &quot;).append(filterID).append(&quot; ))&quot;);</span>
			}

<span class="nc bnc" id="L160" title="All 4 branches missed.">			if (filter.getBooleanValues() != null &amp;&amp; !filter.getBooleanValues().isEmpty()) {</span>
				//Getting the queues with the user specified boolean values only
<span class="nc" id="L162">				queryString.append(&quot; INNER JOIN QUEUEATTRIBPAIRVALUEBOOL PBOOL ON PBOOL.QUEUEID = Q.SID&quot;);</span>
<span class="nc" id="L163">				queryString.append(&quot; INNER JOIN QUEUEATTRIBFILTERSELBOOL SBOOL ON PBOOL.VALUE = SBOOL.SELECTEDVALUE AND &quot; </span>
					+ &quot;PBOOL.QUEUEATTRIBUTEID = SBOOL.QUEUEATTRIBUTEID AND SBOOL.QUEUEATTRIBUTEFILTERID = &quot;).append
<span class="nc" id="L165">					(filterID);</span>
			}

<span class="nc" id="L168">			queryString.append(&quot; WHERE Q.ORGANIZATIONID IN &quot;).append(m_dmo.createInClause(allOrgsAndParentsToFilter));</span>

<span class="nc" id="L170">			PreparedStatement pstmt = conn.prepareStatement(queryString.toString());</span>

<span class="nc" id="L172">			ResultSet r = pstmt.executeQuery();</span>
<span class="nc" id="L173">			queueIDs = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L174" title="All 2 branches missed.">			while (r.next()) {</span>
<span class="nc" id="L175">				ID qID = new ID(r.getInt(1));</span>
<span class="nc bnc" id="L176" title="All 2 branches missed.">				if (filter.isShowRootQueuesOnly()) {</span>
<span class="nc bnc" id="L177" title="All 4 branches missed.">					if (rootQueueIDs != null &amp;&amp; rootQueueIDs.contains(qID)) {</span>
<span class="nc" id="L178">						queueIDs.add(qID);</span>
					}
				} else {
<span class="nc" id="L181">					queueIDs.add(qID);</span>
				}
<span class="nc" id="L183">			}</span>
<span class="nc" id="L184">			return queueIDs;</span>
<span class="nc" id="L185">		} catch (Exception e) {</span>
<span class="nc" id="L186">			e.printStackTrace();</span>
<span class="nc" id="L187">			throw new BbmFinderException(e);</span>
		}
	}

	/**
	 * Takes the user ID and the orgs in scope for that user and returns the named filter which matches the criteria.
	 *
	 * @param userID        - User for whom the Named Filter list needs to be published
	 * @param orgIDsInScope - Collection of IDs of the Orgs which the user has permission
	 * @return
	 * @throws BbmFinderException
	 */
	public Collection getQueueAttributeFiltersForUser(ID userID, Collection orgIDsInScope) throws BbmFinderException {
<span class="pc bpc" id="L200" title="1 of 2 branches missed.">		if (userID == null) {</span>
<span class="nc" id="L201">			return Collections.emptyList();</span>
		}
<span class="pc bpc" id="L203" title="2 of 4 branches missed.">		if (orgIDsInScope == null || orgIDsInScope.isEmpty()) {</span>
<span class="nc" id="L204">			return Collections.emptyList();</span>
		}
<span class="fc" id="L206">		StringBuilder query = new StringBuilder(&quot;&quot;);</span>
		try {
<span class="fc" id="L208">			query.append(&quot; SELECT DISTINCT ID, NAME, ISPUBLIC, USERID, SHOWROOTQUEUESONLY FROM QUEUEATTRIBUTEFILTER, &quot;);</span>
<span class="fc" id="L209">			query.append(&quot; (SELECT QUEUEATTRIBUTEFILTERID NFID, COUNT(*) AS REC FROM QUEUEATTRIBFILTERSELORGS&quot;);</span>
<span class="fc" id="L210">			query.append(&quot; WHERE ORGANIZATIONID IN &quot;).append(m_dmo.createInClause(orgIDsInScope));</span>
<span class="fc" id="L211">			query.append(&quot; GROUP BY QUEUEATTRIBUTEFILTERID) X&quot;);</span>
<span class="fc" id="L212">			query.append(&quot; WHERE (X.NFID = ID AND REC = (SELECT COUNT(*) FROM QUEUEATTRIBFILTERSELORGS WHERE &quot; </span>
				+ &quot;QUEUEATTRIBUTEFILTERID = X.NFID))&quot;);
<span class="fc" id="L214">			query.append(&quot; AND (ISPUBLIC = 1 OR USERID = &quot;).append(userID.toString()).append(&quot;) ORDER BY NAME&quot;);</span>
<span class="nc" id="L215">		} catch (JdmoException e1) {</span>
<span class="nc" id="L216">			e1.printStackTrace();</span>
<span class="nc" id="L217">			throw new BbmFinderException(e1);</span>
<span class="fc" id="L218">		}</span>

<span class="fc" id="L220">		ArrayList&lt;QueueAttributeFilter&gt; filters = new ArrayList&lt;&gt;();</span>
		try {
<span class="fc" id="L222">			JdmoRowset r = m_dmo.createRowset(query.toString());</span>
<span class="pc bpc" id="L223" title="1 of 2 branches missed.">			while (r.next()) {</span>
<span class="nc" id="L224">				QueueAttributeFilter filter = new QueueAttributeFilter();</span>
<span class="nc" id="L225">				filter.setID(r.getID(&quot;ID&quot;));</span>
<span class="nc" id="L226">				filter.setName(r.getString(&quot;NAME&quot;));</span>
<span class="nc" id="L227">				filter.setUserID(r.getID(&quot;USERID&quot;));</span>
<span class="nc" id="L228">				filter.setIsPublic(r.getBoolean(&quot;ISPUBLIC&quot;));</span>
<span class="nc" id="L229">				filter.setIsShowRootQueuesOnly(r.getBoolean(&quot;SHOWROOTQUEUESONLY&quot;));</span>
<span class="nc" id="L230">				filters.add(filter);</span>
<span class="nc" id="L231">			}</span>
<span class="nc" id="L232">		} catch (JdmoException e) {</span>
<span class="nc" id="L233">			e.printStackTrace();</span>
<span class="nc" id="L234">			throw new BbmFinderException(e);</span>
<span class="fc" id="L235">		}</span>
<span class="fc" id="L236">		return filters;</span>
	}

	public Collection&lt;String&gt; getQueueAttributeFilterNames() throws BbmFinderException {
<span class="nc" id="L240">		ArrayList&lt;String&gt; filterNames = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L241">		StringBuilder query = new StringBuilder(&quot;&quot;);</span>
<span class="nc" id="L242">		query.append(&quot;SELECT NAME FROM QUEUEATTRIBUTEFILTER&quot;);</span>

		try {
<span class="nc" id="L245">			JdmoRowset r = m_dmo.createRowset(query.toString());</span>
<span class="nc bnc" id="L246" title="All 2 branches missed.">			while (r.next()) {</span>
<span class="nc" id="L247">				filterNames.add(r.getString(&quot;NAME&quot;));</span>
			}
<span class="nc" id="L249">		} catch (JdmoException e) {</span>
<span class="nc" id="L250">			e.printStackTrace();</span>
<span class="nc" id="L251">			throw new BbmFinderException(e);</span>
<span class="nc" id="L252">		}</span>
<span class="nc" id="L253">		return filterNames;</span>
	}

	public static Collection&lt;ID&gt; getRootLinkQueueIDs(Collection&lt;QueueAttributeFilterSelectedOrganization&gt; organizationID) 
		throws JdmoException {
<span class="nc" id="L258">		Jdmo jdmo = new Jdmo();</span>
		try {
<span class="nc" id="L260">			ArrayList&lt;ID&gt; orgIDs = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L261" title="All 2 branches missed.">			for (QueueAttributeFilterSelectedOrganization anOrganizationID : organizationID) {</span>
<span class="nc" id="L262">				orgIDs.add(anOrganizationID.getQueueAttributeID());</span>
<span class="nc" id="L263">			}</span>
<span class="nc" id="L264">			String pStmt = &quot;SELECT	DISTINCT Q.SID FROM VCTCHAIN VC, VCTCHAINQUEUE VCQ, &quot; +</span>
				&quot;VCTQUEUECONFIGURATION VQC, QUEUE Q, QUEUE Q2,  &quot; +
				&quot;VCTQUEUECONFIGURATION VQC2, MEDIA M &quot; +
				&quot;WHERE VCQ.VCTCHAINID = VC.ID &quot; +
				&quot;AND M.ID = Q.MEDIAID AND VQC.ID = VC.VCTQUEUECONFIGURATIONID &quot; +
				&quot;AND VQC.QUEUEID = Q.SID  &quot; +
<span class="nc" id="L270">				&quot;AND Q.ORGANIZATIONID IN &quot; + jdmo.createInClause(orgIDs) +</span>
				&quot; AND ISMULTISELECT = 0 AND &quot; +
				&quot;Q2.SID = VCQ.QUEUEID AND VQC2.QUEUEID = VCQ.QUEUEID &quot; +
				&quot;AND ((VC.TARGETEVENT = 1) OR &quot; +
				&quot;(VC.TARGETEVENT = 3 AND VQC2.COLLECTIONTYPE = 3)) &quot; +
				&quot;AND VQC.QUEUEID NOT IN (SELECT QUEUEID FROM VCTCHAINQUEUE) &quot;;

<span class="nc" id="L277">			ArrayList&lt;ID&gt; queueIDs = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L278">			JdmoQuery jq = jdmo.createQuery(pStmt, Jdmo.PARAM_QUERY);</span>
<span class="nc" id="L279">			JdmoRowset rs = jdmo.createRowset(jq, Jdmo.FORWARD_ONLY, Jdmo.READ_ONLY);</span>
<span class="nc bnc" id="L280" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L281">				queueIDs.add(rs.getID(1));</span>
			}
<span class="nc" id="L283">			return queueIDs;</span>
		} finally {
<span class="nc" id="L285">			jdmo.cleanUp();</span>
		}
	}

	public static Collection getRootLinkedAndNonLinkedQueueIDs(Collection orgIDs) throws JdmoException {
<span class="nc" id="L290">		Jdmo jdmo = new Jdmo();</span>
		try {
<span class="nc" id="L292">			String pStmt = &quot;SELECT SID FROM QUEUE Q WHERE Q.ORGANIZATIONID IN &quot; + jdmo.createInClause(orgIDs) +</span>
				&quot; AND Q.SID NOT IN (SELECT QUEUEID FROM VCTCHAINQUEUE)&quot;;

<span class="nc" id="L295">			ArrayList&lt;ID&gt; queueIDs = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L296">			JdmoQuery jq = jdmo.createQuery(pStmt, Jdmo.PARAM_QUERY);</span>
<span class="nc" id="L297">			JdmoRowset rs = jdmo.createRowset(jq, Jdmo.FORWARD_ONLY, Jdmo.READ_ONLY);</span>
<span class="nc bnc" id="L298" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L299">				queueIDs.add(rs.getID(1));</span>
			}
<span class="nc" id="L301">			return queueIDs;</span>
		} finally {
<span class="nc" id="L303">			jdmo.cleanUp();</span>
		}
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>