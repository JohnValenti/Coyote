<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>BundleValidator.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.verint.web.core.l10n</a> &gt; <span class="el_source">BundleValidator.java</span></div><h1>BundleValidator.java</h1><pre class="source lang-java linenums">/*
 * (c) 2011 Verint Systems, Inc.
 */
package com.verint.web.core.l10n;

import java.awt.BorderLayout;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.io.BufferedReader;
import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileReader;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

import javax.swing.Box;
import javax.swing.BoxLayout;
import javax.swing.JButton;
import javax.swing.JFileChooser;
import javax.swing.JFrame;
import javax.swing.JPanel;
import javax.swing.JTextArea;
import javax.swing.JTextField;
import javax.swing.SwingUtilities;
import javax.swing.filechooser.FileNameExtensionFilter;

/**
 * A simple interactive tool that checks bundle files for characters that would
 * break the pseudo-localization process.
 */
<span class="nc" id="L32">public class BundleValidator {</span>

	private JFrame m_mainFrame;
	private JTextField m_filePathField;
	private JTextArea m_issuesDisplay;
<span class="nc" id="L37">	private JFileChooser m_fileChooser = null;</span>

	protected void launchUI() {
<span class="nc" id="L40">		m_mainFrame = new JFrame();</span>
<span class="nc" id="L41">		m_filePathField = new JTextField();</span>
<span class="nc" id="L42">		JButton chooseFileButton = new JButton(&quot;Browse&quot;);</span>
<span class="nc" id="L43">		chooseFileButton.addActionListener(new ActionListener() {</span>
			@Override
			public void actionPerformed(ActionEvent e) {
<span class="nc" id="L46">				chooseFile();</span>
<span class="nc" id="L47">			}});</span>
<span class="nc" id="L48">		JButton scanFileButton = new JButton(&quot;Scan&quot;);</span>
<span class="nc" id="L49">		scanFileButton.addActionListener(new ActionListener() {</span>
			@Override
			public void actionPerformed(ActionEvent e) {
<span class="nc" id="L52">				String fileName = m_filePathField.getText().trim();</span>
<span class="nc bnc" id="L53" title="All 2 branches missed.">				if (!fileName.isEmpty()) {</span>
<span class="nc" id="L54">					displayIssues(scanFile(fileName));</span>
				}
<span class="nc" id="L56">			}</span>
		});
<span class="nc" id="L58">		m_issuesDisplay = new JTextArea(&quot;Select a file to scan, then press the 'Scan' button.&quot;);</span>
<span class="nc" id="L59">		m_mainFrame.add(m_issuesDisplay, BorderLayout.CENTER);</span>
<span class="nc" id="L60">		JPanel bottomControls = new JPanel();</span>
<span class="nc" id="L61">		bottomControls.setLayout(new BoxLayout(bottomControls, BoxLayout.X_AXIS));</span>
<span class="nc" id="L62">		bottomControls.add(Box.createHorizontalStrut(5));</span>
<span class="nc" id="L63">		bottomControls.add(m_filePathField);</span>
<span class="nc" id="L64">		bottomControls.add(Box.createHorizontalStrut(5));</span>
<span class="nc" id="L65">		bottomControls.add(chooseFileButton);</span>
<span class="nc" id="L66">		bottomControls.add(Box.createHorizontalStrut(5));</span>
<span class="nc" id="L67">		bottomControls.add(scanFileButton);</span>
<span class="nc" id="L68">		bottomControls.add(Box.createHorizontalStrut(5));</span>
<span class="nc" id="L69">		m_mainFrame.add(bottomControls, BorderLayout.SOUTH);</span>
<span class="nc" id="L70">		m_mainFrame.pack();</span>
<span class="nc" id="L71">		m_mainFrame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</span>
<span class="nc" id="L72">		m_mainFrame.setVisible(true);</span>
<span class="nc" id="L73">	}</span>

	/**
	 * Allow the user to select a file.
	 */
	private void chooseFile() {
<span class="nc" id="L79">		JFileChooser chooser = getFileChooser();</span>
<span class="nc bnc" id="L80" title="All 2 branches missed.">		if (chooser.showOpenDialog(m_mainFrame) == JFileChooser.APPROVE_OPTION) {</span>
<span class="nc" id="L81">			m_filePathField.setText(chooser.getSelectedFile().getAbsolutePath());</span>
<span class="nc" id="L82">			m_issuesDisplay.setText(&quot;Press 'Scan' to scan this file.&quot;);</span>
		}
<span class="nc" id="L84">	}</span>

	private JFileChooser getFileChooser() {
<span class="nc bnc" id="L87" title="All 2 branches missed.">		if (m_fileChooser == null) {</span>
<span class="nc" id="L88">			m_fileChooser = new JFileChooser();</span>
<span class="nc" id="L89">			m_fileChooser.setCurrentDirectory(new File(System.getProperty(&quot;user.dir&quot;)));</span>
<span class="nc" id="L90">			m_fileChooser.setFileFilter(new FileNameExtensionFilter(&quot;Java source files&quot;, &quot;java&quot;));</span>
		}
<span class="nc" id="L92">		return m_fileChooser;</span>
	}

	/**
	 * Scan the specified file for characters greater than ASCII 127.
	 * 
	 * @param fileName
	 * @return a summary of the issues found in the file.
	 */
	private List&lt;String&gt; scanFile(String fileName) {
<span class="nc" id="L102">		List&lt;String&gt; status = new ArrayList&lt;String&gt;();</span>
<span class="nc" id="L103">		BufferedReader reader = null;</span>
		try {
<span class="nc" id="L105">			reader = new BufferedReader(new FileReader(fileName));</span>
<span class="nc" id="L106">		} catch (FileNotFoundException fnfe) {</span>
<span class="nc" id="L107">			status.add(&quot;File not found.&quot;);</span>
<span class="nc" id="L108">			return status;</span>
<span class="nc" id="L109">		}</span>
<span class="nc bnc" id="L110" title="All 2 branches missed.">		if (reader != null) {</span>
			try {
<span class="nc" id="L112">				int errorCount = 0;</span>
<span class="nc" id="L113">				int lineNumber = 0;</span>
				String line;
<span class="nc bnc" id="L115" title="All 2 branches missed.">				while ((line = reader.readLine()) != null) {</span>
<span class="nc bnc" id="L116" title="All 2 branches missed.">					for (int charIndex = 0; charIndex &lt; line.length(); ++charIndex) {</span>
<span class="nc bnc" id="L117" title="All 2 branches missed.">						if (line.charAt(charIndex) &gt; 127) {</span>
<span class="nc" id="L118">							status.add(&quot;Invalid character &quot; + line.charAt(charIndex) + &quot; at line &quot; + lineNumber + &quot;, column &quot; + charIndex);</span>
<span class="nc" id="L119">							errorCount++;</span>
						}
					}
<span class="nc" id="L122">					++lineNumber;</span>
				}
<span class="nc" id="L124">				status.add(lineNumber + &quot; lines scanned, &quot; + errorCount + &quot; errors found.&quot;);</span>
			}
<span class="nc" id="L126">			catch (IOException ioe) {</span>
<span class="nc" id="L127">				ioe.printStackTrace();</span>
<span class="nc" id="L128">			}</span>
		}
<span class="nc" id="L130">		return status;</span>
	}

	/**
	 * Display the specified list of strings in this application's main text area.
	 * 
	 * @param issues
	 */
	private void displayIssues(List&lt;String&gt; issues) {
<span class="nc" id="L139">		m_issuesDisplay.setText(&quot;&quot;);</span>
<span class="nc" id="L140">		StringBuffer issuesText = new StringBuffer();</span>
<span class="nc bnc" id="L141" title="All 2 branches missed.">		for (String issue : issues) {</span>
<span class="nc" id="L142">			issuesText.append(issue);</span>
<span class="nc" id="L143">			issuesText.append(&quot;\n&quot;);</span>
<span class="nc" id="L144">		}</span>
<span class="nc" id="L145">		m_issuesDisplay.setText(issuesText.toString());</span>
<span class="nc" id="L146">	}</span>

	public static void main(String[] args) {
<span class="nc" id="L149">		SwingUtilities.invokeLater(new Runnable() {</span>
			public void run() {
<span class="nc" id="L151">				BundleValidator validator = new BundleValidator();</span>
<span class="nc" id="L152">				validator.launchUI();</span>
<span class="nc" id="L153">			}</span>
			
		});
<span class="nc" id="L156">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>