<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>LogHistoryModel.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.am.timecollection</a> &gt; <span class="el_source">LogHistoryModel.java</span></div><h1>LogHistoryModel.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.am.timecollection;

import java.text.DateFormat;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.Date;
import java.util.HashMap;
import java.util.List;
import java.util.ResourceBundle;
import java.util.TimeZone;

import javax.servlet.http.HttpServletRequest;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.l10n.RegionalFormatBundleKey;
import com.bluepumpkin.common.logging.Category;
import com.bluepumpkin.common.util.HtmlEncoder;
import com.bluepumpkin.common.util.StringUtil;
import com.bluepumpkin.ejb.bbm.activity.model.Activity;
import com.bluepumpkin.ejb.bbm.timerecord.model.TimeRecord;
import com.bluepumpkin.ejb.bbm.timerecord.model.TimeRecordEntry;
import com.bluepumpkin.ejb.bbm.workresource.model.Employee;
import com.bluepumpkin.web.am.Log;
import com.bluepumpkin.web.am.keys.AmJavaScriptFileID;
import com.bluepumpkin.web.am.l10n.AmWebBundleKey;
import com.bluepumpkin.web.am.l10n.AmWebLogBundleKey;
import com.bluepumpkin.web.am.timerecords.TimeRecordUtil;
import com.bluepumpkin.web.bbm.employee.EmployeeModelHandler;
import com.witness.ejb.core.security.model.User;
import com.witness.web.uif.base.Message;
import com.witness.web.uif.jsp.HtmlButton;
import com.witness.web.uif.jsp.HtmlDiv;
import com.witness.web.uif.jsp.HtmlImage;
import com.witness.web.uif.jsp.HtmlTableCell;
import com.witness.web.uif.keys.ImageFileID;
import com.witness.web.uif.keys.JavaScriptFileID;
import com.witness.web.uif.l10n.UIFWebBundleKey;
import com.witness.web.uif.pagecomponent.BaseNodeData;
import com.witness.web.uif.pagecomponent.DefaultMultiColumnNodeData;
import com.witness.web.uif.pagecomponent.list.MultiColListPC;
import com.witness.web.uif.pagecomponent.picker.date.DateRangePickerPC;
import com.witness.web.uif.pagemodel.PageModel;
import com.witness.web.uif.pagemodel.WorkpaneListPageModel;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.util.HtmlUtil;
import com.witness.web.uif.util.js.JSUtil;
/**
 * Title:        Blue Pumpkin Software Activity Management
 * Description:  Log History page model
 * Copyright:    Copyright (c) 2001
 * Company:      Blue Pumpkin Software, inc
 * @author       Swati Tewari
 * @version      1.0
 */

public class LogHistoryModel extends WorkpaneListPageModel{
<span class="fc" id="L57">	private static Category log = Log.initCategory(LogHistoryModel.class.getName());</span>

	public static final String TIME = &quot;TIME&quot;;
	public static final String ACTIVITY_CATEGORY = &quot;ACTIVITY_CATEGORY&quot;;
	public static final String ACTIVITY = &quot;ACTIVITY&quot;;
	public static final String DURATION = &quot;DURATION&quot;;
	public static final String NOTES = &quot;NOTES&quot;;
	public static final String DATA_RANGE_FN = &quot;dateRange&quot;;

	private int startYear;
	private int startMonth;
	private int startDay;
	private int endYear;
	private int endMonth;
	private int endDay;
	private ID empId;
	private boolean needStatus;
	private boolean needNotes;
	//private ArrayList myTimeEvent = new ArrayList();
	private ResourceBundle m_amBundle;
<span class="nc" id="L77">	private boolean m_bInitialized = false;</span>
	private DateRangePickerPC m_drPicker;

	public static final String MODEL_KEY = &quot;LogHistoryModel&quot;;
	/**
	* Default constructor.
	*/
	public LogHistoryModel(RequestContext context) {
<span class="nc" id="L85">		super(context, PageModel.BASIC_MODEL);</span>
<span class="nc" id="L86">		m_context = context;</span>
<span class="nc" id="L87">		m_amBundle = m_localizer.getBundle(AmWebBundleKey.BUNDLE_NAME);</span>
		// setup default before extracting from the url
<span class="nc" id="L89">		Calendar aCalendar = getCalendar();</span>
<span class="nc" id="L90">		startYear = aCalendar.get(Calendar.YEAR);</span>
<span class="nc" id="L91">		startMonth = aCalendar.get(Calendar.MONTH);</span>
<span class="nc" id="L92">		startDay = aCalendar.get(Calendar.DAY_OF_MONTH);</span>
		//aCalendar.add(Calendar.DATE,1);
<span class="nc" id="L94">		endYear = aCalendar.get(Calendar.YEAR);</span>
<span class="nc" id="L95">		endMonth = aCalendar.get(Calendar.MONTH);</span>
<span class="nc" id="L96">		endDay = aCalendar.get(Calendar.DAY_OF_MONTH);</span>

		//--- Add Date Rnage Picker
<span class="nc" id="L99">		m_drPicker = new DateRangePickerPC(context, DATA_RANGE_FN);</span>
<span class="nc" id="L100">		addChildComponent(m_drPicker);</span>

<span class="nc" id="L102">		m_drPicker.getStartDatePickerPC().setIsDateValueOptional(false);</span>
<span class="nc" id="L103">		m_drPicker.getEndDatePickerPC().setIsDateValueOptional(false);</span>

<span class="nc" id="L105">		extractParameters(context.getRequest());</span>
<span class="nc" id="L106">		initList();</span>
<span class="nc" id="L107">		getToolbar().getComponentTable().setHeight(&quot;25&quot;);</span>

		// Component specific required JavaScript Files
<span class="nc" id="L110">		addRequiredJavaScriptFile(JavaScriptFileID.MEDIATOR_WORKPANE);</span>
<span class="nc" id="L111">		setJSMediator(AmJavaScriptFileID.MEDIATOR_MYTIME_LOGHISTORY);</span>
<span class="nc" id="L112">		addJSVariable(&quot;dateRangeMsg&quot;, m_amBundle, AmWebBundleKey.MSG_DATERANGE);</span>

<span class="nc" id="L114">		setName(&quot;logHistory&quot;);</span>
<span class="nc" id="L115">	}</span>

	public static LogHistoryModel getInstance(RequestContext context)throws Exception{
<span class="nc" id="L118">		LogHistoryModel model = (LogHistoryModel) context.getAttribute(RequestContext.REQUEST_SCOPE,</span>
							LogHistoryModel.MODEL_KEY);
<span class="nc bnc" id="L120" title="All 2 branches missed.">		if (model==null){</span>
			//create a new model
<span class="nc" id="L122">			model = new LogHistoryModel(context);</span>
			// Cache model
<span class="nc" id="L124">			context.setAttribute(RequestContext.REQUEST_SCOPE, LogHistoryModel.MODEL_KEY, model);</span>
		}
<span class="nc" id="L126">		model.populateModel(context);</span>
<span class="nc" id="L127">		return model;</span>
	}

	/**
	* populateModel
	*
	* Populate required data to be rendered
	*/
	public void populateModel(RequestContext context) {
<span class="nc bnc" id="L136" title="All 2 branches missed.">		if ( m_bInitialized )</span>
<span class="nc" id="L137">			return;</span>
		try {
<span class="nc" id="L139">			User aUser = context.getUser();</span>
<span class="nc" id="L140">			setEmpId(aUser.getEmployeeID());</span>
			try {
<span class="nc" id="L142">				setNeedNotes(true);</span>
<span class="nc" id="L143">				ArrayList myTimeEvent = MyTimeModelHandler.getLogHistoryForPeriod(this);</span>
<span class="nc" id="L144">				m_list.setListModel(createListModel(myTimeEvent));</span>
<span class="nc" id="L145">			} catch ( Exception e ) {</span>
<span class="nc" id="L146">				log.l7dError(AmWebLogBundleKey.MSG_ERROR_UNABLETOLOADDATA, e);</span>
<span class="nc" id="L147">				addPageMessage(Message.ERROR_TYPE,</span>
															AmWebBundleKey.MSG_ERROR_UNABLETOLOADDATA,
															AmWebBundleKey.BUNDLE_NAME);
<span class="nc" id="L150">			}</span>
<span class="nc" id="L151">		} catch (Exception e){</span>
<span class="nc" id="L152">			addPageMessage(Message.ERROR_TYPE,</span>
					AmWebBundleKey.MSG_NEEDEMPID, AmWebBundleKey.BUNDLE_NAME);
<span class="nc" id="L154">			System.out.println(e.getMessage());</span>
<span class="nc" id="L155">		}</span>
<span class="nc" id="L156">		initContentTitle(context);</span>
<span class="nc" id="L157">		m_bInitialized = true;</span>
<span class="nc" id="L158">	}</span>

	/**
	* Return Date Range UI
	*/
	private String getDateRangeUI() {
<span class="nc" id="L164">		m_drPicker.getStartDatePickerPC().setDate(getStartDate());</span>
<span class="nc" id="L165">		m_drPicker.getEndDatePickerPC().setDate(getEndDate());</span>
<span class="nc" id="L166">		m_drPicker.setOnChangeJS(JSUtil.ON_CHANGE);</span>
<span class="nc" id="L167">		m_drPicker.initForDisplay();</span>
<span class="nc" id="L168">		return m_drPicker.getHtmlDisplay();</span>
	}

	/**
	 * Initialize List
	 */
	protected void initList() {
		// Set up mediator
		//m_list.setJSMediator(AmJavaScriptFileID.MEDIATOR_MYTIME_LOGHISTORY);

		// Set up Headers
<span class="nc" id="L179">		m_list.getHeader().addColumnHeaderData(TIME,</span>
<span class="nc" id="L180">			i18n(m_amBundle, AmWebBundleKey.TIME));</span>
<span class="nc" id="L181">		m_list.getHeader().addColumnHeaderData(ACTIVITY_CATEGORY,</span>
<span class="nc" id="L182">			i18n(m_amBundle, AmWebBundleKey.ACTIVITY_TYPE));</span>
<span class="nc" id="L183">		m_list.getHeader().addColumnHeaderData(ACTIVITY,</span>
<span class="nc" id="L184">			i18n(m_amBundle, AmWebBundleKey.ACTIVITY));</span>
<span class="nc" id="L185">		m_list.getHeader().addColumnHeaderData(DURATION,</span>
<span class="nc" id="L186">			i18n(m_amBundle, AmWebBundleKey.DURATION));</span>
<span class="nc" id="L187">		m_list.getHeader().addColumnHeaderData(DURATION,</span>
<span class="nc" id="L188">			i18n(m_amBundle, AmWebBundleKey.CREATOR));</span>
<span class="nc" id="L189">		m_list.getHeader().addColumnHeaderData(NOTES,</span>
<span class="nc" id="L190">			i18n(m_amBundle, AmWebBundleKey.MY_NOTES));</span>

		// Set up basic table property
<span class="nc" id="L193">		m_list.setMultiRowSelectable(false);</span>
<span class="nc" id="L194">		m_list.setRowSelectable(false);</span>
<span class="nc" id="L195">		m_list.setEnabled(false);</span>
		//m_list.setHeightInPixels(200);
		
<span class="nc" id="L198">		m_list.setIsZebra(true);</span>
<span class="nc bnc" id="L199" title="All 2 branches missed.">		if (isAccessibilityComplianceMode()){</span>
<span class="nc" id="L200">			m_list.setUseWrapper(true);</span>
<span class="nc" id="L201">			m_list.setWrapperRegion(true);</span>
<span class="nc" id="L202">			m_list.setReadableRowInfoEnabled(true);</span>
<span class="nc" id="L203">			m_list.addTableArrowNavigation();</span>
<span class="nc" id="L204">			m_list.setRenderJavaScriptIfDisabled(true);</span>
<span class="nc" id="L205">			m_list.disableRepeatHeader();</span>
		}
<span class="nc" id="L207">	}</span>

	/**
	 * Create the list model
	 */
	private List createListModel(ArrayList eventList){
<span class="nc" id="L213">		ArrayList listModel = new ArrayList();</span>

		//get the dateformat here based on preferences
<span class="nc bnc" id="L216" title="All 2 branches missed.">		if ( eventList.size() &gt; 0 ) {</span>
<span class="nc bnc" id="L217" title="All 2 branches missed.">			for (int i=0; i&lt;eventList.size();i++){</span>
<span class="nc" id="L218">				TimeRecord aRecord = (TimeRecord) eventList.get(i);</span>

				//now get the timerecordentry
<span class="nc" id="L221">				ArrayList anEntryList = (ArrayList)aRecord.getChildren();</span>
<span class="nc bnc" id="L222" title="All 2 branches missed.">				for (int j=0; j&lt;anEntryList.size(); j++){</span>
<span class="nc" id="L223">					ArrayList row_data = null;</span>
<span class="nc" id="L224">                    ArrayList row_style = new ArrayList(6);</span>
<span class="nc" id="L225">                    row_style.add(&quot;text-align:left;&quot;);</span>
<span class="nc" id="L226">                    row_style.add(&quot;text-align:left;&quot;);</span>
<span class="nc" id="L227">                    row_style.add(&quot;text-align:left;&quot;);</span>
<span class="nc" id="L228">                    row_style.add(&quot;text-align:left;&quot;);</span>
<span class="nc" id="L229">                    row_style.add(&quot;text-align:left;&quot;);</span>
<span class="nc" id="L230">                    row_style.add(&quot;text-align:left;&quot;);</span>
                    
<span class="nc bnc" id="L232" title="All 2 branches missed.">					switch (aRecord.getType())</span>
					{
						case TimeRecord.AGG_TIMEENTRY:
						case TimeRecord.TIMEENTRY:
<span class="nc" id="L236">              TimeRecordEntry anEntry = (TimeRecordEntry) anEntryList.get(j);</span>
<span class="nc" id="L237">							String startTime = m_localizer.formatDate(anEntry.getStartTime(),</span>
<span class="nc" id="L238">								m_context.getViewingTimeZone(),</span>
								RegionalFormatBundleKey.DATE_FORMAT,
								RegionalFormatBundleKey.TIME_FORMAT);
<span class="nc" id="L241">            	String duration = m_localizer.formatDurationInMins(anEntry.getDuration());</span>

                
<span class="nc bnc" id="L244" title="All 2 branches missed.">						if (j == 0){</span>
							//add start shift
<span class="nc" id="L246">							row_data = new ArrayList();</span>
<span class="nc" id="L247">							row_data.add(startTime);</span>
<span class="nc" id="L248">							row_data.add(i18n(m_amBundle, AmWebBundleKey.START_SHIFT));</span>
<span class="nc" id="L249">							row_data.add(StringUtil.NBSP);</span>
<span class="nc" id="L250">							row_data.add(StringUtil.NBSP);</span>
<span class="nc" id="L251">							row_data.add(StringUtil.NBSP);</span>
<span class="nc" id="L252">							row_data.add(StringUtil.NBSP);</span>
<span class="nc" id="L253">							listModel.add(new DefaultMultiColumnNodeData(aRecord.getID().toString(), row_data, </span>
                                    row_style, new HashMap()));
						}
<span class="nc bnc" id="L256" title="All 2 branches missed.">						if (!anEntry.getActivityID().equals(Activity.ACTIVITY_NONE)) { //regular entry</span>
<span class="nc" id="L257">							row_data = new ArrayList();</span>
<span class="nc" id="L258">							row_data.add(StringUtil.NBSP + StringUtil.NBSP + startTime);</span>
<span class="nc" id="L259">							row_data.add(anEntry.getActivityCategoryName());</span>
<span class="nc" id="L260">							row_data.add(anEntry.getActivityName());</span>
<span class="nc" id="L261">							row_data.add(duration);</span>
<span class="nc" id="L262">							row_data.add(TimeRecordUtil.getCreatorStr(m_context, m_amBundle, aRecord.getType(), anEntry.getTimeSourceCode()));</span>
<span class="nc bnc" id="L263" title="All 2 branches missed.">							row_data.add(!StringUtil.isEmpty(anEntry.getDescription())?anEntry.getDescription():StringUtil.NBSP);</span>
<span class="nc" id="L264">							listModel.add(new DefaultMultiColumnNodeData(aRecord.getID().toString(), row_data,</span>
                                    row_style, new HashMap()));
						} else { //end shift
<span class="nc" id="L267">							row_data = new ArrayList();</span>
<span class="nc" id="L268">							row_data.add(startTime);</span>
<span class="nc" id="L269">							row_data.add(i18n(m_amBundle, AmWebBundleKey.END_SHIFT));</span>
<span class="nc" id="L270">							row_data.add(StringUtil.NBSP);</span>
<span class="nc" id="L271">							row_data.add(StringUtil.NBSP);</span>
<span class="nc" id="L272">							row_data.add(TimeRecordUtil.getCreatorStr(m_context, m_amBundle, aRecord.getType(), anEntry.getTimeSourceCode()));</span>
<span class="nc bnc" id="L273" title="All 2 branches missed.">							row_data.add(!StringUtil.isEmpty(anEntry.getDescription())?anEntry.getDescription():StringUtil.NBSP);</span>
<span class="nc" id="L274">							listModel.add(new DefaultMultiColumnNodeData(aRecord.getID().toString(), row_data,</span>
                                    row_style, new HashMap()));
						}
						break;
						/*
						case TimeRecord.TIMEINTERVAL:

						TimeInterval anInterval = (TimeInterval) anEntryList.get(j);
						startTime = DateTimeDisplay.getString(anInterval.getStartTime(),
								m_context.getViewingTimeZone(),
								TimeZoneBundleKey.LONG_DATETIME_NOSECOND_FORMAT,m_context.getLocale());
						String endTime = DateTimeDisplay.getString(anInterval.getEndTime(),
								m_context.getViewingTimeZone(),
								TimeZoneBundleKey.LONG_DATETIME_NOSECOND_FORMAT,m_context.getLocale());

						duration = DateTimeDisplay.getMinutesDisplay(anInterval.getDuration(),m_context.getLocale());

						ArrayList columnStyle = new ArrayList();
						for (int len=0; len&lt;6; len++){
							columnStyle.add(&quot;tblLightItem&quot;);
						}
						row_data = new ArrayList();
								row_data.add(startTime + &quot;- &lt;br&gt;&quot;+ endTime);
								row_data.add(anInterval.getActivityCategoryName());
								row_data.add(anInterval.getActivityName());
								row_data.add(duration);
								row_data.add(TimeRecordUtil.getCreatorStr(m_amBundle, aRecord.getType(), anInterval.getTimeSourceCode()));
								row_data.add(!StringUtil.isEmpty(anInterval.getDescription())?anInterval.getDescription():StringUtil.NBSP);
								listModel.add(new DefaultMultiColumnNodeData(aRecord.getID().toString(), row_data, columnStyle));
						break;
						*/
					}
				}
			}
		} else {
<span class="nc" id="L309">			ArrayList columns = new ArrayList(1);</span>
<span class="nc" id="L310">			HtmlTableCell cell = new HtmlTableCell();</span>
<span class="nc" id="L311">			cell.setAttribute(&quot;colspan&quot;,&quot;8&quot;);</span>
<span class="nc" id="L312">			cell.setAttribute(&quot;align&quot;,&quot;center&quot;);</span>
<span class="nc" id="L313">			cell.setInnerHtml(&quot;&lt;b&gt;&quot; +</span>
<span class="nc" id="L314">					i18n(m_amBundle, AmWebBundleKey.MSG_NO_RECORDS) +</span>
					&quot;&lt;/b&gt;&quot;);
<span class="nc" id="L316">			columns.add(cell);</span>
<span class="nc" id="L317">			listModel.add(</span>
					new DefaultMultiColumnNodeData(&quot;1&quot;, columns)
					);
	}

<span class="nc" id="L322">		return listModel;</span>
	}

    /**
	 * Override extract Parameters to handle date input
	 */
	public boolean extractParameters(HttpServletRequest request) {
<span class="nc" id="L329">		boolean success = super.extractParameters(request);</span>

		// Extract Date
		try {
<span class="nc bnc" id="L333" title="All 2 branches missed.">			if (m_drPicker == null) {</span>
<span class="nc" id="L334">			m_drPicker = new DateRangePickerPC(m_context, DATA_RANGE_FN);</span>
		}
<span class="nc" id="L336">			TimeZone tz = m_context.getViewingTimeZone();</span>
<span class="nc bnc" id="L337" title="All 2 branches missed.">			if (tz != null) {</span>
<span class="nc" id="L338">				m_drPicker.setTimeZone(tz);</span>
			}
<span class="nc" id="L340">			Date startDate = m_drPicker.getStartDatePickerPC().getDate();</span>
<span class="nc" id="L341">			Date endDate = m_drPicker.getEndDatePickerPC().getDate();</span>


<span class="nc bnc" id="L344" title="All 2 branches missed.">			if (startDate != null) {</span>
<span class="nc" id="L345">				Calendar cal = Calendar.getInstance(tz);</span>
<span class="nc" id="L346">				cal.setTime(startDate);</span>
<span class="nc" id="L347">				startYear = cal.get(Calendar.YEAR);</span>
<span class="nc" id="L348">				startMonth = cal.get(Calendar.MONTH);</span>
<span class="nc" id="L349">				startDay = cal.get(Calendar.DAY_OF_MONTH);</span>
			}
<span class="nc bnc" id="L351" title="All 2 branches missed.">			if (endDate != null) {</span>
<span class="nc" id="L352">				Calendar cal = Calendar.getInstance(tz);</span>
<span class="nc" id="L353">				cal.setTime(endDate);</span>
<span class="nc" id="L354">				endYear = cal.get(Calendar.YEAR);</span>
<span class="nc" id="L355">				endMonth = cal.get(Calendar.MONTH);</span>
<span class="nc" id="L356">				endDay = cal.get(Calendar.DAY_OF_MONTH);</span>
			}
<span class="nc" id="L358">		} catch (Exception ex) {</span>
<span class="nc" id="L359">			log.setResourceBundle(m_common_bundle);</span>
<span class="nc" id="L360">			log.l7dError(UIFWebBundleKey.EXTRACT_PARAM_FAILED, ex);</span>
<span class="nc" id="L361">		}</span>


<span class="nc" id="L364">		return success;</span>
	}

	/**
	* Set empId
	*/
	public void setEmpId(ID empId){
<span class="nc" id="L371">		this.empId = empId;</span>
<span class="nc" id="L372">	}</span>

	/**
	* Get empId
	*/
	public ID getEmpId(){
<span class="nc" id="L378">		return this.empId;</span>
	}

	/**
	* Set startYear
	*/
	public void setStartYear(String startYear){
		try {
<span class="nc" id="L386">			this.startYear = Integer.parseInt(startYear);</span>
<span class="nc" id="L387">		} catch (NumberFormatException ne) {</span>
<span class="nc" id="L388">		}</span>
<span class="nc" id="L389">	}</span>


	/**
	* Set startMonth
	*/
	public void setStartMonth(String startMonth){
		try {
<span class="nc" id="L397">			this.startMonth = Integer.parseInt(startMonth);</span>
<span class="nc" id="L398">		} catch (NumberFormatException ne) {</span>
<span class="nc" id="L399">		}</span>
<span class="nc" id="L400">	}</span>


	/**
	* Set startDay
	*/
	public void setStartDay(String startDay){
		try {
<span class="nc" id="L408">			this.startDay = Integer.parseInt(startDay);</span>
<span class="nc" id="L409">		} catch (NumberFormatException ne) {</span>
<span class="nc" id="L410">		}</span>
<span class="nc" id="L411">	}</span>
	/**
	* Set endYear
	*/
	public void setEndYear(String endYear){
		try {
<span class="nc" id="L417">			this.endYear = Integer.parseInt(endYear);</span>
<span class="nc" id="L418">		} catch (NumberFormatException ne) {</span>
<span class="nc" id="L419">		}</span>
<span class="nc" id="L420">	}</span>


	/**
	* Set endMonth
	*/
	public void setEndMonth(String endMonth){
		try {
<span class="nc" id="L428">			this.endMonth = Integer.parseInt(endMonth);</span>
<span class="nc" id="L429">		} catch (NumberFormatException ne) {</span>
<span class="nc" id="L430">		}</span>
<span class="nc" id="L431">	}</span>


	/**
	* Set endDay
	*/
	public void setEndDay(String endDay){
		try {
<span class="nc" id="L439">			this.endDay = Integer.parseInt(endDay);</span>
<span class="nc" id="L440">		} catch (NumberFormatException ne) {</span>
<span class="nc" id="L441">		}</span>
<span class="nc" id="L442">	}</span>

	/**
	* setNeedStatus()
	*/
	public void setNeedStatus(boolean needStatus){
<span class="nc" id="L448">		this.needStatus = needStatus;</span>
<span class="nc" id="L449">	}</span>

	/**
	* getNeedStatus()
	* return boolean
	*/
	public boolean getNeedStatus(){
<span class="nc" id="L456">		return this.needStatus;</span>
	}

	/**
	* setNeedNotes()
	*/
	public void setNeedNotes(boolean needNotes){
<span class="nc" id="L463">		this.needNotes = needNotes;</span>
<span class="nc" id="L464">	}</span>

	/**
	* getNeedStatus()
	* return boolean
	*/
	public boolean getNeedNotes(){
<span class="nc" id="L471">		return this.needNotes;</span>
	}

	protected Calendar getCalendar() {
		// must add time zone
<span class="nc" id="L476">		return Calendar.getInstance(m_context.getViewingTimeZone());</span>
	}

	public Date getStartDate() {
<span class="nc" id="L480">		Calendar calendar = getCalendar();</span>
<span class="nc" id="L481">		calendar.set(startYear, startMonth, startDay, 0, 0, 0);</span>
<span class="nc" id="L482">		return calendar.getTime();</span>
	}

	public Date getEndDate() {
<span class="nc" id="L486">		Calendar calendar = getCalendar();</span>
<span class="nc" id="L487">		calendar.set(endYear, endMonth, endDay, 0, 0, 0);</span>
<span class="nc" id="L488">		return calendar.getTime();</span>
	}

	public Date getActualEndDate() {
<span class="nc" id="L492">		Calendar calendar = getCalendar();</span>
<span class="nc" id="L493">		calendar.set(endYear, endMonth, endDay, 0, 0, 0);</span>
<span class="nc" id="L494">		calendar.add(Calendar.DATE, 1);</span>
<span class="nc" id="L495">		return calendar.getTime();</span>
	}

	public DateFormat getDateFormat() {
<span class="nc" id="L499">		DateFormat df = DateFormat.getDateTimeInstance();</span>
<span class="nc" id="L500">		df.setCalendar(getCalendar());</span>
<span class="nc" id="L501">		return df;</span>
	}

	/**
	* Return the string representing the content of the Log History model
	*/
	public String toString() {
<span class="nc" id="L508">	return &quot;\n[LogHistoryModel]:&quot;+</span>
				 &quot;\nstartYear=&quot; + this.startYear +
				 &quot;\nstartMonth=&quot; + this.startMonth +
				 &quot;\nstartDay=&quot; + this.startDay +
				 &quot;\nendYear=&quot; + this.endYear +
				 &quot;\nendMonth=&quot; + this.endMonth +
				 &quot;\nendDay=&quot; + this.endDay +
				 &quot;\nempId=&quot; + this.empId;
	}

	/**
	 * Return URL for HTML Form Action
	 */
	public String getFormAction() {
		/** todo: need to verify that his page is not used in a HTML form */
<span class="nc" id="L523">		return &quot;getloghistory&quot;;</span>
	}

    //508
    private HtmlButton getRefreshBtn(String title, String onClick) 
    {
        //String refreshImage = HtmlUtil.imageTag(ImageFileID.REFRESH_WITH_BORDER, ImageFileID.REFRESH_WITH_BORDER_WIDTH,
        //            ImageFileID.REFRESH_WITH_BORDER_HEIGHT, title, false)
        //        + &quot; align=\&quot;absmiddle\&quot;&gt;&quot;;
        //String refreshButton = &quot;&lt;span class=\&quot;handCursor\&quot; onClick=\&quot;document.oFormMain.submit();\&quot;&gt;&quot;
        //    + refreshImage + &quot; &lt;/span&gt;&quot;;
        
        
<span class="nc" id="L536">        HtmlImage image = new HtmlImage(ImageFileID.REFRESH_WITH_BORDER);</span>
<span class="nc" id="L537">        image.setAttribute(&quot;class&quot;, &quot;imgToolbarDefault&quot;);</span>
<span class="nc" id="L538">        image.setAttribute(&quot;style&quot;,&quot;margin:0px 0px 0px 2px;&quot;);</span>
<span class="nc" id="L539">        image.setAlt(title);</span>
        
<span class="nc" id="L541">        HtmlButton button = new HtmlButton(&quot;LogHstoryRefreshButton&quot;);</span>
<span class="nc" id="L542">        button.setInnerHtml(image);</span>
<span class="nc" id="L543">        button.setAttribute(&quot;class&quot;, &quot;dialogBtn&quot;);</span>
<span class="nc" id="L544">        button.appendAttribute(&quot;align&quot;, &quot;absmiddle&quot;);</span>
<span class="nc" id="L545">        button.setOnClick(onClick);</span>
<span class="nc" id="L546">        button.setAttribute(&quot;title&quot;, title);</span>
        
<span class="nc bnc" id="L548" title="All 2 branches missed.">        if (isAccessibilityComplianceMode()){</span>
<span class="nc" id="L549">			button.setAttribute(&quot;aria-label&quot;, title);</span>
<span class="nc" id="L550">			button.setAttribute(&quot;aria-label-tooltip&quot;, &quot;true&quot;);</span>
		}
        
<span class="nc" id="L553">        return button;</span>
    }    
    
	private void initContentTitle(RequestContext context) {
<span class="nc" id="L557">		Employee employee = null;</span>
<span class="nc" id="L558">		String nameStr = &quot;&quot;;</span>
		try {
<span class="nc" id="L560">			ID id = context.getUser().getEmployeeID();</span>
<span class="nc bnc" id="L561" title="All 2 branches missed.">			if ( id != null){</span>
<span class="nc" id="L562">				employee = EmployeeModelHandler.getEmployeeByID(context, id);</span>
<span class="nc" id="L563">				nameStr = m_localizer.formatName(employee.getPerson());</span>
			}
<span class="nc" id="L565">		} catch (Exception ex){</span>
			//cat.l7dError(&quot;Could not find employee&quot;, ex);
<span class="nc" id="L567">		}</span>

<span class="nc" id="L569">		m_contentTitlePC.setProperties(</span>
<span class="nc" id="L570">						i18n( m_amBundle,AmWebBundleKey.LOG_HISTORY_TITLE),</span>
<span class="nc" id="L571">						HtmlEncoder.encode(nameStr)</span>
					);
        
<span class="nc" id="L574">        String refreshLabel = i18n(m_amBundle,AmWebBundleKey.ADHERENCE_REFRESH_TITLE);</span>
<span class="nc" id="L575">        String refreshOnClick = &quot;document.oFormMain.submit();&quot;;</span>
<span class="nc" id="L576">        HtmlButton refreshButton = getRefreshBtn(refreshLabel, refreshOnClick);       </span>
        
<span class="nc" id="L578">		m_contentTitlePC.setActiveComponent(</span>
								HtmlUtil.TBL_OPEN_TAG + &quot;&lt;tr&gt;&lt;td nowrap&gt;&lt;SPAN class=\&quot;headerText2\&quot;&gt;&quot;
<span class="nc" id="L580">								+ i18n(m_amBundle, AmWebBundleKey.DATE_RANGE)</span>
								+ &quot;: &lt;/SPAN&gt;&quot;
<span class="nc" id="L582">								+ getDateRangeUI()</span>
								+ &quot;&lt;/td&gt;&lt;td&gt;&quot;
<span class="nc" id="L584">								+ refreshButton.toString()</span>
								+ &quot;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&quot;
					);
<span class="nc bnc" id="L587" title="All 2 branches missed.">		if (isAccessibilityComplianceMode()){</span>
<span class="nc" id="L588">			m_contentTitlePC.setAriaRegion(true);			</span>
		}
<span class="nc" id="L590">	}</span>

	@Override
	public String getCustomJavaScript() {
<span class="nc" id="L594">		StringBuilder js = new StringBuilder(super.getCustomJavaScript());</span>
<span class="nc" id="L595">		js.append(getJSChangeWorkspaceAriaLabel(m_localizer.i18n(UIFWebBundleKey.BUNDLE_NAME, UIFWebBundleKey.WORK_PANE_DESCRIPTION, </span>
<span class="nc" id="L596">				m_contentTitlePC.getPageTitle(), &quot;&quot;)));</span>
<span class="nc" id="L597">		return js.toString();</span>
	}

	protected MultiColListPC getMultiColListPC(RequestContext context) {
<span class="nc" id="L601">		return new MultiColListPC(context){</span>

			@Override
			protected HtmlDiv getNewHtmlDiv() {
<span class="nc" id="L605">				HtmlDiv wrapper = super.getNewHtmlDiv();</span>
<span class="nc" id="L606">				wrapper.setAttribute(&quot;aria-label&quot;, i18n(m_amBundle,AmWebBundleKey.LOG_HISTORY_GRID));</span>
<span class="nc" id="L607">				return wrapper;</span>
			}

			@Override
			protected boolean skipEncloseForKeyboardAccess(BaseNodeData nodeData) {
<span class="nc bnc" id="L612" title="All 2 branches missed.">				if (isAccessibilityComplianceMode()) {</span>
<span class="nc" id="L613">					return false;</span>
				} else {
<span class="nc" id="L615">					return super.skipEncloseForKeyboardAccess(nodeData);</span>
				}
			}
		};
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>