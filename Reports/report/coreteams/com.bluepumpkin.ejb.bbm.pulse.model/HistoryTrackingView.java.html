<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>HistoryTrackingView.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.ejb.bbm.pulse.model</a> &gt; <span class="el_source">HistoryTrackingView.java</span></div><h1>HistoryTrackingView.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.ejb.bbm.pulse.model;

import java.util.ArrayList;
import java.util.Date;
import java.util.HashSet;
import java.util.Iterator;
import java.util.List;
import java.util.StringTokenizer;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.util.NumberFactory;
import com.bluepumpkin.ejb.bbm.base.BbmTimeSeriesException;
import com.bluepumpkin.ejb.bbm.timeseries.model.ActualTraceCube;
import com.bluepumpkin.ejb.bbm.timeseries.model.TraceCube;
import com.bluepumpkin.ejb.bbm.timeseries.model.Trace;
import com.bluepumpkin.ejb.bbm.timeseries.util.TraceUtil;
import com.bluepumpkin.ejb.bbm.vo.FieldInfo;

/**
 * Title:        Blue Pumpkin Software Forecast&amp;Schedule
 * Description:  HistoryTrackingView object, a view definition object for Tracking UI
 * Copyright:    Copyright (c) 2004
 * Company:      Blue Pumpkin Software, inc
 * @author       Sheng Song
 * @version 2.0
 */

public class HistoryTrackingView extends TrackingView {
	static final long serialVersionUID = -7242283145378697020L;

<span class="nc" id="L31">	public static final Object[] HISTORY_TRACE_CHARTS = {</span>
		new TraceChart(Trace.CV, TraceChart.ABSOLUTE_CHART, new short[]{TraceChart.ACTUAL_LINE}, true),
		new TraceChart(Trace.AHT, TraceChart.ABSOLUTE_CHART, new short[]{TraceChart.ACTUAL_LINE}, true),
		new TraceChart(Trace.PCA, TraceChart.ABSOLUTE_CHART, new short[]{TraceChart.ACTUAL_LINE}, true),
		new TraceChart(Trace.ASA, TraceChart.ABSOLUTE_CHART, new short[]{TraceChart.ACTUAL_LINE}, true),
		new TraceChart(Trace.ABANDONMENT, TraceChart.ABSOLUTE_CHART, new short[]{TraceChart.ACTUAL_LINE}, true),
		new TraceChart(Trace.BACKLOG, TraceChart.ABSOLUTE_CHART, new short[]{TraceChart.ACTUAL_LINE}, true),
		new TraceChart(Trace.STAFFING, TraceChart.ABSOLUTE_CHART, new short[]{TraceChart.ACTUAL_LINE}, true),
		new TraceChart(Trace.OCCUPANCY, TraceChart.ABSOLUTE_CHART, new short[]{TraceChart.ACTUAL_LINE}, true),
		new TraceChart(Trace.FTE, TraceChart.ABSOLUTE_CHART, new short[]{TraceChart.ACTUAL_LINE}, true),
		new TraceChart(Trace.DIALS, TraceChart.ABSOLUTE_CHART, new short[]{TraceChart.ACTUAL_LINE}, true),
		new TraceChart(Trace.CONNECTS, TraceChart.ABSOLUTE_CHART, new short[]{TraceChart.ACTUAL_LINE}, true),
		new TraceChart(Trace.RPC, TraceChart.ABSOLUTE_CHART, new short[]{TraceChart.ACTUAL_LINE}, true),
		new TraceChart(Trace.RPCAHT, TraceChart.ABSOLUTE_CHART, new short[]{TraceChart.ACTUAL_LINE}, true),
        new TraceChart(Trace.VH, TraceChart.ABSOLUTE_CHART, new short[]{TraceChart.ACTUAL_LINE}, true)
	};

	private static HistoryTrackingView DEFAULT_VIEW;

<span class="nc" id="L50">	private static FieldInfo m_fieldInfo = new HistoryTrackingViewFieldInfo();</span>
<span class="nc" id="L51">	protected FieldInfo getFieldInfo() { return m_fieldInfo; }</span>

	public static TrackingView getDefaultView() {
<span class="nc" id="L54">		synchronized (HistoryTrackingView.class) {</span>
<span class="nc bnc" id="L55" title="All 2 branches missed.">			if (DEFAULT_VIEW == null) {</span>
<span class="nc" id="L56">				DEFAULT_VIEW = new HistoryTrackingView();</span>
<span class="nc" id="L57">				DEFAULT_VIEW.setHOO(false);</span>
<span class="nc" id="L58">				List chartDefinition = new ArrayList();</span>
<span class="nc" id="L59">				DEFAULT_VIEW.setChartDefinition(chartDefinition);</span>
<span class="nc" id="L60">				chartDefinition.add(HISTORY_TRACE_CHARTS[Trace.CV]);</span>
<span class="nc" id="L61">				chartDefinition.add(HISTORY_TRACE_CHARTS[Trace.AHT]);</span>
			}
<span class="nc" id="L63">		}</span>
<span class="nc" id="L64">		return DEFAULT_VIEW;</span>
	}

<span class="nc" id="L67">	public HistoryTrackingView() { super(); }</span>

	public ID getID() {
<span class="nc" id="L70">		return getFieldValueID(HistoryTrackingViewFieldInfo.TRACKINGVIEW_ID);</span>
	}
	public void setID(ID id) {
<span class="nc" id="L73">		setFieldValue(HistoryTrackingViewFieldInfo.TRACKINGVIEW_ID, id);</span>
<span class="nc" id="L74">	}</span>

	public void setUserID(ID userID)
	{
<span class="nc" id="L78">		setFieldValue(HistoryTrackingViewFieldInfo.TRACKINGVIEW_USERID, userID);</span>
<span class="nc" id="L79">	}</span>

	public ID getUserID() {
<span class="nc" id="L82">		return getFieldValueID(HistoryTrackingViewFieldInfo.TRACKINGVIEW_USERID);</span>
	}

	public boolean useHOO() {
<span class="nc" id="L86">		return getFieldValueBoolean(HistoryTrackingViewFieldInfo.TRACKINGVIEW_USEHOO);</span>
	}
	
	public void setHOO(boolean useHoo) {
<span class="nc" id="L90">		setFieldValue(HistoryTrackingViewFieldInfo.TRACKINGVIEW_USEHOO, useHoo);</span>
<span class="nc" id="L91">	}</span>
		
	/**
	 * Used by persistence layer to convert def into string representation
	 * @return
	 */
	public void saveChartDef() {
<span class="nc" id="L98">		StringBuffer sb = new StringBuffer();		</span>
<span class="nc bnc" id="L99" title="All 4 branches missed.">		if (m_ChartList != null &amp;&amp; !m_ChartList.isEmpty()) {</span>
<span class="nc bnc" id="L100" title="All 2 branches missed.">			for (Iterator it = m_ChartList.iterator(); it.hasNext(); ) {</span>
<span class="nc" id="L101">				sb.append(it.next()).append(CHARTDELIMIT);</span>
			}
<span class="nc" id="L103">			setFieldValue(HistoryTrackingViewFieldInfo.TRACKINGVIEW_VIEWDEF, sb.toString());</span>
		}
<span class="nc" id="L105">		setFieldValue(HistoryTrackingViewFieldInfo.TRACKINGVIEW_LASTUPDATE, new Date());</span>
<span class="nc" id="L106">	}</span>
	
	/**
	 * Used by persistence layer to convert def string into list of TraceChart objects
	 * @param defString
	 */
	public void retrieveChart() {
<span class="nc" id="L113">		String defString = getFormattedFieldValue(HistoryTrackingViewFieldInfo.TRACKINGVIEW_VIEWDEF); 		</span>
<span class="nc bnc" id="L114" title="All 2 branches missed.">		if (defString != null) {</span>
<span class="nc" id="L115">			m_ChartList = new ArrayList();</span>
<span class="nc" id="L116">			StringTokenizer st = new StringTokenizer(defString, CHARTDELIMIT);</span>
<span class="nc bnc" id="L117" title="All 2 branches missed.">			while (st.hasMoreTokens()) {</span>
<span class="nc" id="L118">				String chartStr = st.nextToken();</span>
<span class="nc" id="L119">				TraceChart tc = new TraceChart();</span>
<span class="nc" id="L120">				tc.populate(chartStr);</span>
<span class="nc" id="L121">				m_ChartList.add(tc);</span>
<span class="nc" id="L122">			}</span>
		}	
<span class="nc" id="L124">	}</span>
	
	/**
	 * 
	 * @return
	 * @throws BbmTimeSeriesException
	 * @deprecated, use the API takes SPMODE parameter to be more precise
	 */
	public TraceCube[] getMetaTC() throws BbmTimeSeriesException  {
<span class="nc" id="L133">		return getMetaTC(true);</span>
	}

	/**
	 * API used by backend for trace retrieve
	 * @param spMode
	 * @return
	 * @throws BbmTimeSeriesException
	 */
	public TraceCube[] getMetaTCForLoad(boolean spMode) throws BbmTimeSeriesException {
<span class="nc" id="L143">		TraceCube[] cubes = new TraceCube[5];</span>
<span class="nc" id="L144">		TraceCube[] uiCubes = getMetaTC(spMode);</span>
<span class="nc bnc" id="L145" title="All 2 branches missed.">		if (uiCubes != null) {</span>
<span class="nc" id="L146">			cubes[0] = uiCubes[0];</span>
		}
<span class="nc" id="L148">		return cubes;</span>
	}
	
	public TraceCube[] getMetaTC(boolean spMode) throws BbmTimeSeriesException  {
<span class="nc bnc" id="L152" title="All 2 branches missed.">		if (m_MetaTC == null) {</span>
<span class="nc" id="L153">			m_MetaTC = new TraceCube[3];</span>
		}
<span class="nc" id="L155">		HashSet traceTypeSet = new HashSet();		</span>
<span class="nc bnc" id="L156" title="All 4 branches missed.">		if (m_ChartList != null &amp;&amp; !m_ChartList.isEmpty()) {</span>
<span class="nc bnc" id="L157" title="All 2 branches missed.">			for (Iterator it = m_ChartList.iterator(); it.hasNext(); ) {</span>
<span class="nc" id="L158">				TraceChart tc = (TraceChart)it.next();</span>
<span class="nc bnc" id="L159" title="All 2 branches missed.">				if (!tc.isHidden()) {</span>
<span class="nc" id="L160">					boolean[] traceCubes = tc.needTraceCubes();				</span>
<span class="nc bnc" id="L161" title="All 2 branches missed.">					if (traceCubes[0]) {</span>
<span class="nc" id="L162">						traceTypeSet.add(NumberFactory.newShort(tc.getTraceType()));</span>
					}				
				}
<span class="nc" id="L165">			}</span>
		}
<span class="nc bnc" id="L167" title="All 2 branches missed.">		if (!traceTypeSet.isEmpty()) {					</span>
<span class="nc" id="L168">			short[] types = new short[traceTypeSet.size()];</span>
<span class="nc" id="L169">			int k = 0;</span>
<span class="nc bnc" id="L170" title="All 2 branches missed.">			for (Iterator it = traceTypeSet.iterator(); it.hasNext(); ) {</span>
<span class="nc" id="L171">				short type = ((Short)it.next()).shortValue();</span>
<span class="nc" id="L172">				types[k++] = type;</span>
<span class="nc" id="L173">			}</span>
<span class="nc" id="L174">			m_MetaTC[0] = newMeta(0, types);	</span>
		}
<span class="nc" id="L176">		return m_MetaTC;</span>
	}

	private static TraceCube newMeta(int idx, short[] types) throws BbmTimeSeriesException {
<span class="nc bnc" id="L180" title="All 2 branches missed.">		switch (idx) {</span>
			case 0:
<span class="nc" id="L182">				return new ActualTraceCube(TraceUtil.getAggTraceType(TraceUtil.getCmbTraceType(types)));				</span>
		    default:
<span class="nc" id="L184">		    	return null;</span>
		}
	}	
	
	public String toString() {
<span class="nc" id="L189">		saveChartDef();</span>
<span class="nc" id="L190">		StringBuffer sb = new StringBuffer(256);</span>
<span class="nc" id="L191">		sb.append(&quot;HistoryTrackingView: HOO:&quot;).append(useHOO()).append(&quot;;UserID:&quot;).append(getUserID()).append(&quot;;ChartDef:&quot;).append(m_ChartList);</span>
<span class="nc" id="L192">		return sb.toString();</span>
	}
	/* (non-Javadoc)
	 * @see com.bluepumpkin.ejb.bbm.pulse.model.TrackingView#useTrending()
	 */
	public boolean useTrending() {		
<span class="nc" id="L198">		return false;</span>
	}
	/* (non-Javadoc)
	 * @see com.bluepumpkin.ejb.bbm.pulse.model.TrackingView#getDescription()
	 */
	public String getDescription() {
<span class="nc" id="L204">		return &quot;&quot;;</span>
	}
	/* (non-Javadoc)
	 * @see com.bluepumpkin.ejb.bbm.pulse.model.TrackingView#getViewName()
	 */
	public String getViewName() {
<span class="nc" id="L210">		return &quot;&quot;;</span>
	}
	/* (non-Javadoc)
	 * @see com.bluepumpkin.ejb.bbm.pulse.model.TrackingView#isDeviationView()
	 */
	public boolean isDeviationView() {
<span class="nc" id="L216">		return false;</span>
	}
	/* (non-Javadoc)
	 * @see com.bluepumpkin.ejb.bbm.pulse.model.TrackingView#isGlobal()
	 */
	public boolean isGlobal() {
<span class="nc" id="L222">		return true;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>