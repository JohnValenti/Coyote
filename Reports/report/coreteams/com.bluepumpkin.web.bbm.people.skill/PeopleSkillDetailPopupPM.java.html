<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>PeopleSkillDetailPopupPM.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.bbm.people.skill</a> &gt; <span class="el_source">PeopleSkillDetailPopupPM.java</span></div><h1>PeopleSkillDetailPopupPM.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.bbm.people.skill;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.util.StringUtil;
import com.bluepumpkin.ejb.bbm.skill.model.Skill;
import com.bluepumpkin.ejb.bbm.skill.model.SkillAssignment;
import com.bluepumpkin.ejb.bbm.workresource.model.EmployeeName;
import com.bluepumpkin.ejb.bbm.workresource.model.EmployeeTemplate;
import com.bluepumpkin.web.bbm.employee.EmployeeModelHandler;
import com.bluepumpkin.web.bbm.l10n.BbmWebBundleKey;
import com.bluepumpkin.web.bbm.organization.OrganizationModelHandler;
import com.bluepumpkin.web.bbm.skill.SkillModelHandler;
import com.witness.ejb.core.security.model.User;
import com.witness.web.uif.base.Message;
import com.witness.web.uif.jsp.HtmlDiv;
import com.witness.web.uif.jsp.HtmlDivWSpan;
import com.witness.web.uif.l10n.UIFWebBundleKey;
import com.witness.web.uif.pagecomponent.BaseNodeData;
import com.witness.web.uif.pagecomponent.DefaultMultiColumnNodeData;
import com.witness.web.uif.pagecomponent.list.MultiColListPC;
import com.witness.web.uif.pagecomponent.table.DefaultHeaderData;
import com.witness.web.uif.pagecomponent.table.GenericHeaderData;
import com.witness.web.uif.pagecomponent.table.TableHeaderPC;
import com.witness.web.uif.pagemodel.PageModel;
import com.witness.web.uif.pagemodel.PopupWindowPM;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.util.HtmlUtil;
import com.witness.web.uif.util.html.CSSUtil;

import java.text.MessageFormat;
import java.util.*;

/**
 * Title:        PeopleSkillDetailPopupPM
 * Description:  Popup to Display People Skill Detail
 * Copyright:    Copyright (c) 2002
 * Company:      Blue Pumpkin Software, Inc
 * @author       David Su, dsu
 * @version      1.0
 *
 * Created on November 4, 2002, 10:43 AM
 */
public class PeopleSkillDetailPopupPM extends PopupWindowPM {
	public static final String REQUEST_HANDLER = &quot;people_skills_detail&quot;;
	public static final String DATA_STYLE = &quot;text-align:right;&quot;;

	private final ResourceBundle m_bundle;
	private final User m_user;
<span class="nc" id="L49">	private String m_sEmpIDs = &quot;&quot;;</span>
<span class="nc" id="L50">	private String m_sEmpTplIDs = &quot;&quot;;</span>
	//QC-96672 changes
<span class="nc" id="L52">	private String m_sShiftDate1 = &quot;&quot;;</span>
<span class="nc" id="L53">	private String m_sShiftDate2 = &quot;&quot;;</span>


<span class="nc" id="L56">	private Collection m_empIDs = Collections.emptyList();</span>
<span class="nc" id="L57">	private Collection m_empTplIDs = Collections.emptyList();</span>
<span class="nc" id="L58">	private Collection m_skills = Collections.emptyList();</span>

<span class="nc" id="L60">	private Map m_eSkillAssignMap = Collections.emptyMap();</span>
<span class="nc" id="L61">	private Map m_empNameMap = Collections.emptyMap();</span>
<span class="nc" id="L62">	private Map m_eOrgMap = Collections.emptyMap();</span>

<span class="nc" id="L64">	private Map m_eTplSkillAssignMap = Collections.emptyMap();</span>
<span class="nc" id="L65">	private Map m_eTplNameMap = Collections.emptyMap();</span>
<span class="nc" id="L66">	private Map m_eTplOrgMap = Collections.emptyMap();</span>

<span class="nc" id="L68">	private boolean m_isFilteredMsgAdded=false;</span>
	private final MultiColListPC m_listPC;
	private final String m_notAvailableMsg;

	/** Creates a new instance of SkillDetailPopupPM */
	public PeopleSkillDetailPopupPM(RequestContext context) {
<span class="nc" id="L74">		super(context);</span>

<span class="nc" id="L76">		m_user = context.getUser();</span>
<span class="nc" id="L77">		m_bundle = m_localizer.getBundle(BbmWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L78">		m_notAvailableMsg = i18n(m_common_bundle, UIFWebBundleKey.NA);</span>

<span class="nc" id="L80">		m_listPC = new MultiColListPC(context) {</span>
			
			@Override
			protected HtmlDiv getNewHtmlDiv() {
<span class="nc" id="L84">				HtmlDivWSpan div = new HtmlDivWSpan(getPCAriaLabelID(), i18n(m_bundle, BbmWebBundleKey.BBM_PEOPLE_SKILLS_GRID));</span>
<span class="nc" id="L85">				div.setOverFlowXAuto();</span>
<span class="nc" id="L86">				return div;</span>
			}

			@Override
			protected boolean skipEncloseForKeyboardAccess(BaseNodeData nodeData) {
<span class="nc bnc" id="L91" title="All 2 branches missed.">				return !nodeData.isSelectable();</span>
			}
			
			@Override
			protected String addListLevelInfo(String content, int index, int siblingCount) {
<span class="nc" id="L96">				final String template1 = i18nCore(UIFWebBundleKey.MULTI_COL_LIST_LEVEL_TEMPLATE);</span>
<span class="nc" id="L97">				Object[] args1 = {new Integer(index), new Integer(siblingCount - 1)};</span>
<span class="nc" id="L98">				return HtmlUtil.makeHiddenReadableText(MessageFormat.format(template1, args1));</span>
			}
			
			@Override
			protected String encloseForKeyboardAccess(String content, String rowID,
					BaseNodeData nodeData, String cellCheckedAndMixedState) {
<span class="nc bnc" id="L104" title="All 2 branches missed.">				if (&quot;r0&quot;.equals(rowID)) {</span>
<span class="nc" id="L105">					return &quot;&quot;;</span>
				}
<span class="nc" id="L107">				return super.encloseForKeyboardAccess(content, rowID, nodeData,cellCheckedAndMixedState);</span>
			}
			
			@Override
			protected List getListHeaders() {
<span class="nc bnc" id="L112" title="All 4 branches missed.">				if (!m_empNameMap.isEmpty() || !m_eTplNameMap.isEmpty()) {</span>
<span class="nc" id="L113">					List customHeaders = new ArrayList();</span>
<span class="nc" id="L114">					List headers = super.getListHeaders();</span>
<span class="nc bnc" id="L115" title="All 2 branches missed.">					for (int i = 0; i &lt; headers.size(); i++) {</span>
<span class="nc bnc" id="L116" title="All 2 branches missed.">						if (!headers.get(i).toString().equalsIgnoreCase(getProficiencyLabel())) {</span>
<span class="nc" id="L117">							customHeaders.add(headers.get(i));</span>
						}
					}
<span class="nc" id="L120">					customHeaders.addAll(getEmpNameProficiencyHeaders());</span>
<span class="nc" id="L121">					customHeaders.addAll(getEmpTemplateNameProficiencyHeaders());</span>
<span class="nc" id="L122">					return customHeaders;</span>
				} else {
<span class="nc" id="L124">					return super.getListHeaders();</span>
				}
			}
		};
<span class="nc" id="L128">		m_listPC.setIsZebra(true);</span>
<span class="nc" id="L129">		addChildComponent(m_listPC);</span>
<span class="nc" id="L130">	}</span>
	
	private List&lt;GenericHeaderData&gt; getEmpNameProficiencyHeaders() {
<span class="nc" id="L133">		List&lt;GenericHeaderData&gt; empNameProficiencyHeaders = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L134" title="All 2 branches missed.">		for (Iterator it = m_empIDs.iterator(); it.hasNext();) {</span>
<span class="nc" id="L135">			ID empID = (ID) it.next();</span>
<span class="nc" id="L136">			EmployeeName eName = (EmployeeName) m_empNameMap.get(empID);</span>
<span class="nc" id="L137">			String name = m_localizer.formatName(eName);</span>
<span class="nc" id="L138">			appendCustomProficiencyHeader(empNameProficiencyHeaders, name);</span>
<span class="nc" id="L139">		}</span>

<span class="nc" id="L141">		return empNameProficiencyHeaders;</span>
	}
	
	private List&lt;GenericHeaderData&gt; getEmpTemplateNameProficiencyHeaders() {
<span class="nc" id="L145">		List&lt;GenericHeaderData&gt; empTemplateNameProficiencyHeaders = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L146" title="All 2 branches missed.">		if (!m_eTplNameMap.isEmpty()) {</span>
<span class="nc bnc" id="L147" title="All 2 branches missed.">			for (Iterator it = m_empTplIDs.iterator(); it.hasNext();) {</span>
<span class="nc" id="L148">				ID etID = (ID) it.next();</span>
<span class="nc" id="L149">				String eName = (String) m_eTplNameMap.get(etID);</span>
<span class="nc" id="L150">				appendCustomProficiencyHeader(empTemplateNameProficiencyHeaders, eName);</span>
<span class="nc" id="L151">			}</span>
		}
<span class="nc" id="L153">		return empTemplateNameProficiencyHeaders;</span>
	}
	
	private void appendCustomProficiencyHeader(List&lt;GenericHeaderData&gt; headersList, String name) {
<span class="nc" id="L157">		String customHeaderName = getProficiencyLabel() + &quot; &quot; + name;</span>
<span class="nc" id="L158">		DefaultHeaderData customHeaderData = new DefaultHeaderData(customHeaderName);</span>
<span class="nc" id="L159">		headersList.add(customHeaderData);</span>
<span class="nc" id="L160">	}</span>
	
	public String getProficiencyLabel() {
<span class="nc" id="L163">		return i18n(m_bundle, BbmWebBundleKey.PEOPLE_SKILLS_PROFICIENCY);</span>
	}

	/**
	 * Return an instance of the model that is ready for rendering
	 */
	public static PageModel getInstance(RequestContext context) throws Exception {
<span class="nc" id="L170">		return getInstance(context, PeopleSkillDetailPopupPM.class);</span>
	}//getInstance

	/**
	 * Initialize Model with Data
	 */
	@Override
	protected void initializeModel() {
<span class="nc bnc" id="L178" title="All 2 branches missed.">		if (m_isInitialized) {</span>
<span class="nc" id="L179">			return;</span>
		} else {
<span class="nc" id="L181">			m_isInitialized = true;</span>
		}
		try {
<span class="nc" id="L184">			ArrayList skillIDs = new ArrayList(10);</span>

			// load Employee related info
<span class="nc bnc" id="L187" title="All 2 branches missed.">			if (!m_empIDs.isEmpty()) {</span>
<span class="nc" id="L188">				Collection tmpSkill_IDs = loadEmployeeInfo();</span>
<span class="nc" id="L189">				skillIDs.addAll(tmpSkill_IDs);</span>
			}

			// load Employee temaplate related info
<span class="nc bnc" id="L193" title="All 2 branches missed.">			if (!m_empTplIDs.isEmpty()) {</span>
<span class="nc" id="L194">				Collection tmpSkill_IDs = loadEmployeeTemplateInfo();</span>
<span class="nc" id="L195">				skillIDs.addAll(tmpSkill_IDs);</span>
			}

<span class="nc bnc" id="L198" title="All 2 branches missed.">			if (!skillIDs.isEmpty()) {</span>
<span class="nc" id="L199">				m_skills = SkillModelHandler.getSkillsByIDs(skillIDs);</span>
			}

<span class="nc bnc" id="L202" title="All 2 branches missed.">			if (m_skills.isEmpty()) {</span>
<span class="nc" id="L203">				addPageMessage(Message.INFO_TYPE,	BbmWebBundleKey.BBM_PEOPLE_SKILLS_NO_DATA,</span>
						BbmWebBundleKey.BUNDLE_NAME);
			}
<span class="nc" id="L206">		} catch (Exception ex) {</span>
<span class="nc" id="L207">			handleUnableToLoadDataError(log, ex);</span>
		} finally {
<span class="nc" id="L209">			initContentTitle();</span>
<span class="nc" id="L210">			initList();</span>
<span class="nc" id="L211">			initToolbar();</span>
<span class="nc" id="L212">		}</span>
<span class="nc" id="L213">	}</span>

	/**
	 * Load Employee Template Information and return associated Skill IDs
	 */
	private Collection loadEmployeeTemplateInfo() throws Exception {
<span class="nc" id="L219">		Collection empTemplates = EmployeeModelHandler.getEmployeeTemplatesByID(m_context, m_empTplIDs);</span>

<span class="nc" id="L221">		boolean hasEmpFiltered = false;</span>
<span class="nc" id="L222">		m_eTplNameMap = new HashMap();</span>
<span class="nc" id="L223">		m_eTplOrgMap = new HashMap();</span>
<span class="nc" id="L224">		m_eTplSkillAssignMap = new HashMap();</span>
<span class="nc" id="L225">		List filteredIDs = new ArrayList(m_empTplIDs.size());</span>
<span class="nc" id="L226">		HashSet skillIDset = new HashSet();</span>
<span class="nc bnc" id="L227" title="All 2 branches missed.">		for(Iterator it=empTemplates.iterator(); it.hasNext(); ) {</span>
<span class="nc" id="L228">			EmployeeTemplate et = (EmployeeTemplate)it.next();</span>
<span class="nc" id="L229">			ID etID = et.getID();</span>

<span class="nc" id="L231">			m_eTplNameMap.put(etID, et.getName());</span>
<span class="nc" id="L232">			m_eTplOrgMap.put(etID, et.getOrganizationID());</span>

			// filter ID
<span class="nc bnc" id="L235" title="All 2 branches missed.">			if (PeopleSkillUtil.isAuthToViewEmpTemplateSkillInfo(m_user, etID, m_eTplOrgMap)) {</span>
<span class="nc" id="L236">				filteredIDs.add(etID);</span>
			} else {
<span class="nc" id="L238">				hasEmpFiltered = true;</span>
<span class="nc" id="L239">				continue;</span>
			}

			// Process Skills and Skill Assignements
<span class="nc" id="L243">			Collection saList = et.getSkillAssignments();</span>
<span class="nc bnc" id="L244" title="All 4 branches missed.">			if (saList != null &amp;&amp; !saList.isEmpty()) {</span>
<span class="nc" id="L245">				Map s_saMap = createSkillsMap(saList);</span>
<span class="nc" id="L246">				m_eTplSkillAssignMap.put(etID, s_saMap);</span>
<span class="nc" id="L247">				skillIDset.addAll(s_saMap.keySet());</span>
			}
<span class="nc" id="L249">		}</span>

<span class="nc bnc" id="L251" title="All 4 branches missed.">		if (hasEmpFiltered &amp;&amp; !m_isFilteredMsgAdded) {</span>
<span class="nc" id="L252">			m_isFilteredMsgAdded = true;</span>
<span class="nc" id="L253">			addPageMessage(Message.WARNING_TYPE,</span>
					BbmWebBundleKey.SOME_INFO_WERE_FILTERED_DUE_TO_AUTH,
					BbmWebBundleKey.BUNDLE_NAME);
		}

<span class="nc" id="L258">		return skillIDset;</span>
	}

	/**
	 * Load Employee related information and return collection of associated skill
	 * IDs
	 */
	//QC(96672) changes : changed the implementation of the method to load the skills of the agents from there respective shifts .
	 private Collection loadEmployeeInfo() throws Exception {
<span class="nc" id="L267">			int counter = 0 ;</span>
<span class="nc" id="L268">			Map e_saMap = null ;</span>
<span class="nc" id="L269">			Date agent1shiftDate = null;</span>
<span class="nc" id="L270">			Date agent2shiftDate = null;</span>
<span class="nc" id="L271">			HashSet skillIDset = new HashSet();</span>
<span class="nc" id="L272">			m_eOrgMap = OrganizationModelHandler.getEmployeeOrgMap(m_context, m_empIDs, null);</span>
<span class="nc" id="L273">			m_empIDs = filterEmpIDs(m_empIDs, m_eOrgMap);</span>
<span class="nc" id="L274">			m_empNameMap = EmployeeModelHandler.getEmployeeNamesByIDs(m_context, m_empIDs);</span>
<span class="nc" id="L275">			Iterator it = m_empIDs.iterator();</span>
<span class="nc" id="L276">			m_eSkillAssignMap = new HashMap(m_empIDs.size());</span>
			
<span class="nc bnc" id="L278" title="All 2 branches missed.">			if (!StringUtil.isEmpty(m_sShiftDate1) ) {</span>
<span class="nc" id="L279">				agent1shiftDate = new Date(new Long(m_sShiftDate1).longValue());</span>
			}
<span class="nc bnc" id="L281" title="All 2 branches missed.">			if (!StringUtil.isEmpty(m_sShiftDate2) ) {</span>
<span class="nc" id="L282">				agent2shiftDate = new Date(new Long(m_sShiftDate2).longValue());</span>
			}
<span class="nc bnc" id="L284" title="All 2 branches missed.">	        while(it.hasNext()){</span>
<span class="nc" id="L285">	        	ID id = (ID) it.next();</span>
<span class="nc" id="L286">	        	List empIDs = new ArrayList();</span>
<span class="nc" id="L287">	        	empIDs.add(id);</span>
		    // passed shift date as start date and end date 
<span class="nc bnc" id="L289" title="All 2 branches missed.">			if(counter==0){</span>
<span class="nc" id="L290">				e_saMap = PeopleSkillModelHandler.getSkillAssignments(m_context,empIDs, agent1shiftDate, agent1shiftDate);</span>
			}
			else{
<span class="nc" id="L293">				e_saMap = PeopleSkillModelHandler.getSkillAssignments(m_context,empIDs, agent2shiftDate, agent2shiftDate);</span>
			}
<span class="nc bnc" id="L295" title="All 2 branches missed.">			for (Iterator it1 = m_empIDs.iterator(); it1.hasNext();) {</span>
<span class="nc" id="L296">				ID empID = (ID) it1.next();</span>
<span class="nc" id="L297">				Collection saList = (Collection) e_saMap.get(empID);</span>
<span class="nc bnc" id="L298" title="All 4 branches missed.">				if (saList != null &amp;&amp; !saList.isEmpty()) {</span>
<span class="nc" id="L299">					Map s_saMap = createSkillsMap(saList);</span>
<span class="nc" id="L300">					m_eSkillAssignMap.put(empID, s_saMap);</span>
<span class="nc" id="L301">					skillIDset.addAll(s_saMap.keySet());</span>
				}
<span class="nc" id="L303">			}</span>
<span class="nc" id="L304">			counter++;</span>
			
<span class="nc" id="L306">	        }</span>
<span class="nc" id="L307">	       return skillIDset;</span>
		}


	/**
	 * Filter Employees that user does not have privilege to view Skills
	 */
	private Collection filterEmpIDs(Collection empIDs, Map eOrgMap) {
<span class="nc bnc" id="L315" title="All 4 branches missed.">		if (empIDs == null || empIDs.isEmpty()) {</span>
<span class="nc" id="L316">			return Collections.emptyList();</span>
		}

<span class="nc" id="L319">		boolean hasEmpFiltered = false;</span>
<span class="nc" id="L320">		List filteredIDs = new ArrayList(empIDs.size());</span>
<span class="nc bnc" id="L321" title="All 2 branches missed.">		for (Iterator it = empIDs.iterator(); it.hasNext();) {</span>
<span class="nc" id="L322">			ID empID = (ID) it.next();</span>
<span class="nc bnc" id="L323" title="All 2 branches missed.">			if (PeopleSkillUtil.isAuthToViewEmpSkillInfo(m_user, empID, eOrgMap)) {</span>
<span class="nc" id="L324">				filteredIDs.add(empID);</span>
			} else {
<span class="nc" id="L326">				hasEmpFiltered = true;</span>
			}
<span class="nc" id="L328">		}</span>

<span class="nc bnc" id="L330" title="All 4 branches missed.">		if (hasEmpFiltered &amp;&amp; !m_isFilteredMsgAdded) {</span>
<span class="nc" id="L331">			m_isFilteredMsgAdded = true;</span>
<span class="nc" id="L332">			addPageMessage(Message.WARNING_TYPE,</span>
					BbmWebBundleKey.SOME_INFO_WERE_FILTERED_DUE_TO_AUTH,
					BbmWebBundleKey.BUNDLE_NAME);
		}

<span class="nc" id="L337">		return filteredIDs;</span>
	}

	/**
	 * Skill Map of Skill ID and Skill Assignements
	 */
	private Map createSkillsMap(Collection saList) {
<span class="nc" id="L344">		HashMap resultMap = new HashMap(saList.size());</span>

<span class="nc bnc" id="L346" title="All 2 branches missed.">		for (Iterator it = saList.iterator(); it.hasNext();) {</span>
<span class="nc" id="L347">			SkillAssignment sa = (SkillAssignment) it.next();</span>
<span class="nc" id="L348">			ID skillID = sa.getSkillID();</span>
<span class="nc" id="L349">			resultMap.put(skillID, sa);</span>
<span class="nc" id="L350">		}</span>

<span class="nc" id="L352">		return resultMap;</span>
	}

	/**
	 * Prepare content title for rendering
	 */
	protected void initContentTitle() {
<span class="nc" id="L359">		String pageTitle = i18n(m_common_bundle, UIFWebBundleKey.VIEW_DETAILS);</span>
<span class="nc" id="L360">		String itemName = i18n(m_bundle, BbmWebBundleKey.BBM_PEOPLE_SKILLS);</span>
<span class="nc" id="L361">		m_contentTitlePC.setPageTitle(pageTitle);</span>
<span class="nc" id="L362">		m_contentTitlePC.setItemName(itemName);</span>
<span class="nc" id="L363">	}</span>

	/**
	 * Initialize List
	 */
	protected void initList() {
<span class="nc" id="L369">		m_listPC.setEnabled(false);</span>
<span class="nc" id="L370">		initHeader();</span>

<span class="nc" id="L372">		List listModel = new ArrayList(5);</span>
<span class="nc" id="L373">		addEmpNameRow(listModel);</span>
<span class="nc" id="L374">		addSkillRows(listModel);</span>
<span class="nc" id="L375">		m_listPC.setListModel(listModel);</span>
<span class="nc bnc" id="L376" title="All 2 branches missed.">		if (isAccessibilityComplianceMode()) {</span>
<span class="nc" id="L377">			m_listPC.setRenderJavaScriptIfDisabled(true);</span>
<span class="nc" id="L378">			m_listPC.setUseWrapper(true);</span>
<span class="nc" id="L379">			m_listPC.addTableArrowNavigation();</span>
<span class="nc" id="L380">			m_listPC.setReadableRowInfoEnabled(true);</span>
<span class="nc" id="L381">			m_listPC.disableRepeatHeader();</span>
		}
<span class="nc" id="L383">	}</span>

	/**
	 * Initialize Header
	 */
	private void initHeader() {
<span class="nc" id="L389">		TableHeaderPC header = m_listPC.getHeader();</span>

<span class="nc" id="L391">		String skillLabel = i18n(m_bundle, BbmWebBundleKey.BBM_PEOPLE_SKILLS);</span>
<span class="nc" id="L392">		header.addColumnHeaderData(null, skillLabel);</span>

<span class="nc" id="L394">		int profColSize = m_empIDs.size() + m_empTplIDs.size();</span>
<span class="nc" id="L395">		String proficiencyLabel = i18n(m_bundle, BbmWebBundleKey.PEOPLE_SKILLS_PROFICIENCY);</span>
<span class="nc" id="L396">		GenericHeaderData hData = header.addColumnHeaderData(null, proficiencyLabel);</span>
<span class="nc" id="L397">		hData.setColSpan(profColSize);</span>
<span class="nc" id="L398">		hData.setHeaderClass(CSSUtil.CLASS_HEADER_CENTER);</span>
<span class="nc" id="L399">	}</span>

	/**
	 * Add Employee Name Row
	 */
	private void addEmpNameRow(List listModel) {
<span class="nc" id="L405">		DefaultMultiColumnNodeData row_data = new DefaultMultiColumnNodeData();</span>
<span class="nc" id="L406">		row_data.add(&quot;&quot;);</span>

		// handle Employees
<span class="nc bnc" id="L409" title="All 2 branches missed.">		for (Iterator it = m_empIDs.iterator(); it.hasNext();) {</span>
<span class="nc" id="L410">			ID empID = (ID) it.next();</span>
<span class="nc" id="L411">			EmployeeName eName = (EmployeeName) m_empNameMap.get(empID);</span>

<span class="nc" id="L413">			String name = &quot;&lt;nobr&gt;&lt;b&gt;&quot; + m_localizer.formatName(eName) + &quot;&lt;/b&gt;&lt;/nobr&gt;&quot;;</span>
<span class="nc" id="L414">			row_data.add(name, DATA_STYLE);</span>
<span class="nc" id="L415">		}</span>

		// handle Employee Templates
<span class="nc bnc" id="L418" title="All 2 branches missed.">		for (Iterator it = m_empTplIDs.iterator(); it.hasNext();) {</span>
<span class="nc" id="L419">			ID etID = (ID) it.next();</span>
<span class="nc" id="L420">			String eName = (String) m_eTplNameMap.get(etID);</span>

<span class="nc" id="L422">			String name = &quot;&lt;nobr&gt;&lt;b&gt;&quot; + eName + &quot;&lt;/b&gt;&lt;/nobr&gt;&quot;;</span>
<span class="nc" id="L423">			row_data.add(name, DATA_STYLE);</span>
<span class="nc" id="L424">		}</span>

<span class="nc" id="L426">		listModel.add(row_data);</span>
<span class="nc" id="L427">	}</span>

	protected void setSkills(Collection&lt;Skill&gt; skills) {
<span class="nc" id="L430">		m_skills = skills;</span>
<span class="nc" id="L431">	}</span>

	/**
	 * Add Skill Rows
	 */
	private void addSkillRows(List listModel) {
<span class="nc bnc" id="L437" title="All 2 branches missed.">		if (m_skills.isEmpty()) {</span>
<span class="nc" id="L438">			return;</span>
		}
<span class="nc bnc" id="L440" title="All 2 branches missed.">		for (Iterator it = m_skills.iterator(); it.hasNext();) {</span>
<span class="nc" id="L441">			Skill skill = (Skill) it.next();</span>
<span class="nc" id="L442">			addSkillRow(listModel, skill);</span>
<span class="nc" id="L443">		}</span>
<span class="nc" id="L444">	}</span>

	/**
	 * Add Skill Row for a given Skill
	 */
	private void addSkillRow(List listModel, Skill skill) {
<span class="nc" id="L450">		DefaultMultiColumnNodeData row_data = new DefaultMultiColumnNodeData();</span>
<span class="nc" id="L451">		row_data.add(&quot;&lt;nobr&gt;&quot; + skill.getName() + &quot;&lt;/nobr&gt;&quot;);</span>

		// handle employees
<span class="nc bnc" id="L454" title="All 2 branches missed.">		for (Iterator it = m_empIDs.iterator(); it.hasNext();) {</span>
<span class="nc" id="L455">			ID empID = (ID) it.next();</span>

      // Determine whether User can view Employees' Proficiency
<span class="nc" id="L458">			boolean isProfViewable = PeopleSkillUtil.isAuthToViewEmpSnPInfo(m_user, empID, m_eOrgMap);</span>
<span class="nc bnc" id="L459" title="All 2 branches missed.">			if (!isProfViewable) {</span>
<span class="nc" id="L460">				row_data.add(m_notAvailableMsg, DATA_STYLE);</span>
<span class="nc" id="L461">				continue;</span>
			}

      // Create Proficiency Display
<span class="nc" id="L465">			SkillAssignment sa = null;</span>
<span class="nc" id="L466">			Map s_saMap = (Map) m_eSkillAssignMap.get(empID);</span>
<span class="nc bnc" id="L467" title="All 2 branches missed.">			if (s_saMap != null) {</span>
<span class="nc" id="L468">				sa = (SkillAssignment) s_saMap.get(skill.getID());</span>
			}

<span class="nc bnc" id="L471" title="All 2 branches missed.">			String proficiency = (sa != null) ? m_localizer.formatNumber(sa.getProficiency(), 1) : &quot;&quot;;</span>
<span class="nc" id="L472">			row_data.add(proficiency, DATA_STYLE);</span>
<span class="nc" id="L473">		}</span>

		// handle employee templates
<span class="nc bnc" id="L476" title="All 2 branches missed.">		for (Iterator it = m_empTplIDs.iterator(); it.hasNext();) {</span>
<span class="nc" id="L477">			ID etID = (ID) it.next();</span>

      // Determine whether User can view Employees' Proficiency
<span class="nc" id="L480">			boolean isProfViewable = PeopleSkillUtil.isAuthToViewEmpTemplateSnPInfo(m_user, etID, m_eTplOrgMap);</span>
<span class="nc bnc" id="L481" title="All 2 branches missed.">			if (!isProfViewable) {</span>
<span class="nc" id="L482">				row_data.add(m_notAvailableMsg, DATA_STYLE);</span>
<span class="nc" id="L483">				continue;</span>
			}

      // Create Proficiency Display
<span class="nc" id="L487">			SkillAssignment sa = null;</span>
<span class="nc" id="L488">			Map s_saMap = (Map) m_eTplSkillAssignMap.get(etID);</span>
<span class="nc bnc" id="L489" title="All 2 branches missed.">			if (s_saMap != null) {</span>
<span class="nc" id="L490">				sa = (SkillAssignment) s_saMap.get(skill.getID());</span>
			}

<span class="nc bnc" id="L493" title="All 2 branches missed.">			String proficiency = (sa != null) ? m_localizer.formatNumber(sa.getProficiency(), 1) : &quot;&quot;;</span>
<span class="nc" id="L494">			row_data.add(proficiency, DATA_STYLE);</span>
<span class="nc" id="L495">		}</span>

<span class="nc" id="L497">		listModel.add(row_data);</span>
<span class="nc" id="L498">	}</span>


	/**
	 * Return URL for HTML Form Action
	 */
	@Override
	public String getFormAction() {
<span class="nc" id="L506">		return REQUEST_HANDLER;</span>
	}

	/**
	 * Set Employee IDs separated by comma
	 */
	public void setEmployeeID(String sEmpIDs) {
<span class="nc" id="L513">		m_sEmpIDs = sEmpIDs;</span>
<span class="nc" id="L514">		m_empIDs = StringUtil.parseIDStringToCollection(sEmpIDs);</span>
<span class="nc" id="L515">	}</span>

	/**
	 * Set Employee Template IDs separated by comma
	 */
	public void setEmpTemplateID(String sEmpTemplateIDs) {
<span class="nc" id="L521">		m_sEmpTplIDs = sEmpTemplateIDs;</span>
<span class="nc" id="L522">		m_empTplIDs = StringUtil.parseIDStringToCollection(sEmpTemplateIDs);</span>
<span class="nc" id="L523">	}</span>

	/**
	 * Return HTML Display
	 */
	@Override
	public String getHtmlDisplay() {
<span class="nc" id="L530">		return m_listPC.getHtmlDisplay();</span>
	}

	@Override
	public String getRequiredHTML() {
<span class="nc" id="L535">		return super.getRequiredHTML() +</span>
<span class="nc" id="L536">				HtmlUtil.makeHiddenInput(&quot;employeeID&quot;, m_sEmpIDs) +</span>
<span class="nc" id="L537">				HtmlUtil.makeHiddenInput(&quot;empTemplateID&quot;, m_sEmpTplIDs);</span>
	}
	//QC-96672  changes
	public void setShiftDate1(String shiftDate1) {
<span class="nc" id="L541">		m_sShiftDate1 = shiftDate1;</span>
<span class="nc" id="L542">	}</span>

	

	public void setShiftDate2(String shiftDate2) {
<span class="nc" id="L547">		m_sShiftDate2 = shiftDate2;</span>
<span class="nc" id="L548">	}</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>