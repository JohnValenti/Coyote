<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>FTECalculation.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.ejb.bbm.campaign.model</a> &gt; <span class="el_source">FTECalculation.java</span></div><h1>FTECalculation.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.ejb.bbm.campaign.model;

/**
 * Title:        Blue Pumpkin Software Basic Business Model
 * Description:  static class contains the FTE Calculator logic
 * Copyright:    Copyright (c) 2002
 * Company:      Blue Pumpkin Software, inc
 * @author       Jason Fama
 * @version      1.0
 */

import java.util.ArrayList;
import java.util.Collection;
import java.util.HashMap;
import java.util.HashSet;
import java.util.Iterator;
import java.util.List;
import java.util.Map;
import java.util.Set;

import com.bluepumpkin.common.datatypes.ID;
import com.verint.ejb.bbm.forecast.model.ForecastProfileProject;

<span class="nc" id="L24">public class FTECalculation implements java.io.Serializable {</span>
	static final long serialVersionUID = 1L;

<span class="nc" id="L27">	protected int m_nRequired = 0;</span>
<span class="nc" id="L28">	protected int m_nScheduledContact = 0;</span>
<span class="nc" id="L29">	protected int m_nScheduledPaid = 0;</span>
<span class="nc" id="L30">	protected int m_nMinConcurrant = 99999;</span>
<span class="nc" id="L31">	protected int m_nMaxConcurrant = 0;</span>
<span class="nc" id="L32">	protected double m_dScheduledCost = 0.0;</span>

<span class="nc" id="L34">	protected HashMap&lt;ID, TemplateStat&gt; m_hTemplateStats = new HashMap&lt;ID, TemplateStat&gt;();</span>

	protected Collection&lt;ForecastProfileProject&gt; m_projects; // Collection of
																// ForecastProfileProject's.
																// If not null,
																// we also
																// calculate the
																// Project
																// Statistics.
	protected Map&lt;ID, Set&lt;ID&gt;&gt; m_projectEmployees; // maps the projectIDs to a
													// set of
	// workResourceIDs that are
	// scheduled to work on those
	// projects
	protected Map&lt;ID, Integer&gt; m_projectScheduled; // maps the projectIDs to the
													// amount
	// of time that workResources are
	// scheduled to work on those
	// projects
	protected Map&lt;ID, Double&gt; m_projectCost; // maps the projectIDs to the cost
												// of
	// having the workResources work on
	// those projects
	protected List&lt;List&lt;?&gt;&gt; m_projectStats; // a two-dimensional ArrayList of
											// rows
	// and columns for the Project
	// Statistics table
	protected Map&lt;ID, String&gt; m_projectQueueIdNameMap; // a map of project queue
														// DEID's to
	// names
	protected Map&lt;ID, ID&gt; m_projectQueueIdSIDMap; // a map of project queue
													// DEID's to
	// SID's
	protected Map&lt;ID, Collection&lt;ID&gt;&gt; m_activityQueues; // a map of activityIDs
														// (SID) to queueIDs

	// (SID) for the project queues

	public int getContactMinutesRequired() {
<span class="nc" id="L73">		return m_nRequired;</span>
	}

	public int getContactMinutesScheduled() {
<span class="nc" id="L77">		return m_nScheduledContact;</span>
	}

	public int getPaidMinutesScheduled() {
<span class="nc" id="L81">		return m_nScheduledPaid;</span>
	}

	public int getMaxConcurrantScheduled() {
<span class="nc" id="L85">		return m_nMaxConcurrant;</span>
	}

	public int getMinConcurrantScheduled() {
<span class="nc" id="L89">		return m_nMinConcurrant;</span>
	}

	public double getScheduledHourlyCost() {
<span class="nc" id="L93">		return m_dScheduledCost;</span>
	}

	// Template Statistic-related methods

	public TemplateStat addTemplateStat() {
<span class="nc" id="L99">		return new TemplateStat();</span>
	}

	public TemplateStat addTemplateStat(String name) {
<span class="nc" id="L103">		return new TemplateStat(name);</span>
	}

	public Collection&lt;ID&gt; getTemplateIDs() {
<span class="nc" id="L107">		return m_hTemplateStats.keySet();</span>
	}

	public String getTemplateName(ID idTemplate) {
<span class="nc" id="L111">		return m_hTemplateStats.get(idTemplate).sName;</span>
	}

	public int getContactHoursScheduled(ID idTemplate) {
<span class="nc" id="L115">		return m_hTemplateStats.get(idTemplate).nContactHours;</span>
	}

	public int getPaidHoursScheduled(ID idTemplate) {
<span class="nc" id="L119">		return m_hTemplateStats.get(idTemplate).nPaidHours;</span>
	}

	public int getNumberScheduled(ID idTemplate) {
<span class="nc" id="L123">		return m_hTemplateStats.get(idTemplate).nNumberScheduled;</span>
	}

	public double getScheduledHourlyCost(ID idTemplate) {
<span class="nc" id="L127">		return m_hTemplateStats.get(idTemplate).dHourlyCost;</span>
	}

	/**
	 * Store the projects and initialize the m_projectEmployees,
	 * m_projectScheduled, m_projectCost maps.
	 * 
	 * @param projects
	 *            - Collection of ForecastProfileProject's. If not null, we also
	 *            calculate the Project Statistics.
	 * @param projectQueueIdNameMap
	 *            - a map of project queue DEID's to names
	 * @param projectQueueIdSIDMap
	 *            - a map of project queue DEID to SID
	 */
	public void initProjectStatistics(Collection&lt;ForecastProfileProject&gt; projects, Map&lt;ID, String&gt; projectQueueIdNameMap,
			Map&lt;ID, ID&gt; projectQueueIdSIDMap, Map&lt;ID, Collection&lt;ID&gt;&gt; hActivityQueues) {
<span class="nc bnc" id="L144" title="All 2 branches missed.">		if (projects != null) {</span>
<span class="nc" id="L145">			m_projects = projects;</span>
<span class="nc" id="L146">			m_projectEmployees = new HashMap&lt;ID, Set&lt;ID&gt;&gt;(projects.size());</span>
<span class="nc" id="L147">			m_projectScheduled = new HashMap&lt;ID, Integer&gt;(projects.size());</span>
<span class="nc" id="L148">			m_projectCost = new HashMap&lt;ID, Double&gt;(projects.size());</span>
<span class="nc" id="L149">			m_activityQueues = hActivityQueues;</span>

<span class="nc bnc" id="L151" title="All 2 branches missed.">			for (Iterator&lt;ForecastProfileProject&gt; projectIt = projects.iterator(); projectIt.hasNext();) {</span>
<span class="nc" id="L152">				ForecastProfileProject project = projectIt.next();</span>
<span class="nc" id="L153">				ID projectID = project.getID();</span>
<span class="nc" id="L154">				m_projectEmployees.put(projectID, new HashSet&lt;ID&gt;());</span>
<span class="nc" id="L155">			}</span>

<span class="nc" id="L157">			m_projectQueueIdNameMap = projectQueueIdNameMap;</span>
<span class="nc" id="L158">			m_projectQueueIdSIDMap = projectQueueIdSIDMap;</span>
		}
<span class="nc" id="L160">	}</span>

	/**
	 * Add a workResourceID to the m_projectEmployees map.
	 * 
	 * @param projectID
	 * @param workResourceID
	 */
	public void addProjectEmployee(ID projectID, ID workResourceID) {
<span class="nc" id="L169">		Set&lt;ID&gt; emps = m_projectEmployees.get(projectID);</span>
<span class="nc" id="L170">		emps.add(workResourceID);</span>
<span class="nc" id="L171">	}</span>

	/**
	 * Add a number of scheduled seconds to a project.
	 * 
	 * @param projectID
	 * @param seconds
	 *            - the number of scheduled seconds to add to the project.
	 */
	public void addProjectScheduled(ID projectID, int seconds) {
<span class="nc" id="L181">		Integer old = m_projectScheduled.get(projectID);</span>
<span class="nc bnc" id="L182" title="All 2 branches missed.">		if (old == null) {</span>
<span class="nc" id="L183">			m_projectScheduled.put(projectID, new Integer(seconds));</span>
		} else {
<span class="nc" id="L185">			m_projectScheduled.put(projectID, new Integer(old.intValue() + seconds));</span>
		}
<span class="nc" id="L187">	}</span>

	/**
	 * Add a cost (double float) to a project.
	 * 
	 * @param projectID
	 * @param seconds
	 *            - the number of scheduled seconds to add to the project.
	 */
	public void addProjectCost(ID projectID, double cost) {
<span class="nc" id="L197">		Double old = m_projectCost.get(projectID);</span>
<span class="nc bnc" id="L198" title="All 2 branches missed.">		if (old == null) {</span>
<span class="nc" id="L199">			m_projectCost.put(projectID, new Double(cost));</span>
		} else {
<span class="nc" id="L201">			m_projectCost.put(projectID, new Double(old.doubleValue() + cost));</span>
		}
<span class="nc" id="L203">	}</span>

	/**
	 * Get stats for the Project Statistics table (only relevant when the SP has
	 * a Project media queue linked to it)
	 * 
	 * @return a two-dimensional ArrayList of rows and columns for the Project
	 *         Statistics table. The 1st dimension is for the projects
	 *         themselves (sorted?? by project name then startdate), and the 2nd
	 *         dimension is for the project statistics, in the following order:
	 *         PRJ_COL_QUEUE_NAME = 0; PRJ_COL_START_DATE = 1; PRJ_COL_END_DATE
	 *         = 2; PRJ_COL_EMPLOYEES_SCHEDULED = 3;
	 *         PRJ_COL_ASSIGNMENT_REQUESTED = 4; PRJ_COL_ASSIGNMENT_SCHEDULED =
	 *         5; PRJ_COL_OVERAGE_UNDERAGE = 6; PRJ_COL_COST = 7;
	 */
	public List&lt;List&lt;?&gt;&gt; getProjectStatistics() {
<span class="nc bnc" id="L219" title="All 2 branches missed.">		if (m_projects != null) {</span>
<span class="nc" id="L220">			m_projectStats = new ArrayList&lt;List&lt;?&gt;&gt;(m_projects.size());</span>

<span class="nc bnc" id="L222" title="All 2 branches missed.">			for (Iterator&lt;ForecastProfileProject&gt; projectIt = m_projects.iterator(); projectIt.hasNext();) {</span>
<span class="nc" id="L223">				ForecastProfileProject project = projectIt.next();</span>
<span class="nc" id="L224">				ID projectID = project.getID();</span>

<span class="nc" id="L226">				ArrayList&lt;Object&gt; curRow = new ArrayList&lt;Object&gt;(9);</span>

				// project queue name
<span class="nc" id="L229">				curRow.add(m_projectQueueIdNameMap.get(project.getQueueID()));</span>

				// project window start/end dates
<span class="nc" id="L232">				curRow.add(project.getStartTime());</span>
<span class="nc" id="L233">				curRow.add(project.getEndTime());</span>

				// the size tells us the number of employees assigned to this
				// project
<span class="nc" id="L237">				curRow.add((m_projectEmployees.get(projectID)).size());</span>

				// the amount of time required to be worked on this project
<span class="nc" id="L240">				Double assignmentRequested = new Double(project.getTotalDuration() / 6000.0d);</span>
<span class="nc" id="L241">				curRow.add(assignmentRequested);</span>

				// the amount of time actually scheduled to be worked on this
				// project
<span class="nc" id="L245">				Integer iScheduled = m_projectScheduled.get(projectID);</span>
<span class="nc bnc" id="L246" title="All 2 branches missed.">				iScheduled = iScheduled == null ? new Integer(0) : iScheduled;</span>
<span class="nc" id="L247">				Double assignmentScheduled = new Double(iScheduled / 3600.0d);</span>
<span class="nc" id="L248">				curRow.add(assignmentScheduled);</span>

				// overage/underage of scheduled project time
<span class="nc" id="L251">				curRow.add(assignmentScheduled - assignmentRequested);</span>

				// how much it will cost for the scheduled employees to work on
				// this project
<span class="nc" id="L255">				Double cost = m_projectCost.get(projectID);</span>
<span class="nc bnc" id="L256" title="All 2 branches missed.">				cost = cost == null ? new Double(0.0) : cost;</span>
<span class="nc" id="L257">				curRow.add(cost);</span>

				// add activity
<span class="nc" id="L260">				curRow.add(findActivityID(project.getQueueID()));</span>

<span class="nc" id="L262">				m_projectStats.add(curRow);</span>
<span class="nc" id="L263">			}</span>
		}

<span class="nc" id="L266">		return m_projectStats;</span>
	}

	/**
	 * Return the collection of ForecastProfileProject's for the SP.
	 */
	public Collection&lt;ForecastProfileProject&gt; getProjects() {
<span class="nc" id="L273">		return m_projects;</span>
	}

	private ID findActivityID(ID qID) {
<span class="nc" id="L277">		ID qSID = m_projectQueueIdSIDMap.get(qID);</span>
<span class="nc bnc" id="L278" title="All 2 branches missed.">		if (qSID != null) {</span>
<span class="nc" id="L279">			Map.Entry&lt;ID, Collection&lt;ID&gt;&gt; entry = null;</span>
<span class="nc" id="L280">			Collection&lt;ID&gt; listQs = null;</span>
<span class="nc bnc" id="L281" title="All 2 branches missed.">			for (Iterator&lt;Map.Entry&lt;ID, Collection&lt;ID&gt;&gt;&gt; i = m_activityQueues.entrySet().iterator(); i.hasNext();) {</span>
<span class="nc" id="L282">				entry = i.next();</span>
<span class="nc" id="L283">				listQs = entry.getValue();</span>
<span class="nc bnc" id="L284" title="All 2 branches missed.">				if (listQs.contains(qSID)) {</span>
<span class="nc" id="L285">					return entry.getKey();</span>
				}
			}
		}
<span class="nc" id="L289">		return null;</span>
	}

<span class="nc" id="L292">	protected class TemplateStat implements java.io.Serializable {</span>
		/**
		 * 
		 */
		private static final long serialVersionUID = 1L;
<span class="nc" id="L297">		String sName = &quot;&quot;;</span>
<span class="nc" id="L298">		int nNumberScheduled = 0;</span>
<span class="nc" id="L299">		int nPaidHours = 0;</span>
<span class="nc" id="L300">		int nContactHours = 0;</span>
<span class="nc" id="L301">		double dHourlyCost = 0.0;</span>

<span class="nc" id="L303">		protected TemplateStat() {</span>
<span class="nc" id="L304">		}</span>

<span class="nc" id="L306">		protected TemplateStat(String name) {</span>
<span class="nc" id="L307">			sName = name;</span>
<span class="nc" id="L308">		}</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>