<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>HoursPopupPM.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.verint.web.fs.workrules.assignment</a> &gt; <span class="el_source">HoursPopupPM.java</span></div><h1>HoursPopupPM.java</h1><pre class="source lang-java linenums">package com.verint.web.fs.workrules.assignment;

import com.bluepumpkin.common.datatypes.Duration;
import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.LocalDate;
import com.bluepumpkin.common.datatypes.ScopeID;
import com.bluepumpkin.common.l10n.RegionalFormatBundleKey;
import com.bluepumpkin.common.util.ArrayUtil;
import com.bluepumpkin.common.util.StringUtil;
import com.bluepumpkin.common.util.TimeZoneUtil;
import com.bluepumpkin.ejb.bbm.BbmManagerFactory;
import com.bluepumpkin.ejb.bbm.empworkrule.ejb.EmpWorkRuleManager;
import com.bluepumpkin.ejb.bbm.empworkrule.model.WorkResourceMinMaxHour;
import com.bluepumpkin.ejb.bbm.people.model.EmployeeLocal;
import com.bluepumpkin.ejb.bbm.workresource.ejb.WorkResourceManager;
import com.bluepumpkin.ejb.bbm.workresource.model.Employee;
import com.bluepumpkin.ejb.bbm.workresource.model.SecureFieldInfo;
import com.bluepumpkin.web.bbm.keys.BbmJavaScriptFileID;
import com.bluepumpkin.web.bbm.people.profile.ProfileModelHandler;
import com.bluepumpkin.web.bbm.people.profile.effectivedate.BasePageModel;
import com.bluepumpkin.web.bbm.people.profile.effectivedate.DataContainerPC;
import com.bluepumpkin.web.fs.l10n.FsWebBundleKey;
import com.verint.ejb.wfm.WfmManagerFactory;
import com.witness.ejb.core.security.PrivilegeKeys;
import com.witness.ejb.core.security.Scope;
import com.witness.web.uif.keys.JavaScriptFileID;
import com.witness.web.uif.pagecomponent.DefaultMultiColumnNodeData;
import com.witness.web.uif.pagecomponent.MultiColumnNodeData;
import com.witness.web.uif.pagecomponent.picker.time.DurationSpinnerPC;
import com.witness.web.uif.pagecomponent.table.TableHeaderPC;
import com.witness.web.uif.pagemodel.PageModel;
import com.witness.web.uif.system.RequestContext;

import javax.servlet.http.HttpServletRequest;
import java.util.*;

public class HoursPopupPM extends BasePageModel {
	private static final long serialVersionUID = 1L;

	// Param names
	static final String PARAM_MIN_PAID_NAME = &quot;minName&quot;;
	static final String PARAM_MAX_PAID_NAME = &quot;maxName&quot;;
	static final String PARAM_OT_PER_DAY_NAME = &quot;otDayName&quot;;
	static final String PARAM_OT_PER_WEEK_NAME = &quot;otWeekName&quot;;
	static final String PARAM_VTO_PER_DAY_NAME = &quot;vtoDayName&quot;;
	static final String PARAM_VTO_PER_WEEK_NAME = &quot;vtoWeekName&quot;;
	static final String PARAM_UPDATE_MODE_NAME = &quot;updateModeName&quot;;
	static final String PARAM_DATES_MODIFIED_NAME = &quot;datesModifiedName&quot;;
	static final String PARAM_START_NAME = &quot;startName&quot;;
	static final String PARAM_END_NAME = &quot;endName&quot;;

	// RP prefix is for request parameters
	private String rp_minName, rp_maxName, rp_otDayName, rp_otWeekName, rp_vtoDayName, rp_vtoWeekName, rp_updateModeName, rp_startName, rp_endName;
	private String rp_updateMode, rp_datesModifiedName;

<span class="fc" id="L56">	static String HOURS_POPUP_ID = &quot;HOURS_POPUP_ID&quot;;</span>
<span class="fc" id="L57">	static String PARAM_PERIOD_ONLY = &quot;periodOnly&quot;;</span>
<span class="fc" id="L58">	static String PARAM_START = &quot;start&quot;;</span>
<span class="fc" id="L59">	static String PARAM_END = &quot;end&quot;;</span>

	//key = employee ID
<span class="nc" id="L62">	private HashMap&lt;ID, Employee&gt; employeeMap = new HashMap&lt;&gt;();</span>
<span class="nc" id="L63">	private ID[] selectedIDs = new ID[0];</span>
<span class="nc" id="L64">	private boolean periodOnly = false;</span>
<span class="nc" id="L65">	private Date start = new Date(), end = new Date(start.getTime() + (24 * 60 * 60 * 1000));</span>

	// Page Components
	private DurationSpinnerPC pc_minPaid;
	private DurationSpinnerPC pc_maxPaid;
	private DurationSpinnerPC pc_otDay;
	private DurationSpinnerPC pc_otWeek;
	private DurationSpinnerPC pc_vtoDay;
	private DurationSpinnerPC pc_vtoWeek;

	private MyDataContainer pc_dataContainer;

	private Map&lt;ID, List&lt;Integer&gt;&gt; authorizedViewFields;
	private Map&lt;ID, List&lt;Integer&gt;&gt; authorizedEditFields;

<span class="nc" id="L80">	private HashMap&lt;ID, List&lt;WorkResourceMinMaxHour&gt;&gt; hoursAssignments = new HashMap&lt;&gt;();</span>

	public HoursPopupPM(RequestContext context) {
<span class="nc" id="L83">		super(context, &quot;hoursPopupPM_updateParent();&quot;);</span>

<span class="nc" id="L85">		addRequiredJavaScriptFile(JavaScriptFileID.JQUERY);</span>
<span class="nc" id="L86">		addRequiredJavaScriptFile(BbmJavaScriptFileID.EFFECTIVE_DATES_UTIL);</span>
<span class="nc" id="L87">	}</span>

	@Override
	public boolean extractParameters(HttpServletRequest request) {
		// The popup manager names dynamic parameters to be the same name as the
		// form input name in the parent page, so extract the name first to get the value
<span class="nc" id="L93">		String updateModeName = request.getParameter(PARAM_UPDATE_MODE_NAME);</span>
<span class="nc bnc" id="L94" title="All 2 branches missed.">		if (!StringUtil.isEmpty(updateModeName)) {</span>
<span class="nc" id="L95">			String updateMode = request.getParameter(updateModeName);</span>
<span class="nc bnc" id="L96" title="All 2 branches missed.">			if (!StringUtil.isEmpty(updateMode)) {</span>
<span class="nc" id="L97">				setUpdateMode(updateMode);</span>
			}
		}

<span class="nc" id="L101">		boolean retVal = super.extractParameters(request);</span>

<span class="nc bnc" id="L103" title="All 2 branches missed.">		if (!StringUtil.isEmpty(selectedID)) {</span>
<span class="nc" id="L104">			selectedIDs = StringUtil.parseIDString(selectedID);</span>
		}

<span class="nc bnc" id="L107" title="All 2 branches missed.">		if (selectedIDs.length &gt; 1) {</span>
<span class="nc" id="L108">			m_isMultiEdit = true;</span>
<span class="nc" id="L109">			pc_dataContainer.setIsMultiEdit(true);</span>
		}

<span class="nc" id="L112">		return retVal;</span>
	}

	@Override
	protected void initializeModel() {
<span class="nc" id="L117">		super.initializeModel();</span>
<span class="nc bnc" id="L118" title="All 2 branches missed.">		if (m_isInitialized) {</span>
<span class="nc" id="L119">			return;</span>
		}
<span class="nc" id="L121">		m_isInitialized = true;</span>

		try {
<span class="nc bnc" id="L124" title="All 2 branches missed.">			if (selectedIDs.length &gt; 0) {</span>
<span class="nc" id="L125">				setIsNewPerson(false);</span>

<span class="nc" id="L127">				initializeEmployeeData();</span>
<span class="nc" id="L128">				initializeSecureFieldMetaData();</span>
<span class="nc" id="L129">				initializeTableHeader();</span>

<span class="nc" id="L131">				EmpWorkRuleManager ewrm = WfmManagerFactory.getEmpWorkRuleManager(m_context.isInWhatIfMode());</span>
<span class="nc" id="L132">				Date historyStart = new Date(new Date().getTime() - (100L * 365 * 24 * 60 * 60 * 1000)), historyEnd = new Date(new Date().getTime() + (100L * 365 * 24 * 60 * 60 * 1000));</span>
<span class="nc" id="L133">				hoursAssignments = ewrm.getMinMaxHourAssignments(Arrays.asList(selectedIDs), historyStart, historyEnd);</span>

				//Default those that have no entry
<span class="nc bnc" id="L136" title="All 2 branches missed.">				for (Employee emp : employeeMap.values()) {</span>
<span class="nc bnc" id="L137" title="All 2 branches missed.">				    if(!hoursAssignments.containsKey(emp.getID())){</span>
<span class="nc" id="L138">					List&lt;WorkResourceMinMaxHour&gt; hoursList = WorkResourceMinMaxHour.getDefaultWorkResourceMinMaxHourAssignmentList(emp.getID(), emp.getStartTime());</span>
<span class="nc" id="L139">					hoursAssignments.put(emp.getID(), hoursList);</span>
				    }
<span class="nc" id="L141">				}</span>
				
				// This should never happen since we now default everyone above
<span class="nc bnc" id="L144" title="All 2 branches missed.">				if (hoursAssignments.size() == 0) {</span>
<span class="nc bnc" id="L145" title="All 2 branches missed.">					if (periodOnly) {</span>
<span class="nc" id="L146">						pc_dataContainer.setShowAsDate(new LocalDate(start, TimeZoneUtil.GMT_TIMEZONE));</span>
					} else {
						//This will populate the local start/termination dates for the employee
<span class="nc" id="L149">						EmployeeLocal.convertEffectivitiesToLocalDate(m_employee);</span>
<span class="nc" id="L150">						pc_dataContainer.setShowAsDate(m_employee.getStartTimeLocal());</span>
					}
				} else {
<span class="nc" id="L153">					LocalDate earliestEffectiveStartDate = getEffectiveStartDateForViewPeriod();</span>
<span class="nc bnc" id="L154" title="All 2 branches missed.">					if (earliestEffectiveStartDate != null) {</span>
<span class="nc bnc" id="L155" title="All 2 branches missed.">						if (periodOnly) {</span>
<span class="nc" id="L156">							pc_dataContainer.setShowAsDate(new LocalDate(start, TimeZoneUtil.GMT_TIMEZONE));</span>
						} else {
<span class="nc" id="L158">							pc_dataContainer.setShowAsDate(earliestEffectiveStartDate);</span>
						}
					}
				}
<span class="nc bnc" id="L162" title="All 2 branches missed.">				if (periodOnly) {</span>
<span class="nc" id="L163">					pc_dataContainer.setViewPeriodEndDate(new LocalDate(end, TimeZoneUtil.GMT_TIMEZONE));</span>
				}
<span class="nc bnc" id="L165" title="All 2 branches missed.">				if (hoursAssignments.size() != 1) {</span>
<span class="nc" id="L166">					getContainers().remove(m_historyPC);</span>
				} else {
<span class="nc" id="L168">					List&lt;MultiColumnNodeData&gt; historyList = m_historyPC.getListModel();</span>
<span class="nc bnc" id="L169" title="All 2 branches missed.">					for (WorkResourceMinMaxHour wrmmh : hoursAssignments.values().iterator().next()) {</span>
<span class="nc" id="L170">						DefaultMultiColumnNodeData mcnd = new DefaultMultiColumnNodeData();</span>
<span class="nc" id="L171">						mcnd.add(m_localizer.formatDate(wrmmh.getStartTime(), m_employee.getTimeZone(wrmmh.getStartTime()),</span>
								RegionalFormatBundleKey.DATE_FORMAT));
<span class="nc bnc" id="L173" title="All 2 branches missed.">						if (wrmmh.getEndTime() == null) {</span>
<span class="nc" id="L174">							mcnd.add(&quot;&quot;);</span>
						} else {
<span class="nc" id="L176">							mcnd.add(m_localizer.formatDate(TimeZoneUtil.previousDay(wrmmh.getEndTime()),</span>
<span class="nc" id="L177">									m_employee.getTimeZone(wrmmh.getEndTime()), RegionalFormatBundleKey.DATE_FORMAT));</span>
						}
<span class="nc bnc" id="L179" title="All 2 branches missed.">						if (isFieldViewable(SecureFieldInfo.SECFLD_EMPLOYEE_MINMAXPAIDHOURS)) {</span>
<span class="nc" id="L180">							mcnd.add(m_localizer.formatDurationInMins(wrmmh.getMinMinutes()));</span>
<span class="nc" id="L181">							mcnd.add(m_localizer.formatDurationInMins(wrmmh.getMaxMinutes()));</span>
						}
<span class="nc bnc" id="L183" title="All 2 branches missed.">						if (isFieldViewable(SecureFieldInfo.SECFLD_EMPLOYEE_MAXOTMINSPERDAY)) {</span>
<span class="nc" id="L184">							mcnd.add(m_localizer.formatDurationInMins(wrmmh.getMaxOTMinutesPerDay()));</span>
						}
<span class="nc bnc" id="L186" title="All 2 branches missed.">						if (isFieldViewable(SecureFieldInfo.SECFLD_EMPLOYEE_MAXOTMINSPERWEEK)) {</span>
<span class="nc" id="L187">							mcnd.add(m_localizer.formatDurationInMins(wrmmh.getMaxOTMinutesPerWeek()));</span>
						}
<span class="nc bnc" id="L189" title="All 2 branches missed.">						if (isFieldViewable(SecureFieldInfo.SECFLD_EMPLOYEE_MAXVTOHOURSPERDAY)) {</span>
<span class="nc" id="L190">							mcnd.add(m_localizer.formatDurationInMins(wrmmh.getMaxVTOHoursPerDay()));</span>
						}
<span class="nc bnc" id="L192" title="All 2 branches missed.">						if (isFieldViewable(SecureFieldInfo.SECFLD_EMPLOYEE_MAXVTOHOURSPERWEEK)) {</span>
<span class="nc" id="L193">							mcnd.add(m_localizer.formatDurationInMins(wrmmh.getMaxVTOHoursPerWeek()));</span>
						}

<span class="nc" id="L196">						historyList.add(mcnd);</span>
<span class="nc" id="L197">					}</span>
				}

<span class="nc" id="L200">				pc_dataContainer.setRows(initializeHoursRows());</span>
<span class="nc" id="L201">				pc_dataContainer.setOnlyViewPeriodEditable(periodOnly);</span>
<span class="nc bnc" id="L202" title="All 2 branches missed.">				if (!StringUtil.isEmpty(rp_updateMode)) {</span>
<span class="nc" id="L203">					pc_dataContainer.setUpdateMode(rp_updateMode);</span>
				}
<span class="nc" id="L205">				setSetButtonEnabled(isAnyFieldEditable());</span>
			}
<span class="nc" id="L207">		} catch (Exception ex) {</span>
<span class="nc" id="L208">			handleUnableToLoadDataError(log, ex);</span>
		} finally {
<span class="nc" id="L210">			initContentTitle();</span>
<span class="nc" id="L211">			initToolbar();</span>
<span class="nc" id="L212">		}</span>
<span class="nc" id="L213">	}</span>


	@Override
	public String getJavaScriptInitCode() {
<span class="nc" id="L218">		StringBuffer jsInit = new StringBuffer(super.getJavaScriptInitCode());</span>

<span class="nc" id="L220">		appendInitJsForSpinnerComponent(jsInit, pc_minPaid, rp_minName, SecureFieldInfo.SECFLD_EMPLOYEE_MINMAXPAIDHOURS);</span>
<span class="nc" id="L221">		appendInitJsForSpinnerComponent(jsInit, pc_maxPaid, rp_maxName, SecureFieldInfo.SECFLD_EMPLOYEE_MINMAXPAIDHOURS);</span>
<span class="nc" id="L222">		appendInitJsForSpinnerComponent(jsInit, pc_otDay, rp_otDayName, SecureFieldInfo.SECFLD_EMPLOYEE_MAXOTMINSPERDAY);</span>
<span class="nc" id="L223">		appendInitJsForSpinnerComponent(jsInit, pc_otWeek, rp_otWeekName, SecureFieldInfo.SECFLD_EMPLOYEE_MAXOTMINSPERWEEK);</span>
<span class="nc" id="L224">		appendInitJsForSpinnerComponent(jsInit, pc_vtoDay, rp_vtoDayName, SecureFieldInfo.SECFLD_EMPLOYEE_MAXVTOHOURSPERDAY);</span>
<span class="nc" id="L225">		appendInitJsForSpinnerComponent(jsInit, pc_vtoWeek, rp_vtoWeekName, SecureFieldInfo.SECFLD_EMPLOYEE_MAXVTOHOURSPERWEEK);</span>

<span class="nc" id="L227">		jsInit.append(&quot;\nhoursPopupPM_updateParent = function () { \n&quot;);</span>

<span class="nc" id="L229">		appendSetterJsForSpinnerComponent(jsInit, pc_minPaid.getName(), rp_minName, SecureFieldInfo.SECFLD_EMPLOYEE_MINMAXPAIDHOURS);</span>
<span class="nc" id="L230">		appendSetterJsForSpinnerComponent(jsInit, pc_maxPaid.getName(), rp_maxName, SecureFieldInfo.SECFLD_EMPLOYEE_MINMAXPAIDHOURS);</span>
<span class="nc" id="L231">		appendSetterJsForSpinnerComponent(jsInit, pc_otDay.getName(), rp_otDayName, SecureFieldInfo.SECFLD_EMPLOYEE_MAXOTMINSPERDAY);</span>
<span class="nc" id="L232">		appendSetterJsForSpinnerComponent(jsInit, pc_otWeek.getName(), rp_otWeekName, SecureFieldInfo.SECFLD_EMPLOYEE_MAXOTMINSPERWEEK);</span>
<span class="nc" id="L233">		appendSetterJsForSpinnerComponent(jsInit, pc_vtoDay.getName(), rp_vtoDayName, SecureFieldInfo.SECFLD_EMPLOYEE_MAXVTOHOURSPERDAY);</span>
<span class="nc" id="L234">		appendSetterJsForSpinnerComponent(jsInit, pc_vtoWeek.getName(), rp_vtoWeekName, SecureFieldInfo.SECFLD_EMPLOYEE_MAXVTOHOURSPERWEEK);</span>

<span class="nc" id="L236">		jsInit.append(&quot;var updateMode = jQuery('[name=&quot;).append(DataContainerPC.UPDATE_MODE_FN).append(&quot;][checked]').val(); \n&quot;)</span>
<span class="nc" id="L237">				.append(&quot;setParentElement('&quot;).append(rp_updateModeName).append(&quot;', updateMode); \n&quot;)</span>
<span class="nc" id="L238">				.append(&quot;setParentElement('&quot;).append(rp_datesModifiedName).append(&quot;', 'true'); \n&quot;)</span>
<span class="nc" id="L239">				.append(&quot;updateEffectiveDates(null, '&quot;).append(rp_startName).append(&quot;', '&quot;).append(rp_endName).append(&quot;'); \n&quot;)</span>

<span class="nc" id="L241">				.append(&quot;window.close();\n&quot;)</span>
<span class="nc" id="L242">				.append(&quot;};\n&quot;);</span>
<span class="nc" id="L243">		return jsInit.toString();</span>
	}

	private void initContentTitle() {
<span class="nc" id="L247">		m_contentTitlePC.setPageTitle(m_localizer.i18n(FsWebBundleKey.BUNDLE_NAME, FsWebBundleKey.FS_HOURS_TITLE));</span>
<span class="nc bnc" id="L248" title="All 2 branches missed.">		if (selectedIDs.length &gt; 1) {</span>
<span class="nc" id="L249">			m_contentTitlePC.setItemName(m_localizer.i18n(FsWebBundleKey.BUNDLE_NAME, FsWebBundleKey.N_PEOPLE, selectedIDs.length));</span>
<span class="nc bnc" id="L250" title="All 2 branches missed.">		} else if (m_employee != null) {</span>
<span class="nc" id="L251">			m_contentTitlePC.setItemName(m_localizer.formatName(m_employee));</span>
		}
<span class="nc" id="L253">	}</span>

	@Override
	protected DataContainerPC createDataContainerPC() {
<span class="nc" id="L257">		pc_dataContainer = new MyDataContainer(m_context);</span>
<span class="nc" id="L258">		return pc_dataContainer;</span>
	}

	public static HoursPopupPM getInstance(RequestContext context) {
<span class="nc" id="L262">		return (HoursPopupPM) PageModel.getInstance(context, HoursPopupPM.class);</span>
	}

	private Collection&lt;MultiColumnNodeData&gt; initializeHoursRows() {
<span class="nc" id="L266">		Duration biggestMinPaid = Duration.fromMinutes(0);</span>
<span class="nc" id="L267">		Duration smallestMaxPaid = Duration.fromMinutes(Integer.MAX_VALUE);</span>
<span class="nc" id="L268">		Duration biggestOTPerDay = Duration.fromMinutes(0);</span>
<span class="nc" id="L269">		Duration smallestOTPerWeek = Duration.fromMinutes(Integer.MAX_VALUE);</span>
<span class="nc" id="L270">		Duration biggestVTOPerDay = Duration.fromMinutes(0);</span>
<span class="nc" id="L271">		Duration smallestVTOPerWeek = Duration.fromMinutes(Integer.MAX_VALUE);</span>

<span class="nc" id="L273">		ArrayList&lt;MultiColumnNodeData&gt; retVal = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L274">		Integer minPaid = null, maxPaid = null, otDay = null, otWeek = null, vtoDay = null, vtoWeek = null;</span>
<span class="nc" id="L275">		boolean minPaidME = false, maxPaidME = false, otDayME = false, otWeekME = false, vtoDayME = false, vtoWeekME = false;</span>
<span class="nc bnc" id="L276" title="All 2 branches missed.">		for (Collection&lt;WorkResourceMinMaxHour&gt; settingsForOnePerson : hoursAssignments.values()) {</span>
<span class="nc bnc" id="L277" title="All 2 branches missed.">			for (WorkResourceMinMaxHour setting : settingsForOnePerson) {</span>

<span class="nc bnc" id="L279" title="All 2 branches missed.">				if (setting.getMinMinutes() &gt; biggestMinPaid.getDurationInMinutes()) {</span>
<span class="nc" id="L280">					biggestMinPaid = Duration.fromMinutes(setting.getMinMinutes());</span>
				}
<span class="nc bnc" id="L282" title="All 2 branches missed.">				if (setting.getMaxMinutes() &lt; smallestMaxPaid.getDurationInMinutes()) {</span>
<span class="nc" id="L283">					smallestMaxPaid = Duration.fromMinutes(setting.getMaxMinutes());</span>
				}
<span class="nc bnc" id="L285" title="All 2 branches missed.">				if (setting.getMaxOTMinutesPerDay() &gt; biggestOTPerDay.getDurationInMinutes()) {</span>
<span class="nc" id="L286">					biggestOTPerDay = Duration.fromMinutes(setting.getMaxOTMinutesPerDay());</span>
				}
<span class="nc bnc" id="L288" title="All 2 branches missed.">				if (setting.getMaxOTMinutesPerWeek() &lt; smallestOTPerWeek.getDurationInMinutes()) {</span>
<span class="nc" id="L289">					smallestOTPerWeek = Duration.fromMinutes(setting.getMaxOTMinutesPerWeek());</span>
				}
<span class="nc bnc" id="L291" title="All 2 branches missed.">				if (setting.getMaxVTOHoursPerDay() &gt; biggestVTOPerDay.getDurationInMinutes()) {</span>
<span class="nc" id="L292">					biggestVTOPerDay = Duration.fromMinutes(setting.getMaxVTOHoursPerDay());</span>
				}
<span class="nc bnc" id="L294" title="All 2 branches missed.">				if (setting.getMaxVTOHoursPerWeek() &lt; smallestVTOPerWeek.getDurationInMinutes()) {</span>
<span class="nc" id="L295">					smallestVTOPerWeek = Duration.fromMinutes(setting.getMaxVTOHoursPerWeek());</span>
				}

<span class="nc bnc" id="L298" title="All 4 branches missed.">				if ((setting.getStartTime().before(start) || setting.getStartTime().equals(start)) &amp;&amp;</span>
<span class="nc bnc" id="L299" title="All 4 branches missed.">						(setting.getEndTime() == null || setting.getEndTime().after(start))) {</span>
<span class="nc bnc" id="L300" title="All 2 branches missed.">					if (minPaid == null) {</span>
<span class="nc" id="L301">						minPaid = setting.getMinMinutes();</span>
<span class="nc bnc" id="L302" title="All 2 branches missed.">					} else if (setting.getMinMinutes() != minPaid.intValue()) {</span>
<span class="nc" id="L303">						minPaidME = true;</span>
					}
<span class="nc bnc" id="L305" title="All 2 branches missed.">					if (maxPaid == null) {</span>
<span class="nc" id="L306">						maxPaid = setting.getMaxMinutes();</span>
<span class="nc bnc" id="L307" title="All 2 branches missed.">					} else if (setting.getMaxMinutes() != maxPaid.intValue()) {</span>
<span class="nc" id="L308">						maxPaidME = true;</span>
					}
<span class="nc bnc" id="L310" title="All 2 branches missed.">					if (otDay == null) {</span>
<span class="nc" id="L311">						otDay = setting.getMaxOTMinutesPerDay();</span>
<span class="nc bnc" id="L312" title="All 2 branches missed.">					} else if (setting.getMaxOTMinutesPerDay() != otDay.intValue()) {</span>
<span class="nc" id="L313">						otDayME = true;</span>
					}
<span class="nc bnc" id="L315" title="All 2 branches missed.">					if (otWeek == null) {</span>
<span class="nc" id="L316">						otWeek = setting.getMaxOTMinutesPerWeek();</span>
<span class="nc bnc" id="L317" title="All 2 branches missed.">					} else if (setting.getMaxOTMinutesPerWeek() != otWeek.intValue()) {</span>
<span class="nc" id="L318">						otWeekME = true;</span>
					}
<span class="nc bnc" id="L320" title="All 2 branches missed.">					if (vtoDay == null) {</span>
<span class="nc" id="L321">						vtoDay = setting.getMaxVTOHoursPerDay();</span>
<span class="nc bnc" id="L322" title="All 2 branches missed.">					} else if (setting.getMaxVTOHoursPerDay() != vtoDay.intValue()) {</span>
<span class="nc" id="L323">						vtoDayME = true;</span>
					}
<span class="nc bnc" id="L325" title="All 2 branches missed.">					if (vtoWeek == null) {</span>
<span class="nc" id="L326">						vtoWeek = setting.getMaxVTOHoursPerWeek();</span>
<span class="nc bnc" id="L327" title="All 2 branches missed.">					} else if (setting.getMaxVTOHoursPerWeek() != vtoWeek.intValue()) {</span>
<span class="nc" id="L328">						vtoWeekME = true;</span>
					}
					break;
				}
<span class="nc" id="L332">			}</span>
<span class="nc" id="L333">		}</span>

<span class="nc" id="L335">		DefaultMultiColumnNodeData row = new DefaultMultiColumnNodeData();</span>

<span class="nc" id="L337">		pc_minPaid = new DurationSpinnerPC(m_context, &quot;minPaid&quot;);</span>
<span class="nc" id="L338">		pc_maxPaid = new DurationSpinnerPC(m_context, &quot;maxPaid&quot;);</span>
<span class="nc bnc" id="L339" title="All 2 branches missed.">		if (isFieldViewable(SecureFieldInfo.SECFLD_EMPLOYEE_MINMAXPAIDHOURS)) {</span>
<span class="nc" id="L340">			pc_minPaid.setMaxTime(99, 45, 0);</span>
<span class="nc" id="L341">			pc_minPaid.setMinutesIncrement(15);</span>
<span class="nc bnc" id="L342" title="All 2 branches missed.">			if (minPaid != null) {</span>
<span class="nc" id="L343">				pc_minPaid.setValue(Duration.fromMinutes(minPaid));</span>
			}
<span class="nc" id="L345">			pc_minPaid.setMultiEdit(minPaidME);</span>
<span class="nc" id="L346">			pc_minPaid.setEnabled(isFieldEditable(SecureFieldInfo.SECFLD_EMPLOYEE_MINMAXPAIDHOURS));</span>
<span class="nc" id="L347">			addChildComponent(pc_minPaid);</span>
<span class="nc" id="L348">			row.add(m_localizer.i18n(FsWebBundleKey.BUNDLE_NAME, FsWebBundleKey.FS_MIN_PAID_HOURS));</span>
<span class="nc" id="L349">			row.add(pc_minPaid);</span>
<span class="nc" id="L350">			retVal.add(row);</span>

<span class="nc" id="L352">			pc_maxPaid.setMaxTime(99, 45, 0);</span>
<span class="nc" id="L353">			pc_maxPaid.setMinutesIncrement(15);</span>
<span class="nc bnc" id="L354" title="All 2 branches missed.">			if (maxPaid != null) {</span>
<span class="nc" id="L355">				pc_maxPaid.setValue(Duration.fromMinutes(maxPaid));</span>
			}
<span class="nc" id="L357">			pc_maxPaid.setMultiEdit(maxPaidME);</span>
<span class="nc" id="L358">			pc_maxPaid.setEnabled(isFieldEditable(SecureFieldInfo.SECFLD_EMPLOYEE_MINMAXPAIDHOURS));</span>
<span class="nc" id="L359">			addChildComponent(pc_maxPaid);</span>
<span class="nc" id="L360">			row = new DefaultMultiColumnNodeData();</span>
<span class="nc" id="L361">			row.add(m_localizer.i18n(FsWebBundleKey.BUNDLE_NAME, FsWebBundleKey.FS_MAX_PAID_HOURS));</span>
<span class="nc" id="L362">			row.add(pc_maxPaid);</span>
<span class="nc" id="L363">			retVal.add(row);</span>

<span class="nc" id="L365">			pc_minPaid.setAsMinimumValueSpinner(pc_maxPaid.getName(), smallestMaxPaid);</span>
<span class="nc" id="L366">			pc_maxPaid.setAsMaximumValueSpinner(pc_minPaid.getName(), biggestMinPaid);</span>
		}

<span class="nc" id="L369">		pc_otDay = new DurationSpinnerPC(m_context, &quot;otDay&quot;);</span>
<span class="nc bnc" id="L370" title="All 2 branches missed.">		if (isFieldViewable(SecureFieldInfo.SECFLD_EMPLOYEE_MAXOTMINSPERDAY)) {</span>
<span class="nc" id="L371">			pc_otDay.setMaxTime(24, 0, 0);</span>
<span class="nc" id="L372">			pc_otDay.setMinutesIncrement(15);</span>
<span class="nc bnc" id="L373" title="All 2 branches missed.">			if (otDay != null) {</span>
<span class="nc" id="L374">				pc_otDay.setValue(Duration.fromMinutes(otDay));</span>
			}
<span class="nc" id="L376">			pc_otDay.setMultiEdit(otDayME);</span>
<span class="nc" id="L377">			pc_otDay.setEnabled(isFieldEditable(SecureFieldInfo.SECFLD_EMPLOYEE_MAXOTMINSPERDAY));</span>
<span class="nc" id="L378">			addChildComponent(pc_otDay);</span>
<span class="nc" id="L379">			row = new DefaultMultiColumnNodeData();</span>
<span class="nc" id="L380">			row.add(m_localizer.i18n(FsWebBundleKey.BUNDLE_NAME, FsWebBundleKey.FS_MAX_OT_PER_DAY));</span>
<span class="nc" id="L381">			row.add(pc_otDay);</span>
<span class="nc" id="L382">			retVal.add(row);</span>
		}

<span class="nc" id="L385">		pc_otWeek = new DurationSpinnerPC(m_context, &quot;otWeek&quot;);</span>
<span class="nc bnc" id="L386" title="All 2 branches missed.">		if (isFieldViewable(SecureFieldInfo.SECFLD_EMPLOYEE_MAXOTMINSPERWEEK)) {</span>
<span class="nc" id="L387">			pc_otWeek.setMaxTime(99, 45, 0);</span>
<span class="nc" id="L388">			pc_otWeek.setMinutesIncrement(15);</span>
<span class="nc bnc" id="L389" title="All 2 branches missed.">			if (otWeek != null) {</span>
<span class="nc" id="L390">				pc_otWeek.setValue(Duration.fromMinutes(otWeek));</span>
			}
<span class="nc" id="L392">			pc_otWeek.setMultiEdit(otWeekME);</span>
<span class="nc" id="L393">			pc_otWeek.setEnabled(isFieldEditable(SecureFieldInfo.SECFLD_EMPLOYEE_MAXOTMINSPERWEEK));</span>
<span class="nc" id="L394">			addChildComponent(pc_otWeek);</span>
<span class="nc" id="L395">			row = new DefaultMultiColumnNodeData();</span>
<span class="nc" id="L396">			row.add(m_localizer.i18n(FsWebBundleKey.BUNDLE_NAME, FsWebBundleKey.FS_MAX_OT_PER_WEEK));</span>
<span class="nc" id="L397">			row.add(pc_otWeek);</span>
<span class="nc" id="L398">			retVal.add(row);</span>
		}

<span class="nc" id="L401">		pc_vtoDay = new DurationSpinnerPC(m_context, &quot;vtoDay&quot;);</span>
<span class="nc bnc" id="L402" title="All 2 branches missed.">		if (isFieldViewable(SecureFieldInfo.SECFLD_EMPLOYEE_MAXVTOHOURSPERDAY)) {</span>
<span class="nc" id="L403">			pc_vtoDay.setMaxTime(24, 0, 0);</span>
<span class="nc" id="L404">			pc_vtoDay.setMinutesIncrement(15);</span>
<span class="nc bnc" id="L405" title="All 2 branches missed.">			if (vtoDay != null) {</span>
<span class="nc" id="L406">				pc_vtoDay.setValue(Duration.fromMinutes(vtoDay));</span>
			}
<span class="nc" id="L408">			pc_vtoDay.setMultiEdit(vtoDayME);</span>
<span class="nc" id="L409">			pc_vtoDay.setEnabled(isFieldEditable(SecureFieldInfo.SECFLD_EMPLOYEE_MAXVTOHOURSPERDAY));</span>
<span class="nc" id="L410">			addChildComponent(pc_vtoDay);</span>
<span class="nc" id="L411">			row = new DefaultMultiColumnNodeData();</span>
<span class="nc" id="L412">			row.add(m_localizer.i18n(FsWebBundleKey.BUNDLE_NAME, FsWebBundleKey.FS_MAX_VTO_PER_DAY));</span>
<span class="nc" id="L413">			row.add(pc_vtoDay);</span>
<span class="nc" id="L414">			retVal.add(row);</span>
		}

<span class="nc" id="L417">		pc_vtoWeek = new DurationSpinnerPC(m_context, &quot;vtoWeek&quot;);</span>
<span class="nc bnc" id="L418" title="All 2 branches missed.">		if (isFieldViewable(SecureFieldInfo.SECFLD_EMPLOYEE_MAXVTOHOURSPERWEEK)) {</span>
<span class="nc" id="L419">			pc_vtoWeek.setMaxTime(99, 45, 0);</span>
<span class="nc" id="L420">			pc_vtoWeek.setMinutesIncrement(15);</span>
<span class="nc bnc" id="L421" title="All 2 branches missed.">			if (vtoWeek != null) {</span>
<span class="nc" id="L422">				pc_vtoWeek.setValue(Duration.fromMinutes(vtoWeek));</span>
			}
<span class="nc" id="L424">			pc_vtoWeek.setMultiEdit(vtoWeekME);</span>
<span class="nc" id="L425">			pc_vtoWeek.setEnabled(isFieldEditable(SecureFieldInfo.SECFLD_EMPLOYEE_MAXVTOHOURSPERWEEK));</span>
<span class="nc" id="L426">			addChildComponent(pc_vtoWeek);</span>
<span class="nc" id="L427">			row = new DefaultMultiColumnNodeData();</span>
<span class="nc" id="L428">			row.add(m_localizer.i18n(FsWebBundleKey.BUNDLE_NAME, FsWebBundleKey.FS_MAX_VTO_PER_WEEK));</span>
<span class="nc" id="L429">			row.add(pc_vtoWeek);</span>
<span class="nc" id="L430">			retVal.add(row);</span>
		}

<span class="nc bnc" id="L433" title="All 2 branches missed.">		if (isFieldViewable(SecureFieldInfo.SECFLD_EMPLOYEE_MAXOTMINSPERDAY) &amp;&amp;</span>
<span class="nc bnc" id="L434" title="All 2 branches missed.">				isFieldViewable(SecureFieldInfo.SECFLD_EMPLOYEE_MAXOTMINSPERWEEK)) {</span>
<span class="nc" id="L435">			pc_otDay.setAsMinimumValueSpinner(pc_otWeek.getName(), smallestOTPerWeek);</span>
<span class="nc" id="L436">			pc_otWeek.setAsMaximumValueSpinner(pc_otDay.getName(), biggestOTPerDay);</span>
		}

<span class="nc bnc" id="L439" title="All 2 branches missed.">		if (isFieldViewable(SecureFieldInfo.SECFLD_EMPLOYEE_MAXVTOHOURSPERDAY) &amp;&amp;</span>
<span class="nc bnc" id="L440" title="All 2 branches missed.">				isFieldViewable(SecureFieldInfo.SECFLD_EMPLOYEE_MAXVTOHOURSPERWEEK)) {</span>
<span class="nc" id="L441">			pc_vtoDay.setAsMinimumValueSpinner(pc_vtoWeek.getName(), smallestVTOPerWeek);</span>
<span class="nc" id="L442">			pc_vtoWeek.setAsMaximumValueSpinner(pc_vtoDay.getName(), biggestVTOPerDay);</span>
		}

<span class="nc" id="L445">		return retVal;</span>
	}

	private boolean isAnyFieldEditable() {
<span class="nc bnc" id="L449" title="All 2 branches missed.">		if (isFieldEditable(SecureFieldInfo.SECFLD_EMPLOYEE_MINMAXPAIDHOURS) ||</span>
<span class="nc bnc" id="L450" title="All 2 branches missed.">				isFieldEditable(SecureFieldInfo.SECFLD_EMPLOYEE_MAXOTMINSPERDAY) ||</span>
<span class="nc bnc" id="L451" title="All 2 branches missed.">				isFieldEditable(SecureFieldInfo.SECFLD_EMPLOYEE_MAXOTMINSPERWEEK) ||</span>
<span class="nc bnc" id="L452" title="All 2 branches missed.">				isFieldEditable(SecureFieldInfo.SECFLD_EMPLOYEE_MAXVTOHOURSPERDAY) ||</span>
<span class="nc bnc" id="L453" title="All 2 branches missed.">				isFieldEditable(SecureFieldInfo.SECFLD_EMPLOYEE_MAXVTOHOURSPERWEEK)) {</span>
<span class="nc" id="L454">			return true;</span>
		}
<span class="nc" id="L456">		return false;</span>
	}

	/**
	 * Returns whether a field is EDITABLE based on the current user and employees/scope selected.
	 *
	 * @param secureFieldInfoId Secure field info {@link com.bluepumpkin.ejb.bbm.workresource.model.SecureFieldInfo SecureFieldInfo}
	 * @return boolean
	 */
	private boolean isFieldEditable(int secureFieldInfoId) {
		// If the field is not viewable then we don't even need to check
		// further for editability.
<span class="nc bnc" id="L468" title="All 2 branches missed.">		if (!isFieldViewable(secureFieldInfoId)) {</span>
<span class="nc" id="L469">			return false;</span>
		}

<span class="nc bnc" id="L472" title="All 2 branches missed.">		for (Employee emp : employeeMap.values()) {</span>
			// Just looking for any employee in the selection that doesn't permit EDITING
			// because we can't permit more access than the lowest permitted or actions
			// can be taken that shouldn't be allowed for some of the employees.
<span class="nc bnc" id="L476" title="All 2 branches missed.">			if (authorizedEditFields.containsKey(emp.getID())) {</span>
<span class="nc bnc" id="L477" title="All 2 branches missed.">				if (!authorizedEditFields.get(emp.getID()).contains(secureFieldInfoId)) {</span>
					// This field is not EDITABLE for this employee and scope so
					// we cannot permit the field to be EDITABLE for the selected
					// employees.
<span class="nc" id="L481">					return false;</span>
				}
			} // If the employee doesn't have any secured field information let's assume they can be accessed.
<span class="nc" id="L484">		}</span>
<span class="nc" id="L485">		return true;</span>
	}

	/**
	 * Returns whether a field is VIEWABLE based on the current user and employees/scope selected.
	 *
	 * @param secureFieldInfoId Secure field info {@link com.bluepumpkin.ejb.bbm.workresource.model.SecureFieldInfo SecureFieldInfo}
	 * @return boolean
	 */
	private boolean isFieldViewable(int secureFieldInfoId) {
<span class="nc bnc" id="L495" title="All 2 branches missed.">		for (Employee emp : employeeMap.values()) {</span>
			// Just looking for any employee in the selection that doesn't permit VIEWING
			// because we can't permit more access than the lowest permitted or actions
			// can be taken that shouldn't be allowed for some of the employees.
<span class="nc bnc" id="L499" title="All 2 branches missed.">			if (authorizedViewFields.containsKey(emp.getID())) {</span>
<span class="nc bnc" id="L500" title="All 2 branches missed.">				if (!authorizedViewFields.get(emp.getID()).contains(secureFieldInfoId)) {</span>
					// This field is not VIEWABLE for this employee and scope so
					// we cannot permit the field to be VIEWABLE for the selected
					// employees.
<span class="nc" id="L504">					return false;</span>
				}
			} // If the employee doesn't have any secured field information let's assume they can be accessed.
<span class="nc" id="L507">		}</span>
<span class="nc" id="L508">		return true;</span>
	}

	/**
	 * Initializes the secure field meta data for use in determining viewability/editability of certain fields.
	 */
	private void initializeSecureFieldMetaData() {
<span class="nc" id="L515">		authorizedViewFields = new HashMap&lt;&gt;();</span>
<span class="nc" id="L516">		authorizedEditFields = new HashMap&lt;&gt;();</span>

<span class="nc bnc" id="L518" title="All 2 branches missed.">		for (Employee emp : employeeMap.values()) {</span>
<span class="nc" id="L519">			int[] viewableFields =</span>
<span class="nc" id="L520">					m_context.getUser().getAuthorizedFields(</span>
							PrivilegeKeys.CORE_VIEWSECUREFIELD,
<span class="nc" id="L522">							new ScopeID(emp.getOrganizationID(), Scope.ORG_SCOPE));</span>
<span class="nc bnc" id="L523" title="All 2 branches missed.">			if (viewableFields == null) {</span>
<span class="nc" id="L524">				viewableFields = new int[0];</span>
			}

<span class="nc" id="L527">			int[] editableFields =</span>
<span class="nc" id="L528">					m_context.getUser().getAuthorizedFields(</span>
							PrivilegeKeys.CORE_EDITSECUREFIELD,
<span class="nc" id="L530">							new ScopeID(emp.getOrganizationID(), Scope.ORG_SCOPE));</span>
<span class="nc bnc" id="L531" title="All 2 branches missed.">			if (editableFields == null) {</span>
<span class="nc" id="L532">				editableFields = new int[0];</span>
			}

<span class="nc" id="L535">			authorizedViewFields.put(emp.getID(), ArrayUtil.asList(viewableFields));</span>
<span class="nc" id="L536">			authorizedEditFields.put(emp.getID(), ArrayUtil.asList(editableFields));</span>
<span class="nc" id="L537">		}</span>
<span class="nc" id="L538">	}</span>

	/**
	 * Loads the employee data from the backend and populates employeeMap with it.
	 */
	private void initializeEmployeeData() throws Exception {
<span class="nc" id="L544">		Date viewDate = pc_dataContainer.getShowAsDate();</span>
<span class="nc" id="L545">		m_employee = new ProfileModelHandler().getEmpWithHistoryData(m_empID, viewDate, m_context.isInWhatIfMode());</span>
<span class="nc" id="L546">		WorkResourceManager wrMgr = BbmManagerFactory.getWorkResourceManager(m_context.isInWhatIfMode());</span>
<span class="nc" id="L547">		Collection&lt;Employee&gt; employees = wrMgr.getEmployeesByIDs(Arrays.asList(selectedIDs),</span>
				viewDate,
				Employee.DETAIL_LEVEL_EMPLOYEE_BASIC |
						Employee.DETAIL_LEVEL_EMPLOYEE_TIMEBASEDPROPERTY_HISTORY);
<span class="nc bnc" id="L551" title="All 4 branches missed.">		if (employees != null &amp;&amp; employees.size() &gt; 0) {</span>
<span class="nc" id="L552">			m_employee = employees.iterator().next();</span>
		}
<span class="nc bnc" id="L554" title="All 2 branches missed.">		for (Employee emp : employees) {</span>
			//This will populate the local start/termination dates for the employee
<span class="nc" id="L556">			EmployeeLocal.convertEffectivitiesToLocalDate(emp);</span>
<span class="nc" id="L557">			employeeMap.put(emp.getID(), emp);</span>
<span class="nc" id="L558">		}</span>
<span class="nc" id="L559">	}</span>

	/**
	 * Initializes the table header that displays min/max hour information for the employees.  Only shows
	 * columns in the table if the user has view permissions for those fields.
	 */
	private void initializeTableHeader() {
<span class="nc" id="L566">		TableHeaderPC header = m_historyPC.getHeader();</span>
<span class="nc" id="L567">		header.addColumnHeaderData(&quot;startDate&quot;, m_localizer.i18n(FsWebBundleKey.BUNDLE_NAME, FsWebBundleKey.FS_START_DATE));</span>
<span class="nc" id="L568">		header.addColumnHeaderData(&quot;endDate&quot;, m_localizer.i18n(FsWebBundleKey.BUNDLE_NAME, FsWebBundleKey.FS_END_DATE));</span>
<span class="nc bnc" id="L569" title="All 2 branches missed.">		if (isFieldViewable(SecureFieldInfo.SECFLD_EMPLOYEE_MINMAXPAIDHOURS)) {</span>
<span class="nc" id="L570">			header.addColumnHeaderData(&quot;minPaid&quot;, m_localizer.i18n(FsWebBundleKey.BUNDLE_NAME, FsWebBundleKey.FS_MIN_PAID_HOURS));</span>
<span class="nc" id="L571">			header.addColumnHeaderData(&quot;maxPaid&quot;, m_localizer.i18n(FsWebBundleKey.BUNDLE_NAME, FsWebBundleKey.FS_MAX_PAID_HOURS));</span>
		}
<span class="nc bnc" id="L573" title="All 2 branches missed.">		if (isFieldViewable(SecureFieldInfo.SECFLD_EMPLOYEE_MAXOTMINSPERDAY)) {</span>
<span class="nc" id="L574">			header.addColumnHeaderData(&quot;otPerDay&quot;, m_localizer.i18n(FsWebBundleKey.BUNDLE_NAME,</span>
					FsWebBundleKey.FS_MAX_OT_PER_DAY));
		}
<span class="nc bnc" id="L577" title="All 2 branches missed.">		if (isFieldViewable(SecureFieldInfo.SECFLD_EMPLOYEE_MAXOTMINSPERWEEK)) {</span>
<span class="nc" id="L578">			header.addColumnHeaderData(&quot;otPerWeek&quot;, m_localizer.i18n(FsWebBundleKey.BUNDLE_NAME,</span>
					FsWebBundleKey.FS_MAX_OT_PER_WEEK));
		}
<span class="nc bnc" id="L581" title="All 2 branches missed.">		if (isFieldViewable(SecureFieldInfo.SECFLD_EMPLOYEE_MAXVTOHOURSPERDAY)) {</span>
<span class="nc" id="L582">			header.addColumnHeaderData(&quot;vtoPerDay&quot;, m_localizer.i18n(FsWebBundleKey.BUNDLE_NAME,</span>
					FsWebBundleKey.FS_MAX_VTO_PER_DAY));
		}
<span class="nc bnc" id="L585" title="All 2 branches missed.">		if (isFieldViewable(SecureFieldInfo.SECFLD_EMPLOYEE_MAXVTOHOURSPERWEEK)) {</span>
<span class="nc" id="L586">			header.addColumnHeaderData(&quot;vtoPerWeek&quot;, m_localizer.i18n(FsWebBundleKey.BUNDLE_NAME,</span>
					FsWebBundleKey.FS_MAX_VTO_PER_WEEK));
		}
<span class="nc" id="L589">	}</span>

	private void appendInitJsForSpinnerComponent(StringBuffer sb, DurationSpinnerPC component, String parameterName, int secureFieldId) {
<span class="nc bnc" id="L592" title="All 2 branches missed.">		if (isFieldViewable(secureFieldId)) {</span>
<span class="nc" id="L593">			sb.append(component.getName()).append(&quot;.setTime(&quot;).append(&quot;opener.window.&quot;).append(parameterName).append(&quot;.getTime()); \n&quot;);</span>
<span class="nc" id="L594">			sb.append(component.getName()).append(&quot;.setEdited(false); \n&quot;);</span>
<span class="nc bnc" id="L595" title="All 2 branches missed.">			if (component.isMultiEdit()) {</span>
<span class="nc" id="L596">				sb.append(&quot;jQuery('#&quot; + component.getMultiEditIndicatorID() + &quot;').show(); \n&quot;);</span>
			}
		}
<span class="nc" id="L599">	}</span>

	private void appendSetterJsForSpinnerComponent(StringBuffer sb, String componentName, String parameterName, int secureFieldId) {
<span class="nc bnc" id="L602" title="All 2 branches missed.">		if (isFieldViewable(secureFieldId)) {</span>
<span class="nc" id="L603">			sb.append(&quot;opener.window.&quot;).append(parameterName).append(&quot;.setTime(&quot;).append(componentName).append(&quot;.getTime()); \n&quot;);</span>
		}
<span class="nc" id="L605">	}</span>

	/**
	 * Returns the effective start date to be displayed in the start date picker for the given
	 * date range.  This date is the view period start date, unless the employee has start date
	 * after that in which case the employee's start date will be used.
	 */
	private LocalDate getEffectiveStartDateForViewPeriod() {
<span class="nc bnc" id="L613" title="All 2 branches missed.">		if (m_isMultiEdit) {</span>
<span class="nc" id="L614">			return new LocalDate(start, TimeZoneUtil.GMT_TIMEZONE);</span>
<span class="nc bnc" id="L615" title="All 4 branches missed.">		} else if (employeeMap.get(m_empID).getStartTime() != null &amp;&amp; employeeMap.get(m_empID).getStartTime().after(start)) {</span>
<span class="nc" id="L616">			return new LocalDate(employeeMap.get(m_empID).getStartTime(),</span>
<span class="nc" id="L617">					employeeMap.get(m_empID).getTimeZone(employeeMap.get(m_empID).getStartTime()));</span>
		}
<span class="nc" id="L619">		return new LocalDate(start, TimeZoneUtil.GMT_TIMEZONE);</span>
	}

	private class MyDataContainer extends DataContainerPC {
<span class="nc" id="L623">		public MyDataContainer(RequestContext context) {</span>
<span class="nc" id="L624">			super(context);</span>
<span class="nc" id="L625">		}</span>

		private Collection&lt;MultiColumnNodeData&gt; rows;

		public void setRows(Collection&lt;MultiColumnNodeData&gt; rows) {
<span class="nc" id="L630">			this.rows = rows;</span>
<span class="nc" id="L631">		}</span>

		private static final long serialVersionUID = 1L;

		@Override
		protected void addCustomDataRow() {
<span class="nc bnc" id="L637" title="All 2 branches missed.">			for (MultiColumnNodeData mcnd : rows) {</span>
<span class="nc" id="L638">				this.addRowData(mcnd);</span>
<span class="nc" id="L639">			}</span>
<span class="nc" id="L640">		}</span>

		//This is only used in campaign mode.  We need to force the end date to match the end date
		// of the scheduling period.
		public void setViewPeriodEndDate(LocalDate endDate) {
<span class="nc" id="L645">			this.endDate = endDate;</span>
<span class="nc" id="L646">		}</span>

		//This is the start date that is shown for the &quot;Insert value&quot; sections
		public void setShowAsDate(LocalDate showAsDate) {
<span class="nc" id="L650">			this.showAsDate = showAsDate;</span>
<span class="nc" id="L651">		}</span>

		@Override
		public boolean extractParameters(HttpServletRequest request) {
<span class="nc" id="L655">			boolean value = super.extractParameters(request);</span>
<span class="nc bnc" id="L656" title="All 2 branches missed.">			if (endDate != null) {</span>
<span class="nc" id="L657">				endDate.add(Calendar.DATE, -1);</span>
			}
<span class="nc" id="L659">			return value;</span>
		}
	}

	public void setPeriodOnly(boolean periodOnly) {
<span class="nc" id="L664">		this.periodOnly = periodOnly;</span>
<span class="nc" id="L665">	}</span>

	public void setStart(long start) {
<span class="nc" id="L668">		this.start = new Date(start);</span>
<span class="nc" id="L669">	}</span>

	public void setEnd(long end) {
<span class="nc" id="L672">		this.end = new Date(end);</span>
<span class="nc" id="L673">	}</span>

	public void setMinName(String minName) {
<span class="nc" id="L676">		this.rp_minName = minName;</span>
<span class="nc" id="L677">	}</span>

	public void setMaxName(String maxName) {
<span class="nc" id="L680">		this.rp_maxName = maxName;</span>
<span class="nc" id="L681">	}</span>

	public void setOtDayName(String otDayName) {
<span class="nc" id="L684">		this.rp_otDayName = otDayName;</span>
<span class="nc" id="L685">	}</span>

	public void setOtWeekName(String otWeekName) {
<span class="nc" id="L688">		this.rp_otWeekName = otWeekName;</span>
<span class="nc" id="L689">	}</span>

	public void setVtoDayName(String vtoDayName) {
<span class="nc" id="L692">		this.rp_vtoDayName = vtoDayName;</span>
<span class="nc" id="L693">	}</span>

	public void setVtoWeekName(String vtoWeekName) {
<span class="nc" id="L696">		this.rp_vtoWeekName = vtoWeekName;</span>
<span class="nc" id="L697">	}</span>

	public void setUpdateModeName(String updateModeName) {
<span class="nc" id="L700">		this.rp_updateModeName = updateModeName;</span>
<span class="nc" id="L701">	}</span>

	public void setUpdateMode(String updateMode) {
<span class="nc" id="L704">		this.rp_updateMode = updateMode;</span>
<span class="nc" id="L705">	}</span>

	public void setStartName(String startName) {
<span class="nc" id="L708">		this.rp_startName = startName;</span>
<span class="nc" id="L709">	}</span>

	public void setEndName(String endName) {
<span class="nc" id="L712">		this.rp_endName = endName;</span>
<span class="nc" id="L713">	}</span>

	public void setDatesModifiedName(String datesModifiedName) {
<span class="nc" id="L716">		this.rp_datesModifiedName = datesModifiedName;</span>
<span class="nc" id="L717">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>