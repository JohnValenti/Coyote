<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>SkillListPageModel.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.bbm.organization.setup.skill</a> &gt; <span class="el_source">SkillListPageModel.java</span></div><h1>SkillListPageModel.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.bbm.organization.setup.skill;

import java.text.MessageFormat;
import java.util.ArrayList;
import java.util.Collection;
import java.util.Iterator;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.logging.Category;
import com.witness.ejb.core.security.PrivilegeKeys;
import com.bluepumpkin.ejb.bbm.workresource.OrganizationScopeManagerProxy;
import com.bluepumpkin.web.bbm.Log;
import com.bluepumpkin.web.bbm.l10n.BbmWebBundleKey;
import com.bluepumpkin.web.bbm.organization.OrgWorkpaneListPageModel;
import com.bluepumpkin.web.bbm.organization.OrganizationModelHandler;
import com.witness.web.uif.keys.PageAction;
import com.witness.web.uif.pagecomponent.DefaultMultiColumnNodeData;
import com.witness.web.uif.pagecomponent.table.TableHeaderPC;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.pagemodel.PageModel;
import com.bluepumpkin.ejb.bbm.skill.model.Skill;
import com.bluepumpkin.web.bbm.skill.SkillModelHandler;
import com.bluepumpkin.ejb.bbm.workload.model.Media;
import com.witness.web.uif.pagecomponent.toolbar.ToolbarTextButton;

/**
 * Title:        SkillListPageModel
 * Description:  Display the List page for Skills
 * Copyright:    Copyright (c) 2008
 * Company:      Verint Systems, Inc.
 * @author       Gonzalo Quintanar
 */
public class SkillListPageModel extends OrgWorkpaneListPageModel {
<span class="fc" id="L34">	private static final Category log = Log.initCategory(SkillListPageModel.class.getName());</span>
	private Collection m_skillList;

	public static final String NAME_SORT = &quot;NAME_SORT&quot;;
    public static final String MEDIA_TYPE_SORT = &quot;MEDIA_TYPE_SORT&quot;;
    public static final String DESC_SORT = &quot;DESC_SORT&quot;;
	public static final String OWNER_ORG_SORT = &quot;OWNER_ORG_SORT&quot;;
    public static final String POPUP_UPLOAD = &quot;POPUP_UPLOAD&quot;;
    public static final String POPUP_DOWNLOAD = &quot;POPUP_DOWNLOAD&quot;;

	/**
	 * Constructor
	 */
	public SkillListPageModel(RequestContext context) {
<span class="fc" id="L48">		super(context);</span>

<span class="fc" id="L50">		setName(&quot;skillList&quot;);</span>

		// Enable Object Copy
<span class="fc" id="L53">		initCopyObjType(Skill.OBJECT_TYPE_SKILL);</span>
<span class="fc" id="L54">	}</span>

	/**
	 * Return instance of Model which is ready to be rendered
	 */
	public static PageModel getInstance(RequestContext context) {
<span class="fc" id="L60">		return getInstance(context, SkillListPageModel.class);</span>
	}

	/**
	 * Loads all the Skill value objects for the selected Organization ID
	 *
	 * @return true if load was successful
	 */
	private boolean loadSkills() {
		try {
<span class="fc" id="L70">            ArrayList singleOrgList = new ArrayList(1);</span>
<span class="fc" id="L71">            singleOrgList.add(getSelectedIDObject());</span>
<span class="fc" id="L72">			m_skillList = SkillModelHandler.getAvailableSkillsInOrg(m_context, singleOrgList);</span>
<span class="fc" id="L73">			return true;</span>
<span class="nc" id="L74">		} catch (Exception ex) {</span>
<span class="nc" id="L75">			handleUnableToLoadDataError(log, ex);</span>
<span class="nc" id="L76">			return false;</span>
		}
	}

	/**
	 * Initialize List
	 */
	protected void initList() {
<span class="fc" id="L84">		super.initList();</span>

		// Setup Headers
<span class="fc" id="L87">		TableHeaderPC header = m_list.getHeader();</span>
<span class="fc" id="L88">		header.setSortable(true);</span>
<span class="fc" id="L89">		header.addColumnHeaderData(NAME_SORT,	i18n(m_bbmBundle, BbmWebBundleKey.ORG_SKILL_LABEL));</span>
<span class="fc" id="L90">        header.addColumnHeaderData(MEDIA_TYPE_SORT,   i18n(m_bbmBundle, BbmWebBundleKey.ORG_SKILL_MEDIA_TYPE_LABEL));</span>
<span class="fc" id="L91">        header.addColumnHeaderData(DESC_SORT,   i18n(m_bbmBundle, BbmWebBundleKey.ORG_SKILL_DESC_LABEL));</span>
<span class="fc" id="L92">		header.addColumnHeaderData(OWNER_ORG_SORT,	i18n(m_bbmBundle, BbmWebBundleKey.LIST_HEADER_OWNER_ORG));</span>

		// Setup basic table property
<span class="fc" id="L95">		m_list.setIsAutoSortEnabled(true);</span>
<span class="fc" id="L96">		m_list.setMultiRowSelectable(false);</span>
<span class="fc" id="L97">	}</span>

	/**
	 * Initialize toolbar
	 */
	protected void initToolbar() {
<span class="fc" id="L103">		String addLabel = i18n(m_bbmBundle, BbmWebBundleKey.ORG_SKILL_CREATE_NEW_ACTION);</span>
<span class="fc" id="L104">		String copyLabel = i18n(m_bbmBundle, BbmWebBundleKey.ORG_SKILL_COPY_ACTION);</span>
<span class="fc" id="L105">		String editLabel = i18n(m_bbmBundle, BbmWebBundleKey.ORG_SKILL_EDIT_ACTION);</span>
<span class="fc" id="L106">		String delLabel = i18n(m_bbmBundle, BbmWebBundleKey.ORG_SKILL_DELETE_ACTION);</span>

<span class="fc" id="L108">		useDefaultToolbar(false, addLabel, copyLabel, editLabel, delLabel);</span>
        
        //override the default delete confirmation message
<span class="fc" id="L111">        ToolbarTextButton deleteButton = (ToolbarTextButton) m_toolbar.getElement(PageAction.DELETE);</span>
<span class="fc" id="L112">        addJSVariableAsString(&quot;CONFIRM_DELETE_SKILL&quot;, i18n(m_bbmBundle, BbmWebBundleKey.ORG_SKILL_DELETE_CONFIRM));</span>
<span class="fc" id="L113">        deleteButton.setConfirmMsgVar(&quot;CONFIRM_DELETE_SKILL&quot;);</span>
                
<span class="fc" id="L115">        m_toolbar.addPopupWindowTextButton(POPUP_UPLOAD, i18n(m_bbmBundle, BbmWebBundleKey.IMPORT_SKILLS), </span>
<span class="fc" id="L116">                isAuthorizedToConfigure(getSelectedIDObject()));</span>

<span class="fc" id="L118">        m_toolbar.addPopupWindowTextButton(POPUP_DOWNLOAD, i18n(m_bbmBundle, BbmWebBundleKey.EXPORT_SKILLS), </span>
<span class="fc" id="L119">                isAuthorizedToView(getSelectedIDObject()));</span>
<span class="fc" id="L120">    }</span>

	/**
	 * Create the list model
	 */
	protected void createListModel() {
<span class="pc bpc" id="L126" title="1 of 2 branches missed.">		if (!loadSkills()) return;</span>

<span class="fc" id="L128">		ArrayList listModel = new ArrayList();</span>
<span class="fc bfc" id="L129" title="All 2 branches covered.">		for(Iterator it = m_skillList.iterator(); it.hasNext();) {</span>
<span class="fc" id="L130">			Skill skill = (Skill)it.next();</span>

			// Create the row data
<span class="fc" id="L133">			String rowID = skill.getID().toString();</span>
<span class="fc" id="L134">			DefaultMultiColumnNodeData row_data =  new DefaultMultiColumnNodeData(rowID);</span>
			
            //add the Name column
<span class="fc" id="L137">            row_data.add(skill.getName());</span>
            
            //add the Media Type column
            try
            {
<span class="fc" id="L142">                Media media = SkillModelHandler.getMedia(Skill.convertStr2MediaID(skill.getMediaID().toString()));</span>
<span class="pc bpc" id="L143" title="1 of 2 branches missed.">                row_data.add(media==null?&quot;&quot;:media.getName()); //TBD: do we need to localize this?</span>
            } 
<span class="nc" id="L145">            catch (Exception ex) </span>
            {
<span class="nc" id="L147">                handleUnableToLoadDataError(log, ex);</span>
<span class="nc" id="L148">                row_data.add(&quot;&quot;);</span>
<span class="fc" id="L149">            }            </span>
            
            //add the Description column
<span class="fc" id="L152">            row_data.add(skill.getDescription());</span>
            
            //add the Owner Organization column
<span class="fc" id="L155">            ID orgID = skill.getOrganizationID();</span>
<span class="fc" id="L156">			row_data.add(getOrganizationName(orgID));</span>

<span class="fc" id="L158">			row_data.getNodeAttributes().put(IS_EDITABLE, isRowEditable(skill.getOrganizationID()));</span>
<span class="fc" id="L159">			row_data.getNodeAttributes().put(COPY_ITEM_NAME, skill.getName());</span>

			// Add row data to list model
<span class="fc" id="L162">			listModel.add(row_data);</span>

			// Check if row should be selected, assuming only one should be selected
<span class="fc bfc" id="L165" title="All 2 branches covered.">			if (OrganizationModelHandler.UNREASONABLE_ORG_ID.equals(m_selectedRowOrgID)) {</span>
<span class="fc bfc" id="L166" title="All 2 branches covered.">				if(this.isRowSelected(skill.getID())) {</span>
<span class="fc" id="L167">					m_list.addSelectedRowID(rowID);</span>
<span class="fc" id="L168">					m_selectedRowOrgID = skill.getOrganizationID();</span>
				}
			}
<span class="fc" id="L171">		} //end for</span>

<span class="fc" id="L173">		m_list.setListModel(listModel);</span>
<span class="fc" id="L174">	}</span>

	/**
	 * Returns true if the list support sorting.
	 * This method should be override by derived classes who support sorting
	 */
	protected boolean isSortSupported() {
<span class="fc" id="L181">		return true;</span>
	}

	/**
	 * Return the Selected Skill IDs
	 */
	public ID[] getSelectedSkillIDs() {
<span class="fc" id="L188">		return m_performActionOnIDs;</span>
	}

	/**
	 * Get entity name. Used for title.
	 */
	protected String getTitleEntityType() {
<span class="fc" id="L195">		return i18n(m_bbmBundle, BbmWebBundleKey.ORG_SKILL_LABEL);</span>
	}

	/**
	 * Return URL for HTML Form Action
	 */
	public String getFormAction() {
<span class="fc" id="L202">		return &quot;org_skill&quot;;</span>
	}

	/**
	 * Return true if Current User is authorized to configure specified Organization
	 */
	protected boolean isAuthorizedToView(ID orgID) {
<span class="fc" id="L209">		return m_context.getUser().isAuthorized(PrivilegeKeys.CORE_VIEWSKILLS,</span>
<span class="fc" id="L210">				OrganizationScopeManagerProxy.getScopeID(orgID));</span>
	}

	/**
	 * Return true if Current User is authorized to configure specified Organization
	 */
	protected boolean isAuthorizedToConfigure(ID orgID) {
<span class="fc" id="L217">		return m_context.getUser().isAuthorized(PrivilegeKeys.CORE_CONFIGURESKILLS,</span>
<span class="fc" id="L218">				OrganizationScopeManagerProxy.getScopeID(orgID));</span>
	}

	/**
	 * Return localized message indicating that current user is not authorized
	 * to view skills in the selected Organization.
	 */
	protected String getNotAuthorizedToViewMsg() {
<span class="nc" id="L226">		return MessageFormat.format(</span>
<span class="nc" id="L227">			i18n(m_bbmBundle, BbmWebBundleKey.NOT_AUTHORIZED_TO_VIEW_ENTITY_IN_SELECTED_ORG),</span>
<span class="nc" id="L228">			new Object[] { i18n(m_bbmBundle, BbmWebBundleKey.BBM_ORG_GEN_SKILLS) } );</span>
	}

    /**
     * Initialize Component For Display
     */
    public void initForDisplay() 
    {
<span class="fc" id="L236">        super.initForDisplay();</span>
        
<span class="fc" id="L238">        String popupQueryString = SkillImportPageModel.SELECTED_ORG_ID_FN + &quot;=&quot; + getSelectedIDObject();</span>
<span class="fc" id="L239">        addPopupArgs(POPUP_UPLOAD, &quot;skills_import&quot;, popupQueryString, null, &quot;480,520,ctr,ctr&quot;, true, 1);</span>
        
<span class="fc" id="L241">        popupQueryString = SkillExportPageModel.SELECTED_ORG_ID_FN + &quot;=&quot; + getSelectedIDObject();</span>
<span class="fc" id="L242">        addPopupArgs(POPUP_DOWNLOAD, &quot;skills_export&quot;, popupQueryString, null, &quot;480,520,ctr,ctr&quot;, true, 1);</span>
<span class="fc" id="L243">    }</span>
    
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>