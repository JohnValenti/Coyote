<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>SchedulingRequestUtil.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.verint.ejb.bbm.schedule.util</a> &gt; <span class="el_source">SchedulingRequestUtil.java</span></div><h1>SchedulingRequestUtil.java</h1><pre class="source lang-java linenums">package com.verint.ejb.bbm.schedule.util;

import java.rmi.RemoteException;
import java.util.ArrayList;
import java.util.Collection;
import java.util.Iterator;
import java.util.List;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.jdmo.JdmoException;
import com.bluepumpkin.common.logging.Category;
import com.bluepumpkin.ejb.bbm.BbmEJBCreateException;
import com.bluepumpkin.ejb.bbm.base.BbmCreateException;
import com.bluepumpkin.ejb.bbm.base.BbmFinderException;
import com.bluepumpkin.ejb.bbm.base.BbmObjectNotFoundException;
import com.bluepumpkin.ejb.bbm.base.BbmRemoveException;
import com.bluepumpkin.ejb.bbm.campaign.ejb.CampaignManager;
import com.bluepumpkin.ejb.bbm.campaign.model.SchedulingRequest;
import com.bluepumpkin.ejb.bbm.campaign.model.SchedulingState;
import com.bluepumpkin.ejb.bbm.campaign.model.SchedulingWarning;
import com.bluepumpkin.ejb.core.CoreEJBCreateException;
import com.bluepumpkin.ejb.core.CoreManagerFactory;
import com.bluepumpkin.ejb.core.Log;
import com.verint.ejb.bbm.schedule.model.WSAutoScheduleRequest;
import com.verint.ejb.bbm.schedule.model.WSAutoScheduleRequestDAO;
import com.verint.ejb.bbm.schedule.model.WSAutoScheduleRequestFieldInfo;
import com.verint.ejb.bbm.timeseries.PredictedTimeSeriesDAO;
import com.verint.ejb.wfm.WfmManagerFactory;
import com.witness.ejb.core.base.CoreFinderException;
import com.witness.ejb.core.security.UserManager;
import com.witness.ejb.core.security.model.User;

public class SchedulingRequestUtil {
	
<span class="nc" id="L35">	public enum SchedulingMode {</span>
<span class="nc" id="L36">		RECALC(&quot;R&quot;), SCHEDULE(&quot;S&quot;), ANALYZE(&quot;A&quot;);</span>
		
		String mode;
<span class="nc" id="L39">		SchedulingMode(String mode) {</span>
<span class="nc" id="L40">			this.mode = mode;</span>
<span class="nc" id="L41">		}</span>
		public String mode() {
<span class="nc" id="L43">			return mode;</span>
		}
	}

	private static final int REQUEST_STOP_AND_SAVE = SchedulingRequest.STOP_AND_SAVE;
	
	private static final int ERROR_TYPE_INDEX = -2;

	private CampaignManager m_campaignManager;
	private UserManager m_userManager;

<span class="fc" id="L54">	private static final Category CAT = Log.initCategory(SchedulingRequestUtil.class.getName());</span>

<span class="fc" id="L56">	private static final SchedulingRequestUtil _INSTANCE = new SchedulingRequestUtil();</span>

<span class="fc" id="L58">	private static final Object _LOCK = new Object();</span>

<span class="fc" id="L60">	private SchedulingRequestUtil() {</span>
<span class="fc" id="L61">		createCampaignManager();</span>
<span class="fc" id="L62">	}</span>

	public static SchedulingRequestUtil getInstance() {
<span class="fc" id="L65">		return _INSTANCE;</span>
	}
	
	/**
	 * Persists the given WSAutoScheduleRequest in the database.
	 */
	public ID createSchedulingRequest(WSAutoScheduleRequest request, String modifiedBy) throws JdmoException {
<span class="fc" id="L72">		WSAutoScheduleRequestDAO dao = new WSAutoScheduleRequestDAO();</span>
		try {
<span class="fc" id="L74">			synchronized (_LOCK) {</span>
<span class="fc" id="L75">				return dao.createSchedulingRequest(request, modifiedBy);</span>
<span class="nc" id="L76">			}</span>
		} finally {
<span class="pc" id="L78">			dao.cleanUp();</span>
		}
	}
	
	/**
	 * Updates the status of the given schedule requests.
	 */
	public void updateSchedulingRequests(List&lt;ID&gt; requests, String status,
			String statusMessage) throws JdmoException {
<span class="nc" id="L87">		WSAutoScheduleRequestDAO dao = new WSAutoScheduleRequestDAO();</span>
		try {
<span class="nc" id="L89">			dao.updateScheduleStatus(requests, null,  status, statusMessage);</span>
		} finally {
<span class="nc" id="L91">			dao.cleanUp();</span>
<span class="nc" id="L92">		}</span>
<span class="nc" id="L93">	}</span>
	
	/**
	 * Returns the Scheduling Request with the current status
	 * @throws BbmObjectNotFoundException if the request ID could not be found
	 * @throws BbmFinderException if the request ID can not be found
	 */
	public WSAutoScheduleRequest getSchedulingRequestWithCurrentStatus(
			ID requestId) throws BbmObjectNotFoundException, BbmFinderException {
<span class="nc" id="L102">		WSAutoScheduleRequestDAO dao = new WSAutoScheduleRequestDAO();</span>
		try {
			// latest from request table is sufficient,
			// there should not be too many places of updation, MDB does the
			// updation periodically.
<span class="nc" id="L107">			return dao.getObjectByID(requestId);</span>
		} finally {
<span class="nc" id="L109">			dao.cleanUp();</span>
		}
	}
	
	public WSAutoScheduleRequest getSchedulingRequestWithCurrentStatusBySP(
			ID spId) {
<span class="nc" id="L115">		WSAutoScheduleRequestDAO dao = new WSAutoScheduleRequestDAO();</span>
		try {
			// latest from request table is sufficient,
			// there should not be too many places of updation, MDB does the
			// updation periodically.
<span class="nc" id="L120">			return dao.getLatestRequestForSP(spId.toInt());</span>
<span class="nc" id="L121">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L122">			CAT.error(</span>
					&quot;Error gettting the scheduling request by ID &quot;
<span class="nc" id="L124">							+ spId.toInt(), e);</span>
		} finally {
<span class="nc" id="L126">			dao.cleanUp();</span>
<span class="nc" id="L127">		}</span>
<span class="nc" id="L128">		return null;</span>
	}

	public boolean doesUnScheduledRequestsExist() {
<span class="nc" id="L132">		WSAutoScheduleRequestDAO dao = new WSAutoScheduleRequestDAO();</span>
<span class="nc" id="L133">		List&lt;WSAutoScheduleRequest&gt; requests = null;</span>
		try {
<span class="nc" id="L135">			requests = dao.getRequestsByStatus(WSAutoScheduleRequest.SCHEDULE_STATUS_NEW);</span>
<span class="nc" id="L136">		} catch (BbmFinderException e) {</span>
			// no requests
<span class="nc" id="L138">			return false;</span>
		} finally {
<span class="nc" id="L140">			dao.cleanUp();</span>
<span class="nc" id="L141">		}</span>
<span class="nc bnc" id="L142" title="All 2 branches missed.">		return requests.size() &gt; 0;</span>
	}
	
	/**
	 * Stops the scheduling requests for the given Requests.  If haltedOnError is false, the scheduling
	 * requests that are currently new (N) or in progress (P) will have their statuses set to Stop (S).
	 * If haltedOnError is true, they will be set to Error (E).  The status message field of the requests
	 * will be set to the given statusMessage.
	 * 
	 * @param statusMessage - An optional parameter.  If there is an error you can set this as the text
	 * description of the error and this will be read by the external RFS program and displayed to the user.
	 */
	public void stopSchedulingForRequests(Collection&lt;ID&gt; requestIDs, boolean haltedOnError, String statusMessage) {
<span class="nc" id="L155">		WSAutoScheduleRequestDAO dao = null;</span>
<span class="nc" id="L156">		synchronized (_LOCK) {</span>
			try {
<span class="nc" id="L158">				dao = new WSAutoScheduleRequestDAO();</span>
				// update all new scheduling requests for the given scheduling
				// period
				try {
<span class="nc bnc" id="L162" title="All 2 branches missed.">					if (haltedOnError) {</span>
<span class="nc" id="L163">						dao.updateScheduleStatus(new ArrayList&lt;ID&gt;(requestIDs),</span>
								WSAutoScheduleRequest.SCHEDULE_STATUS_NEW,
								WSAutoScheduleRequest.SCHEDULE_STATUS_ERROR,
								statusMessage);
					} else {
<span class="nc" id="L168">						dao.updateScheduleStatus(new ArrayList&lt;ID&gt;(requestIDs),</span>
								WSAutoScheduleRequest.SCHEDULE_STATUS_NEW,
								WSAutoScheduleRequest.SCHEDULE_STATUS_STOPPED,
								statusMessage);
					}
<span class="nc" id="L173">				} catch (JdmoException e) {</span>
<span class="nc" id="L174">					CAT.error(&quot;Exception while updating scheduling status &quot;, e);</span>
<span class="nc" id="L175">				}</span>
				// check the scheduling status of currently processed ones and
				// stop
				
<span class="nc" id="L179">				List&lt;ID&gt; ids = new ArrayList&lt;ID&gt;();</span>
<span class="nc" id="L180">				ids.addAll(requestIDs);</span>
				try {
<span class="nc" id="L182">					List&lt;WSAutoScheduleRequest&gt; requests = dao</span>
<span class="nc" id="L183">							.getRequestsByStatus(</span>
									WSAutoScheduleRequest.SCHEDULE_STATUS_IN_PROGRESS,
									ids);
<span class="nc" id="L186">					for (Iterator&lt;WSAutoScheduleRequest&gt; it = requests</span>
<span class="nc bnc" id="L187" title="All 2 branches missed.">							.iterator(); it.hasNext();) {</span>
<span class="nc" id="L188">						WSAutoScheduleRequest request = it.next();</span>
						try {
<span class="nc" id="L190">							ID spID = ID.fromInt(request.getSPID());</span>
<span class="nc" id="L191">							SchedulingState state = m_campaignManager</span>
<span class="nc" id="L192">									.getSchedulingState(spID, request.getMode());</span>

<span class="nc bnc" id="L194" title="All 4 branches missed.">							if (state != null &amp;&amp; state.isEnableStopSaveButton()</span>
<span class="nc bnc" id="L195" title="All 2 branches missed.">									&amp;&amp; state.getOverallStatus() &lt; 100) {</span>
								// warnings etc must be copied and cleared and
								// the
								// status cleared from spsched status tables
<span class="nc" id="L199">								List&lt;ID&gt; warnIds = new ArrayList&lt;ID&gt;();</span>
<span class="nc" id="L200">								boolean hasError = copySchedStateWarningsToRequestAndGetErrorStatus(</span>
										state, request, warnIds);
<span class="nc bnc" id="L202" title="All 2 branches missed.">								if (warnIds.size() &gt; 0) {</span>
<span class="nc" id="L203">									m_campaignManager</span>
<span class="nc" id="L204">											.clearSchedulingStateWarnings(warnIds);</span>
								}
<span class="nc bnc" id="L206" title="All 4 branches missed.">								if (hasError || haltedOnError) {</span>
<span class="nc" id="L207">									request.setFieldValue(</span>
											WSAutoScheduleRequestFieldInfo.SCHEDULESTATUS,
											WSAutoScheduleRequest.SCHEDULE_STATUS_ERROR);
<span class="nc" id="L210">									CAT.error(&quot;Error while scheduling Request &quot;</span>
<span class="nc" id="L211">											+ spID.toInt() + &quot; Status is &quot;</span>
<span class="nc" id="L212">											+ state.toString());</span>
								} else {
<span class="nc" id="L214">									SchedulingRequest schedRequest = new SchedulingRequest();</span>
<span class="nc" id="L215">									schedRequest.setSPSID(spID);</span>
<span class="nc" id="L216">									schedRequest.setMode(request.getMode());</span>
<span class="nc" id="L217">									schedRequest</span>
<span class="nc" id="L218">											.setRequest(REQUEST_STOP_AND_SAVE);</span>
<span class="nc" id="L219">									m_campaignManager</span>
<span class="nc" id="L220">											.makeSchedulingRequest(schedRequest);</span>
<span class="nc" id="L221">									request.setFieldValue(</span>
											WSAutoScheduleRequestFieldInfo.SCHEDULESTATUS,
											WSAutoScheduleRequest.SCHEDULE_STATUS_STOPPED);
								}
<span class="nc" id="L225">								dao.updateSchedulingRequest(request);</span>
								// clear scheduling state
<span class="nc" id="L227">								m_campaignManager.clearSchedulingState(spID,</span>
<span class="nc" id="L228">										request.getMode());</span>
							}
<span class="nc" id="L230">						} catch (BbmFinderException e) {</span>
<span class="nc" id="L231">							CAT.error(</span>
									&quot;Exception while getting scheduling status using the Campaign Manager for request &quot;
<span class="nc" id="L233">											+ request.getID(), e);</span>
<span class="nc" id="L234">						} catch (RemoteException e) {</span>
<span class="nc" id="L235">							CAT.error(</span>
									&quot;Exception while stopping the scheduling for request &quot;
<span class="nc" id="L237">											+ request.getID(), e);</span>
<span class="nc" id="L238">						} catch (BbmCreateException e) {</span>
<span class="nc" id="L239">							CAT.error(</span>
									&quot;Exception while placing the stop schedule request for request &quot;
<span class="nc" id="L241">											+ request.getID(), e);</span>
<span class="nc" id="L242">						} catch (JdmoException e) {</span>
<span class="nc" id="L243">							CAT.error(</span>
									&quot;Exception while updating scheduling status for request &quot;
<span class="nc" id="L245">											+ request.getID(), e);</span>
<span class="nc" id="L246">						} catch (BbmRemoveException e) {</span>
<span class="nc" id="L247">							CAT.error(</span>
									&quot;Exception while clearing the Scheduling State for request&quot;
<span class="nc" id="L249">											+ request.getID(), e);</span>
<span class="nc" id="L250">						}</span>
<span class="nc" id="L251">					}</span>
<span class="nc" id="L252">				} catch (BbmFinderException e) {</span>
<span class="nc" id="L253">					CAT.error(&quot;Could not get the requests by IDs&quot;, e);</span>
<span class="nc" id="L254">				}</span>
			} finally {
<span class="nc" id="L256">				dao.cleanUp();</span>
<span class="nc" id="L257">			}</span>
<span class="nc" id="L258">		}</span>
<span class="nc" id="L259">	}</span>


	/**
	 * Stops the scheduling requests for the given SPs.  If haltedOnError is false, the scheduling
	 * requests that are currently new (N) or in progress (P) will have their statuses set to Stop (S).
	 * If haltedOnError is true, they will be set to Error (E).  The status message field of the requests
	 * will be set to the given statusMessage.
	 * 
	 * @param statusMessage - An optional parameter.  If there is an error you can set this as the text
	 * description of the error and this will be read by the external RFS program and displayed to the user.
	 */
	public void stopScheduling(Collection&lt;ID&gt; spIDs, SchedulingMode mode, boolean haltedOnError, String statusMessage) {
<span class="nc" id="L272">		WSAutoScheduleRequestDAO dao = new WSAutoScheduleRequestDAO();</span>
<span class="nc" id="L273">		synchronized (_LOCK) {</span>
			try {
				// update all new scheduling requests for the given scheduling
				// period
				try {
<span class="nc bnc" id="L278" title="All 2 branches missed.">					if (haltedOnError) {</span>
<span class="nc" id="L279">						dao.updateScheduleStatusForSPs(new ArrayList&lt;ID&gt;(spIDs),</span>
								WSAutoScheduleRequest.SCHEDULE_STATUS_NEW,
								WSAutoScheduleRequest.SCHEDULE_STATUS_ERROR,
								statusMessage);
					} else {
<span class="nc" id="L284">						dao.updateScheduleStatusForSPs(new ArrayList&lt;ID&gt;(spIDs),</span>
								WSAutoScheduleRequest.SCHEDULE_STATUS_NEW,
								WSAutoScheduleRequest.SCHEDULE_STATUS_STOPPED,
								statusMessage);
					}
<span class="nc" id="L289">				} catch (JdmoException e) {</span>
<span class="nc" id="L290">					CAT.error(&quot;Exception while updating scheduling status &quot;, e);</span>
<span class="nc" id="L291">				}</span>
				// check the scheduling status of currently processed ones and
				// stop
<span class="nc bnc" id="L294" title="All 2 branches missed.">				for (Iterator&lt;ID&gt; it = spIDs.iterator(); it.hasNext();) {</span>
<span class="nc" id="L295">					ID spID = it.next();</span>
					try {
<span class="nc" id="L297">						SchedulingState state = m_campaignManager.getSchedulingState(spID, mode.mode);</span>

<span class="nc bnc" id="L299" title="All 4 branches missed.">						if (state != null &amp;&amp; state.isEnableStopSaveButton()</span>
<span class="nc bnc" id="L300" title="All 2 branches missed.">								&amp;&amp; state.getOverallStatus() &lt; 100) {</span>
							// warnings etc must be copied and cleared and the
							// status cleared from spsched status tables
<span class="nc" id="L303">							List&lt;WSAutoScheduleRequest&gt; requests = dao.getRequestsByStatusAndSP(</span>
									WSAutoScheduleRequest.SCHEDULE_STATUS_IN_PROGRESS, spID);
<span class="nc bnc" id="L305" title="All 2 branches missed.">							if (requests.size() &gt; 0) {</span>
<span class="nc" id="L306">								WSAutoScheduleRequest request = requests.get(0);</span>
<span class="nc" id="L307">								List&lt;ID&gt; warnIds = new ArrayList&lt;ID&gt;();</span>
<span class="nc" id="L308">								boolean hasError = copySchedStateWarningsToRequestAndGetErrorStatus(</span>
										state, request, warnIds);
<span class="nc bnc" id="L310" title="All 2 branches missed.">								if (warnIds.size() &gt; 0) {</span>
<span class="nc" id="L311">									m_campaignManager.clearSchedulingStateWarnings(warnIds);</span>
								}
<span class="nc bnc" id="L313" title="All 4 branches missed.">								if (hasError || haltedOnError) {</span>
<span class="nc" id="L314">									request.setFieldValue(</span>
											WSAutoScheduleRequestFieldInfo.SCHEDULESTATUS,
											WSAutoScheduleRequest.SCHEDULE_STATUS_ERROR);
<span class="nc" id="L317">									CAT.error(&quot;Error while scheduling Request &quot;</span>
<span class="nc" id="L318">											+ spID.toInt() + &quot; Status is &quot;</span>
<span class="nc" id="L319">											+ state.toString());</span>
								} else {
<span class="nc" id="L321">									SchedulingRequest schedRequest = new SchedulingRequest();</span>
<span class="nc" id="L322">									schedRequest.setSPSID(spID);</span>
<span class="nc" id="L323">									schedRequest.setMode(request.getMode());</span>
<span class="nc" id="L324">									schedRequest.setRequest(REQUEST_STOP_AND_SAVE);</span>
<span class="nc" id="L325">									m_campaignManager.makeSchedulingRequest(schedRequest);</span>
<span class="nc" id="L326">									request.setFieldValue(</span>
											WSAutoScheduleRequestFieldInfo.SCHEDULESTATUS,
											WSAutoScheduleRequest.SCHEDULE_STATUS_STOPPED);
								}
<span class="nc" id="L330">								dao.updateSchedulingRequest(request);</span>
							}

							// clear scheduling state
<span class="nc" id="L334">							m_campaignManager.clearSchedulingState(spID, mode.mode);</span>
						}
<span class="nc" id="L336">					} catch (BbmFinderException e) {</span>
<span class="nc" id="L337">						CAT.error(&quot;Exception while getting scheduling status using the Campaign Manager for scheduling period &quot;</span>
								+ spID, e);
<span class="nc" id="L339">					} catch (RemoteException e) {</span>
<span class="nc" id="L340">						CAT.error(&quot;Exception while stopping the scheduling for scheduling period &quot;</span>
								+ spID, e);
<span class="nc" id="L342">					} catch (BbmCreateException e) {</span>
<span class="nc" id="L343">						CAT.error(&quot;Exception while placing the stop schedule request for Scheduling Period &quot;</span>
								+ spID, e);
<span class="nc" id="L345">					} catch (JdmoException e) {</span>
<span class="nc" id="L346">						CAT.error(&quot;Exception while updating scheduling status for Scheduling Period &quot;</span>
								+ spID, e);
<span class="nc" id="L348">					} catch (BbmRemoveException e) {</span>
<span class="nc" id="L349">						CAT.error(&quot;Exception while clearing the Scheduling State for Scheduling Period &quot;</span>
								+ spID, e);
<span class="nc" id="L351">					}</span>
<span class="nc" id="L352">				}</span>
			} finally {
<span class="nc" id="L354">				dao.cleanUp();</span>
<span class="nc" id="L355">			}</span>
<span class="nc" id="L356">		}</span>
<span class="nc" id="L357">	}</span>
	
	
	
	public boolean doesScheduleExist(int spID) {
<span class="nc" id="L362">		PredictedTimeSeriesDAO dao = new PredictedTimeSeriesDAO();</span>
		try {
<span class="nc" id="L364">			return dao.hasTimeSeries(spID);</span>
<span class="nc" id="L365">		} catch (JdmoException e) {</span>
<span class="nc" id="L366">			CAT.error(</span>
					&quot;Exception while checking if schedule exists for the scheduling period already &quot;,
					e);
		} finally {
<span class="nc" id="L370">			dao.cleanUp();</span>
<span class="nc" id="L371">		}</span>
<span class="nc" id="L372">		return false;</span>

	}

	private boolean copySchedStateWarningsToRequestAndGetErrorStatus(SchedulingState state, WSAutoScheduleRequest request, List&lt;ID&gt; warnIds){
<span class="nc" id="L377">		Collection&lt;SchedulingWarning&gt; warnings = state.getWarnings();</span>

<span class="nc" id="L379">		boolean hasError = false;</span>
<span class="nc bnc" id="L380" title="All 2 branches missed.">		if (warnings.size() &gt; 0) {</span>

<span class="nc" id="L382">			StringBuffer warnCodeBuffer = new StringBuffer();</span>
<span class="nc" id="L383">			StringBuffer warnMessageBuffer = new StringBuffer();</span>
<span class="nc" id="L384">			int i = 0;</span>

<span class="nc bnc" id="L386" title="All 2 branches missed.">			for (Iterator&lt;SchedulingWarning&gt; it = warnings.iterator(); it.hasNext();) {</span>
<span class="nc bnc" id="L387" title="All 2 branches missed.">				if (i &gt; 0) {</span>
<span class="nc" id="L388">					warnCodeBuffer.append(&quot;|&quot;);</span>
<span class="nc" id="L389">					warnMessageBuffer.append(&quot;|&quot;);</span>
				}
<span class="nc" id="L391">				i++;</span>
<span class="nc" id="L392">				SchedulingWarning warning = it.next();</span>
<span class="nc" id="L393">				warnIds.add(warning.getID());</span>
<span class="nc bnc" id="L394" title="All 2 branches missed.">				if(warning.getTypeIndex()==ERROR_TYPE_INDEX)</span>
				{
<span class="nc" id="L396">					hasError = true;</span>
				}
<span class="nc" id="L398">				warnCodeBuffer.append(warning.getTypeString());</span>
<span class="nc" id="L399">				warnMessageBuffer.append(warning.getWarning());</span>
<span class="nc" id="L400">			}</span>
<span class="nc" id="L401">			String originalCode = (String)request.getFieldValue(WSAutoScheduleRequestFieldInfo.STATUSMESSAGETYPE);</span>
<span class="nc" id="L402">			String originalMessage = request.getStatusMessage();</span>
<span class="nc bnc" id="L403" title="All 2 branches missed.">			request.setFieldValue(</span>
					WSAutoScheduleRequestFieldInfo.STATUSMESSAGETYPE,
<span class="nc" id="L405">					originalCode==null? warnCodeBuffer.toString(): originalCode+&quot;|&quot;+warnCodeBuffer.toString());</span>
<span class="nc bnc" id="L406" title="All 2 branches missed.">			request.setFieldValue(</span>
					WSAutoScheduleRequestFieldInfo.STATUSMESSAGE,
<span class="nc" id="L408">					originalMessage==null?warnMessageBuffer.toString():originalMessage+&quot;|&quot;+warnMessageBuffer.toString());</span>

		}
<span class="nc" id="L411">		return hasError;</span>
	}
	
	private void createCampaignManager() {
		try {
<span class="fc" id="L416">			m_campaignManager = WfmManagerFactory.getCampaignManager();</span>
<span class="nc" id="L417">		} catch (BbmEJBCreateException e) {</span>
<span class="nc" id="L418">			CAT.error(&quot;Error getting the CampaignManager&quot;, e);</span>
<span class="fc" id="L419">		}</span>
<span class="fc" id="L420">	}</span>
	
	private UserManager getUserManager() {
		try
		{
<span class="nc bnc" id="L425" title="All 2 branches missed.">			if(m_userManager == null)</span>
<span class="nc" id="L426">				m_userManager = CoreManagerFactory.getUserManager(false);  // isInWhatIf = false // we don't care about WhatIf mode here</span>
<span class="nc" id="L427">		}catch (CoreEJBCreateException e)</span>
		{
<span class="nc" id="L429">			CAT.error(&quot;Error gettting the UserManager&quot;, e);</span>
<span class="nc" id="L430">		}</span>
<span class="nc" id="L431">		return m_userManager;</span>
	}

	private String getSuperUser() {
<span class="nc bnc" id="L435" title="All 2 branches missed.">		if (getUserManager() != null) {</span>
			try {
<span class="nc" id="L437">				User superuser = getUserManager().getUserByID(User.SUPER_USERID);</span>
<span class="nc" id="L438">				String systemUser = superuser.getUserName();</span>
<span class="nc" id="L439">				return systemUser;</span>
<span class="nc" id="L440">			} catch (CoreFinderException e) {</span>
<span class="nc" id="L441">				CAT.warn(&quot;Could not find the super user&quot;);</span>
			} 
<span class="nc" id="L443">			catch (RemoteException e) {</span>
<span class="nc" id="L444">				CAT.error(&quot;Error getting the super user&quot;);</span>
<span class="nc" id="L445">			}</span>
		}
<span class="nc" id="L447">		return null;</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>