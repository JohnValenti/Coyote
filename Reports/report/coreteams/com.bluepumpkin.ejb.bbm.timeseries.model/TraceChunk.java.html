<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>TraceChunk.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.ejb.bbm.timeseries.model</a> &gt; <span class="el_source">TraceChunk.java</span></div><h1>TraceChunk.java</h1><pre class="source lang-java linenums">/*
 * (c) 2002 - 2017 Verint Systems, Inc.
 */
package com.bluepumpkin.ejb.bbm.timeseries.model;

import java.io.Externalizable;
import java.io.IOException;
import java.io.ObjectInput;
import java.io.ObjectOutput;
import java.util.Arrays;
import java.util.Date;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.ejb.bbm.timeseries.util.TraceUtil;

/**
 * TraceChunks are effectively single interval slices of a tracecube, containing an array of trace data for different trace types
 * for a single time interval.
 */
public class TraceChunk extends Trace implements Comparable&lt;TraceChunk&gt;, Externalizable {
	private static final long serialVersionUID = 1L;

<span class="pc" id="L23">	private float[] m_TraceValue = new float[Trace.MAX_TYPE];</span>

<span class="pc" id="L25">	private Date m_LastModifiedAt = new Date();</span>

	public TraceChunk() {
<span class="nc" id="L28">		super();</span>
<span class="nc" id="L29">		initTrace();</span>
<span class="nc" id="L30">	}</span>

	/**
	 * TraceChunk intends to be a container for Traces happening at the same
	 * point Once the object is created, these two basic values are not to be
	 * changed The constructor will normalize the StartDate to mid-night
	 *
	 * @param queueID
	 * @param startDate, any time
	 */
<span class="fc" id="L40">	public TraceChunk(ID queueID, Date startDate) {</span>
<span class="fc" id="L41">		m_QueueID = queueID;</span>
<span class="fc" id="L42">		m_StartDate = TraceUtil.snapDate(startDate);</span>
<span class="fc" id="L43">		initTrace();</span>
<span class="fc" id="L44">	}</span>

	/**
	 * getTraceTypes, return Types that has non -1 value
	 *
	 * @return short[]
	 */
	public short[] getTraceTypes() {
<span class="nc" id="L52">		short size = 0;</span>
<span class="nc bnc" id="L53" title="All 2 branches missed.">		for (short i = 0; i &lt; Trace.MAX_TYPE; i++) {</span>
<span class="nc bnc" id="L54" title="All 2 branches missed.">			if (m_TraceValue[i] != TRACENA) {</span>
<span class="nc" id="L55">				size++;</span>
			}
		}
<span class="nc bnc" id="L58" title="All 2 branches missed.">		if (size == 0) {</span>
<span class="nc" id="L59">			return null;</span>
		}
<span class="nc" id="L61">		short[] types = new short[size];</span>
<span class="nc bnc" id="L62" title="All 2 branches missed.">		for (short i = 0, j = 0; i &lt; Trace.MAX_TYPE; i++) {</span>
<span class="nc bnc" id="L63" title="All 2 branches missed.">			if (m_TraceValue[i] != TRACENA) {</span>
<span class="nc" id="L64">				types[j] = i;</span>
<span class="nc" id="L65">				j++;</span>
			}
		}
<span class="nc" id="L68">		return types;</span>
	}

	/**
	 * getTraceValue, based on the type
	 *
	 * @param type, Trace Type definition
	 * @return float, Trace value, -1 means Unknown
	 */
	public float getTraceValue(short type) {
<span class="pc bpc" id="L78" title="2 of 4 branches missed.">		if (type &gt;= 0 &amp;&amp; type &lt; Trace.MAX_TYPE) {</span>
<span class="fc" id="L79">			return m_TraceValue[type];</span>
		}
<span class="nc" id="L81">		return TRACENA;</span>
	}

	/**
	 * quickly return all values in float[]
	 *
	 * @return float[], all trace types value
	 */
	public float[] getTraceValues() {
<span class="nc" id="L90">		return m_TraceValue;</span>
	}

	/**
	 * quickly return all values in float[]
	 *
	 * @return float[], all trace types value
	 */
	public float[] getTraceValues(short[] types) {
<span class="fc" id="L99">		float[] values = new float[types.length];</span>
<span class="fc bfc" id="L100" title="All 2 branches covered.">		for (int i = 0; i &lt; types.length; i++) {</span>
<span class="fc" id="L101">			values[i] = m_TraceValue[types[i]];</span>
		}
<span class="fc" id="L103">		return values;</span>
	}

	/**
	 * setTraceValue, set Trace value for each Type one by one
	 *
	 * @param type, Trace Type definition
	 * @param value, Trace Value
	 */
	public void setTraceValue(short type, float value) {
<span class="pc bpc" id="L113" title="2 of 4 branches missed.">		if (type &gt;= 0 &amp;&amp; type &lt; Trace.MAX_TYPE) {</span>
<span class="fc" id="L114">			m_TraceValue[type] = value;</span>
		}
<span class="fc" id="L116">		m_LastModifiedAt = new Date();</span>
<span class="fc" id="L117">	}</span>

	/**
	 * setTraceValues, set Trace value as an Array
	 *
	 * @param types, Trace Type definition for each Trace Value
	 * @param values, Trace value corresponding to the Trace Type
	 */
	public void setTraceValues(short[] types, float[] values) {
<span class="nc bnc" id="L126" title="All 2 branches missed.">		for (int i = 0; i &lt; types.length; i++) {</span>
			// Early termination, if values are less than types
<span class="nc bnc" id="L128" title="All 2 branches missed.">			if (i == values.length) {</span>
<span class="nc" id="L129">				break;</span>
			}
<span class="nc" id="L131">			setTraceValue(types[i], values[i]);</span>
		}
<span class="nc" id="L133">	}</span>

	/**
	 * setTraceValues, set Trace value as an Array
	 *
	 * @param types, Trace Type definition for each Trace Value
	 * @param values, Trace value corresponding to the Trace Type
	 */
	public void setTraceValues(short[] types, int[] values) {
<span class="nc bnc" id="L142" title="All 2 branches missed.">		for (int i = 0; i &lt; types.length; i++) {</span>
			// Early termination, if values are less than types
<span class="nc bnc" id="L144" title="All 2 branches missed.">			if (i == values.length) {</span>
<span class="nc" id="L145">				break;</span>
			}
<span class="nc" id="L147">			setTraceValue(types[i], values[i]);</span>
		}
<span class="nc" id="L149">	}</span>

	/**
	 * setTraceValues, set Trace value as an Array
	 *
	 * @param types, Trace Type definition for each Trace Value
	 * @param values, Trace value corresponding to the Trace Type
	 */
	public void setTraceValues(short[] types, double[] values) {
<span class="nc bnc" id="L158" title="All 2 branches missed.">		for (int i = 0; i &lt; types.length; i++) {</span>
			// Early termination, if values are less than types
<span class="nc bnc" id="L160" title="All 2 branches missed.">			if (i == values.length) {</span>
<span class="nc" id="L161">				break;</span>
			}
<span class="nc" id="L163">			setTraceValue(types[i], (float) values[i]);</span>
		}
<span class="nc" id="L165">	}</span>

	public Date getLastModifedDate() {
<span class="nc" id="L168">		return m_LastModifiedAt;</span>
	}

	public void setLastModifiedDate(Date date) {
<span class="nc" id="L172">		m_LastModifiedAt = date;</span>
<span class="nc" id="L173">	}</span>

	// Convert TraceChunk into a String
	public String toString() {
<span class="nc" id="L177">		StringBuffer sb = new StringBuffer(100);</span>
<span class="nc" id="L178">		sb.append(&quot;TraceChunk&quot;);</span>
<span class="nc bnc" id="L179" title="All 2 branches missed.">		if (getQueueID() != null) {</span>
<span class="nc" id="L180">			sb.append(&quot;\t&quot;).append(&quot;Queue ID: &quot; + getQueueID());</span>
		}
<span class="nc bnc" id="L182" title="All 2 branches missed.">		if (getStartDate() != null) {</span>
<span class="nc" id="L183">			sb.append(&quot;\t&quot;).append(&quot;Started at: &quot; + getStartDate());</span>
		}
<span class="nc" id="L185">		sb.append(&quot;\n&quot;);</span>
<span class="nc bnc" id="L186" title="All 2 branches missed.">		for (int i = 0; i &lt; m_TraceValue.length; i++) {</span>
<span class="nc" id="L187">			sb.append(&quot;\t&quot;).append(getTraceName((short) i)).append(&quot; has &quot;).append(m_TraceValue[i]);</span>
		}
<span class="nc bnc" id="L189" title="All 2 branches missed.">		if (m_LastModifiedAt != null) {</span>
<span class="nc" id="L190">			sb.append(&quot;, last modified at: &quot;).append(m_LastModifiedAt);</span>
		}
<span class="nc" id="L192">		sb.append(&quot;\n&quot;);</span>
<span class="nc" id="L193">		return sb.toString();</span>
	}

	@Override
	public int hashCode() {
<span class="nc" id="L198">		int result = 17;</span>
<span class="nc bnc" id="L199" title="All 2 branches missed.">		result = 31 * result + (getQueueID() == null ? 0 : getQueueID().hashCode());</span>
<span class="nc bnc" id="L200" title="All 2 branches missed.">		result = 31 * result + (getStartDate() == null ? 0 : getStartDate().hashCode());</span>
<span class="nc" id="L201">		return result;</span>
	}

	@Override
	public boolean equals(Object obj) {
<span class="nc bnc" id="L206" title="All 2 branches missed.">		if (obj instanceof TraceChunk) {</span>
<span class="nc" id="L207">			TraceChunk tc = (TraceChunk) obj;</span>
<span class="nc" id="L208">			ID qID = getQueueID();</span>
<span class="nc" id="L209">			ID tcQID = tc.getQueueID();</span>
<span class="nc bnc" id="L210" title="All 4 branches missed.">			if (qID == null || tcQID == null) {</span>
<span class="nc" id="L211">				return false;</span>
			}
<span class="nc bnc" id="L213" title="All 2 branches missed.">			if (qID.equals(tcQID)) {</span>
<span class="nc" id="L214">				Date date1 = getStartDate();</span>
<span class="nc" id="L215">				Date date2 = tc.getStartDate();</span>
<span class="nc bnc" id="L216" title="All 4 branches missed.">				if (date1 == null || date2 == null) {</span>
<span class="nc" id="L217">					return false;</span>
				}
<span class="nc bnc" id="L219" title="All 2 branches missed.">				if (!date1.equals(date2)) {</span>
<span class="nc" id="L220">					return false;</span>
				} else {
<span class="nc" id="L222">					return true;</span>
				}
			}
		}
<span class="nc" id="L226">		return false;</span>
	}

	@Override
	public int compareTo(TraceChunk obj) {
<span class="nc" id="L231">		TraceChunk tc = obj;</span>
<span class="nc" id="L232">		Date date1 = getStartDate();</span>
<span class="nc" id="L233">		Date date2 = tc.getStartDate();</span>
<span class="nc bnc" id="L234" title="All 4 branches missed.">		if (date1 == null || date2 == null) {</span>
<span class="nc" id="L235">			return 1;</span>
		}
<span class="nc bnc" id="L237" title="All 2 branches missed.">		if (date1.before(date2)) {</span>
<span class="nc" id="L238">			return TRACENA;</span>
<span class="nc bnc" id="L239" title="All 2 branches missed.">		} else if (date1.after(date2)) {</span>
<span class="nc" id="L240">			return 1;</span>
		} else {
<span class="nc" id="L242">			return 0;</span>
		}
	}

	// Internal function to preset TraceValue to -1
	private void initTrace() {
<span class="fc" id="L248">		Arrays.fill(m_TraceValue, TRACENA);</span>
<span class="fc" id="L249">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see java.io.Externalizable#readExternal(java.io.ObjectInput)
	 */
	public void readExternal(ObjectInput in) throws IOException, ClassNotFoundException {
<span class="nc" id="L257">		m_QueueID = (ID) in.readObject();</span>
<span class="nc" id="L258">		m_StartDate = (Date) in.readObject();</span>
<span class="nc" id="L259">		m_LastModifiedAt = (Date) in.readObject();</span>
<span class="nc" id="L260">		m_TraceValue = (float[]) in.readObject();</span>

<span class="nc" id="L262">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see java.io.Externalizable#writeExternal(java.io.ObjectOutput)
	 */
	public void writeExternal(ObjectOutput out) throws IOException {
<span class="nc" id="L270">		out.writeObject(m_QueueID);</span>
<span class="nc" id="L271">		out.writeObject(m_StartDate);</span>
<span class="nc" id="L272">		out.writeObject(m_LastModifiedAt);</span>
<span class="nc" id="L273">		out.writeObject(m_TraceValue);</span>
<span class="nc" id="L274">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>