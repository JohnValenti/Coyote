<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>AddTimeRecordModel.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.am.timerecords</a> &gt; <span class="el_source">AddTimeRecordModel.java</span></div><h1>AddTimeRecordModel.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.am.timerecords;

import javax.servlet.http.HttpServletRequest;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.StringsPair;
import com.bluepumpkin.common.logging.Category;
import com.bluepumpkin.common.util.StringUtil;
import com.bluepumpkin.ejb.bbm.activity.model.Activity;
import com.bluepumpkin.ejb.bbm.activity.model.ActivityCategory;
import com.bluepumpkin.ejb.bbm.activity.model.ActivityGroup;
import com.bluepumpkin.ejb.bbm.timerecord.model.TimeRecord;
import com.bluepumpkin.ejb.bbm.timerecord.model.TimeRecordEntry;
import com.bluepumpkin.ejb.bbm.workresource.model.Organization;
import com.bluepumpkin.web.am.Log;
import com.bluepumpkin.web.am.l10n.AmWebBundleKey;
import com.bluepumpkin.web.am.l10n.AmWebLogBundleKey;
import com.bluepumpkin.web.am.util.JSPUtil;
import com.bluepumpkin.web.bbm.activity.ActivityModelHandler;
import com.witness.web.uif.base.UnableToLoadDataException;
import com.witness.web.uif.jsp.HtmlButton;
import com.witness.web.uif.jsp.HtmlImage;
import com.witness.web.uif.jsp.HtmlLink;
import com.witness.web.uif.jsp.HtmlSelect;
import com.witness.web.uif.keys.ImageFileID;
import com.witness.web.uif.keys.JavaScriptFileID;
import com.witness.web.uif.keys.PageAction;
import com.witness.web.uif.l10n.UIFWebBundleKey;
import com.witness.web.uif.pagecomponent.contenttitle.ContentTitlePC;
import com.witness.web.uif.pagecomponent.picker.date.DatePickerPC;
import com.witness.web.uif.pagecomponent.picker.time.TimeZoneOverrideTogglePC;
import com.witness.web.uif.pagemodel.PopupWindowPM;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.util.HourMinInput;
import com.witness.web.uif.util.HtmlUtil;
import com.witness.web.uif.util.html.CSSUtil;

import java.text.MessageFormat;
import java.util.*;


/**
 * Title:        Blue Pumpkin Software Activity Management
 * Description:  Add time record model
 * Copyright:    Copyright (c) 2001
 * Company:      Blue Pumpkin Software, Inc
 * @author       Swati Tewari
 * @version 1.0
 */

public class AddTimeRecordModel extends PopupWindowPM{

	private static final String CLASS_ATTR = &quot;class&quot;;
	private static final int ADDITIONAL_ROW_COUNT = 2;
	private static final int INPUT_SIZE = 100;
	private static final int INPUT_MAX_LEN = 200;
	public static final String MODEL_KEY = &quot;AddTimeRecordModel&quot;;
	public static final String ADDTR_ACTION = &quot;ADDTR_ACTION&quot;;
	public static final String INSERTTE_ACTION = &quot;INSERTTE_ACTION&quot;;
	public static final String DELETETE_ACTION = &quot;DELETETE_ACTION&quot;;
	public static final String REFRESH_ACTION = &quot;REFRESH_ACTION&quot;;
	public static final String SAVETR_ACTION = &quot;SAVE_ACTION&quot;;
	public static final String DONE_ACTION = &quot;DONE_ACTION&quot;;
	public static final String CLOSEANDSAVETR_ACTION = &quot;CLOSEANDSAVETR_ACTION&quot;;
	
	public static final String TIME_ENTRY_TABLE_NAME = &quot;timeEntryTable&quot;;
	public static final String TIME_ENTRIES_GRID_ID = &quot;timeEntriesGridId&quot;;
	public static final String TIME_ENTRIES_GRID_MSG_ID = &quot;timeEntriesGridInstructionMsgId&quot;;
	

	// Page Actions
<span class="fc" id="L72">	private static Category cat  = Log.initCategory(AddTimeRecordModel.class.getName());</span>
	private ResourceBundle m_bundle;
	private ID empId;
	private String tableContent;
	private String pageTitleText;
	private String popUpHeader;
<span class="nc" id="L78">	private ArrayList tableData = new ArrayList();</span>
<span class="nc" id="L79">	private TimeRecord timeRecord = null;</span>
<span class="nc" id="L80">	private Date date = new Date();</span>
	private String selectedID;
	private ID[] selectedIDs;
<span class="nc" id="L83">	private int curIndex = 0;</span>
	private ID orgId;
	private ID timeRecordID;
<span class="nc" id="L86">	private String timeZone = null;</span>
<span class="nc" id="L87">	private int[] durationHour = new int[]{};</span>
<span class="nc" id="L88">	private int[] durationMinute = new int[]{};</span>
	private boolean[] isPaid;
	private String[] comment;
	private int position;
<span class="nc" id="L92">	private String remarks = &quot;&quot;;</span>
<span class="nc" id="L93">	ActivityGroup activityGroup = null;</span>
<span class="nc" id="L94">	private boolean m_isInitiated = false;</span>
	private int startYear;
	private int startMonth;
	private int startDay;
	private List m_dateList;

	//activity related variables
<span class="nc" id="L101">	private ArrayList activityCategoryNameList = new ArrayList();</span>
<span class="nc" id="L102">	private ArrayList activityCategoryIDList = new ArrayList();</span>
<span class="nc" id="L103">	private ArrayList activityColl = new ArrayList();</span>
<span class="nc" id="L104">	private ID[] activityList = new ID[]{};</span>
<span class="nc" id="L105">	private ID[] activityCategory = new ID[]{};</span>

	private DatePickerPC m_dateTimePickerPC;

	/**
	 * Constructor
	 */
	public AddTimeRecordModel(RequestContext context) {
<span class="nc" id="L113">		super(context);</span>
<span class="nc" id="L114">		m_bundle = m_localizer.getBundle(AmWebBundleKey.BUNDLE_NAME);</span>

<span class="nc" id="L116">		addRequiredJavaScriptFile(JavaScriptFileID.DIALOG_PICKERS);</span>
<span class="nc" id="L117">		addRequiredJavaScriptFile(JavaScriptFileID.DATEORMAT_UTILITIES);</span>

		//--- add a DatePicker Dialog Box to the model
		// It is enclosed in a DialogBoxPageModel to provide DialogMediator support.
<span class="nc" id="L121">		m_dateTimePickerPC = new DatePickerPC(context, &quot;display&quot;);</span>
<span class="nc" id="L122">		m_dateTimePickerPC.setIsTimeEnabled(true);</span>
<span class="nc bnc" id="L123" title="All 2 branches missed.">		if (isAccessibilityComplianceMode()) {</span>
<span class="nc" id="L124">			m_dateTimePickerPC.setAriaLabel(getTimeLabel());</span>
<span class="nc" id="L125">			addRequiredJavaScriptFile(JavaScriptFileID.MODULE_TABLE);</span>
<span class="nc" id="L126">			appendJSToJSMain(&quot;top.&quot; + TIME_ENTRY_TABLE_NAME + &quot;.addRowFocusIndicator('true');&quot;);</span>
		}
<span class="nc" id="L128">		addChildComponent(m_dateTimePickerPC);</span>

		//presentation
<span class="nc" id="L131">		setMinWorkAreaHeight(70);</span>
<span class="nc" id="L132">		setWorkAreaId(&quot;summaryWrapper&quot;);</span>
<span class="nc" id="L133">	}</span>

	/**
	 * Return instance of Model which is ready to be rendered
	 */
	public static AddTimeRecordModel getInstance(RequestContext context)throws Exception{
<span class="nc" id="L139">		AddTimeRecordModel model = null;</span>
		try{
<span class="nc" id="L141">			model = (AddTimeRecordModel) context.getAttribute(RequestContext.REQUEST_SCOPE,</span>
								AddTimeRecordModel.MODEL_KEY);

<span class="nc bnc" id="L144" title="All 2 branches missed.">			if (model==null){</span>
				//create a new model
<span class="nc" id="L146">				model = new AddTimeRecordModel(context);</span>
			}

<span class="nc" id="L149">			model.populateModel(context);</span>
<span class="nc" id="L150">		} catch (UnableToLoadDataException ex){</span>
<span class="nc" id="L151">			cat.l7dError(AmWebLogBundleKey.UNABLE_TO_LOAD_DATA, ex);</span>
<span class="nc" id="L152">		}</span>
<span class="nc" id="L153">		return model;</span>
	}

	/**
	 * Return the resource bundle associated with the page model
	 */
	public ResourceBundle getBundle() {
<span class="nc" id="L160">		return m_bundle;</span>
	}

	/**
	 * Make sure that the model is populated
	 */
	private void populateModel(RequestContext context) throws UnableToLoadDataException, Exception {
<span class="nc" id="L167">		this.setTableContent(context);</span>
<span class="nc bnc" id="L168" title="All 2 branches missed.">		if (m_isInitiated) return;</span>
<span class="nc" id="L169">		this.setPopupPageTitle();</span>
<span class="nc" id="L170">		this.getPopupHeader();</span>
<span class="nc" id="L171">		initToolbar();</span>
<span class="nc" id="L172">		m_isInitiated = true;</span>
<span class="nc" id="L173">	}</span>

	protected void initToolbar(){
<span class="nc bnc" id="L176" title="All 2 branches missed.">		if (this.getPageAction().equals(CLOSEANDSAVETR_ACTION)){</span>
<span class="nc" id="L177">			m_toolbar.addValidateSubmitTextButton(</span>
				CLOSEANDSAVETR_ACTION,
<span class="nc" id="L179">				i18n(m_bundle, AmWebBundleKey.CLOSESHIFT_BUTTONLABEL),</span>
				true);
		}
<span class="nc" id="L182">		m_toolbar.addValidateSubmitTextButton(</span>
				SAVETR_ACTION,
<span class="nc" id="L184">				i18n(m_common_bundle, UIFWebBundleKey.TOOLBAR_SAVE),</span>
				true);
<span class="nc" id="L186">		m_toolbar.addCloseWindowTextButton(</span>
				PageAction.CANCEL,
<span class="nc" id="L188">				i18n(m_common_bundle, UIFWebBundleKey.TOOLBAR_CANCEL),</span>
				true);
<span class="nc" id="L190">	}</span>

	//override base class;  buttons: back, forward, refresh, print, preferences, help, logout, close
	protected void initUtilityPane() {
<span class="nc" id="L194">		this.getUtilityPane().setIsRefreshEnabled(false);</span>
<span class="nc" id="L195">	}</span>

	/**
	 * set empId
	 */
	public void setEmpId(ID empId){
<span class="nc" id="L201">		this.empId = empId;</span>
<span class="nc" id="L202">	}</span>

	/**
	 * get empId
	 */
	public ID getEmpId(){
<span class="nc" id="L208">		return this.empId;</span>
	}

	/**
	 * get pageTitleText
	 */
	public String getPageTitleText(){
<span class="nc" id="L215">		return this.pageTitleText;</span>
	}

	/**
	 * set pageTitleText
	 */
	public void setPageTitleText(String pageTitleText){
<span class="nc" id="L222">		this.pageTitleText = pageTitleText;</span>
<span class="nc" id="L223">	}</span>

	/**
	 * get tableData
	 */
	public ArrayList getTableData(){
<span class="nc" id="L229">		return this.tableData;</span>
	}

	/**
	 * set tableData
	 */
	public void setTableData(ArrayList tableData){
<span class="nc" id="L236">		this.tableData = tableData;</span>
<span class="nc" id="L237">	}</span>

	/**
	 * setPopupPageTitle()
	 */
	private void setPopupPageTitle() {
<span class="nc" id="L243">		m_contentTitlePC.setPageTitle(i18n(m_bundle, AmWebBundleKey.CREATE_NEW_RECORD));</span>
<span class="nc" id="L244">		m_contentTitlePC.addActiveComponent(</span>
<span class="nc" id="L245">				new TimeZoneOverrideTogglePC(m_context, m_toolbar, TimeZone.getTimeZone(this.timeZone), true));</span>
<span class="nc" id="L246">	}</span>
	
	@Override
	public String getWorkPaneDescription() {
<span class="nc" id="L250">		ContentTitlePC contentTitle = getContentTitle();</span>
<span class="nc bnc" id="L251" title="All 2 branches missed.">		if (contentTitle != null) {</span>
<span class="nc" id="L252">			return m_localizer.i18n(UIFWebBundleKey.BUNDLE_NAME, UIFWebBundleKey.WORK_PANE_DESCRIPTION,</span>
<span class="nc" id="L253">					contentTitle.getPageTitle(),</span>
<span class="nc" id="L254">					this.getLocalizer().formatTimeZone(TimeZone.getTimeZone(this.timeZone).getID()));</span>
		}
<span class="nc" id="L256">		return &quot;&quot;;</span>
	}

	private void getPopupHeader(){
<span class="nc" id="L260">		StringBuffer aSb = new StringBuffer(512);</span>
<span class="nc" id="L261">		aSb.append(&quot;&lt;tr&gt;&lt;th scope=\&quot;col\&quot; class=\&quot;popupDialogTitlePane\&quot; style=\&quot;&quot; + CSSUtil.STYLE_NORMAL_LEFT_PAD10 + &quot;\&quot; nowrap&gt;\n&quot; +</span>
<span class="nc" id="L262">				getTimeLabel() +</span>
				&quot;&lt;/td&gt;&lt;th scope=\&quot;col\&quot; class=\&quot;popupDialogTitlePane\&quot; style=\&quot;&quot; + CSSUtil.STYLE_NORMAL_LEFT_PAD10 + &quot;\&quot; nowrap&gt;\n&quot; +
<span class="nc" id="L264">				getActivityTypeLabel() +</span>
				&quot;&lt;/td&gt;&lt;th scope=\&quot;col\&quot; class=\&quot;popupDialogTitlePane\&quot; style=\&quot;&quot; + CSSUtil.STYLE_NORMAL_LEFT_PAD10 + &quot;\&quot; nowrap&gt;\n&quot; +
<span class="nc" id="L266">				getActivityLabel() +</span>
				&quot;&lt;/td&gt;&lt;th scope=\&quot;col\&quot; class=\&quot;popupDialogTitlePane\&quot; style=\&quot;&quot; + CSSUtil.STYLE_NORMAL_LEFT_PAD10 + &quot;\&quot; nowrap&gt;\n&quot; +
<span class="nc" id="L268">				getDurationLabel() +</span>
				&quot;&lt;/td&gt;&lt;th scope=\&quot;col\&quot; class=\&quot;popupDialogTitlePane\&quot; style=\&quot;&quot; + CSSUtil.STYLE_NORMAL_LEFT_PAD10 + &quot;\&quot; nowrap&gt;\n&quot; +
<span class="nc" id="L270">				getPayableLabel() +</span>
				&quot;&lt;/td&gt;&lt;th scope=\&quot;col\&quot; class=\&quot;popupDialogTitlePane\&quot; style=\&quot;&quot; + CSSUtil.STYLE_NORMAL_LEFT_PAD10 + &quot;\&quot; nowrap&gt;\n&quot; +
<span class="nc" id="L272">				getNotesLabel() +</span>
				&quot;&lt;/td&gt;&lt;th scope=\&quot;col\&quot; class=\&quot;popupDialogTitlePane\&quot; style=\&quot;&quot; + CSSUtil.STYLE_NORMAL_LEFT_PAD10 + &quot;\&quot; nowrap&gt;\n&quot; +
<span class="nc" id="L274">				i18n(m_bundle, AmWebBundleKey.ACTION) +</span>
				&quot;&lt;/td&gt;&quot;);

<span class="nc" id="L277">		aSb.append(&quot;&lt;/tr&gt;&quot;);</span>
<span class="nc" id="L278">		this.popUpHeader = aSb.toString();</span>
<span class="nc" id="L279">	}</span>
    
    
    //508
	private HtmlButton getBtn(String imgSrc, String title, String onClick, String buttonID) {
<span class="nc" id="L284">        HtmlImage image = new HtmlImage(imgSrc);</span>
<span class="nc" id="L285">        image.setAttribute(CLASS_ATTR, &quot;imgToolbarDefault&quot;);</span>
<span class="nc" id="L286">        image.setAlt(title);</span>
        
<span class="nc" id="L288">        HtmlButton button = new HtmlButton(buttonID);</span>
<span class="nc" id="L289">        button.setInnerHtml(image);</span>
<span class="nc" id="L290">        button.setAttribute(CLASS_ATTR, &quot;imgToolbarDefault&quot;);</span>
<span class="nc" id="L291">        button.appendAttribute(&quot;align&quot;, &quot;absmiddle&quot;);</span>
<span class="nc" id="L292">        button.setOnClick(onClick);</span>
<span class="nc" id="L293">        button.setAttribute(&quot;title&quot;, title);</span>
<span class="nc bnc" id="L294" title="All 2 branches missed.">        if (isAccessibilityComplianceMode()) {</span>
<span class="nc" id="L295">        	button.setAttribute(ATTR_ARIA_LABEL_TOOLTIP, &quot;true&quot;);</span>
<span class="nc" id="L296">        	button.setAttribute(ATTR_ARIA_LABEL, title);</span>
        }
<span class="nc" id="L298">        button.setStyle(&quot;margin:0px; border:none; background-color:transparent;&quot;);</span>
<span class="nc" id="L299">        return button;</span>
    }
    
    /**
     * Get the time zone offset (from GMT) of the date picker's date, based on the dialog's time zone.
     */
    public int getTimeZoneOffset()
    {
<span class="nc" id="L307">    	TimeZone tz = TimeZone.getTimeZone(this.timeZone);</span>
<span class="nc" id="L308">    	return tz.getOffset(m_dateTimePickerPC.getDate().getTime());</span>
    }

	public void setTableContent(RequestContext context) throws Exception {
<span class="nc" id="L312">		StringBuilder aSb = new StringBuilder(512);</span>
<span class="nc bnc" id="L313" title="All 2 branches missed.">		ArrayList aList = this.getTimeRecord()!=null?(ArrayList)this.getTimeRecord().getChildren():new ArrayList();</span>
<span class="nc" id="L314">		m_dateTimePickerPC.setTimeZone(TimeZone.getTimeZone(this.timeZone));		</span>
<span class="nc" id="L315">		int totalCount = aList.size();</span>
<span class="nc bnc" id="L316" title="All 2 branches missed.">		if (aList.size() &gt; 0) {			</span>
			//add start shift
<span class="nc" id="L318">			totalCount = totalCount + ADDITIONAL_ROW_COUNT;</span>
<span class="nc" id="L319">			appendStartShift(aSb, aList, totalCount);</span>
		}
<span class="nc bnc" id="L321" title="All 2 branches missed.">		for (int j = 0; j &lt; aList.size(); j++) {</span>
<span class="nc" id="L322">			TimeRecordEntry trEntry = (TimeRecordEntry)aList.get(j);</span>
			
<span class="nc bnc" id="L324" title="All 2 branches missed.">			if (!trEntry.getActivityID().equals(Activity.ACTIVITY_NONE)){</span>
<span class="nc" id="L325">				getDateTimePicker().setDate(trEntry.getStartTime());</span>
<span class="nc" id="L326">				getDateTimePicker().setDateInputIndex(j+1);</span>
<span class="nc" id="L327">				getDateTimePicker().setOnChangeJS(&quot;setTimes(&quot;+(j+1)+&quot;);&quot;);</span>
<span class="nc" id="L328">				String hiddenRowNumInfo = HtmlUtil.makeHiddenReadableText(MessageFormat.format(</span>
<span class="nc" id="L329">						i18n(m_common_bundle, UIFWebBundleKey.MULTI_COL_LIST_LEVEL_TEMPLATE), j + ADDITIONAL_ROW_COUNT, totalCount));</span>
<span class="nc" id="L330">				String timeContent = getDateTimePicker().getHtmlDisplay();</span>
<span class="nc" id="L331">				String hoursMinSelect = HourMinInput.getHourMinInput(&quot;duration&quot;+String.valueOf(j), getDisplayDuration(trEntry.getDuration())[0],</span>
<span class="nc" id="L332">						getDisplayDuration(trEntry.getDuration())[1], 0, 24, &quot;adjustDate(&quot;+ String.valueOf(j) +&quot;)&quot;);</span>
<span class="nc bnc" id="L333" title="All 2 branches missed.">				if (isAccessibilityComplianceMode()) {</span>
<span class="nc" id="L334">					hoursMinSelect = HourMinInput.getHourMinInput(&quot;duration&quot;+String.valueOf(j), getDisplayDuration(trEntry.getDuration())[0],</span>
<span class="nc" id="L335">							getDisplayDuration(trEntry.getDuration())[1], 0, 24, &quot;adjustDate(&quot;+ String.valueOf(j) +&quot;)&quot;, getDurationLabel());</span>
				}
<span class="nc" id="L337">				String hrefValue = &quot;#r&quot; + j + 2;</span>
<span class="nc" id="L338">				aSb.append(&quot;&lt;tr&gt;&lt;th scope=\&quot;row\&quot; class=\&quot;popupDialogPane\&quot; style=\&quot;padding-left:10px\&quot; nowrap&gt;&quot; +</span>
<span class="nc" id="L339">				&quot;&lt;span id=\&quot;&quot; + &quot;r&quot;+ String.valueOf(j)+&quot;\&quot; class=\&quot;headerTextSmall\&quot;&gt;&quot; +</span>
<span class="nc" id="L340">				getAccessibilityAnchor(hrefValue, hiddenRowNumInfo) + timeContent +</span>
				&quot;&lt;/td&gt;&lt;td class=\&quot;popupDialogPane\&quot; style=\&quot;padding-left:10px\&quot;&gt;&quot; +
<span class="nc" id="L342">				getActivityCategorySelector(j) +</span>
				&quot;&lt;/td&gt;&quot; +
				&quot;&lt;td class=\&quot;popupDialogPane\&quot; style=\&quot;padding-left:10px\&quot;&gt;&quot; +
<span class="nc" id="L345">				getActivitySelector(j, trEntry.getActivityID()) +</span>
				&quot;&lt;td class=\&quot;popupDialogPane\&quot; style=\&quot;padding-left:10px\&quot; nowrap&gt;&lt;span class=\&quot;headerText2\&quot;&gt;&quot; +
				hoursMinSelect +
				&quot;&lt;/span&gt;&lt;/td&gt;&quot; +
				&quot;&lt;td class=\&quot;popupDialogPane\&quot; style=\&quot;padding-left:10px\&quot;&gt;&quot;);

<span class="nc bnc" id="L351" title="All 2 branches missed.">				String isChecked = trEntry.getPaid() ? &quot;checked&quot; : &quot;&quot;;</span>
<span class="nc bnc" id="L352" title="All 2 branches missed.">				String ariaLabelAttr = isAccessibilityComplianceMode()</span>
<span class="nc" id="L353">						? ATTR_ARIA_LABEL + &quot;=\&quot;&quot; + getPayableLabel() + &quot;\&quot;&quot;</span>
						: &quot;&quot;;
<span class="nc bnc" id="L355" title="All 2 branches missed.">				String notesInput = isAccessibilityComplianceMode()</span>
<span class="nc" id="L356">						? HtmlUtil.makeTextInput(&quot;comment&quot;, 10, INPUT_MAX_LEN, trEntry.getDescription(), &quot;setPageDirty();&quot;, null,</span>
<span class="nc" id="L357">								true, false, null, null, null, getNotesLabel())</span>
<span class="nc" id="L358">						: HtmlUtil.makeTextInput(&quot;comment&quot;, 10, INPUT_MAX_LEN, trEntry.getDescription(), &quot;setPageDirty();&quot;);</span>
<span class="nc" id="L359">				aSb.append(&quot;&lt;input type=\&quot;checkbox\&quot; name=\&quot;payType\&quot; &quot;+</span>
				isChecked + &quot; &quot; + ariaLabelAttr +
				&quot; onChange=\&quot;setPageDirty();\&quot;&gt;&quot; +
				&quot;&lt;input type=\&quot;hidden\&quot; name=\&quot;isPaid\&quot; value=\&quot;\&quot;&gt;&lt;/td&gt;&quot; +
				&quot;&lt;td class=\&quot;popupDialogPane\&quot; style=\&quot;padding-left:10px\&quot;&gt;&quot; +
				notesInput +
				&quot;&lt;/td&gt;&lt;td class=\&quot;popupDialogPane\&quot; style=\&quot;padding-left:10px\&quot;&gt;&quot; +
                
<span class="nc" id="L367">                getBtn(ImageFileID.ADD, </span>
<span class="nc" id="L368">                		m_localizer.i18n(m_bundle, AmWebBundleKey.INSERT_TIME_ENTRY),</span>
                        &quot;insertEntry(&quot; + (j+1) + &quot;);&quot;,
                        &quot;INSERT_ENTRY&quot;) +
                        
                &quot;&amp;nbsp;&quot; +
                
<span class="nc" id="L374">                getBtn(ImageFileID.DELETE, </span>
<span class="nc" id="L375">                		m_localizer.i18n(m_bundle, AmWebBundleKey.DELETE_TIME_ENTRY), </span>
                        &quot;deleteEntry(&quot; + (j+1) + &quot;);&quot;,
                        &quot;INSERT_ENTRY&quot;) +
                        
				&quot;&lt;/td&gt;&lt;/tr&gt;&quot;);
<span class="nc" id="L380">			} else {</span>
				//add end shift
<span class="nc" id="L382">				appendEndShift(trEntry, aSb, totalCount, j);</span>
			}
		}
		//add comments
<span class="nc" id="L386">		appendComments(aSb, totalCount);</span>
		
<span class="nc" id="L388">		this.tableContent = aSb.toString();</span>
<span class="nc" id="L389">	}</span>
	
	private void appendComments(StringBuilder sb, int totalCount) {
<span class="nc bnc" id="L392" title="All 2 branches missed.">		String commentsInput = isAccessibilityComplianceMode()</span>
<span class="nc" id="L393">				? HtmlUtil.makeTextInput(&quot;remarks&quot;, INPUT_SIZE, INPUT_MAX_LEN, this.getRemarks(), null, null, true, false, null, null,</span>
<span class="nc" id="L394">						null, getCommentsLabel())</span>
<span class="nc" id="L395">				: HtmlUtil.makeTextInput(&quot;remarks&quot;, INPUT_SIZE, INPUT_MAX_LEN, this.getRemarks());</span>
<span class="nc" id="L396">		String hiddenRowNumInfo = HtmlUtil.makeHiddenReadableText(MessageFormat</span>
<span class="nc" id="L397">				.format(i18n(m_common_bundle, UIFWebBundleKey.MULTI_COL_LIST_LEVEL_TEMPLATE), totalCount, totalCount));</span>
<span class="nc" id="L398">		String hrefValue = &quot;#r&quot; + totalCount;</span>
<span class="nc" id="L399">		sb.append(&quot;&lt;tr&gt;&quot; + &quot;&lt;td class=\&quot;popupDialogPane\&quot; style=\&quot;padding-left:10px\&quot; nowrap&gt;&quot;</span>
<span class="nc" id="L400">				+ getAccessibilityAnchor(hrefValue, hiddenRowNumInfo) + &quot;&lt;span class=\&quot;boldTextSm\&quot;&gt;&quot;</span>
<span class="nc" id="L401">				+ getCommentsLabel() + &quot;&lt;/span&gt;&quot;</span>
				+ &quot;&lt;/td&gt;&lt;td class=\&quot;popupDialogPane\&quot; style=\&quot;padding-left:10px\&quot; nowrap colspan=\&quot;6\&quot;&gt;&quot; + commentsInput
				+ &quot;&lt;/td&gt;&lt;/tr&gt;&quot;);
<span class="nc" id="L404">	}</span>
	
	private void appendStartShift(StringBuilder sb, List timeRecords, int totalCount) {
<span class="nc" id="L407">		TimeRecordEntry trEntry = (TimeRecordEntry) timeRecords.get(0);</span>
<span class="nc" id="L408">		getDateTimePicker().setDateInputIndex(0);</span>
<span class="nc" id="L409">		getDateTimePicker().setDate(trEntry.getStartTime());</span>
<span class="nc" id="L410">		getDateTimePicker().setOnChangeJS(&quot;setTimes('0');&quot;);</span>
<span class="nc" id="L411">		final String startShiftSpanID = &quot;start_shift_id&quot;;</span>
<span class="nc" id="L412">		String startShiftSpan = HtmlUtil.makeSpanWithId(m_localizer.i18n(m_bundle, AmWebBundleKey.START_SHIFT),</span>
				startShiftSpanID);
<span class="nc" id="L414">		String hiddenRowNumInfo = HtmlUtil.makeHiddenReadableText(MessageFormat</span>
<span class="nc" id="L415">				.format(i18n(m_common_bundle, UIFWebBundleKey.MULTI_COL_LIST_LEVEL_TEMPLATE), 1, totalCount));</span>
<span class="nc" id="L416">		String startShiftTimeContent = getDateTimePicker().getHtmlDisplay();</span>
<span class="nc" id="L417">		String hrefValue = &quot;#r1&quot;;</span>
<span class="nc" id="L418">		sb.append(</span>
				&quot;&lt;tr&gt;&quot; + &quot;&lt;th scope=\&quot;row\&quot; class=\&quot;popupDialogPane\&quot; style=\&quot;padding-left:10px\&quot; nowrap&gt;&quot;
<span class="nc" id="L420">						+ getAccessibilityAnchor(hrefValue, hiddenRowNumInfo) + startShiftTimeContent + &quot;&lt;/td&gt;&quot;</span>
						+ &quot;&lt;td class=\&quot;popupDialogPane\&quot; style=\&quot;padding-left:10px\&quot;&gt;&amp;nbsp;&lt;/td&gt;&quot;
						+ &quot;&lt;td class=\&quot;popupDialogPane\&quot; style=\&quot;padding-left:10px\&quot;&gt;&lt;span class=\&quot;headerText2\&quot;&gt;&quot;
<span class="nc" id="L423">						+ HtmlUtil.makeHiddenSpanWithId(getActivityLabel(), getActivityLabelID())</span>
<span class="nc" id="L424">						+ HtmlUtil.getTabbableLabel(startShiftSpan,</span>
<span class="nc" id="L425">								Arrays.asList(getActivityLabelID(), startShiftSpanID))</span>
						+ &quot;&lt;/span&gt;&lt;/td&gt;&quot;
						+ &quot;&lt;td  colspan=\&quot;3\&quot; class=\&quot;popupDialogPane\&quot; style=\&quot;padding-left:10px\&quot;&gt;&amp;nbsp;&lt;/td&gt;&quot;
						+ &quot;&lt;td class=\&quot;popupDialogPane\&quot; style=\&quot;padding-left:10px\&quot;&gt;&quot; +
<span class="nc" id="L429">						getBtn(ImageFileID.ADD, m_localizer.i18n(m_bundle, AmWebBundleKey.INSERT_TIME_ENTRY),</span>
								&quot;insertEntry(0);&quot;, &quot;INSERT_ENTRY&quot;) +
						&quot;&lt;/td&gt;&quot; + &quot;&lt;/tr&gt;&quot;);
<span class="nc" id="L432">	}</span>

	private void appendEndShift(TimeRecordEntry timeRecordEntry, StringBuilder sb, int totalCount, int rowNum) {
<span class="nc" id="L435">		getDateTimePicker().setDate(timeRecordEntry.getStartTime());</span>
<span class="nc" id="L436">		getDateTimePicker().setDateInputIndex(rowNum + 1);</span>
<span class="nc" id="L437">		getDateTimePicker().setOnChangeJS(&quot;setTimes(&quot; + (rowNum + 1) + &quot;);&quot;);</span>
<span class="nc" id="L438">		final String endShiftID = &quot;end_shift_id&quot;;</span>
<span class="nc" id="L439">		String endShiftSpan = HtmlUtil.makeSpanWithId(m_localizer.i18n(m_bundle, AmWebBundleKey.END_SHIFT), endShiftID);</span>
<span class="nc" id="L440">		String hiddenRowNumInfo = HtmlUtil.makeHiddenReadableText(MessageFormat.format(</span>
<span class="nc" id="L441">				i18n(m_common_bundle, UIFWebBundleKey.MULTI_COL_LIST_LEVEL_TEMPLATE), totalCount - 1, totalCount));</span>
<span class="nc" id="L442">		String endShiftTimeContent = getDateTimePicker().getHtmlDisplay();</span>
<span class="nc" id="L443">		String hrefValue = &quot;#r&quot; + (totalCount - 1);</span>
<span class="nc" id="L444">		sb.append(&quot;&lt;tr&gt;&quot; + &quot;&lt;th scope=\&quot;row\&quot; class=\&quot;popupDialogPane\&quot; style=\&quot;padding-left:10px\&quot; nowrap&gt;&quot;</span>
<span class="nc" id="L445">				+ getAccessibilityAnchor(hrefValue, hiddenRowNumInfo) + endShiftTimeContent + &quot;&lt;/td&gt;&quot;</span>
				+ &quot;&lt;td class=\&quot;popupDialogPane\&quot; style=\&quot;padding-left:10px\&quot;&gt;&amp;nbsp;&lt;/td&gt;&quot;
				+ &quot;&lt;td class=\&quot;popupDialogPane\&quot; style=\&quot;padding-left:10px\&quot;&gt;&lt;span class=\&quot;headerText2\&quot;&gt;&quot;
<span class="nc" id="L448">				+ HtmlUtil.getTabbableLabel(endShiftSpan, Arrays.asList(getActivityLabelID(), endShiftID))</span>
				+ &quot;&lt;/span&gt;&lt;/td&gt;&quot; + &quot;&lt;td class=\&quot;popupDialogPane\&quot; style=\&quot;padding-left:10px\&quot; colspan=\&quot;4\&quot;&gt;&amp;nbsp;&lt;/td&gt;&quot;
				+ &quot;&lt;/tr&gt;&quot;);
<span class="nc" id="L451">	}</span>

	/**
	 * getActivityCategorySelector()
	 * return HtmlSelect
	 */
	private HtmlSelect getActivityCategorySelector(int index){
<span class="nc" id="L458">		HtmlSelect activityCategorySelect = new HtmlSelect(&quot;activityCategory&quot;);</span>
<span class="nc" id="L459">		activityCategorySelect.setStyleClass(&quot;dropDown&quot;);</span>
<span class="nc" id="L460">		activityCategorySelect.setAttribute(&quot;nameIndex&quot;, &quot;&quot;+index);</span>
<span class="nc" id="L461">		activityCategorySelect.setOnChange(&quot;populateSecondaryListFromPreLoad(this, &quot; + index + &quot;);&quot;);</span>
<span class="nc bnc" id="L462" title="All 2 branches missed.">		if (isAccessibilityComplianceMode()) {</span>
<span class="nc" id="L463">			activityCategorySelect.setTitle(getActivityTypeLabel());</span>
		}
		try {
<span class="nc" id="L466">			activityCategorySelect.setOptions(this.getActivityCategoryNameList(),</span>
<span class="nc" id="L467">				this.getActivityCategoryIDList(), this.getActivityCategory()[index].toString());</span>
<span class="nc" id="L468">		} catch (Exception ex){</span>

<span class="nc" id="L470">		}</span>
<span class="nc" id="L471">		return activityCategorySelect;</span>
	}

	/**
	 * getActivitySelector()
	 * returnHtmlSelect
	 */
	private String getActivitySelector(int index, ID activityID){
<span class="nc" id="L479">		ArrayList activityObject = (ArrayList) this.getActivityColl().get(index);</span>
<span class="nc" id="L480">		ArrayList list = new ArrayList();</span>

<span class="nc" id="L482">		ArrayList activityIDList = (ArrayList)activityObject.get(1);</span>
<span class="nc" id="L483">		ArrayList activityNameList = (ArrayList)activityObject.get(0);</span>
<span class="nc bnc" id="L484" title="All 2 branches missed.">		for (int i=0; i&lt;activityIDList.size(); i++){</span>
<span class="nc" id="L485">			list.add(new StringsPair((String)activityNameList.get(i), (String)activityIDList.get(i)));</span>
		}
<span class="nc" id="L487">		return HtmlUtil.makeSelectInput(&quot;activityList&quot;, &quot;&quot; + index, new String[] { activityID.toString() },</span>
				&quot;activityChanged('&quot; + index + &quot;');&quot;, list, &quot;125px&quot;, false, false, true, false, null, null, true,
<span class="nc" id="L489">				getActivityLabel(), null);</span>
	}

	/**
	 * getDisplayDuration
	 * return int[]
	 */
	private int[] getDisplayDuration(int duration){
<span class="nc" id="L497">		int[] aDuration = JSPUtil.getDisplayDuration(duration*60);</span>

<span class="nc" id="L499">		return aDuration;</span>
	}

	/**
	 * Return the JavaScript init code required by Page model.
	 *
	 * Default behavior is to retrieve sub-component JavaScript Init code
	 */
	public String getJavaScriptInitCode()
	{
		//generate string to close popup
<span class="nc" id="L510">		String template = &quot;&quot;;</span>
<span class="nc bnc" id="L511" title="All 4 branches missed.">		if (this.getPageAction()!=null &amp;&amp; this.getPageAction().equals(DONE_ACTION)){</span>
<span class="nc" id="L512">			setOpenerValueOnClose(&quot;selectedID&quot;, this.selectedID, true);</span>
<span class="nc" id="L513">			setOpenerValueOnClose(&quot;editIndex&quot;, String.valueOf(this.curIndex), false);</span>
<span class="nc" id="L514">            setRefreshOpenerWithAction(&quot;&quot;);</span>
<span class="nc" id="L515">			setIsCloseAfterLoad(true);</span>
		} else {
<span class="nc bnc" id="L517" title="All 4 branches missed.">			if (this.getPageAction()!=null &amp;&amp; this.getPageAction().equals(INSERTTE_ACTION)){</span>
<span class="nc" id="L518">            	template = &quot;setLastActivityPaid()&quot;;</span>
<span class="nc bnc" id="L519" title="All 4 branches missed.">			} else if (this.getPageAction()!=null &amp;&amp; this.getPageAction().equals(ADDTR_ACTION)){</span>
<span class="nc" id="L520">				template = &quot;setActivityPaid()&quot;;</span>
			}
<span class="nc" id="L522">			setWorkAreaId(&quot;summaryWrapper&quot;);</span>
<span class="nc" id="L523">			setMinWorkAreaHeight(80);</span>
		}

<span class="nc" id="L526">		StringBuffer jsInitCode = new StringBuffer(512);</span>

		// Add sub-component JavaScript code first
<span class="nc" id="L529">		jsInitCode.append(super.getJavaScriptInitCode()).append(&quot;\n&quot;);</span>

		// [now create the new mediator]
<span class="nc" id="L532">		jsInitCode.append(template);</span>

<span class="nc" id="L534">		return jsInitCode.toString();</span>
	}

	/**
	 * setActivityGroup()
	 */
	public void setActivityGroup(){
<span class="nc bnc" id="L541" title="All 2 branches missed.">		if (this.activityGroup == null){</span>
			try {
<span class="nc" id="L543">				activityGroup =	ActivityModelHandler.getActivityGroup(m_context, getOrgId(), ActivityGroup.ALL_ACTIVITYCATEGORIES);</span>
<span class="nc" id="L544">			} catch (Exception ex){</span>
<span class="nc" id="L545">				handleUnableToLoadDataError(log, ex);</span>
<span class="nc" id="L546">			}</span>
		}
<span class="nc" id="L548">	}</span>

	/**
	 * Return the custom JavaScript code for the Page model.
	 */
	public String getCustomJavaScript() {
<span class="nc" id="L554">		StringBuffer jsInitCode = new StringBuffer(512);</span>
		
<span class="nc bnc" id="L556" title="All 2 branches missed.">		if (isAccessibilityComplianceMode()) {</span>
<span class="nc" id="L557">			jsInitCode.append(get508TableJS());</span>
		}

<span class="nc" id="L560">		jsInitCode.append(&quot;\nfunction customValidateForm(){&quot;)</span>
<span class="nc" id="L561">		.append(&quot;\n\tvalidateSubmit();\n&quot;)</span>
<span class="nc" id="L562">		.append(&quot;}\n&quot;);</span>


<span class="nc" id="L565">		setActivityGroup();</span>
		//create the arrays of activity category and activities to preload into the jsp
		// Create the Primary dropdown collection
<span class="nc" id="L568">		ArrayList primary = new ArrayList();</span>

<span class="nc bnc" id="L570" title="All 2 branches missed.">		ArrayList activityCategories = this.activityGroup.getActivityCategories().size()&gt;0?</span>
<span class="nc" id="L571">			(ArrayList)this.activityGroup.getActivityCategories():new ArrayList();</span>

<span class="nc" id="L573">		Collection activities = null;</span>
<span class="nc bnc" id="L574" title="All 2 branches missed.">		activities = this.activityGroup.getActivities().size()&gt;0?</span>
<span class="nc" id="L575">			this.activityGroup.getActivities():new ArrayList();</span>

<span class="nc" id="L577">		ArrayList[] secondaryLists = new ArrayList[activityCategories.size()];</span>
<span class="nc bnc" id="L578" title="All 2 branches missed.">		for (int i=0; i&lt;activityCategories.size(); i++){</span>
<span class="nc" id="L579">			ActivityCategory activityCategory = (ActivityCategory)activityCategories.get(i);</span>
<span class="nc" id="L580">			StringsPair sp = new StringsPair(activityCategory.getID().toString(),</span>
<span class="nc" id="L581">					activityCategory.getName());</span>
<span class="nc" id="L582">			primary.add(sp);</span>

<span class="nc" id="L584">			ArrayList actList = new ArrayList();</span>
<span class="nc bnc" id="L585" title="All 4 branches missed.">			if (activities!=null &amp;&amp; activities.size()&gt;0){</span>
<span class="nc bnc" id="L586" title="All 2 branches missed.">				for( Iterator j = activities.iterator(); j.hasNext(); ) {</span>
<span class="nc" id="L587">					Activity activity = (Activity)j.next();</span>
<span class="nc bnc" id="L588" title="All 2 branches missed.">					if (!activityCategory.getOrganizationId().equals(new ID(Organization.ROOT_ORG_ID)) &amp;&amp;</span>
<span class="nc bnc" id="L589" title="All 2 branches missed.">							activity.getActivityCategoryId().equals(activityCategory.getID())){</span>
<span class="nc" id="L590">						StringsPair actSp = new StringsPair(activity.getID().toString(), activity.getName());</span>
<span class="nc" id="L591">						actList.add(actSp);</span>
					}
<span class="nc" id="L593">				}</span>
			}
<span class="nc" id="L595">			secondaryLists[i] = actList;</span>
		}

<span class="nc" id="L598">		jsInitCode.append(&quot;var secondaryLists;\n&quot;)</span>
<span class="nc" id="L599">		.append(&quot;secondaryLists = new Array(&quot; + primary.size() +&quot;);\n&quot;);</span>

<span class="nc bnc" id="L601" title="All 2 branches missed.">		for (int i=0; i &lt; primary.size(); i++) {</span>
<span class="nc" id="L602">			ArrayList list = secondaryLists[i];</span>
<span class="nc" id="L603">			jsInitCode.append(&quot;var secondaryList = new Array(2);\n&quot;)</span>
<span class="nc" id="L604">			.append(&quot;var secondaryValues = new Array(&quot; + list.size() +&quot;);\n&quot;)</span>
<span class="nc" id="L605">			.append(&quot;var secondaryText = new Array(&quot;+list.size() + &quot;);\n&quot;);</span>

<span class="nc bnc" id="L607" title="All 2 branches missed.">			if (list.size()&gt;0){</span>
<span class="nc bnc" id="L608" title="All 2 branches missed.">				for (int option=0; option &lt; list.size(); option++) {</span>
<span class="nc" id="L609">					jsInitCode.append(&quot;secondaryValues[&quot; +option +&quot;] = \'&quot; + ((StringsPair)list.get(option)).getKey() +&quot;\';\n&quot;)</span>
<span class="nc" id="L610">					.append(&quot;secondaryText[&quot; + option + &quot;] = \'&quot; + JSPUtil.escapeString(((StringsPair)list.get(option)).getValue(), &quot;'&quot;) + &quot;\';\n&quot;);</span>
				}
			} else {
<span class="nc" id="L613">				jsInitCode.append(&quot;secondaryValues[0] = \'-1\';\n&quot;)</span>
<span class="nc" id="L614">					.append(&quot;secondaryText[0] = \'\';\n&quot;);</span>
			}

<span class="nc" id="L617">			jsInitCode.append(&quot;secondaryList[0] = secondaryValues;\n&quot;)</span>
<span class="nc" id="L618">			.append(&quot;secondaryList[1] = secondaryText;\n&quot;)</span>
<span class="nc" id="L619">			.append(&quot;secondaryLists[&quot; + ((StringsPair)primary.get(i)).getKey() + &quot;] = secondaryList;\n&quot;);</span>
		}
        //add all activities and paid value to a new array
<span class="nc bnc" id="L622" title="All 4 branches missed.">		if (activities!=null &amp;&amp; activities.size()&gt;0){</span>
<span class="nc" id="L623">			jsInitCode.append(&quot;var actvitiyIDArray;\n&quot;)</span>
<span class="nc" id="L624">			.append(&quot;actvitiyIDArray = new Array(&quot; + activities.size() +&quot;);\n&quot;);</span>
<span class="nc" id="L625">			jsInitCode.append(&quot;var actvitiyPaidArray;\n&quot;)</span>
<span class="nc" id="L626">			.append(&quot;actvitiyPaidArray = new Array(&quot; + activities.size() +&quot;);\n&quot;);</span>
<span class="nc" id="L627">			int count = 0;</span>
<span class="nc bnc" id="L628" title="All 2 branches missed.">			for( Iterator j = activities.iterator(); j.hasNext(); count++) {</span>
<span class="nc" id="L629">				Activity activity = (Activity)j.next();</span>
<span class="nc" id="L630">				jsInitCode.append(&quot;actvitiyIDArray[&quot; + count +&quot;] = \'&quot; + activity.getID().toString() +&quot;\';\n&quot;);</span>
<span class="nc" id="L631">				jsInitCode.append(&quot;actvitiyPaidArray[&quot; + count +&quot;] = \'&quot; + activity.isPaid() +&quot;\';\n&quot;);</span>
			}
		}
<span class="nc" id="L634">		return jsInitCode.toString();</span>
	}

	/**
	 * processActivityGroup()
	 */
	public void processActivityGroup(){
		//get activitygroup
<span class="nc" id="L642">		setActivityGroup();</span>

<span class="nc" id="L644">		Collection actCategories = this.activityGroup.getActivityCategories();</span>
<span class="nc" id="L645">		ID aCatID = null;</span>
		//need to get available activity category if first visit
<span class="nc bnc" id="L647" title="All 2 branches missed.">		for( Iterator i = actCategories.iterator(); i.hasNext(); ) {</span>
<span class="nc" id="L648">			ActivityCategory activityCategoryInt = (ActivityCategory)i.next();</span>
<span class="nc bnc" id="L649" title="All 2 branches missed.">			if (!activityCategoryInt.getOrganizationId().equals(new ID(Organization.ROOT_ORG_ID))){</span>
<span class="nc" id="L650">				aCatID = activityCategoryInt.getID();</span>
<span class="nc" id="L651">				break;</span>
			}
<span class="nc" id="L653">		}</span>

		try {
<span class="nc" id="L656">			processActivityCategoryInfo(actCategories);</span>
<span class="nc" id="L657">			processActivityInfo(aCatID);</span>
<span class="nc" id="L658">		} catch (Exception ex){</span>
<span class="nc" id="L659">			cat.l7dError(AmWebLogBundleKey.UNABLE_TO_LOAD_DATA, ex);</span>
<span class="nc" id="L660">		}</span>
<span class="nc" id="L661">	}</span>

	/**
	 * processActivityCategoryInfo
	 * @param activityCategories
	 */
	public void processActivityCategoryInfo(Collection activityCategories)
	throws Exception{
		//put items into ArrayLists and set the model
<span class="nc bnc" id="L670" title="All 2 branches missed.">		for( Iterator i = activityCategories.iterator(); i.hasNext(); ) {</span>
<span class="nc" id="L671">			ActivityCategory activityCategory = (ActivityCategory)i.next();</span>
<span class="nc bnc" id="L672" title="All 2 branches missed.">			if (!activityCategory.getOrganizationId().equals(new ID(Organization.ROOT_ORG_ID))){</span>
<span class="nc" id="L673">				this.activityCategoryNameList.add(activityCategory.getName());</span>
<span class="nc" id="L674">				this.activityCategoryIDList.add(activityCategory.getID().toString());</span>
			}
<span class="nc" id="L676">		}</span>
<span class="nc" id="L677">	}</span>

	/**
	 * processActivityInfo
	 * @param aCatID
	 */
	public void processActivityInfo(ID aCatID)
	throws Exception{

<span class="nc bnc" id="L686" title="All 2 branches missed.">		if (this.timeRecord != null){</span>
<span class="nc bnc" id="L687" title="All 2 branches missed.">			for (int i=0; i&lt;this.getTimeRecord().getChildren().size()-1;i++){</span>
<span class="nc" id="L688">				setActivityColl(aCatID, i);</span>
			}
		} else {
<span class="nc" id="L691">			 setActivityColl(aCatID, 0);</span>
		}
<span class="nc" id="L693">	}</span>

	/**
	 * set the activity collection
	 * @param aCatID category ID
	 * @param aPosition
	 */
	private void setActivityColl(ID aCatID, int aPosition)
	throws Exception{
<span class="nc" id="L702">		ArrayList activityCollList = new ArrayList();</span>
<span class="nc" id="L703">		ArrayList activityIDList = new ArrayList();</span>
<span class="nc" id="L704">		ArrayList activityNameList = new ArrayList();</span>
<span class="nc bnc" id="L705" title="All 2 branches missed.">		if (this.activityCategory != null){</span>
<span class="nc bnc" id="L706" title="All 4 branches missed.">			if (!this.activityCategory[aPosition].equals(new ID(0)) &amp;&amp; this.activityCategory[aPosition] != null){</span>
<span class="nc" id="L707">				aCatID = new ID(this.getActivityCategory()[aPosition]);</span>
			}

			//get activities from activitygroup
<span class="nc" id="L711">			Collection activities = this.activityGroup.getActivities();</span>

<span class="nc bnc" id="L713" title="All 4 branches missed.">			if (activities!=null &amp;&amp; activities.size()&gt;0){</span>
<span class="nc bnc" id="L714" title="All 2 branches missed.">				for( Iterator j = activities.iterator(); j.hasNext(); ) {</span>
<span class="nc" id="L715">					Activity activity = (Activity)j.next();</span>
<span class="nc bnc" id="L716" title="All 2 branches missed.">					if (activity.getActivityCategoryId().equals(aCatID)){</span>
<span class="nc" id="L717">						activityIDList.add(activity.getID().toString());</span>
<span class="nc" id="L718">						activityNameList.add(activity.getName());</span>
					}
<span class="nc" id="L720">				}</span>
			}

<span class="nc bnc" id="L723" title="All 2 branches missed.">			if (activityIDList.size() == 0) {</span>
<span class="nc" id="L724">				activityIDList.add(&quot;-1&quot;);</span>
<span class="nc" id="L725">				activityNameList.add(&quot;&quot;);</span>
			}
<span class="nc" id="L727">			activityCollList.add(0 , activityIDList);</span>
<span class="nc" id="L728">			activityCollList.add(1 , activityNameList);</span>

			//set model values
<span class="nc" id="L731">			this.activityColl.add(activityCollList);</span>
		}
<span class="nc" id="L733">	}</span>

	/**
	 * set orgId
	 */
	public void setOrgId(ID orgId){
<span class="nc" id="L739">		this.orgId = orgId;</span>
<span class="nc" id="L740">	}</span>

	/**
	 * get orgId
	 */
	public ID getOrgId(){
<span class="nc" id="L746">		return this.orgId;</span>
	}

	/**
	 * set timeRecordID
	 */
	public void setTimeRecordID(ID timeRecordID){
<span class="nc" id="L753">		this.timeRecordID = timeRecordID;</span>
<span class="nc" id="L754">	}</span>

	/**
	 * get timeRecordID
	 */
	public ID getTimeRecordID(){
<span class="nc" id="L760">		return this.timeRecordID;</span>
	}

	/**
	* Set timeZone
	*/
	public void setTimeZone(String timeZone){
<span class="nc" id="L767">		this.timeZone = timeZone;</span>
<span class="nc" id="L768">	}</span>

	/**
	* Get timeZone
	*/
	public String getTimeZone(){
<span class="nc" id="L774">		return this.timeZone;</span>
	}

	/**
	* Set activityCategoryNameList
	*/
	public void setActivityCategoryColl(ArrayList activityCategoryNameList){
<span class="nc" id="L781">		this.activityCategoryNameList = activityCategoryNameList;</span>
<span class="nc" id="L782">	}</span>

	/**
	* Get activityCategoryNameList
	*/
	public ArrayList getActivityCategoryNameList(){
<span class="nc" id="L788">		return this.activityCategoryNameList;</span>
	}

	/**
	* Set activityCategoryIDList
	*/
	public void setActivityCategoryIDList(ArrayList activityCategoryIDList){
<span class="nc" id="L795">		this.activityCategoryIDList = activityCategoryIDList;</span>
<span class="nc" id="L796">	}</span>

	/**
	* Get activityCategoryIDList
	*/
	public ArrayList getActivityCategoryIDList(){
<span class="nc" id="L802">		return this.activityCategoryIDList;</span>
	}

	/**
	* Set activityColl
	*/
	public void setActivityColl(ArrayList activityColl){
<span class="nc" id="L809">		this.activityColl = activityColl;</span>
<span class="nc" id="L810">	}</span>

	/**
	* Get activityColl
	*/
	public ArrayList getActivityColl(){
<span class="nc" id="L816">		return this.activityColl;</span>
	}

	/**
	 * set activityList
	 */
	public void setActivityList(String[] actList){
<span class="nc" id="L823">		ID[] tempActCat = null;</span>
<span class="nc bnc" id="L824" title="All 4 branches missed.">			if (actList != null &amp;&amp; actList.length&gt;0){</span>
<span class="nc" id="L825">				tempActCat = new ID[actList.length];</span>
<span class="nc bnc" id="L826" title="All 2 branches missed.">				for (int i=0; i&lt;actList.length; i++){</span>
<span class="nc" id="L827">					tempActCat[i] = new ID(actList[i]);</span>
				}
			}
<span class="nc" id="L830">		this.activityList = tempActCat;</span>
<span class="nc" id="L831">	}</span>

	/**
	 * get activityList
	 */
	public ID[] getActivityList(){
<span class="nc" id="L837">		return this.activityList;</span>
	}

	/**
	 * set activityCategory
	 */
	public void setActivityCategory(String[] actCat){
<span class="nc" id="L844">		ID[] tempActCat = null;</span>
<span class="nc bnc" id="L845" title="All 4 branches missed.">		if (actCat != null &amp;&amp; actCat.length&gt;0){</span>
<span class="nc" id="L846">			tempActCat = new ID[actCat.length];</span>
<span class="nc bnc" id="L847" title="All 2 branches missed.">			for (int i=0; i&lt;actCat.length; i++){</span>
<span class="nc" id="L848">				tempActCat[i] = new ID(actCat[i]);</span>
			}
		}
<span class="nc" id="L851">		this.activityCategory = tempActCat;</span>
<span class="nc" id="L852">	}</span>

	/**
	 * get activityCategory
	 */
	public ID[] getActivityCategory(){
<span class="nc" id="L858">		return this.activityCategory;</span>
	}

	/**
	 * set timeRecord
	 */
	public void setTimeRecord(TimeRecord timeRecord){
<span class="nc" id="L865">		this.timeRecord = timeRecord;</span>
<span class="nc" id="L866">	}</span>

	/**
	 * get timeRecord
	 */
	public TimeRecord getTimeRecord(){
<span class="nc" id="L872">		return this.timeRecord;</span>
	}

	/**
	 * set date
	 */
	public void setDate(String date){
<span class="nc" id="L879">		this.date = new Date(Long.valueOf(date).longValue());</span>
<span class="nc" id="L880">	}</span>

	/**
	 * get date
	 */
	public Date getDate(){
<span class="nc" id="L886">		return this.date;</span>
	}

	/**
	 * Set Selected IDs
	 *
	 * @param ids Comma delimited IDs
	 */
	public void setSelectedIDs(String ids) {
<span class="nc" id="L895">		this.selectedIDs = StringUtil.parseIDString(ids);</span>
<span class="nc" id="L896">	}</span>

	/**
	 * Return Selected IDS in a Comman delimited IDs
	 */
	public ID[] getSelectedIDs() {
<span class="nc" id="L902">		return this.selectedIDs;</span>
	}

	/**
	 * Set Selected IDs
	 *
	 * @param selectedID Comma delimited IDs
	 */
	public void setSelectedID(String selectedID) {
<span class="nc" id="L911">		this.selectedID = selectedID;</span>
<span class="nc" id="L912">		this.setSelectedIDs(selectedID);</span>
<span class="nc" id="L913">	}</span>

	/**
	 * Return Selected IDS as a string
	 */
	public String getSelectedID() {
<span class="nc" id="L919">		return this.selectedID;</span>
	}

	/**
	* Set curIndex
	*/
	public void setCurIndex(int curIndex){
<span class="nc" id="L926">		this.curIndex = curIndex;</span>
<span class="nc" id="L927">	}</span>

	/**
	* Get curIndex
	*/
	public int getCurIndex(){
<span class="nc" id="L933">		return this.curIndex;</span>
	}

	/**
	 * set startYear
	 */
	public void setStartYear(int startYear){
<span class="nc" id="L940">		this.startYear = startYear;</span>
<span class="nc" id="L941">	}</span>

	/**
	 * get startYear
	 */
	public int getStartYear(){
<span class="nc" id="L947">		return this.startYear;</span>
	}

	/**
	 * set startMonth
	 */
	public void setStartMonth(int startMonth){
<span class="nc" id="L954">		this.startMonth = startMonth;</span>
<span class="nc" id="L955">	}</span>

	/**
	 * get startMonth
	 */
	public int getStartMonth(){
<span class="nc" id="L961">		return this.startMonth;</span>
	}

	/**
	 * set startDay
	 */
	public void setStartDay(int startDay){
<span class="nc" id="L968">		this.startDay = startDay;</span>
<span class="nc" id="L969">	}</span>

	/**
	 * get startDay
	 */
	public int getStartDay(){
<span class="nc" id="L975">		return this.startDay;</span>
	}

	/**
	 * set durationHour
	 */
	public void setDurationHour(int[] durationHour){
<span class="nc" id="L982">		this.durationHour = durationHour;</span>
<span class="nc" id="L983">	}</span>

	/**
	 * get durationHour
	 */
	public int[] getDurationHour(){
<span class="nc" id="L989">		return durationHour;</span>
	}

	/**
	 * set durationMinute
	 */
	public void setDurationMinute(int[] durationMinute){
<span class="nc" id="L996">		this.durationMinute = durationMinute;</span>
<span class="nc" id="L997">	}</span>

	/**
	 * get durationMinute
	 */
	public int[] getDurationMinute(){
<span class="nc" id="L1003">		return durationMinute;</span>
	}

	/**
	 * set isPaid
	 */
	public void setIsPaid(boolean[] isPaid){
<span class="nc" id="L1010">		this.isPaid = isPaid;</span>
<span class="nc" id="L1011">	}</span>

	/**
	 * get isPaid
	 */
	public boolean[] getIsPaid(){
<span class="nc" id="L1017">		return this.isPaid;</span>
	}

	/**
	 * set comment
	 */
	public void setComment(String[] comment){
<span class="nc" id="L1024">		this.comment = comment;</span>
<span class="nc" id="L1025">	}</span>

	/**
	 * get comment
	 */
	public String[] getComment(){
<span class="nc" id="L1031">		return this.comment;</span>
	}

	/**
	 * set position
	 */
	public void setPosition(int position){
<span class="nc" id="L1038">		this.position = position;</span>
<span class="nc" id="L1039">	}</span>

	/**
	 * get position
	 */
	public int getPosition(){
<span class="nc" id="L1045">		return this.position;</span>
	}

	/**
	 * set remarks
	 */
	public void setRemarks(String remarks){
<span class="nc" id="L1052">		this.remarks = remarks;</span>
<span class="nc" id="L1053">	}</span>

	/**
	 * get remarks
	 */
	public String getRemarks(){
<span class="nc" id="L1059">		return this.remarks;</span>
	}

	/**
	 * Returns the DatePicker page component.
	 */
	 public DatePickerPC getDateTimePicker() {
<span class="nc" id="L1066">		return m_dateTimePickerPC;</span>
	}

	/**
	 * Sets the DatePicker page component.
	 */
	 public boolean getUseAmPm() {
<span class="nc" id="L1073">		return m_localizer.isTimeInputInAMPMFormat();</span>
	}


	/**
	 * Override extract Parameters to handle date input
	 */
	public boolean extractParameters(HttpServletRequest request, RequestContext context) {
<span class="nc" id="L1081">		boolean success = super.extractParameters(request);</span>

<span class="nc bnc" id="L1083" title="All 2 branches missed.">		if (this.timeZone!=null)</span>
<span class="nc" id="L1084">			m_dateTimePickerPC.setTimeZone(TimeZone.getTimeZone(this.timeZone));</span>

<span class="nc bnc" id="L1086" title="All 2 branches missed.">		int len = this.getComment()!=null?this.getComment().length+1:1;</span>

<span class="nc" id="L1088">		int [] durationHour = new int[len-1];</span>
<span class="nc" id="L1089">		int [] durationMinute = new int[len-1];</span>
<span class="nc bnc" id="L1090" title="All 2 branches missed.">		for (int i=0; i&lt;len;i++){</span>
<span class="nc" id="L1091">			m_dateList = m_dateTimePickerPC.getDates();</span>
		}
<span class="nc bnc" id="L1093" title="All 2 branches missed.">		for (int i=0; i&lt;len-1;i++){</span>
			try {
<span class="nc" id="L1095">				durationHour[i] = Integer.valueOf(context.getRequest().getParameter(&quot;duration&quot;+i+&quot;Hour&quot;)).intValue();</span>
<span class="nc" id="L1096">			} catch (NumberFormatException e){</span>
<span class="nc" id="L1097">				durationHour[i] = 0;</span>
<span class="nc" id="L1098">			}</span>
			try {
<span class="nc" id="L1100">				durationMinute[i] = Integer.valueOf(context.getRequest().getParameter(&quot;duration&quot;+i+&quot;Minute&quot;)).intValue();</span>
<span class="nc" id="L1101">			} catch (NumberFormatException e){</span>
<span class="nc" id="L1102">				durationMinute[i] = 0;</span>
<span class="nc" id="L1103">			}</span>
		}

<span class="nc" id="L1106">		this.setDurationHour(durationHour);</span>
<span class="nc" id="L1107">		this.setDurationMinute(durationMinute);</span>
<span class="nc" id="L1108">		return success;</span>
	}

	public List getDateList(){
<span class="nc" id="L1112">		return m_dateList;</span>
	}

	/**
	 * Return URL for HTML Form Action
	 */
	public String getFormAction() {
<span class="nc" id="L1119">		return &quot;addtimerecord&quot;;</span>
	}
	
	private String getTimeLabel() {
<span class="nc" id="L1123">		return i18n(m_bundle, AmWebBundleKey.TIME);</span>
	}
	
	private String getActivityTypeLabel() {
<span class="nc" id="L1127">		return i18n(m_bundle, AmWebBundleKey.ACTIVITY_TYPE);</span>
	}
	
	private String getActivityLabel() {
<span class="nc" id="L1131">		return i18n(m_bundle, AmWebBundleKey.ACTIVITY);</span>
	}
	
	private String getDurationLabel() {
<span class="nc" id="L1135">		return i18n(m_bundle, AmWebBundleKey.DURATION);</span>
	}
	
	private String getPayableLabel() {
<span class="nc" id="L1139">		return i18n(m_bundle, AmWebBundleKey.PAYABLE);</span>
	}
	
	private String getNotesLabel() {
<span class="nc" id="L1143">		return  i18n(m_bundle, AmWebBundleKey.MY_NOTES);</span>
	}
	
	private String getCommentsLabel() {
<span class="nc" id="L1147">		return i18n(m_bundle, AmWebBundleKey.COMMENTS);</span>
	}
	
	private String getActivityLabelID() {
<span class="nc" id="L1151">		return getActivityLabel() + &quot;_ID&quot;;</span>
	}
	
	private String getAccessibilityAnchor(String href, String hiddenRowNumInfo) {
<span class="nc" id="L1155">		HtmlLink accessibilityAnchor = new HtmlLink();</span>
<span class="nc" id="L1156">		accessibilityAnchor.setHref(href);</span>
<span class="nc" id="L1157">		accessibilityAnchor.setOnKeyDown(&quot;top.&quot; + TIME_ENTRY_TABLE_NAME + &quot;.onKeyDown(this);&quot;);</span>
<span class="nc" id="L1158">		accessibilityAnchor.setAttribute(CLASS_ATTR, &quot;focusableNode&quot;);</span>
<span class="nc" id="L1159">		accessibilityAnchor.setInnerHtml(hiddenRowNumInfo + &quot;\n&quot; + HtmlUtil.NBSP);</span>
<span class="nc" id="L1160">		return accessibilityAnchor.toString();</span>
	}
	
	private String getDivAriaAttributes() {
<span class="nc" id="L1164">		StringBuilder divAttributesBuilder = new StringBuilder();</span>
<span class="nc" id="L1165">		divAttributesBuilder.append(ATTR_ROLE_REGION)</span>
<span class="nc" id="L1166">			.append(&quot; &quot;)</span>
<span class="nc" id="L1167">			.append(ATTR_CLASS_TABBABLE)</span>
<span class="nc" id="L1168">			.append(&quot; &quot;)</span>
<span class="nc" id="L1169">			.append(ATTR_TABINDEX + &quot;=\&quot;0\&quot;&quot;)</span>
<span class="nc" id="L1170">			.append(&quot; &quot;)</span>
<span class="nc" id="L1171">			.append(ATTR_ARIA_LABELLEDBY + &quot;=\&quot;&quot; + TIME_ENTRIES_GRID_ID + &quot; &quot; + TIME_ENTRIES_GRID_MSG_ID + &quot;\&quot;&quot;);</span>

<span class="nc" id="L1173">		return divAttributesBuilder.toString();</span>
	}
	
	private String get508TableJS() {
<span class="nc" id="L1177">		StringBuilder jsBuilder = new StringBuilder();</span>
<span class="nc" id="L1178">		jsBuilder.append(&quot;top.&quot;)</span>
<span class="nc" id="L1179">			.append(TIME_ENTRY_TABLE_NAME)</span>
<span class="nc" id="L1180">			.append(&quot; = new Table('&quot;)</span>
<span class="nc" id="L1181">			.append(TIME_ENTRY_TABLE_NAME)</span>
<span class="nc" id="L1182">			.append(&quot;');\n&quot;);</span>
<span class="nc" id="L1183">		return jsBuilder.toString();</span>
	}

	/**
	 * setHtmlDisplay
	 */
	public String getHtmlDisplay(){
		//return html for display
<span class="nc" id="L1191">		StringBuffer htmlDisplay = new StringBuffer(5000);</span>
<span class="nc" id="L1192">		htmlDisplay.append(HtmlUtil.makeHiddenSpanWithId(</span>
<span class="nc" id="L1193">				i18n(m_bundle, AmWebBundleKey.TIME_ENTRIES_GRID_INSTRUCTION_MESSAGE), TIME_ENTRIES_GRID_MSG_ID));</span>
<span class="nc" id="L1194">		htmlDisplay.append(</span>
<span class="nc" id="L1195">				HtmlUtil.makeHiddenSpanWithId(i18n(m_bundle, AmWebBundleKey.TIME_ENTRIES_GRID), TIME_ENTRIES_GRID_ID));</span>

		//start another table
<span class="nc" id="L1198">		htmlDisplay.append(&quot;&lt;div id=\&quot;summaryWrapper\&quot; style=\&quot;width:100%; overflow:auto;\&quot; &quot;);</span>
<span class="nc bnc" id="L1199" title="All 2 branches missed.">		if (isAccessibilityComplianceMode()) {</span>
<span class="nc" id="L1200">			htmlDisplay.append(getDivAriaAttributes());</span>
		}
<span class="nc" id="L1202">		htmlDisplay.append(&quot;&gt;&lt;table cellpadding=\&quot;0\&quot; &quot;);</span>
<span class="nc bnc" id="L1203" title="All 2 branches missed.">		if (isAccessibilityComplianceMode()) {</span>
<span class="nc" id="L1204">			htmlDisplay.append(&quot;id=\&quot;&quot; + TIME_ENTRY_TABLE_NAME + &quot;Ref&quot; + &quot;\&quot; &quot;);</span>
		}
<span class="nc" id="L1206">		htmlDisplay.append(&quot;cellspacing=\&quot;0\&quot; width=\&quot;100%\&quot; class=\&quot;popupTable tableRow508Highlight\&quot;&gt;&quot;);</span>
		

		//get table header
<span class="nc" id="L1210">		htmlDisplay.append(popUpHeader);</span>

		//get table content
<span class="nc" id="L1213">		htmlDisplay.append(tableContent);</span>

		//end table
<span class="nc" id="L1216">		htmlDisplay.append(&quot;&lt;/table&gt;&quot;);</span>

		//end the wrapper table
<span class="nc" id="L1219">		htmlDisplay.append(&quot;&lt;/div&gt;&quot;);</span>

<span class="nc" id="L1221">		return htmlDisplay.toString();</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>