<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>TOAccruedHistoryPU.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.rm.people.timeoff</a> &gt; <span class="el_source">TOAccruedHistoryPU.java</span></div><h1>TOAccruedHistoryPU.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.rm.people.timeoff;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collection;
import java.util.Collections;
import java.util.Date;
import java.util.Iterator;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.l10n.RegionalFormatBundleKey;
import com.bluepumpkin.common.util.StringUtil;
import com.bluepumpkin.ejb.bbm.BbmManagerFactory;
import com.bluepumpkin.ejb.bbm.activity.model.Activity;
import com.bluepumpkin.ejb.bbm.activity.model.ActivityCategory;
import com.bluepumpkin.ejb.bbm.workresource.model.EmployeeTimeOffAccruedHistory;
import com.bluepumpkin.ejb.bbm.workresource.model.EmployeeTimeOffAccruedHistoryFieldInfo;
import com.bluepumpkin.web.bbm.activity.ActivityModelHandler;
import com.bluepumpkin.web.bbm.activity.ActivityTypeModelHandler;
import com.bluepumpkin.web.bbm.employee.EmployeeModelHandler;
import com.bluepumpkin.web.bbm.l10n.BbmWebBundleKey;
import com.bluepumpkin.web.rm.keys.RmJavaScriptFileID;
import com.bluepumpkin.web.rm.l10n.RmWebBundleKey;
import com.witness.web.uif.l10n.UIFWebBundleKey;
import com.witness.web.uif.pagecomponent.DefaultMultiColumnNodeData;
import com.witness.web.uif.pagecomponent.list.MultiColListPC;
import com.witness.web.uif.pagecomponent.picker.date.DateRangePickerPC;
import com.witness.web.uif.pagecomponent.table.TableHeaderPC;
import com.witness.web.uif.pagecomponent.toolbar.ToolbarUtil;
import com.witness.web.uif.pagemodel.PageModel;
import com.witness.web.uif.pagemodel.PopupWindowPM;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.util.HtmlUtil;
import com.witness.web.uif.util.js.JSUtil;

public class TOAccruedHistoryPU extends PopupWindowPM {
	private final DateRangePickerPC m_dateRangePC;
	private final MultiColListPC m_listPC;

<span class="nc" id="L40">	private Collection m_empIDs = Collections.emptyList();</span>
	private ID m_actID;
	private ID m_actCatID;
<span class="nc" id="L43">	private Collection m_toAccrueds = Collections.emptyList();</span>
<span class="nc" id="L44">	private Collection m_accruedIDs = Collections.emptyList();</span>

	public TOAccruedHistoryPU(RequestContext context) {
<span class="nc" id="L47">		super(context);</span>
<span class="nc" id="L48">		m_dateRangePC = new DateRangePickerPC(context, &quot;dateRangeFN&quot;);</span>
<span class="nc" id="L49">		m_dateRangePC.setOnChangeJS(JSUtil.REFRESH_IGNORE_CHANGES);</span>
<span class="nc" id="L50">		m_contentTitlePC.setActiveComponent(m_dateRangePC);</span>
<span class="nc" id="L51">		addChildComponent(m_dateRangePC);</span>
<span class="nc" id="L52">		m_listPC = new MultiColListPC(context);</span>
<span class="nc" id="L53">		addChildComponent(m_listPC);</span>
		
<span class="nc" id="L55">		this.setJSMediator(RmJavaScriptFileID.MEDIATOR_TO_ACCRUED_HISTORY);</span>
<span class="nc" id="L56">	}</span>

	public static PageModel getInstance(RequestContext context) {
<span class="nc" id="L59">		return getInstance(context, TOAccruedHistoryPU.class);</span>
	}

	protected void initializeModel() {
<span class="nc bnc" id="L63" title="All 2 branches missed.">		if (m_isInitialized) return; else m_isInitialized = true;</span>

		try {
<span class="nc" id="L66">			loadData();</span>
<span class="nc" id="L67">		} catch (Exception ex) {</span>
<span class="nc" id="L68">			handleUnableToLoadDataError(log, ex);</span>
		} finally {
<span class="nc" id="L70">			initContentTitle();</span>
<span class="nc" id="L71">			initScreenContent();</span>
<span class="nc" id="L72">			initToolbar();</span>
<span class="nc" id="L73">		}</span>
<span class="nc" id="L74">	}</span>

	protected void loadData() throws Exception {
<span class="nc" id="L77">		Collection actIDs = Collections.emptyList();</span>
<span class="nc" id="L78">		Collection actCatIDs = Collections.emptyList();</span>
<span class="nc" id="L79">		String activityName = &quot;&quot;;</span>
<span class="nc bnc" id="L80" title="All 2 branches missed.">		if (m_actID != null) {</span>
<span class="nc" id="L81">			actIDs = Collections.singletonList(m_actID);</span>
<span class="nc" id="L82">			Activity act = ActivityModelHandler.getActivityByID(m_context, m_actID);</span>
<span class="nc bnc" id="L83" title="All 2 branches missed.">			if (act != null)</span>
<span class="nc" id="L84">				activityName = act.getName();</span>
<span class="nc bnc" id="L85" title="All 2 branches missed.">		} else if (m_actCatID != null) {</span>
<span class="nc" id="L86">			actCatIDs = Collections.singletonList(m_actCatID);</span>
<span class="nc" id="L87">			ActivityCategory actCat = ActivityTypeModelHandler.getActivityTypeByID(m_context, m_actCatID);</span>
<span class="nc bnc" id="L88" title="All 2 branches missed.">			if (actCat != null)</span>
<span class="nc" id="L89">				activityName = actCat.getName();</span>
		}
<span class="nc" id="L91">		m_contentTitlePC.setItemName(activityName);</span>

<span class="nc" id="L93">		Date startDate = m_dateRangePC.getStartDatePickerPC().getDate();</span>
<span class="nc" id="L94">		Date endDate = m_dateRangePC.getEndDatePickerPC().getDate();</span>
<span class="nc bnc" id="L95" title="All 10 branches missed.">		if ( m_empIDs.size() &gt; 0 &amp;&amp; (actIDs.size() &gt; 0 || actCatIDs.size() &gt; 0)</span>
				&amp;&amp; startDate != null &amp;&amp; endDate != null ) {
<span class="nc" id="L97">			m_toAccrueds = BbmManagerFactory.getWorkResourceManager(m_context.isInWhatIfMode())</span>
<span class="nc" id="L98">					.getLastUpdatedTOAccruedHistoryForDateRange(m_empIDs, actIDs, actCatIDs,</span>
							startDate, endDate);
		}

<span class="nc" id="L102">		ArrayList listModel = new ArrayList();</span>
<span class="nc bnc" id="L103" title="All 2 branches missed.">		for (Iterator it = m_toAccrueds.iterator(); it.hasNext();) {</span>
<span class="nc" id="L104">			EmployeeTimeOffAccruedHistory toAccrued = (EmployeeTimeOffAccruedHistory) it.next();</span>
<span class="nc" id="L105">			ArrayList rowData = new ArrayList();</span>
			String temp;
<span class="nc" id="L107">			temp = m_localizer.formatName(</span>
<span class="nc" id="L108">					EmployeeModelHandler.getEmployeeNameByID(m_context, toAccrued.getEmployeeID()) );</span>
<span class="nc" id="L109">			rowData.add(temp);</span>
<span class="nc" id="L110">			temp = &quot;&quot;;</span>
<span class="nc bnc" id="L111" title="All 2 branches missed.">			if (!toAccrued.isFieldNull(EmployeeTimeOffAccruedHistoryFieldInfo.TMOFFACCRUED_ACCRUEDHOURS)) {</span>
<span class="nc" id="L112">				temp = m_localizer.formatNumber(toAccrued.getAccruedHours(), 2);</span>
			}
<span class="nc" id="L114">			rowData.add(temp);</span>
<span class="nc" id="L115">			temp = getFormatDate(toAccrued.getAccruedAtDate());</span>
<span class="nc" id="L116">			rowData.add(temp);</span>
<span class="nc" id="L117">			temp = getFormatDate(toAccrued.getLastModifiedDate());</span>
<span class="nc" id="L118">			rowData.add(temp);</span>

<span class="nc" id="L120">			String id = toAccrued.getID().toString();</span>
<span class="nc" id="L121">			listModel.add( new DefaultMultiColumnNodeData(id, rowData) );</span>
<span class="nc" id="L122">		}</span>
<span class="nc" id="L123">		m_listPC.setListModel(listModel);</span>
<span class="nc" id="L124">	}</span>

	private String getFormatDate(Date date) {
<span class="nc bnc" id="L127" title="All 2 branches missed.">		if (date == null)</span>
<span class="nc" id="L128">			return &quot;&quot;;</span>
		else
<span class="nc" id="L130">			return m_localizer.formatDate(date,</span>
<span class="nc" id="L131">					m_context.getViewingTimeZone(), RegionalFormatBundleKey.DATE_FORMAT);</span>
	}

	protected void initScreenContent() {
<span class="nc" id="L135">		TableHeaderPC headerPC = m_listPC.getHeader();</span>
<span class="nc" id="L136">		headerPC.addColumnHeaderData(&quot;cEmployeeName&quot;, m_localizer.i18n(RmWebBundleKey.BUNDLE_NAME, RmWebBundleKey.EMPLOYEE_NAME_LABEL), false);</span>
<span class="nc" id="L137">		headerPC.addColumnHeaderData(&quot;cUpdatedBalance&quot;, m_localizer.i18n(BbmWebBundleKey.BUNDLE_NAME, BbmWebBundleKey.LastUpdatedBalance), false);</span>
<span class="nc" id="L138">		headerPC.addColumnHeaderData(&quot;cUpdatedDate&quot;,    m_localizer.i18n(BbmWebBundleKey.BUNDLE_NAME, BbmWebBundleKey.UpdatedDate), false);</span>
<span class="nc" id="L139">		headerPC.addColumnHeaderData(&quot;cModifiedDate&quot;,   m_localizer.i18n(BbmWebBundleKey.BUNDLE_NAME, BbmWebBundleKey.ModifiedDate), false);</span>
<span class="nc" id="L140">	}</span>

	public String getHtmlDisplay() {
<span class="nc" id="L143">		return m_listPC.getHtmlDisplay();</span>
	}

	public String getRequiredHTML() {
<span class="nc" id="L147">		return super.getRequiredHTML() </span>
<span class="nc" id="L148">				+ HtmlUtil.makeHiddenInput(&quot;TOAccruedIDs&quot;, &quot;&quot;);</span>
	}

	protected void initContentTitle() {
<span class="nc" id="L152">		String pageTitle = m_localizer.i18n(RmWebBundleKey.BUNDLE_NAME, RmWebBundleKey.TO_ACCRUED_HISTORY);</span>
<span class="nc" id="L153">		m_contentTitlePC.setPageTitle(pageTitle);</span>
<span class="nc" id="L154">	}</span>

	protected void initToolbar() {
<span class="nc" id="L157">		String selectAllLabel = i18n(m_common_bundle, UIFWebBundleKey.TOOLBAR_SELECT_ALL);</span>
<span class="nc" id="L158">		String selectNoneLabel = i18n(m_common_bundle, UIFWebBundleKey.TOOLBAR_SELECT_NONE);</span>
<span class="nc" id="L159">		m_toolbar.addSubmitTextButton(&quot;SELECT_ALL&quot;, selectAllLabel, true);</span>
<span class="nc" id="L160">		m_toolbar.addSubmitTextButton(&quot;SELECT_NONE&quot;, selectNoneLabel, true);</span>
<span class="nc" id="L161">		ToolbarUtil.addDeleteBtn(m_toolbar, false);</span>
<span class="nc" id="L162">		addCloseButton();</span>
<span class="nc" id="L163">	}</span>
	public void setPerformActionOnID(String ids) {
<span class="nc bnc" id="L165" title="All 2 branches missed.">			m_empIDs = !StringUtil.isEmpty(ids)? Arrays.asList(StringUtil.parseIDString(ids)):null;</span>
<span class="nc" id="L166">	}</span>
	public void setActID(ID id) {
<span class="nc" id="L168">		m_actID = id;</span>
<span class="nc" id="L169">	}</span>


	public void setActCatID(ID id) {
<span class="nc" id="L173">		m_actCatID = id;</span>
<span class="nc" id="L174">	}</span>

	public Collection getTOAccruedIDs() {
<span class="nc" id="L177">		return m_accruedIDs;</span>
	}

	public void setTOAccruedIDs(String idsStr) {
<span class="nc" id="L181">		ID[] ids = StringUtil.parseIDString(idsStr);</span>
<span class="nc" id="L182">		m_accruedIDs = Arrays.asList(ids);</span>
<span class="nc" id="L183">	}</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>