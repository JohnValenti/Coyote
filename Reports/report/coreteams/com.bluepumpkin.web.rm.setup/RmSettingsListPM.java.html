<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>RmSettingsListPM.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.rm.setup</a> &gt; <span class="el_source">RmSettingsListPM.java</span></div><h1>RmSettingsListPM.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.rm.setup;

import java.util.Collection;
import java.util.Collections;
import java.util.ResourceBundle;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.logging.Category;
import com.bluepumpkin.ejb.bbm.workresource.OrganizationScopeManagerProxy;
import com.bluepumpkin.ejb.rm.util.LicenseUtil;
import com.bluepumpkin.web.bbm.l10n.BbmWebBundleKey;
import com.bluepumpkin.web.bbm.organization.OrgWorkpaneListPageModel;
import com.bluepumpkin.web.rm.Log;
import com.bluepumpkin.web.rm.l10n.RmWebBundleKey;
import com.witness.web.uif.base.Message;
import com.witness.web.uif.keys.PageAction;
import com.witness.web.uif.pagecomponent.dialog.DialogToolbarMenuPC;
import com.witness.web.uif.system.RequestContext;

/**
 * Title:        RmSettingsListPM
 * Description:  Base class for Request Managements Settings List Page Model
 * Copyright:    Copyright (c) 2003
 * Company:      Blue Pumpkin Software, Inc
 * @author       David Su, DSu
 * @version      1.0
 *
 * Created on Nov 10, 2003, 2:14:05 PM
 */
public abstract class RmSettingsListPM extends OrgWorkpaneListPageModel {
<span class="fc" id="L31">	private static final Category LOG = Log.initCategory(RmSettingsListPM.class.getName());</span>

	private static final String APPLY_RULE = &quot;APPLY_RULE&quot;;
	private static final String NEW_TIMEOFF = &quot;NEW_TIME_OFF&quot;;
	private static final String NEW_TIMEOFF_WITHDRAW = &quot;NEW_TIMEOFF_WITHDRAW&quot;;
	private static final String NEW_SHIFTSWAP = &quot;NEW_SHIFT_SWAP&quot;;
	private static final String NEW_SHIFTBID = &quot;NEW_SHIFT_BID&quot;;
	private static final String NEW_CUSTOMSHIFT = &quot;NEW_CUSTOM_SHIFT&quot;;
	private static final String NEW_FLEXTIME = &quot;NEW_FLEX_TIME&quot;;
	private static final String NEW_RULE_DIALOG_NAME = &quot;NEW_RULE_DIALOG_NAME&quot;;
	private static final String NEW_SHIFTSWAP_WITHDRAW = &quot;NEW_SHIFTSWAP_WITHDRAW&quot;;

	private ID m_privID_TOM;
	private ID m_privID_SS;
	private ID m_privID_SB;
	private ID m_privID_SC;
	private ID m_privID_FT;
	
	protected DialogToolbarMenuPC m_dialogMenuPC;
	private String[] m_appliedRuleIds;
	private String[] m_totalRuleIds;

<span class="pc" id="L53">	protected Collection m_ruleList = Collections.emptyList();</span>
<span class="pc" id="L54">	protected boolean m_isEmpty = true;</span>
	protected ResourceBundle m_rmBundle;

	/**
	 * Constructor
	 */
	public RmSettingsListPM(RequestContext context, ID privID_TOM, ID privID_SS, 
			ID privID_SB, ID privID_SC) {
<span class="nc" id="L62">		super(context);</span>
<span class="nc" id="L63">		m_privID_TOM = privID_TOM;</span>
<span class="nc" id="L64">		m_privID_SS = privID_SS;</span>
<span class="nc" id="L65">		m_privID_SB = privID_SB;</span>
<span class="nc" id="L66">		m_privID_SC = privID_SC;</span>
		
<span class="nc" id="L68">		m_rmBundle = m_localizer.getBundle(RmWebBundleKey.BUNDLE_NAME);</span>

<span class="nc" id="L70">		initDialog(context);</span>
<span class="nc" id="L71">		addChildComponent(m_dialogMenuPC);</span>
<span class="nc" id="L72">	}</span>
	public RmSettingsListPM(RequestContext context, ID privID_TOM, ID privID_SS, 
			ID privID_SB, ID privID_SC,ID privID_FT) {
<span class="fc" id="L75">		super(context);</span>
<span class="fc" id="L76">		m_privID_TOM = privID_TOM;</span>
<span class="fc" id="L77">		m_privID_SS = privID_SS;</span>
<span class="fc" id="L78">		m_privID_SB = privID_SB;</span>
<span class="fc" id="L79">		m_privID_SC = privID_SC;</span>
<span class="fc" id="L80">		m_privID_FT = privID_FT;</span>

<span class="fc" id="L82">		m_rmBundle = m_localizer.getBundle(RmWebBundleKey.BUNDLE_NAME);</span>

<span class="fc" id="L84">		initDialog(context);</span>
<span class="fc" id="L85">		addChildComponent(m_dialogMenuPC);</span>
<span class="fc" id="L86">	}</span>

	/**
	 * Loads all the RuleList value objects for the selected Organization ID
	 *
	 * @return true if load was successful
	 */
	protected boolean loadRules() {
		try {
<span class="pc bpc" id="L95" title="1 of 2 branches missed.">			if (isAuthorizedToConfigure()) {</span>
<span class="fc" id="L96">				m_ruleList = loadSpecificRules();</span>
<span class="fc" id="L97">				m_isEmpty = m_ruleList.isEmpty();</span>
<span class="fc" id="L98">				return true;</span>
			} else {
<span class="nc" id="L100">				addPageMessage(Message.RESPONSE_TYPE,</span>
						BbmWebBundleKey.NOT_AUTHORIZED_TO_CONFIG_SELECTED_ORG,
						BbmWebBundleKey.BUNDLE_NAME);
			}
<span class="nc" id="L104">		} catch (Exception ex) {</span>
<span class="nc" id="L105">			handleUnableToLoadDataError(LOG, ex);</span>
<span class="nc" id="L106">		}</span>
<span class="nc" id="L107">		return false;</span>
	}

	protected abstract Collection loadSpecificRules() throws Exception;

	protected abstract String getDialogHeader();

	/**
	 * Use default tool bar
	 */
	protected void useDefaultToolbar(String applyRuleLabel, String addLabel,
			String copyLabel, String editLabel, String delLabel) {
		// Apply Rule
<span class="fc" id="L120">		m_toolbar.addSubmitTextButton(APPLY_RULE, applyRuleLabel,</span>
<span class="fc bfc" id="L121" title="All 4 branches covered.">									  isAddActionEnabled() &amp;&amp; !m_isEmpty);</span>

		// Display Add
<span class="fc" id="L124">		m_toolbar.addPopupDialogTextButton(NEW_RULE_DIALOG_NAME, addLabel,</span>
<span class="fc" id="L125">				isAddActionEnabled());</span>

		// Display Copy
<span class="fc" id="L128">		m_toolbar.addSubmitTextButton(PageAction.COPY, copyLabel,</span>
<span class="fc" id="L129">				isCopyActionEnabled());</span>

		// Display Edit and Delete
<span class="fc" id="L132">		m_toolbar.addSubmitTextButton(PageAction.EDIT, editLabel,</span>
<span class="fc" id="L133">				isEditActionEnabled());</span>

<span class="fc" id="L135">		m_toolbar.addDeleteTextButton(PageAction.DELETE, delLabel,</span>
<span class="fc" id="L136">				isDeleteActionEnabled());</span>
<span class="fc" id="L137">	}</span>
	protected void initDialogMenuAndAddTimeOffRules(ID selectedOrgID ,RequestContext context){
	
<span class="fc" id="L140">		m_dialogMenuPC = new DialogToolbarMenuPC(context, m_toolbar);</span>
<span class="fc" id="L141">		m_dialogMenuPC.setName(NEW_RULE_DIALOG_NAME);</span>

<span class="fc" id="L143">		m_dialogMenuPC.setHeader( getDialogHeader() );</span>

<span class="fc" id="L145">		m_dialogMenuPC.addSubmitButton(NEW_TIMEOFF,</span>
<span class="fc" id="L146">				i18n(m_rmBundle, RmWebBundleKey.REQUEST_TYPE_TIME_OFF),</span>
<span class="fc" id="L147">				isAuthorizedToConfigureTOM(selectedOrgID));</span>
		
<span class="fc" id="L149">		m_dialogMenuPC.addSubmitButton(NEW_TIMEOFF_WITHDRAW,</span>
<span class="fc" id="L150">				i18n(m_rmBundle, RmWebBundleKey.REQUEST_TYPE_TIME_OFF_WITHDRAW),</span>
<span class="fc" id="L151">				isAuthorizedToConfigureTOM(selectedOrgID));</span>
		
			
<span class="fc" id="L154">	}</span>
	protected void addShiftRulesToDialogMenu(ID selectedOrgID, RequestContext context){
<span class="fc" id="L156">		m_dialogMenuPC.addSubmitButton(NEW_SHIFTSWAP,</span>
<span class="fc" id="L157">				i18n(m_rmBundle, RmWebBundleKey.REQUEST_TYPE_SHIFT_SWAP),</span>
<span class="fc" id="L158">				isAuthorizedToConfigureSS(selectedOrgID));</span>
		
<span class="pc bpc" id="L160" title="1 of 2 branches missed.">		if (LicenseUtil.isAdvancedRMLicense()){</span>
<span class="nc" id="L161">			m_dialogMenuPC.addSubmitButton(NEW_SHIFTSWAP_WITHDRAW,</span>
<span class="nc" id="L162">					i18n(m_rmBundle, RmWebBundleKey.REQUEST_TYPE_SHIFT_SWAP_WITHDRAW),</span>
<span class="nc" id="L163">					isAuthorizedToConfigureSS(selectedOrgID));</span>
		}

<span class="fc" id="L166">		m_dialogMenuPC.addSubmitButton(NEW_SHIFTBID,</span>
<span class="fc" id="L167">				i18n(m_rmBundle, RmWebBundleKey.REQUEST_TYPE_SHIFT_BIDDING),</span>
<span class="fc" id="L168">				isAuthorizedToConfigureSB(selectedOrgID));</span>
		
<span class="fc" id="L170">		m_dialogMenuPC.addSubmitButton(NEW_CUSTOMSHIFT,</span>
<span class="fc" id="L171">				i18n(m_rmBundle, RmWebBundleKey.REQUEST_TYPE_CUSTOM_SHIFT),</span>
<span class="fc" id="L172">				isAuthorizedToConfigureSC(selectedOrgID));</span>
		
<span class="fc" id="L174">	}</span>
	protected void addFlexTimeToDialogMenu(ID selectedOrgID, RequestContext context){
<span class="nc" id="L176">		m_dialogMenuPC.addSubmitButton(NEW_FLEXTIME,</span>
<span class="nc" id="L177">				i18n(m_rmBundle, RmWebBundleKey.REQUEST_TYPE_FLEX_TIME),</span>
<span class="nc" id="L178">				isAuthorizedToConfigureFT(selectedOrgID));	</span>
<span class="nc" id="L179">	}</span>
	protected void initDialog(RequestContext context) {
<span class="fc" id="L181">		ID selectedOrgID = getSelectedIDObject();</span>
<span class="fc" id="L182">		initDialogMenuAndAddTimeOffRules(selectedOrgID,context);</span>
<span class="fc" id="L183">		addShiftRulesToDialogMenu(selectedOrgID,context);</span>
<span class="fc" id="L184">		addGenericHTML(m_dialogMenuPC.getHtmlDisplay());</span>
<span class="fc" id="L185">	}</span>

	public void setAppliedRuleIds(String[] ids) {
<span class="nc" id="L188">		m_appliedRuleIds = ids;</span>
<span class="nc" id="L189">	}</span>

	public String[] getAppliedRuleIds() {
<span class="nc" id="L192">		return m_appliedRuleIds;</span>
	}

	public void setTotalRuleIds(String[] ids) {
<span class="nc" id="L196">		m_totalRuleIds = ids;</span>
<span class="nc" id="L197">	}</span>

	public String[] getTotalRuleIds() {
<span class="nc" id="L200">		return m_totalRuleIds;</span>
	}

	@Override
	protected boolean isAuthorizedToConfigure() {
<span class="fc" id="L205">		return isAuthorizedToConfigure(getSelectedIDObject());</span>
	}

	/**
	 * Return true if Current User is authorized to configure specified Organization
	 */
	@Override
	protected boolean isAuthorizedToConfigure(ID orgID) {
<span class="pc bpc" id="L213" title="1 of 2 branches missed.">		return isAuthorizedToConfigureTOM(orgID) ||</span>
<span class="nc bnc" id="L214" title="All 2 branches missed.">			isAuthorizedToConfigureFT(orgID) ||</span>
<span class="nc bnc" id="L215" title="All 2 branches missed.">			isAuthorizedToConfigureSS(orgID) ||</span>
<span class="nc bnc" id="L216" title="All 2 branches missed.">			isAuthorizedToConfigureSB(orgID) ||</span>
<span class="pc bnc" id="L217" title="All 2 branches missed.">			isAuthorizedToConfigureSC(orgID);</span>
	}

	protected boolean isAuthorizedToConfigureTOM(ID orgID) {
<span class="fc" id="L221">		return m_context.getUser().isAuthorized(m_privID_TOM,</span>
<span class="fc" id="L222">				OrganizationScopeManagerProxy.getScopeID(orgID));</span>
	}
	
	protected boolean isAuthorizedToConfigureFT(ID orgID) {
<span class="fc" id="L226">		return m_context.getUser().isAuthorized(m_privID_FT,</span>
<span class="fc" id="L227">				OrganizationScopeManagerProxy.getScopeID(orgID));</span>
	}

	protected boolean isAuthorizedToConfigureSS(ID orgID) {
<span class="fc" id="L231">		return m_context.getUser().isAuthorized(m_privID_SS,</span>
<span class="fc" id="L232">				OrganizationScopeManagerProxy.getScopeID(orgID));</span>
	}

	protected boolean isAuthorizedToConfigureSB(ID orgID) {
<span class="fc" id="L236">		return m_context.getUser().isAuthorized(m_privID_SB,</span>
<span class="fc" id="L237">				OrganizationScopeManagerProxy.getScopeID(orgID));</span>
	}
	
	protected boolean isAuthorizedToConfigureSC(ID orgID) {
<span class="fc" id="L241">		return m_context.getUser().isAuthorized(m_privID_SC,</span>
<span class="fc" id="L242">				OrganizationScopeManagerProxy.getScopeID(orgID));</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>