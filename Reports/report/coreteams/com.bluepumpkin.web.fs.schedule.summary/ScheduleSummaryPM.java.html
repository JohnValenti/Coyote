<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>ScheduleSummaryPM.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.fs.schedule.summary</a> &gt; <span class="el_source">ScheduleSummaryPM.java</span></div><h1>ScheduleSummaryPM.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.fs.schedule.summary;

import java.util.ArrayList;
import java.util.Calendar;
import java.util.Collection;
import java.util.HashMap;
import java.util.Iterator;
import java.util.Map;
import java.util.ResourceBundle;
import java.util.TimeZone;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.l10n.RegionalFormatBundleKey;
import com.bluepumpkin.ejb.rm.base.RmHardValidationException;
import com.bluepumpkin.web.bbm.l10n.BbmWebBundleKey;
import com.bluepumpkin.web.fs.l10n.FsWebBundleKey;
import com.bluepumpkin.web.fs.schedule.ScheduleViewMH;
import com.bluepumpkin.web.fs.schedule.ScheduleViewPM;
import com.bluepumpkin.web.fs.schedule.ScheduleViewShiftDisplayInfo;
import com.bluepumpkin.web.fs.schedule.ScheduleViewUtil;
import com.witness.ejb.core.security.PrivilegeKeys;
import com.witness.ejb.core.security.model.User;
import com.witness.web.uif.base.Message;
import com.witness.web.uif.keys.JavaScriptFileID;
import com.witness.web.uif.keys.PageAction;
import com.witness.web.uif.l10n.UIFWebBundleKey;
import com.witness.web.uif.pagecomponent.BaseNodeData;
import com.witness.web.uif.pagecomponent.DefaultMultiColumnNodeData;
import com.witness.web.uif.pagecomponent.container.CollapsibleContainerPC;
import com.witness.web.uif.pagecomponent.list.MultiColListPC;
import com.witness.web.uif.pagecomponent.table.TableHeaderPC;
import com.witness.web.uif.pagemodel.ContainersInRowsPM;
import com.witness.web.uif.pagemodel.PageModel;
import com.witness.web.uif.pagemodel.WorkpanePageModel;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.util.ContainerList;
import com.witness.web.uif.util.TimeZoneHelper;
import com.witness.web.uif.util.html.CSSUtil;

/**
 * Title:        ScheduleSummaryPM
 * Description:  Page Model for Schedule summary viewing.
 * Copyright:    Copyright (c) 2001
 * Company:      Blue Pumpkin Software, inc
 * @author       Chris King; Pavel Bosin; David Su
 * @version      1.0
 */
public class ScheduleSummaryPM extends WorkpanePageModel implements ContainersInRowsPM {
	public static final String FORM_ACTION = &quot;schedulesummary&quot;;

<span class="fc" id="L51">	private static final String[] SS_HEADER_RB_KEYS = new String[] {</span>
		FsWebBundleKey.SS_SUMMARY_POSTINGS,
		FsWebBundleKey.SUMMARY_REQUESTS_TOTAL,
		FsWebBundleKey.SUMMARY_REQUESTS_EXPIRED,
		FsWebBundleKey.SUMMARY_REQUESTS_IMCOMPLETE,
		FsWebBundleKey.SUMMARY_REQUESTS_PENDING,
		FsWebBundleKey.SUMMARY_REQUESTS_APPROVED,
		FsWebBundleKey.SUMMARY_REQUESTS_DENIED,
		FsWebBundleKey.SUMMARY_REQUESTS_INVALID
	};

<span class="fc" id="L62">	private static final String[] SB_HEADER_RB_KEYS = new String[] {</span>
		FsWebBundleKey.SB_SUMMARY_AUCTIONS,
		FsWebBundleKey.SUMMARY_REQUESTS_TOTAL,
		FsWebBundleKey.SUMMARY_REQUESTS_EXPIRED,
		FsWebBundleKey.SUMMARY_REQUESTS_PENDING,
		FsWebBundleKey.SUMMARY_REQUESTS_APPROVED,
		FsWebBundleKey.SUMMARY_REQUESTS_DENIED,
		FsWebBundleKey.SUMMARY_REQUESTS_INVALID
	};

	//containers
	private final ContainerList m_containerList;
<span class="nc" id="L74">	private CollapsibleContainerPC m_thisWeekSchedulePC = null;</span>
<span class="nc" id="L75">	private TimeOffSummaryPC m_TOSummaryPC = null;</span>
<span class="nc" id="L76">	private FlexTimeSummaryPC flexTimeSummaryPC = null;</span>
<span class="nc" id="L77">	private CollapsibleContainerPC m_SSSummaryPC = null;</span>
<span class="nc" id="L78">	private OneWayShiftSwapSummaryPC oneWaySSSummaryPC = null;</span>
<span class="nc" id="L79">	private CollapsibleContainerPC m_SBSummaryPC = null;</span>
<span class="nc" id="L80">	private TimeBankSummaryPC m_TBSummaryPC = null;</span>
	private final RequiredPayPeriodHoursSummaryPC requiredPayPeriodHoursSummaryPC;

	private final ResourceBundle m_bundle;
	private final User m_user;

	/**
	 * Constructor
	 */
	public ScheduleSummaryPM(RequestContext context) {
<span class="nc" id="L90">		super(context, PageModel.BASIC_MODEL);</span>

<span class="nc" id="L92">		ID employeeID = m_context.getUser().getEmployeeID();</span>

		// === member variables
<span class="nc" id="L95">		m_bundle = m_localizer.getBundle(FsWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L96">		m_user = context.getUser();</span>
<span class="nc" id="L97">		m_containerList = new ContainerList(this, 3);</span>

<span class="nc" id="L99">		m_TOSummaryPC = new TimeOffSummaryPC(m_context);</span>
<span class="nc" id="L100">		addChildComponent(m_TOSummaryPC);</span>

<span class="nc" id="L102">		requiredPayPeriodHoursSummaryPC = new RequiredPayPeriodHoursSummaryPC(m_context, employeeID);</span>
<span class="nc" id="L103">		addChildComponent(requiredPayPeriodHoursSummaryPC);</span>

<span class="nc" id="L105">		flexTimeSummaryPC = new FlexTimeSummaryPC(m_context);</span>
<span class="nc" id="L106">		addChildComponent(flexTimeSummaryPC);</span>

<span class="nc" id="L108">		oneWaySSSummaryPC = new OneWayShiftSwapSummaryPC(m_context);</span>
<span class="nc" id="L109">		addChildComponent(oneWaySSSummaryPC);</span>

<span class="nc" id="L111">		m_TBSummaryPC = new TimeBankSummaryPC(m_context);</span>
<span class="nc" id="L112">		addChildComponent(m_TBSummaryPC);</span>

		// === specific required JavaScript Files
<span class="nc" id="L115">		setJSMediator(JavaScriptFileID.MEDIATOR_WORKPANE_GENERIC);</span>
<span class="nc" id="L116">	}// constructor</span>

	/**
	 * Return instance of Model which is ready to be rendered
	 */
	public static PageModel getInstance(RequestContext context)	throws Exception {
<span class="nc" id="L122">		return getInstance(context, ScheduleSummaryPM.class);</span>
	}//getInstance

	/**
	 * Initialize Model with Data
	 */
	@Override
	protected void initializeModel() {
<span class="nc bnc" id="L130" title="All 2 branches missed.">		if (m_isInitialized) {</span>
<span class="nc" id="L131">			return;</span>
		}
<span class="nc" id="L133">		m_isInitialized = true;</span>

		try {
			//--- check if valid employee
<span class="nc bnc" id="L137" title="All 2 branches missed.">			if(m_user.getEmployeeID() == null){</span>
<span class="nc" id="L138">				addPageMessage(Message.INFO_TYPE, BbmWebBundleKey.NO_PERSON_INFO,BbmWebBundleKey.BUNDLE_NAME);</span>
			} else {
<span class="nc" id="L140">				HashMap theData = ScheduleSummaryMH.getData(m_context);</span>
<span class="nc" id="L141">				populateThisWeekSchedule(theData);</span>
<span class="nc" id="L142">				populateTimeOffSummary();</span>
<span class="nc" id="L143">				populateRequiredPayPeriodHoursSummary();</span>
<span class="nc" id="L144">				populateFlexTimeSummary(theData);</span>
<span class="nc" id="L145">				populateShiftSwapSummary(theData);</span>
<span class="nc" id="L146">				populateOneWayShiftSwapSummary(theData);</span>
<span class="nc" id="L147">				populateShiftBiddingSummary(theData);</span>
<span class="nc" id="L148">				populateTimeBankingSummary(theData);</span>
			}
<span class="nc" id="L150">		} catch (RmHardValidationException ex) {</span>
<span class="nc" id="L151">			Message msg = handleUnableToLoadDataError(log, ex);</span>
<span class="nc" id="L152">			msg.setAssociatedMessage(ex.getLocalizedMessage(m_localizer, m_context.getViewingTimeZone()));			</span>
<span class="nc" id="L153">		} catch (Exception ex) {</span>
<span class="nc" id="L154">			handleUnableToLoadDataError(log, ex);</span>
		} finally {
<span class="nc" id="L156">			initToolbar();</span>
<span class="nc" id="L157">			initContentTitle();</span>
<span class="nc" id="L158">		}</span>
<span class="nc" id="L159">	}//populateModel</span>

	//=========== initialize Schedule container =================
	/**
	 * Populate This Week Schedule PC
	 * @param theData has the data to populate the component
	 */
	private void populateThisWeekSchedule(Map theData) 
	{
		try 
		{
<span class="nc" id="L170">			m_thisWeekSchedulePC = createContainerPC(&quot;ScheduleContainer&quot;);</span>
<span class="nc" id="L171">			String listName = &quot;thisWeekSchedTable&quot;;</span>
<span class="nc" id="L172">			String leftTitle =</span>
<span class="nc" id="L173">					i18n(m_bundle, FsWebBundleKey.SCHED_SUMMARY_THIS_WEEK_SCHEDULE) + &quot; - &quot; +</span>
<span class="nc" id="L174">					i18n(m_common_bundle, UIFWebBundleKey.TIMEZONE_VIEWING) + &quot;: &quot;;</span>
<span class="nc" id="L175">			String titleData = leftTitle + TimeZoneHelper.getDisplayTimeZone(m_context.getViewingTimeZone().getID(), m_localizer);</span>
<span class="nc" id="L176">			String ariaTitle = leftTitle + m_localizer.formatTimeZone(m_context.getViewingTimeZone().getID());</span>

<span class="nc" id="L178">			m_thisWeekSchedulePC.setTitle(titleData);</span>
<span class="nc" id="L179">			m_thisWeekSchedulePC.setWrapperAriaLabel(ariaTitle);</span>
			//--- data from the map
<span class="nc" id="L181">			Collection thisWeekScheduleData = (Collection)theData.get(ScheduleSummaryMH.THIS_WEEK_SCHEDULE_KEY);</span>
<span class="nc" id="L182">			Calendar thisWeekStart = (Calendar)theData.get(ScheduleSummaryMH.THIS_WEEK_START_DATE_KEY);</span>

			//--- multi column list PC object
<span class="nc" id="L185">			MultiColListPC theListPC = initContianerAndCreateList(m_context, m_thisWeekSchedulePC);</span>
<span class="nc" id="L186">			theListPC.setName(listName);</span>
			//--- set column headers with dates and day-of-week
<span class="nc" id="L188">			setScheduleListHeaders(theListPC,thisWeekStart);</span>
			
<span class="nc" id="L190">			Map&lt;ID, String&gt; campaignNamesBySPID = (Map&lt;ID, String&gt;)theData.get(ScheduleViewMH.CAMPAIGN_NAMES_BY_SP_ID_KEY);</span>
			
			//--- set this week data into theListPC
<span class="nc" id="L193">			createScheduleListModel(theListPC, thisWeekScheduleData, thisWeekStart, campaignNamesBySPID);</span>
		} 
<span class="nc" id="L195">		catch (Exception ex) </span>
		{
<span class="nc" id="L197">			handlePopulateContainerError(FsWebBundleKey.MSG_SCHED_SUMMARY_NO_THISWEEK_SCHEDULE, ex);</span>
<span class="nc" id="L198">		}</span>
<span class="nc" id="L199">	}//populateThisWeekSchedule</span>

	/**
	 * create list headers for this week schedule list
	 */
	private void setScheduleListHeaders(MultiColListPC theListPC, Calendar thisWeekStart){
<span class="nc" id="L205">		TableHeaderPC header = theListPC.getHeader();</span>
<span class="nc" id="L206">		Calendar aCal = (Calendar)thisWeekStart.clone();</span>
<span class="nc" id="L207">		TimeZone tz = m_context.getViewingTimeZone();</span>
<span class="nc" id="L208">		boolean dstAdjustment = false;</span>
<span class="nc bnc" id="L209" title="All 2 branches missed.">		for (int i = 0; i &lt;7; i++){</span>
<span class="nc" id="L210">			header.addColumnHeaderData(null, m_localizer.formatDate(aCal.getTime(),</span>
					tz,RegionalFormatBundleKey.DATE_NOYEAR_DAYINWEEKFULL_FORMAT));

			//QC46598 java bug for Brazil DST transition 10/18/09
			//aCal.add(Calendar.DATE, 1);
<span class="nc" id="L215">			dstAdjustment = ScheduleViewUtil.nextDay(aCal, dstAdjustment);</span>
		}
<span class="nc" id="L217">	}//setScheduleListHeaders</span>

	/**
     * Add a tooltip to an HTML element
     */
    public String addTooltip(String html, String tooltip)
    {
<span class="nc" id="L224">        return &quot;&lt;span title=\&quot;&quot; + tooltip + &quot;\&quot;&gt;&quot; + html + &quot;&lt;/span&gt;&quot;;</span>
    }
    
	/**
	 * set Schedule List Data items
     * @param campaignIdNames - Map of campaignID-&gt;campaignName.
	 */
	private void createScheduleListModel(MultiColListPC theListPC,
			Collection thisWeekScheduleData, Calendar thisWeekStart, Map&lt;ID, String&gt; campaignNamesBySPID)
	{
<span class="nc bnc" id="L234" title="All 4 branches missed.">		if (thisWeekScheduleData == null || thisWeekScheduleData.size() == 0) </span>
<span class="nc" id="L235">		    return;</span>

		// Create the list model and one row data
<span class="nc" id="L238">		ArrayList listModel = new ArrayList(1);</span>
<span class="nc" id="L239">		DefaultMultiColumnNodeData row_data = new DefaultMultiColumnNodeData();</span>
		// add nodes to the row
<span class="nc" id="L241">		TimeZone tz = m_context.getViewingTimeZone();</span>

<span class="nc bnc" id="L243" title="All 2 branches missed.">		for(Iterator it = thisWeekScheduleData.iterator(); it.hasNext();) </span>
		{
			//entries &quot;unpublished&quot; or &quot;no shift&quot; or &quot;hh:mm am - hh:mm pm&quot; or &quot;day off&quot;
<span class="nc" id="L246">			DailyScheduleSummary oneDaySchedule = (DailyScheduleSummary) it.next();</span>
			
<span class="nc bnc" id="L248" title="All 2 branches missed.">			if (!oneDaySchedule.isPublished())</span>
			{
<span class="nc" id="L250">				row_data.add(i18n(m_bundle,FsWebBundleKey.SCHED_SUMMARY_UNPUBLISHED));</span>
			} 
            else
            {
                // GMT clients may have custom strings in BPCONFIG
<span class="nc" id="L255">                String verticalizedString = verticalize(m_bundle, FsWebBundleKey.FS_CAL_TITLEBAR_CAMPAIGN);</span>
<span class="nc" id="L256">                String tooltip = verticalizedString +</span>
<span class="nc" id="L257">                        ScheduleViewUtil.getCampaignName(campaignNamesBySPID, oneDaySchedule);</span>

<span class="nc bnc" id="L259" title="All 2 branches missed.">                if (oneDaySchedule.isDayOff())</span>
			{
<span class="nc" id="L261">                	String defaultAbsentString= i18n(m_bundle,FsWebBundleKey.SCHED_SUMMARY_DAY_OFF);</span>
<span class="nc" id="L262">      				String absentStringOverride = ScheduleSummaryMH.getAbsentStringOverride();</span>
<span class="nc bnc" id="L263" title="All 4 branches missed.">      				if(absentStringOverride!=null &amp;&amp; absentStringOverride.equals(FsWebBundleKey.FS_CUSTOM_TIME_OFF)) //The value is specific for France Telecom, Story 34046</span>
<span class="nc" id="L264">      					absentStringOverride = i18n(m_bundle,FsWebBundleKey.FS_CUSTOM_TIME_OFF);</span>
<span class="nc bnc" id="L265" title="All 2 branches missed.">      				absentStringOverride = absentStringOverride==null ? defaultAbsentString : absentStringOverride;</span>
<span class="nc" id="L266">				row_data.add(addTooltip(absentStringOverride,tooltip));</span>
<span class="nc" id="L267">			}</span>
<span class="nc bnc" id="L268" title="All 2 branches missed.">			else if (oneDaySchedule.isClosed())</span>
			{
<span class="nc" id="L270">				row_data.add(addTooltip(i18n(m_bundle,FsWebBundleKey.SCHED_SUMMARY_CLOSED),tooltip));</span>
			} 
<span class="nc bnc" id="L272" title="All 2 branches missed.">			else if (oneDaySchedule.hasShift())</span>
			{
<span class="nc" id="L274">				String shiftString = &quot;&quot;;</span>
<span class="nc" id="L275">					ScheduleViewShiftDisplayInfo shiftStrings = ScheduleViewPM.getShiftDisplayInfoWithAccessibility(</span>
<span class="nc" id="L276">							oneDaySchedule, m_localizer, tz, isAccessibilityComplianceMode());</span>
<span class="nc bnc" id="L277" title="All 2 branches missed.">				if (shiftStrings != null)</span>
				{
<span class="nc" id="L279">					shiftString += shiftStrings.getPreviousDayIcon();</span>
<span class="nc" id="L280">					shiftString += shiftStrings.getShiftString();</span>
<span class="nc" id="L281">					shiftString += shiftStrings.getNextDayIcon();</span>
				}
<span class="nc" id="L283">				row_data.add(addTooltip(shiftString,tooltip));</span>
<span class="nc" id="L284">			} </span>
			else 
			{
<span class="nc" id="L287">				row_data.add(i18n(m_bundle,FsWebBundleKey.SCHED_SUMMARY_OFF));</span>
			}
            }

<span class="nc" id="L291">		}</span>
<span class="nc" id="L292">		listModel.add(row_data);</span>
<span class="nc" id="L293">		theListPC.setListModel(listModel);</span>
<span class="nc" id="L294">	}//createScheduleListModel</span>


	private void populateTimeOffSummary() {
<span class="nc bnc" id="L298" title="All 2 branches missed.">		if (m_user.isAuthorized(PrivilegeKeys.TOM_VIEWPERSONALSUMMARY) ) {</span>
<span class="nc" id="L299">			m_containerList.add(m_TOSummaryPC, false);</span>
<span class="nc" id="L300">			m_TOSummaryPC.init();</span>
		}
<span class="nc" id="L302">	}</span>

	private void populateRequiredPayPeriodHoursSummary() throws Exception {
<span class="nc bnc" id="L305" title="All 2 branches missed.">		if (requiredPayPeriodHoursSummaryPC.initForEmployee()) {</span>
<span class="nc" id="L306">			m_containerList.add(requiredPayPeriodHoursSummaryPC);</span>
		}
<span class="nc" id="L308">	}</span>

	//=========== initialize Shift Swap container =================
	/**
	 * Populate Shift Swap Summary PC
	 * @param theData has the data to populate the component
	 */
	private void populateShiftSwapSummary(Map theData) {
		try {
<span class="nc bnc" id="L317" title="All 2 branches missed.">			if( ScheduleViewPM.getBooleanFromMap(theData, ScheduleSummaryMH.SHOW_SS_SUMMARY)){</span>
<span class="nc" id="L318">				String listName = &quot;shiftSwapTable&quot;;</span>
<span class="nc" id="L319">				m_SSSummaryPC = createContainerPC(&quot;SSContainer&quot;);</span>
<span class="nc" id="L320">				m_SSSummaryPC.setTitle(i18n(m_bundle, FsWebBundleKey.SCHED_SUMMARY_SS_SUMMARY));</span>
<span class="nc" id="L321">				MultiColListPC theListPC = initContianerAndCreateList(m_context, m_SSSummaryPC);</span>
<span class="nc" id="L322">				theListPC.setName(listName);</span>
<span class="nc" id="L323">				initHeader(theListPC, SS_HEADER_RB_KEYS);</span>

<span class="nc" id="L325">				ShiftSwapSummaryData data = (ShiftSwapSummaryData)theData.get(ScheduleSummaryMH.SS_SUMMARY_DATA_KEY);</span>
<span class="nc" id="L326">				createSSListModel(theListPC,data);</span>
			}
<span class="nc" id="L328">		} catch (Exception ex) {</span>
<span class="nc" id="L329">			handlePopulateContainerError(FsWebBundleKey.MSG_SCHED_SUMMARY_NO_SS_SUMMARY, ex);</span>
<span class="nc" id="L330">		}</span>
<span class="nc" id="L331">	}//populateShiftSwapSummary</span>

	/**
	 * set Shift Swap Summary List model
	 */
	private void createSSListModel(MultiColListPC theListPC, ShiftSwapSummaryData data){
<span class="nc bnc" id="L337" title="All 2 branches missed.">		if (data == null) return;</span>

		// Create the list model
<span class="nc" id="L340">		ArrayList listModel = new ArrayList(1);</span>
<span class="nc" id="L341">		DefaultMultiColumnNodeData row_data = new DefaultMultiColumnNodeData();</span>
<span class="nc" id="L342">		addNumData(data.getPostings(), row_data);</span>
<span class="nc" id="L343">		addNumData(data.getRequestsTotal(), row_data);</span>
<span class="nc" id="L344">		addNumData(data.getRequestsExpired(), row_data);</span>
<span class="nc" id="L345">		addNumData(data.getRequestsNegotiation(), row_data);</span>
<span class="nc" id="L346">		addNumData(data.getRequestsPending(), row_data);</span>
<span class="nc" id="L347">		addNumData(data.getRequestsApproved(), row_data);</span>
<span class="nc" id="L348">		addNumData(data.getRequestsDenied(), row_data);</span>
<span class="nc" id="L349">		addNumData(data.getRequestsInvalid(), row_data);</span>

<span class="nc" id="L351">		listModel.add(row_data);</span>
<span class="nc" id="L352">		theListPC.setListModel(listModel);</span>
<span class="nc" id="L353">	}</span>

	//=========== initialize One-Way Shift Swap container =================

	/**
	 * Populate One-Way Shift Swap Summary PC
	 * @param theData has the data to populate the component
	 */
	private void populateOneWayShiftSwapSummary(Map theData) 
	{
		try {
<span class="nc bnc" id="L364" title="All 2 branches missed.">			if (ScheduleViewPM.getBooleanFromMap(theData, ScheduleSummaryMH.SHOW_ONE_WAY_SS_SUMMARY)) {</span>
<span class="nc" id="L365">				OneWayShiftSwapSummaryData data = (OneWayShiftSwapSummaryData)theData.get(ScheduleSummaryMH.ONE_WAY_SS_SUMMARY_DATA_KEY);</span>
<span class="nc bnc" id="L366" title="All 2 branches missed.">				if (data != null) {</span>
<span class="nc" id="L367">					oneWaySSSummaryPC.init(data);</span>
<span class="nc" id="L368">					m_containerList.add(oneWaySSSummaryPC, false);</span>
				}
			}
		} 
<span class="nc" id="L372">		catch (Exception ex) {</span>
<span class="nc" id="L373">			handlePopulateContainerError(FsWebBundleKey.MSG_SCHED_SUMMARY_NO_ONE_WAY_SS_SUMMARY, ex);</span>
<span class="nc" id="L374">		}</span>
<span class="nc" id="L375">	}</span>

	private void populateFlexTimeSummary(Map theData) 
	{
		try {
<span class="nc bnc" id="L380" title="All 2 branches missed.">			if (ScheduleViewPM.getBooleanFromMap(theData, ScheduleSummaryMH.SHOW_TO_FLEX_TIME_SUMMARY)) {</span>
<span class="nc" id="L381">				FlexTimeSummaryData data = (FlexTimeSummaryData)theData.get(ScheduleSummaryMH.FLEX_TIME_DATA_KEY);</span>
				
<span class="nc bnc" id="L383" title="All 2 branches missed.">				if (data != null) {</span>
<span class="nc" id="L384">					flexTimeSummaryPC.init(data);</span>
<span class="nc" id="L385">					m_containerList.add(flexTimeSummaryPC, false);</span>
				}
			}
		} 
<span class="nc" id="L389">		catch (Exception ex) {</span>
<span class="nc" id="L390">			handlePopulateContainerError(FsWebBundleKey.MSG_SCHED_SUMMARY_NO_ONE_WAY_SS_SUMMARY, ex);</span>
<span class="nc" id="L391">		}</span>
<span class="nc" id="L392">	}</span>
	
	//=========== initialize Shift Bidding container =================
	/**
	 * Populate Shift Bidding Summary PC
	 */
	private void populateShiftBiddingSummary(Map theData) {
		try {
			//--- content
<span class="nc bnc" id="L401" title="All 2 branches missed.">			if (ScheduleViewPM.getBooleanFromMap(theData, ScheduleSummaryMH.SHOW_SB_SUMMARY)) {</span>
<span class="nc" id="L402">				String listName = &quot;shiftBiddingTable&quot;;</span>
<span class="nc" id="L403">				m_SBSummaryPC = createContainerPC(&quot;SBContainer&quot;);</span>
<span class="nc" id="L404">				m_SBSummaryPC.setTitle(i18n(m_bundle, FsWebBundleKey.SCHED_SUMMARY_SB_SUMMARY));</span>

<span class="nc" id="L406">				MultiColListPC theListPC = initContianerAndCreateList(m_context, m_SBSummaryPC);</span>
<span class="nc" id="L407">				theListPC.setName(listName);</span>
<span class="nc" id="L408">				initHeader(theListPC, SB_HEADER_RB_KEYS);</span>

<span class="nc" id="L410">				ShiftBidSummaryData data = (ShiftBidSummaryData)theData.get(ScheduleSummaryMH.SB_SUMMARY_DATA_KEY);</span>
<span class="nc" id="L411">				createSBListModel(theListPC, data);</span>
			}
<span class="nc" id="L413">		} catch (Exception ex) {</span>
<span class="nc" id="L414">			handlePopulateContainerError(FsWebBundleKey.MSG_SCHED_SUMMARY_NO_SB_SUMMARY, ex);</span>
<span class="nc" id="L415">		}</span>
<span class="nc" id="L416">	}</span>

	/**
	 * set Shift Swap Summary List model
	 */
	private void createSBListModel(MultiColListPC theListPC, ShiftBidSummaryData data){
<span class="nc bnc" id="L422" title="All 2 branches missed.">		if (data == null) return;</span>

		// Create the list model
<span class="nc" id="L425">		ArrayList listModel = new ArrayList(1);</span>
<span class="nc" id="L426">		DefaultMultiColumnNodeData row_data = new DefaultMultiColumnNodeData();</span>
<span class="nc" id="L427">		addNumData(data.getAuctions(), row_data);</span>
<span class="nc" id="L428">		addNumData(data.getRequestsTotal(), row_data);</span>
<span class="nc" id="L429">		addNumData(data.getRequestsExpired(), row_data);</span>
<span class="nc" id="L430">		addNumData(data.getRequestsPending(), row_data);</span>
<span class="nc" id="L431">		addNumData(data.getRequestsApproved(), row_data);</span>
<span class="nc" id="L432">		addNumData(data.getRequestsDenied(), row_data);</span>
<span class="nc" id="L433">		addNumData(data.getRequestsInvalid(), row_data);</span>

<span class="nc" id="L435">		listModel.add(row_data);</span>
<span class="nc" id="L436">		theListPC.setListModel(listModel);</span>
<span class="nc" id="L437">	}//createSSListModel</span>

    //=========== initialize Time Banking container =================

    /**
     * Populate Time Banking Summary PC
     */
    private void populateTimeBankingSummary(Map theData) 
    {
        try 
        {
            //--- content
<span class="nc bnc" id="L449" title="All 2 branches missed.">            if (ScheduleViewPM.getBooleanFromMap(theData, ScheduleSummaryMH.SHOW_TB_SUMMARY)) </span>
            {
<span class="nc" id="L451">                TimeBankSummaryData data = (TimeBankSummaryData)theData.get(ScheduleSummaryMH.TB_SUMMARY_DATA_KEY);</span>
<span class="nc bnc" id="L452" title="All 2 branches missed.">                if (data != null)</span>
                {
<span class="nc" id="L454">                    m_TBSummaryPC.init(data);</span>
<span class="nc" id="L455">                    m_containerList.add(m_TBSummaryPC, false);</span>
                }
            }
        } 
<span class="nc" id="L459">        catch (Exception ex) </span>
        {
<span class="nc" id="L461">            handlePopulateContainerError(FsWebBundleKey.MSG_SCHED_SUMMARY_NO_TB_SUMMARY, ex);</span>
<span class="nc" id="L462">        }</span>
<span class="nc" id="L463">    }</span>
    
	//====== Initialize Content Title, Toolbar ===============
	/**
	 * Initialize Content Title
	 */
	@Override
	protected void initContentTitle()
	{
<span class="nc" id="L472">		String employeeName = &quot;&quot;;</span>
		try {			
<span class="nc" id="L474">            ID employeeID = m_context.getUser().getEmployeeID();</span>
<span class="nc" id="L475">			employeeName = ScheduleViewMH.getEmployeeDisplayName(m_context, employeeID, m_localizer);</span>
<span class="nc" id="L476">		} catch (Exception ex) {</span>
<span class="nc" id="L477">			handleUnableToLoadDataError(log, ex);</span>
<span class="nc" id="L478">		} </span>

<span class="nc" id="L480">		m_contentTitlePC.setProperties(i18n(m_bundle, FsWebBundleKey.MYSCHEDULE_SUMMARY_PAGETITLE), employeeName);</span>
<span class="nc" id="L481">	}//initContentTitle</span>

	/**
	 * Initialize Toolbar
	 */
	@Override
	protected void initToolbar()	{
<span class="nc" id="L488">		m_toolbar.addSubmitTextButton(PageAction.REFRESH, i18n(m_bundle, FsWebBundleKey.REFRESH), true);</span>
<span class="nc" id="L489">	}//initToolbar</span>

	//======= Getters/Setters =====================
	/**
	 * Return URL for HTML Form Action
	 */
	@Override
	public String getFormAction() {
<span class="nc" id="L497">		return FORM_ACTION;</span>
	}

	/** Return List of Containers
	 * NOTE: Items in the Collection will be treated either as Page Components or
	 *       just as Objects.
	 */
	public Collection getContainers() {
<span class="nc" id="L505">		return m_containerList;</span>
	}

	//////////////////////////////////////////////////////////////////////////////
	// Helper Methods
	//////////////////////////////////////////////////////////////////////////////
	private final CollapsibleContainerPC createContainerPC(String name) {
<span class="nc" id="L512">		CollapsibleContainerPC containerPC = new CollapsibleContainerPC(m_context);</span>
<span class="nc" id="L513">		containerPC.setName(name);</span>
<span class="nc" id="L514">		m_containerList.add(containerPC);</span>
<span class="nc" id="L515">		return containerPC;</span>
	}

	private void initHeader(MultiColListPC theListPC, String[] rbKeys){
<span class="nc" id="L519">		TableHeaderPC header = theListPC.getHeader();</span>
<span class="nc bnc" id="L520" title="All 2 branches missed.">		for(int i=0; i&lt;rbKeys.length; i++) {</span>
<span class="nc" id="L521">			String label = i18n(m_bundle,rbKeys[i]);</span>
<span class="nc" id="L522">			header.addColumnHeaderData(null, label, CSSUtil.CLASS_INNER_HEADER_BORDER_NUMERIC);</span>
		}
<span class="nc" id="L524">	}</span>
    
	private static final MultiColListPC initContianerAndCreateList(RequestContext context, CollapsibleContainerPC parentPC)
    {
		// List for Display purpose
<span class="nc" id="L529">		MultiColListPC theListPC = new MultiColListPC(context,false) {</span>
			//list is disabled, but we allow to encloseForKeyboardAccess
			protected boolean skipEncloseForKeyboardAccess(BaseNodeData nodeData){
<span class="nc bnc" id="L532" title="All 4 branches missed.">				return !this.isKeyboardAccessible() || !nodeData.isSelectable();</span>
			}
		};
<span class="nc" id="L535">		theListPC.setEnabled(false);</span>
<span class="nc" id="L536">		theListPC.setHasRowHeaders(false); //508</span>
<span class="nc bnc" id="L537" title="All 2 branches missed.">		if(parentPC.isAccessibilityComplianceMode()) {</span>
<span class="nc" id="L538">			theListPC.setWrapperRegion(false);</span>
<span class="nc" id="L539">			theListPC.disableRepeatHeader();</span>
<span class="nc" id="L540">			theListPC.setReadableRowInfoEnabled(true);</span>
<span class="nc" id="L541">			theListPC.setRenderJavaScriptIfDisabled(true);</span>
<span class="nc" id="L542">			theListPC.addTableArrowNavigation();</span>
		}
		// Initialize Container
<span class="nc" id="L545">		parentPC.setStyleClass(CSSUtil.CLASS_BORDER_DEFAULT);</span>
<span class="nc" id="L546">		parentPC.setTemplate(&quot;{0}&quot;);</span>
<span class="nc" id="L547">		parentPC.addComponent(theListPC);</span>

<span class="nc" id="L549">		return theListPC;</span>
	}

	private void handlePopulateContainerError(String rbKey, Exception ex) {
<span class="nc" id="L553">		log.l7dError(rbKey, ex);</span>
<span class="nc" id="L554">		addPageMessage(Message.ERROR_TYPE, rbKey,	FsWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L555">	}</span>

	private void addNumData(int num, DefaultMultiColumnNodeData row_data) {
<span class="nc" id="L558">		row_data.add( m_localizer.formatNumber(num), CSSUtil.STYLE_NUMERIC );</span>
<span class="nc" id="L559">	}</span>
	
	@Override
	public String getCustomJavaScript() {
<span class="nc" id="L563">		StringBuilder js = new StringBuilder(super.getCustomJavaScript());</span>
<span class="nc" id="L564">		js.append(getJSChangeWorkspaceAriaLabel(m_localizer.i18n(UIFWebBundleKey.BUNDLE_NAME, UIFWebBundleKey.WORK_PANE_DESCRIPTION, m_contentTitlePC.getPageTitle(), &quot;&quot;)));</span>
<span class="nc" id="L565">		return js.toString();</span>
	}

}//class ScheduleSummaryPM
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>