<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>TimeOffBidderDAO.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.ejb.rm.setup.timeoffbid.ejb</a> &gt; <span class="el_source">TimeOffBidderDAO.java</span></div><h1>TimeOffBidderDAO.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.ejb.rm.setup.timeoffbid.ejb;

import java.util.Collection;
import java.util.Collections;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.jdmo.Jdmo;
import com.bluepumpkin.common.jdmo.JdmoException;
import com.bluepumpkin.common.jdmo.JdmoRowset;
import com.bluepumpkin.common.jdmo.JdmoConnection;
import com.bluepumpkin.common.logging.Category;
import com.bluepumpkin.ejb.bbm.base.BbmFinderException;
import com.bluepumpkin.ejb.bbm.dao.DAOBase;
import com.bluepumpkin.ejb.bbm.vo.FieldInfo;
import com.bluepumpkin.ejb.rm.Log;
import com.bluepumpkin.ejb.rm.setup.timeoffbid.model.TimeOffBidder;
import com.bluepumpkin.ejb.rm.setup.timeoffbid.model.TimeOffBidderFieldInfo;
import com.bluepumpkin.ejb.rm.util.DAOUtil;
import com.bluepumpkin.ejb.rm.util.RmDAOBase;

/**
 * DAO class for TimeOffBidderDAO
 */
public class TimeOffBidderDAO extends RmDAOBase&lt;TimeOffBidder&gt; {

<span class="nc" id="L26">	private static FieldInfo fieldInfo = new TimeOffBidderFieldInfo();</span>
<span class="nc" id="L27">	private static Category LOG = Log.initCategory(TimeOffBidder.class.getName());</span>

	/**
	 * Constructor
	 */
	public TimeOffBidderDAO() {
<span class="nc" id="L33">		super();</span>
<span class="nc" id="L34">	}</span>

	/**
	 * Constructor
	 * 
	 * @param - Jdmo - Jdmo object instance
	 * @see Jdmo.
	 */
	public TimeOffBidderDAO(Jdmo dmo) {
<span class="nc" id="L43">		super(dmo);</span>
<span class="nc" id="L44">	}</span>

	@Override
	protected FieldInfo getFieldInfo() {
<span class="nc" id="L48">		return fieldInfo;</span>
	}

	protected Category getCategory() {
<span class="nc" id="L52">		return LOG;</span>
	}

	/**
	 * Creates the value object.
	 * 
	 * @return - returns new Value object
	 * @see com.bluepumpkin.ejb.bbm.vo.ValueObjectBase
	 * @see com.bluepumpkin.ejb.rm.setup.timeoffbid.model.TimeOffBid
	 */
	@Override
	protected TimeOffBidder createValueObject() {
<span class="nc" id="L64">		return new TimeOffBidder();</span>
	}

	/**
	 * Get Time Off Bidders for a bidder
	 * 
	 * @param timeOffBidId
	 * @return Collection&lt;TimeOffBidder&gt;
	 */
	public Collection &lt;TimeOffBidder&gt; getTimeOffBiddersInBid(ID timeOffBidId) throws BbmFinderException {
<span class="nc bnc" id="L74" title="All 2 branches missed.">		if (timeOffBidId == null) {</span>
<span class="nc" id="L75">			return Collections.emptyList();</span>
		}
<span class="nc" id="L77">		StringBuffer sqlWhere = new StringBuffer(&quot; A.TIMEOFFBIDID = ?&quot;);</span>
<span class="nc" id="L78">		return getObjectsWhere(sqlWhere, timeOffBidId);</span>
	}

	/**
	 * Returns a collection of Bidders by Bid ID and Employee IDs
	 * 
	 * @param bid ID of Bid
	 * @param bidders Collection of Employee IDs
	 * @return
	 */
	public Collection &lt;TimeOffBidder&gt; getTimeOffBidderByBidIDandEmployeeIDs(ID bid, Collection&lt;ID&gt; bidders) throws Exception {
		StringBuffer strSQL;

		// Check if bidders Collection is empty
<span class="nc bnc" id="L92" title="All 4 branches missed.">		if (bidders == null || bidders.isEmpty()) {</span>
<span class="nc" id="L93">			return Collections.emptyList();</span>
		}

		try {
<span class="nc" id="L97">			strSQL = new StringBuffer(&quot; A.TIMEOFFBIDID = ? AND A.EMPLOYEEID in ?&quot;);</span>
<span class="nc" id="L98">			return getObjectsWhere(strSQL, bid, bidders);</span>
<span class="nc" id="L99">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L100">			throw e;</span>
		}
	}

	/**
	 * Returns whether the users belong to other Bids during the bid in question open period.
	 * 
	 * @param bids Bids that intersect with the current bid
	 * @param bidders Employees to check if they belong to bids in the parameter bids
	 * @return true if employees belong to other bids that are currently open
	 * @throws BbmFinderException Thrown if JDMO exceptions.
	 */
	public Collection &lt;TimeOffBidder&gt; checkforEmployeesInBids(Collection&lt;ID&gt; bids, Collection&lt;ID&gt; bidders) throws BbmFinderException {
<span class="nc" id="L113">		StringBuffer sqlStr = </span>
			new StringBuffer(&quot;Select A.ID, A.TIMEOFFBIDID, A.EMPLOYEEID, A.STATUS, A.PERIODUNIT, A.MAXNUMOFPERIODS FROM TIMEOFFBIDDER A&quot;
					         + &quot; WHERE A.TIMEOFFBIDID in ? and A.EMPLOYEEID in ?&quot;);

		// Check if bidders Collection is empty
<span class="nc bnc" id="L118" title="All 4 branches missed.">		if (bids == null || bids.isEmpty()) {</span>
<span class="nc" id="L119">			return Collections.emptyList();</span>
		}

		// Check if bidders Collection is empty
<span class="nc bnc" id="L123" title="All 4 branches missed.">		if (bidders == null || bidders.isEmpty()) {</span>
<span class="nc" id="L124">			return Collections.emptyList();</span>
		}

<span class="nc" id="L127">		return getObjectsWithFullSqlQueryStr(sqlStr, bids, bidders);</span>
	}

	/**
	 * Updates a Bidder's Max Approved Period and the Period Unit (0 - weeks or 1 - days) 
	 * 
	 * @param lastName Last Name of person to match to the Bid
	 * @param firstName First Name of person to match to the Bid
	 * @param bidID ID of the Bid to update time off allocations
	 * @param maxPeriod Maximum Period to assign to Bidder
	 * @param periodUnits Period Units to assign to Bidder (0 - weeks or 1 - days)
	 * @return
	 */
	public boolean updateBiddersApproveTimeAndUnits(String lastName, String firstName, int bidID, int maxPeriod, int periodUnits) throws BbmFinderException {
<span class="nc" id="L141">		final int found = 1;</span>
<span class="nc" id="L142">		int rowsUpdated = 0;</span>

<span class="nc" id="L144">		StringBuffer sql = new StringBuffer(&quot;UPDATE TIMEOFFBIDDER SET MAXNUMOFPERIODS = ?, PERIODUNIT = ? FROM TIMEOFFBIDDER A&quot;</span>
                                             + &quot; INNER JOIN TIMEOFFBID B on B.ID = A.TIMEOFFBIDID AND B.ID = ?&quot; 
                                             + &quot; INNER JOIN EMPLOYEEAM C on C.ID = A.EMPLOYEEID&quot;
                                             + &quot; INNER JOIN PERSON D on D.ID = C.PERSONID AND (D.LASTNAME = ? AND D.FIRSTNAME = ?)&quot;);
		
<span class="nc" id="L149">		rowsUpdated = executeSql(m_dmo, sql, maxPeriod, periodUnits, bidID, lastName, firstName);</span>
<span class="nc bnc" id="L150" title="All 2 branches missed.">		return rowsUpdated == found;</span>
	}

	/**
	 * Returns available and assigned Time Off Biddders for given Bid.
	 * 
	 * @param bid ID of Bid
	 * @return
	 */
	public Collection &lt;TimeOffBidder&gt; getTimeOffBiddersForBidByBidID(ID bid, Collection&lt;ID&gt; orgIDs, int sortColumn, int sortDirection) throws BbmFinderException {
<span class="nc" id="L160">		StringBuffer strSQL = buildQueryStatement(sortColumn, sortDirection);</span>
<span class="nc" id="L161">		return getObjectsWithFullSqlQueryStr(strSQL, bid, bid, orgIDs);</span>
	}

	/**
	 * Returns Time Off Bids for given organizations.
	 * 
	 * @param bid ID of Bid
	 * @return
	 */
	public Collection &lt;TimeOffBidder&gt; getWaitingTimeOffBiddersForBidByBidID(ID bid, Collection&lt;ID&gt; orgIDs) throws BbmFinderException {
<span class="nc" id="L171">		StringBuffer strSQL = buildWaitingBiddersQueryStatement();</span>
<span class="nc" id="L172">		return getObjectsWithFullSqlQueryStr(strSQL, bid, orgIDs);</span>
	}

	/**
	 * Returns Bidders that are not assigned to a Bid.
	 * 
	 * @param employeeIDs List of employees to return as bidders
	 * @return
	 */
	public Collection &lt;TimeOffBidder&gt; getWaitingTimeOffBiddersForBidIDAndEmployeeIDs(ID bid, Collection&lt;ID&gt; employeeIDs, Collection&lt;ID&gt; orgIDs) throws BbmFinderException {
		StringBuffer strSQL;

		// Check if Employee ID Collection is empty
<span class="nc bnc" id="L185" title="All 4 branches missed.">		if (employeeIDs == null || employeeIDs.isEmpty()) {</span>
<span class="nc" id="L186">			return Collections.emptyList();</span>
		}

		// Check if Organization ID Collection is empty
<span class="nc bnc" id="L190" title="All 4 branches missed.">		if (orgIDs == null || orgIDs.isEmpty()) {</span>
<span class="nc" id="L191">			return Collections.emptyList();</span>
		}

<span class="nc" id="L194">		strSQL = buildWaitingEmployeeIDsQueryStatement();</span>
<span class="nc" id="L195">		return getObjectsWithFullSqlQueryStr(strSQL, bid, orgIDs, employeeIDs);</span>
	}

	/**
	 * Returns Bidders base on the Bid ID and ID of the Bidders
	 * 
	 * @param bid ID of Bid
	 * @param bidders List of employees
	 * @return
	 * @throws BbmFinderException
	 */
	public Collection &lt;TimeOffBidder&gt; getNextTimeOffBiddersForBidIDAndEmployeeIDs(ID bid, Collection&lt;ID&gt; bidders, Collection&lt;ID&gt; orgIDs, 
			                                                                     int sortColumn, int sortDirection) throws BbmFinderException {
		StringBuffer strSQL;

		// Check if Bidders Collection is empty
<span class="nc bnc" id="L211" title="All 4 branches missed.">		if (bidders == null || bidders.isEmpty()) {</span>
<span class="nc" id="L212">			return Collections.emptyList();</span>
		}

		// Check if Organization ID Collection is empty
<span class="nc bnc" id="L216" title="All 4 branches missed.">		if (orgIDs == null || orgIDs.isEmpty()) {</span>
<span class="nc" id="L217">			return Collections.emptyList();</span>
		}

<span class="nc" id="L220">		strSQL = buildNextBiddersQueryStatement(sortColumn, sortDirection);</span>
<span class="nc" id="L221">		return getObjectsWithFullSqlQueryStr(strSQL, bid, bid, orgIDs, bidders);</span>
	}

	/**
	 * Returns Bidders base on the Bid ID and ID of the Bidders
	 * 
	 * @param bid ID of Bid
	 * @param bidders List of employees
	 * @return
	 * @throws BbmFinderException
	 */
	public Collection &lt;TimeOffBidder&gt; getTimeOffBiddersForBidByBidIDandEmployeeIDs(ID bid, Collection&lt;ID&gt; employeeIDs, Collection&lt;ID&gt; orgIDs,
			                                                                      int sortColumn, int sortDirection) throws BbmFinderException {
		StringBuffer strSQL;

		// Check if Employee IDs Collection is empty
<span class="nc bnc" id="L237" title="All 4 branches missed.">		if (employeeIDs == null || employeeIDs.isEmpty()) {</span>
<span class="nc" id="L238">			return Collections.emptyList();</span>
		}

		// Check if Organization ID Collection is empty
<span class="nc bnc" id="L242" title="All 4 branches missed.">		if (orgIDs == null || orgIDs.isEmpty()) {</span>
<span class="nc" id="L243">			return Collections.emptyList();</span>
		}

<span class="nc" id="L246">		strSQL = buildBidderbyBidAndEmployeeIDQueryStatement(sortColumn, sortDirection);</span>
<span class="nc" id="L247">		return getObjectsWithFullSqlQueryStr(strSQL, bid, bid, orgIDs, employeeIDs);</span>
	}

	/**
	 * Returns the Query SQL Statement to retrieve Bidders
	 * 
	 * @param sortColumn Int that represents the column to sort by.
	 * @param sortDirection Direction to ASC or DESC (0 - Ascending, 1 - Descending)
	 * @return SQL Query string
	 * @throws BbmFinderException
	 */
	protected StringBuffer buildQueryStatement(int sortColumn, int sortDirection) throws BbmFinderException {
<span class="nc" id="L259">		StringBuffer sqlWkRSOrg = new StringBuffer(&quot; and D.ORGANIZATIONID in ?&quot;);</span>
<span class="nc" id="L260">		StringBuffer strSQL = buildBaseQueryStatement();</span>
<span class="nc" id="L261">		strSQL.append(sqlWkRSOrg);</span>
<span class="nc" id="L262">		strSQL.append(buildOrderByInnerJoins(sortColumn));</span>
<span class="nc" id="L263">		strSQL.append(buildOrderByClause(sortColumn, sortDirection));</span>
<span class="nc" id="L264">		return strSQL;</span>
	}

	/**
	 * Returns the Query SQL Statement to retrieve Bidders
	 * 
	 * @return SQL Query string
	 * @throws BbmFinderException
	 */
	protected StringBuffer buildWaitingBiddersQueryStatement() throws BbmFinderException {
<span class="nc" id="L274">		StringBuffer sqlWkRSOrg = new StringBuffer(&quot; and D.ORGANIZATIONID in ?&quot;);</span>
<span class="nc" id="L275">		StringBuffer strSQL = buildWaitingBaseQueryStatement();</span>
<span class="nc" id="L276">		strSQL.append(sqlWkRSOrg);</span>
<span class="nc" id="L277">		return strSQL;</span>
	}

	/**
	 * Returns the Query SQL Statement to retrieve Bidders
	 * 
	 * @param sortColumn Int that represents the column to sort by.
	 * @param sortDirection Direction to ASC or DESC (0 - Ascending, 1 - Descending)
	 * @return SQL Query string
	 * @throws BbmFinderException
	 */
	protected StringBuffer buildNextBiddersQueryStatement(int sortColumn, int sortDirection) throws BbmFinderException {
<span class="nc" id="L289">		StringBuffer sqlWkRSOrg = new StringBuffer(&quot; and D.ORGANIZATIONID in ?&quot;);</span>
<span class="nc" id="L290">		StringBuffer sqlWhere = new StringBuffer(&quot; WHERE B.ID in ?&quot;);</span>
<span class="nc" id="L291">		StringBuffer strSQL = buildBaseQueryStatement();</span>
<span class="nc" id="L292">		strSQL.append(sqlWkRSOrg);</span>
<span class="nc" id="L293">		strSQL.append(buildOrderByInnerJoins(sortColumn));</span>
<span class="nc" id="L294">		strSQL.append(sqlWhere);</span>
<span class="nc" id="L295">		strSQL.append(buildOrderByClause(sortColumn, sortDirection));</span>
<span class="nc" id="L296">		return strSQL;</span>
	}

	/**
	 * Returns the Query SQL Statement to retrieve Bidders
	 * 
	 * @param sortColumn Int that represents the column to sort by.
	 * @param sortDirection Direction to ASC or DESC (0 - Ascending, 1 - Descending)
	 * @return SQL Query string
	 * @throws BbmFinderException
	 */
	protected StringBuffer buildBidderbyBidAndEmployeeIDQueryStatement(int sortColumn, int sortDirection) throws BbmFinderException {
<span class="nc" id="L308">		StringBuffer sqlWkRSOrg = new StringBuffer(&quot; and D.ORGANIZATIONID in ?&quot;);</span>
<span class="nc" id="L309">		StringBuffer sqlWhere = new StringBuffer(&quot; WHERE B.ID in ?&quot;);</span>
<span class="nc" id="L310">		StringBuffer strSQL = buildBaseQueryStatement();</span>
<span class="nc" id="L311">		strSQL.append(sqlWkRSOrg);</span>
<span class="nc" id="L312">		strSQL.append(buildOrderByInnerJoins(sortColumn));</span>
<span class="nc" id="L313">		strSQL.append(sqlWhere);</span>
<span class="nc" id="L314">		strSQL.append(buildOrderByClause(sortColumn, sortDirection));</span>
<span class="nc" id="L315">		return strSQL;</span>
	}

	/**
	 * Returns the Query SQL Statement to retrieve Bidders
	 * 
	 * @return SQL Query string
	 * @throws BbmFinderException
	 */
	protected StringBuffer buildWaitingEmployeeIDsQueryStatement() throws BbmFinderException {
<span class="nc" id="L325">		StringBuffer sqlWkRSOrg = new StringBuffer(&quot; and D.ORGANIZATIONID in ?&quot;);</span>
<span class="nc" id="L326">		StringBuffer sqlWhere = new StringBuffer(&quot; WHERE B.ID in ?&quot;);</span>
<span class="nc" id="L327">		StringBuffer strSQL = buildWaitingBaseQueryStatement();</span>
<span class="nc" id="L328">		strSQL.append(sqlWkRSOrg);</span>
<span class="nc" id="L329">		strSQL.append(sqlWhere);</span>
<span class="nc" id="L330">		return strSQL;</span>
	}

	/**
	 * Returns the base Query SQL Statement to retrieve Bidders
	 * 
	 * @return SQL Query string
	 */
	protected StringBuffer buildBaseQueryStatement() {
<span class="nc" id="L339">		int nCount = m_fieldInfo.getFieldCount();</span>
<span class="nc" id="L340">		String sqlWith = &quot;;With EmployeeRequest as (SELECT NBRREQUEST=count(DISTINCT R.ID),R.EMPLOYEEID from REQUEST R&quot; </span>
			+ &quot; INNER JOIN TIMEOFFREQUEST TR on TR.ID=R.ID INNER JOIN TIMEOFFREQUESTCHOICE TRC on TRC.TIMEOFFREQUESTID=TR.ID&quot; 
			+ &quot; INNER JOIN ACTIVITY ACT on ACT.ID=TR.ActivityID INNER JOIN TIMEOFFBIDACTIVITY TBA on TBA.ACTIVITYID=ACT.ID&quot; 
			+ &quot; INNER JOIN TIMEOFFBID TB on TB.ID= TBA.TIMEOFFBIDID INNER JOIN TIMEOFFBIDDER TBD on TB.ID = TBD.TIMEOFFBIDID&quot; 
			+ &quot; INNER JOIN WORKRESOURCEORGANIZATION WR on R.EMPLOYEEID= WR.WORKRESOURCEID&quot; 
			+ &quot; AND R.EMPLOYEEID = TBD.EMPLOYEEID WHERE R.REQUESTTYPE='time-off'&quot; 
			+ &quot; AND TB.BIDSTARTTIME&lt;=R.SUBMITTEDON and R.SUBMITTEDON&lt;=TB.BIDENDTIME&quot; 
			+ &quot; AND TB.REQUESTSTARTTIME&lt;=TRC.STARTTIME and TRC.ENDTIME&lt;=TB.REQUESTENDTIME&quot; 
			+ &quot; AND (WR.STARTTIME&lt;TB.BIDENDTIME AND Isnull(WR.ENDTIME,'20700101')&gt;TB.BIDSTARTTIME)&quot;
			+ &quot; AND TB.ID = ? Group by R.Employeeid)&quot;;
<span class="nc" id="L350">		String sqlRightJoin = &quot;RIGHT OUTER JOIN EMPLOYEEAM B on A.EMPLOYEEID = B.ID and A.TIMEOFFBIDID = ?&quot;;</span>
<span class="nc" id="L351">		String sqlLeftJoin = &quot; LEFT OUTER JOIN EmployeeRequest ER on er.EMPLOYEEID=B.ID&quot;;</span>
<span class="nc" id="L352">		String sqlWRInnerJoin = &quot; INNER JOIN WORKRESOURCE C on C.ID = B.ID&quot; + &quot; and (B.STARTTIME &lt; GETUTCDATE() and IsNULL(B.ENDTIME, '20700101')&gt;GETUTCDATE())&quot;;</span>
<span class="nc" id="L353">		String sqlWROInnerJoin = &quot; INNER JOIN WORKRESOURCEORGANIZATION D on D.WORKRESOURCEID = C.ID&quot; + &quot; and (D.STARTTIME &lt; GETUTCDATE() and IsNULL(D.ENDTIME, '20700101')&gt;GETUTCDATE())&quot;;</span>
<span class="nc" id="L354">		String employeeID = &quot;EMPLOYEEID&quot;;</span>
<span class="nc" id="L355">		String status = &quot;STATUS&quot;;</span>
<span class="nc" id="L356">		String statusERNBRREQUEST = &quot;STATUS=CASE WHEN ER.NBRREQUEST IS NULL THEN CASE WHEN A.TIMEOFFBIDID IS NULL THEN -1 ELSE 0 END ELSE ER.NBRREQUEST END&quot;;</span>
<span class="nc" id="L357">		String from = &quot; FROM &quot;;</span>
<span class="nc" id="L358">		String tableAALIAS = &quot; A &quot;;</span>
<span class="nc" id="L359">		String select = &quot; SELECT &quot;;</span>
<span class="nc" id="L360">		String delem = &quot;,&quot;;</span>
<span class="nc" id="L361">		String employeeDotID = &quot;B.ID as &quot;;</span>
<span class="nc" id="L362">		String tableAAliasDOT = &quot;A.&quot;;</span>
<span class="nc" id="L363">		StringBuffer strSQL = new StringBuffer(100 * nCount);</span>

<span class="nc" id="L365">		strSQL.append(sqlWith);</span>
<span class="nc" id="L366">		strSQL.append(select);</span>
<span class="nc bnc" id="L367" title="All 2 branches missed.">		for (int i = 0; i &lt; nCount; i++) {</span>
<span class="nc bnc" id="L368" title="All 2 branches missed.">			if (i != 0) {</span>
<span class="nc" id="L369">				strSQL.append(delem);</span>
			}

<span class="nc bnc" id="L372" title="All 2 branches missed.">			if (m_fieldInfo.getFieldName(i).equals(employeeID)) {</span>
<span class="nc" id="L373">				strSQL.append(employeeDotID).append(employeeID);</span>
<span class="nc bnc" id="L374" title="All 2 branches missed.">			} else if (m_fieldInfo.getFieldName(i).equals(status)) {</span>
<span class="nc" id="L375">				strSQL.append(statusERNBRREQUEST);</span>
			} else {
<span class="nc" id="L377">				strSQL.append(tableAAliasDOT).append(m_fieldInfo.getFieldName(i));</span>
			}
		}

<span class="nc" id="L381">		strSQL.append(from).append(m_fieldInfo.getTableName()).append(tableAALIAS);</span>
<span class="nc" id="L382">		strSQL.append(sqlRightJoin);</span>
<span class="nc" id="L383">		strSQL.append(sqlLeftJoin);</span>
<span class="nc" id="L384">		strSQL.append(sqlWRInnerJoin);</span>
<span class="nc" id="L385">		strSQL.append(sqlWROInnerJoin);</span>
<span class="nc" id="L386">		return strSQL;</span>
	}

	/**
	 * Returns the base Query SQL Statement to retrieve Waiting Bidders
	 * 
	 * @return SQL Query string
	 */
	protected StringBuffer buildWaitingBaseQueryStatement() {
<span class="nc" id="L395">		int nCount = m_fieldInfo.getFieldCount();</span>
<span class="nc" id="L396">		String sqlLeftJoin = &quot;RIGHT OUTER JOIN EMPLOYEEAM B on A.EMPLOYEEID = B.ID and A.TIMEOFFBIDID = ?&quot;;</span>
<span class="nc" id="L397">		String sqlWRInnerJoin = &quot; INNER JOIN WORKRESOURCE C on C.ID = B.ID&quot; + &quot; and (B.STARTTIME &lt; GETUTCDATE() and IsNULL(B.ENDTIME, '20700101')&gt;GETUTCDATE())&quot;;</span>
<span class="nc" id="L398">		String sqlWROInnerJoin = &quot; INNER JOIN WORKRESOURCEORGANIZATION D on D.WORKRESOURCEID = C.ID&quot; + &quot; and (D.STARTTIME &lt; GETUTCDATE() and IsNULL(D.ENDTIME, '20700101')&gt;GETUTCDATE())&quot;;</span>
<span class="nc" id="L399">		String employeeID = &quot;EMPLOYEEID&quot;;</span>
<span class="nc" id="L400">		String from = &quot; FROM &quot;;</span>
<span class="nc" id="L401">		String tableAALIAS = &quot; A &quot;;</span>
<span class="nc" id="L402">		String select = &quot;SELECT &quot;;</span>
<span class="nc" id="L403">		String delem = &quot;,&quot;;</span>
<span class="nc" id="L404">		String employeeDotID = &quot;B.ID as &quot;;</span>
<span class="nc" id="L405">		String tableAAliasDOT = &quot;A.&quot;;</span>
<span class="nc" id="L406">		StringBuffer strSQL = new StringBuffer(50 * nCount);</span>

<span class="nc" id="L408">		strSQL.append(select);</span>
<span class="nc bnc" id="L409" title="All 2 branches missed.">		for (int i = 0; i &lt; nCount; i++) {</span>
<span class="nc bnc" id="L410" title="All 2 branches missed.">			if (i != 0) {</span>
<span class="nc" id="L411">				strSQL.append(delem);</span>
			}

<span class="nc bnc" id="L414" title="All 2 branches missed.">			if (m_fieldInfo.getFieldName(i).equals(employeeID)) {</span>
<span class="nc" id="L415">				strSQL.append(employeeDotID).append(employeeID);</span>
			} else {
<span class="nc" id="L417">				strSQL.append(tableAAliasDOT).append(m_fieldInfo.getFieldName(i));</span>
			}
		}

<span class="nc" id="L421">		strSQL.append(from).append(m_fieldInfo.getTableName()).append(tableAALIAS);</span>
<span class="nc" id="L422">		strSQL.append(sqlLeftJoin);</span>
<span class="nc" id="L423">		strSQL.append(sqlWRInnerJoin);</span>
<span class="nc" id="L424">		strSQL.append(sqlWROInnerJoin);</span>
<span class="nc" id="L425">		return strSQL;</span>
	}

	/**
	 * Creates the Order By Clause base on the column and sort direction
	 * 
	 * @param sortColumn int representing the column to sort by
	 * @param sortDirection in representing the direction to sort by (0 - Ascending, 1 - Descending)
	 * @return order by clause as a StringBuffer.
	 */
	protected StringBuffer buildOrderByClause(int sortColumn, int sortDirection) {
<span class="nc" id="L436">		StringBuffer orderBy = new StringBuffer();</span>

<span class="nc" id="L438">		orderBy.append(&quot; ORDER BY &quot;);</span>

<span class="nc bnc" id="L440" title="All 5 branches missed.">		switch (sortColumn) {</span>
		case TimeOffBidder.SORTBY_RANK:
<span class="nc" id="L442">			orderBy.append(&quot;E.RANK&quot;).append(DAOUtil.getSortDirection(sortDirection));</span>
<span class="nc" id="L443">			break;</span>
		case TimeOffBidder.SORTBY_SENIORITY:
<span class="nc" id="L445">			orderBy.append(&quot;B.STARTTIME&quot;).append(DAOUtil.getSortDirection(sortDirection));</span>
<span class="nc" id="L446">			break;</span>
		case TimeOffBidder.SORTBY_STATUS:
<span class="nc" id="L448">			orderBy.append(&quot;Status&quot;).append(DAOUtil.getSortDirection(sortDirection));</span>
<span class="nc" id="L449">			break;</span>
		case TimeOffBidder.SORTBY_MAXNUMBEROFPERIODS:
<span class="nc" id="L451">			orderBy.append(&quot;A.PERIODUNIT&quot;).append(DAOUtil.getSortDirection(sortDirection));</span>
<span class="nc" id="L452">			orderBy.append(&quot;,A.MAXNUMOFPERIODS&quot;).append(DAOUtil.getSortDirection(sortDirection));</span>
<span class="nc" id="L453">			break;</span>
		default:
<span class="nc" id="L455">			orderBy.append(&quot;F.LASTNAME&quot;).append(DAOUtil.getSortDirection(sortDirection));</span>
<span class="nc" id="L456">			orderBy.append(&quot;,F.FIRSTNAME&quot;).append(DAOUtil.getSortDirection(sortDirection));</span>
<span class="nc" id="L457">			orderBy.append(&quot;,F.MIDDLEINITIAL&quot;).append(DAOUtil.getSortDirection(sortDirection));</span>
			break;
		}
<span class="nc" id="L460">		return orderBy;</span>
	}

	/**
	 * Adds the sql need to sort depending on the column selected.
	 * 
	 * @param sortColumn int representing the column to sort by
	 * @return addition sql needed for sorting.
	 */
	protected StringBuffer buildOrderByInnerJoins(int sortColumn) {
<span class="nc" id="L470">		StringBuffer orderByTables = new StringBuffer();</span>

<span class="nc bnc" id="L472" title="All 5 branches missed.">		switch (sortColumn) {</span>
		case TimeOffBidder.SORTBY_RANK:
<span class="nc" id="L474">			orderByTables.append(&quot; INNER JOIN EMPLOYEERANK E on E.EMPLOYEEID = B.ID and (E.STARTTIME &lt; GETUTCDATE() and IsNULL(E.ENDTIME, '20700101')&gt;GETUTCDATE())&quot;);</span>
<span class="nc" id="L475">			break;</span>
		case TimeOffBidder.SORTBY_SENIORITY:
<span class="nc" id="L477">			break;</span>
		case TimeOffBidder.SORTBY_STATUS:
<span class="nc" id="L479">			break;</span>
		case TimeOffBidder.SORTBY_MAXNUMBEROFPERIODS:
<span class="nc" id="L481">			break;</span>
		default:
<span class="nc" id="L483">			orderByTables.append(&quot; INNER JOIN PERSON F on F.ID = B.PERSONID&quot;);</span>
			break;
		}
<span class="nc" id="L486">		return orderByTables;</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>