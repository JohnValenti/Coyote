<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>BaseBidOptionsPM.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.rm.auction</a> &gt; <span class="el_source">BaseBidOptionsPM.java</span></div><h1>BaseBidOptionsPM.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.rm.auction;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.Calendar;
import java.util.Collection;
import java.util.Collections;
import java.util.Date;
import java.util.HashMap;
import java.util.HashSet;
import java.util.List;
import java.util.Locale;
import java.util.Map;
import java.util.ResourceBundle;
import java.util.Set;
import java.util.TimeZone;

import javax.servlet.http.HttpServletRequest;

import com.bluepumpkin.common.datatypes.CalendarRange;
import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.Pair;
import com.bluepumpkin.common.datatypes.TimeRange;
import com.bluepumpkin.common.l10n.RegionalFormatBundleKey;
import com.bluepumpkin.common.localization.Localizer;
import com.bluepumpkin.common.util.StringUtil;
import com.bluepumpkin.ejb.bbm.cache.threadlocal.ThreadLocalForCacheManagerHelper;
import com.bluepumpkin.ejb.bbm.campaign.model.SchedulingPeriod;
import com.bluepumpkin.ejb.bbm.schedule.model.ShiftAssignment;
import com.bluepumpkin.ejb.bbm.skill.model.SkillAssignment;
import com.bluepumpkin.ejb.bbm.workresource.model.EmployeeName;
import com.bluepumpkin.ejb.core.base.SupportNavigation;
import com.bluepumpkin.ejb.rm.requests.shiftbid.shiftbidauction.ejb.BiddableSchedulesForAuctionParameter;
import com.bluepumpkin.ejb.rm.requests.shiftbid.shiftbidauction.filtersortbidoptions.RmFilterChain;
import com.bluepumpkin.ejb.rm.requests.shiftbid.shiftbidauction.model.ShiftBidAuction;
import com.bluepumpkin.ejb.rm.requests.shiftbid.shiftbidrequest.model.BidOptionRow;
import com.bluepumpkin.ejb.rm.requests.shiftbid.shiftbidrequest.model.BiddableSchedule;
import com.bluepumpkin.ejb.rm.requests.shiftbid.shiftbidrequest.model.ShiftBidRequest;
import com.bluepumpkin.ejb.rm.requests.shiftbid.shiftbidrequest.model.ShiftBidder;
import com.bluepumpkin.ejb.rm.requests.shiftbid.shiftbidrequest.model.UnsubmittedShiftBidPreference;
import com.bluepumpkin.ejb.rm.setup.settings.model.OrganizationSetting;
import com.bluepumpkin.ejb.rm.util.LicenseUtil;
import com.bluepumpkin.ejb.rm.util.RmUtil;
import com.bluepumpkin.ejb.rm.util.ShiftBidAuctionUtil;
import com.bluepumpkin.web.bbm.campaign.CampaignModelHandler;
import com.bluepumpkin.web.bbm.l10n.BbmWebBundleKey;
import com.bluepumpkin.web.bbm.organization.OrganizationModelHandler;
import com.bluepumpkin.web.bbm.skill.SkillModelHandler;
import com.bluepumpkin.web.rm.auction.filter.BidOptionsFilter;
import com.bluepumpkin.web.rm.auction.filter.BidOptionsFilterPC;
import com.bluepumpkin.web.rm.auction.filter.BidOptionsFilterUtil;
import com.bluepumpkin.web.rm.keys.RmJavaScriptFileID;
import com.bluepumpkin.web.rm.keys.RmKeys;
import com.bluepumpkin.web.rm.keys.RmPageAction;
import com.bluepumpkin.web.rm.l10n.RmWebBundleKey;
import com.bluepumpkin.web.rm.setup.settings.SettingsModelHandler;
import com.bluepumpkin.web.rm.util.JSMediatorVariableHelper;
import com.google.gson.Gson;
import com.witness.ejb.core.security.model.User;
import com.witness.web.uif.base.Message;
import com.witness.web.uif.data.wrapper.BasicWrapper;
import com.witness.web.uif.data.wrapper.NumberWrapper;
import com.witness.web.uif.keys.ImageFileID;
import com.witness.web.uif.keys.JavaScriptFileID;
import com.witness.web.uif.l10n.UIFWebBundleKey;
import com.witness.web.uif.pagecomponent.DefaultMultiColumnNodeData;
import com.witness.web.uif.pagecomponent.contenttitle.ContentTitlePC;
import com.witness.web.uif.pagecomponent.dialog.DialogToolbarMenuPC;
import com.witness.web.uif.pagecomponent.form.FormInputPC;
import com.witness.web.uif.pagecomponent.list.MultiColListPC;
import com.witness.web.uif.pagecomponent.table.GenericHeaderData;
import com.witness.web.uif.pagecomponent.table.TableHeaderPC;
import com.witness.web.uif.pagemodel.WorkpaneListPM;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.util.HtmlUtil;
import com.witness.web.uif.util.html.CSSUtil;
import com.witness.web.uif.util.html.HtmlLinkUtil;
import com.witness.web.uif.util.js.JSUtil;

/**
 * Title:        BaseBidOptionsPM
 * Description:  Abstract base class for Bid Options Page Model
 * Copyright:    Copyright (c) 2003
 * Company:      Blue Pumpkin Software, Inc
 * @author       David Su, DSu
 * @version      1.0
 *
 * Created on Jun 30, 2003, 5:46:40 PM
 */
public abstract class BaseBidOptionsPM extends WorkpaneListPM implements AuctionPM {
	protected static final String BIDDER_ID_FN = &quot;bidderID&quot;;
	protected static final String PREFERENCE_PREFIX_FN = &quot;preferenceEditPF&quot;;
	protected static final String IS_SUBMITTED_PREFERENCE_PREFIX_FN = &quot;isSubmittedPrefrence&quot;;

	
	protected transient ResourceBundle m_bundle;
	protected transient ResourceBundle m_bbm_bundle;
<span class="nc" id="L98">	protected boolean m_isPageEnabled = true;</span>
<span class="nc" id="L99">	protected boolean m_isAuctionClosed = false;</span>
<span class="nc" id="L100">	protected boolean hasRMAdvanceLicense = false;</span>
<span class="nc" id="L101">	protected transient Collection&lt;BidOptionRow&gt; m_listData = Collections.emptyList();</span>
	protected ShiftBidAuction m_auction;
	protected SchedulingPeriod m_schedPeriod;
	protected TimeZone m_tz;
	protected TimeZone m_campaignTz;
	protected ID m_bidderID;
	protected ID m_empID;
	protected BidOptionsFilterPC m_filterPC;

	protected DialogToolbarMenuPC m_sortByMenuPC;
	public static final String SORT_DIALOG_PC = &quot;SORT_DIALOG_PC&quot;;

	//Sort Type constants for the Shift columns
	public static final String SORT_BY_START_ACTION = &quot;sortByStart&quot;;
	public static final String SORT_BY_END_ACTION = &quot;sortByEnd&quot;;
	public static final String SORT_BY_LENGTH_ACTION = &quot;sortByLength&quot;;

	//SORT_BY_START_ACTION or SORT_BY_END_ACTION or SORT_BY_LENGTH_ACTION
<span class="nc" id="L119">	protected String m_sortType = &quot;&quot;;</span>

	//Sort criteria for the secondary sort
	public static final String SORT_COLUMN2_HIDDEN = &quot;sortColumn2&quot;;
	public static final String SORT_ORDER2_HIDDEN = &quot;sortOrder2&quot;;
	public static final String SORT_TYPE2_HIDDEN = &quot;sortType2&quot;;

	//column number
<span class="nc" id="L127">	protected String m_sortColumn2 = &quot;&quot;;</span>
	//&quot;ascending&quot; or &quot;descending&quot;
<span class="nc" id="L129">	protected String m_sortOrder2 = &quot;&quot;;</span>
	//SORT_BY_START_ACTION or SORT_BY_END_ACTION or SORT_BY_LENGTH_ACTION
<span class="nc" id="L131">	protected String m_sortType2 = &quot;&quot;;</span>

	//Sort criteria for the third sort
	public static final String SORT_COLUMN3_HIDDEN = &quot;sortColumn3&quot;;
	public static final String SORT_ORDER3_HIDDEN = &quot;sortOrder3&quot;;
	public static final String SORT_TYPE3_HIDDEN = &quot;sortType3&quot;;

	//column number
<span class="nc" id="L139">	protected String m_sortColumn3 = &quot;&quot;;</span>
	//&quot;ascending&quot; or &quot;descending&quot;
<span class="nc" id="L141">	protected String m_sortOrder3 = &quot;&quot;;</span>
	//SORT_BY_START_ACTION or SORT_BY_END_ACTION or SORT_BY_LENGTH_ACTION
<span class="nc" id="L143">	protected String m_sortType3 = &quot;&quot;;</span>

	//Sort criteria for the fourth sort
	public static final String SORT_COLUMN4_HIDDEN = &quot;sortColumn4&quot;;
	public static final String SORT_ORDER4_HIDDEN = &quot;sortOrder4&quot;;
	public static final String SORT_TYPE4_HIDDEN = &quot;sortType4&quot;;

	//column number
<span class="nc" id="L151">	protected String m_sortColumn4 = &quot;&quot;;</span>
	//&quot;ascending&quot; or &quot;descending&quot;
<span class="nc" id="L153">	protected String m_sortOrder4 = &quot;&quot;;</span>
	//SORT_BY_START_ACTION or SORT_BY_END_ACTION or SORT_BY_LENGTH_ACTION
<span class="nc" id="L155">	protected String m_sortType4 = &quot;&quot;;</span>

	transient BiddableSchedulePreferenceStatistics schedulePreferences;
	private Map&lt;ID, Integer&gt; preferencesFromPostback;

	private int maxPrefValue;
	private boolean canShowMultiSubmitButton;
	private Integer availableShiftsForSubmittedBids;
	private Integer minimumNumberOfBids;
<span class="nc" id="L164">	private Collection&lt;ID&gt; spOrgList = Collections.emptyList();</span>
<span class="nc" id="L165">	private Collection&lt;ID&gt; viewUserScopeOrgIDs = Collections.emptyList();</span>
	private Map&lt;ID, Boolean&gt; orgDescSettings;
<span class="nc" id="L167">	private boolean displayDescColumn = false;</span>
<span class="nc" id="L168">	private User viewingUser = null;</span>
	//For pending request, this is a map from biddable schedule id to the preference for the pending request
<span class="nc" id="L170">	private final Map&lt;Integer, Integer&gt; pendingRequestPreference = new HashMap&lt;Integer, Integer&gt;();</span>

	private static final int MAX_LENGTH_SIX = 6;

	protected BaseBidOptionsPM(RequestContext context, int modeType, String formAction) {
<span class="nc" id="L175">		super(context, modeType);</span>

<span class="nc" id="L177">		removeChildComponent(m_contentTitlePC);</span>
<span class="nc" id="L178">		m_contentTitlePC = new BaseBidOptionsContentTitlePC(context);</span>
<span class="nc" id="L179">		addChildComponent(m_contentTitlePC);</span>

<span class="nc" id="L181">		hasRMAdvanceLicense = LicenseUtil.isAdvancedRMLicense();</span>
<span class="nc" id="L182">		viewingUser = context.getUser();</span>

<span class="nc" id="L184">		setFormAction(formAction);</span>
<span class="nc" id="L185">		m_list.setIsZebra(true);</span>
<span class="nc" id="L186">		m_bundle = m_localizer.getBundle(RmWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L187">		m_bbm_bundle = m_localizer.getBundle(BbmWebBundleKey.BUNDLE_NAME);</span>

<span class="nc" id="L189">		m_tz = m_context.getViewingTimeZone();</span>

<span class="nc" id="L191">		addRequiredJavaScriptFile(JavaScriptFileID.JQUERY);</span>
<span class="nc" id="L192">		setJSMediator(RmJavaScriptFileID.MEDIATOR_SCHEDULES);</span>
<span class="nc" id="L193">		setIsAutoSortEnabled(false);</span>
<span class="nc" id="L194">		setIsSortSupported(true);</span>

<span class="nc" id="L196">		setDefaultPageIDSize(10);</span>
<span class="nc" id="L197">		setIsPaginatingSelectedIDs(false);</span>
<span class="nc bnc" id="L198" title="All 2 branches missed.">		if(isAccessibilityComplianceMode()){</span>
<span class="nc" id="L199">			m_list.setUseWrapper(true);</span>
		}
<span class="nc" id="L201">	}</span>

	protected void setContentTitleItemClass(String cssClassName) {
<span class="nc" id="L204">		((BaseBidOptionsContentTitlePC) m_contentTitlePC).setContentTitleItemClass(cssClassName);</span>
<span class="nc" id="L205">	}</span>

	@Override
	protected MultiColListPC getMultiColListPC(RequestContext context) {
<span class="nc bnc" id="L209" title="All 2 branches missed.">		if (isAccessibilityComplianceMode()) {</span>
<span class="nc" id="L210">			final Set&lt;String&gt; headersToIncludeInAdditionalRowInfo = new HashSet&lt;&gt;(</span>
<span class="nc" id="L211">				Arrays.asList(i18n(m_bbm_bundle, BbmWebBundleKey.TEMPLATE_NAME),</span>
<span class="nc" id="L212">					i18n(m_common_bundle, UIFWebBundleKey.DESCRIPTION),</span>
<span class="nc" id="L213">					i18n(m_common_bundle, UIFWebBundleKey.PREFERENCE),</span>
<span class="nc" id="L214">					i18n(m_common_bundle, UIFWebBundleKey.AVAILABLE),</span>
<span class="nc" id="L215">					i18n(m_common_bundle, UIFWebBundleKey.SUBMITTED),</span>
<span class="nc" id="L216">					i18n(m_bundle, RmWebBundleKey.BID_RANK),</span>
<span class="nc" id="L217">					i18n(m_common_bundle, UIFWebBundleKey.BONUS),</span>
<span class="nc" id="L218">					i18n(m_common_bundle, UIFWebBundleKey.HOURS),</span>
<span class="nc" id="L219">					i18n(m_common_bundle, UIFWebBundleKey.STATUS)));</span>
<span class="nc" id="L220">			return new BidOptionsMultiColListPC(context, headersToIncludeInAdditionalRowInfo);</span>
		} else {
<span class="nc" id="L222">			return new MultiColListPC(context);</span>
		}
	}

	public List&lt;UnsubmittedShiftBidPreference&gt; getUnsubmittedPreferencesToSave(ID bidderID) {
<span class="nc bnc" id="L227" title="All 2 branches missed.">		if (preferencesFromPostback == null) {</span>
<span class="nc" id="L228">			return null;</span>
		}

<span class="nc" id="L231">		List&lt;UnsubmittedShiftBidPreference&gt; preferences = new ArrayList&lt;UnsubmittedShiftBidPreference&gt;();</span>
<span class="nc bnc" id="L232" title="All 2 branches missed.">		for (Map.Entry&lt;ID, Integer&gt; entry : preferencesFromPostback.entrySet()) {</span>
<span class="nc" id="L233">			UnsubmittedShiftBidPreference pref = new UnsubmittedShiftBidPreference();</span>
<span class="nc" id="L234">			pref.setBidderID(bidderID);</span>
<span class="nc" id="L235">			pref.setBiddableScheduleID(entry.getKey());</span>
<span class="nc" id="L236">			pref.setUnSubmittedPreference(entry.getValue());</span>
<span class="nc" id="L237">			preferences.add(pref);</span>
<span class="nc" id="L238">		}</span>
<span class="nc" id="L239">		return preferences;</span>
	}

	/**
	 * Load Data for Bidder
	 */
	protected void loadDataForBidder(ID auctionID, ID bidderID, ID empID, boolean isValidate)
			throws Exception {

<span class="nc" id="L248">		boolean byEmplType = false;</span>
<span class="nc" id="L249">		OrganizationSetting orgSettings = null;</span>

<span class="nc bnc" id="L251" title="All 2 branches missed.">		if (isValidate) {</span>
<span class="nc" id="L252">			m_auction = AuctionUtil.getAuctionAndValidate(auctionID, m_context, this);</span>
		} else {
<span class="nc" id="L254">			m_auction = AuctionMH.getAuction(auctionID);</span>
		}
<span class="nc bnc" id="L256" title="All 2 branches missed.">		m_isAuctionClosed = !m_auction.getIsAuctionOpen();</span>

		// Get User's Scoped OrgIDs
<span class="nc bnc" id="L259" title="All 2 branches missed.">		if (viewUserScopeOrgIDs.isEmpty()) {</span>
<span class="nc" id="L260">			viewUserScopeOrgIDs = OrganizationModelHandler.getAllOrgIdsInUserScope(m_context, viewingUser);</span>
		}

		// Get Users Org ID
<span class="nc" id="L264">		ID orgID = OrganizationModelHandler.getEmployeeOrgID(m_context, empID);</span>

		// Get Filter by Employee Type Setting
<span class="nc bnc" id="L267" title="All 2 branches missed.">		if (hasRMAdvanceLicense) {</span>
<span class="nc" id="L268">			orgSettings = SettingsModelHandler.getSettings(orgID);</span>
<span class="nc" id="L269">			byEmplType = orgSettings.getFilterBidOptionsByEmpType();</span>
		}

		// Determine OrgID for filtering
<span class="nc bnc" id="L273" title="All 2 branches missed.">		if (!m_auction.getBidsOnlyWithinOrg()) {</span>
<span class="nc" id="L274">			orgID = null;</span>
		}

		// Gets Multi-Submit, Schedule Period, and Timezone for the Schedule Period
<span class="nc" id="L278">		canShowMultiSubmitButton = getCanShowMultiSubmitButton();</span>
<span class="nc" id="L279">		m_schedPeriod = BidOptionsFilterUtil.getSP(m_context, m_auction);</span>
<span class="nc" id="L280">		m_campaignTz = CampaignModelHandler.getCampaign(m_context, m_schedPeriod.getCampaignID()).getTimeZone();</span>

		//We need to store whether the SP is skilled in the session because the filter popup PM
		//needs to instantiate its skills assignment box member variable only when SP is skilled.
		//It cannot use a popup param for this decision because the assignment box must be instantiated
		//in the popup PM constructor, before the popup parameters are extracted.
<span class="nc bnc" id="L286" title="All 2 branches missed.">		if (m_schedPeriod.getSkillBased()) {</span>
<span class="nc" id="L287">			m_context.setAttribute(RequestContext.SESSION_SCOPE, BidOptionsFilterUtil.IS_SKILLED_SP_KEY, &quot;true&quot;);</span>
		} else {
<span class="nc" id="L289">			m_context.removeAttribute(RequestContext.SESSION_SCOPE, BidOptionsFilterUtil.IS_SKILLED_SP_KEY);</span>
		}

		// Get Orgs for the Schedule Period and Populate Org Description Setting Map
<span class="nc" id="L293">		spOrgList = CampaignModelHandler.getLinkedOrgsforSP(m_context, m_auction.getOptMethods().getSP().getID());</span>
<span class="nc" id="L294">		orgDescSettings = AuctionUtil.setOrgDisplayDecription(spOrgList);</span>


		// Get the Employee Maximum Preference Level
<span class="nc" id="L298">		maxPrefValue = AuctionMH.getEmpMaxPrefLevel(m_context, empID);</span>

<span class="nc" id="L300">		initializeListData(auctionID, bidderID, empID, byEmplType, orgID);</span>

		// Get Unsubmitted Schedule Preferences
<span class="nc" id="L303">		this.schedulePreferences = new BiddableSchedulePreferenceStatistics(</span>
<span class="nc" id="L304">			AuctionMH.getUnsubmittedSchedulePreference(auctionID, empID), m_listData);</span>


<span class="nc" id="L307">		BiddableSkillDetailPopupPM.addPopupArgs(this, RmPageAction.POPUP_AGENT_SKILLS_ACTION);</span>

<span class="nc" id="L309">		BiddableShiftDetailsPopupPM.addPopupArgs(this, RmPageAction.POPUP_SHIFT_DETAILS_ACTION);</span>

<span class="nc" id="L311">		BidRequestFormPopupPM.addPopupArgs(this, RmPageAction.POPUP_CREATE_BID_REQUEST_ACTION);</span>

<span class="nc" id="L313">		setPageDirty(false);</span>
<span class="nc" id="L314">	}</span>

	private void initializeListData(ID auctionID, ID bidderID, ID empID, boolean byEmplType, ID orgID) throws Exception {
<span class="nc bnc" id="L317" title="All 2 branches missed.">		if (m_isAuctionClosed) {</span>
<span class="nc" id="L318">			addPageMessage(Message.INFO_TYPE, RmWebBundleKey.AUCTION_IS_CLOSED, RmWebBundleKey.BUNDLE_NAME);</span>
<span class="nc bnc" id="L319" title="All 4 branches missed.">		} else if (isPaginationNavPressed() || isMultiBidAction()) {</span>
			//get next chunk
<span class="nc" id="L321">			m_listData = AuctionMH.getBidOptionsRows(auctionID, bidderID, getPageIDs());</span>
		} else {
<span class="nc" id="L323">			initSortSettings();</span>
<span class="nc" id="L324">			BiddableSchedulesForAuctionParameter inputParam = getAuctionInputParameter(auctionID, bidderID, empID, byEmplType, orgID);</span>
<span class="nc" id="L325">			Pair&lt;List&lt;ID&gt;, List&lt;BidOptionRow&gt;&gt; biddableSchedPair = AuctionMH.getBidOptionsForBidder(inputParam);</span>
<span class="nc" id="L326">			m_listData = biddableSchedPair.getSecond();</span>
<span class="nc" id="L327">			initPaginationIDs(biddableSchedPair.getFirst());</span>
		}
<span class="nc" id="L329">	}</span>

	private BiddableSchedulesForAuctionParameter getAuctionInputParameter(ID auctionID, ID bidderID, ID empID, boolean byEmplType, ID orgID)
			throws Exception {
<span class="nc" id="L333">		BiddableSchedulesForAuctionParameter param = new BiddableSchedulesForAuctionParameter();</span>
<span class="nc" id="L334">		param.setAuctionID(auctionID);</span>
<span class="nc" id="L335">		param.setShiftBidderID(bidderID);</span>
<span class="nc" id="L336">		param.setByEmployeeType(byEmplType);</span>
<span class="nc" id="L337">		param.setBidderOrganizationID(orgID);</span>
<span class="nc" id="L338">		int[] sortColumns = getSortColumnArray();</span>
<span class="nc" id="L339">		param.setSortBy(sortColumns);</span>
<span class="nc" id="L340">		param.setSortDirection(getSortOrderArray(sortColumns.length));</span>
<span class="nc" id="L341">		param.setPageSize(getPageIDSize());</span>
<span class="nc" id="L342">		param.setFilter(getFilterChain(empID));</span>
<span class="nc" id="L343">		TimeRange[] range = AuctionUtil.getWeekRanges(m_schedPeriod, m_auction.getOptMethods().getCampaign().getTimeZone());</span>
<span class="nc" id="L344">		param.setWeekRanges(range);</span>
<span class="nc" id="L345">		param.setLocalizer(m_localizer);</span>
<span class="nc" id="L346">		return param;</span>
	}

	protected boolean isMultiBidAction() {
<span class="nc bnc" id="L350" title="All 2 branches missed.">		return RmPageAction.SUBMIT_MULTIPLE_BIDS.equals(pageAction) ||</span>
<span class="nc bnc" id="L351" title="All 2 branches missed.">				RmPageAction.SAVE_UNSUBMITTED_BID_PREFERENCE.equals(pageAction);</span>
	}

	private boolean getCanShowMultiSubmitButton() {
<span class="nc bnc" id="L355" title="All 8 branches missed.">		return LicenseUtil.isAdvancedRMLicense() &amp;&amp; m_auction != null &amp;&amp; m_auction.getIsFullPeriodSchedule() &amp;&amp; !m_isAuctionClosed;</span>
	}

	public static RmFilterChain getFilterChain(RequestContext context, ShiftBidAuction auction, SchedulingPeriod schedPeriod, ID empID,
			ID bidderID, TimeZone timeZone)
			throws Exception {
<span class="nc" id="L361">		BidOptionsFilter filter = updateFilter(null, context, auction, schedPeriod, empID);</span>
<span class="nc bnc" id="L362" title="All 2 branches missed.">		if (filter == null) {</span>
<span class="nc" id="L363">			return null;</span>
		}

<span class="nc" id="L366">		return BidOptionsFilterUtil.createFilterChain(filter, auction, bidderID, context, timeZone);</span>
	}

	/**
	 * Construct an RmFilterChain from our BidOptionsFilter object (if any).
	 * @param empID The agent's employee ID. We use it to get skills.
	 * @return An RmFilterChain object containing the settings for our filter.
	 */
	private RmFilterChain getFilterChain(ID empID) throws Exception {
		//Load the filter from the session
<span class="nc" id="L376">		BidOptionsFilter filter = (BidOptionsFilter) m_context.getAttribute(RequestContext.SESSION_SCOPE,</span>
				RmKeys.BID_OPTIONS_FILTER);

<span class="nc" id="L379">		filter = updateFilter(filter, m_context, m_auction, m_schedPeriod, empID);</span>
<span class="nc bnc" id="L380" title="All 2 branches missed.">		if (filter == null) {</span>
<span class="nc" id="L381">			return null;</span>
		}
<span class="nc" id="L383">		m_context.setAttribute(RequestContext.SESSION_SCOPE, RmKeys.BID_OPTIONS_FILTER, filter);</span>
<span class="nc" id="L384">		return BidOptionsFilterUtil.createFilterChain(filter, m_auction, m_bidderID, m_context, m_tz);</span>
	}

	private static BidOptionsFilter updateFilter(BidOptionsFilter filter, RequestContext context, ShiftBidAuction auction,
			SchedulingPeriod schedPeriod,
			ID empID) throws Exception {


<span class="nc bnc" id="L392" title="All 2 branches missed.">		if (BidOptionsFilterUtil.isShowBidderSkillsOnly(context, schedPeriod, empID)) {</span>
<span class="nc" id="L393">			List&lt;ID&gt; skillsIDList = new ArrayList&lt;ID&gt;();</span>
<span class="nc" id="L394">			Collection&lt;SkillAssignment&gt; skillAssignments = SkillModelHandler.getSkillAssignments(context, empID,</span>
<span class="nc" id="L395">					auction.getStartTime(), auction.getEndTime());</span>

<span class="nc bnc" id="L397" title="All 2 branches missed.">			if (skillAssignments != null) {</span>
<span class="nc bnc" id="L398" title="All 2 branches missed.">				for (SkillAssignment sa : skillAssignments) {</span>
<span class="nc" id="L399">					skillsIDList.add(sa.getSkillID());</span>
<span class="nc" id="L400">				}</span>
			}

<span class="nc bnc" id="L403" title="All 2 branches missed.">			BidOptionsFilter filterToUpdate = filter == null ? new BidOptionsFilter() : filter;</span>

<span class="nc" id="L405">			filterToUpdate.put(&quot;skills&quot;, skillsIDList);</span>
<span class="nc" id="L406">			filterToUpdate.put(&quot;skillsMatchType&quot;, BidOptionsFilter.SKILLS_MATCH_AT_MOST);</span>
<span class="nc" id="L407">			return filterToUpdate;</span>
		}

<span class="nc bnc" id="L410" title="All 4 branches missed.">		if (filter != null &amp;&amp; !schedPeriod.getSkillBased()) {</span>
			// Remove skills (if any) from filter
<span class="nc" id="L412">			filter.remove(&quot;skills&quot;);</span>
		}

<span class="nc" id="L415">		return filter;</span>

	}

	/**
	 * Initialize Content Title
	 */
	@Override
	protected void initContentTitle() {
		//We need to render our content title components with a top alignment,
		//so that they will not move when the bid options filter PC is expanded.

		//We override the default ID of contentTitle_act_comp_tbl_id because that
		// sets all TD elements in the content title to have a padding-right of 10px,
		//even for embedded tables, and there is no other way to change this.
<span class="nc" id="L430">		m_contentTitlePC.setActiveComponentTableID(&quot;&quot;);</span>

<span class="nc" id="L432">		String pageTitle = i18n(m_bundle, RmWebBundleKey.RM_SA_BID_OPTIONS);</span>
<span class="nc" id="L433">		m_contentTitlePC.setPageTitle(pageTitle);</span>
<span class="nc" id="L434">		m_contentTitlePC.setAriaRegion(true);</span>
		
<span class="nc bnc" id="L436" title="All 2 branches missed.">		if (m_auction == null) {</span>
<span class="nc" id="L437">			return;</span>
		}

<span class="nc" id="L440">		String name = getAuctionNameUI();</span>
<span class="nc" id="L441">		m_contentTitlePC.setItemName(name);</span>
<span class="nc" id="L442">		BaseBidOptionsContentTitlePC titlePC = (BaseBidOptionsContentTitlePC) m_contentTitlePC;</span>

<span class="nc" id="L444">		titlePC.setMinimumBidCountString(getMinimumBidCountStringForEmployee());</span>
<span class="nc" id="L445">		titlePC.setCurrentBidCount(getCurrentCountStringForEmployee());</span>

<span class="nc" id="L447">	}</span>

	protected String getMinimumBidCountStringForEmployee() {
<span class="nc" id="L450">		String minBidString = &quot;&quot;;</span>

<span class="nc bnc" id="L452" title="All 4 branches missed.">		if (LicenseUtil.isAdvancedRMLicense() &amp;&amp; m_auction.getIsRequiredBids()) {</span>
			try {

<span class="nc" id="L455">				EmployeeName name = AuctionMH.getEmployeeNameByBidderID(m_context, m_bidderID);</span>

<span class="nc" id="L457">				Integer numBidsRequired = getMinimumNumberOfBids();</span>
<span class="nc" id="L458">				String numBidsString = numBidsRequired.toString();</span>

<span class="nc" id="L460">				Object[] params = { name.getFirstName(), name.getLastName(), numBidsString };</span>
<span class="nc" id="L461">				minBidString = this.m_localizer.i18n(RmWebBundleKey.BUNDLE_NAME, RmWebBundleKey.MINIMUM_BID_MSG_MANAGER, params);</span>

<span class="nc" id="L463">			} catch (Exception e) {</span>
<span class="nc" id="L464">				log.error(e.getMessage(), e);</span>
<span class="nc" id="L465">				return &quot;&quot;;</span>
<span class="nc" id="L466">			}</span>
		}

<span class="nc" id="L469">		return minBidString;</span>

	}

	String getCurrentCountStringForEmployee() {
<span class="nc bnc" id="L474" title="All 4 branches missed.">		if (!LicenseUtil.isAdvancedRMLicense() || !m_auction.getIsRequiredBids()) {</span>
<span class="nc" id="L475">			return &quot;&quot;;</span>
		}
<span class="nc" id="L477">		return this.m_localizer.i18n(RmWebBundleKey.BUNDLE_NAME, RmWebBundleKey.CURRENT_BID_COUNT_MSG_EMPLOYEE, getCurrentBidCount());</span>
	}

	String getCurrentBidCountLabel() {
<span class="nc" id="L481">		return this.m_localizer.i18n(RmWebBundleKey.BUNDLE_NAME, RmWebBundleKey.CURRENT_BID_COUNT_MSG_EMPLOYEE);</span>
	}

	/**
	 * Return Auction Name UI in Content Title
	 */
	protected abstract String getAuctionNameUI();

	/**
	 * Return Deadline to be shown in Content Title
	 */
	protected abstract Date getDeadline();

	public abstract ID getEmployeeID();

	/**
	 * Initialize Header
	 */
	@Override
	protected void initHeader() {
<span class="nc bnc" id="L501" title="All 2 branches missed.">		if (m_auction == null) {</span>
<span class="nc" id="L502">			return;</span>
		}

<span class="nc" id="L505">		TableHeaderPC header = m_list.getHeader();</span>
<span class="nc" id="L506">		displayDescColumn = AuctionUtil.getDisplayDescriptionColumn(spOrgList, viewUserScopeOrgIDs, orgDescSettings);</span>
<span class="nc" id="L507">		header.setDefaultSortColumn(String.valueOf(BiddableSchedule.SORTBY_NONE));</span>

<span class="nc" id="L509">		addGridColumn(header, BiddableSchedule.SORTBY_PHANTOMNAME);</span>

<span class="nc bnc" id="L511" title="All 4 branches missed.">		if (hasRMAdvanceLicense &amp;&amp; displayDescColumn) {</span>
<span class="nc" id="L512">			addGridColumn(header, BiddableSchedule.SORTBY_DESCRIPTION);</span>
		}

<span class="nc" id="L515">		addGridColumnNumeric(header, BiddableSchedule.SORTBY_PREFERENCE);</span>

<span class="nc bnc" id="L517" title="All 2 branches missed.">		if (canShowMultiSubmitButton) {</span>
<span class="nc" id="L518">			addGridColumn(header, BiddableSchedule.SORTBY_PREFERENCE_STATUS);</span>
		}

<span class="nc" id="L521">		addGridColumnNumeric(header, BiddableSchedule.SORTBY_NUMBER_AVAIALBLE);</span>
<span class="nc" id="L522">		addGridColumnNumeric(header, BiddableSchedule.SORTBY_NUMBER_SUBMITTED);</span>

<span class="nc bnc" id="L524" title="All 4 branches missed.">		if (m_auction != null &amp;&amp; m_auction.getUsesScoring()) {</span>
<span class="nc" id="L525">			addGridColumnNumeric(header, BiddableSchedule.SORTBY_BIDRANK);</span>
		}

<span class="nc" id="L528">		addGridColumnNumeric(header, BiddableSchedule.SORTBY_BONUSASSIGNED);</span>
<span class="nc" id="L529">		addGridColumnNumeric(header, BiddableSchedule.SORTBY_HOURS);</span>

<span class="nc bnc" id="L531" title="All 2 branches missed.">		if (m_isPageEnabled) {</span>
<span class="nc" id="L532">			AuctionUtil.addShiftDatesToHeader(m_schedPeriod, m_localizer, m_campaignTz, header, true);</span>
		}
<span class="nc" id="L534">	}</span>

	private GenericHeaderData addGridColumnNumeric(TableHeaderPC header, int sortID) {
<span class="nc" id="L537">		GenericHeaderData ghd = addGridColumn(header, sortID);</span>
<span class="nc" id="L538">		ghd.setIsForNumeric(true);</span>
<span class="nc" id="L539">		return ghd;</span>
	}

	private GenericHeaderData addGridColumn(TableHeaderPC header, int sortID) {
<span class="nc" id="L543">		GenericHeaderData ghd = header.addColumnHeaderData(String.valueOf(sortID), getColumnLabel(sortID));</span>
<span class="nc" id="L544">		ghd.setHeaderClass(CSSUtil.CLASS_HEADER_DEFAULT);</span>
<span class="nc" id="L545">		return ghd;</span>
	}

	/**
	 * Wrap a String in an anchor tag that links to nothing (#).
	 */
	protected String anchor(String innerHTML) {
<span class="nc" id="L552">		return &quot;&lt;a href=\&quot;#\&quot;&gt;&quot; + innerHTML + &quot;&lt;/a&gt;&quot;;</span>
	}

	/**
	 * Initialize List
	 */

	@Override
	protected void initSelectableItems() {
<span class="nc bnc" id="L561" title="All 4 branches missed.">		if (m_listData.isEmpty() || !m_isPageEnabled) {</span>
<span class="nc" id="L562">			return;</span>
		}

<span class="nc" id="L565">		String setterID = &quot;BaseBidOptionsPM.initSelectableItems&quot;;</span>
<span class="nc" id="L566">		boolean cacheEnabled = ThreadLocalForCacheManagerHelper.enableThreadLocalCacheIfNecess(setterID);</span>
		try {
<span class="nc" id="L568">			initSelectableItemsWithCache();</span>
		} finally {
<span class="nc bnc" id="L570" title="All 4 branches missed.">			if (cacheEnabled) {</span>
<span class="nc" id="L571">				ThreadLocalForCacheManagerHelper.disableThreadLocalCache(setterID);</span>
			}
		}

<span class="nc" id="L575">	}</span>



	private void initSelectableItemsWithCache() {
<span class="nc bnc" id="L580" title="All 4 branches missed.">		if (m_listData.isEmpty() || !m_isPageEnabled) {</span>
<span class="nc" id="L581">			return;</span>
		}

<span class="nc" id="L584">		List&lt;DefaultMultiColumnNodeData&gt; listModel = new ArrayList&lt;DefaultMultiColumnNodeData&gt;(m_listData.size());</span>
<span class="nc" id="L585">		boolean isEditable = isAuthorizedToConfigure();</span>
<span class="nc" id="L586">		boolean isUseScoring = m_auction.getUsesScoring();</span>
<span class="nc" id="L587">		String noBidMsg = i18n(m_bundle, RmWebBundleKey.BID_NO_BID);</span>

<span class="nc" id="L589">		Set&lt;ID&gt; selectedIDSet = new HashSet&lt;ID&gt;(getPerfromActionOnIDsAsCollection());</span>
<span class="nc bnc" id="L590" title="All 2 branches missed.">		for (BidOptionRow bidRow : m_listData) {</span>
<span class="nc" id="L591">			String rowID = bidRow.getID().toString();</span>

<span class="nc" id="L593">			int avail = bidRow.getNumOfAvailableInstances();</span>
<span class="nc" id="L594">			int submitted = bidRow.getSubmittedBids();</span>
<span class="nc" id="L595">			int bonus = bidRow.getBonusPoints();</span>
<span class="nc" id="L596">			String description = bidRow.getDescription();</span>

<span class="nc" id="L598">			DefaultMultiColumnNodeData node = new DefaultMultiColumnNodeData(rowID);</span>
<span class="nc" id="L599">			node.add(getTemplateUI(bidRow), CSSUtil.STYLE_NORMAL_LEFT);</span>

<span class="nc bnc" id="L601" title="All 4 branches missed.">			if (hasRMAdvanceLicense &amp;&amp; displayDescColumn) {</span>
<span class="nc" id="L602">				node.add(description, CSSUtil.STYLE_NORMAL_LEFT);</span>
			}

<span class="nc" id="L605">			addPreferenceColumn(node, bidRow, noBidMsg, isEditable);</span>
<span class="nc" id="L606">			addPreferenceStatusColumn(bidRow, node);</span>

<span class="nc" id="L608">			node.add(new NumberWrapper(avail, m_localizer), CSSUtil.STYLE_NUMERIC);</span>
<span class="nc" id="L609">			node.add(new NumberWrapper(submitted, m_localizer), CSSUtil.STYLE_NUMERIC);</span>

<span class="nc bnc" id="L611" title="All 2 branches missed.">			if (isUseScoring) {</span>
<span class="nc" id="L612">				node.add(getRank(bidRow), CSSUtil.STYLE_NUMERIC);</span>
			}

<span class="nc" id="L615">			node.add(new NumberWrapper(bonus, m_localizer), CSSUtil.STYLE_NUMERIC);</span>

<span class="nc" id="L617">			Collection&lt;ShiftAssignment&gt; shifts = bidRow.getShiftAssignments();</span>
<span class="nc" id="L618">			node.add(AuctionUtil.getScheduleHourWrapper(shifts, m_localizer), CSSUtil.STYLE_NUMERIC);</span>
<span class="nc" id="L619">			AuctionUtil.addShiftsData(m_schedPeriod, shifts, m_localizer, m_tz, m_campaignTz, node);</span>

<span class="nc" id="L621">			node.setSelectable(isEditable);</span>
			// Mark selected IDs
<span class="nc bnc" id="L623" title="All 2 branches missed.">			if (selectedIDSet.contains(bidRow.getID())) {</span>
<span class="nc" id="L624">				m_list.addSelectedRowID(rowID);</span>
			}

<span class="nc" id="L627">			listModel.add(node);</span>
<span class="nc" id="L628">		}</span>

<span class="nc" id="L630">		boolean isFullSched = m_auction.getIsFullPeriodSchedule();</span>
<span class="nc bnc" id="L631" title="All 2 branches missed.">		m_list.setMultiRowSelectable(!isFullSched);</span>

<span class="nc" id="L633">		m_list.setListModel(listModel);</span>
<span class="nc" id="L634">	}</span>


	private void addPreferenceColumn(DefaultMultiColumnNodeData node, BidOptionRow row,
			String noBidMsg, boolean isAuthorizedToEdit) {

<span class="nc" id="L640">		boolean isReqAvailable = row.hasValidRequest();</span>
<span class="nc" id="L641">		boolean bidIsPending = row.hasPendingOrEscalatedRequest();</span>
		//A request that is available, but not in pending or escalated cannot be edited (only denied requests for now)
<span class="nc bnc" id="L643" title="All 4 branches missed.">		boolean bidNotEditable = isReqAvailable &amp;&amp; !bidIsPending;</span>

<span class="nc" id="L645">		NumberWrapper pref = getPref(isReqAvailable, row, noBidMsg, m_localizer);</span>
<span class="nc bnc" id="L646" title="All 6 branches missed.">		if (!canShowMultiSubmitButton || !isAuthorizedToEdit || bidNotEditable) {</span>
<span class="nc" id="L647">			node.add(pref, CSSUtil.STYLE_NORMAL_LEFT);</span>
<span class="nc" id="L648">			return;</span>
		}

<span class="nc" id="L651">		ID biddableScheduleId = row.getBiddableScheduleId();</span>

<span class="nc" id="L653">		int preference = row.getFullPeriodBidDisplayPreference();</span>

<span class="nc bnc" id="L655" title="All 2 branches missed.">		String preferenceString = preference &lt;= 0 ? &quot;&quot; : Integer.toString(preference);</span>
<span class="nc" id="L656">		String preferenceColumnHeader = i18n(m_common_bundle, UIFWebBundleKey.PREFERENCE); //508</span>

<span class="nc" id="L658">		String html = HtmlUtil.makeTextInput(</span>
			PREFERENCE_PREFIX_FN + biddableScheduleId, 5, MAX_LENGTH_SIX,
			preferenceString, null, true, preferenceColumnHeader);
		
<span class="nc bnc" id="L662" title="All 2 branches missed.">		if (bidIsPending) {</span>
<span class="nc" id="L663">			pendingRequestPreference.put(biddableScheduleId.toInt(), row.getSubmittedPreference());</span>
		}

<span class="nc" id="L666">		node.add(new NumberWrapper(preference, html), CSSUtil.STYLE_NORMAL_LEFT);</span>
<span class="nc" id="L667">	}</span>

	private void addPreferenceStatusColumn(BidOptionRow row, DefaultMultiColumnNodeData node) {
<span class="nc bnc" id="L670" title="All 2 branches missed.">		if (!canShowMultiSubmitButton) {</span>
<span class="nc" id="L671">			return;</span>
		}

<span class="nc" id="L674">		String status = row.getPreferenceStatus(m_localizer);</span>
<span class="nc" id="L675">		node.add(status, CSSUtil.STYLE_NORMAL_LEFT);</span>
<span class="nc" id="L676">	}</span>

	@Override
	public boolean extractParameters(HttpServletRequest request) {
<span class="nc" id="L680">		boolean success = super.extractParameters(request);</span>
<span class="nc" id="L681">		preferencesFromPostback = getPreferenceFromParamters(request);</span>
<span class="nc" id="L682">		return success;</span>
	}

	private Map&lt;ID, Integer&gt; getPreferenceFromParamters(HttpServletRequest request) {
<span class="nc" id="L686">		Map&lt;ID, Integer&gt; result = new HashMap&lt;ID, Integer&gt;();</span>

<span class="nc" id="L688">		Map&lt;ID, String&gt; preferencesFromUI = FormInputPC.extractIDKeyParamMap(request, PREFERENCE_PREFIX_FN);</span>

<span class="nc bnc" id="L690" title="All 2 branches missed.">		for (Map.Entry&lt;ID, String&gt; entry : preferencesFromUI.entrySet()) {</span>
<span class="nc" id="L691">			ID biddableScheduleId = entry.getKey();</span>
<span class="nc" id="L692">			String prefString = entry.getValue();</span>
<span class="nc" id="L693">			Integer preference = RmUtil.tryParseInt(prefString, 0);</span>
<span class="nc" id="L694">			result.put(biddableScheduleId, preference);</span>
<span class="nc" id="L695">		}</span>

<span class="nc" id="L697">		return result;</span>
	}

	private static NumberWrapper getPref(boolean isReqAvail, BidOptionRow request, String noBidMsg, Localizer localizer) {
<span class="nc" id="L701">		int iPref = request.getSubmittedPreferenceInt();</span>
<span class="nc bnc" id="L702" title="All 2 branches missed.">		String display = isReqAvail ? </span>
<span class="nc" id="L703">			AuctionUtil.columnCellFormatForAlignment(AuctionUtil.COLUMN_CELL_ALIGNMENT, localizer.formatNumber(iPref)) </span>
			: noBidMsg;
<span class="nc" id="L705">		return new NumberWrapper(iPref, display);</span>
	}

	public static Pair&lt;Integer, String&gt; getRankPair(ShiftBidRequest sbRequest) {
<span class="nc" id="L709">		int bidRankWithout = 0;</span>
<span class="nc" id="L710">		int bidRankWith = 0;</span>
<span class="nc bnc" id="L711" title="All 2 branches missed.">		if (sbRequest != null) {</span>
<span class="nc" id="L712">			Integer bidRankWithoutBonusInt = sbRequest.getOptMethods().getRankWithoutBonus().getFirst();</span>
<span class="nc" id="L713">			Integer bidRankWithBonusInt = sbRequest.getOptMethods().getRankWithBonus().getFirst();</span>
<span class="nc bnc" id="L714" title="All 2 branches missed.">			bidRankWithout = (bidRankWithoutBonusInt != null) ? bidRankWithoutBonusInt.intValue() : 0;</span>
<span class="nc bnc" id="L715" title="All 2 branches missed.">			bidRankWith = (bidRankWithBonusInt != null) ? bidRankWithBonusInt.intValue() : 0;</span>
		}
<span class="nc" id="L717">		String display = bidRankWithout + &quot;(&quot; + bidRankWith + &quot;)&quot;;</span>
<span class="nc" id="L718">		return new Pair&lt;Integer, String&gt;(bidRankWithout, display);</span>
	}



	private static NumberWrapper getRank(BidOptionRow row) {
<span class="nc" id="L724">		Pair&lt;Integer, String&gt; pair = row.getRankPair();</span>
<span class="nc" id="L725">		return new NumberWrapper(pair.getFirst(), pair.getSecond());</span>
	}

	/**
	 * Initialize Toolbar
	 */
	@Override
	protected void initToolbar() {
<span class="nc bnc" id="L733" title="All 2 branches missed.">		if (m_isAuctionClosed) {</span>
<span class="nc" id="L734">			return;</span>
		}

<span class="nc" id="L737">		boolean isAuthToConfig = isAuthorizedToConfigure();</span>

		String label;
<span class="nc bnc" id="L740" title="All 2 branches missed.">		if (canShowMultiSubmitButton) {</span>
<span class="nc" id="L741">			label = i18n(m_bundle, RmWebBundleKey.SAVE_PREFERENCE);</span>
<span class="nc" id="L742">			m_toolbar.addSubmitTextButton(RmPageAction.SAVE_UNSUBMITTED_BID_PREFERENCE, label, isAuthToConfig);</span>

<span class="nc" id="L744">			label = i18n(m_bundle, RmWebBundleKey.SUBMIT_MULTIPLE_BIDS);</span>
<span class="nc" id="L745">			String onClickJS = &quot;pageMediator.submitMutlipleBids();&quot;;</span>
<span class="nc" id="L746">			m_toolbar.addJSTextButton(RmPageAction.SUBMIT_MULTIPLE_BIDS, label, canEnableMultiSubmitButton(isAuthToConfig), onClickJS);</span>
		}

<span class="nc" id="L749">		label = i18n(m_common_bundle, UIFWebBundleKey.TOOLBAR_CREATE);</span>
<span class="nc" id="L750">		m_toolbar.addPopupWindowTextButton(RmPageAction.POPUP_CREATE_BID_REQUEST_ACTION, label, false).setIsListButton(isAuthToConfig);</span>
<span class="nc" id="L751">		enableToolbarPagination();</span>
<span class="nc" id="L752">	}</span>

	/**
	 * Return the JavaScript init code required to initialize this component.
	 * This code is put in the JavaScript main() function.
	 */
	@Override
	public String getJavaScriptInitCode() {


<span class="nc" id="L762">		JSMediatorVariableHelper helper = new JSMediatorVariableHelper(JSUtil.WORKPANE_MEDIATOR_REF,super.getJavaScriptInitCode());</span>
<span class="nc bnc" id="L763" title="All 2 branches missed.">		if (m_bidderID != null) {</span>
<span class="nc" id="L764">			helper.addVariable(&quot;bidderID&quot;, m_bidderID.toInt());</span>
		}

<span class="nc bnc" id="L767" title="All 2 branches missed.">		if (schedulePreferences != null) {</span>
<span class="nc" id="L768">			helper.addVariable(&quot;hasAdvancedRMLicense&quot;, LicenseUtil.isAdvancedRMLicense());</span>
<span class="nc" id="L769">			helper.addVariable(&quot;availableShiftsInBidsReadyForSubmissionInOtherPages&quot;,</span>
<span class="nc" id="L770">					schedulePreferences.getAvailableShiftsInBidsReadyForSubmissionInOtherPages());</span>
<span class="nc" id="L771">			helper.addVariable(&quot;availableShiftsInPendingRequestsForOtherPages&quot;,</span>
<span class="nc" id="L772">					schedulePreferences.getAvailableShiftsInPendingRequestsForOtherPages());</span>
<span class="nc" id="L773">			helper.addVariable(&quot;minimumNumberOfBids&quot;, getMinimumNumberOfBids());</span>
<span class="nc" id="L774">			helper.addVariable(&quot;availableShiftsForSubmittedBids&quot;, getAvailableShiftsForSubmittedBids());</span>
<span class="nc" id="L775">			helper.addVariable(&quot;confirmMultiSubmitMessage&quot;, i18n(m_bundle, RmWebBundleKey.CONFIRM_MULTIPLE_BIDS_MESSAGE));</span>
<span class="nc" id="L776">			helper.addVariable(&quot;currentBidCountLabel&quot;, getCurrentBidCountLabel());</span>
<span class="nc" id="L777">			helper.addVariable(&quot;maxPrefValue&quot;, maxPrefValue);</span>
<span class="nc" id="L778">			helper.addJsonVariable(&quot;mapBiddableIdToNumAvailable&quot;, getEnabledTimeOffRuleKeysJson());</span>
<span class="nc" id="L779">			helper.addJsonVariable(&quot;mapBiddableIdToPendingPreference&quot;, getBiddableIdToPendingPreferenceJson());</span>
		}

<span class="nc" id="L782">		helper.append(&quot;top.workpaneMediator.handleTableSelection();\n\n&quot;);</span>
<span class="nc" id="L783">		return helper.toString();</span>
	}

	private String getBiddableIdToPendingPreferenceJson() {
<span class="nc" id="L787">		Gson gson = new Gson();</span>
<span class="nc" id="L788">		return gson.toJson(pendingRequestPreference);</span>
	}

	private String getEnabledTimeOffRuleKeysJson() {
<span class="nc" id="L792">		Gson gson = new Gson();</span>
<span class="nc" id="L793">		return gson.toJson(schedulePreferences.getBiddableScheduleIdToNumberAvailable());</span>
	}



	boolean canEnableMultiSubmitButton(boolean isAuthToConfig) {
<span class="nc bnc" id="L799" title="All 4 branches missed.">		if (!isAuthToConfig || schedulePreferences == null) {</span>
<span class="nc" id="L800">			return false;</span>
		}

<span class="nc bnc" id="L803" title="All 2 branches missed.">		if (schedulePreferences.getTotalToProcess() &lt;= 0) {</span>
<span class="nc" id="L804">			return false;</span>
		}

<span class="nc bnc" id="L807" title="All 2 branches missed.">		return getAvailableShiftsInBidsReadyForSubmission() + getAvailableShiftsForSubmittedBids() &gt;= getMinimumNumberOfBids();</span>
	}

	int getAvailableShiftsForSubmittedBids() {
<span class="nc bnc" id="L811" title="All 2 branches missed.">		if (availableShiftsForSubmittedBids != null) {</span>
<span class="nc" id="L812">			return availableShiftsForSubmittedBids;</span>
		}

<span class="nc bnc" id="L815" title="All 4 branches missed.">		if (m_auction == null || m_bidderID == null) {</span>
<span class="nc" id="L816">			availableShiftsForSubmittedBids = 0;</span>
<span class="nc" id="L817">			return 0;</span>
		}

<span class="nc" id="L820">		availableShiftsForSubmittedBids = AuctionMH.getAvailableShiftsForSubmittedBids(m_auction.getID(), m_bidderID);</span>
<span class="nc" id="L821">		return availableShiftsForSubmittedBids;</span>
	}

	int getMinimumNumberOfBids() {
<span class="nc bnc" id="L825" title="All 2 branches missed.">		if (minimumNumberOfBids != null) {</span>
<span class="nc" id="L826">			return minimumNumberOfBids;</span>
		}

<span class="nc bnc" id="L829" title="All 6 branches missed.">		if (m_auction == null || !m_auction.getIsRequiredBids() || m_auction.isStatusClosed()</span>
<span class="nc bnc" id="L830" title="All 2 branches missed.">				|| !LicenseUtil.isAdvancedRMLicense()) {</span>
<span class="nc" id="L831">			minimumNumberOfBids = 0;</span>
<span class="nc" id="L832">			return 0;</span>
		}

<span class="nc" id="L835">		minimumNumberOfBids = ShiftBidAuctionUtil.calculateShiftBidderMinimumNumberOfBidsForEmployee(m_auction, getEmployeeID());</span>

<span class="nc" id="L837">		return minimumNumberOfBids;</span>
	}


	int getCurrentBidCount() {
<span class="nc" id="L842">		return getAvailableShiftsInBidsReadyForSubmission() + getAvailableShiftsForSubmittedBids();</span>
	}

	int getAvailableShiftsInBidsReadyForSubmission() {
<span class="nc bnc" id="L846" title="All 2 branches missed.">		if (schedulePreferences == null) {</span>
<span class="nc" id="L847">			return 0;</span>
		}
<span class="nc" id="L849">		return schedulePreferences.getAvailableShiftsInBidsReadyForSubmission();</span>
	}



	/**
	 * Return Required HTML for this component.
	 */
	@Override
	public String getRequiredHTML() {
<span class="nc" id="L859">		return super.getRequiredHTML() + getTieredSortHTML();</span>
	}

	/**
	 * Prepare hidden variables to support the three-tiered sort settings.
	 * The user can sort by three different columns at the same time. For example:
	 * Sort by &quot;Availability&quot; then by &quot;Monday shift start time&quot; then by &quot;Submitted&quot;.
	 * The top sort criteria is gotten from the getSortColumn(), getSortOrder() and
	 * getSortType() methods. The second and third sort criteria are stored in
	 * hidden variables.
	 */
	protected String getTieredSortHTML() {
<span class="nc" id="L871">		StringBuilder sb = new StringBuilder();</span>

		//third sort becomes fourth sort
<span class="nc" id="L874">		sb.append(HtmlUtil.makeHiddenInput(SORT_COLUMN4_HIDDEN, m_sortColumn3));</span>
<span class="nc" id="L875">		sb.append(HtmlUtil.makeHiddenInput(SORT_ORDER4_HIDDEN, m_sortOrder3));</span>
<span class="nc" id="L876">		sb.append(HtmlUtil.makeHiddenInput(SORT_TYPE4_HIDDEN, m_sortType3));</span>

		//secondary sort becomes third sort
<span class="nc" id="L879">		sb.append(HtmlUtil.makeHiddenInput(SORT_COLUMN3_HIDDEN, m_sortColumn2));</span>
<span class="nc" id="L880">		sb.append(HtmlUtil.makeHiddenInput(SORT_ORDER3_HIDDEN, m_sortOrder2));</span>
<span class="nc" id="L881">		sb.append(HtmlUtil.makeHiddenInput(SORT_TYPE3_HIDDEN, m_sortType2));</span>

		//current sort becomes secondary sort
<span class="nc" id="L884">		sb.append(HtmlUtil.makeHiddenInput(SORT_COLUMN2_HIDDEN, getSortColumn()));</span>
<span class="nc" id="L885">		sb.append(HtmlUtil.makeHiddenInput(SORT_ORDER2_HIDDEN, getSortOrder()));</span>
<span class="nc" id="L886">		sb.append(HtmlUtil.makeHiddenInput(SORT_TYPE2_HIDDEN, getSortType()));</span>

<span class="nc" id="L888">		return sb.toString();</span>
	}

	@Override
	public String getSortColumn() {
<span class="nc" id="L893">		String sortColumn = super.getSortColumn();</span>
<span class="nc bnc" id="L894" title="All 2 branches missed.">		return (sortColumn != null) ? sortColumn : &quot;&quot;;</span>
	}

	@Override
	public String getSortOrder() {
<span class="nc" id="L899">		String sortOrder = super.getSortOrder();</span>
<span class="nc bnc" id="L900" title="All 2 branches missed.">		return (sortOrder != null) ? sortOrder : &quot;&quot;;</span>
	}

	public String getSortType() {
<span class="nc bnc" id="L904" title="All 2 branches missed.">		return (m_sortType != null) ? m_sortType : &quot;&quot;;</span>
	}

	/**
	 * Create the array of 1, 2, or 3 sort columns.
	 */
	protected int[] getSortColumnArray() {
<span class="nc" id="L911">		int col1 = getSortColumnInt(getSortColumn(), getSortType());</span>
<span class="nc" id="L912">		int col2 = getSortColumnInt(m_sortColumn2, m_sortType2);</span>
<span class="nc" id="L913">		int col3 = getSortColumnInt(m_sortColumn3, m_sortType3);</span>

<span class="nc" id="L915">		int size = 1;</span>
<span class="nc bnc" id="L916" title="All 2 branches missed.">		if (col1 == -1) {</span>
			// The default.
<span class="nc" id="L918">			col1 = ShiftBidder.SORTBY_NONE;</span>
		}

<span class="nc bnc" id="L921" title="All 2 branches missed.">		if (col2 != -1) {</span>
<span class="nc" id="L922">			size = 2;</span>
		}

<span class="nc bnc" id="L925" title="All 4 branches missed.">		if ((col2 != -1) &amp;&amp; (col3 != -1)) {</span>
<span class="nc" id="L926">			size = 3;</span>
		}

<span class="nc" id="L929">		int[] sortColumns = new int[size];</span>

<span class="nc" id="L931">		sortColumns[0] = col1;</span>
<span class="nc bnc" id="L932" title="All 2 branches missed.">		if (size &gt; 1) {</span>
<span class="nc" id="L933">			sortColumns[1] = col2;</span>
		}
<span class="nc bnc" id="L935" title="All 2 branches missed.">		if (size &gt; 2) {</span>
<span class="nc" id="L936">			sortColumns[2] = col3;</span>
		}

<span class="nc" id="L939">		return sortColumns;</span>
	}

	/**
	 * Create the array of 1, 2, or 3 sort orders.
	 */
	protected int[] getSortOrderArray(int size) {
<span class="nc" id="L946">		int[] sortOrders = new int[size];</span>

<span class="nc bnc" id="L948" title="All 2 branches missed.">		if (size &gt; 0) {</span>
<span class="nc" id="L949">			sortOrders[0] = getSortOrderInt(getSortOrder());</span>
		}
<span class="nc bnc" id="L951" title="All 2 branches missed.">		if (size &gt; 1) {</span>
<span class="nc" id="L952">			sortOrders[1] = getSortOrderInt(m_sortOrder2);</span>
		}
<span class="nc bnc" id="L954" title="All 2 branches missed.">		if (size &gt; 2) {</span>
<span class="nc" id="L955">			sortOrders[2] = getSortOrderInt(m_sortOrder3);</span>
		}

<span class="nc" id="L958">		return sortOrders;</span>
	}

	/**
	 * If the col parameter signifies a day column, then we need to convert it to
	 * a day column which includes type info (start, end, or length).
	 * @param col The string representation of one of the BiddableSchedule.SORTBY_XXX_XXX constants.
	 * @param type One of our sort type constants (SORT_BY_START_ACTION or SORT_BY_END_ACTION or SORT_BY_LENGTH_ACTION)
	 * @return One of the BiddableSchedule.SORTBY_XXX_XXX constants for this col, type combination, or -1 if none.
	 */
	protected int getSortColumnInt(String col, String type) {
<span class="nc" id="L969">		int iCol = RmUtil.tryParseInt(col, -1);</span>
<span class="nc bnc" id="L970" title="All 8 branches missed.">		if (iCol &lt; 0 || iCol &lt; BiddableSchedule.SORTBY_SUNDAY_STARTTIME || type == null || type.isEmpty()) {</span>
<span class="nc" id="L971">			return iCol;</span>
		}

<span class="nc" id="L974">		int newCol = iCol;</span>

<span class="nc bnc" id="L976" title="All 2 branches missed.">		if (SORT_BY_START_ACTION.equals(type)) {</span>
<span class="nc" id="L977">			newCol = iCol;</span>
<span class="nc bnc" id="L978" title="All 2 branches missed.">		} else if (SORT_BY_END_ACTION.equals(type)) {</span>
<span class="nc" id="L979">			newCol = iCol + 7;</span>
<span class="nc bnc" id="L980" title="All 2 branches missed.">		} else if (SORT_BY_LENGTH_ACTION.equals(type)) {</span>
<span class="nc" id="L981">			newCol = iCol + 14;</span>
		}

<span class="nc" id="L984">		return newCol;</span>
	}

	/**
	 * Get the sort order parameter as an int.
	 * @param col The string representation of one of the BiddableSchedule.SORTBY_XXX_XXX constants.
	 * @return SupportNavigation.SORT_ASCENDING, SupportNavigation.SORT_DESCENDING, or -1 if none.
	 */
	protected int getSortOrderInt(String order) {
<span class="nc" id="L993">		int orderInt = -1;</span>
<span class="nc bnc" id="L994" title="All 4 branches missed.">		if ((order != null) &amp;&amp; (order.length() &gt; 0)) {</span>
<span class="nc bnc" id="L995" title="All 2 branches missed.">			if (SORT_ASCENDING.equals(order)) {</span>
<span class="nc" id="L996">				orderInt = SupportNavigation.SORT_ASCENDING;</span>
			} else {
<span class="nc" id="L998">				orderInt = SupportNavigation.SORT_DESCENDING;</span>
			}
		}
<span class="nc" id="L1001">		return orderInt;</span>
	}

	public void setBidderID(ID bidderID) {
		// Defect ID : 160054 AppScan - Request Management - XSS with
		// rm_sa_bid_options
<span class="nc bnc" id="L1007" title="All 4 branches missed.">		if (bidderID != null &amp;&amp; !bidderID.isInt()) {</span>
<span class="nc" id="L1008">			throw new IllegalStateException(&quot;aBidderID is not an integer&quot;);</span>
		}
<span class="nc" id="L1010">		m_bidderID = bidderID;</span>
<span class="nc" id="L1011">	}</span>

	public ID getBidderID() {
<span class="nc" id="L1014">		return m_bidderID;</span>
	}

	

	public void setSortType(String type) {
<span class="nc" id="L1020">		m_sortType = type;</span>
<span class="nc" id="L1021">	}</span>

	public void setSortColumn2(String col) {
<span class="nc" id="L1024">		m_sortColumn2 = col;</span>
<span class="nc" id="L1025">	}</span>

	public void setSortOrder2(String order) {
<span class="nc" id="L1028">		m_sortOrder2 = order;</span>
<span class="nc" id="L1029">	}</span>

	public void setSortType2(String type) {
<span class="nc" id="L1032">		m_sortType2 = type;</span>
<span class="nc" id="L1033">	}</span>

	public void setSortColumn3(String col) {
<span class="nc" id="L1036">		m_sortColumn3 = col;</span>
<span class="nc" id="L1037">	}</span>

	public void setSortOrder3(String order) {
<span class="nc" id="L1040">		m_sortOrder3 = order;</span>
<span class="nc" id="L1041">	}</span>

	public void setSortType3(String type) {
<span class="nc" id="L1044">		m_sortType3 = type;</span>
<span class="nc" id="L1045">	}</span>

	public void setSortColumn4(String col) {
<span class="nc" id="L1048">		m_sortColumn4 = col;</span>
<span class="nc" id="L1049">	}</span>

	public void setSortOrder4(String order) {
<span class="nc" id="L1052">		m_sortOrder4 = order;</span>
<span class="nc" id="L1053">	}</span>

	public void setSortType4(String type) {
<span class="nc" id="L1056">		m_sortType4 = type;</span>
<span class="nc" id="L1057">	}</span>

	@Override
	public void setIsPageEnabled(boolean bValue) {
<span class="nc" id="L1061">		m_isPageEnabled = bValue;</span>
<span class="nc" id="L1062">	}</span>

	//////////////////////////////////////////////////////////////////////////////
	// Helper Methods
	//////////////////////////////////////////////////////////////////////////////

	private BasicWrapper getTemplateUI(BidOptionRow schedule) {
<span class="nc" id="L1069">		String eNameDisplay = schedule.getTemplateName();</span>

<span class="nc" id="L1071">		String alt = i18n(m_bbm_bundle, BbmWebBundleKey.BBM_PEOPLE_SKILLS);</span>
<span class="nc" id="L1072">		String onClickJS = &quot;pageMediator.popupBiddableSkillDetails(&quot; + schedule.getID() + &quot;);&quot;;</span>
<span class="nc" id="L1073">		String display = HtmlLinkUtil.createActiveLink(eNameDisplay, alt, &quot;&quot;, onClickJS);</span>
<span class="nc bnc" id="L1074" title="All 2 branches missed.">		if (isAccessibilityComplianceMode()) {</span>
<span class="nc" id="L1075">			String enterInstructionMessage = m_localizer.i18n(m_bundle, RmWebBundleKey.ACTIVE_LINK_INSTRUCTION_MESSAGE,</span>
<span class="nc" id="L1076">					i18n(m_bundle, RmWebBundleKey.SKILLS_DETAIL));</span>
<span class="nc" id="L1077">			String spaceInstructionMessage = i18n(m_bundle, RmWebBundleKey.SELECTION_INSTRUCTION_MESSAGE);</span>
<span class="nc" id="L1078">			display += HtmlUtil.createHiddenReadableText(enterInstructionMessage + &quot; &quot; + spaceInstructionMessage);</span>
		}
<span class="nc" id="L1080">		return new BasicWrapper(eNameDisplay, display);</span>
	}

	/**
	 * Initialize for Display
	 */
	@Override
	public void initForDisplay() {
<span class="nc bnc" id="L1088" title="All 2 branches missed.">		if (m_isInitializedForDisplay) {</span>
<span class="nc" id="L1089">			return;</span>
		} else {
<span class="nc" id="L1091">			initSortByMenu();</span>
<span class="nc" id="L1092">			super.initForDisplay();</span>
		}
<span class="nc" id="L1094">	}</span>

	/**
	 * Unrotate sort settings if they are sorting by the same column as before.
	 */
	protected void initSortSettings() {
<span class="nc bnc" id="L1100" title="All 6 branches missed.">		if (getSortColumn().equals(m_sortColumn2) &amp;&amp; (getSortType().equals(m_sortType2) || getSortType().length() == 0)) {</span>
			//first sort gets second sort (except for order, which the user may have toggled)
<span class="nc" id="L1102">			m_sortType = m_sortType2;</span>

			//second sort gets third sort
<span class="nc" id="L1105">			m_sortColumn2 = m_sortColumn3;</span>
<span class="nc" id="L1106">			m_sortOrder2 = m_sortOrder3;</span>
<span class="nc" id="L1107">			m_sortType2 = m_sortType3;</span>

			//third sort gets fourth sort
<span class="nc" id="L1110">			m_sortColumn3 = m_sortColumn4;</span>
<span class="nc" id="L1111">			m_sortOrder3 = m_sortOrder4;</span>
<span class="nc" id="L1112">			m_sortType3 = m_sortType4;</span>

			//fourth sort is cleared
<span class="nc" id="L1115">			m_sortColumn4 = &quot;&quot;;</span>
<span class="nc" id="L1116">			m_sortOrder4 = &quot;&quot;;</span>
<span class="nc" id="L1117">			m_sortType4 = &quot;&quot;;</span>
		}
<span class="nc" id="L1119">	}</span>

	/**
	 * Return a String which summarizes the current sort columns and orders.
	 * Ex: &quot;Sort by Template (Ascending), then by Available (Descending)&quot;
	 */
	protected String getSortString() {
<span class="nc" id="L1126">		StringBuilder sb = new StringBuilder();</span>

<span class="nc bnc" id="L1128" title="All 2 branches missed.">		if (!checkEmpty(getSortColumn())) {</span>
<span class="nc" id="L1129">			String sortByLabel = i18n(m_bundle, RmWebBundleKey.RM_SA_FILTER_SORT_BY);</span>
<span class="nc" id="L1130">			sb.append(&quot;&lt;b&gt;&quot; + sortByLabel + &quot;:&lt;/b&gt; &quot; + getColumnLabel(getSortColumn()) + &quot; &quot; +</span>
<span class="nc" id="L1131">					getTypeLabel(getSortType()) + &quot; &quot; + getOrderLabel(getSortOrder()));</span>

<span class="nc" id="L1133">			sb.append(HtmlUtil.NEW_LINE);</span>

<span class="nc bnc" id="L1135" title="All 2 branches missed.">			if (!checkEmpty(m_sortColumn2)) {</span>
<span class="nc" id="L1136">				String thenByLabel = i18n(m_bundle, RmWebBundleKey.RM_SA_FILTER_THEN_BY);</span>
<span class="nc" id="L1137">				sb.append(BidOptionsFilterUtil.TAB + &quot;&lt;b&gt;&quot; + thenByLabel + &quot;:&lt;/b&gt; &quot; + &quot; &quot; +</span>
<span class="nc" id="L1138">						getColumnLabel(m_sortColumn2) + &quot; &quot; +</span>
<span class="nc" id="L1139">						&quot; &quot; + getTypeLabel(m_sortType2) + &quot; &quot; + getOrderLabel(m_sortOrder2));</span>
<span class="nc" id="L1140">				sb.append(HtmlUtil.NEW_LINE);</span>

<span class="nc bnc" id="L1142" title="All 2 branches missed.">				if (!checkEmpty(m_sortColumn3)) {</span>
<span class="nc" id="L1143">					sb.append(BidOptionsFilterUtil.TAB + BidOptionsFilterUtil.TAB + &quot;&lt;b&gt;&quot; + thenByLabel + &quot;:&lt;/b&gt; &quot; + &quot; &quot; +</span>
<span class="nc" id="L1144">							getColumnLabel(m_sortColumn3) + &quot; &quot; +</span>
<span class="nc" id="L1145">							getTypeLabel(m_sortType3) + &quot; &quot; + getOrderLabel(m_sortOrder3));</span>
<span class="nc" id="L1146">					sb.append(HtmlUtil.NEW_LINE);</span>
				}
			}
		}
<span class="nc" id="L1150">		return sb.toString();</span>
	}

	/**
	 * Given a sort type string, return the corresponding description for the user to read.
	 * @param sortType One of: SORT_BY_START_ACTION, SORT_BY_END_ACTION, SORT_BY_LENGTH_ACTION
	 * @return The localized string, such as &quot;Start Time&quot;, &quot;End Time&quot;, or &quot;Length&quot;
	 */
	protected String getTypeLabel(String sortType) {
<span class="nc bnc" id="L1159" title="All 2 branches missed.">		if (sortType != null) {</span>
<span class="nc bnc" id="L1160" title="All 2 branches missed.">			if (sortType.equals(SORT_BY_START_ACTION)) {</span>
<span class="nc" id="L1161">				return i18n(m_bundle, RmWebBundleKey.RM_SA_FILTER_SORT_BY_START);</span>
<span class="nc bnc" id="L1162" title="All 2 branches missed.">			} else if (sortType.equals(SORT_BY_END_ACTION)) {</span>
<span class="nc" id="L1163">				return i18n(m_bundle, RmWebBundleKey.RM_SA_FILTER_SORT_BY_END);</span>
<span class="nc bnc" id="L1164" title="All 2 branches missed.">			} else if (sortType.equals(SORT_BY_LENGTH_ACTION)) {</span>
<span class="nc" id="L1165">				return i18n(m_bundle, RmWebBundleKey.RM_SA_FILTER_SORT_BY_LENGTH);</span>
			}
		}
<span class="nc" id="L1168">		return &quot;&quot;;</span>
	}

	/**
	 * Given a sort order string, return the corresponding description for the user to read.
	 * @param sortOrder One of: &quot;ascending&quot;, &quot;descending&quot;
	 * @return The localized string, such as &quot;(ascending)&quot;, or &quot;(descending)&quot;
	 */
	protected String getOrderLabel(String sortOrder) {
<span class="nc bnc" id="L1177" title="All 2 branches missed.">		if (sortOrder != null) {</span>
<span class="nc bnc" id="L1178" title="All 2 branches missed.">			if (sortOrder.equals(SORT_ASCENDING)) {</span>
<span class="nc" id="L1179">				return &quot;(&quot; + i18n(m_bundle, RmWebBundleKey.RM_SA_FILTER_SORT_ASCENDING) + &quot;)&quot;;</span>
			} else {
<span class="nc" id="L1181">				return &quot;(&quot; + i18n(m_bundle, RmWebBundleKey.RM_SA_FILTER_SORT_DESCENDING) + &quot;)&quot;;</span>
			}
		}
<span class="nc" id="L1184">		return &quot;&quot;;</span>
	}

	/**
	 * See if a particular sort column is not yet set.
	 * @param sortCol The sort column to check.
	 * @return true is the sort column is empty (not yet set to a value).
	 */
	private boolean checkEmpty(String sortCol) {
<span class="nc bnc" id="L1193" title="All 6 branches missed.">		if ((sortCol == null) || sortCol.equals(String.valueOf(BiddableSchedule.SORTBY_NONE)) || (sortCol.length() == 0)) {</span>
<span class="nc" id="L1194">			return true;</span>
		}
<span class="nc" id="L1196">		return false;</span>
	}

	/**
	 * Given a shift day column number in our bid options table, return the formatted label string.
	 * @param colNum A shift day's column number (ex: BiddableSchedule.SORTBY_SUNDAY_STARTTIME)
	 * @return The label string for this column, ex: &quot;Mon 12/05&quot; (it's displayed in the column header).
	 */
	protected String getDayColumnLabel(SchedulingPeriod schedPeriod,
			Localizer localizer, TimeZone tz, int colNum) {
<span class="nc" id="L1206">		String dayDisplay = &quot;&quot;;</span>

<span class="nc bnc" id="L1208" title="All 2 branches missed.">		if (schedPeriod != null) {</span>
<span class="nc" id="L1209">			Locale locale = localizer.getLocaleContext().getRegionalFormatLocale();</span>
<span class="nc" id="L1210">			CalendarRange cRange = AuctionUtil.getCalendarRange(schedPeriod, tz, locale);</span>
<span class="nc" id="L1211">			Calendar startCal = cRange.getStartCalendar();</span>
<span class="nc" id="L1212">			Calendar endCal = cRange.getEndCalendar();</span>

<span class="nc" id="L1214">			int i = 0;</span>
<span class="nc bnc" id="L1215" title="All 2 branches missed.">			while (endCal.after(startCal)) {</span>
				//the current week offset
<span class="nc" id="L1217">				int w = i / 7;</span>
<span class="nc" id="L1218">				Date date = startCal.getTime();</span>
<span class="nc" id="L1219">                dayDisplay = localizer.formatDate(date, tz,</span>
                        RegionalFormatBundleKey.DATE_NOYEAR_DAYINWEEKFULL_FORMAT);

<span class="nc" id="L1222">				int curDayOfWeek = startCal.get(Calendar.DAY_OF_WEEK);</span>
<span class="nc" id="L1223">				int curSortCol = BiddableSchedule.getDayColumnIndex(w, curDayOfWeek, BiddableSchedule.SORTBY_STARTTIME);</span>
<span class="nc bnc" id="L1224" title="All 2 branches missed.">				if (curSortCol == colNum) {</span>
<span class="nc" id="L1225">					break;</span>
				}

<span class="nc" id="L1228">				startCal.add(Calendar.DATE, 1);</span>
<span class="nc" id="L1229">				i++;</span>
<span class="nc" id="L1230">			}</span>
		}
<span class="nc" id="L1232">		return dayDisplay;</span>
	}

	/**
	 * Given a column number in our bid options table, return the label string.
	 * @param sortCol A column number
	 * @return The label string for this column (it's displayed in the column header).
	 */
	protected String getColumnLabel(int sortCol) {
<span class="nc" id="L1241">		return getColumnLabel(String.valueOf(sortCol));</span>
	}

	/**
	 * Given a column number in our bid options table, return the label string.
	 * @param sortCol A column number
	 * @return The label string for this column (it's displayed in the sort string).
	 */
	protected String getColumnLabel(String sortCol) {
<span class="nc" id="L1250">		String colDisplay = &quot;&quot;;</span>
<span class="nc bnc" id="L1251" title="All 6 branches missed.">		if (RmUtil.isInt(sortCol) &amp;&amp; (m_schedPeriod != null) &amp;&amp; (!checkEmpty(sortCol))) {</span>
<span class="nc" id="L1252">			int colNum = Integer.parseInt(sortCol);</span>
<span class="nc bnc" id="L1253" title="All 2 branches missed.">			if (colNum &gt;= BiddableSchedule.SORTBY_SUNDAY_STARTTIME) {</span>
<span class="nc" id="L1254">				colDisplay = getDayColumnLabel(m_schedPeriod, m_localizer, m_tz, colNum);</span>
			} else {
<span class="nc bnc" id="L1256" title="All 10 branches missed.">				switch (colNum) {</span>
				case BiddableSchedule.SORTBY_PHANTOMNAME:
<span class="nc" id="L1258">					colDisplay = i18n(m_bbm_bundle, BbmWebBundleKey.TEMPLATE_NAME);</span>
<span class="nc" id="L1259">					break;</span>
				case BiddableSchedule.SORTBY_DESCRIPTION:
<span class="nc" id="L1261">					colDisplay = i18n(m_common_bundle, UIFWebBundleKey.DESCRIPTION);</span>
<span class="nc" id="L1262">					break;</span>
				case BiddableSchedule.SORTBY_PREFERENCE:
<span class="nc" id="L1264">					colDisplay = i18n(m_common_bundle, UIFWebBundleKey.PREFERENCE);</span>
<span class="nc" id="L1265">					break;</span>
				case BiddableSchedule.SORTBY_NUMBER_AVAIALBLE:
<span class="nc" id="L1267">					colDisplay = i18n(m_common_bundle, UIFWebBundleKey.AVAILABLE);</span>
<span class="nc" id="L1268">					break;</span>
				case BiddableSchedule.SORTBY_NUMBER_SUBMITTED:
<span class="nc" id="L1270">					colDisplay = i18n(m_common_bundle, UIFWebBundleKey.SUBMITTED);</span>
<span class="nc" id="L1271">					break;</span>
				case BiddableSchedule.SORTBY_BIDRANK:
<span class="nc" id="L1273">					colDisplay = i18n(m_bundle, RmWebBundleKey.BID_RANK);</span>
<span class="nc" id="L1274">					break;</span>
				case BiddableSchedule.SORTBY_BONUSASSIGNED:
<span class="nc" id="L1276">					colDisplay = i18n(m_common_bundle, UIFWebBundleKey.BONUS);</span>
<span class="nc" id="L1277">					break;</span>
				case BiddableSchedule.SORTBY_HOURS:
<span class="nc" id="L1279">					colDisplay = i18n(m_common_bundle, UIFWebBundleKey.HOURS);</span>
<span class="nc" id="L1280">					break;</span>

				case BiddableSchedule.SORTBY_PREFERENCE_STATUS:
<span class="nc" id="L1283">					colDisplay = i18n(m_common_bundle, UIFWebBundleKey.STATUS);</span>
<span class="nc" id="L1284">					break;</span>
					
				default:
					break;
						
				}
			}
		}
<span class="nc" id="L1292">		return colDisplay;</span>
	}



	/**
	 * Initialize the &quot;Sort By&quot; Menu dialog.
	 */
	protected void initSortByMenu() {
<span class="nc" id="L1301">		String sortByLabel = i18n(m_bundle, RmWebBundleKey.RM_SA_FILTER_SORT_BY);</span>
<span class="nc" id="L1302">		String sortByStartLabel = i18n(m_bundle, RmWebBundleKey.RM_SA_FILTER_SORT_BY_START);</span>
<span class="nc" id="L1303">		String sortByEndLabel = i18n(m_bundle, RmWebBundleKey.RM_SA_FILTER_SORT_BY_END);</span>
<span class="nc" id="L1304">		String sortByLengthLabel = i18n(m_bundle, RmWebBundleKey.RM_SA_FILTER_SORT_BY_LENGTH);</span>

<span class="nc" id="L1306">		m_sortByMenuPC = new DialogToolbarMenuPC(m_context, m_toolbar);</span>
<span class="nc" id="L1307">		m_sortByMenuPC.setName(SORT_DIALOG_PC);</span>
<span class="nc" id="L1308">		addChildComponent(m_sortByMenuPC);</span>

		//Initialize Title
<span class="nc" id="L1311">		m_sortByMenuPC.setHeader(sortByLabel + &quot;:&quot;);</span>

		//Initialize Menu Buttons
<span class="nc" id="L1314">		m_sortByMenuPC.addSubmitButton(SORT_BY_START_ACTION, sortByStartLabel, true);</span>
<span class="nc" id="L1315">		m_sortByMenuPC.addSubmitButton(SORT_BY_END_ACTION, sortByEndLabel, true);</span>
<span class="nc" id="L1316">		m_sortByMenuPC.addSubmitButton(SORT_BY_LENGTH_ACTION, sortByLengthLabel, true);</span>
<span class="nc" id="L1317">	}</span>

	private class BaseBidOptionsContentTitlePC extends ContentTitlePC {
		private static final long serialVersionUID = 1L;
<span class="nc" id="L1321">		private final String BBO_DEFAULT_IMG_FILE = ImageFileID.CONTENT_TITLE_DEFAULT_ICON;</span>
		private static final String BBO_DEFAULT_IMAGE_NAME = &quot;DEFAULT&quot;;
<span class="nc" id="L1323">		private String minimumBidCountString = &quot;&quot;;</span>
<span class="nc" id="L1324">		private String currentBidCount = &quot;&quot;;</span>
<span class="nc" id="L1325">		private String contentTitleItemClass = &quot;headerText2&quot;;</span>
		private static final String CONTENT_TITLE_CELL = &quot;&lt;td align=\&quot;left\&quot; %s nowrap id=\&quot;contentTitleItemName\&quot;&gt;{2} &amp;nbsp; &amp;nbsp;&lt;/td&gt;&quot;;
		private static final String CONTENT_TITLE_CELL_PLACEHOLDER = &quot;{CONTENT_TITLE_CELL_PLACEHOLDER}&quot;;

<span class="nc" id="L1329">		private final String BBO_DEFAULT_TMPL = &quot;&lt;div id=\&quot;contentTitleDiv\&quot; &quot; +</span>
<span class="nc bnc" id="L1330" title="All 2 branches missed.">			(isAccessibilityComplianceMode() ? &quot;role=\&quot;region\&quot; tabindex=\&quot;0\&quot; aria-label=\&quot;&quot; +</span>
<span class="nc" id="L1331">				getLocalizer().i18n(UIFWebBundleKey.BUNDLE_NAME, UIFWebBundleKey.REGION_NAME_WORKSPACE_TITLE) + &quot;\&quot; &quot; : &quot;&quot;)</span>
			+
			&quot;style=\&quot;width:100% overflow:hidden\&quot;&gt;&quot; +
			&quot;&lt;table id=\&quot;contentTitle_tbl_id\&quot; cellpadding=\&quot;0\&quot; cellspacing=\&quot;0\&quot; width=\&quot;100%\&quot; border=\&quot;0\&quot; height=\&quot;30\&quot;&gt;&quot; +
			&quot;&lt;tr&gt;&lt;td style=\&quot;width:0px\&quot; width=\&quot;0\&quot;&gt;&quot; +
			&quot;&lt;img id=\&quot;contentTitleDiv_img_id\&quot; style=\&quot;width:0px;visibility:hidden;\&quot; &quot; +
			&quot;alt=\&quot;\&quot; src=\&quot;{0}\&quot; width=\&quot;23\&quot; height=\&quot;22\&quot; border=\&quot;0\&quot;&gt;&lt;/td&gt;&quot; +
			&quot;&lt;td align=\&quot;left\&quot; class=\&quot;headerText1\&quot; nowrap&gt;{1}&lt;/td&gt;&quot; +
			CONTENT_TITLE_CELL_PLACEHOLDER
			+
			&quot;&lt;td align=\&quot;left\&quot; class=\&quot;headerText2\&quot; nowrap id=\&quot;minimumBidText\&quot;&gt;{3} &amp;nbsp; &amp;nbsp;&lt;/td&gt;&quot; +
			&quot;&lt;td align=\&quot;left\&quot; class=\&quot;headerText2\&quot; nowrap id=\&quot;currentCountText\&quot;&gt;{4} &amp;nbsp; &amp;nbsp;&lt;/td&gt;&quot; +
			&quot;&lt;td align=\&quot;right\&quot; nowrap&gt;{5}&lt;/td&gt;&lt;/tr&gt;&quot; +
			&quot;&lt;tr&gt;&lt;td height=\&quot;8\&quot; colspan=\&quot;4\&quot;&gt;&lt;img id=\&quot;blank_spacer_img_id\&quot; alt=\&quot;\&quot; src=\&quot;&quot; + ImageFileID.BLANK_SPACER
			+ &quot;\&quot; width=\&quot;1\&quot; height=\&quot;8\&quot;&gt;&lt;/td&gt;&quot; +
			&quot;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&quot;;

		public String getMinimumBidCountString() {
<span class="nc" id="L1349">			return minimumBidCountString;</span>
		}

		public void setContentTitleItemClass(String cssClassName) {
<span class="nc" id="L1353">			contentTitleItemClass = cssClassName;</span>

<span class="nc" id="L1355">		}</span>

		public void setMinimumBidCountString(String str) {
<span class="nc" id="L1358">			minimumBidCountString = str;</span>
<span class="nc" id="L1359">		}</span>

		public void setCurrentBidCount(String str) {
<span class="nc" id="L1362">			currentBidCount = str;</span>
<span class="nc" id="L1363">		}</span>

<span class="nc" id="L1365">		public BaseBidOptionsContentTitlePC(RequestContext context) {</span>
<span class="nc" id="L1366">			super(context);</span>
<span class="nc" id="L1367">		}</span>

		private String getAdjustedTemplate() {
<span class="nc" id="L1370">			String cssString = &quot;&quot;;</span>
<span class="nc bnc" id="L1371" title="All 4 branches missed.">			if (contentTitleItemClass != null &amp;&amp; !contentTitleItemClass.isEmpty()) {</span>
<span class="nc" id="L1372">				cssString = String.format(&quot; class =\&quot;%s\&quot; &quot;, contentTitleItemClass);</span>
			}
<span class="nc" id="L1374">			String htmlTdElelemnt = String.format(CONTENT_TITLE_CELL, cssString);</span>
<span class="nc" id="L1375">			return BBO_DEFAULT_TMPL.replace(CONTENT_TITLE_CELL_PLACEHOLDER, htmlTdElelemnt);</span>
		}

		/**
		 * Get string of the HTML representing this component.
		 */
		@Override
		public String getHtmlDisplay() {
<span class="nc bnc" id="L1383" title="All 2 branches missed.">			if (!isVisible()) {</span>
<span class="nc" id="L1384">				return &quot;&quot;;</span>
			}
<span class="nc bnc" id="L1386" title="All 2 branches missed.">			if (StringUtil.isEmpty(getImage())) {</span>
<span class="nc" id="L1387">				setImage(ImageFileID.BLANK_SPACER);</span>
			}

			// Set the template first
<span class="nc bnc" id="L1391" title="All 2 branches missed.">			if (getTemplate() == null) {</span>
<span class="nc" id="L1392">				setTemplate(getAdjustedTemplate());</span>
			}

			// Set image
<span class="nc bnc" id="L1396" title="All 2 branches missed.">			String imageFile = getImage().equals(BBO_DEFAULT_IMAGE_NAME) ? BBO_DEFAULT_IMG_FILE : getImage();</span>
<span class="nc" id="L1397">			addComponent(imageFile);</span>

<span class="nc bnc" id="L1399" title="All 2 branches missed.">			addComponent((getPageTitle() == null ? &quot;&quot; : getPageTitle()) + m_context.getLocalizer().getScreenTitleSeparator());</span>
<span class="nc bnc" id="L1400" title="All 2 branches missed.">			addComponent(getItemName() == null ? &quot;&quot; : getItemName());</span>

<span class="nc bnc" id="L1402" title="All 2 branches missed.">			addComponent(getMinimumBidCountString().isEmpty() ? &quot;&quot; : getMinimumBidCountString());</span>
<span class="nc" id="L1403">			addComponent(currentBidCount);</span>

<span class="nc" id="L1405">			String actCompDisplay = getActiveComponentDisplay();</span>
<span class="nc" id="L1406">			addComponent(actCompDisplay);</span>

<span class="nc" id="L1408">			return super.getHtmlDisplay();</span>
		}//getHtmlDisplay

	}

	@Override
	public String getCustomJavaScript() {
<span class="nc" id="L1415">		return new StringBuilder(super.getCustomJavaScript())</span>
<span class="nc" id="L1416">			.append(getJSChangeWorkspaceAriaLabel(</span>
<span class="nc" id="L1417">				m_localizer.i18n(UIFWebBundleKey.BUNDLE_NAME, UIFWebBundleKey.WORK_PANE_DESCRIPTION,</span>
<span class="nc" id="L1418">					i18n(m_bundle, RmWebBundleKey.RM_SA_BID_OPTIONS), &quot;&quot;)))</span>
<span class="nc" id="L1419">			.toString();</span>

	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>