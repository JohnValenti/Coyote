<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>EmployeeSPListRow.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.bbm.people.profile.OptimizationPeopleProfile</a> &gt; <span class="el_source">EmployeeSPListRow.java</span></div><h1>EmployeeSPListRow.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.bbm.people.profile.OptimizationPeopleProfile;

import java.util.ArrayList;
import java.util.Date;
import java.util.Iterator;
import java.util.List;
import java.util.Map;
import java.util.ResourceBundle;
import java.util.TimeZone;

import com.bluepumpkin.common.base.Log;
import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.LocalDate;
import com.bluepumpkin.common.l10n.RegionalFormatBundleKey;
import com.bluepumpkin.common.localization.Localizer;
import com.bluepumpkin.common.logging.Category;
import com.bluepumpkin.common.util.StringUtil;
import com.bluepumpkin.common.util.TimeZoneUtil;
import com.bluepumpkin.ejb.bbm.workresource.model.Employee;
import com.bluepumpkin.ejb.bbm.workresource.model.EmployeeFieldInfo;
import com.bluepumpkin.ejb.bbm.workresource.model.EmployeeType;
import com.bluepumpkin.ejb.bbm.workresource.model.Person;
import com.bluepumpkin.web.bbm.employee.EmployeeListConfigFP;
import com.bluepumpkin.web.bbm.keys.BbmImageFileID;
import com.bluepumpkin.web.bbm.l10n.BbmWebLogBundleKey;
import com.witness.web.uif.jsp.HtmlImage;
import com.witness.web.uif.jsp.HtmlTableCell;
import com.witness.web.uif.jsp.HtmlTableRow;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.util.HtmlUtil;
import com.witness.web.uif.util.html.CSSUtil;

/**
 * Title:        EmployeeSPListRow
 * Description:  The object in the arraylist for the Employee List page used
 *  in optimization people profile add to SP pop up.
 * Copyright:    Copyright (c) 2001
 * Company:      Blue Pumpkin Software, inc
 * @author       Amit Kumar
 * @version      1.0
 *
 * The EmployeeSPListRow is determined by the Employee List Configuration Object.  If there is no
 * Employee List Configuration Object specified, then the default Employee List Configuration
 * object is used.  Since the contents of the row are dynamic, the row is defined as an
 * ordered list of propery names.  Each row contains the employee property data, plus a checkbox
 * for delete selection, plus a button for row edit.
 */
public class EmployeeSPListRow {
<span class="fc" id="L49">	private static Category log = Log.initCategory(EmployeeSPListRow.class.getName());</span>
	private Employee m_emp;
	private ArrayList m_values;
	private Localizer m_localizer;
	private HtmlTableRow m_rowWrapper;
	private HtmlTableCell m_cell;
	private int m_nRowIndex;
	private String m_sName;
	private boolean m_bShowWhoIsIn;
	private boolean m_isInSlaveMode;
	private TimeZone m_tz;
	private Map&lt;ID, EmployeeType&gt; employeeTypes;

	/**
	 * Construct the object from an employee and an array of fields
	 */
	public EmployeeSPListRow(RequestContext context, ResourceBundle bundle,
			Employee emp, int nRowIndex, String sName, List fldlist,
<span class="fc" id="L67">			boolean bShowWhoIsIn, boolean bIsInSlaveMode, Map&lt;ID, EmployeeType&gt; employeeTypes) {</span>
<span class="fc" id="L68">		m_localizer = context.getLocalizer();</span>
<span class="fc" id="L69">		m_tz = context.getViewingTimeZone();</span>
		//m_bundle = bundle;
<span class="fc" id="L71">		m_emp = emp;</span>
<span class="fc" id="L72">		m_sName = sName;</span>
<span class="fc" id="L73">		m_bShowWhoIsIn = bShowWhoIsIn;</span>
<span class="fc" id="L74">		m_isInSlaveMode = bIsInSlaveMode;</span>
<span class="fc" id="L75">		this.employeeTypes = employeeTypes;</span>

<span class="fc" id="L77">		m_cell = new HtmlTableCell();</span>
<span class="fc" id="L78">		m_cell.setAttribute(&quot;nowrap&quot;);</span>

<span class="fc" id="L80">		m_rowWrapper = new HtmlTableRow();</span>
<span class="fc" id="L81">		ID empID = (ID) emp.getFieldValue(EmployeeFieldInfo.EMPLOYEE_ID);</span>
<span class="fc" id="L82">		m_rowWrapper.setAttribute(&quot;uid&quot;, empID.toString());</span>
<span class="fc" id="L83">		m_nRowIndex = nRowIndex;</span>
<span class="fc" id="L84">		setFields(fldlist);</span>
<span class="fc" id="L85">	}</span>

	private void setFields(List fldlist) {
<span class="pc bpc" id="L88" title="1 of 2 branches missed.">		if (m_bShowWhoIsIn) setNameColumnCell();        // set whos in and out icons</span>

<span class="fc" id="L90">		m_cell.setAttribute(&quot;class&quot;, &quot;tblItemHand&quot;);</span>
<span class="fc" id="L91">		setNameValueCell(EmployeeFieldInfo.EMPLOYEE_FIRSTNAME, EmployeeFieldInfo.EMPLOYEE_LASTNAME,</span>
				EmployeeFieldInfo.EMPLOYEE_SUFFIX, EmployeeFieldInfo.EMPLOYEE_MIDDLEINITIAL);


<span class="fc" id="L95">		String js = m_sName + &quot;.onSelect('r&quot; + m_nRowIndex + &quot;');&quot; +</span>
				&quot; jQuery('#selectedID').val(&quot; + m_sName + &quot;.getMultiExpandoAttribute('uid'));&quot;;

<span class="fc" id="L98">		m_rowWrapper.setAttribute(&quot;onClick&quot;,js);</span>

<span class="fc" id="L100">		m_rowWrapper.setAttribute(&quot;class&quot;, &quot;tblRowHand&quot;);</span>

		// set row attributes that indicate if this employee can be deleted
<span class="pc bpc" id="L103" title="2 of 4 branches missed.">		m_rowWrapper.setAttribute(&quot;del&quot;, m_emp.canDelete() &amp;&amp; !m_isInSlaveMode ? &quot;true&quot; : &quot;false&quot;);</span>

		// set row attributes that indicate if this employee can be terminated
<span class="pc bpc" id="L106" title="2 of 4 branches missed.">		m_rowWrapper.setAttribute(&quot;term&quot;, m_emp.canTerminate() &amp;&amp; !m_isInSlaveMode ? &quot;true&quot; : &quot;false&quot;);</span>

		// employee can only be edited if its NOT readonly
<span class="pc bpc" id="L109" title="1 of 2 branches missed.">		m_rowWrapper.setAttribute(&quot;edit&quot;, m_emp.isReadOnly() ? &quot;false&quot; : &quot;true&quot;);</span>

		// Now fill in the row data
<span class="pc bpc" id="L112" title="2 of 4 branches missed.">		if (fldlist != null &amp;&amp; fldlist.size() &gt; 0) {</span>
			// for each of the fields, add the values in the proper order to the ArrayList.  The number of values
			// is exactly equal to the number of fields, so reset the array list.
<span class="fc bfc" id="L115" title="All 2 branches covered.">			for (Iterator it = fldlist.iterator(); it.hasNext();) {</span>
<span class="fc" id="L116">				addTableValue((EmployeeListConfigFP) it.next());</span>
			}
		}
<span class="fc" id="L119">	}</span>

	private void setSecureFieldCell() {
<span class="nc" id="L122">		m_cell.setAttribute(&quot;class&quot;, &quot;tblSecure&quot;);</span>
<span class="nc" id="L123">		m_cell.setInnerHtml(&quot;&amp;nbsp;&quot;);</span>
<span class="nc" id="L124">		m_rowWrapper.add(m_cell.toString());</span>
<span class="nc" id="L125">	}</span>

	private void setExceptionFieldCell() {
<span class="nc" id="L128">		m_cell.setInnerHtml(&quot;DATA-EXCEPTION&quot;);</span>
<span class="nc" id="L129">		m_rowWrapper.add(m_cell.toString());</span>
<span class="nc" id="L130">	}</span>

	private void setRegularFieldCell(int nFldID) {
<span class="fc" id="L133">		Object objValue = m_emp.getEmployeeFieldValue(nFldID);</span>
<span class="fc" id="L134">		m_cell.setStyle(null);</span>

<span class="fc bfc" id="L136" title="All 2 branches covered.">		if (objValue instanceof String) {</span>
<span class="fc" id="L137">			String value = objValue.toString();</span>
<span class="fc bfc" id="L138" title="All 2 branches covered.">			if (StringUtil.isEmpty(value.trim())) value=HtmlUtil.NBSP;</span>
<span class="fc" id="L139">			m_cell.setInnerHtml(value);</span>
<span class="pc bpc" id="L140" title="1 of 4 branches missed.">		} else if (objValue instanceof Integer || objValue instanceof Long) {</span>
<span class="fc" id="L141">			Number value = (Number)objValue;</span>
<span class="fc" id="L142">			m_cell.setStyle(CSSUtil.STYLE_NUMERIC);</span>
<span class="fc" id="L143">			m_cell.setInnerHtml(m_localizer.formatNumber(value.longValue()));</span>
<span class="pc bpc" id="L144" title="1 of 4 branches missed.">		} else if (objValue instanceof Float || objValue instanceof Double) {</span>
<span class="fc" id="L145">			Number value = (Number)objValue;</span>
<span class="fc" id="L146">			m_cell.setStyle(CSSUtil.STYLE_NUMERIC);</span>
<span class="fc" id="L147">			m_cell.setInnerHtml(m_localizer.formatNumber(value.doubleValue(), 2));</span>
<span class="fc bfc" id="L148" title="All 2 branches covered.">		} else if (objValue instanceof Boolean) {</span>
<span class="fc" id="L149">			boolean bFlag = ((Boolean) objValue).booleanValue();</span>
<span class="fc" id="L150">			m_cell.setInnerHtml(m_localizer.formatYesNo(bFlag));</span>
<span class="fc bfc" id="L151" title="All 2 branches covered.">		} else if (objValue instanceof LocalDate) {</span>
<span class="fc" id="L152">			LocalDate localdate = (LocalDate) objValue;</span>
<span class="fc" id="L153">			m_cell.setInnerHtml(m_localizer.formatDate(localdate, RegionalFormatBundleKey.MEDIUM_DATE_FORMAT));</span>
<span class="pc bpc" id="L154" title="1 of 2 branches missed.">		} else if (objValue instanceof Date) {</span>
<span class="nc" id="L155">			Date date = (Date) objValue;</span>
			// use GMT for formatting Birthday since that is the way DE saves and displays the birthdate
<span class="nc bnc" id="L157" title="All 2 branches missed.">			TimeZone tz = (nFldID==EmployeeFieldInfo.EMPLOYEE_BIRTHDATE) ? TimeZoneUtil.GMT_TIMEZONE : m_tz;</span>
<span class="nc" id="L158">			m_cell.setInnerHtml(m_localizer.formatDate(date, tz, RegionalFormatBundleKey.MEDIUM_DATE_FORMAT));</span>
<span class="nc" id="L159">		} else {</span>
<span class="pc bpc" id="L160" title="1 of 2 branches missed.">			if (objValue == null)	objValue = HtmlUtil.NBSP;</span>
<span class="fc" id="L161">			m_cell.setInnerHtml(objValue);</span>
		}

<span class="fc" id="L164">		m_rowWrapper.add(m_cell.toString());</span>
<span class="fc" id="L165">	}</span>

	private void addTableValue(EmployeeListConfigFP fld) {
<span class="fc" id="L168">		int nFldID = fld.getFieldID();</span>
		try {
<span class="fc" id="L170">			m_cell.setAttribute(&quot;class&quot;, &quot;tblItemHand&quot;);</span>

			// Using switch makes it easy to handle more special cases (ex: when user defined fields are added)
<span class="pc bpc" id="L173" title="1 of 4 branches missed.">			switch (nFldID){</span>
			// special case the supervisor ID so that the actual name is placed into the field
			case EmployeeFieldInfo.EMPLOYEE_SUPERVISORID:
				// No field ID for supervisor suffix and middle initial so pass -1.
<span class="fc" id="L177">				setNameValueCell(EmployeeFieldInfo.EMPLOYEE_SUPERVISORFIRSTNAME, EmployeeFieldInfo.EMPLOYEE_SUPERVISORLASTNAME,</span>
				                 -1, -1);
<span class="fc" id="L179">				break;</span>
            // special case the teamlead ID so that the actual name is placed into the field
			case EmployeeFieldInfo.EMPLOYEE_TEAMLEADID:
				// No field ID for teamlead suffix and middle initial so pass -1.
<span class="fc" id="L183">				setNameValueCell(EmployeeFieldInfo.EMPLOYEE_TEAMLEADFIRSTNAME, EmployeeFieldInfo.EMPLOYEE_TEAMLEADLASTNAME,</span>
				                 -1, -1);
<span class="fc" id="L185">				break;</span>
			case EmployeeFieldInfo.EMPLOYEE_EMPLOYEETYPE:
<span class="nc" id="L187">				setEmployeeTypeValueCell(nFldID);</span>
<span class="nc" id="L188">				break;</span>

			default:
<span class="pc bpc" id="L191" title="1 of 2 branches missed.">				if (m_emp.isFieldViewable(nFldID))</span>
<span class="fc" id="L192">					setRegularFieldCell(nFldID);</span>
				else
<span class="nc" id="L194">					setSecureFieldCell();</span>
			}//end switch
<span class="nc" id="L196">		} catch (Exception ex) {</span>
<span class="nc" id="L197">			getLog().l7dError(BbmWebLogBundleKey.EMP_LISTROW_BROKEN_FIELD_ACCESS_MF, new Object[]{fld.getFieldName()});</span>
<span class="nc" id="L198">			setExceptionFieldCell();</span>
<span class="fc" id="L199">		}</span>
<span class="fc" id="L200">	}</span>

	private void setEmployeeTypeValueCell(int nFldID) {
<span class="nc bnc" id="L203" title="All 2 branches missed.">		if (!m_emp.isFieldViewable(nFldID)) {</span>
<span class="nc" id="L204">			setSecureFieldCell();</span>
		} else {
<span class="nc" id="L206">			String empTypeName = getEmployeeTypeName();</span>
<span class="nc bnc" id="L207" title="All 4 branches missed.">			if (empTypeName == null || empTypeName.isEmpty()) {</span>
<span class="nc" id="L208">				m_cell.setInnerHtml(HtmlUtil.NBSP);</span>
			} else {
<span class="nc" id="L210">				m_cell.setInnerHtml(empTypeName);</span>
			}

<span class="nc" id="L213">			m_rowWrapper.add(m_cell.toString());</span>
		}
<span class="nc" id="L215">	}</span>

	private void setNameValueCell(int nFirstName, int nLastName, int nSuffix, int middleInit) {
<span class="pc bpc" id="L218" title="2 of 4 branches missed.">		if (!m_emp.isFieldViewable(nFirstName) || !m_emp.isFieldViewable(nLastName)) {</span>
<span class="nc" id="L219">			setSecureFieldCell();</span>
		} else {
<span class="fc" id="L221">			String sFirstName = (String) m_emp.getEmployeeFieldValue(nFirstName);</span>
<span class="fc" id="L222">			String sLastName = (String) m_emp.getEmployeeFieldValue(nLastName);</span>
<span class="pc bpc" id="L223" title="1 of 4 branches missed.">			if (!StringUtil.isEmpty(sFirstName) &amp;&amp; !StringUtil.isEmpty(sLastName)) {</span>
<span class="fc" id="L224">				Person personName = new Person();</span>
<span class="fc" id="L225">				personName.setFirstName(sFirstName);</span>
<span class="fc" id="L226">				personName.setLastName(sLastName);</span>
				// Ignore -1 passed for supervisor middle initial and suffix because there is no field ID for those fields.
<span class="pc bpc" id="L228" title="2 of 4 branches missed.">				if ((nSuffix &gt; 0) &amp;&amp; m_emp.isFieldViewable(nSuffix)) {</span>
<span class="fc" id="L229">					personName.setSuffix((String) m_emp.getEmployeeFieldValue(nSuffix));</span>
				}

<span class="pc bpc" id="L232" title="2 of 4 branches missed.">				if((middleInit &gt; 0) &amp;&amp; m_emp.isFieldViewable(middleInit)) {</span>
<span class="fc" id="L233">					personName.setMiddleInitial((String) m_emp.getEmployeeFieldValue(middleInit));</span>
				}

<span class="fc" id="L236">				String displayName = m_localizer.formatFullName(personName);</span>
<span class="fc" id="L237">				m_cell.setInnerHtml(displayName);</span>
<span class="fc" id="L238">			} else {</span>
<span class="fc" id="L239">				m_cell.setInnerHtml(HtmlUtil.NBSP);</span>
			}
<span class="fc" id="L241">			m_rowWrapper.add(m_cell.toString());</span>
		}
<span class="fc" id="L243">	}</span>

	private void setNameColumnCell() {
<span class="nc" id="L246">		m_cell.setAttribute(&quot;class&quot;, &quot;tblIcon&quot;);</span>
<span class="nc" id="L247">		m_cell.removeAttribute(&quot;nowrap&quot;);</span>
<span class="nc bnc" id="L248" title="All 2 branches missed.">		HtmlImage img = new HtmlImage(m_emp.isLoggedIn() ? BbmImageFileID.PERSON_IN : BbmImageFileID.PERSON_OUT);</span>
<span class="nc" id="L249">		img.setAttribute(&quot;width&quot;, &quot;24px&quot;);</span>
<span class="nc" id="L250">		img.setAttribute(&quot;height&quot;, &quot;18px&quot;);</span>
<span class="nc" id="L251">		m_cell.setInnerHtml(img.toString());</span>
<span class="nc" id="L252">		m_rowWrapper.add(m_cell.toString());</span>
<span class="nc" id="L253">		m_cell.setAttribute(&quot;nowrap&quot;);</span>
<span class="nc" id="L254">	}</span>

	/**
	 * Get the ArrayList of values for this row.  The name is always part of the row.
	 */
	public ArrayList getValueList() {
<span class="pc bpc" id="L260" title="1 of 2 branches missed.">		if (m_values == null) {</span>
<span class="fc" id="L261">			m_values = new ArrayList();</span>
<span class="fc" id="L262">			m_values.add(m_rowWrapper);</span>
		}
<span class="fc" id="L264">		return m_values;</span>
	}

	protected String getEmployeeTypeName() {
<span class="nc" id="L268">		EmployeeType empType = this.employeeTypes.get(this.m_emp.getEmployeeType());</span>
<span class="nc bnc" id="L269" title="All 2 branches missed.">		String empTypeName = empType != null ? empType.getDescription() : &quot;&quot;;</span>
<span class="nc" id="L270">		return empTypeName;</span>
	}

	protected Category getLog() {
<span class="nc" id="L274">		return log;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>