<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>PayrollExportErrorDAO.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.ejb.am.payrollmanager.ejb</a> &gt; <span class="el_source">PayrollExportErrorDAO.java</span></div><h1>PayrollExportErrorDAO.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.ejb.am.payrollmanager.ejb;

/**
 * Title:        Blue Pumpkin Software Activity Management
 * Description:  DAO of PayrollExportError
 * Copyright:    Copyright (c) 2001
 * Company:      Blue Pumpkin Software, inc
 * @author       Sheng Song
 * @version 1.0
 */

import java.util.ArrayList;
import java.util.Collection;
import java.util.Date;
import java.util.HashMap;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.jdmo.Jdmo;
import com.bluepumpkin.common.jdmo.JdmoException;
import com.bluepumpkin.common.jdmo.JdmoQuery;
import com.bluepumpkin.common.jdmo.JdmoRowset;
import com.bluepumpkin.common.util.TimeZoneUtil;
import com.bluepumpkin.ejb.am.payrollmanager.model.PayrollExportError;

class PayrollExportErrorDAO {
	private final static int ARGLENGTH = 256;
	/**
	* default constructor
	*/
<span class="nc" id="L30">	public PayrollExportErrorDAO() {}</span>
	/**
	 * Used by the UI to create TimeInterval, which will creat a new TimeRecord
	 * @param ID
	 * @param String, Bundle
	 * @param String, Key
	 * @param Object[]
	 * @return ID, Error ID
	 */
	public static ID createPayrollExportError(ID statusID, String bundle, String key, Object[] param) throws JdmoException
	{
<span class="nc" id="L41">		Jdmo jdmo = new Jdmo();</span>
		try {
<span class="nc" id="L43">			Object[] parm = new Object[1];</span>
<span class="nc" id="L44">			parm[0] = statusID;</span>
<span class="nc" id="L45">			String pStmt1 =</span>
				&quot;delete PAYROLLEXPORTERROR where PAYROLLSTATUSID=?&quot;;
<span class="nc" id="L47">			jdmo.executePCommand(pStmt1, parm);</span>
<span class="nc" id="L48">			HashMap map = new HashMap();</span>
			// save basic request information
<span class="nc" id="L50">			map.put(&quot;PAYROLLSTATUSID&quot;, statusID);</span>
<span class="nc" id="L51">			map.put(&quot;BUNDLEFILENAME&quot;, bundle);</span>
<span class="nc" id="L52">			map.put(&quot;MESSAGEKEY&quot;, key);</span>
<span class="nc bnc" id="L53" title="All 2 branches missed.">			if (param != null) {</span>
<span class="nc bnc" id="L54" title="All 2 branches missed.">				for (int i=1; i&lt;=param.length; i++) {</span>
<span class="nc bnc" id="L55" title="All 2 branches missed.">					if (param[i-1] != null) {</span>
<span class="nc" id="L56">						String value = param[i-1].toString();</span>
<span class="nc bnc" id="L57" title="All 2 branches missed.">						if (value.length() &gt; ARGLENGTH)</span>
<span class="nc" id="L58">							value = value.substring(0, ARGLENGTH);</span>
<span class="nc" id="L59">						map.put(&quot;ARG&quot;+i, value);</span>
					} else
						continue;
				}
			}
<span class="nc" id="L64">			map.put(&quot;CREATETIME&quot;, TimeZoneUtil.toTimestamp(new Date()));</span>
<span class="nc" id="L65">			ID id = jdmo.addBatchInsert(&quot;PAYROLLEXPORTERROR&quot;, map);</span>
<span class="nc" id="L66">			jdmo.executeBatch();</span>
<span class="nc" id="L67">			return id;</span>
		} finally {
<span class="nc bnc" id="L69" title="All 4 branches missed.">			if (jdmo != null)</span>
<span class="nc" id="L70">				jdmo.cleanUp();</span>
		}
	}
	/**
	 * remove an error
	 * @param ID, error ID
	 */
	public static void removePayrollExportError(ID errorID) throws JdmoException
	{
<span class="nc" id="L79">		Jdmo jdmo = new Jdmo();</span>
		try {
<span class="nc" id="L81">			Object[] param = new Object[1];</span>
<span class="nc" id="L82">			param[0] = errorID;</span>
<span class="nc" id="L83">			String pStmt1 =</span>
				&quot;delete PAYROLLEXPORTERROR where ID=?&quot;;
<span class="nc" id="L85">			jdmo.executePCommand(pStmt1, param);</span>
		} finally {
<span class="nc bnc" id="L87" title="All 4 branches missed.">			if (jdmo != null)</span>
<span class="nc" id="L88">				jdmo.cleanUp();</span>
		}
<span class="nc" id="L90">	}</span>
	/**
	 * remove an error
	 * @param ID, error ID
	 */
	public static void removePayrollExportErrorByStatusID(ID statusID) throws JdmoException
	{
<span class="nc" id="L97">		Jdmo jdmo = new Jdmo();</span>
		try {
<span class="nc" id="L99">			Object[] param = new Object[1];</span>
<span class="nc" id="L100">			param[0] = statusID;</span>
<span class="nc" id="L101">			String pStmt1 =</span>
				&quot;delete PAYROLLEXPORTERROR where PAYROLLSTATUSID=?&quot;;
<span class="nc" id="L103">			jdmo.executePCommand(pStmt1, param);</span>
		} finally {
<span class="nc bnc" id="L105" title="All 4 branches missed.">			if (jdmo != null)</span>
<span class="nc" id="L106">				jdmo.cleanUp();</span>
		}
<span class="nc" id="L108">	}</span>
	/**
	 * retrieve errors
	 * @param ID, PayrollStatus ID
	 * @return Collection
	 */
	public static Collection getPayrollExportErrorForStatus(ID statusID) throws JdmoException
	{
<span class="nc" id="L116">		Jdmo jdmo = new Jdmo();</span>
		try {
<span class="nc" id="L118">			String pStmt1 =</span>
&quot;select ID, BUNDLEFILENAME, MESSAGEKEY, ARG1, ARG2, ARG3, ARG4, ARG5, ARG6, ARG7, ARG8, ARG9, ARG10, CREATETIME from PAYROLLEXPORTERROR where PAYROLLSTATUSID=? order by CREATETIME asc&quot;;
<span class="nc" id="L120">			JdmoQuery jQuery1 = jdmo.createQuery(pStmt1, Jdmo.PARAM_QUERY);</span>
<span class="nc" id="L121">			jQuery1.setParID(1, statusID);</span>
<span class="nc" id="L122">			JdmoRowset rs = jdmo.createRowset(jQuery1, Jdmo.FORWARD_ONLY, Jdmo.READ_ONLY);</span>
<span class="nc" id="L123">			ArrayList errorList = new ArrayList();</span>
<span class="nc bnc" id="L124" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L125">				PayrollExportError pee = new PayrollExportError(</span>
<span class="nc" id="L126">											rs.getID(&quot;ID&quot;),</span>
<span class="nc" id="L127">											rs.getString(&quot;BUNDLEFILENAME&quot;),</span>
<span class="nc" id="L128">											rs.getString(&quot;MESSAGEKEY&quot;),</span>
<span class="nc" id="L129">											TimeZoneUtil.toDate(rs.getTimestamp(&quot;CREATETIME&quot;)));</span>
<span class="nc" id="L130">				String[] param = new String[10];</span>
<span class="nc bnc" id="L131" title="All 2 branches missed.">				for (int i=1; i&lt;=10; i++)</span>
<span class="nc" id="L132">					param[i-1] = rs.getString(&quot;ARG&quot;+i);</span>
<span class="nc" id="L133">				pee.setMessageArgs(param);</span>
<span class="nc" id="L134">				errorList.add(pee);</span>
<span class="nc" id="L135">			}</span>
<span class="nc" id="L136">			return errorList;</span>
		} finally {
<span class="nc bnc" id="L138" title="All 4 branches missed.">			if (jdmo != null)</span>
<span class="nc" id="L139">				jdmo.cleanUp();</span>
		}
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>