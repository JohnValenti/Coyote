<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>ActivityFormPageModel.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.bbm.activity</a> &gt; <span class="el_source">ActivityFormPageModel.java</span></div><h1>ActivityFormPageModel.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.bbm.activity;

import java.rmi.RemoteException;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collection;
import java.util.Collections;
import java.util.Iterator;

import javax.servlet.http.HttpServletRequest;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.StringsPair;
import com.bluepumpkin.common.keys.DBInfo;
import com.bluepumpkin.common.logging.Category;
import com.bluepumpkin.common.util.StringUtil;
import com.bluepumpkin.ejb.bbm.activity.model.Activity;
import com.bluepumpkin.ejb.bbm.activity.model.ActivityFieldInfo;
import com.bluepumpkin.ejb.bbm.activity.model.ActivityProperties;
import com.bluepumpkin.ejb.bbm.base.BbmException;
import com.bluepumpkin.ejb.bbm.paypolicy.model.EarningTypeManager;
import com.bluepumpkin.ejb.bbm.workload.model.Media;
import com.bluepumpkin.ejb.bbm.workresource.OrganizationScopeManagerProxy;
import com.bluepumpkin.ejb.bbm.workresource.model.Organization;
import com.bluepumpkin.ejb.core.CoreManagerFactory;
import com.bluepumpkin.web.bbm.Log;
import com.bluepumpkin.web.bbm.earningtype.EarningTypeModelHandler;
import com.bluepumpkin.web.bbm.l10n.BbmWebBundleKey;
import com.bluepumpkin.web.bbm.l10n.BbmWebLogBundleKey;
import com.bluepumpkin.web.bbm.organization.OrgWorkpaneFormPageModel;
import com.bluepumpkin.web.bbm.organization.OrganizationModelHandler;
import com.bluepumpkin.web.bbm.workload.MediaSelectorPopupPageModel;
import com.bluepumpkin.web.bbm.workload.WorkloadModelHandler;
import com.bluepumpkin.web.bbm.workload.queue.QueueSelectorPopupPageModel;
import com.bluepumpkin.web.core.setup.mediatypes.MediaTypesSetupPageModel;
import com.verint.web.wfm.keys.WfmJavaScriptFileID;
import com.witness.ejb.core.licensing.LicenseKeys;
import com.witness.ejb.core.licensing.ejb.LicenseManager;
import com.witness.ejb.core.security.PrivilegeKeys;
import com.witness.web.uif.base.Message;
import com.witness.web.uif.keys.ImageFileID;
import com.witness.web.uif.keys.JavaScriptFileID;
import com.witness.web.uif.keys.PageAction;
import com.witness.web.uif.l10n.UIFWebBundleKey;
import com.witness.web.uif.pagecomponent.form.FormTwoColumnPC;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.util.ColorUtil;
import com.witness.web.uif.util.HtmlUtil;
import com.witness.web.uif.util.html.CSSUtil;
import com.witness.web.uif.util.html.HtmlChoiceInput;
import com.witness.web.uif.util.js.JSUtil;
import com.witness.web.uif.validator.IsEnteredFieldValidator;

/**
 * Title:        ActivityFormPageModel
 * Description:  Display a form for activity
 * Copyright:    Copyright (c) 2001
 * Company:      Blue Pumpkin Software, inc
 * @author       Shimon Kakon
 * @version 1.0
 */
@SuppressWarnings(&quot;serial&quot;)
public class ActivityFormPageModel extends OrgWorkpaneFormPageModel {
<span class="fc" id="L64">	private static final Category log = Log.initCategory(ActivityFormPageModel.class.getName());</span>
	private Activity m_activity;
	private ActivityProperties activityProperties;

	private Collection&lt;ID&gt; m_mediaIds;
<span class="fc" id="L69">	private boolean m_hasMedia = false;</span>
<span class="fc" id="L70">	private boolean m_hasProjectMedia = false;</span>

	//the queue hopping (or Project) queueIDs linked to this activity (if any)
	private Collection&lt;ID&gt; m_queueIds;
	//does this activity have any queue hopping (or Project) queues linked to it?
<span class="fc" id="L75">	private boolean m_hasQueues = false;</span>

	private Collection&lt;StringsPair&gt; m_activityTypeStringPair;
	private Collection&lt;StringsPair&gt; m_earningTypeStringPair;
	private String m_selectedActivityType;
	private String m_selectedEarningType;
	private FormTwoColumnPC m_formPC;
	private final ActivityUsage m_fsUsagePC;
	private final ActivityUsage m_rmUsagePC;
	private final ActivityUsage m_amUsagePC;
	private final ActivityUsage m_advisorUsagePC;
<span class="fc" id="L86">	private final StringBuffer m_hiddenFields = new StringBuffer(512);</span>
	private short[] m_displayMap;

	// Constants
	public static final boolean PAID_DEFAULT = false;
	public static final boolean TIMEOFF_DEFAULT = false;
<span class="fc" id="L92">	public static final ID EARNING_TYPE_DEFAULT = EarningTypeManager.REGULAR;</span>
	private static final String ACTIVITY_COLOR_PICKER_NAME = &quot;POPUP_ACTIVITY_COLOR_PICKER&quot;;
	private static final String ACTIVITY_COLOR_DEFAULT = &quot;#F7FFCF&quot;;

	private static final String MEDIA_NAMES_DISPLAY_FN = &quot;mediaNamesDisplay&quot;;
	private static final String MEDIA_NAMES_DISPLAY_SPAN = &quot;mediaSpan&quot;;
	private static final String ACTIVITY_FIELD_ON_CHANGE = &quot;activityOnChange(this);&quot;;

	private static final String QUEUE_NAMES_DISPLAY_FN = &quot;queueNamesDisplay&quot;;
	private static final String QUEUE_NAMES_DISPLAY_SPAN = &quot;queueSpan&quot;;

<span class="fc" id="L103">	private boolean hasPayrollLicense = false;</span>
<span class="fc" id="L104">	private boolean hasMultiMediaLicense = false;</span>
<span class="fc" id="L105">	private boolean hasQueueHoppingLicense = false;</span>
<span class="fc" id="L106">	private boolean hasAdvisorLicense = false;</span>

	/**
	 * Constructor
	 *
	 * @param context Request Context
	 */
	public ActivityFormPageModel(RequestContext context) {
<span class="fc" id="L114">		super(context);</span>
<span class="fc" id="L115">		addRequiredJavaScriptFile(JavaScriptFileID.JQUERY);</span>
<span class="fc" id="L116">		m_activity = new Activity();</span>
<span class="fc" id="L117">		activityProperties = new ActivityProperties();</span>

		// PC needed for extract parameters
<span class="fc" id="L120">		m_fsUsagePC = new ActivityFSUsage(context, m_bbmBundle, m_activity, activityProperties);</span>
<span class="fc" id="L121">		addChildComponent(m_fsUsagePC);</span>
<span class="fc" id="L122">		m_rmUsagePC = new ActivityRMUsage(context, m_bbmBundle, m_activity, activityProperties);</span>
<span class="fc" id="L123">		addChildComponent(m_rmUsagePC);</span>
<span class="fc" id="L124">		m_amUsagePC = new ActivityAMUsage(context, m_bbmBundle, m_activity, activityProperties);</span>
<span class="fc" id="L125">		addChildComponent(m_amUsagePC);</span>
<span class="fc" id="L126">		m_advisorUsagePC = new ActivityAdvisorUsage(context, m_bbmBundle, m_activity, activityProperties);</span>
<span class="fc" id="L127">		addChildComponent(m_advisorUsagePC);</span>
<span class="fc" id="L128">	}</span>


	public boolean extractParameters(HttpServletRequest request) {
<span class="fc" id="L132">		boolean success=super.extractParameters(request);</span>

		// now get the value for check boxes since checkboxes values are not
		// submitted with a form if they are not checked

<span class="fc" id="L137">		String boolValue = request.getParameter(ActivityFields.PAID_FN);</span>
<span class="fc bfc" id="L138" title="All 2 branches covered.">		setPaid(!StringUtil.isEmpty(boolValue));</span>

<span class="fc" id="L140">		boolValue = request.getParameter(ActivityFields.TIMEOFF_FN);</span>
<span class="fc bfc" id="L141" title="All 2 branches covered.">		setTimeoff(!StringUtil.isEmpty(boolValue));</span>

<span class="fc" id="L143">		boolValue = request.getParameter(ActivityFields.QUEUE_HOPPING_FN);</span>
<span class="fc bfc" id="L144" title="All 2 branches covered.">		setQueueHopping(!StringUtil.isEmpty(boolValue));</span>

<span class="fc" id="L146">		boolValue = request.getParameter(ActivityFields.CAN_WORK_REMOTELY_FN);</span>
<span class="pc bpc" id="L147" title="1 of 2 branches missed.">		setAllowRemote(!StringUtil.isEmpty(boolValue));</span>

<span class="fc" id="L149">		setSourceMeasureNullObjectIfNull();</span>

<span class="fc" id="L151">		return success;</span>
	}

	public boolean extractActivityPropertiesParameters(HttpServletRequest request) {
<span class="fc" id="L155">		super.extractParameters(request);</span>

<span class="fc" id="L157">		String boolValue = request.getParameter(ActivityFields.USE_DAILY_TOPOOL_FN);</span>
<span class="pc bpc" id="L158" title="1 of 2 branches missed.">		setUseDailyTOPool(!StringUtil.isEmpty(boolValue));</span>

<span class="fc" id="L160">		boolValue = request.getParameter(ActivityFields.USE_INTERVAL_TOPOOL_FN);</span>
<span class="pc bpc" id="L161" title="1 of 2 branches missed.">		setUseIntervalTOPool(!StringUtil.isEmpty(boolValue));</span>

<span class="fc" id="L163">		String flex = request.getParameter(ActivityFields.TIMEOFF_WITH_FLEX_FN);</span>
<span class="pc bpc" id="L164" title="1 of 2 branches missed.">		setTimeoffWithFlex(!StringUtil.isEmpty(flex) ? Integer.valueOf(flex).intValue() : ActivityProperties.TIME_OFF_TIME);</span>

<span class="fc" id="L166">		return true;</span>
	}


	/**
	 * Initialize Component For Display
	 */
	public void initForDisplay() {
<span class="pc bpc" id="L174" title="1 of 2 branches missed.">		if (m_isInitializedForDisplay) {</span>
<span class="nc" id="L175">			return;</span>
		}else {
<span class="fc" id="L177">			m_displayMap = ActivityFields.getDisplayMap(getActivityID());</span>
<span class="fc" id="L178">			super.initForDisplay();</span>
<span class="fc" id="L179">			addForm(m_formPC);</span>
<span class="fc" id="L180">			int numOfForms = 1;</span>
<span class="pc bpc" id="L181" title="1 of 2 branches missed.">			if(isAuthorizedToConfigureFSAttributes(getSelectedIDObject())) {</span>
<span class="pc bpc" id="L182" title="1 of 2 branches missed.">				if(ActivityFields.hasDisplayableField(m_displayMap, ActivityFields.FS)) {</span>
<span class="fc" id="L183">					addForm(m_fsUsagePC);</span>
<span class="fc" id="L184">					numOfForms++;</span>
				}
<span class="pc bpc" id="L186" title="1 of 2 branches missed.">				if(ActivityFields.hasDisplayableField(m_displayMap, ActivityFields.RM)) {</span>
<span class="fc" id="L187">					addForm(m_rmUsagePC);</span>
<span class="fc" id="L188">					numOfForms++;</span>
				}
			}
<span class="pc bpc" id="L191" title="2 of 4 branches missed.">			if(isAuthorizedToConfigureAMAttributes(getSelectedIDObject()) &amp;&amp; ActivityFields.hasDisplayableField(m_displayMap, ActivityFields.AM)) {</span>
<span class="fc" id="L192">				addForm(m_amUsagePC);</span>
<span class="fc" id="L193">				numOfForms++;</span>
			}
			//show advisor form only if license
<span class="pc bpc" id="L196" title="1 of 2 branches missed.">			if (hasAdvisorLicense){</span>
<span class="fc" id="L197">				addForm(m_advisorUsagePC);</span>
<span class="fc" id="L198">				numOfForms++;</span>
			}
<span class="pc bpc" id="L200" title="1 of 2 branches missed.">			if(numOfForms &gt; 1) {</span>
<span class="fc" id="L201">				m_formPC.setWrapperCSSClass(CSSUtil.CLASS_BORDER_DEFAULT);</span>
			}
<span class="fc" id="L203">			addRequiredJavaScriptFile(JavaScriptFileID.MODULE_POPUPBUTTON);</span>
<span class="fc" id="L204">			addRequiredJavaScriptFile(JavaScriptFileID.MEDIATOR_WORKPANE_FORM);</span>
<span class="fc" id="L205">			setJSMediator(WfmJavaScriptFileID.MEDIATOR_ACTIVITY_WORKPANE_FORM);</span>
<span class="fc" id="L206">			addRequiredJavaScriptFile(WfmJavaScriptFileID.MEDIA_SELECTOR_POPUP);</span>
<span class="fc" id="L207">			addRequiredJavaScriptFile(WfmJavaScriptFileID.QUEUE_SELECTOR_POPUP);</span>
<span class="fc" id="L208">			addRequiredJavaScriptFile(WfmJavaScriptFileID.ACTIVITY_ON_CHANGE);</span>

			// Color picker popup
<span class="fc" id="L211">			addPopupArgs(ACTIVITY_COLOR_PICKER_NAME,</span>
				&quot;activity_color_picker&quot;,
				&quot;name=&quot; + ActivityFields.COLOR_FN, null,
					&quot;700,345,150,150&quot;, true, 1);

			// Media selector popup
<span class="fc" id="L217">			addPopupArgs(MediaSelectorPopupPageModel.MEDIA_SELECTOR_POPUP_ACTION,</span>
				MediaSelectorPopupPageModel.MEDIA_SELECTOR_POPUP_URL, ActivityFields.MEDIA_FN, null,
				MediaSelectorPopupPageModel.MEDIA_SELECTOR_POPUP_SIZE_POSITION, true, 1);

			// Queue selector popup
<span class="fc" id="L222">			addPopupArgs(QueueSelectorPopupPageModel.QUEUE_SELECTOR_POPUP_ACTION,</span>
				QueueSelectorPopupPageModel.QUEUE_SELECTOR_POPUP_URL , ActivityFields.QUEUES_FN+&quot;,&quot;+
							ActivityFields.MEDIA_FN+&quot;,&quot;+ActivityFields.OWNER_ORG_FN, null,
				QueueSelectorPopupPageModel.QUEUE_SELECTOR_POPUP_SIZE_POSITION, true, 1);
		}
<span class="fc" id="L227">	}</span>


	/**
	 * Return instance of Model which is ready to be rendered
	 *
	 * @param context Request Context
	 */
	public static ActivityFormPageModel getInstance(RequestContext context) {
<span class="fc" id="L236">		return (ActivityFormPageModel)getInstance(context, ActivityFormPageModel.class);</span>
	}

	/**
	 * Return the form title
	 *
	 * @return form title
	 */
	public String getFormTitle() {
<span class="fc" id="L245">		return i18n(m_bbmBundle, BbmWebBundleKey.ACTIVITY_FORM_TITLE);</span>
	}

	/**
	 * Return the Organization ID as a String. The selected ID is not always the
	 * owner org that is display in the form. For example - system activities org
	 * owner is the root, which cannot be selected from the selection pane.
	 * @return form title
	 */
	public String getOrganizationId() {
<span class="fc" id="L255">		return m_activity.getOrganizationId().toString();</span>
	}

	public void setOrganizationId(String id) {
<span class="fc" id="L259">		m_activity.setOrganizationId( new ID(id) );</span>
<span class="fc" id="L260">	}</span>

	public ID getActivityID() {
<span class="fc bfc" id="L263" title="All 2 branches covered.">		if (m_performActionOnIDs == null) {</span>
<span class="fc" id="L264">			return null;</span>
		} else {
<span class="fc" id="L266">			return m_performActionOnIDs[getEditIndex()];</span>
		}
	}

	/**
	 * Returns the organization display label
	 */
	public String getOrganizationLabel() {
<span class="fc" id="L274">		return i18n(m_bbmBundle, BbmWebBundleKey.LIST_HEADER_OWNER_ORG);</span>
	}

	public String getActivityOrganizationName() throws Exception{
<span class="fc" id="L278">		return OrganizationModelHandler.getOrganizationName(m_context, m_activity.getOrganizationId());</span>
	}

	public String getActivityName() {
<span class="fc bfc" id="L282" title="All 2 branches covered.">		return m_activity.getName() == null ? null : m_activity.getName().trim();</span>
	}

	public void setActivityName(String name) {
<span class="fc" id="L286">		m_activity.setName(name.trim());</span>
<span class="fc" id="L287">	}</span>

	public String getActivityDescription() {
<span class="fc" id="L290">		return m_activity.getDescription();</span>
	}

	public void setActivityDescription(String desc) {
<span class="fc" id="L294">		m_activity.setDescription(StringUtil.convertEmptyStringToNull(desc));</span>
<span class="fc" id="L295">	}</span>

	public String getActivityType() {
<span class="fc" id="L298">		ID id = m_activity.getActivityCategoryId();</span>
<span class="fc bfc" id="L299" title="All 2 branches covered.">		if( id!=null ) {</span>
<span class="fc" id="L300">			return id.toString();</span>
		} else {
<span class="fc" id="L302">			return &quot;&quot;;</span>
		}
	}

	public void setActivityType(String id) {
<span class="pc bpc" id="L307" title="1 of 2 branches missed.">		if(!StringUtil.isEmpty(id)) {</span>
<span class="fc" id="L308">			m_activity.setActivityCategoryId(new ID(id));</span>
		}
<span class="fc" id="L310">	}</span>

	public String getEarningType() {
<span class="nc" id="L313">		ID id = m_activity.getEarningTypeId();</span>
<span class="nc bnc" id="L314" title="All 2 branches missed.">		if(id != null) {</span>
<span class="nc" id="L315">			return id.toString();</span>
		} else {
<span class="nc" id="L317">			return &quot;&quot;;</span>
		}
	}

	public void setEarningType(String id) {
<span class="nc bnc" id="L322" title="All 4 branches missed.">		if(id != null &amp;&amp; id.length() &gt; 0) {</span>
<span class="nc" id="L323">			m_activity.setEarningTypeId(new ID(id));</span>
		}
<span class="nc" id="L325">	}</span>

	public boolean getPaid() {
<span class="fc" id="L328">		return m_activity.isPaid();</span>
	}

	public void setPaid(boolean isPaid) {
<span class="fc" id="L332">		m_activity.setPaid(isPaid);</span>
<span class="fc" id="L333">	}</span>

	public boolean getQueueHopping() {
<span class="fc" id="L336">		return m_activity.isQueueHopping();</span>
	}

	public void setQueueHopping(boolean isQueueHopping) {
<span class="fc" id="L340">		m_activity.setQueueHopping(isQueueHopping);</span>
<span class="fc" id="L341">	}</span>

	public void setAllowRemote(boolean allowRemote) {
<span class="fc" id="L344">		m_activity.setAllowRemote(allowRemote);</span>
<span class="fc" id="L345">	}</span>

	public boolean getAllowRemote() {
<span class="nc" id="L348">		return m_activity.isAllowRemote();</span>
	}

	public String getColor() {
<span class="fc" id="L352">		String colorStr = ColorUtil.getHtmlColorCode(m_activity.getColor());</span>
<span class="pc bpc" id="L353" title="1 of 2 branches missed.">		if(ColorUtil.validateColor(colorStr)) {</span>
<span class="fc" id="L354">			return &quot;#&quot; + colorStr;</span>
		} else {
<span class="nc" id="L356">			return ACTIVITY_COLOR_DEFAULT;</span>
		}
	}

	public void setColor(String color) {
<span class="fc" id="L361">		m_activity.setColor(StringUtil.convertEmptyStringToNull(color));</span>
<span class="fc" id="L362">	}</span>

	public String getColorCode() {
<span class="fc" id="L365">		return m_activity.getColorCode();</span>
	}

	public void setColorCode(String colorCode) {
<span class="fc" id="L369">		m_activity.setColorCode(StringUtil.convertEmptyStringToNull(colorCode));</span>
<span class="fc" id="L370">	}</span>

	public boolean getTimeoff() {
<span class="fc" id="L373">		return m_activity.isTimeoff();</span>
	}

	public void setTimeoff(boolean isTimeoff) {
<span class="fc" id="L377">		m_activity.setTimeoff(isTimeoff);</span>
<span class="fc" id="L378">	}</span>

	public boolean getUseDailyTOPool() {
<span class="nc" id="L381">		return activityProperties.isUseDailyTOPool();</span>
	}

	public void setUseDailyTOPool(boolean isUseDailyTOPool) {
<span class="fc" id="L385">		activityProperties.setUseDailyTOPool(isUseDailyTOPool);</span>
<span class="fc" id="L386">	}</span>

	public boolean getUseIntervalTOPool() {
<span class="nc" id="L389">		return activityProperties.isUseIntervalTOPool();</span>
	}

	public void setUseIntervalTOPool(boolean isUseIntervalTOPool) {
<span class="fc" id="L393">		activityProperties.setUseIntervalTOPool(isUseIntervalTOPool);</span>
<span class="fc" id="L394">	}</span>

	public int getTimeoffWithFlex() {
<span class="nc" id="L397">		return activityProperties.getTimeoffWithFlex();</span>
	}

	public void setTimeoffWithFlex(int timeoffWithFlex) {
<span class="fc" id="L401">		activityProperties.setTimeoffWithFlex(timeoffWithFlex);</span>
<span class="fc" id="L402">	}</span>

	public void setMedia(String mediaString) {
<span class="fc" id="L405">		ID[] mediaIdArray = StringUtil.parseIDString(mediaString, &quot;,&quot;);</span>
<span class="pc bpc" id="L406" title="1 of 4 branches missed.">		if(mediaIdArray != null &amp;&amp; mediaIdArray.length &gt; 0) {</span>
<span class="fc" id="L407">			m_mediaIds = Arrays.asList(mediaIdArray);</span>
		} else {
<span class="fc" id="L409">			m_mediaIds = Collections.emptyList();</span>
		}
<span class="fc" id="L411">		setHasMedia();</span>
<span class="fc" id="L412">		setHasProjectMedia();</span>
<span class="fc" id="L413">	}</span>

	public Collection&lt;ID&gt; getMedia() {
<span class="nc" id="L416">		return m_mediaIds;</span>
	}

	private void setHasMedia() {
<span class="pc bpc" id="L420" title="1 of 4 branches missed.">		m_hasMedia = ((m_mediaIds != null) &amp;&amp; (!m_mediaIds.isEmpty()));</span>
<span class="fc" id="L421">	}</span>

	private void setHasProjectMedia() {
<span class="pc bpc" id="L424" title="1 of 6 branches missed.">		m_hasProjectMedia = (m_mediaIds != null) &amp;&amp; (!m_mediaIds.isEmpty() )&amp;&amp; (m_mediaIds.contains(Media.MEDIA_ID_PROJECT));</span>
<span class="fc" id="L425">	}</span>

	public void setQueues(String queuesString) {
<span class="fc" id="L428">		ID[] queueIdArray = StringUtil.parseIDString(queuesString, &quot;,&quot;);</span>
<span class="pc bpc" id="L429" title="1 of 4 branches missed.">		if(queueIdArray != null &amp;&amp; queueIdArray.length &gt; 0) {</span>
<span class="fc" id="L430">			m_queueIds = Arrays.asList(queueIdArray);</span>
		} else {
<span class="fc" id="L432">			m_queueIds = Collections.emptyList();</span>
		}
<span class="fc" id="L434">		setHasQueues();</span>
<span class="fc" id="L435">	}</span>

	/**
	 * Return the Queue Hopping queueIDs linked to this activity.
	 * @return collection of queue IDs
	 */
	public Collection&lt;ID&gt; getQueues() {
<span class="nc" id="L442">		return m_queueIds;</span>
	}

	/**
	 * Determines whether this activity is linked to any Queue Hopping queues.
	 */
	private void setHasQueues() {
<span class="fc bfc" id="L449" title="All 4 branches covered.">		m_hasQueues = ((m_queueIds != null) &amp;&amp; (!m_queueIds.isEmpty()));</span>
<span class="fc" id="L450">	}</span>

	/**
	 * Gets the activity value object
	 *
	 * @return activity value object
	 */
	public Activity getActivity() {
<span class="fc" id="L458">		m_activity.setID(getActivityID());</span>
<span class="fc" id="L459">		return m_activity;</span>
	}

	/**
	 * Gets the activity value object
	 *
	 * @return activity value object
	 */
	public ActivityProperties getActivityProperties() {
<span class="fc" id="L468">		activityProperties.setActivityId(getActivityID());</span>
<span class="fc" id="L469">		return activityProperties;</span>
	}

	/**
	 * Return URL for HTML Form Action
	 */
	public String getFormAction() {
<span class="fc" id="L476">		return &quot;activity_form&quot;;</span>
	}


	/**
	 * Override method to generate necessary JS code needed for the Color Picker popup window from
	 * a popup button
	 */
	public String getJavaScriptInitCode() {
<span class="fc" id="L485">		StringBuilder jsInit = new StringBuilder(1256);</span>
<span class="fc" id="L486">		jsInit.append(super.getJavaScriptInitCode());</span>
<span class="fc" id="L487">		jsInit.append(&quot;\n// initialize the Color Picker popup button object\n&quot;)</span>
<span class="fc" id="L488">			.append(&quot;window.popupbutton0 = new PopupButton(\&quot;popupbutton0\&quot;);\n&quot;)</span>
<span class="fc" id="L489">			.append(&quot;window.popupbutton0.bind();\n&quot;)</span>
<span class="fc" id="L490">			.append(&quot;//add  popupbutton to the mediator's collection\n&quot;)</span>
<span class="fc" id="L491">			.append(&quot;top.workpaneMediator.addChild( popupbutton0 );\n&quot;)</span>
<span class="fc" id="L492">			.append(&quot;popupbutton0.setParent(top.workpaneMediator);\n&quot;)</span>
<span class="fc" id="L493">			.append(&quot; getRemoteInitJS();\n&quot;);</span>
<span class="fc" id="L494">		return jsInit.toString();</span>
	}

	public String getCustomJavaScript() {
<span class="fc" id="L498">		StringBuilder js = new StringBuilder();</span>
<span class="fc" id="L499">		js.append(super.getCustomJavaScript());</span>
<span class="fc" id="L500">		js.append(getRemoteInitJS());</span>
<span class="fc" id="L501">		return js.toString();</span>
	}

	private String getRemoteInitJS() {
<span class="fc" id="L505">		StringBuilder js = new StringBuilder();</span>
<span class="fc" id="L506">		js.append(&quot;function getRemoteInitJS() {\n&quot;);</span>
<span class="fc" id="L507">		js.append(&quot;var queueName = document.getElementById('&quot;).append(QUEUE_NAMES_DISPLAY_FN).append(&quot;'); \n&quot;);</span>
<span class="fc" id="L508">		js.append(&quot;var mediaName = document.getElementById('&quot;).append(MEDIA_NAMES_DISPLAY_FN).append(&quot;'); \n&quot;);</span>
<span class="fc" id="L509">		js.append(&quot;var canRemote = document.getElementById('&quot;).append(ActivityFields.CAN_WORK_REMOTELY_FN).append(&quot;'); \n&quot;);</span>
<span class="fc" id="L510">		js.append(&quot;if(queueName == null || queueName === undefined || mediaName == null || mediaName === undefined || canRemote == null || canRemote === undefined) return; \n&quot;);</span>
<span class="fc" id="L511">		js.append(&quot;if(document.getElementById('&quot;).append(ActivityFields.USED_IN_SHIFT_EVENT_FN).append(&quot;').checked&quot;);</span>
<span class="fc" id="L512">		js.append(&quot;&amp;&amp; (jQuery.trim(queueName.value) != \&quot;\&quot; || jQuery.trim(mediaName.value) != \&quot;\&quot; )){ \n&quot;);</span>
<span class="fc" id="L513">		js.append(&quot;document.getElementById('&quot;).append(ActivityFields.CAN_WORK_REMOTELY_FN).append(&quot;').disabled = false; \n&quot; );</span>
<span class="fc" id="L514">		js.append(&quot;}else {\n&quot;);</span>
<span class="fc" id="L515">		js.append(&quot;document.getElementById('&quot;).append(ActivityFields.CAN_WORK_REMOTELY_FN).append(&quot;').disabled = true; \n&quot;);</span>
<span class="fc" id="L516">		js.append(&quot;}\n&quot;);</span>
<span class="fc" id="L517">		js.append(&quot;}\n&quot;);</span>

<span class="fc" id="L519">		return js.toString();</span>
	}


	/**
	 * Override method to return Required HTML for this component
	 * Use this to add a specific hidden field
	 */
	public String getRequiredHTML() {
<span class="fc" id="L528">		StringBuilder reqHtml = new StringBuilder(1256);</span>
<span class="fc" id="L529">		reqHtml.append(super.getRequiredHTML());</span>
<span class="fc" id="L530">		reqHtml.append(HtmlUtil.makeHiddenInput(ActivityFields.OWNER_ORG_FN, getOrganizationId()));</span>
<span class="fc" id="L531">		m_hiddenFields.append(&quot;\n&quot;);</span>
<span class="pc bpc" id="L532" title="1 of 2 branches missed.">		if(m_hiddenFields.length() &gt; 0) {</span>
<span class="fc" id="L533">			reqHtml.append(m_hiddenFields);</span>
		}
<span class="fc" id="L535">		return reqHtml.toString();</span>
	}


	/**
	 * Returns a (single) entity type.
	 */
	protected String getTitleEntityType() {
<span class="fc" id="L543">		return this.getFormTitle();</span>
	}

	/**
	 * Returns an entity name. Used for title.
	 */
	protected String getEntityName() {
<span class="fc" id="L550">		return this.getActivityName();</span>
	}

	/**
	 * Checks to see if there is a Phone media is linked to this activity.
	 * @return
	 */
	private boolean hasPhoneMedia(Collection&lt;ID&gt; mediaIds) {
<span class="nc bnc" id="L558" title="All 4 branches missed.">		return mediaIds!=null &amp;&amp; mediaIds.contains(Media.MEDIA_ID_PHONE);</span>
	}

	private boolean hasOperationsMedia(Collection&lt;ID&gt; mediaIds) {
<span class="nc bnc" id="L562" title="All 4 branches missed.">		return mediaIds != null &amp;&amp; mediaIds.contains(Media.MEDIA_ID_OPERATIONS);</span>
	}

	protected Collection&lt;ID&gt; getActivityMedia(RequestContext context, ID activityID,
			boolean hasMultiMediaLicense) throws Exception {
<span class="fc" id="L567">		Collection&lt;ID&gt; mediaIds = ActivityModelHandler.getActivityMedia(context, activityID);</span>
<span class="pc bpc" id="L568" title="1 of 2 branches missed.">		if (!hasMultiMediaLicense) {</span>
			//Since they don't have the Multi-Media license, we will only keep the Phone media
<span class="nc" id="L570">			ArrayList&lt;ID&gt; reducedMediaIds = new ArrayList&lt;ID&gt;(1);</span>
<span class="nc bnc" id="L571" title="All 2 branches missed.">			if (hasPhoneMedia(mediaIds)) {</span>
<span class="nc" id="L572">				reducedMediaIds.add(Media.MEDIA_ID_PHONE);</span>
			}

<span class="nc bnc" id="L575" title="All 4 branches missed.">			if (hasOperationsMedia(mediaIds) &amp;&amp; MediaTypesSetupPageModel.hasAnyBackOfficeLicence()) {</span>
<span class="nc" id="L576">				reducedMediaIds.add(Media.MEDIA_ID_OPERATIONS);</span>
			}
<span class="nc" id="L578">			return reducedMediaIds;</span>
		}
<span class="fc" id="L580">		return mediaIds;</span>
	}

	/**
	 * Create the form model - fetch the data from backend
	 *
	 */
	protected void createFormModel() {
<span class="fc" id="L588">		checkForLicenses();</span>
		try {
			// When PageAction.REFRESH, and page has values inputed from UI, keep them, don't reload
			// activity or create new. Note that after COPY an activity, page refreshes, that case
			// m_activity is empty, needs to reload.
<span class="fc bfc" id="L593" title="All 2 branches covered.">			if ( !(PageAction.REFRESH.equals(m_context.getParameter(PageAction.PAGE_ACTION))</span>
<span class="pc bpc" id="L594" title="1 of 2 branches missed.">					&amp;&amp; m_activity.getActivityCategoryId() != null) ) {</span>
<span class="fc bfc" id="L595" title="All 2 branches covered.">				if( !this.isNew() ) {</span>
<span class="fc" id="L596">					m_activity = ActivityModelHandler.getActivityByID(m_context, getCurrentID());</span>
					{
<span class="fc" id="L598">						m_mediaIds = getActivityMedia(m_context, m_activity.getID(), hasMultiMediaLicense);</span>
					}
<span class="fc" id="L600">					setHasMedia();</span>
<span class="fc" id="L601">					setHasProjectMedia();</span>

					//Load the Queue Hopping (or Project) Queue IDs that are already linked to this activity (if any).
<span class="pc bpc" id="L604" title="4 of 6 branches missed.">					if ((m_activity.isQueueHopping() &amp;&amp; hasQueueHoppingLicense) || hasProjectMedia()) {</span>
<span class="nc" id="L605">						m_queueIds = ActivityModelHandler.getActivityQueues(m_context, m_activity.getID());</span>
					}
<span class="fc" id="L607">					setHasQueues();</span>

					// Get Activity Properties
<span class="fc" id="L610">					activityProperties = ActivityModelHandler.getActivityProperties(m_context, m_activity.getID());</span>
				} else {
					// Create new mode - set the org ID
<span class="pc bpc" id="L613" title="1 of 2 branches missed.">					if (hasSelectedID()) {</span>
<span class="fc" id="L614">						m_activity.setOrganizationId(getSelectedIDObject());</span>
					}
<span class="fc" id="L616">					setDefaultValues();</span>
				}
			}

			// load the activity types for the drop down
			try {
<span class="pc bpc" id="L622" title="1 of 2 branches missed.">				if (hasSelectedID()) {</span>
<span class="fc" id="L623">					boolean filterSystemDefined = true;</span>
<span class="pc bpc" id="L624" title="1 of 2 branches missed.">					if (m_activity.getOrganizationId().equals(Organization.ROOT_ORG_ID_OBJ)) {</span>
<span class="nc" id="L625">						filterSystemDefined = false;</span>
					}
<span class="fc" id="L627">					m_activityTypeStringPair = ActivityTypeModelHandler.getActivityTypesStringsPair(m_context,</span>
<span class="fc" id="L628">						getSelectedIDObject(), filterSystemDefined);</span>
<span class="fc" id="L629">				} else {</span>
<span class="nc" id="L630">					m_activityTypeStringPair = Collections.emptyList();</span>
				}

<span class="fc" id="L633">				m_selectedActivityType = getActivityType();</span>
<span class="fc bfc" id="L634" title="All 2 branches covered.">				if (StringUtil.isEmpty(m_selectedActivityType)) {</span>
<span class="pc bpc" id="L635" title="1 of 2 branches missed.">					if (!m_activityTypeStringPair.isEmpty()) {</span>
<span class="fc" id="L636">						Iterator&lt;StringsPair&gt; it = m_activityTypeStringPair.iterator();</span>
<span class="fc" id="L637">						StringsPair firstActivityTypeStringsPair = it.next();</span>
<span class="fc" id="L638">						m_selectedActivityType = firstActivityTypeStringsPair.getKey();</span>
<span class="fc" id="L639">					} else {</span>
<span class="nc" id="L640">						m_selectedActivityType = &quot;&quot;;</span>
<span class="nc" id="L641">						m_initFailure = true;</span>
					}
				}
<span class="nc" id="L644">			} catch (Exception e) {</span>
<span class="nc" id="L645">				log.l7dError(BbmWebLogBundleKey.ACTIVITY_ACTIVITY_TYPES_RETRIEVE_FAILURE, e);</span>
<span class="nc" id="L646">				this.addPageMessage(Message.ERROR_TYPE,</span>
					BbmWebBundleKey.ACTIVITY_ACTIVITY_TYPES_RETRIEVE_FAILURE,
					BbmWebBundleKey.BUNDLE_NAME);
<span class="nc" id="L649">				m_activityTypeStringPair = null;</span>
<span class="nc" id="L650">				m_initFailure = true;</span>
<span class="fc" id="L651">			}</span>

<span class="pc bpc" id="L653" title="1 of 2 branches missed.">			if (hasPayrollLicense) {</span>
			// load the earning types for the drop down
				try {
<span class="nc" id="L656">					m_earningTypeStringPair = EarningTypeModelHandler.getEarningTypesStringsPair(</span>
						EarningTypeManager.SORT_EARNINGTYPE_BY_NAME, true);

<span class="nc bnc" id="L659" title="All 2 branches missed.">					if (!this.isNew()) {</span>
<span class="nc" id="L660">						m_selectedEarningType = getEarningType();</span>
					}
					else {
<span class="nc" id="L663">						m_selectedEarningType = EARNING_TYPE_DEFAULT.toString();</span>
					}
<span class="nc" id="L665">				} catch (Exception e) {</span>
<span class="nc" id="L666">					log.l7dError(BbmWebLogBundleKey.ACTIVITY_EARNING_TYPES_RETRIEVE_FAILURE, e);</span>
<span class="nc" id="L667">					this.addPageMessage(Message.ERROR_TYPE,</span>
						BbmWebBundleKey.ACTIVITY_EARNING_TYPES_RETRIEVE_FAILURE,
						BbmWebBundleKey.BUNDLE_NAME);
<span class="nc" id="L670">					m_earningTypeStringPair = null;</span>
<span class="nc" id="L671">					m_initFailure = true;</span>
<span class="nc" id="L672">				}</span>
			}

<span class="nc" id="L675">		} catch (Exception ex) {</span>
<span class="nc" id="L676">			handleUnableToLoadDataError(log, ex);</span>
<span class="nc" id="L677">			m_initFailure = true;</span>
<span class="fc" id="L678">		}</span>

<span class="fc" id="L680">	}</span>


	/**
	 * Initialize Form Display
	 */
	protected void initForm() {
		// Initialize Form PC
<span class="fc" id="L688">		m_formPC = new FormTwoColumnPC(m_context);</span>
<span class="fc" id="L689">		addChildComponent(m_formPC);</span>
<span class="fc" id="L690">		m_formPC.setTitle(getFormTitle());</span>

		try {
			// Organization
<span class="fc" id="L694">			m_formPC.addRow(getOrganizationLabel(), getActivityOrganizationName());</span>

			// Name
<span class="pc bpc" id="L697" title="3 of 4 branches missed.">			switch (m_displayMap[ActivityFields.NAME]) {</span>
				case ActivityFields.EDITABLE:
<span class="fc" id="L699">					m_formPC.addRow(getNameLabel(),</span>
<span class="fc" id="L700">						HtmlUtil.makeTextInput(ActivityFields.NAME_FN, 50, DBInfo.ACTIVITY_NAME_MAXLENGTH, getActivityName(), JSUtil.ON_CHANGE));</span>
<span class="fc" id="L701">					addValidator(new IsEnteredFieldValidator(this, ActivityFields.NAME_FN,</span>
						UIFWebBundleKey.LABEL_NAME, UIFWebBundleKey.BUNDLE_NAME));
<span class="fc" id="L703">					break;</span>
				case ActivityFields.DISPLAYABLE:
<span class="nc" id="L705">					m_formPC.addRow(getNameLabel(), getActivityName());</span>
				case ActivityFields.NON_DISPLAYABLE:
<span class="nc" id="L707">					m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.NAME_FN, getActivityName()));</span>
<span class="nc" id="L708">					m_hiddenFields.append(&quot;\n&quot;);</span>
					break;
			}


			// Description
<span class="pc bpc" id="L714" title="3 of 4 branches missed.">			switch (m_displayMap[ActivityFields.DESCRIPTION]) {</span>
				case ActivityFields.EDITABLE:
<span class="fc" id="L716">					m_formPC.addRow(getDescriptionLabel(),</span>
<span class="fc" id="L717">						HtmlUtil.makeTextInput(ActivityFields.DESCRIPTION_FN, 75, 75,</span>
<span class="fc" id="L718">							getActivityDescription(), JSUtil.ON_CHANGE));</span>
<span class="fc" id="L719">					break;</span>
				case ActivityFields.DISPLAYABLE:
<span class="nc" id="L721">					m_formPC.addRow(getDescriptionLabel(), getActivityDescription());</span>
				case ActivityFields.NON_DISPLAYABLE:
<span class="nc" id="L723">					m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.DESCRIPTION_FN, getActivityDescription()));</span>
<span class="nc" id="L724">					m_hiddenFields.append(&quot;\n&quot;);</span>
					break;
			}

			// Activity Type
<span class="pc bpc" id="L729" title="3 of 4 branches missed.">			switch (m_displayMap[ActivityFields.ACTIVITY_CATEGORY]) {</span>
				case ActivityFields.EDITABLE:
<span class="fc" id="L731">					m_formPC.addRow(getActivityTypeLabel(), getActivityTypeDropDown(JSUtil.RESET_PAGEDIRTY + JSUtil.REFRESH_PAGE));</span>
<span class="fc" id="L732">					break;</span>
				case ActivityFields.DISPLAYABLE:
<span class="nc" id="L734">					m_formPC.addRow(getActivityTypeLabel(), getActivityTypeName());</span>
				case ActivityFields.NON_DISPLAYABLE:
<span class="nc" id="L736">					m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.ACTIVITY_CATEGORY_FN, getActivityType()));</span>
<span class="nc" id="L737">					m_hiddenFields.append(&quot;\n&quot;);</span>
					break;
			}

			// Paid
<span class="pc bpc" id="L742" title="3 of 4 branches missed.">			switch (m_displayMap[ActivityFields.PAID]) {</span>
				case ActivityFields.EDITABLE:
<span class="fc" id="L744">					m_formPC.addRow(getPaidLabel(),</span>
<span class="fc" id="L745">						HtmlChoiceInput.makeChkBoxInput(ActivityFields.PAID_FN, &quot;true&quot;, &quot;&quot;, getPaid(), false, ACTIVITY_FIELD_ON_CHANGE ));</span>
<span class="fc" id="L746">					break;</span>
				case ActivityFields.DISPLAYABLE:
<span class="nc" id="L748">					m_formPC.addRow(getPaidLabel(),	m_localizer.formatYesNo(getPaid()));</span>
						case ActivityFields.NON_DISPLAYABLE:
<span class="nc bnc" id="L750" title="All 2 branches missed.">					m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.PAID_FN, (getPaid()? &quot;true&quot; : &quot;&quot;) ));</span>
<span class="nc" id="L751">					m_hiddenFields.append(&quot;\n&quot;);</span>
					break;
			}

<span class="pc bpc" id="L755" title="1 of 2 branches missed.">			if (hasPayrollLicense){</span>
				// Earning Type
<span class="nc bnc" id="L757" title="All 4 branches missed.">				switch (m_displayMap[ActivityFields.EARNING_TYPE]) {</span>
					case ActivityFields.EDITABLE:
<span class="nc" id="L759">						m_formPC.addRow(getEarningTypeLabel(), getEarningTypeDropDown(JSUtil.ON_CHANGE));</span>
<span class="nc" id="L760">						break;</span>
					case ActivityFields.DISPLAYABLE:
<span class="nc" id="L762">						m_formPC.addRow(getEarningTypeLabel(), getEarningTypeName());</span>
					case ActivityFields.NON_DISPLAYABLE:
<span class="nc" id="L764">						m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.EARNING_TYPE_FN, getEarningType()));</span>
<span class="nc" id="L765">						m_hiddenFields.append(&quot;\n&quot;);</span>
						break;
				}
			}

				// Color
<span class="pc bpc" id="L771" title="3 of 4 branches missed.">			switch (m_displayMap[ActivityFields.COLOR]) {</span>
				case ActivityFields.EDITABLE:
<span class="fc" id="L773">					m_formPC.addRow(getColorLabel(), getColorDispaly(true));</span>
					// a hidden field for color is always required
<span class="fc" id="L775">					m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.COLOR_FN, getColor()));</span>
<span class="fc" id="L776">					break;</span>
				case ActivityFields.DISPLAYABLE:
<span class="nc" id="L778">					m_formPC.addRow(getColorLabel(), getColorDispaly(false));</span>
				case ActivityFields.NON_DISPLAYABLE:
<span class="nc" id="L780">					m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.COLOR_FN, getColor()));</span>
					break;
			}

			// Color code
<span class="pc bpc" id="L785" title="3 of 4 branches missed.">			switch (m_displayMap[ActivityFields.COLOR_CODE]) {</span>
				case ActivityFields.EDITABLE:
<span class="fc" id="L787">					m_formPC.addRow(getColorCodeLabel(),</span>
<span class="fc" id="L788">						HtmlUtil.makeTextInput(ActivityFields.COLOR_CODE_FN, 4, 4, getColorCode(), JSUtil.ON_CHANGE));</span>
<span class="fc" id="L789">					break;</span>
				case ActivityFields.DISPLAYABLE:
<span class="nc" id="L791">					m_formPC.addRow(getColorCodeLabel(), getColorCode());</span>
				case ActivityFields.NON_DISPLAYABLE:
<span class="nc" id="L793">					m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.COLOR_CODE_FN, getColorCode()));</span>
<span class="nc" id="L794">					m_hiddenFields.append(&quot;\n&quot;);</span>
					break;
			}

			// Timeoff
<span class="pc bpc" id="L799" title="3 of 4 branches missed.">			switch (m_displayMap[ActivityFields.TIMEOFF]) {</span>
				case ActivityFields.EDITABLE:
<span class="fc" id="L801">					m_formPC.addRow(getTimeoffLabel(),</span>
<span class="fc" id="L802">						HtmlChoiceInput.makeChkBoxInput(ActivityFields.TIMEOFF_FN, &quot;true&quot;, &quot;&quot;,</span>
<span class="fc" id="L803">							getTimeoff(), isFieldDisabled(ActivityFields.TIMEOFF), ACTIVITY_FIELD_ON_CHANGE));</span>
<span class="fc" id="L804">					break;</span>
				case ActivityFields.DISPLAYABLE:
<span class="nc" id="L806">					m_formPC.addRow(getTimeoffLabel(), m_localizer.formatYesNo(getTimeoff()));</span>
				case ActivityFields.NON_DISPLAYABLE:
<span class="nc bnc" id="L808" title="All 2 branches missed.">					m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.TIMEOFF_FN, (getTimeoff()? &quot;true&quot; : &quot;&quot;) ));</span>
<span class="nc" id="L809">					m_hiddenFields.append(&quot;\n&quot;);</span>
					break;
			}

			// Media selector row
<span class="pc bpc" id="L814" title="3 of 4 branches missed.">			switch (m_displayMap[ActivityFields.MEDIA]) {</span>
				case ActivityFields.EDITABLE:
<span class="fc" id="L816">					m_formPC.addRow(getMediaLabel(), getMediaDisplay(true));</span>
					// a hidden field for media is always required
<span class="fc" id="L818">					m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.MEDIA_FN, getMediaIdsString()));</span>
<span class="fc" id="L819">					break;</span>
				case ActivityFields.DISPLAYABLE:
<span class="nc" id="L821">					m_formPC.addRow(getMediaLabel(), getMediaDisplay(false));</span>
				case ActivityFields.NON_DISPLAYABLE:
<span class="nc" id="L823">					m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.MEDIA_FN, getMediaIdsString()));</span>
					break;
			}

			//Queue Hopping checkbox
<span class="pc bpc" id="L828" title="1 of 2 branches missed.">			if (hasQueueHoppingLicense) {</span>
<span class="pc bpc" id="L829" title="3 of 4 branches missed.">				switch (m_displayMap[ActivityFields.QUEUE_HOPPING]) {</span>
					case ActivityFields.EDITABLE:
<span class="fc" id="L831">						m_formPC.addRow(getQueueHoppingLabel(),</span>
<span class="fc" id="L832">							HtmlChoiceInput.makeChkBoxInput(ActivityFields.QUEUE_HOPPING_FN, &quot;true&quot;, &quot;&quot;,</span>
<span class="fc" id="L833">								getQueueHopping(), isFieldDisabled(ActivityFields.QUEUE_HOPPING), ACTIVITY_FIELD_ON_CHANGE + &quot;getRemoteInitJS();\n&quot;));</span>
<span class="fc" id="L834">						break;</span>

					case ActivityFields.DISPLAYABLE:
<span class="nc" id="L837">						m_formPC.addRow(getQueueHoppingLabel(),	m_localizer.formatYesNo(getPaid()));</span>

					case ActivityFields.NON_DISPLAYABLE:
<span class="nc bnc" id="L840" title="All 2 branches missed.">						m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.QUEUE_HOPPING_FN, (getQueueHopping()? &quot;true&quot; : &quot;&quot;) ));</span>
<span class="nc" id="L841">						m_hiddenFields.append(&quot;\n&quot;);</span>
						break;
				}
			}

			//Queues selector row
<span class="pc bpc" id="L847" title="3 of 4 branches missed.">			if (hasQueueHoppingLicense || hasMultiMediaLicense) {</span>
<span class="pc bpc" id="L848" title="3 of 4 branches missed.">				switch (m_displayMap[ActivityFields.QUEUES]) {</span>
					case ActivityFields.EDITABLE:
<span class="fc" id="L850">						m_formPC.addRow(getQueuesLabel(), getQueuesDisplay(true));</span>
						// a hidden field for queues is always required
<span class="fc" id="L852">						m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.QUEUES_FN, getQueueIdsString()));</span>
<span class="fc" id="L853">						break;</span>

					case ActivityFields.DISPLAYABLE:
<span class="nc" id="L856">						m_formPC.addRow(getQueuesLabel(), getQueuesDisplay(false));</span>

					case ActivityFields.NON_DISPLAYABLE:
<span class="nc" id="L859">						m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.QUEUES_FN, getQueueIdsString()));</span>
<span class="fc" id="L860">						break;</span>
				}
<span class="nc bnc" id="L862" title="All 4 branches missed.">			} else if (m_displayMap[ActivityFields.QUEUES] == ActivityFields.EDITABLE ||</span>
					m_displayMap[ActivityFields.QUEUES] == ActivityFields.NON_DISPLAYABLE) {
<span class="nc" id="L864">				m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.QUEUES_FN, getQueueIdsString()));</span>
			}

			// init FS &amp; RM usage
<span class="pc bpc" id="L868" title="1 of 2 branches missed.">			if(isAuthorizedToConfigureFSAttributes(getSelectedIDObject())) {</span>
<span class="fc" id="L869">				m_fsUsagePC.initForm(m_activity, activityProperties, true,</span>
						m_hiddenFields, m_displayMap, m_hasMedia, m_hasProjectMedia);
<span class="fc" id="L871">				m_rmUsagePC.initForm(m_activity, activityProperties, true,</span>
						m_hiddenFields, m_displayMap, m_hasMedia, m_hasProjectMedia);
			} else {
<span class="nc" id="L874">				m_fsUsagePC.initForm(m_activity, activityProperties, true,</span>
						m_hiddenFields, ActivityFields.nonDisplayableDisplayMap, m_hasMedia, m_hasProjectMedia);
<span class="nc" id="L876">				m_rmUsagePC.initForm(m_activity, activityProperties, true,</span>
						m_hiddenFields, ActivityFields.nonDisplayableDisplayMap, m_hasMedia, m_hasProjectMedia);
			}

			// init AM usage
<span class="pc bpc" id="L881" title="1 of 2 branches missed.">			if(isAuthorizedToConfigureAMAttributes(getSelectedIDObject())) {</span>
<span class="fc" id="L882">				m_amUsagePC.initForm(m_activity, activityProperties, true,</span>
						m_hiddenFields, m_displayMap, m_hasMedia, m_hasProjectMedia);
			} else {
<span class="nc" id="L885">				m_amUsagePC.initForm(m_activity, activityProperties, true,</span>
						m_hiddenFields, ActivityFields.nonDisplayableDisplayMap, m_hasMedia, m_hasProjectMedia);
			}

			//init advisor usage
<span class="pc bpc" id="L890" title="1 of 2 branches missed.">			if(hasAdvisorLicense) {</span>
<span class="fc" id="L891">				m_advisorUsagePC.initForm(m_activity, activityProperties, true,</span>
						m_hiddenFields, m_displayMap, m_hasMedia, m_hasProjectMedia);
			} else {
<span class="nc" id="L894">				m_advisorUsagePC.initForm(m_activity, activityProperties, true,</span>
						m_hiddenFields, ActivityFields.nonDisplayableDisplayMap, m_hasMedia, m_hasProjectMedia);
			}

<span class="nc" id="L898">		} catch (Exception ex) {</span>
<span class="nc" id="L899">			handleUnableToLoadDataError(log, ex);</span>
<span class="nc" id="L900">			m_initFailure = true;</span>
<span class="fc" id="L901">		}</span>
<span class="fc" id="L902">	}</span>

	/**
	 * Return true if selected Org is valid; Override parent method to allow editing
	 * of activities define in the root (system)level
	 */
	protected boolean isValidSelectedOrg() {
<span class="fc" id="L909">		return hasSelectedID();</span>
	}

	protected void initFieldValidators() {
		// validators were added in initForm() since fields are not necessary rendered
<span class="fc" id="L914">	}</span>


	private String getNameLabel() {
<span class="fc" id="L918">		return i18n(m_common_bundle, UIFWebBundleKey.LABEL_NAME);</span>
	}

	private String getDescriptionLabel() {
<span class="fc" id="L922">		return i18n(m_common_bundle, UIFWebBundleKey.LABEL_DESCRIPTION);</span>
	}

	private String getActivityTypeLabel() {
<span class="fc" id="L926">		return i18n(m_bbmBundle, BbmWebBundleKey.ACTIVITY_LABEL_ACTIVITY_TYPE);</span>
	}

	/**
	 * Return the DropDown display of activity types
	 */
	private String getActivityTypeDropDown(String onChangeJS) {
<span class="pc bpc" id="L933" title="1 of 2 branches missed.">		if (m_activityTypeStringPair != null) {</span>
<span class="fc" id="L934">			return HtmlUtil.makeSelectInput(ActivityFields.ACTIVITY_CATEGORY_FN,</span>
				m_selectedActivityType, onChangeJS,
				m_activityTypeStringPair);
		} else {
<span class="nc" id="L938">			return &quot;&amp;nbsp;&quot;;</span>
		}
	}

	private String getActivityTypeName() {
		// Scan the m_activityTypeStringPair collection for the name of the activity type
<span class="nc bnc" id="L944" title="All 6 branches missed.">		if (m_activityTypeStringPair == null || m_activityTypeStringPair.isEmpty() || StringUtil.isEmpty(getActivityType())) {</span>
<span class="nc" id="L945">			return HtmlUtil.NBSP;</span>
		}

<span class="nc" id="L948">		String key = getActivityType();</span>
		StringsPair sp;
<span class="nc bnc" id="L950" title="All 2 branches missed.">		for (Iterator&lt;StringsPair&gt; it = m_activityTypeStringPair.iterator(); it.hasNext();) {</span>
<span class="nc" id="L951">			sp = it.next();</span>
<span class="nc bnc" id="L952" title="All 2 branches missed.">			if(sp.getKey().equals(key)) {</span>
<span class="nc" id="L953">				return sp.getValue();</span>
			}
		}
<span class="nc" id="L956">		return HtmlUtil.NBSP;</span>
	}

	private String getEarningTypeName() {
		// Scan the m_activityTypeStringPair collection for the name of the activity type
<span class="nc bnc" id="L961" title="All 6 branches missed.">		if (m_earningTypeStringPair == null || m_earningTypeStringPair.isEmpty() || StringUtil.isEmpty(getEarningType())) {</span>
<span class="nc" id="L962">			return HtmlUtil.NBSP;</span>
		}
		StringsPair sp;
<span class="nc" id="L965">		String key = getEarningType();</span>
<span class="nc bnc" id="L966" title="All 2 branches missed.">		for (Iterator&lt;StringsPair&gt; it = m_earningTypeStringPair.iterator(); it.hasNext();) {</span>
<span class="nc" id="L967">			sp = it.next();</span>
<span class="nc bnc" id="L968" title="All 2 branches missed.">			if(sp.getKey().equals(key)) {</span>
<span class="nc" id="L969">				return sp.getValue();</span>
			}
		}
<span class="nc" id="L972">		return HtmlUtil.NBSP;</span>
	}


	private String getEarningTypeLabel() {
<span class="nc" id="L977">		return i18n(m_bbmBundle, BbmWebBundleKey.ACTIVITY_LABEL_EARNING_TYPE);</span>
	}

	/**
	 * Return the DropDown display of activity types
	 */
	private String getEarningTypeDropDown(String onChangeJS) {
<span class="nc bnc" id="L984" title="All 2 branches missed.">		if (m_earningTypeStringPair != null) {</span>
<span class="nc" id="L985">			return HtmlUtil.makeSelectInput(ActivityFields.EARNING_TYPE_FN,</span>
				m_selectedEarningType, onChangeJS,
				m_earningTypeStringPair);
		} else {
<span class="nc" id="L989">			return &quot;&amp;nbsp;&quot;;</span>
		}
	}

	private String getPaidLabel() {
<span class="fc" id="L994">		return i18n(m_bbmBundle, BbmWebBundleKey.ACTIVITY_LABEL_IS_PAID);</span>
	}

	private String getTimeoffLabel() {
<span class="fc" id="L998">		return i18n(m_bbmBundle, BbmWebBundleKey.ACTIVITY_LABEL_TIMEOFF);</span>
	}

	private String getMediaLabel() {
<span class="fc" id="L1002">		return i18n(m_bbmBundle, BbmWebBundleKey.ACTIVITY_LABEL_MEDIA);</span>
	}

	//TBD: Verticalize string
	private String getQueuesLabel() {
<span class="fc" id="L1007">		return i18n(m_bbmBundle, BbmWebBundleKey.ACTIVITY_LABEL_QUEUES);</span>
	}

	//TBD: Verticalize string
	private String getQueueHoppingLabel() {
<span class="fc" id="L1012">		return i18n(m_bbmBundle, BbmWebBundleKey.ACTIVITY_LABEL_IS_QUEUE_HOPPING);</span>
	}

	private String getColorDispaly(boolean editable) {
<span class="fc" id="L1016">		StringBuilder htmlColor = new StringBuilder(256);</span>

<span class="fc" id="L1018">		htmlColor.append(&quot;\n&lt;input name=\&quot;&quot;).append(ActivityFields.COLOR_FN).append(&quot;Show\&quot;&quot;)</span>
<span class="fc" id="L1019">			.append(&quot; id=\&quot;&quot;).append(ActivityFields.COLOR_FN).append(&quot;Show\&quot;&quot;)</span>
<span class="fc" id="L1020">			.append(&quot; type=\&quot;text\&quot; class=\&quot;colorshow\&quot; readonly &quot;)</span>
<span class="fc" id="L1021">			.append(&quot;style=\&quot;background-color: &quot;).append(getColor())</span>
<span class="fc" id="L1022">			.append(&quot;; vertical-align:bottom\&quot; &quot;)</span>
<span class="fc" id="L1023">			.append(&quot;size=\&quot;1\&quot; maxlength=\&quot;1\&quot; value=\&quot; \&quot;&gt;&quot;);</span>

<span class="pc bpc" id="L1025" title="1 of 2 branches missed.">		if (editable) {</span>
<span class="fc" id="L1026">			htmlColor.append(&quot;\n&lt;img onClick=\&quot;popupbutton0.onSelect('&quot;)</span>
<span class="fc" id="L1027">			.append(ACTIVITY_COLOR_PICKER_NAME).append(&quot;', this);\&quot;&quot;)</span>
<span class="fc" id="L1028">			.append(&quot; width=\&quot;&quot;).append(ImageFileID.COLOR_PICKER_WIDTH)</span>
<span class="fc" id="L1029">			.append(&quot;\&quot; height=\&quot;&quot;).append(ImageFileID.COLOR_PICKER_HEIGHT)</span>
<span class="fc" id="L1030">			.append(&quot;\&quot; src=\&quot;&quot;).append(ImageFileID.COLOR_PICKER)</span>
			//.append(&quot;\&quot; alt=\&quot;&quot;).append(m_common_bundle.getString(UIFWebBundleKey.COLOR_PICKER))
<span class="fc" id="L1032">			.append(&quot;\&quot; alt=\&quot;&quot;).append( m_localizer.i18n(m_common_bundle,UIFWebBundleKey.COLOR_PICKER))</span>
<span class="fc" id="L1033">			.append(&quot;\&quot; align=\&quot;absmiddle\&quot;&gt;&quot;);</span>
		}
<span class="fc" id="L1035">		return htmlColor.toString();</span>
	}

	private String getMediaDisplay(boolean editable) throws RemoteException, BbmException {
<span class="fc" id="L1039">		StringBuilder sb = new StringBuilder(512);</span>
<span class="fc" id="L1040">		sb.append(makeTextReadOnlyInput(MEDIA_NAMES_DISPLAY_FN, 45, getMediaNamesString()));</span>
<span class="pc bpc" id="L1041" title="1 of 2 branches missed.">		if(editable) {</span>
<span class="fc" id="L1042">			sb.append(&quot;&lt;span &quot;).append(&quot;id=\&quot;&quot;).append(MEDIA_NAMES_DISPLAY_SPAN).append(&quot;\&quot; &quot;);</span>
<span class="fc" id="L1043">			sb.append(&quot;name=\&quot;&quot;).append(MEDIA_NAMES_DISPLAY_SPAN).append(&quot;\&quot; &quot;);</span>
<span class="fc" id="L1044">			sb.append(&quot;onClick=\&quot;&quot;).append(&quot;MediaSelectorPopup();\&quot;&quot;);</span>
<span class="fc bfc" id="L1045" title="All 2 branches covered.">			if(isFieldDisabled(ActivityFields.MEDIA)) {</span>
<span class="fc" id="L1046">				sb.append(&quot; style=\&quot;visibility:hidden;\&quot;&quot;);</span>
			}
			else {
<span class="fc" id="L1049">				sb.append(&quot; style=\&quot;visibility:visible;\&quot;&quot;);</span>
			}
<span class="fc" id="L1051">			sb.append(&quot; &gt;&quot;);</span>
<span class="fc" id="L1052">			sb.append(HtmlUtil.imageTag(ImageFileID.EDIT, ImageFileID.EDIT_WIDTH,</span>
<span class="fc" id="L1053">				ImageFileID.EDIT_HEIGHT, i18n(m_bbmBundle,BbmWebBundleKey.EDIT)));</span>
<span class="fc" id="L1054">			sb.append(&quot;&lt;/span&gt;&quot;);</span>
		}
<span class="fc" id="L1056">		return sb.toString();</span>
	}

	private String getMediaIdsString() {
<span class="fc" id="L1060">		return StringUtil.createDelimitedString(m_mediaIds, &quot;,&quot;);</span>
	}

	private String getMediaNamesString() throws RemoteException, BbmException {
<span class="fc" id="L1064">		return WorkloadModelHandler.getMediaDisplayFromIds(m_context, m_mediaIds);</span>
	}


	private String getQueuesDisplay(boolean editable) throws RemoteException, BbmException {
<span class="fc" id="L1069">		StringBuilder sb = new StringBuilder(512);</span>
<span class="fc" id="L1070">		sb.append(makeTextReadOnlyInput(QUEUE_NAMES_DISPLAY_FN, 45, getQueueNamesString()));</span>
<span class="pc bpc" id="L1071" title="1 of 2 branches missed.">		if(editable) {</span>
<span class="fc" id="L1072">			sb.append(&quot;&lt;span &quot;).append(&quot;id=\&quot;&quot;).append(QUEUE_NAMES_DISPLAY_SPAN).append(&quot;\&quot; &quot;);</span>
<span class="fc" id="L1073">			sb.append(&quot;name=\&quot;&quot;).append(QUEUE_NAMES_DISPLAY_SPAN).append(&quot;\&quot; &quot;);</span>
<span class="fc" id="L1074">			sb.append(&quot;onClick=\&quot;&quot;).append(&quot;QueueSelectorPopup();\&quot;&quot;);</span>
<span class="pc bpc" id="L1075" title="1 of 2 branches missed.">			if(isFieldDisabled(ActivityFields.QUEUES)) {</span>
<span class="fc" id="L1076">				sb.append(&quot; style=\&quot;visibility:hidden;\&quot;&quot;);</span>
			} else {
<span class="nc" id="L1078">				sb.append(&quot; style=\&quot;visibility:visible;\&quot;&quot;);</span>
			}
<span class="fc" id="L1080">			sb.append(&quot; &gt;&quot;);</span>
<span class="fc" id="L1081">			sb.append(HtmlUtil.imageTag(ImageFileID.EDIT, ImageFileID.EDIT_WIDTH,</span>
<span class="fc" id="L1082">				ImageFileID.EDIT_HEIGHT, i18n(m_bbmBundle,BbmWebBundleKey.EDIT)));</span>
<span class="fc" id="L1083">			sb.append(&quot;&lt;/span&gt;&quot;);</span>
		}
<span class="fc" id="L1085">		return sb.toString();</span>
	}

	private String makeTextReadOnlyInput(String name, int size, String value){
<span class="fc" id="L1089">		StringBuilder sb = new StringBuilder(128);</span>
<span class="fc" id="L1090">		sb.append(&quot;&lt;input type=\&quot;text\&quot; class=\&quot;inputTextReadOnly\&quot; readonly &quot;)</span>
<span class="fc" id="L1091">				.append(&quot;name=\&quot;&quot;).append(name).append(&quot;\&quot; &quot;)</span>
<span class="fc" id="L1092">				.append(&quot;id=\&quot;&quot;).append(name).append(&quot;\&quot; &quot;)</span>
<span class="fc" id="L1093">				.append(&quot; onChange=\&quot;&quot;).append(&quot;getRemoteInitJS();\n&quot;).append(&quot;\&quot;&quot;);</span>
<span class="pc bpc" id="L1094" title="1 of 2 branches missed.">		if (size &gt; 0) {</span>
<span class="fc" id="L1095">			sb.append(&quot;size=\&quot;&quot;).append(size).append(&quot;\&quot; &quot;);</span>
		}
<span class="fc" id="L1097">		sb.append(&quot;value=\&quot;&quot;).append(HtmlUtil.escapeFieldValue(value)).append(&quot;\&quot; &quot;)</span>
<span class="fc" id="L1098">				.append(&quot;&gt;&quot;);</span>
<span class="fc" id="L1099">		return sb.toString();</span>
	}

	private String getQueueIdsString() {
<span class="fc" id="L1103">		return StringUtil.createDelimitedString(m_queueIds, &quot;,&quot;);</span>
	}

	private String getQueueNamesString() throws RemoteException, BbmException {
<span class="fc" id="L1107">		return WorkloadModelHandler.getQueueDisplayFromIds(m_context, m_queueIds);</span>
	}


	private String getColorCodeLabel() {
<span class="fc" id="L1112">		return i18n(m_bbmBundle, BbmWebBundleKey.ACTIVITY_LABEL_COLOR_CODE);</span>
	}

	 private String getColorLabel() {
<span class="fc" id="L1116">		return i18n(m_bbmBundle, BbmWebBundleKey.ACTIVITY_LABEL_COLOR);</span>
	}

	private void setDefaultValues() {
<span class="fc" id="L1120">		m_activity.setPaid(PAID_DEFAULT);</span>
<span class="fc" id="L1121">		m_activity.setColor(ACTIVITY_COLOR_DEFAULT);</span>
<span class="fc" id="L1122">		m_activity.setTimeoff(TIMEOFF_DEFAULT);</span>
<span class="fc" id="L1123">		m_fsUsagePC.setDefaultValues();</span>
<span class="fc" id="L1124">		m_rmUsagePC.setDefaultValues();</span>
<span class="fc" id="L1125">		m_amUsagePC.setDefaultValues();</span>
<span class="fc" id="L1126">	}</span>

	private boolean isFieldDisabled(short field) {
<span class="pc bpc" id="L1129" title="1 of 5 branches missed.">		switch(field) {</span>
			case ActivityFields.TIMEOFF:
<span class="fc bfc" id="L1131" title="All 2 branches covered.">				if(m_activity.isTimeoff()) return false;</span>
<span class="fc" id="L1132">				return m_hasMedia;</span>
			case ActivityFields.MEDIA:
<span class="pc bpc" id="L1134" title="1 of 2 branches missed.">				if(m_hasMedia) return false;</span>
<span class="pc bpc" id="L1135" title="2 of 6 branches missed.">				return m_activity.isUsedInCalendarEvent() || m_activity.isTimeoff() || m_activity.isUnavailability();</span>
			case ActivityFields.QUEUES:
<span class="pc bpc" id="L1137" title="1 of 2 branches missed.">				if(m_hasQueues) return false;</span>
<span class="pc bpc" id="L1138" title="2 of 4 branches missed.">				return !m_activity.isQueueHopping() &amp;&amp; !hasProjectMedia();</span>
			case ActivityFields.QUEUE_HOPPING:
<span class="pc bpc" id="L1140" title="1 of 2 branches missed.">				if(hasProjectMedia()) return true;</span>
<span class="fc" id="L1141">				return false;</span>
			default:
<span class="nc" id="L1143">				return false;</span>
		}
	}

	/**
	 * Checks to see if there is a Project media is linked to this activity.
	 * @return
	 */
	private boolean hasProjectMedia() {
<span class="pc bpc" id="L1152" title="1 of 4 branches missed.">		return m_mediaIds!=null &amp;&amp; m_mediaIds.contains(Media.MEDIA_ID_PROJECT);</span>
	}

	/**
	 * Return true if Current User is authorized to configure activity FS attributes
	 */
	protected boolean isAuthorizedToConfigureFSAttributes(ID orgID) {
<span class="fc" id="L1159">		return m_context.getUser().isAuthorized(PrivilegeKeys.CORE_VIEWACTIVITIES,</span>
<span class="fc" id="L1160">				OrganizationScopeManagerProxy.getScopeID(orgID));</span>
	}

	/**
	 * Return true if Current User is authorized to configure activity AM attributes
	 */
	protected boolean isAuthorizedToConfigureAMAttributes(ID orgID) {
<span class="fc" id="L1167">		return m_context.getUser().isAuthorized(PrivilegeKeys.CORE_VIEWACTIVITIES,</span>
<span class="fc" id="L1168">				OrganizationScopeManagerProxy.getScopeID(orgID));</span>
	}

	/**
	 * Return true if Current User is authorized to configure activity AM attributes
	 */
	protected boolean isAuthorizedToConfigureAdvisorAttributes(ID orgID) {
<span class="nc" id="L1175">		return m_context.getUser().isAuthorized(PrivilegeKeys.CORE_VIEWACTIVITIES,</span>
<span class="nc" id="L1176">				OrganizationScopeManagerProxy.getScopeID(orgID));</span>
	}

	private void checkForLicenses(){
		try {
<span class="fc" id="L1181">			LicenseManager licManager = CoreManagerFactory.getLicenseManager();</span>
<span class="fc" id="L1182">			hasPayrollLicense = licManager.isLicensed(LicenseKeys.APP_PAYROLL);</span>
<span class="fc" id="L1183">			hasMultiMediaLicense = licManager.isLicensed(LicenseKeys.APP_MULTIMEDIA);</span>
<span class="fc" id="L1184">			hasQueueHoppingLicense = licManager.isLicensed(LicenseKeys.APP_QUEUE_HOPPING);</span>
<span class="fc" id="L1185">			hasAdvisorLicense = licManager.isLicensed(LicenseKeys.APP_ADVISOR_EXPRESS);</span>
<span class="nc" id="L1186">		} catch (Exception ex){</span>
<span class="nc" id="L1187">			log.l7dError(BbmWebBundleKey.UNABLE_TO_LOAD_DATA, ex);</span>
<span class="fc" id="L1188">		}</span>
<span class="fc" id="L1189">	}</span>

	protected void setSourceMeasureNullObjectIfNull() {
<span class="pc bpc" id="L1192" title="1 of 2 branches missed.">		if (m_activity.getSourceMeasureId() == null) {</span>
<span class="fc" id="L1193">			m_activity.setFieldNull(ActivityFieldInfo.SOURCEMEASUREID);</span>
		}
<span class="fc" id="L1195">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>