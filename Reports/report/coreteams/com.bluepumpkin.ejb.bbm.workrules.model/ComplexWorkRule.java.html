<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>ComplexWorkRule.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.ejb.bbm.workrules.model</a> &gt; <span class="el_source">ComplexWorkRule.java</span></div><h1>ComplexWorkRule.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.ejb.bbm.workrules.model;

import java.util.ArrayList;
import java.util.Collections;
import java.util.Date;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.LocalDate;
import com.bluepumpkin.common.util.TimeZoneUtil;
import com.bluepumpkin.ejb.bbm.empworkrule.model.WorkUnit;
import com.bluepumpkin.ejb.bbm.empworkrule.model.WorkUnit.WorkUnitType;
import com.bluepumpkin.ejb.bbm.vo.FieldInfo;
import com.bluepumpkin.ejb.bbm.vo.ValueObjectRich;
import com.bluepumpkin.ejb.bbm.workrules.model.ComplexWorkRuleFieldInfo.Column;

public class ComplexWorkRule extends ValueObjectRich {
	private static final long serialVersionUID = 1L;

	public ComplexWorkRule() {
<span class="fc" id="L20">		super();</span>
<span class="fc" id="L21">	}</span>
	
	// meta data information
<span class="fc" id="L24">	private static FieldInfo m_fieldInfo = new ComplexWorkRuleFieldInfo();</span>
<span class="fc" id="L25">	protected FieldInfo getFieldInfo() { return m_fieldInfo; }</span>

	public static final String CALENDAR_PERIOD_RELATIONSHIP_KEY = &quot;CALENDARPERIOD|ID&quot;;
	
	public static final String WORKUNIT_RELATIONSHIP_KEY = &quot;WORKUNIT|ID&quot;;
	
	public ID getID() {
<span class="fc" id="L32">		return this.getFieldValueID(Column.SID.getIndex());</span>
	}
	
	public ID getOrganizationID() {
<span class="fc" id="L36">		return this.getFieldValueID(Column.OrganizationID.getIndex());</span>
	}
	
	public void setOrganizationID(ID orgID) {
<span class="fc" id="L40">		this.setFieldValue(Column.OrganizationID.getIndex(), orgID);</span>
<span class="fc" id="L41">	}</span>
	
	public ID getCalendarPeriodID() {
<span class="nc" id="L44">		return this.getFieldValueID(Column.CalendarPeriodID.getIndex());</span>
	}
	
	public ID getWorkUnitID() {
<span class="nc" id="L48">		return this.getFieldValueID(Column.WorkUnitID.getIndex());</span>
	}
	
	public String getName() {
<span class="fc" id="L52">		return this.getFormattedFieldValue(Column.Name.getIndex());</span>
	}
	
	public void setName(String name) {
<span class="fc" id="L56">		this.setFieldValue(Column.Name.getIndex(), name);</span>
<span class="fc" id="L57">	}</span>
	
	public boolean isOffRule() {
<span class="fc" id="L60">		return this.getFieldValueBoolean(Column.IsAnOffRule.getIndex());</span>
	}
	
	public void setOffRule(boolean offRule) {
<span class="fc" id="L64">		this.setFieldValue(Column.IsAnOffRule.getIndex(), offRule);</span>
<span class="fc" id="L65">	}</span>
	
	public float getTolerance() {
<span class="nc" id="L68">		return this.getFieldValueFloat(Column.Tolerance.getIndex());</span>
	}
	
	public void setTolerance(float tolerance) {
<span class="nc" id="L72">		this.setFieldValue(Column.Tolerance.getIndex(), tolerance);</span>
<span class="nc" id="L73">	}</span>
	
	public short getPriority() {
<span class="fc" id="L76">		return this.getFieldValueShort(Column.Priority.getIndex());</span>
	}
	
	public void setPriority(short priority) {
<span class="fc" id="L80">		this.setFieldValue(Column.Priority.getIndex(), priority);</span>
<span class="fc" id="L81">	}</span>
	
	public LocalDate getEndDate() {
<span class="fc" id="L84">		Date date = this.getFieldValueDate(Column.EndDate.getIndex());</span>
<span class="pc bpc" id="L85" title="1 of 2 branches missed.">		if (date != null) return new LocalDate(date, TimeZoneUtil.GMT_TIMEZONE);</span>
<span class="nc" id="L86">		return null;</span>
	}
	
	public void setEndDate(LocalDate endDate) {
<span class="pc bpc" id="L90" title="1 of 2 branches missed.">		if (endDate == null) this.setFieldValue(Column.EndDate.getIndex(), (Date)null); </span>
<span class="fc" id="L91">		else this.setFieldValue(Column.EndDate.getIndex(), endDate.getTime(TimeZoneUtil.GMT_TIMEZONE));</span>
<span class="fc" id="L92">	}</span>
	
	//WORKUNITCOUNTCONSTRAINT Condition of the rule - 0: at least, 1: no more than, 2: between, 3: a fair number, 4: exactly 
	public WorkUnitCountConstraint getWorkUnitCountConstraint() {
<span class="fc" id="L96">		return WorkUnitCountConstraint.fromDBValue(this.getFieldValueInt(Column.WorkUnitCountConstraint.getIndex()));</span>
	}
	
	public void setWorkUnitCountConstraint(WorkUnitCountConstraint constraint) {
<span class="pc bpc" id="L100" title="1 of 2 branches missed.">		if (constraint != null) this.setFieldValue(Column.WorkUnitCountConstraint.getIndex(), constraint.getDBValue());</span>
<span class="nc" id="L101">		else this.setFieldValue(Column.WorkUnitCountConstraint.getIndex(), WorkUnitCountConstraint.Invalid.dbValue);</span>
<span class="fc" id="L102">	}</span>
	
	public int getMinWorkUnitCount() {
<span class="fc" id="L105">		WorkUnitCountConstraint countConstraint = this.getWorkUnitCountConstraint();</span>
<span class="pc bpc" id="L106" title="1 of 2 branches missed.">		if (countConstraint == WorkUnitCountConstraint.NoMoreThan) //no more than QC64528</span>
<span class="nc" id="L107">			return 0;</span>
<span class="fc" id="L108">		int value = this.getFieldValueInt(Column.MinWorkUnitCount.getIndex());</span>
<span class="fc" id="L109">		WorkUnitType workUnitType = this.getWorkUnit().getWorkUnitType();</span>
<span class="pc bpc" id="L110" title="1 of 2 branches missed.">		if (workUnitType == WorkUnitType.Hours) //by hours</span>
<span class="nc" id="L111">			value = value/4; //unit count saved in db is in 15 minutes instead of hours</span>
<span class="fc" id="L112">		return value;</span>
	}
	
	/**
	 * Note: this method will change the count's representation based on the work unit type.
	 * Be sure to set the work unit type before calling this method.
	 * @param minCount
	 */
	public void setMinWorkUnitCount(int minCount) {
<span class="fc" id="L121">		WorkUnitCountConstraint countConstraint = this.getWorkUnitCountConstraint();</span>
<span class="pc bpc" id="L122" title="1 of 2 branches missed.">		if (countConstraint == WorkUnitCountConstraint.NoMoreThan) //no more than QC64528</span>
<span class="nc" id="L123">			minCount = 0;</span>
<span class="fc" id="L124">		WorkUnitType workUnitType = this.getWorkUnit().getWorkUnitType();</span>
<span class="pc bpc" id="L125" title="1 of 2 branches missed.">		if (workUnitType == WorkUnitType.Hours) //by hours</span>
<span class="nc" id="L126">			minCount = minCount * 4; //unit count saved in db is in 15 minutes instead of hours</span>
<span class="fc" id="L127">		this.setFieldValue(Column.MinWorkUnitCount.getIndex(), minCount);</span>
<span class="fc" id="L128">	}</span>
	
	public int getMaxWorkUnitCount() {
<span class="fc" id="L131">		WorkUnitCountConstraint  countConstraint = this.getWorkUnitCountConstraint();</span>
<span class="pc bpc" id="L132" title="1 of 2 branches missed.">		if (countConstraint == WorkUnitCountConstraint.AtLeast) //at least, no max</span>
<span class="fc" id="L133">			return -1;</span>
<span class="nc" id="L134">		WorkUnitType workUnitType = this.getWorkUnit().getWorkUnitType();</span>
<span class="nc" id="L135">		int value = this.getFieldValueInt(Column.MaxWorkUnitCount.getIndex());</span>
<span class="nc bnc" id="L136" title="All 2 branches missed.">		if (workUnitType == WorkUnitType.Hours) //by hours</span>
<span class="nc" id="L137">			value = value/4; //unit count saved in db is in 15 minutes instead of hours</span>
<span class="nc" id="L138">		return value;</span>
	}
	
	/**
	 * Sets the max unit count. A value of -1 means unlimited.
	 * &lt;p&gt;
	 * Note: this method will change the count's representation based on the work unit type.
	 * Be sure to set the work unit type before calling this method.
	 * @param maxCount
	 */
	public void setMaxWorkUnitCount(int maxCount) {
<span class="fc" id="L149">		WorkUnitCountConstraint  countConstraint = this.getWorkUnitCountConstraint();</span>
<span class="pc bpc" id="L150" title="1 of 2 branches missed.">		if (countConstraint == WorkUnitCountConstraint.AtLeast) //at least, no max</span>
<span class="fc" id="L151">			maxCount = -1;</span>
<span class="fc" id="L152">		WorkUnit wu = this.getWorkUnit();</span>
<span class="pc bpc" id="L153" title="1 of 2 branches missed.">		if (wu == null) {</span>
<span class="nc" id="L154">			wu = new WorkUnit();</span>
<span class="nc" id="L155">			setWorkUnit(wu);</span>
		}
<span class="fc" id="L157">		WorkUnitType workUnitType = wu.getWorkUnitType();</span>
<span class="pc bpc" id="L158" title="1 of 2 branches missed.">		if (workUnitType == WorkUnitType.Hours) //by hours</span>
<span class="nc" id="L159">			maxCount = maxCount * 4; //unit count saved in db is in 15 minutes instead of hours</span>
<span class="fc" id="L160">		this.setFieldValue(Column.MaxWorkUnitCount.getIndex(), maxCount);</span>
<span class="fc" id="L161">	}</span>
	
	public void setCalendarPeriod(CalendarPeriod period) {
<span class="fc" id="L164">		setRelatedObjects(CALENDAR_PERIOD_RELATIONSHIP_KEY,</span>
<span class="fc" id="L165">				new ArrayList&lt;CalendarPeriod&gt;(Collections.singleton(period)));</span>
<span class="fc" id="L166">	}</span>
	
	public CalendarPeriod getCalendarPeriod() {
<span class="fc bfc" id="L169" title="All 2 branches covered.">		if (getRelatedObjects(CALENDAR_PERIOD_RELATIONSHIP_KEY).size() &gt; 0) {</span>
<span class="fc" id="L170">			return (CalendarPeriod)getRelatedObjects(CALENDAR_PERIOD_RELATIONSHIP_KEY).iterator().next();</span>
		}
<span class="fc" id="L172">		return null;</span>
	}

	public boolean IsRotatable() {
<span class="nc bnc" id="L176" title="All 2 branches missed.">		if (getCalendarPeriod() == null)</span>
<span class="nc" id="L177">			return false;</span>
		//return m_eCalendarUnit == CU_week &amp;&amp; m_nUnitCount == 1; - FS code
<span class="nc bnc" id="L179" title="All 4 branches missed.">		return CalendarPeriod.CalendarUnit.Week.equals(getCalendarPeriod().getCalendarUnit()) &amp;&amp; getCalendarPeriod().getUnitCount() == 1;</span>
	}
	
	// convert to 5.0 work rule object to take advantage of the 5.0 code to get conflicts
	
	public void setWorkUnit(WorkUnit unit) {
<span class="fc" id="L185">		setRelatedObjects(WORKUNIT_RELATIONSHIP_KEY,</span>
<span class="fc" id="L186">				new ArrayList&lt;WorkUnit&gt;(Collections.singleton(unit)));</span>
<span class="fc" id="L187">	}</span>
	
	public WorkUnit getWorkUnit() {
<span class="fc bfc" id="L190" title="All 2 branches covered.">		if (getRelatedObjects(WORKUNIT_RELATIONSHIP_KEY).size() &gt; 0) {</span>
<span class="fc" id="L191">			return (WorkUnit)getRelatedObjects(WORKUNIT_RELATIONSHIP_KEY).iterator().next();</span>
		} else {
<span class="fc" id="L193">			WorkUnit wu = new WorkUnit();</span>
<span class="fc" id="L194">			setWorkUnit(wu);</span>
<span class="fc" id="L195">			return wu;</span>
		}
	}
	
<span class="pc" id="L199">	public enum WorkUnitCountConstraint {</span>
<span class="fc" id="L200">		AtLeast(0),</span>
<span class="fc" id="L201">		NoMoreThan(1),</span>
<span class="fc" id="L202">		Between(2),</span>
<span class="fc" id="L203">		Fairly(3), </span>
<span class="fc" id="L204">		Exactly(4),</span>
<span class="fc" id="L205">		AutoRotation(5),</span>
<span class="fc" id="L206">		Rotation(6),</span>
<span class="fc" id="L207">		MustStart(7),</span>
<span class="fc" id="L208">		MustEnd(8),</span>
<span class="fc" id="L209">		MustStartBetween(9),</span>
<span class="fc" id="L210">		MustEndBetween(10),</span>
<span class="fc" id="L211">		TeamStart(11),</span>
<span class="fc" id="L212">		TeamStartAndEnd(12),</span>
<span class="fc" id="L213">		TeamStartSameDays(13),</span>
<span class="fc" id="L214">		TeamStartAndEndSameDays(14),</span>
<span class="fc" id="L215">		TeamStartEndBreakSameDays(15),</span>
<span class="fc" id="L216">		TeamOverlapEachDay(16),</span>
<span class="fc" id="L217">		TeamOverlapEachWorkingDay(17),</span>
<span class="fc" id="L218">		TeamOverlapEachWeek(18),</span>
<span class="fc" id="L219">		NumSeatsAtMost(19),</span>
<span class="fc" id="L220">		NumSeatsAtLeast(20),</span>
<span class="fc" id="L221">		FairlyStartingBetween(21),</span>
<span class="fc" id="L222">		FairlyEndingBetween(22),</span>
<span class="fc" id="L223">		Invalid(23)</span>
		;
		private int dbValue;
<span class="fc" id="L226">		private WorkUnitCountConstraint(int dbValue){</span>
<span class="fc" id="L227">			this.dbValue = dbValue;</span>
<span class="fc" id="L228">		}</span>
		public int getDBValue() {
<span class="fc" id="L230">			return dbValue;</span>
		}
		
		public static WorkUnitCountConstraint fromDBValue(int dbValue) {
<span class="pc bpc" id="L234" title="1 of 2 branches missed.">			for (WorkUnitCountConstraint val : WorkUnitCountConstraint.values()) {</span>
<span class="pc bpc" id="L235" title="1 of 2 branches missed.">				if (dbValue == val.dbValue) return val;</span>
			}
<span class="nc" id="L237">			return Invalid;</span>
		}
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>