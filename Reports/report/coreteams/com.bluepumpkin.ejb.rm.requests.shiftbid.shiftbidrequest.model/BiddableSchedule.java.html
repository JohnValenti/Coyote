<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>BiddableSchedule.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.ejb.rm.requests.shiftbid.shiftbidrequest.model</a> &gt; <span class="el_source">BiddableSchedule.java</span></div><h1>BiddableSchedule.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.ejb.rm.requests.shiftbid.shiftbidrequest.model;

/**
 * Title:        BiddableSchedule
 * Description:  This class represents an BiddableSchedule
 * Copyright:    Copyright (c) 2002
 * Company:      Blue Pumpkin Software, Inc.
 * @author       Jagdish Seelam
 * @version 1.0
 */

import java.util.Collection;
import java.util.Collections;
import java.util.List;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.ejb.bbm.schedule.model.ShiftAssignment;
import com.bluepumpkin.ejb.bbm.vo.FieldInfo;
import com.bluepumpkin.ejb.bbm.vo.ValueObjectNode;
import com.bluepumpkin.ejb.rm.requests.common.model.RequestDetailLevel;
import com.bluepumpkin.ejb.rm.requests.shiftbid.shiftbidauction.filtersortbidoptions.FilterableBidOption;

/**
 * Represents a biddable schedule.
 * 
 * see {@link com.bluepumpkin.ejb.rm.requests.shiftbid.shiftbidauction.ejb.ShiftBidAuctionManager ShiftBidAuctionManager}
 * for a description of the shift bidding process. 
 *    
 */
public class BiddableSchedule extends ValueObjectNode implements Cloneable, FilterableBidOption {

	private static final long serialVersionUID = 1L;

	/**
	 * ID, bounsPoints
	 */
	public static final long DL_BASIC = RequestDetailLevel.DL_BASIC;

	/**
	 * Shift Bid request(for preference and usingBonus) submitted by 
	 * given user for this biddable schedule.
	 */
	public static final long DL_SHIFT_BID_REQUEST_FOR_SHIFT_BIDDER = RequestDetailLevel.DL_SHIFT_BID_REQUEST_FOR_SHIFTBIDDER;

	/**
	 * Specify this detail level to compute the rank of the bid request submitted by the given user 
	 * towards this biddable schedule. This detail level loads all the necessary information to compute 
	 * the rank of this biddable schedule, from the context of a given bidderID. Specifically it loads: 
	 * &lt;li&gt; all shift bid requests for this biddable schedule.
	 * &lt;li&gt; the shift bidder associated with each biddable schedule.
	 * &lt;li&gt; the auction associated with the shift bid request. 
	 * 
	 * &lt;p&gt; Since all shift  bid requests are loaded, it also allows the computation of # of shift bid
	 * requests towards this biddable schedule.
	 */
	public static final long DL_BIDRANK_FOR_SHIFTBIDREQUEST = RequestDetailLevel.DL_BIDRANK_FOR_SHIFTBIDREQUEST_BIDDABLESCHEDULE_ROOTED;

	/**
	 * The Number of bids for this BiddableSchedule
	 */
	public static final long DL_NUMBER_OF_SHIFTBIDREQUESTS = RequestDetailLevel.DL_NUMBER_OF_SHIFTBIDREQUESTS_FOR_BIDSCHED;

	/**
	 * shifts Associated with this biddable schedule. 
	 */
	public static final long DL_SHIFT_ASSIGNMENTS_COLL = RequestDetailLevel.DL_SHIFT_ASSIGNMENTS_COLL_ROOTED_BIDDABLESCHED;

	/**
	 * Employee object (phantom employee associated with the biddable schedule)
	 */
	public static final long DL_EMPLOYEE = RequestDetailLevel.DL_EMPLOYEE_BIDSCHEDINST_CHILD;

	/**
	 * Load the BiddableSchedule instances associated with this BiddableSchedule.
	 */
	public static final long DL_BIDDABLESCHEDULEINSTANCES = RequestDetailLevel.DL_BIDDABLESCHEDULEINSTANCES;

	/**
	 * @see RequestDetailLevel#DL_INCLUDE_ZERO_NUM_OF_AVAIL_INSTANCES
	 */
	public static final long DL_INCLUDE_ZERO_NUM_OF_AVAIL_INSTANCES = RequestDetailLevel.DL_INCLUDE_ZERO_NUM_OF_AVAIL_INSTANCES;

	/**
	 * 
	 */
<span class="nc" id="L86">	private static final BiddableScheduleFieldInfo m_fieldInfo = new BiddableScheduleFieldInfo();</span>

	/**
	 * unsorted.
	 */
<span class="nc" id="L91">	public static int SORTBY_NONE = 1;</span>
	/**
	 * Name of the phantom for the first avail bid sched.
	 * &lt;p&gt;Note: does an in-memory sort
	 */
	public static final int SORTBY_PHANTOMNAME = 2;
	/**
	 * Preference specified in the shift bid request submitted towards a bidSched (bidder context required) 
	 * &lt;p&gt;Note: does an in-memory sort
	 */
	public static final int SORTBY_PREFERENCE = 3;
	/**
	 * Number of available bidSched instances.
	 * &lt;p&gt;Note: does a SQL sort
	 */
	public static final int SORTBY_NUMBER_AVAIALBLE = 4;
	/**
	 * Number of bids submitted towards this bidSched
	 * &lt;p&gt;Note: does an in-memory sort
	 */
	public static final int SORTBY_NUMBER_SUBMITTED = 5;
	/**
	 * Rank of the bidder's shiftBidRequest (bidder context required) submitted towards this 
	 * bidSched relative to other shiftBidRequests. 
	 * &lt;p&gt;Note: does an in-memory sort
	 */
	public static final int SORTBY_BIDRANK = 6;
	/**
	 * Bonus assigned to the bidSched
	 * &lt;p&gt;Note: does a SQL sort
	 */
	public static final int SORTBY_BONUSASSIGNED = 7;
	/**
	 * Total # of hours for the bidSched.
	 * &lt;p&gt;Note: does an in-memory sort
	 */
	public static final int SORTBY_HOURS = 8;

	/**
	 * Description assigned to the bidSched
	 * &lt;p&gt;Note: does a SQL sort
	 */
	public static final int SORTBY_DESCRIPTION = 9;

	public static final int SORTBY_PREFERENCE_STATUS = 10;

	/**
	 * Sunday shift's start time.
	 * &lt;p&gt;Note: does an in-memory sort
	 */
	public static final int SORTBY_SUNDAY_STARTTIME = 11;

	/**
	 * Sort by type constants. These are used in conjunction with a dayOfWeek offset
	 * and a week offset in order to determine which day column to sort, and which
	 * criteria to sort by (shift start time, shift end time, or shift length). 
	 * Again, these constants are only used for sorting by one of the day columns.
	 */
	public static final int SORTBY_STARTTIME = 0;
	public static final int SORTBY_ENDTIME = 1;
	public static final int SORTBY_LENGTH = 2;
	public static final int NUM_SORT_TYPES = 3;

	/**
	 * The shiftBidder context for which this biddableSchedule was loaded.
	 *   
	 * For example calling {@link com.bluepumpkin.ejb.rm.requests.shiftbid.shiftbidauction.ejb.IShiftBidAuctionManager#getBiddableSchedulesForAuction(ID, ID, ID, long) getBiddableSchedulesForAuction}
	 * with a shiftBidder ID sets this.  This ID is then used to process shiftBidder related information associated
	 * with this biddableSchedule such as a shift bid request. 
	 */
	protected ID m_shiftBidderID;

<span class="nc" id="L163">	private long m_detailLevel = DL_BASIC;</span>

	private List&lt;ShiftAssignment&gt; shiftAssignments;

	private List&lt;ID&gt; skillIds;

	public BiddableSchedule() {
<span class="nc" id="L170">		this(BiddableSchedule.DL_BASIC);</span>
<span class="nc" id="L171">	}</span>

	public BiddableSchedule(long detailLevel) {
<span class="nc" id="L174">		super();</span>
<span class="nc" id="L175">		m_detailLevel = detailLevel;</span>
<span class="nc" id="L176">	}</span>

	public void setShiftBidderID(ID shiftBidderID) {
<span class="nc" id="L179">		m_shiftBidderID = shiftBidderID;</span>
<span class="nc" id="L180">	}</span>

	public void setShiftBidAuctionID(ID shiftBidAuctionID) {
<span class="nc" id="L183">		setFieldValue(BiddableScheduleFieldInfo.BIDDABLESCHEDULE_I_SHIFTBIDAUCTIONID, shiftBidAuctionID);</span>
<span class="nc" id="L184">	}</span>

	public void setNumOfAvailInstances(int availInstances) {
<span class="nc" id="L187">		setFieldValue(BiddableScheduleFieldInfo.BIDDABLESCHEDULE_N_NUMOFAVAILINSTANCES, availInstances);</span>
<span class="nc" id="L188">	}</span>

	/**
	 * @param orgID
	 */
	public void setOrgID(ID orgID) {
<span class="nc" id="L194">		setFieldValue(BiddableScheduleFieldInfo.BIDDABLESCHEDULE_I_ORGANIZATIONID, orgID);</span>
<span class="nc" id="L195">	}</span>

	public void setIsFullPeriod(boolean isFullPeriod) {
<span class="nc bnc" id="L198" title="All 2 branches missed.">		setFieldValue(BiddableScheduleFieldInfo.BIDDABLESCHEDULE_B_ISFORSINGLESHIFTS, !isFullPeriod);</span>
<span class="nc" id="L199">	}</span>

	private Collection&lt;ShiftBidRequestBiddableSchedule&gt; getShiftBidRequestBiddableSchedules() {
<span class="nc" id="L202">		return getChildObjects(BiddableScheduleFieldInfo.SHIFTBIDREQUESTBIDDABLESCHEDULE_CHILD_TYPE);</span>
	}

	/**
	 * This considers all bids irrespective of the state of the bids (ie states such as 
	 * approved, invalid, withdrawn and similar are included).
	 * 
	 * @return
	 */
	public int getNumberOfBids() {
<span class="nc" id="L212">		return getShiftBidRequestBiddableSchedules().size();</span>
	}

	@Override
	protected FieldInfo getFieldInfo() {
<span class="nc" id="L217">		return m_fieldInfo;</span>
	}

	// getters
	public int getBonusPoints() {
<span class="nc" id="L222">		return getFieldValueInt(BiddableScheduleFieldInfo.BIDDABLESCHEDULE_N_BONUSPOINTS);</span>
	}

	public ID getShiftBidAuctionID() {
<span class="nc" id="L226">		return getFieldValueID(BiddableScheduleFieldInfo.BIDDABLESCHEDULE_I_SHIFTBIDAUCTIONID);</span>
	}

	@Override
	public int getNumOfAvailableInstances() {
<span class="nc" id="L231">		return getFieldValueInt(BiddableScheduleFieldInfo.BIDDABLESCHEDULE_N_NUMOFAVAILINSTANCES);</span>
	}

	public String getDescription() {
<span class="nc" id="L235">		return (String) getFieldValue(BiddableScheduleFieldInfo.BIDDABLESCHEDULE_S_DESCRIPTION);</span>
	}

	public long getDetailLevel() {
<span class="nc" id="L239">		return m_detailLevel;</span>
	}

	/**
	 * @return
	 */
	public ID getOrgID() {
<span class="nc" id="L246">		return getFieldValueID(BiddableScheduleFieldInfo.BIDDABLESCHEDULE_I_ORGANIZATIONID);</span>
	}

	public boolean getIsFullPeriod() {
<span class="nc bnc" id="L250" title="All 2 branches missed.">		return !getFieldValueBoolean(BiddableScheduleFieldInfo.BIDDABLESCHEDULE_B_ISFORSINGLESHIFTS);</span>
	}

	/**
	 * Is the given sort criteria for a day column?
	 * @param sortBy A sort by column.
	 * @return True if the sortBy column is for a day column.
	 */
	public static boolean isSortByCriteriaDay(int sortBy) {
<span class="nc bnc" id="L259" title="All 2 branches missed.">		return (sortBy &gt;= SORTBY_SUNDAY_STARTTIME);</span>
	}

	/**
	 * Given week, day, and type offsets, compute the column number.
	 * @param week The 0-based week offset. (Ex: 0=the first week in the SP)
	 * @param dayOfWeek  The day of week.  (Ex: Calendar.SUNDAY would mean: The Sunday of the specified week in the SP)
	 * @param type The type offset. (One of: SORTBY_STARTTIME, SORTBY_ENDTIME, SORTBY_LENGTH)
	 * @return The appropriate day column index (see below).
	 *  
	 * The first week will use the following indexes:
	 *     SORTBY_STARTTIME: 9  - 15 (Sun - Sat)
	 *     SORTBY_ENDTIME:   16 - 22 (Sun - Sat)
	 *     SORTBY_LENGTH:    23 - 29 (Sun - Sat)
	 *     
	 * The second week will use the following indexes:
	 *     SORTBY_STARTTIME: 30 - 36 (Sun - Sat)
	 *     SORTBY_ENDTIME:   37 - 43 (Sun - Sat)
	 *     SORTBY_LENGTH:    44 - 50 (Sun - Sat)
	 *     
	 * And so on.
	 */
	public static int getDayColumnIndex(int week, int dayOfWeek, int type) {
<span class="nc" id="L282">		int colIndex = SORTBY_SUNDAY_STARTTIME + (dayOfWeek - 1) + (7 * type) + (7 * NUM_SORT_TYPES * week);</span>
<span class="nc" id="L283">		return colIndex;</span>
	}

	/**
	 * Given a day column number, compute the day of week.
	 * @param colIndex The day column number to extract the week from. 
	 * @return The appropriate day of week (Ex: Calendar.SUNDAY, Calendar.MONDAY, etc.)
	 */
	public static int getDayOfWeek(int colIndex) {
<span class="nc" id="L292">		int type = getType(colIndex);</span>
<span class="nc" id="L293">		int week = getWeek(colIndex);</span>

		//In order to figure out dayOfWeek, we solve for dayOfWeek in the colIndex 
		//equation from the getDayColumnIndex() method.
<span class="nc" id="L297">		int dayOfWeek = (-1) * (SORTBY_SUNDAY_STARTTIME + (7 * type) + (7 * NUM_SORT_TYPES * week) - colIndex - 1);</span>

<span class="nc" id="L299">		return dayOfWeek;</span>
	}

	/**
	 * Given a day column number, compute the week offset.
	 * @param colIndex The column number to extract the week from. 
	 * @return The appropriate week (Ex: 0=the first week, 1=the second week, etc.)
	 */
	public static int getWeek(int colIndex) {
<span class="nc" id="L308">		return (colIndex - SORTBY_SUNDAY_STARTTIME) / (7 * NUM_SORT_TYPES);</span>
	}

	/**
	 * Given a day column number, compute the sort type.
	 * @param colIndex The column number to extract the type from. 
	 * @return The appropriate sort type (One of: SORTBY_STARTTIME, SORTBY_ENDTIME, SORTBY_LENGTH)
	 */
	public static int getType(int colIndex) {
<span class="nc" id="L317">		return ((colIndex - SORTBY_SUNDAY_STARTTIME) / 7) % NUM_SORT_TYPES;</span>
	}

	public void setBonusPoints(int bonusPoints) {
<span class="nc" id="L321">		setFieldValue(BiddableScheduleFieldInfo.BIDDABLESCHEDULE_N_BONUSPOINTS, bonusPoints);</span>
<span class="nc" id="L322">	}</span>

	public void setDescription(String description) {
<span class="nc" id="L325">		setFieldValue(BiddableScheduleFieldInfo.BIDDABLESCHEDULE_S_DESCRIPTION, description);</span>
<span class="nc" id="L326">	}</span>

	@Override
	public List&lt;ShiftAssignment&gt; getShiftAssignments() {
<span class="nc bnc" id="L330" title="All 2 branches missed.">		return shiftAssignments == null ? Collections.emptyList() : shiftAssignments;</span>
	}

	public void setShiftAssignments(List&lt;ShiftAssignment&gt; shifts) {
<span class="nc" id="L334">		shiftAssignments = shifts;</span>
<span class="nc" id="L335">	}</span>

	@Override
	public String getTemplateName() {
<span class="nc" id="L339">		return getFormattedFieldValue(BiddableScheduleFieldInfo.BIDDABLESCHEDULE_S_TEMPLATENAME);</span>
	}

	public void setTemplateName(String templateName) {
<span class="nc" id="L343">		setFieldValue(BiddableScheduleFieldInfo.BIDDABLESCHEDULE_S_TEMPLATENAME, templateName);</span>
<span class="nc" id="L344">	}</span>

	@Override
	//This return the integer ID for the skills (i.e SKILL.SID, not SKILL.ID)
	//In SkillsDAO.java SKILL.SID is loaded as the ID instead of SKILL.ID
	public List&lt;ID&gt; getSkillIds() {
<span class="nc bnc" id="L350" title="All 2 branches missed.">		return skillIds == null ? Collections.emptyList() : skillIds;</span>
	}

	public void setSkillIds(List&lt;ID&gt; skillIds) {
<span class="nc" id="L354">		this.skillIds = skillIds;</span>
<span class="nc" id="L355">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>