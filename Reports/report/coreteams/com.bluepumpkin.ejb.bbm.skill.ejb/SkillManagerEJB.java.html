<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>SkillManagerEJB.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.ejb.bbm.skill.ejb</a> &gt; <span class="el_source">SkillManagerEJB.java</span></div><h1>SkillManagerEJB.java</h1><pre class="source lang-java linenums">/*
 * Copyright -2011 Verint Systems, Inc.
 */

package com.bluepumpkin.ejb.bbm.skill.ejb;

import java.rmi.RemoteException;
import java.text.DecimalFormat;
import java.util.ArrayList;
import java.util.Collection;
import java.util.Collections;
import java.util.Date;
import java.util.HashMap;
import java.util.Iterator;
import java.util.Map;

import javax.naming.Context;
import javax.naming.InitialContext;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.jdmo.JdmoDuplicateKeyException;
import com.bluepumpkin.common.jdmo.JdmoException;
import com.bluepumpkin.common.jdmo.JdmoUtil;
import com.bluepumpkin.common.logging.Category;
import com.bluepumpkin.common.util.TimeZoneUtil;
import com.bluepumpkin.ejb.bbm.BbmManagerFactory;
import com.bluepumpkin.ejb.bbm.Log;
import com.bluepumpkin.ejb.bbm.base.BbmCreateDuplicateKeyException;
import com.bluepumpkin.ejb.bbm.base.BbmCreateException;
import com.bluepumpkin.ejb.bbm.base.BbmFinderException;
import com.bluepumpkin.ejb.bbm.base.BbmObjectNotFoundException;
import com.bluepumpkin.ejb.bbm.base.BbmRemoveException;
import com.bluepumpkin.ejb.bbm.base.BbmUpdateException;
import com.bluepumpkin.ejb.bbm.dao.DAOBase;
import com.bluepumpkin.ejb.bbm.dao.MapUtil;
import com.bluepumpkin.ejb.bbm.dao.MapUtil.ObjectType;
import com.bluepumpkin.ejb.bbm.dao.MapUtil.SystemType;
import com.bluepumpkin.ejb.bbm.skill.model.GenericSkillAssignment;
import com.bluepumpkin.ejb.bbm.skill.model.Skill;
import com.bluepumpkin.ejb.bbm.skill.model.SkillAssignment;
import com.bluepumpkin.ejb.bbm.workresource.ejb.WorkResourceManager;
import com.bluepumpkin.ejb.core.base.MultiUserException;
import com.bluepumpkin.ejb.core.base.SessionEJBBase;

<span class="fc" id="L45">public class SkillManagerEJB extends SessionEJBBase {</span>

	/**
	 * 
	 */
	private static final long serialVersionUID = 1L;
<span class="fc" id="L51">	private static Category m_cat = Log.initCategory(SkillManagerEJB.class.getName());</span>

<span class="fc" id="L53">	private WorkResourceManager workResourceManager = null;</span>
<span class="fc" id="L54">	private boolean isWhatIfMode = false;</span>

	/** override the base class to provide the appropriate logging category */
	protected Category getCategory() {
<span class="fc" id="L58">		return m_cat;</span>
	}

	public void onEjbCreate() {
		try {
<span class="fc" id="L63">			m_strEJBClass = SkillManagerEJB.class.getName();</span>
			
			// First query environment to get WIF setting from DD
<span class="fc" id="L66">			Context initialContext = new InitialContext();</span>
<span class="fc" id="L67">			Boolean WIF = (Boolean) initialContext.lookup(&quot;java:comp/env/WIF&quot;);</span>
<span class="pc bpc" id="L68" title="1 of 2 branches missed.">			if (WIF != null) {</span>
<span class="fc" id="L69">				isWhatIfMode = WIF.booleanValue();</span>
			}
<span class="fc" id="L71">			workResourceManager = BbmManagerFactory.getWorkResourceManager(isWhatIfMode);</span>
<span class="nc" id="L72">		} catch (Exception e) {</span>
<span class="nc" id="L73">			handleException(&quot;onEjbCreate&quot;, e, false);</span>
<span class="fc" id="L74">		}</span>
<span class="fc" id="L75">	}</span>

	/**
	 * get skill object given its id
	 */
	public Skill getSkillByID(ID id) throws BbmObjectNotFoundException, BbmFinderException {
<span class="fc" id="L81">		Collection&lt;ID&gt; aSkillIDs = Collections.singleton(id);</span>
<span class="fc" id="L82">		Collection&lt;Skill&gt; aSkills = getSkillsByIDs(aSkillIDs);</span>
<span class="pc bpc" id="L83" title="1 of 2 branches missed.">		if (aSkills.isEmpty()) {</span>
<span class="nc" id="L84">			BbmObjectNotFoundException e = new BbmObjectNotFoundException();</span>
<span class="nc" id="L85">			handleException(e, false);</span>
<span class="nc" id="L86">			throw e;</span>
		}
<span class="fc" id="L88">		return (Skill) aSkills.iterator().next();</span>
	}

	/**
	 * get skill object given its DE string id
	 */
	public Skill getSkillByStringID(ID id) throws BbmObjectNotFoundException, BbmFinderException {
<span class="fc" id="L95">		methodStart(&quot;getSkillByStringID&quot;, id);</span>
<span class="fc" id="L96">		SkillDAO dao = getSkillDAO();</span>
		try {
<span class="fc" id="L98">			Collection&lt;ID&gt; aSkillIDs = Collections.singleton(id);</span>
<span class="fc" id="L99">			Collection aSkills = dao.getSkillsByStringIDs(aSkillIDs);</span>
<span class="pc bpc" id="L100" title="1 of 2 branches missed.">			if (aSkills.isEmpty()) {</span>
<span class="nc" id="L101">				throw new BbmObjectNotFoundException();</span>
			}
<span class="fc" id="L103">			return (Skill) aSkills.iterator().next();</span>
<span class="nc" id="L104">		} catch (BbmObjectNotFoundException e) {</span>
<span class="nc" id="L105">			handleException(e, false);</span>
<span class="nc" id="L106">			throw e;</span>
<span class="nc" id="L107">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L108">			handleException(e);</span>
<span class="nc" id="L109">			throw e;</span>
		} finally {
<span class="pc" id="L111">			methodFinishWithCleanUp(dao);</span>
		}
	}

	SkillDAO getSkillDAO() {
<span class="fc" id="L116">		return new SkillDAO();</span>
	}

	/**
	 * get skills by ids
	 */
	public Collection&lt;Skill&gt; getSkillsByIDs(Collection&lt;ID&gt; colIDs) throws BbmFinderException {
<span class="fc" id="L123">		methodStart(&quot;getSkillsByIDs&quot;, colIDs);</span>
<span class="fc" id="L124">		SkillDAO dao = getSkillDAO();</span>
		try {
<span class="fc" id="L126">			return dao.getSkillsByIDs(colIDs);</span>
<span class="nc" id="L127">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L128">			handleException(e);</span>
<span class="nc" id="L129">			throw e;</span>
		} finally {
<span class="pc" id="L131">			methodFinishWithCleanUp(dao);</span>
		}
	}

	public Collection getSkills() throws BbmFinderException {
<span class="nc" id="L136">		methodStart(&quot;getSkills&quot;);</span>
<span class="nc" id="L137">		SkillDAO dao = getSkillDAO();</span>
		try {
<span class="nc" id="L139">			return dao.getSkills();</span>
<span class="nc" id="L140">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L141">			handleException(e);</span>
<span class="nc" id="L142">			throw e;</span>
		} finally {
<span class="nc" id="L144">			methodFinishWithCleanUp(dao);</span>
		}
	}

	/**
	 * get skills assigned to a given organization
	 */
	public Collection getSkillsInOrg(ID idOrg) throws BbmFinderException {
<span class="nc" id="L152">		methodStart(&quot;getSkillsInOrg&quot;, idOrg);</span>
<span class="nc" id="L153">		SkillDAO dao = getSkillDAO();</span>
		try {
<span class="nc" id="L155">			return dao.getSkillsInOrg(idOrg);</span>
<span class="nc" id="L156">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L157">			handleException(e);</span>
<span class="nc" id="L158">			throw e;</span>
		} finally {
<span class="nc" id="L160">			methodFinishWithCleanUp(dao);</span>
		}
	}

	/**
	 * get skills in a given org and all its parent orgs
	 */
	public Collection getAvailableSkillsInOrg(ID idOrg) throws RemoteException, BbmFinderException {
<span class="nc" id="L168">		return getAvailableSkillsInOrg(Collections.singleton(idOrg));</span>
	}

	/**
	 * get skills in a list of given orgs and all their parent orgs
	 */
	public Collection getAvailableSkillsInOrg(Collection colOrgIDs) throws BbmFinderException {
<span class="fc" id="L175">		methodStart(&quot;getAvailableSkillsInOrg&quot;);</span>
<span class="fc" id="L176">		SkillDAO dao = getSkillDAO();</span>
		try {
<span class="fc" id="L178">			return dao.getAvailableSkillsInOrg(colOrgIDs);</span>
<span class="nc" id="L179">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L180">			handleException(e);</span>
<span class="nc" id="L181">			throw e;</span>
		} finally {
<span class="pc" id="L183">			methodFinishWithCleanUp(dao);</span>
		}
	}

	/**
	 * get skills in a given org and its child orgs
	 */
	public Collection getManagedSkillsInOrg(ID idOrg) throws BbmFinderException {
<span class="nc" id="L191">		methodStart(&quot;getManagedSkillsInOrg&quot;, idOrg);</span>
<span class="nc" id="L192">		SkillDAO dao = getSkillDAO();</span>
		try {
<span class="nc" id="L194">			return dao.getManagedSkillsInOrg(idOrg);</span>
<span class="nc" id="L195">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L196">			handleException(e);</span>
<span class="nc" id="L197">			throw e;</span>
		} finally {
<span class="nc" id="L199">			methodFinishWithCleanUp(dao);</span>
		}
	}

	/**
	 * insert a skill object into database
	 */
	public ID createSkill(Skill objValue) throws RemoteException, BbmCreateException {
<span class="fc" id="L207">		methodStart(&quot;createSkill&quot;, objValue);</span>
<span class="fc" id="L208">		SkillDAO dao = getSkillDAO();</span>
		try {
<span class="fc" id="L210">			return dao.createSkill(objValue);</span>
<span class="nc" id="L211">		} catch (JdmoDuplicateKeyException e) {</span>
<span class="nc" id="L212">			handleException(e);</span>
<span class="nc" id="L213">			throw new BbmCreateDuplicateKeyException(e);</span>
<span class="nc" id="L214">		} catch (JdmoException e) {</span>
<span class="nc" id="L215">			handleException(e);</span>
<span class="nc" id="L216">			throw new BbmCreateException(e);</span>
		} finally {
<span class="pc" id="L218">			methodFinishWithCleanUp(dao);</span>
		}
	}

	protected void methodFinishWithCleanUp(DAOBase dao) {
<span class="pc bpc" id="L223" title="1 of 2 branches missed.">		if (dao != null) {</span>
<span class="fc" id="L224">			dao.cleanUp();</span>
		}
<span class="fc" id="L226">		methodFinish();</span>
<span class="fc" id="L227">	}</span>

	public ID createSkill(Skill skill, SystemType externalSystemType, ID skillExternalID) throws RemoteException,
			BbmCreateException {
<span class="nc" id="L231">		methodStart(&quot;createSkill&quot;, skill, externalSystemType, skillExternalID);</span>

		// validate
<span class="nc" id="L234">		String errorMessage = getValidateErrorMessage(externalSystemType, skillExternalID);</span>
<span class="nc bnc" id="L235" title="All 2 branches missed.">		if (errorMessage != null) {</span>
<span class="nc" id="L236">			throw new BbmCreateException(errorMessage);</span>
		}
		
		// create
		try {
<span class="nc" id="L241">			ID skillID = createSkill(skill);</span>
<span class="nc" id="L242">			boolean insert = true;</span>
<span class="nc" id="L243">			syncExternalSystem(externalSystemType, skillExternalID, skillID,</span>
					insert);
<span class="nc" id="L245">			return skillID;</span>
<span class="nc" id="L246">		} catch (JdmoException e) {</span>
<span class="nc" id="L247">			handleException(e);</span>
<span class="nc" id="L248">			throw new BbmCreateException(e);</span>
		} finally {
<span class="nc" id="L250">			methodFinish();</span>
		}
	}

	void syncExternalSystem(SystemType externalSystemType,
			ID skillExternalID, ID skillID, boolean insert)
			throws JdmoException {
<span class="nc" id="L257">		MapUtil.setWfoToExternalID(externalSystemType, ObjectType.Skill, skillID, skillExternalID, null, insert);</span>
<span class="nc" id="L258">	}</span>

	/**
	 * Create a list of Skills. Create will fail if creating any one Skill
	 * fails.
	 * 
	 * @param skills
	 *            a collection of Skill objects
	 * @return a list of Skill ids
	 */
	public Collection&lt;ID&gt; createSkills(Collection skills) throws RemoteException, BbmCreateException {
<span class="nc" id="L269">		methodStart(&quot;createSkills&quot;, skills);</span>
<span class="nc" id="L270">		Collection&lt;ID&gt; arrIDs = new ArrayList&lt;ID&gt;(skills.size());</span>
<span class="nc" id="L271">		SkillDAO dao = getSkillDAO();</span>
<span class="nc" id="L272">		Skill skill = null;</span>

		try {
<span class="nc" id="L275">			Iterator it = skills.iterator();</span>
<span class="nc bnc" id="L276" title="All 2 branches missed.">			while (it.hasNext()) {</span>
<span class="nc" id="L277">				skill = (Skill) it.next();</span>
<span class="nc" id="L278">				arrIDs.add(dao.createSkill(skill));</span>
			}

<span class="nc" id="L281">			return arrIDs;</span>
<span class="nc" id="L282">		} catch (JdmoDuplicateKeyException e) {</span>
<span class="nc" id="L283">			handleException(e);</span>
<span class="nc" id="L284">			throw new BbmCreateDuplicateKeyException(skill.getName() + &quot;:&quot;</span>
<span class="nc" id="L285">					+ skill.getMediaID());</span>
<span class="nc" id="L286">		} catch (JdmoException e) {</span>
<span class="nc" id="L287">			handleException(e);</span>
<span class="nc" id="L288">			throw new BbmCreateException(e);</span>
		} finally {
<span class="nc" id="L290">			methodFinishWithCleanUp(dao);</span>
		}
	}

	/**
	 * save a modified skill object to database
	 * 
	 * @param objValue
	 *            - the skill to update. The Skill's ID must be the SID.
	 */
	public void updateSkill(Skill objValue) throws RemoteException, MultiUserException, BbmUpdateException {
<span class="nc" id="L301">		methodStart(&quot;updateSkill&quot;, objValue);</span>
		try {
<span class="nc" id="L303">			SkillDAO.updateSkill(objValue);</span>
<span class="nc" id="L304">		} catch (JdmoException e) {</span>
<span class="nc" id="L305">			handleException(e);</span>
<span class="nc" id="L306">			throw new BbmUpdateException(e);</span>
		} finally {
<span class="nc" id="L308">			methodFinish();</span>
<span class="nc" id="L309">		}</span>
<span class="nc" id="L310">	}</span>

	/**
	 * save a modified skill object to database
	 * 
	 * @param objValue
	 *            - the skill to update. The Skill's ID must be the DE string
	 *            ID.
	 */
	public void updateSkillByStringID(Skill objValue) throws RemoteException, MultiUserException, BbmUpdateException {
<span class="fc" id="L320">		methodStart(&quot;updateSkillByStringID&quot;, objValue);</span>
		try {
<span class="fc" id="L322">			SkillDAO.updateSkillByStringID(objValue);</span>
<span class="nc" id="L323">		} catch (JdmoException e) {</span>
<span class="nc" id="L324">			handleException(e);</span>
<span class="nc" id="L325">			throw new BbmUpdateException(e);</span>
		} finally {
<span class="pc" id="L327">			methodFinish();</span>
<span class="fc" id="L328">		}</span>
<span class="fc" id="L329">	}</span>

	/**
	 * Match external id of an existing/modified skill object to database
	 * 
	 * @param objValue
	 *            - the skill pushed.
	 */
	public void matchSkillWithExternalID(Skill objValue, SystemType externalSystemType, ID skillExternalID)
			throws RemoteException, BbmUpdateException {
<span class="nc" id="L339">		methodStart(&quot;matchSkillWithExternalID&quot;, objValue, externalSystemType, skillExternalID);</span>

		// validate
<span class="nc" id="L342">		String errorMessage = getValidateErrorMessage(externalSystemType, skillExternalID);</span>
<span class="nc bnc" id="L343" title="All 2 branches missed.">		if (errorMessage != null) {</span>
<span class="nc" id="L344">			throw new BbmUpdateException(errorMessage);</span>
		}

		// match external id for existing skill
		try {
<span class="nc" id="L349">			boolean insert = true;</span>
<span class="nc" id="L350">			syncExternalSystem(externalSystemType, skillExternalID, objValue.getID(), insert);</span>
<span class="nc" id="L351">		} catch (JdmoException e) {</span>
<span class="nc" id="L352">			handleException(e);</span>
<span class="nc" id="L353">			throw new BbmUpdateException(e);</span>
		} finally {
<span class="nc" id="L355">			methodFinish();</span>
<span class="nc" id="L356">		}</span>
<span class="nc" id="L357">	}</span>

	private String getValidateErrorMessage(SystemType externalSystemType,
			ID skillExternalID) {
<span class="nc bnc" id="L361" title="All 2 branches missed.">		if (externalSystemType == null) {</span>
<span class="nc" id="L362">			return &quot;externalSystemType is null&quot;;</span>
		}
<span class="nc bnc" id="L364" title="All 2 branches missed.">		if (skillExternalID == null) {</span>
<span class="nc" id="L365">			return &quot;externalSourceId is null&quot;;</span>
		}
<span class="nc bnc" id="L367" title="All 4 branches missed.">		if (skillExternalID.isInt() &amp;&amp; !externalSystemType.isExtIdAnInt) {</span>
<span class="nc" id="L368">			return &quot;For this external system, externalSourceId must be a string not an integer&quot;;</span>
		}
<span class="nc bnc" id="L370" title="All 4 branches missed.">		if (!skillExternalID.isInt() &amp;&amp; externalSystemType.isExtIdAnInt) {</span>
<span class="nc" id="L371">			return &quot;For this external system, externalSourceId must be an integer not a string&quot;;</span>
		}
<span class="nc" id="L373">		return null;</span>
	}

	/**
	 * delete skills given their ids
	 */
	public void deleteSkills(Collection colIDs) throws RemoteException, BbmRemoveException {
<span class="nc" id="L380">		methodStart(&quot;deleteSkills&quot;, colIDs);</span>
<span class="nc" id="L381">		SkillDAO dao = getSkillDAO();</span>
		try {
<span class="nc" id="L383">			dao.deleteSkills(colIDs);</span>
<span class="nc" id="L384">		} catch (JdmoException e) {</span>
<span class="nc" id="L385">			handleException(e);</span>
<span class="nc" id="L386">			throw new BbmRemoveException(e);</span>
		} finally {
<span class="nc" id="L388">			methodFinishWithCleanUp(dao);</span>
<span class="nc" id="L389">		}</span>
<span class="nc" id="L390">	}</span>

	/**
	 * get skills for a list of work resources
	 *
	 * @colWorkResourceIDs a collection of work resource ids
	 * @dtStart, @dtEnd: the time period, null date means a open period
	 *
	 * @return a HashMap of following pairs (id WorkResource, array list of
	 *         skills)
	 */
	public HashMap&lt;ID, Collection&lt;Skill&gt;&gt; getSkillsForWorkResources(Collection&lt;ID&gt; colWorkResourceIDs, Date dtStart,
			Date dtEnd) throws BbmFinderException, RemoteException {
<span class="fc" id="L403">		HashMap&lt;ID, Collection&lt;SkillAssignment&gt;&gt; workResourcesToSkillAssignments = getSkillAssignments(</span>
				colWorkResourceIDs, dtStart, dtEnd);
<span class="fc" id="L405">		HashMap&lt;ID, Collection&lt;Skill&gt;&gt; returnValue = new HashMap&lt;ID, Collection&lt;Skill&gt;&gt;();</span>
<span class="fc" id="L406">		Map&lt;ID, Skill&gt; mapSkill = new HashMap&lt;ID, Skill&gt;();</span>
<span class="fc bfc" id="L407" title="All 2 branches covered.">		for (Map.Entry&lt;ID, Collection&lt;SkillAssignment&gt;&gt; entry : workResourcesToSkillAssignments.entrySet()) {</span>
<span class="fc" id="L408">			Collection&lt;Skill&gt; skills = new ArrayList&lt;Skill&gt;();</span>
<span class="fc bfc" id="L409" title="All 2 branches covered.">			for (SkillAssignment assignment : entry.getValue()) {</span>
<span class="fc" id="L410">				ID skillSID = assignment.getSkillID();</span>
<span class="fc" id="L411">				Skill s = mapSkill.get(skillSID);</span>
<span class="fc bfc" id="L412" title="All 2 branches covered.">				if (s == null) {</span>
<span class="fc" id="L413">					s = getSkillByID(skillSID);</span>
<span class="fc" id="L414">					mapSkill.put(skillSID, s);</span>
				}
<span class="fc" id="L416">				skills.add(s);</span>
<span class="fc" id="L417">			}</span>
<span class="fc" id="L418">			returnValue.put(entry.getKey(), skills);</span>
<span class="fc" id="L419">		}</span>
<span class="fc" id="L420">		return returnValue;</span>
	}

	/**
	 * get a given work resource's skill assignment
	 *
	 * @idWorkResource work resource id
	 * @dtStart, @dtEnd: the time period, null date means a open period
	 *
	 * @return a collection of SkillAssignment objects which hold the assignment
	 *         information
	 */
	public Collection&lt;SkillAssignment&gt; getSkillAssignments(ID idWorkResource, Date dtStart, Date dtEnd)
			throws BbmFinderException {
<span class="fc" id="L434">		methodStart(&quot;getSkillAssignments&quot;, idWorkResource, dtStart, dtEnd);</span>
<span class="fc" id="L435">		SkillAssignmentDAO dao = getSkillAssignmentDAO();</span>
		try {
<span class="fc" id="L437">			Collection&lt;ID&gt; colWorkResourceIDs = new ArrayList&lt;ID&gt;();</span>
<span class="fc" id="L438">			colWorkResourceIDs.add(idWorkResource);</span>
<span class="fc" id="L439">			Map&lt;ID, Collection&lt;SkillAssignment&gt;&gt; hSkills = dao.getSkillAssignments(colWorkResourceIDs, dtStart,</span>
					dtEnd);
<span class="fc" id="L441">			return hSkills.get(idWorkResource);</span>
<span class="nc" id="L442">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L443">			handleException(e);</span>
<span class="nc" id="L444">			throw e;</span>
		} finally {
<span class="pc" id="L446">			methodFinishWithCleanUp(dao);</span>
		}
	}

	/**
	 * get skill assignments for a list of work resources
	 *
	 * @colWorkResourceIDs a collection of work resource ids
	 * @dtStart, @dtEnd: the time period, null date means a open period
	 *
	 * @return a HashMap of following pairs (idWorkResource, array list of skill
	 *         assignments)
	 */
	public HashMap&lt;ID, Collection&lt;SkillAssignment&gt;&gt; getSkillAssignments(Collection&lt;ID&gt; colWorkResourceIDs,
			Date dtStart, Date dtEnd) throws BbmFinderException {
<span class="fc" id="L461">		methodStart(&quot;getSkillAssignments&quot;, colWorkResourceIDs, dtStart, dtEnd);</span>
<span class="fc" id="L462">		SkillAssignmentDAO dao = getSkillAssignmentDAO();</span>
		try {
<span class="fc" id="L464">			return dao.getSkillAssignments(colWorkResourceIDs, dtStart, dtEnd);</span>
<span class="nc" id="L465">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L466">			handleException(e);</span>
<span class="nc" id="L467">			throw e;</span>
		} finally {
<span class="pc" id="L469">			methodFinishWithCleanUp(dao);</span>
		}
	}

	/**
	 * get skill assignments for a list of template work resources
	 *
	 * @colWorkResourceIDs a collection of template work resource ids
	 * @dtStart, @dtEnd: the time period, null date means a open period
	 *
	 * @return a HashMap of following pairs (idWorkResource, array list of skill
	 *         assignments)
	 */
	public HashMap getSkillAssignmentsForTemplates(Collection&lt;ID&gt; colTmplWorkResourceIDs, Date dtStart, Date dtEnd)
			throws BbmFinderException {
<span class="nc" id="L484">		methodStart(&quot;getSkillAssignmentsForTemplates&quot;, colTmplWorkResourceIDs, dtStart, dtEnd);</span>
<span class="nc" id="L485">		SkillAssignmentDAO dao = getSkillAssignmentDAO();</span>
		try {
<span class="nc" id="L487">			return dao.getSkillAssignmentsForTemplates(colTmplWorkResourceIDs, dtStart, dtEnd);</span>
<span class="nc" id="L488">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L489">			handleException(e);</span>
<span class="nc" id="L490">			throw e;</span>
		} finally {
<span class="nc" id="L492">			methodFinishWithCleanUp(dao);</span>
		}
	}

	/**
	 * get skill assignments for a template work resource
	 *
	 * @empTemplateID a collection of template work resource ids
	 * @dtStart, @dtEnd: the time period, null date means a open period
	 *
	 * @return a collection of skill assignments.
	 */
	public Collection getSkillAssignmentsForTemplate(ID empTemplateID, Date dtStart, Date dtEnd)
			throws BbmFinderException {
<span class="nc" id="L506">		methodStart(&quot;getSkillAssignmentsForTemplate&quot;, empTemplateID, dtStart, dtEnd);</span>
<span class="nc" id="L507">		SkillAssignmentDAO dao = getSkillAssignmentDAO();</span>
		try {
<span class="nc" id="L509">			Map IDToSkillsMap = dao.getSkillAssignmentsForTemplates(Collections.singletonList(empTemplateID), dtStart,</span>
					dtEnd);

<span class="nc" id="L512">			Collection skills = (Collection) IDToSkillsMap.get(empTemplateID);</span>
			// Web Calendar can only work with ArrayList
			// instead of EmptyList because of type-safe definition,
			// fixing Defect ID : 106532 Manually creating a Shift for a
			// Staffing profile throws exceptions
<span class="nc bnc" id="L517" title="All 2 branches missed.">			return (skills == null) ? new ArrayList() : skills; </span>

<span class="nc" id="L519">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L520">			handleException(e);</span>
<span class="nc" id="L521">			throw e;</span>
		} finally {
<span class="nc" id="L523">			methodFinishWithCleanUp(dao);</span>
		}
	}

	/**
	 * get a list of skill assignment given their IDs
	 *
	 */
	public Collection getSkillAssignmentsByIDs(Collection colIDSAs) throws BbmFinderException {
<span class="nc" id="L532">		methodStart(&quot;getSkillAssignmentsByIDs&quot;, colIDSAs);</span>
<span class="nc" id="L533">		SkillAssignmentDAO dao = getSkillAssignmentDAO();</span>
		try {
<span class="nc" id="L535">			return dao.getSkillAssignmentsByIDs(colIDSAs);</span>
<span class="nc" id="L536">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L537">			handleException(e);</span>
<span class="nc" id="L538">			throw e;</span>
		} finally {
<span class="nc" id="L540">			methodFinishWithCleanUp(dao);</span>
		}
	}

	/** create a skill assignment */
	public ID createSkillAssignment(SkillAssignment objValue) throws RemoteException, BbmCreateException {
<span class="nc" id="L546">		Collection&lt;SkillAssignment&gt; assignments = new ArrayList&lt;SkillAssignment&gt;(1);</span>
<span class="nc" id="L547">		assignments.add(objValue);</span>
<span class="nc" id="L548">		Collection&lt;ID&gt; ids = createSkillAssignments(assignments);</span>
<span class="nc" id="L549">		return ids.iterator().next();</span>
	}

	public Collection&lt;ID&gt; createSkillAssignments(Collection&lt;SkillAssignment&gt; assignments) throws BbmCreateException {
<span class="fc" id="L553">		methodStart(&quot;createSkillAssignments&quot;, assignments);</span>
<span class="fc" id="L554">		SkillAssignmentDAO dao = getSkillAssignmentDAO();</span>
		try {
<span class="fc bfc" id="L556" title="All 2 branches covered.">			for (SkillAssignment assignment : assignments) {</span>
<span class="fc" id="L557">				setSkillAssignmentProficiencyForDB(assignment);</span>
<span class="fc" id="L558">			}</span>
<span class="fc" id="L559">			return dao.createSkillAssignments(assignments);</span>
<span class="nc" id="L560">		} catch (BbmCreateException e) {</span>
<span class="nc" id="L561">			handleException(e);</span>
<span class="nc" id="L562">			throw e;</span>
		} finally {
<span class="pc" id="L564">			methodFinishWithCleanUp(dao);</span>
		}
	}

	SkillAssignmentDAO getSkillAssignmentDAO() {
<span class="fc" id="L569">		return new SkillAssignmentDAO();</span>
	}

	/**
	 * This method will delete the skill assignments in assignmentsToDelete, and
	 * will create new assignments for the assignments in assignmentsToCreate.
	 */
	public void saveSkillAssignments(Collection&lt;SkillAssignment&gt; assignmentsToDelete,
			Collection&lt;SkillAssignment&gt; assignmentsToCreate) throws BbmCreateException {

<span class="fc" id="L579">		methodStart(&quot;saveSkillAssignments&quot;, assignmentsToDelete, assignmentsToCreate);</span>
		try {
			// To delete a skill assignment, set its proficiency, priority, and
			// classification values to 0
			// and set IsActive to false, then &quot;create&quot; the assignment
<span class="pc bpc" id="L584" title="1 of 2 branches missed.">			for (SkillAssignment assignment : assignmentsToDelete) {</span>
<span class="nc" id="L585">				assignment.setIsActive(false);</span>
<span class="nc" id="L586">				assignment.setProficiency(0);</span>
<span class="nc" id="L587">				assignment.setPriority(0);</span>
<span class="nc" id="L588">				assignment.setClassification(0);</span>
<span class="nc" id="L589">			}</span>
			// Deleting assignments can be thought of as &quot;creating&quot; an
			// assignment that is not actually assigned,
			// in other words subtracting from any assignment that may intersect
			// the date range of the assignment
			// we are trying to delete.
<span class="fc" id="L595">			createSkillAssignments(assignmentsToDelete);</span>
<span class="fc" id="L596">			createSkillAssignments(assignmentsToCreate);</span>
<span class="nc" id="L597">		} catch (BbmCreateException e) {</span>
<span class="nc" id="L598">			handleException(e);</span>
<span class="nc" id="L599">			throw e;</span>
<span class="fc" id="L600">		}</span>
<span class="fc" id="L601">	}</span>

	/** save a skill assignment */
	public void updateSkillAssignment(SkillAssignment objValue, boolean bSaveAsNew) throws RemoteException,
			MultiUserException, BbmUpdateException {
<span class="nc" id="L606">		Collection&lt;SkillAssignment&gt; assignments = new ArrayList&lt;SkillAssignment&gt;();</span>
<span class="nc" id="L607">		assignments.add(objValue);</span>
<span class="nc" id="L608">		updateSkillAssignments(assignments, bSaveAsNew);</span>
<span class="nc" id="L609">	}</span>

	public void updateSkillAssignments(Collection&lt;SkillAssignment&gt; assignments, boolean bSaveAsNew)
			throws RemoteException, MultiUserException, BbmUpdateException {
<span class="nc" id="L613">		methodStart(&quot;updateSkillAssignments&quot;, assignments, bSaveAsNew);</span>
<span class="nc" id="L614">		SkillAssignmentDAO dao = getSkillAssignmentDAO();</span>
		try {
<span class="nc bnc" id="L616" title="All 2 branches missed.">			for (SkillAssignment assignment : assignments) {</span>
<span class="nc" id="L617">				setSkillAssignmentProficiencyForDB(assignment);</span>
<span class="nc" id="L618">				dao.updateSkillAssignment(assignment, bSaveAsNew);</span>
<span class="nc" id="L619">			}</span>
<span class="nc" id="L620">		} catch (MultiUserException e) {</span>
<span class="nc" id="L621">			handleException(e);</span>
<span class="nc" id="L622">			throw e;</span>
<span class="nc" id="L623">		} catch (BbmUpdateException e) {</span>
<span class="nc" id="L624">			handleException(e);</span>
<span class="nc" id="L625">			throw e;</span>
		} finally {
<span class="nc" id="L627">			methodFinishWithCleanUp(dao);</span>
<span class="nc" id="L628">		}</span>
<span class="nc" id="L629">	}</span>

	/** save a skill assignment */
	public void updateSkillAssignment(SkillAssignment objValue) throws RemoteException, MultiUserException,
			BbmUpdateException {
<span class="nc" id="L634">		methodStart(&quot;updateSkillAssignment&quot;, objValue);</span>
<span class="nc" id="L635">		SkillAssignmentDAO dao = getSkillAssignmentDAO();</span>
		try {
<span class="nc" id="L637">			StringBuffer qry = new StringBuffer();</span>
<span class="nc" id="L638">			qry.append(&quot; UPDATE WORKRESOURCESKILL SET PROFICIENCY=&quot;);</span>
<span class="nc" id="L639">			qry.append(objValue.getProficiency());</span>

<span class="nc" id="L641">			qry.append(&quot;,PRIORITY=&quot;);</span>
<span class="nc" id="L642">			qry.append(objValue.getPriority());</span>

<span class="nc" id="L644">			qry.append(&quot;,RESERVELEVEL=&quot;);</span>
<span class="nc bnc" id="L645" title="All 2 branches missed.">			qry.append(objValue.isReserve() ? 1 : 0);</span>

<span class="nc" id="L647">			qry.append(&quot;,ENDDATE=&quot;);</span>
<span class="nc bnc" id="L648" title="All 2 branches missed.">			if (objValue.getEndTime() != null) {</span>
<span class="nc" id="L649">				qry.append(&quot;'&quot;);</span>
<span class="nc" id="L650">				qry.append(JdmoUtil.formatDBString(TimeZoneUtil.toTimestamp(objValue.getEndTime())));</span>
<span class="nc" id="L651">				qry.append(&quot;'&quot;);</span>
			} else {
<span class="nc" id="L653">				qry.append(&quot;NULL&quot;);</span>
			}

<span class="nc bnc" id="L656" title="All 2 branches missed.">			if (objValue.getStartTime() != null) {</span>
<span class="nc" id="L657">				qry.append(&quot;,STARTDATE=&quot;);</span>
<span class="nc" id="L658">				qry.append(&quot;'&quot;);</span>
<span class="nc" id="L659">				qry.append(JdmoUtil.formatDBString(TimeZoneUtil.toTimestamp(objValue.getStartTime())));</span>
<span class="nc" id="L660">				qry.append(&quot;'&quot;);</span>
			}

<span class="nc" id="L663">			qry.append(&quot;WHERE ID=&quot;);</span>

<span class="nc bnc" id="L665" title="All 2 branches missed.">			if (objValue.getID() != null) {</span>
<span class="nc" id="L666">				qry.append(objValue.getID());</span>
			} else {
<span class="nc" id="L668">				qry.append(&quot;'&quot;);</span>
<span class="nc" id="L669">				qry.append(objValue.getSkillDEID());</span>
<span class="nc" id="L670">				qry.append(&quot;'&quot;);</span>
			}

<span class="nc" id="L673">			dao.getDMO().execute(qry.toString());</span>
<span class="nc" id="L674">		} catch (Exception e) {</span>
<span class="nc" id="L675">			handleException(e);</span>
<span class="nc" id="L676">			throw new BbmUpdateException(e);</span>
		} finally {
<span class="nc" id="L678">			methodFinishWithCleanUp(dao);</span>
<span class="nc" id="L679">		}</span>

<span class="nc" id="L681">	}</span>

	/** delete skill assignments given their assignment ids */
	public void deleteSkillAssignments(Collection colIDAssignments) throws BbmRemoveException {
<span class="nc" id="L685">		methodStart(&quot;deleteSkillAssignments&quot;, colIDAssignments);</span>
<span class="nc" id="L686">		SkillAssignmentDAO dao = getSkillAssignmentDAO();</span>
		try {
<span class="nc" id="L688">			dao.deleteSkillAssignments(colIDAssignments);</span>
<span class="nc" id="L689">		} catch (BbmRemoveException e) {</span>
<span class="nc" id="L690">			handleException(e);</span>
<span class="nc" id="L691">			throw e;</span>
		} finally {
<span class="nc" id="L693">			methodFinishWithCleanUp(dao);</span>
<span class="nc" id="L694">		}</span>
<span class="nc" id="L695">	}</span>

	/**
	 * delete skill assignments given their assignment ids
	 * 
	 * AJP 10/13/11: I did not update this signature because one of the plugins
	 * from the integration will fail at:
	 * \INTEGRATION\Plugins\GenericSync\src\com
	 * \bluepumpkin\Plugins\OrgSync\employee\skill\SkillAssignmentSync.java:87
	 * 
	 * @param colIDAssignments
	 *            is a Collection&lt;SkillAssignment&gt;
	 * @throws RemoteException
	 * @throws BbmRemoveException
	 */
	public void deleteSkillAssignmentByDEID(Collection colIDAssignments) throws BbmRemoveException {
<span class="nc" id="L711">		methodStart(&quot;deleteSkillAssignmentByDEID&quot;, colIDAssignments);</span>
<span class="nc" id="L712">		SkillAssignmentDAO dao = getSkillAssignmentDAO();</span>
		try {
<span class="nc" id="L714">			dao.deleteSkillAssignmentByDEID(colIDAssignments);</span>
<span class="nc" id="L715">		} catch (BbmRemoveException e) {</span>
<span class="nc" id="L716">			handleException(e);</span>
<span class="nc" id="L717">			throw e;</span>
		} finally {
<span class="nc" id="L719">			methodFinishWithCleanUp(dao);</span>
<span class="nc" id="L720">		}</span>
<span class="nc" id="L721">	}</span>

	/**
	 * get a given work resource's generic skill assignment
	 *
	 * @idWorkResource work resource id
	 * @dtStart, @dtEnd: the time period, null date means a open period
	 *
	 * @return a collection of GenericSkillAssignment objects which hold the
	 *         assignment information
	 */
	public Collection getGenericSkillAssignments(ID idWorkResource, Date dtStart, Date dtEnd) throws BbmFinderException {
<span class="nc" id="L733">		methodStart(&quot;getGenericSkillAssignments&quot;, idWorkResource, dtStart, dtEnd);</span>
<span class="nc" id="L734">		GenericSkillAssignmentDAO dao = new GenericSkillAssignmentDAO();</span>
		try {
<span class="nc" id="L736">			return dao.getSkillAssignments(idWorkResource, dtStart, dtEnd);</span>
<span class="nc" id="L737">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L738">			handleException(e);</span>
<span class="nc" id="L739">			throw e;</span>
		} finally {
<span class="nc" id="L741">			methodFinishWithCleanUp(dao);</span>
		}
	}

	/**
	 * get generic skill assignments for a list of work resources
	 *
	 * @colWorkResourceIDs a collection of work resource ids
	 * @dtStart, @dtEnd: the time period, null date means a open period
	 *
	 * @return a HashMap of following pairs (idWorkResource, array list of
	 *         generic skill assignments)
	 */
	public HashMap getGenericSkillAssignments(Collection colWorkResourceIDs, Date dtStart, Date dtEnd)
			throws BbmFinderException {
<span class="nc" id="L756">		methodStart(&quot;getGenericSkillAssignments&quot;, colWorkResourceIDs, dtStart, dtEnd);</span>
<span class="nc" id="L757">		GenericSkillAssignmentDAO dao = new GenericSkillAssignmentDAO();</span>
		try {
<span class="nc" id="L759">			return dao.getSkillAssignments(colWorkResourceIDs, dtStart, dtEnd);</span>
<span class="nc" id="L760">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L761">			handleException(e);</span>
<span class="nc" id="L762">			throw e;</span>
		} finally {
<span class="nc" id="L764">			methodFinishWithCleanUp(dao);</span>
		}
	}

	/**
	 * get a list of generic skill assignment given their IDs
	 */
	public Collection getGenericSkillAssignmentsByIDs(Collection colIDSAs) throws BbmFinderException {
<span class="nc" id="L772">		methodStart(&quot;getGenericSkillAssignmentsByIDs&quot;, colIDSAs);</span>
<span class="nc" id="L773">		GenericSkillAssignmentDAO dao = new GenericSkillAssignmentDAO();</span>
		try {
<span class="nc" id="L775">			return dao.getSkillAssignmentsByIDs(colIDSAs);</span>
<span class="nc" id="L776">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L777">			handleException(e);</span>
<span class="nc" id="L778">			throw e;</span>
		} finally {
<span class="nc" id="L780">			methodFinishWithCleanUp(dao);</span>
		}
	}

	/** create a generic skill assignment */
	public ID createGenericSkillAssignment(GenericSkillAssignment objValue) throws BbmCreateException {
<span class="nc" id="L786">		methodStart(&quot;createGenericSkillAssignment&quot;, objValue);</span>
<span class="nc" id="L787">		GenericSkillAssignmentDAO dao = new GenericSkillAssignmentDAO();</span>
		try {
<span class="nc" id="L789">			return dao.createSkillAssignment(objValue);</span>
<span class="nc" id="L790">		} catch (BbmCreateException e) {</span>
<span class="nc" id="L791">			handleException(e);</span>
<span class="nc" id="L792">			throw e;</span>
		} finally {
<span class="nc" id="L794">			methodFinishWithCleanUp(dao);</span>
		}
	}

	/** save a generic skill assignment */
	public void updateGenericSkillAssignment(GenericSkillAssignment objValue, boolean bSaveAsNew)
			throws MultiUserException, BbmUpdateException {
<span class="nc" id="L801">		methodStart(&quot;updateGenericSkillAssignment&quot;, objValue);</span>
<span class="nc" id="L802">		GenericSkillAssignmentDAO dao = new GenericSkillAssignmentDAO();</span>
		try {
<span class="nc" id="L804">			dao.updateSkillAssignment(objValue, bSaveAsNew);</span>
<span class="nc" id="L805">		} catch (MultiUserException e) {</span>
<span class="nc" id="L806">			handleException(e);</span>
<span class="nc" id="L807">			throw e;</span>
<span class="nc" id="L808">		} catch (BbmUpdateException e) {</span>
<span class="nc" id="L809">			handleException(e);</span>
<span class="nc" id="L810">			throw e;</span>
		} finally {
<span class="nc" id="L812">			methodFinishWithCleanUp(dao);</span>
<span class="nc" id="L813">		}</span>
<span class="nc" id="L814">	}</span>

	/** delete generic skill assignments given their assignment ids */
	public void deleteGenericSkillAssignments(Collection colIDAssignments) throws BbmRemoveException {
<span class="nc" id="L818">		methodStart(&quot;deleteGenericSkillAssignments&quot;, colIDAssignments);</span>
<span class="nc" id="L819">		GenericSkillAssignmentDAO dao = new GenericSkillAssignmentDAO();</span>
		try {
<span class="nc" id="L821">			dao.deleteSkillAssignments(colIDAssignments);</span>
<span class="nc" id="L822">		} catch (BbmRemoveException e) {</span>
<span class="nc" id="L823">			handleException(e);</span>
<span class="nc" id="L824">			throw e;</span>
		} finally {
<span class="nc" id="L826">			methodFinishWithCleanUp(dao);</span>
<span class="nc" id="L827">		}</span>
<span class="nc" id="L828">	}</span>

	/**
	 * see if a skill is assigned to a queue or an employee
	 */
	public boolean isSkillAssigned(ID idSkill) throws BbmFinderException {
<span class="nc" id="L834">		methodStart(&quot;isSkillAssigned&quot;, idSkill);</span>
<span class="nc" id="L835">		SkillDAO dao = getSkillDAO();</span>
		try {
<span class="nc" id="L837">			return dao.isSkillAssigned(idSkill);</span>
<span class="nc" id="L838">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L839">			handleException(e);</span>
<span class="nc" id="L840">			throw e;</span>
		} finally {
<span class="nc" id="L842">			methodFinishWithCleanUp(dao);</span>
		}
	}

	/**
	 * Save competency objects. creates new objects if they dont exist, updates
	 * ones that exist, and marks ones that don't as deleted
	 *
	 * @compColl Collection of competency objects
	 * @return a Collection of competency objects with updated status info
	 */
	public Collection saveCompetencies(Collection compColl) throws RemoteException, BbmCreateException,
			BbmUpdateException, BbmFinderException {
<span class="nc" id="L855">		methodStart(&quot;saveCompetencies&quot;, compColl);</span>
<span class="nc" id="L856">		CompetencyDAO dao = new CompetencyDAO();</span>
		try {
<span class="nc" id="L858">			return dao.saveCompetencies(compColl);</span>
<span class="nc" id="L859">		} catch (BbmCreateException e) {</span>
<span class="nc" id="L860">			handleException(e);</span>
<span class="nc" id="L861">			throw e;</span>
<span class="nc" id="L862">		} catch (BbmUpdateException e) {</span>
<span class="nc" id="L863">			handleException(e);</span>
<span class="nc" id="L864">			throw e;</span>
		} finally {
<span class="nc" id="L866">			methodFinishWithCleanUp(dao);</span>
		}
	}

	/**
	 * Returns competency objects, null or empty if not found
	 *
	 * @return a Collection of all competency objects
	 * @throws BbmFinderException
	 *             if data base failure occurs
	 */
	public Collection getCompetencies() throws RemoteException, BbmFinderException {
<span class="nc" id="L878">		methodStart(&quot;getCompetencies&quot;);</span>
<span class="nc" id="L879">		CompetencyDAO dao = new CompetencyDAO();</span>
		try {
<span class="nc" id="L881">			return dao.getObjects(&quot;&quot;);</span>
		} finally {
<span class="nc" id="L883">			methodFinishWithCleanUp(dao);</span>
		}
	}

	public Map&lt;ID, Collection&lt;SkillAssignment&gt;&gt; getSkillAssignmentInPeriodAndOnSpotOnly(
			Collection&lt;ID&gt; colWorkResourceIDs, Date dtStart, Date dtEnd, Date timeSpot) throws BbmFinderException {
<span class="nc" id="L889">		methodStart(&quot;getSkillAssignmentInPeriodAndOnSpotOnly&quot;, colWorkResourceIDs, dtStart, dtEnd, timeSpot);</span>
<span class="nc" id="L890">		SkillAssignmentDAO dao = getSkillAssignmentDAO();</span>
		try {
<span class="nc" id="L892">			return dao.getSkillAssignmentInPeriodAndOnSpotOnly(colWorkResourceIDs, dtStart, dtEnd, timeSpot);</span>
<span class="nc" id="L893">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L894">			handleException(e);</span>
<span class="nc" id="L895">			throw e;</span>
		} finally {
<span class="nc" id="L897">			methodFinishWithCleanUp(dao);</span>
		}
	}

	/**
	 * get skill object given its name and mediaID
	 */
	public Skill getSkillByNameAndMedia(String name, ID mediaID) throws BbmObjectNotFoundException, BbmFinderException {
<span class="nc" id="L905">		methodStart(&quot;getSkillByNameAndMedia&quot;, name, mediaID);</span>
<span class="nc" id="L906">		SkillDAO dao = getSkillDAO();</span>
		try {
<span class="nc" id="L908">			return dao.getSkillByNameAndMedia(name, mediaID);</span>

<span class="nc" id="L910">		} catch (BbmObjectNotFoundException e) {</span>
<span class="nc" id="L911">			handleException(e, false);</span>
<span class="nc" id="L912">			throw e;</span>
<span class="nc" id="L913">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L914">			handleException(e);</span>
<span class="nc" id="L915">			throw e;</span>
		} finally {
<span class="nc" id="L917">			methodFinishWithCleanUp(dao);</span>
		}
	}

	/**
	 * Proficiency in the DB is stored as an int, while it is stored as a double
	 * in the value object. This method converts it to an int representation by
	 * multiplying by 10 before it is to be stored in the DB.
	 */
	private static void setSkillAssignmentProficiencyForDB(SkillAssignment assignment) {
<span class="fc" id="L927">		DecimalFormat oneDForm = new DecimalFormat(&quot;#.#&quot;);</span>
<span class="fc" id="L928">		double newProficiency = Double.valueOf(oneDForm.format(assignment.getProficiency() * 10));</span>
<span class="fc" id="L929">		assignment.setProficiency(newProficiency);</span>
<span class="fc" id="L930">	}</span>

	/**
	 * Returns a list of skills that are able to be assigned to the given
	 * employees during the given date range. The skills returned have their ID
	 * set as an SID (integer).
	 */
	public Collection&lt;Skill&gt; getAvailableSkillsForEmployees(Collection&lt;ID&gt; employeeIDs, Date viewStartDate,
			Date viewEndDate) throws BbmFinderException {

<span class="fc" id="L940">		methodStart(&quot;getAvailableSkillsForEmployees&quot;, employeeIDs, viewStartDate, viewEndDate);</span>
<span class="fc" id="L941">		SkillDAO dao = getSkillDAO();</span>
		try {
<span class="fc" id="L943">			Collection&lt;ID&gt; organizationIDs = workResourceManager.getOrgIDsThatMayOwnFlowDownObjects(employeeIDs,</span>
					viewStartDate, viewEndDate);
<span class="fc" id="L945">			return dao.getAvailableSkillsForEmployees(organizationIDs, employeeIDs, viewStartDate, viewEndDate);</span>
<span class="nc" id="L946">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L947">			handleException(e);</span>
<span class="nc" id="L948">			throw e;</span>
<span class="nc" id="L949">		} catch (RemoteException e) {</span>
<span class="nc" id="L950">			handleException(e);</span>
<span class="nc" id="L951">			throw new BbmFinderException(e);</span>
		} finally {
<span class="pc" id="L953">			methodFinishWithCleanUp(dao);</span>
		}
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>