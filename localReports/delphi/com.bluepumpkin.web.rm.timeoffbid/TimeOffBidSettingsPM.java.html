<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>TimeOffBidSettingsPM.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.rm.timeoffbid</a> &gt; <span class="el_source">TimeOffBidSettingsPM.java</span></div><h1>TimeOffBidSettingsPM.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.rm.timeoffbid;

import java.util.ArrayList;
import java.util.Calendar;
import java.util.Collection;
import java.util.Collections;
import java.util.Date;
import java.util.Iterator;
import java.util.ResourceBundle;
import java.util.TimeZone;

import javax.servlet.http.HttpServletRequest;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.LocalDate;
import com.bluepumpkin.common.datatypes.StringsPair;
import com.bluepumpkin.common.util.DateTimeUtil;
import com.bluepumpkin.common.util.StringUtil;
import com.bluepumpkin.ejb.bbm.activity.model.Activity;
import com.bluepumpkin.ejb.bbm.activity.model.ActivityFilter;
import com.bluepumpkin.ejb.bbm.workresource.model.Organization;
import com.bluepumpkin.ejb.rm.setup.timeoffbid.model.TimeOffBid;
import com.bluepumpkin.ejb.rm.setup.timeoffbid.model.TimeOffBidActivity;
import com.bluepumpkin.ejb.rm.setup.timeoffbid.model.TimeOffBidFieldInfo;
import com.bluepumpkin.web.bbm.l10n.BbmWebBundleKey;
import com.bluepumpkin.web.bbm.organization.OrganizationModelHandler;
import com.bluepumpkin.web.rm.keys.RmJavaScriptFileID;
import com.bluepumpkin.web.rm.keys.RmPageAction;
import com.bluepumpkin.web.rm.l10n.RmWebBundleKey;
import com.witness.ejb.core.security.PrivilegeKeys;
import com.witness.ejb.core.security.model.User;
import com.witness.web.uif.base.Message;
import com.witness.web.uif.l10n.UIFWebBundleKey;
import com.witness.web.uif.pagecomponent.container.Collapsible2ColFormPC;
import com.witness.web.uif.pagecomponent.container.ListContainerPC;
import com.witness.web.uif.pagecomponent.form.FormInputPC;
import com.witness.web.uif.pagecomponent.form.FormTwoColumnPC;
import com.witness.web.uif.pagecomponent.picker.date.DateRangePickerPC;
import com.witness.web.uif.pagecomponent.toolbar.ToolbarPC;
import com.witness.web.uif.pagemodel.PageModel;
import com.witness.web.uif.pagemodel.SettingPM;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.util.HtmlUtil;
import com.witness.web.uif.util.html.HtmlChoiceInput;
import com.witness.web.uif.util.js.JSUtil;
import com.witness.web.uif.validator.IsNonNegativeIntegerFieldValidator;

/**
 * File:         TimeOffBidSettingsPM
 * Description:  Page model for the time off bid create/edit
 *               it is used either in the work pane or in the ext. list selection pane
 * Copyright:    Copyright (c) 2016
 * Company:      Verint System, inc
 * @author       Truc Pham
 */
public class TimeOffBidSettingsPM extends SettingPM {
	/**
	 *
	 */
	private static final long serialVersionUID = 1L;
	private static final String FWRAPPER = &quot;fWrapper&quot;;
	private static final String WIDTH = &quot;99%&quot;;
	private static final String TIMEOFFBID_ID_FN = &quot;bidId&quot;;
	private static final String TIMEOFFBID_NAME_FN = &quot;bidName&quot;;
	private static final String TIMEOFFBID_STATUS_FN = &quot;bidStatus&quot;;
	private static final String TIMEOFFBID_ORGANIZATION_FN = &quot;bidOrganization&quot;;
	private static final String TIMEOFFBID_DATERANGE_FN = &quot;bidDateRange&quot;;
	private static final String TIMEOFFBID_REQUESTDATERANGE_FN = &quot;bidRequestDateRange&quot;;
	protected static final String TIMEOFFBID_ACTIVITIES_FN = &quot;bidActivities&quot;;
	private static final String TIMEOFFBID_MIN_VALUE_FN = &quot;minValue&quot;;
	private static final String TIMEOFFBID_MIN_UNIT_FN = &quot;minUnit&quot;;
	private static final String TIMEOFFBID_MAX_VALUE_FN = &quot;maxValue&quot;;
	private static final String TIMEOFFBID_MAX_UNIT_FN = &quot;maxUnit&quot;;
	private static final String TIMEOFFBID_MAX_VALUE_FORAPROVAL_FN = &quot;maxValueForApproval&quot;;
	private static final String TIMEOFFBID_MAX_UNIT_FORAPROVAL_FN = &quot;maxUnitForApproval&quot;;
	protected static final String TIMEOFFBID_VARY_BY_EMPLOYEE_FN = &quot;isVariedByEmployee&quot;;
	private static final String TIMEOFFBID_CLOSE_BID = &quot;TIMEOFFBID_CLOSE_BID&quot;;

<span class="nc" id="L79">	private static String FORM_ACTION = &quot;rm_tb_settings&quot;; // NOSONAR</span>

	private FormTwoColumnPC formTwoColumnPC;
	private Collapsible2ColFormPC generalSettingContainerPC;
	private ListContainerPC validateSettingContainerPC;
	private FormInputPC formInputPC;
	private HtmlChoiceInput htmlChoiceInputPC;
<span class="nc" id="L86">	private ResourceBundle rmBundle = null;</span>
<span class="nc" id="L87">	private ResourceBundle bbmBundle = null;</span>
	private TimeOffBid timeOffBid;
	private int minPeriodValue;
	private int maxPeriodValue;
	private int maxPeriodForApprovalValue;
	private Collection&lt;TimeOffBidActivity&gt; timeOffBidActivities;
	private Collection&lt;Organization&gt; orgs;
	private ID selectedOrgId;
	private User viewingUser;
	private TimeZone viewingTimezone;
	private ActivityDropdownSelectionPC activitySelectorPC;
	private DateRangePickerPC timeOffBidDateRangePC;
	private DateRangePickerPC timeOffBidRequestDateRangePC;
<span class="nc" id="L100">	private boolean hasPendingRequest = false;</span>
<span class="nc" id="L101">	private boolean isPageEnabled = true;</span>

	/**
	 * Constructor
	 */
	public TimeOffBidSettingsPM(RequestContext context) {
<span class="nc" id="L107">		super(context);</span>
<span class="nc" id="L108">		rmBundle = m_localizer.getBundle(RmWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L109">		bbmBundle = m_localizer.getBundle(BbmWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L110">		viewingUser = context.getUser();</span>
<span class="nc" id="L111">		viewingTimezone = context.getViewingTimeZone();</span>

<span class="nc" id="L113">		formTwoColumnPC = new FormTwoColumnPC(context);</span>
<span class="nc" id="L114">		addChildComponent(formTwoColumnPC);</span>
<span class="nc" id="L115">		generalSettingContainerPC = new Collapsible2ColFormPC(m_context);</span>
<span class="nc" id="L116">		addChildComponent(generalSettingContainerPC);</span>

<span class="nc" id="L118">		validateSettingContainerPC = new ListContainerPC(m_context);</span>
<span class="nc" id="L119">		addChildComponent(validateSettingContainerPC);</span>

<span class="nc" id="L121">		formInputPC = new FormInputPC(context);</span>
<span class="nc" id="L122">		addChildComponent(formInputPC);</span>

<span class="nc" id="L124">		htmlChoiceInputPC = new HtmlChoiceInput();</span>

<span class="nc" id="L126">		timeOffBidDateRangePC = new DateRangePickerPC(context, TIMEOFFBID_DATERANGE_FN, viewingTimezone);</span>
<span class="nc" id="L127">		timeOffBidDateRangePC.getEndDatePickerPC().setIsTimeEnabled(true);</span>
<span class="nc" id="L128">		timeOffBidDateRangePC.getStartDatePickerPC().setIsTimeEnabled(true);</span>
<span class="nc" id="L129">		addChildComponent(timeOffBidDateRangePC);</span>

<span class="nc" id="L131">		timeOffBidRequestDateRangePC = new DateRangePickerPC(context, TIMEOFFBID_REQUESTDATERANGE_FN, viewingTimezone);</span>
<span class="nc" id="L132">		timeOffBidRequestDateRangePC.getEndDatePickerPC().setIsTimeEnabled(true);</span>
<span class="nc" id="L133">		timeOffBidRequestDateRangePC.getStartDatePickerPC().setIsTimeEnabled(true);</span>
<span class="nc" id="L134">		addChildComponent(timeOffBidRequestDateRangePC);</span>

<span class="nc" id="L136">		activitySelectorPC = new ActivityDropdownSelectionPC(m_context, TIMEOFFBID_ACTIVITIES_FN);</span>
<span class="nc" id="L137">		activitySelectorPC.setMultiSelect(true);</span>
<span class="nc" id="L138">		activitySelectorPC.setEnabled(isAuthorizedToConfigure());</span>
<span class="nc" id="L139">		addChildComponent(activitySelectorPC);</span>

<span class="nc" id="L141">		initTimeOffBid();</span>
		// Add JavaScript Variables
<span class="nc" id="L143">		addJSVariable(DELETE_CONFIRMATION, rmBundle, RmWebBundleKey.RM_TIMEOFF_BID_DELETE_CONFIRM);</span>
<span class="nc" id="L144">		addJSVariable(TIMEOFFBID_CLOSE_BID, rmBundle, RmWebBundleKey.RM_TIMEOFF_BID_CLOSE_CONFIRM);</span>
<span class="nc" id="L145">		addRequiredJavaScriptFile(RmJavaScriptFileID.TIME_OFF_BID_SETTING_JS);</span>

<span class="nc" id="L147">	}</span>

	/**
	 * Return an instance of the model that is ready for rendering
	 */
	public static PageModel getInstance(RequestContext context) throws Exception { // NOSONAR
<span class="nc" id="L153">		return getInstance(context, TimeOffBidSettingsPM.class);</span>
	}

	@Override
	public String getFormAction() {
<span class="nc" id="L158">		return FORM_ACTION;</span>
	}

	/**
	 * Make sure that the model is populated
	 */
	@Override
	protected void loadData() throws Exception {
		try {
<span class="nc bnc" id="L167" title="All 2 branches missed.">			if (m_context.getUser().getEmployeeID() == null) {</span>
<span class="nc" id="L168">				addPageMessage(Message.INFO_TYPE, UIFWebBundleKey.SCREEN_DISABLED_FOR_NON_EMP, UIFWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L169">				isPageEnabled = false;</span>
<span class="nc" id="L170">				return;</span>
			}
<span class="nc" id="L172">			orgs = OrganizationModelHandler.getAllOrgsInUserScope(m_context, m_context.getUser());</span>
<span class="nc bnc" id="L173" title="All 2 branches missed.">			if (hasSelectedID()) {</span>
<span class="nc" id="L174">				ID timeOffBidId = getSelectedIDObject();</span>
<span class="nc" id="L175">				timeOffBid = TimeOffBidModelHandler.getTimeOffBidByID(timeOffBidId);</span>
<span class="nc" id="L176">				timeOffBidActivities = timeOffBid.getTimeOffBidActivities();</span>
<span class="nc" id="L177">				hasPendingRequest = TimeOffBidModelHandler.checkHaveTimeOffBidRequestPending(timeOffBidId);</span>
<span class="nc" id="L178">			} else {</span>
<span class="nc" id="L179">				setIsAddMode(true);</span>
<span class="nc" id="L180">				setSelectedID(null);</span>
<span class="nc" id="L181">				timeOffBidActivities = new ArrayList&lt;TimeOffBidActivity&gt;();</span>
			}
<span class="nc" id="L183">		} catch (Exception ex) {</span>
<span class="nc" id="L184">			Message msg = handleUnableToLoadDataErrorAndLogAsDebug(log, ex);</span>
<span class="nc" id="L185">			msg.setAssociatedMessage(ex.getLocalizedMessage());</span>
<span class="nc" id="L186">		}</span>
<span class="nc" id="L187">	}</span>

	private void initTimeOffBid() {
<span class="nc" id="L190">		timeOffBid = new TimeOffBid();</span>
<span class="nc" id="L191">		Calendar aCal = Calendar.getInstance(viewingTimezone, m_locale);</span>
		//Make sure fields have default values since they are not null and does not have default value 
<span class="nc" id="L193">		timeOffBid.setBidStartTime(aCal.getTime());</span>
<span class="nc" id="L194">		timeOffBid.setBidEndTime(aCal.getTime());</span>
<span class="nc" id="L195">		timeOffBid.setRequestStartTime(aCal.getTime());</span>
<span class="nc" id="L196">		timeOffBid.setRequestEndTime(aCal.getTime());</span>
<span class="nc" id="L197">		timeOffBid.setStatus(TimeOffBid.STATUS_OPEN_FOR_BIDDING);</span>
<span class="nc" id="L198">		timeOffBid.setCreatedBy(m_context.getUser().getUserName());</span>
<span class="nc" id="L199">	}</span>

	/**
	 * Initialize Content Title
	 */
	@Override
	protected void initContentTitle() {
<span class="nc" id="L206">		String pageTitle = i18n(RmWebBundleKey.RM_SA_SETTINGS);</span>
<span class="nc" id="L207">		m_contentTitlePC.setPageTitle(pageTitle);</span>

<span class="nc bnc" id="L209" title="All 2 branches missed.">		String itemName = hasSelectedID() ? timeOffBid.getName() : i18n(RmWebBundleKey.RM_TIMEOFF_BIDDING_NEW_BID);</span>
<span class="nc" id="L210">		m_contentTitlePC.setItemName(itemName);</span>
<span class="nc" id="L211">	}</span>

	/**
	 * Initialize Form Display
	 */
	@Override
	protected void initForm() {
<span class="nc bnc" id="L218" title="All 2 branches missed.">		if (!isPageEnabled) {</span>
<span class="nc" id="L219">			return;</span>
		}
<span class="nc" id="L221">		boolean isAddMode = isAddMode();</span>
<span class="nc" id="L222">		setGeneralSettingsForm(isAddMode);</span>
<span class="nc" id="L223">		setValidateSettingsForm();</span>
<span class="nc" id="L224">		addForm(generalSettingContainerPC);</span>
<span class="nc" id="L225">		addForm(validateSettingContainerPC);</span>

<span class="nc" id="L227">	}</span>

	public TimeOffBid getTimeOffBid() {
<span class="nc bnc" id="L230" title="All 2 branches missed.">		if (hasSelectedID()) {</span>
<span class="nc" id="L231">			timeOffBid.setID(getSelectedIDObject());</span>
		}
<span class="nc" id="L233">		return timeOffBid;</span>
	}

	/**
	 * Return the form title
	 */
	public String getFormTitle() {
<span class="nc" id="L240">		return &quot;&quot;;</span>
	}

	/**
	 * Return true if Cancel Button is Shown
	 */
	@Override
	protected boolean isCancelBtnShown() {
<span class="nc bnc" id="L248" title="All 2 branches missed.">		return !m_isWorkpaneMode;</span>
	}

	/**
	 * Return true if current user is authorized to configure entities in a page
	 *
	 * NOTE: To be overwritten by subclasses.
	 *
	 * Default return true
	 */
	@Override
	protected boolean isAuthorizedToConfigure() {
<span class="nc bnc" id="L260" title="All 4 branches missed.">		return isPageEnabled &amp;&amp; viewingUser.isAuthorized(PrivilegeKeys.FS_EDITTIMEOFFBIDDING_ID);</span>
	}

	/**
	 * Initialize Toolbar
	 */
	@Override
	public void initToolbar() {
<span class="nc bnc" id="L268" title="All 2 branches missed.">		if (isPageEnabled) {</span>
<span class="nc bnc" id="L269" title="All 2 branches missed.">			if (timeOffBid.getID() != null) {</span>
<span class="nc" id="L270">				boolean isEditable = isAuthorizedToConfigure();</span>
<span class="nc" id="L271">				boolean isBidOpen = timeOffBid.isStatusOpen();</span>
<span class="nc" id="L272">				addOpenOrCloseBidBtn(m_toolbar, isEditable, isBidOpen);</span>
			}
<span class="nc" id="L274">			String createDisplay = i18n(m_common_bundle, UIFWebBundleKey.TOOLBAR_CREATE);</span>
<span class="nc" id="L275">			useDefaultSettingToolbar(createDisplay);</span>
		}
<span class="nc" id="L277">	}</span>

	/**
	 * Add button is toggle Opening / Closing Bid
	 */
	private void addOpenOrCloseBidBtn(ToolbarPC toolbar, boolean isEditable, boolean isBidOpen) {
<span class="nc bnc" id="L283" title="All 2 branches missed.">		if (isBidOpen) {</span>
<span class="nc" id="L284">			String lbl = i18n(RmWebBundleKey.RM_TIMEOFF_BID_CLOSE_BTN);</span>
<span class="nc bnc" id="L285" title="All 2 branches missed.">			if (hasPendingRequest) {</span>
<span class="nc" id="L286">				toolbar.addConfirmSubmitTextButton(RmPageAction.CLOSE_TIMEOFF_BID, lbl, isEditable, TIMEOFFBID_CLOSE_BID);</span>
			} else {
<span class="nc" id="L288">				toolbar.addSubmitTextButton(RmPageAction.CLOSE_TIMEOFF_BID, lbl, isEditable);</span>
			}
<span class="nc" id="L290">		} else {</span>
<span class="nc" id="L291">			String lbl = i18n(RmWebBundleKey.RM_TIMEOFF_BID_OPEN_BTN);</span>
<span class="nc" id="L292">			toolbar.addSubmitTextButton(RmPageAction.OPEN_TIMEOFF_BID, lbl, isEditable);</span>
		}
<span class="nc" id="L294">		toolbar.addDivider();</span>
<span class="nc" id="L295">	}</span>

	/**
	 * Override extract Parameters to handle date input
	 */
	@Override
	public boolean extractParameters(HttpServletRequest request) {
<span class="nc" id="L302">		boolean success = super.extractParameters(request);</span>

<span class="nc" id="L304">		setTimeOffBidDateRange();</span>
<span class="nc" id="L305">		setTimeOffBidRequestDateRange();</span>
<span class="nc" id="L306">		setTimeOffBidActivityIds(activitySelectorPC.getSelectedIDs());			</span>
<span class="nc" id="L307">		String isVariesByEmp = m_context.getParameter(TimeOffBidSettingsPM.TIMEOFFBID_VARY_BY_EMPLOYEE_FN);</span>
		//The value of checkbox  is extracted as below: if the checkbox is unchecked, the parameter value is null
		//if the checkbox is checked, the parameter value is equals to the assigned value 
<span class="nc bnc" id="L310" title="All 2 branches missed.">		timeOffBid.setIsApprovalMaxValueVariesByEmp(!StringUtil.isEmpty(isVariesByEmp));</span>
<span class="nc bnc" id="L311" title="All 2 branches missed.">		if (!StringUtil.isEmpty(isVariesByEmp)) {</span>
<span class="nc" id="L312">			resetApprovalFields();</span>
		}

<span class="nc" id="L315">		return success;</span>
	}

	/**
	 * Validates the Page Component
	 *
	 * NOTE: This method recurse through all sub-components
	 */
	@Override
	public boolean validate() { // NOSONAR
<span class="nc" id="L325">		return super.validate();</span>
	}

	@Override
	protected boolean isDeleteActionEnabled() {
<span class="nc bnc" id="L330" title="All 6 branches missed.">		return isPageEnabled &amp;&amp; viewingUser.isAuthorized(PrivilegeKeys.FS_EDITTIMEOFFBIDDING_ID) &amp;&amp; timeOffBid.isStatusClosed();</span>
	}

	//////////////////////////////////////////////////////////////////////////////
	// Helper Methods
	//////////////////////////////////////////////////////////////////////////////
	private void setGeneralSettingsForm(boolean isAddMode) {
<span class="nc" id="L337">		generalSettingContainerPC.setWidth(WIDTH);</span>
<span class="nc" id="L338">		generalSettingContainerPC.setTitle(i18n(RmWebBundleKey.RM_TIMEOFF_BID_GENERAL_SETTINGS));</span>
<span class="nc" id="L339">		generalSettingContainerPC.addRow(i18n(bbmBundle, BbmWebBundleKey.NAME), getNameRow());</span>
<span class="nc" id="L340">		generalSettingContainerPC.addRow(i18n(m_common_bundle, UIFWebBundleKey.STATUS), getStatusRow());</span>
<span class="nc" id="L341">		generalSettingContainerPC.addRow(i18n(bbmBundle, BbmWebBundleKey.Organization), createOrganizationDropdownList(isAddMode));</span>
<span class="nc" id="L342">		generalSettingContainerPC.addRow(i18n(RmWebBundleKey.RM_TIMEOFF_BID_PERIOD), getDateRangeUI());</span>
<span class="nc" id="L343">		generalSettingContainerPC.addRow(i18n(RmWebBundleKey.RM_TIMEOFF_BID_REQUEST_PERIOD), getRequestDateRangeUI());</span>
<span class="nc" id="L344">		generalSettingContainerPC.addRow(i18n(RmWebBundleKey.RM_TIMEOFF_BID_ACTIVITIES_ALLOWED), getActivityRow());</span>
<span class="nc" id="L345">	}</span>

	private void setValidateSettingsForm() {
<span class="nc" id="L348">		validateSettingContainerPC.setWidth(WIDTH);</span>
<span class="nc" id="L349">		validateSettingContainerPC.setWrapperCSSClass(FWRAPPER);</span>
<span class="nc" id="L350">		validateSettingContainerPC.setLastRowType(ListContainerPC.LAST_ROW_NONE);</span>
<span class="nc" id="L351">		validateSettingContainerPC.setTitle(i18n(RmWebBundleKey.RM_TIMEOFF_BID_VALIDATION_SETTINGS));</span>
<span class="nc" id="L352">		validateSettingContainerPC.addRowData(getMiminumPerChoiceRow());</span>
<span class="nc" id="L353">		validateSettingContainerPC.addRowData(getMaximumPerChoiceRow());</span>
<span class="nc" id="L354">		validateSettingContainerPC.addRowData(getMaximumForApprovalRow());</span>
<span class="nc" id="L355">	}</span>

	private String getNameRow() {
<span class="nc" id="L358">		String rbKey = RmWebBundleKey.BID_NAME;</span>
<span class="nc" id="L359">		formInputPC.reset(TIMEOFFBID_NAME_FN, timeOffBid.getName(), FormInputPC.TYPE_STRING, true);</span>
<span class="nc bnc" id="L360" title="All 2 branches missed.">		formInputPC.setIsReadOnly(!isAuthorizedToConfigure());</span>
<span class="nc" id="L361">		formInputPC.setInputFieldDesc(rbKey, RmWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L362">		formInputPC.setMaxLength(50);</span>
<span class="nc" id="L363">		formInputPC.initForDisplay();</span>
<span class="nc bnc" id="L364" title="All 4 branches missed.">		m_context.addGenericHTML(HtmlUtil.makeHiddenInput(TIMEOFFBID_ID_FN, timeOffBid == null || timeOffBid.getId() == null ? &quot;&quot;</span>
<span class="nc" id="L365">				: timeOffBid.getId()));</span>
<span class="nc" id="L366">		return formInputPC.getHtmlDisplay();</span>
	}

	private String getStatusRow() {
<span class="nc" id="L370">		String status = i18n(m_common_bundle, UIFWebBundleKey.STATUS_OPEN);</span>
<span class="nc bnc" id="L371" title="All 4 branches missed.">		if (timeOffBid.isStatusClosed() &amp;&amp; !isAddMode()) {</span>
<span class="nc" id="L372">			status = i18n(m_common_bundle, UIFWebBundleKey.STATUS_CLOSED);</span>
		}
<span class="nc" id="L374">		status += HtmlUtil.makeHiddenInput(TIMEOFFBID_STATUS_FN, timeOffBid.getStatus());</span>
<span class="nc" id="L375">		return status; </span>
	}

	private String createOrganizationDropdownList(boolean isAddMode) {
<span class="nc" id="L379">		Collection&lt;StringsPair&gt; options = new ArrayList&lt;StringsPair&gt;();</span>
<span class="nc" id="L380">		selectedOrgId = getSelectedOrgIdForDropdown(options, orgs, isAddMode);</span>
<span class="nc" id="L381">		String onChangeJS = JSUtil.ON_CHANGE + &quot;;updateActiviyDropdown(this);&quot;;</span>
<span class="nc bnc" id="L382" title="All 2 branches missed.">		String selectedValue = selectedOrgId == null ? &quot;&quot; : selectedOrgId.toString();</span>
<span class="nc" id="L383">		return HtmlUtil.makeSelectInput(TIMEOFFBID_ORGANIZATION_FN,&quot;&quot;, new String[]{selectedValue}, onChangeJS,</span>
<span class="nc" id="L384">				options,null,false,false,isAuthorizedToConfigure());</span>

	}

	private String getActivityRow() {
<span class="nc" id="L389">		ActivityFilter activityFilter = new ActivityFilter();</span>
<span class="nc" id="L390">		activityFilter.setDeleted(false);</span>
<span class="nc" id="L391">		Collection&lt;Activity&gt; activities = Collections.emptyList();</span>
		try {
<span class="nc" id="L393">			activities = TimeOffBidModelHandler.getTimeOffTypes(selectedOrgId); </span>
<span class="nc" id="L394">		} catch (Exception ex) {</span>
<span class="nc" id="L395">			handleUnableToLoadDataError(log, ex);</span>
<span class="nc" id="L396">		}</span>
<span class="nc" id="L397">		Collection&lt;String&gt; timeOffActivityIds = getSelectedActivityIds(timeOffBidActivities);</span>
<span class="nc bnc" id="L398" title="All 2 branches missed.">		if (!timeOffActivityIds.isEmpty()) {</span>
<span class="nc" id="L399">			activitySelectorPC = new ActivityDropdownSelectionPC(m_context, TIMEOFFBID_ACTIVITIES_FN, activities, true);</span>
<span class="nc" id="L400">			activitySelectorPC.setSelectedIDs(timeOffActivityIds);</span>
<span class="nc" id="L401">			activitySelectorPC.setEnabled(isAuthorizedToConfigure());</span>
<span class="nc" id="L402">			activitySelectorPC.setMultiSelect(true);</span>
		} else {
<span class="nc" id="L404">			activitySelectorPC = new ActivityDropdownSelectionPC(m_context, TIMEOFFBID_ACTIVITIES_FN, activities);</span>
<span class="nc" id="L405">			activitySelectorPC.setEnabled(isAuthorizedToConfigure());</span>
<span class="nc" id="L406">			activitySelectorPC.setMultiSelect(true);</span>
		}
		

<span class="nc" id="L410">		return activitySelectorPC.getHtmlDisplay();</span>

	}

	/**
	 * @return String - html code for date range picker for the rule
	 */
	private String getDateRangeUI() {
<span class="nc" id="L418">		timeOffBidDateRangePC.getStartDatePickerPC().setDate(getBidStartDate());</span>
<span class="nc" id="L419">		timeOffBidDateRangePC.getEndDatePickerPC().setDate(getBidEndDate());</span>
<span class="nc" id="L420">		timeOffBidDateRangePC.setIsControlEnabled(isAuthorizedToConfigure());</span>
<span class="nc" id="L421">		return timeOffBidDateRangePC.getHtmlDisplay();</span>
	}

	/**
	 * Return Bid Start Date
	 * Set the default of start Date is 15 minutes later then current 
	 * so that users have enough time to save settings since there is check that Bid start cannot be  in the past
	 */
	public LocalDate getBidStartDate() {
		LocalDate lDate;
<span class="nc" id="L431">		Calendar aCal = Calendar.getInstance(viewingTimezone, m_locale);</span>
<span class="nc bnc" id="L432" title="All 4 branches missed.">		if (timeOffBid.getId() == null &amp;&amp; !hasError()) {</span>
<span class="nc" id="L433">			Date date = DateTimeUtil.getDateForDaysAfter(aCal.getTime(), 0, viewingTimezone);</span>
<span class="nc" id="L434">			aCal.setTime(date);</span>
<span class="nc" id="L435">			DateTimeUtil.adjustToDayStart(aCal);</span>
<span class="nc" id="L436">			lDate = new LocalDate(aCal);</span>
<span class="nc" id="L437">		} else {</span>
<span class="nc" id="L438">			aCal.setTime(timeOffBid.getBidStartTime());</span>
<span class="nc" id="L439">			lDate = new LocalDate(aCal);</span>
		}
<span class="nc" id="L441">		return lDate;</span>
	}

	/**
	 * Return Bid Start Date
	 */
	public LocalDate getBidEndDate() {
		LocalDate lDate;
<span class="nc" id="L449">		Calendar aCal = Calendar.getInstance(viewingTimezone, m_locale);</span>
<span class="nc bnc" id="L450" title="All 4 branches missed.">		if (timeOffBid.getId() == null &amp;&amp; !hasError()) {</span>
<span class="nc" id="L451">			Date date = DateTimeUtil.getDateForDaysAfter(aCal.getTime(), 0, viewingTimezone);</span>
<span class="nc" id="L452">			aCal.setTime(date);</span>
<span class="nc" id="L453">			DateTimeUtil.adjustToDayEnd(aCal);</span>
<span class="nc" id="L454">			lDate = new LocalDate(aCal);</span>
<span class="nc" id="L455">		} else {</span>
<span class="nc" id="L456">			aCal.setTime(timeOffBid.getBidEndTime());</span>
<span class="nc" id="L457">			lDate = new LocalDate(aCal);</span>
		}
<span class="nc" id="L459">		return lDate;</span>
	}

	/**
	 * Return Bid Start Date
	 */
	public LocalDate getRequestStartDate() {
		LocalDate lDate;
<span class="nc" id="L467">		Calendar aCal = Calendar.getInstance(viewingTimezone, m_locale);</span>
<span class="nc bnc" id="L468" title="All 4 branches missed.">		if (timeOffBid.getId() == null &amp;&amp; !hasError()) {</span>
<span class="nc" id="L469">			Date date = DateTimeUtil.getDateForDaysAfter(aCal.getTime(), 1, viewingTimezone);</span>
<span class="nc" id="L470">			aCal.setTime(date);</span>
<span class="nc" id="L471">			DateTimeUtil.adjustToDayStart(aCal);</span>
<span class="nc" id="L472">			lDate = new LocalDate(aCal);</span>
<span class="nc" id="L473">		} else {</span>
<span class="nc" id="L474">			aCal.setTime(timeOffBid.getRequestStartTime());</span>
<span class="nc" id="L475">			lDate = new LocalDate(aCal);</span>
		}
<span class="nc" id="L477">		return lDate;</span>
	}

	/**
	 * Return Bid Start Date
	 */
	public LocalDate getRequestEndDate() {
		LocalDate lDate;
<span class="nc" id="L485">		Calendar aCal = Calendar.getInstance(viewingTimezone, m_locale);</span>
<span class="nc bnc" id="L486" title="All 4 branches missed.">		if (timeOffBid.getId() == null &amp;&amp; !hasError()) {</span>
<span class="nc" id="L487">			Date date = DateTimeUtil.getDateForDaysAfter(aCal.getTime(), 1, viewingTimezone);</span>
<span class="nc" id="L488">			aCal.setTime(date);</span>
<span class="nc" id="L489">			DateTimeUtil.adjustToDayEnd(aCal);</span>
<span class="nc" id="L490">			lDate = new LocalDate(aCal);</span>
<span class="nc" id="L491">		} else {</span>
<span class="nc" id="L492">			aCal.setTime(timeOffBid.getRequestEndTime());</span>
<span class="nc" id="L493">			lDate = new LocalDate(aCal);</span>
		}
<span class="nc" id="L495">		return lDate;</span>
	}

	/**
	 * @return String - html code for date range picker for the rule
	 */
	private String getRequestDateRangeUI() {
<span class="nc" id="L502">		timeOffBidRequestDateRangePC.getStartDatePickerPC().setDate(getRequestStartDate());</span>
<span class="nc" id="L503">		timeOffBidRequestDateRangePC.getEndDatePickerPC().setDate(getRequestEndDate());</span>
<span class="nc" id="L504">		timeOffBidRequestDateRangePC.setIsControlEnabled(isAuthorizedToConfigure());</span>
<span class="nc" id="L505">		return timeOffBidRequestDateRangePC.getHtmlDisplay();</span>
	}

	private String getMiminumPerChoiceRow() {
<span class="nc" id="L509">		String rbKey = RmWebBundleKey.RM_TIMEOFF_BID_MINIMUM_OF;</span>
<span class="nc" id="L510">		String inputValue = Integer.toString(getMinValue());</span>
<span class="nc" id="L511">		formInputPC.reset(TIMEOFFBID_MIN_VALUE_FN, inputValue, FormInputPC.TYPE_INTEGER, true);</span>
<span class="nc bnc" id="L512" title="All 2 branches missed.">		formInputPC.setIsReadOnly(!isAuthorizedToConfigure());</span>
<span class="nc" id="L513">		formInputPC.setInputFieldDesc(i18n(rbKey) + HtmlUtil.NBSP + i18n(RmWebBundleKey.RM_TIMEOFF_BID_PER_CHOICE));</span>
<span class="nc" id="L514">		formInputPC.setMaxLength(3);</span>
<span class="nc" id="L515">		formInputPC.setWidth(20);</span>
<span class="nc" id="L516">		formInputPC.initForDisplay();</span>
<span class="nc" id="L517">		String jsString = JSUtil.ON_CHANGE + &quot;updateMaxUnitDropdownPerChoice(this)&quot;;</span>
<span class="nc" id="L518">		String unitDropdown = createPeriodDropdownList(TIMEOFFBID_MIN_UNIT_FN, getSelectedMinUnitValue(), jsString, isAuthorizedToConfigure());</span>
<span class="nc" id="L519">		StringBuilder strBuilder = new StringBuilder();</span>
<span class="nc" id="L520">		strBuilder.append(i18n(rbKey)).append(HtmlUtil.NBSP).append(HtmlUtil.NBSP);</span>
<span class="nc" id="L521">		strBuilder.append(HtmlUtil.NBSP).append(formInputPC.getHtmlDisplay());</span>
<span class="nc" id="L522">		strBuilder.append(HtmlUtil.NBSP).append(unitDropdown);</span>
<span class="nc" id="L523">		strBuilder.append(HtmlUtil.NBSP).append(i18n(RmWebBundleKey.RM_TIMEOFF_BID_PER_CHOICE));</span>
<span class="nc" id="L524">		formInputPC.addValidator(new IsNonNegativeIntegerFieldValidator(formInputPC, TIMEOFFBID_MIN_VALUE_FN,</span>
				RmWebBundleKey.RM_TIMEOFF_BID_MINIMUM_OF, RmWebBundleKey.BUNDLE_NAME));
<span class="nc" id="L526">		return strBuilder.toString();</span>
	}

	private String getMaximumPerChoiceRow() {
<span class="nc" id="L530">		String rbKey = RmWebBundleKey.RM_TIMEOFF_BID_MAXIMUM_OF;</span>
<span class="nc" id="L531">		String inputValue = Integer.toString(getMaxValue());</span>
<span class="nc" id="L532">		formInputPC.reset(TIMEOFFBID_MAX_VALUE_FN, inputValue, FormInputPC.TYPE_INTEGER, true);</span>
<span class="nc bnc" id="L533" title="All 2 branches missed.">		formInputPC.setIsReadOnly(!isAuthorizedToConfigure());</span>
<span class="nc" id="L534">		formInputPC.setInputFieldDesc(i18n(rbKey) + HtmlUtil.NBSP + i18n(RmWebBundleKey.RM_TIMEOFF_BID_PER_CHOICE));</span>
<span class="nc" id="L535">		formInputPC.setMaxLength(3);</span>
<span class="nc" id="L536">		formInputPC.setWidth(20);</span>
<span class="nc" id="L537">		formInputPC.initForDisplay();</span>
<span class="nc" id="L538">		formInputPC.addValidator(new IsNonNegativeIntegerFieldValidator(formInputPC, TIMEOFFBID_MAX_VALUE_FN,</span>
				RmWebBundleKey.RM_TIMEOFF_BID_MAXIMUM_OF, RmWebBundleKey.BUNDLE_NAME));
<span class="nc" id="L540">		String jsString = JSUtil.ON_CHANGE + &quot;updateMinUnitDropdownPerChoice(this)&quot;;</span>
<span class="nc" id="L541">		String unitDropdown = createPeriodDropdownList(TIMEOFFBID_MAX_UNIT_FN, getSelectedMaxUnitValue(), jsString, isAuthorizedToConfigure());</span>
<span class="nc" id="L542">		StringBuilder strBuilder = new StringBuilder();</span>
<span class="nc" id="L543">		strBuilder.append(i18n(rbKey)).append(HtmlUtil.NBSP);</span>
<span class="nc" id="L544">		strBuilder.append(HtmlUtil.NBSP).append(formInputPC.getHtmlDisplay());</span>
<span class="nc" id="L545">		strBuilder.append(HtmlUtil.NBSP).append(unitDropdown);</span>
<span class="nc" id="L546">		strBuilder.append(HtmlUtil.NBSP).append(i18n(RmWebBundleKey.RM_TIMEOFF_BID_PER_CHOICE));</span>
<span class="nc" id="L547">		return strBuilder.toString();</span>
	}

	private String getMaximumForApprovalRow() {
<span class="nc" id="L551">		String rbKey = RmWebBundleKey.RM_TIMEOFF_BID_MAXIMUM_OF;</span>
<span class="nc" id="L552">		boolean isVariesByEmployees = timeOffBid.getIsApprovalMaxValueVariesByEmp();</span>
<span class="nc" id="L553">		String inputValue = &quot;&quot;;</span>
<span class="nc bnc" id="L554" title="All 2 branches missed.">		if (!isVariesByEmployees) {</span>
<span class="nc" id="L555">			inputValue = Integer.toString(getMaxValueForApproval());</span>
		}
<span class="nc bnc" id="L557" title="All 2 branches missed.">		formInputPC.reset(TIMEOFFBID_MAX_VALUE_FORAPROVAL_FN, inputValue, FormInputPC.TYPE_INTEGER, !isVariesByEmployees);</span>
<span class="nc bnc" id="L558" title="All 2 branches missed.">		formInputPC.setIsReadOnly(!isAuthorizedToConfigure());</span>
<span class="nc" id="L559">		formInputPC.setInputFieldDesc(i18n(rbKey) + HtmlUtil.NBSP + i18n(RmWebBundleKey.RM_TIMEOFF_BID_TO_BE_APPROVED));</span>
<span class="nc" id="L560">		formInputPC.setMaxLength(3);</span>
<span class="nc" id="L561">		formInputPC.setWidth(20);</span>
<span class="nc bnc" id="L562" title="All 2 branches missed.">		formInputPC.setEnabled(!isVariesByEmployees);</span>
<span class="nc" id="L563">		formInputPC.setRenderJavaScriptIfDisabled(false);</span>
<span class="nc" id="L564">		formInputPC.initForDisplay();</span>
<span class="nc" id="L565">		formInputPC.addValidator(new IsNonNegativeIntegerFieldValidator(formInputPC, TIMEOFFBID_MAX_VALUE_FORAPROVAL_FN,</span>
				RmWebBundleKey.RM_TIMEOFF_BID_MAXIMUM_OF, RmWebBundleKey.BUNDLE_NAME));
<span class="nc bnc" id="L567" title="All 2 branches missed.">		String unitDropdown = createPeriodDropdownList(TIMEOFFBID_MAX_UNIT_FORAPROVAL_FN, getSelectedMaxUnitValueForApproval(),</span>
<span class="nc bnc" id="L568" title="All 2 branches missed.">				!isVariesByEmployees&amp;&amp;isAuthorizedToConfigure());</span>

<span class="nc bnc" id="L570" title="All 2 branches missed.">		String checkbox = makeChoiceInput(TIMEOFFBID_VARY_BY_EMPLOYEE_FN, &quot;true&quot;, isVariesByEmployees, !isAuthorizedToConfigure(), JSUtil.ON_CHANGE</span>
				+ &quot;updateMaximumForApprovalUI(this)&quot;);

<span class="nc" id="L573">		StringBuilder strBuilder = new StringBuilder();</span>
<span class="nc" id="L574">		strBuilder.append(i18n(rbKey)).append(HtmlUtil.NBSP);</span>
<span class="nc" id="L575">		strBuilder.append(HtmlUtil.NBSP).append(formInputPC.getHtmlDisplay());</span>
<span class="nc" id="L576">		strBuilder.append(HtmlUtil.NBSP).append(unitDropdown);</span>
<span class="nc" id="L577">		strBuilder.append(HtmlUtil.NBSP).append(i18n(RmWebBundleKey.RM_TIMEOFF_BID_TO_BE_APPROVED));</span>

<span class="nc" id="L579">		strBuilder.append(HtmlUtil.NBSP).append(checkbox).append(i18n(RmWebBundleKey.RM_TIMEOFF_BID_VARIES_BY_EMPLOYEE)); </span>
<span class="nc" id="L580">		return strBuilder.toString();</span>
	}

	private String createPeriodDropdownList(String fieldName, String selected, boolean isEnabled) {
<span class="nc" id="L584">		return createPeriodDropdownList(fieldName, selected, JSUtil.ON_CHANGE, isEnabled);</span>
	}

	@SuppressWarnings({ &quot;unchecked&quot;, &quot;rawtypes&quot; })
	private String createPeriodDropdownList(String fieldName, String selected, String jsString, boolean isEnabled) {
<span class="nc" id="L589">		Collection options = new ArrayList(2);</span>
<span class="nc" id="L590">		options.add(new StringsPair(Integer.toString(TimeOffBid.TIMEOFF_BID_WEEKS), i18n(m_common_bundle, UIFWebBundleKey.PERIOD_WEEKS)));</span>
<span class="nc" id="L591">		options.add(new StringsPair(Integer.toString(TimeOffBid.TIMEOFF_BID_DAYS), i18n(m_common_bundle, UIFWebBundleKey.PERIOD_DAYS)));</span>
<span class="nc" id="L592">		String[] selectedValue = new String[] { selected };</span>
<span class="nc" id="L593">		return HtmlUtil.makeSelectInput(fieldName, selectedValue, jsString, options, false, isEnabled);</span>
	}

	private String makeChoiceInput(String name, String value, boolean checked, boolean disabled, String onClickJS) {
<span class="nc" id="L597">		htmlChoiceInputPC.reset();</span>
<span class="nc" id="L598">		htmlChoiceInputPC.setInputName(name);</span>
<span class="nc" id="L599">		htmlChoiceInputPC.setValue(value);</span>
<span class="nc" id="L600">		htmlChoiceInputPC.setIsChecked(checked);</span>
<span class="nc" id="L601">		htmlChoiceInputPC.setIsDisabled(disabled);</span>
<span class="nc" id="L602">		htmlChoiceInputPC.setOnClickJS(onClickJS);</span>
<span class="nc" id="L603">		return htmlChoiceInputPC.getHtmlDisplay();</span>
	}

	public ID getBidOrganization() {
<span class="nc" id="L607">		return selectedOrgId;</span>
	}

	/*Set value for time Off Bid after extracting parameters
	 *1: Auto extract method
	 * */
	public void setBidName(String name) {
<span class="nc" id="L614">		timeOffBid.setName(name);</span>
<span class="nc" id="L615">	}</span>

	public void setBidStatus(int status) {
<span class="nc" id="L618">		timeOffBid.setStatus(status);</span>
<span class="nc" id="L619">	}</span>

	public void setBidOrganization(String orgId) {
<span class="nc" id="L622">		timeOffBid.setOrganizationId(new ID(orgId));</span>
<span class="nc" id="L623">	}</span>

	public void setMinValue(int value) {
<span class="nc" id="L626">		this.minPeriodValue = value;</span>
<span class="nc" id="L627">		timeOffBid.setMinValuePerChoice(value);</span>
<span class="nc" id="L628">	}</span>

	public int getMinValue() {
<span class="nc bnc" id="L631" title="All 2 branches missed.">		return this.hasError() ? this.minPeriodValue : timeOffBid.getMinValuePerChoice();</span>
	}

	public void setMinUnit(int minUnit) {
<span class="nc" id="L635">		timeOffBid.setMinUnitPerChoice(minUnit);</span>
<span class="nc" id="L636">	}</span>

	public void setMaxValue(int value) {
<span class="nc" id="L639">		this.maxPeriodValue = value;</span>
<span class="nc" id="L640">		timeOffBid.setMaxValuePerChoice(value);</span>
<span class="nc" id="L641">	}</span>

	public int getMaxValue() {
<span class="nc bnc" id="L644" title="All 2 branches missed.">		return this.hasError() ? this.maxPeriodValue : timeOffBid.getMaxValuePerChoice();</span>
	}

	public void setMaxUnit(int unit) {
<span class="nc" id="L648">		timeOffBid.setMaxUnitPerChoice(unit);</span>
<span class="nc" id="L649">	}</span>

	public void setMaxValueForApproval(int val) {
<span class="nc" id="L652">		this.maxPeriodForApprovalValue = val;</span>
<span class="nc" id="L653">		timeOffBid.setMaxValueForApproval(val);</span>
<span class="nc" id="L654">	}</span>

	public int getMaxValueForApproval() {
<span class="nc bnc" id="L657" title="All 2 branches missed.">		return this.hasError() ? this.maxPeriodForApprovalValue : timeOffBid.getMaxValueForApproval();</span>
	}

	public void setMaxUnitForApproval(int val) {
<span class="nc" id="L661">		timeOffBid.setMaxUnitForApproval(val);</span>
<span class="nc" id="L662">	}</span>

	public void setIsVariedByEmployee(boolean val) {
<span class="nc" id="L665">		timeOffBid.setIsApprovalMaxValueVariesByEmp(val);</span>
<span class="nc" id="L666">	}</span>

	//End auto extract method
	//2: Custom methods based on other extracting  
	public void setTimeOffBidActivityIds(Collection&lt;String&gt; selectedIds) {
<span class="nc" id="L671">		timeOffBid.setSelectedActivityIds(selectedIds);</span>
<span class="nc" id="L672">	}</span>

	/*The component Date Range Picker PC has exact parameter inside already*/
	public void setTimeOffBidDateRange() {
<span class="nc" id="L676">		Date startDate = timeOffBidDateRangePC.getStartDatePickerPC().getDate();</span>
<span class="nc" id="L677">		Date endDate = timeOffBidDateRangePC.getEndDatePickerPC().getDate();</span>
<span class="nc" id="L678">		timeOffBid.setBidStartTime(startDate);</span>
<span class="nc" id="L679">		timeOffBid.setBidEndTime(endDate);</span>
<span class="nc" id="L680">	}</span>

	/*The component  Date Range Picker PC has exact parameter inside already*/
	public void setTimeOffBidRequestDateRange() {
<span class="nc" id="L684">		Date startDate = timeOffBidRequestDateRangePC.getStartDatePickerPC().getDate();</span>
<span class="nc" id="L685">		Date endDate = timeOffBidRequestDateRangePC.getEndDatePickerPC().getDate();</span>
<span class="nc" id="L686">		timeOffBid.setRequestStartTime(startDate);</span>
<span class="nc" id="L687">		timeOffBid.setRequestEndTime(endDate);</span>
<span class="nc" id="L688">	}</span>

	public void resetApprovalFields() {
<span class="nc" id="L691">		timeOffBid.setFieldNull(TimeOffBidFieldInfo.TIMEOFFBID_MAXVALUEFORAPPROVAL);</span>
<span class="nc" id="L692">		timeOffBid.setFieldNull(TimeOffBidFieldInfo.TIMEOFFBID_MAXUNITFORAPPROVAL);</span>
<span class="nc" id="L693">	}</span>

	/*End for extracting parameters*/

	/*Helper functions*/
	private String i18n(String key) {
<span class="nc" id="L699">		return i18n(rmBundle, key);</span>
	}

	private ID getSelectedOrgIdForDropdown(Collection&lt;StringsPair&gt; options, Collection&lt;Organization&gt; orgs, boolean isAddMode) {
<span class="nc" id="L703">		ID selectedId = null;</span>
<span class="nc" id="L704">		boolean isGetSelectedOrgId = false;</span>
<span class="nc bnc" id="L705" title="All 4 branches missed.">		if (orgs != null &amp;&amp; !orgs.isEmpty()) {</span>
<span class="nc bnc" id="L706" title="All 2 branches missed.">			for (Iterator&lt;Organization&gt; it = orgs.iterator(); it.hasNext();) {</span>
<span class="nc" id="L707">				Organization org = it.next();</span>
<span class="nc" id="L708">				ID orgId = org.getID();</span>
<span class="nc" id="L709">				options.add(new StringsPair(orgId.toString(), org.getName()));</span>
<span class="nc bnc" id="L710" title="All 6 branches missed.">				if (!isGetSelectedOrgId &amp;&amp; (isAddMode || orgId.equals(timeOffBid.getOrganizationId()))) {</span>
<span class="nc" id="L711">					isGetSelectedOrgId = true;</span>
<span class="nc" id="L712">					selectedId = orgId;</span>
				}
<span class="nc" id="L714">			}</span>
		}
<span class="nc" id="L716">		return selectedId;</span>
	}

	private Collection&lt;String&gt; getSelectedActivityIds(Collection&lt;TimeOffBidActivity&gt; bidActivities) {
<span class="nc" id="L720">		Collection&lt;String&gt; list = new ArrayList&lt;String&gt;();</span>
<span class="nc bnc" id="L721" title="All 4 branches missed.">		if (bidActivities != null &amp;&amp; !bidActivities.isEmpty()) {</span>
<span class="nc bnc" id="L722" title="All 2 branches missed.">			for (Iterator&lt;TimeOffBidActivity&gt; it = bidActivities.iterator(); it.hasNext();) {</span>
<span class="nc" id="L723">				TimeOffBidActivity bidActivity = it.next();</span>
<span class="nc" id="L724">				list.add(bidActivity.getActivityId().toString());</span>
<span class="nc" id="L725">			}</span>
		}
<span class="nc" id="L727">		return list;</span>
	}

	private String getSelectedMinUnitValue() {
<span class="nc bnc" id="L731" title="All 2 branches missed.">		if (timeOffBid.getFieldValue(TimeOffBidFieldInfo.TIMEOFFBID_MINUNITPERCHOICE) == null) {</span>
<span class="nc" id="L732">			return Integer.toString(TimeOffBid.TIMEOFF_BID_WEEKS);</span>
		} else {
<span class="nc" id="L734">			return Integer.toString(timeOffBid.getMinUnitPerChoice());</span>
		}
	}

	private String getSelectedMaxUnitValue() {
<span class="nc bnc" id="L739" title="All 2 branches missed.">		if (timeOffBid.getFieldValue(TimeOffBidFieldInfo.TIMEOFFBID_MAXUNITPERCHOICE) == null) {</span>
<span class="nc" id="L740">			return Integer.toString(TimeOffBid.TIMEOFF_BID_WEEKS);</span>
		} else {
<span class="nc" id="L742">			return Integer.toString(timeOffBid.getMaxUnitPerChoice());</span>
		}
	}

	private String getSelectedMaxUnitValueForApproval() {
<span class="nc bnc" id="L747" title="All 2 branches missed.">		if (timeOffBid.getFieldValue(TimeOffBidFieldInfo.TIMEOFFBID_MAXUNITFORAPPROVAL) == null) {</span>
<span class="nc" id="L748">			return Integer.toString(TimeOffBid.TIMEOFF_BID_WEEKS);</span>
		} else {
<span class="nc" id="L750">			return Integer.toString(timeOffBid.getMaxUnitForApproval());</span>
		}
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>