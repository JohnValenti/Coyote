<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>CustShiftReq.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.ejb.rm.requests.custshift.model</a> &gt; <span class="el_source">CustShiftReq.java</span></div><h1>CustShiftReq.java</h1><pre class="source lang-java linenums">/*
 * CustShiftReq.java
 *
 * Copyright:    Copyright (c) 2011
 * Company:      Verint Inc
 * @author       Sameet Joshi
 * All rights reserved.
 */
package com.bluepumpkin.ejb.rm.requests.custshift.model;

import java.util.Calendar;
import java.util.Collection;
import java.util.Collections;
import java.util.Date;
import java.util.Iterator;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.Pair;
import com.bluepumpkin.common.datatypes.TimeRange;
import com.bluepumpkin.common.util.TimeZoneUtil;
import com.bluepumpkin.ejb.bbm.schedule.model.ShiftAssignment;
import com.bluepumpkin.ejb.bbm.schedule.model.ShiftEventAssignment;
import com.bluepumpkin.ejb.bbm.schedule.util.ScheduleUtil;
import com.bluepumpkin.ejb.bbm.vo.FieldInfo;
import com.bluepumpkin.ejb.bbm.workrules.ejb.WorkRuleManager;
import com.bluepumpkin.ejb.bbm.workrules.model.Shift;
import com.bluepumpkin.ejb.bbm.workrules.model.ShiftOTExtension;
import com.bluepumpkin.ejb.rm.requests.common.model.Request;
import com.bluepumpkin.ejb.rm.requests.common.model.RequestAggregate;
import com.bluepumpkin.ejb.rm.requests.common.validation.ValidationCache;
import com.bluepumpkin.ejb.rm.requests.custshift.validation.CustShiftValidationCache;

/**
 * Class represents CustShiftReqs.
 * &lt;p/&gt;
 */
public class CustShiftReq extends RequestAggregate {
	private static final long serialVersionUID = 6909127108854014755L;
<span class="nc" id="L39">	private static final FieldInfo m_fieldInfo = new CustShiftReqFieldInfo();</span>
<span class="nc" id="L40">	private transient ValidationCache m_validationCache = null;</span>

<span class="nc" id="L42">	public static final ID REQUEST_SUB_TYPE_REG_NEW_SHIFT = new ID(1);</span>
<span class="nc" id="L43">	public static final ID REQUEST_SUB_TYPE_OT_NEW_SHIFT = new ID(2);</span>
<span class="nc" id="L44">	public static final ID REQUEST_SUB_TYPE_REG_SHIFT_CHANGE = new ID(4);</span>
<span class="nc" id="L45">	public static final ID REQUEST_SUB_TYPE_OT_SHIFT_CHANGE = new ID(8);</span>

	//These value constants are used by the custom shift request filter
	public static final String CS_SUBTYPE_NEW_SHIFT = &quot;CS_SUBTYPE_NEW_SHIFT&quot;;
	public static final String CS_SUBTYPE_SHIFT_CHANGE = &quot;CS_SUBTYPE_SHIFT_CHANGE&quot;;
	public static final String CS_OVERTIME_YES = &quot;1&quot;;
	public static final String CS_OVERTIME_NO = &quot;0&quot;;

	/**
	 * Creates a new instance of RequestAggregate
	 */
	public CustShiftReq(String pReqType, long detailLevel) {
<span class="nc" id="L57">		super(pReqType, detailLevel);</span>
<span class="nc" id="L58">	}</span>

	public CustShiftReq(long detailLevel) {
<span class="nc" id="L61">		super(Request.REQUESTTYPE_CUSTSHIFT, detailLevel);</span>
<span class="nc" id="L62">	}</span>

	public static long getDetailLevelForValidation() {
<span class="nc" id="L65">		return DL_BASIC;</span>
	}

	public ValidationCache getValidationCache() {
<span class="nc bnc" id="L69" title="All 2 branches missed.">		if (m_validationCache == null) {</span>
<span class="nc" id="L70">			m_validationCache = new CustShiftValidationCache(this);</span>
		}
<span class="nc" id="L72">		return m_validationCache;</span>
	}

	public CustShiftValidationCache getCache() {
<span class="nc" id="L76">		return (CustShiftValidationCache) getValidationCache();</span>
	}

	public Collection getEmpIDTimeRangePairs() {
<span class="nc" id="L80">		return Collections.singletonList(new Pair(getEmployeeID(), new TimeRange(getStartTime(), getEndTime())));</span>
	}

	public FieldInfo getFieldInfo() {
<span class="nc" id="L84">		return m_fieldInfo;</span>
	}

	public Collection getValidationTimeRanges() {
<span class="nc" id="L88">		return null;</span>
	}

	public ID getID() {
<span class="nc" id="L92">		return getFieldValueID(CustShiftReqFieldInfo.CUSTSHIFTREQ_I_ID);</span>
	}

	public ID getSPID() {
<span class="nc" id="L96">		return getFieldValueID(CustShiftReqFieldInfo.CUSTSHIFTREQ_I_SPID);</span>
	}

	public ID getShiftID() {
<span class="nc" id="L100">		return getFieldValueID(CustShiftReqFieldInfo.CUSTSHIFTREQ_I_SHIFTID);</span>
	}

	public ID getActivityID() {
<span class="nc" id="L104">		return getFieldValueID(CustShiftReqFieldInfo.CUSTSHIFTREQ_I_ACTIVITYID);</span>
	}

	public Date getStartTime() {
<span class="nc" id="L108">		return getFieldValueDate(CustShiftReqFieldInfo.CUSTSHIFTREQ_D_STARTTIME);</span>
	}

	public Date getEndTime() {
<span class="nc" id="L112">		return getFieldValueDate(CustShiftReqFieldInfo.CUSTSHIFTREQ_D_ENDTIME);</span>
	}

	public boolean isOT() {
<span class="nc" id="L116">		return getFieldValueBoolean(CustShiftReqFieldInfo.CUSTSHIFTREQ_B_ISOT);</span>
	}

	public ID getExtBeforeID() {
<span class="nc" id="L120">		return getFieldValueID(CustShiftReqFieldInfo.CUSTSHIFTREQ_I_EXTBEFOREID);</span>
	}

	public ID getExtBeforeActivityID() {
<span class="nc" id="L124">		return getFieldValueID(CustShiftReqFieldInfo.CUSTSHIFTREQ_I_EXTBEFOREACTIVITYID);</span>
	}

	public boolean getExtBeforeIsOT() {
<span class="nc" id="L128">		return getFieldValueBoolean(CustShiftReqFieldInfo.CUSTSHIFTREQ_B_EXTBEFOREISOT);</span>
	}

	public int getExtBeforeGap() {
<span class="nc" id="L132">		return getFieldValueInt(CustShiftReqFieldInfo.CUSTSHIFTREQ_N_EXTBEFOREGAP);</span>
	}

	public ID getExtAfterID() {
<span class="nc" id="L136">		return getFieldValueID(CustShiftReqFieldInfo.CUSTSHIFTREQ_I_EXTAFTERID);</span>
	}

	public ID getExtAfterActivityID() {
<span class="nc" id="L140">		return getFieldValueID(CustShiftReqFieldInfo.CUSTSHIFTREQ_I_EXTAFTERACTIVITYID);</span>
	}

	public boolean getExtAfterIsOT() {
<span class="nc" id="L144">		return getFieldValueBoolean(CustShiftReqFieldInfo.CUSTSHIFTREQ_B_EXTAFTERISOT);</span>
	}

	public int getExtAfterGap() {
<span class="nc" id="L148">		return getFieldValueInt(CustShiftReqFieldInfo.CUSTSHIFTREQ_N_EXTAFTERGAP);</span>
	}

	public String getHashCodeForUndrlyngShift() {
<span class="nc" id="L152">		return (String) getFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_S_HASHCODE);</span>
	}

	public int getSubType() {
<span class="nc" id="L156">		return getFieldValueInt(CustShiftReqFieldInfo.CUSTSHIFTREQ_N_SUBTYPE);</span>
	}

	public ID getRequestSubType() {
<span class="nc" id="L160">		return new ID(getSubType());</span>
	}

	public Date getShiftStartTime() {
<span class="nc" id="L164">		return getFieldValueDate(CustShiftReqFieldInfo.CUSTSHIFTREQ_D_SHIFTSTARTTIME);</span>
	}

	public Date getShiftEndTime() {
<span class="nc" id="L168">		return getFieldValueDate(CustShiftReqFieldInfo.CUSTSHIFTREQ_D_SHIFTENDTIME);</span>
	}

	public void setID(ID val) {
<span class="nc" id="L172">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_I_ID, val);</span>
<span class="nc" id="L173">	}</span>

	public void setSPID(ID val) {
<span class="nc" id="L176">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_I_SPID, val);</span>
<span class="nc" id="L177">	}</span>

	public void setShiftID(ID val) {
<span class="nc" id="L180">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_I_SHIFTID, val);</span>
<span class="nc" id="L181">	}</span>

	public void setActivityID(ID val) {
<span class="nc" id="L184">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_I_ACTIVITYID, val);</span>
<span class="nc" id="L185">	}</span>

	public void setStartTime(Date val) {
<span class="nc" id="L188">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_D_STARTTIME, val);</span>
<span class="nc" id="L189">	}</span>

	public void setEndTime(Date val) {
<span class="nc" id="L192">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_D_ENDTIME, val);</span>
<span class="nc" id="L193">	}</span>


	public void setIsOT(boolean val) {
<span class="nc" id="L197">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_B_ISOT, val);</span>
<span class="nc" id="L198">	}</span>

	public void setExtBeforeID(ID val) {
<span class="nc" id="L201">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_I_EXTBEFOREID, val);</span>
<span class="nc" id="L202">	}</span>

	public void setExtBeforeActivityID(ID val) {
<span class="nc" id="L205">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_I_EXTBEFOREACTIVITYID, val);</span>
<span class="nc" id="L206">	}</span>

	public void setExtBeforeIsOT(boolean val) {
<span class="nc" id="L209">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_B_EXTBEFOREISOT, val);</span>
<span class="nc" id="L210">	}</span>

	public void setExtBeforeGap(int val) {
<span class="nc" id="L213">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_N_EXTBEFOREGAP, val);</span>
<span class="nc" id="L214">	}</span>


	public void setExtAfterID(ID val) {
<span class="nc" id="L218">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_I_EXTAFTERID, val);</span>
<span class="nc" id="L219">	}</span>

	public void setExtAfterActivityID(ID val) {
<span class="nc" id="L222">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_I_EXTAFTERACTIVITYID, val);</span>
<span class="nc" id="L223">	}</span>

	public void setExtAfterIsOT(boolean val) {
<span class="nc" id="L226">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_B_EXTAFTERISOT, val);</span>
<span class="nc" id="L227">	}</span>

	public void setExtAfterGap(int val) {
<span class="nc" id="L230">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_N_EXTAFTERGAP, val);</span>
<span class="nc" id="L231">	}</span>

	public void setHashCodeForUndrlyngShift(String val) {
<span class="nc" id="L234">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_S_HASHCODE, val);</span>
<span class="nc" id="L235">	}</span>

	public void setSubType(int val) {
<span class="nc" id="L238">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_N_SUBTYPE, val);</span>
<span class="nc" id="L239">	}</span>

	public void setShiftStartTime(Date val) {
<span class="nc" id="L242">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_D_SHIFTSTARTTIME, val);</span>
<span class="nc" id="L243">	}</span>

	public void setShiftEndTime(Date val) {
<span class="nc" id="L246">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_D_SHIFTENDTIME, val);</span>
<span class="nc" id="L247">	}</span>



	/**
	 * Get the duration of the request, which is only the delta of what is changing from the current ShiftAssignment.
	 * If there is no current ShiftAssignment (i.e., this is a New Shift request), then the duration is simply
	 * the entire shift, plus any extensions.
	 */
	public int getDurationinMinutes() {
<span class="nc" id="L257">		int dur = 0;</span>
<span class="nc bnc" id="L258" title="All 6 branches missed.">		if (getShiftID() == null &amp;&amp; getExtAfterID() != null &amp;&amp; getExtBeforeID() != null) {</span>
<span class="nc" id="L259">			dur = getExtAfterDuration() + getExtAfterGap() + getExtBeforeDuration() + getExtBeforeGap();</span>
		} else {
<span class="nc" id="L261">			dur = (int) ((getEndTime().getTime() - getStartTime().getTime()) / ShiftAssignment.MILLIS_IN_ONE_MIN);</span>
		}
<span class="nc" id="L263">		return dur;</span>
	}

	/**
	 * Get the duration of the main shift, which does not include the extension before or after.
	 */
	public int getShiftDurationinMinutes() {
<span class="nc bnc" id="L270" title="All 4 branches missed.">		if (getShiftEndTime() == null || getShiftStartTime() == null)</span>
<span class="nc" id="L271">			return 0;</span>
<span class="nc" id="L272">		return (int) ((getShiftEndTime().getTime() - getShiftStartTime().getTime()) / ShiftAssignment.MILLIS_IN_ONE_MIN);</span>
	}

	/*
	public int getDuration() {
		return getFieldValueInt(CustShiftReqFieldInfo.CUSTSHIFTREQ_I_DURATION);
	}
	*/

	public int getExtBeforeDuration() {
<span class="nc" id="L282">		return getFieldValueInt(CustShiftReqFieldInfo.CUSTSHIFTREQ_N_EXTBEFOREDURATION);</span>
	}

	public int getExtAfterDuration() {
<span class="nc" id="L286">		return getFieldValueInt(CustShiftReqFieldInfo.CUSTSHIFTREQ_N_EXTAFTERDURATION);</span>
	}

	/*
	public void setDuration(int val) {
		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_I_DURATION, val);
	}
	*/

	public void setExtBeforeDuration(int val) {
<span class="nc" id="L296">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_N_EXTBEFOREDURATION, val);</span>
<span class="nc" id="L297">	}</span>

	public void setExtAfterDuration(int val) {
<span class="nc" id="L300">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_N_EXTAFTERDURATION, val);</span>
<span class="nc" id="L301">	}</span>

	public void setShiftAssignmentID(ID val) {
<span class="nc" id="L304">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_I_SHIFTASSIGNMENTID, val);</span>
<span class="nc" id="L305">	}</span>

	public ID getShiftAssignmentID() {
<span class="nc" id="L308">		return getFieldValueID(CustShiftReqFieldInfo.CUSTSHIFTREQ_I_SHIFTASSIGNMENTID);</span>
	}

	public void setShiftAssignmentChangeCounter(int val) {
<span class="nc" id="L312">		setFieldValue(CustShiftReqFieldInfo.CUSTSHIFTREQ_I_CHGCOUNTER, val);</span>
<span class="nc" id="L313">	}</span>

	public int getShiftAssignmentChangeCounter() {
<span class="nc" id="L316">		return getFieldValueInt(CustShiftReqFieldInfo.CUSTSHIFTREQ_I_CHGCOUNTER);</span>
	}

	/**
	 * Is this shift change request for the ship in the past
	 *
	 * @return
	 */
	public boolean isInPastDate() {
<span class="nc" id="L325">		return this.getShiftStartTime().before(this.getSubmittedOn());</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>