<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>RmSettingsListPM.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.rm.setup</a> &gt; <span class="el_source">RmSettingsListPM.java</span></div><h1>RmSettingsListPM.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.rm.setup;

import java.util.Collection;
import java.util.Collections;
import java.util.ResourceBundle;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.logging.Category;
import com.bluepumpkin.ejb.bbm.workresource.OrganizationScopeManagerProxy;
import com.bluepumpkin.ejb.rm.util.LicenseUtil;
import com.bluepumpkin.web.bbm.l10n.BbmWebBundleKey;
import com.bluepumpkin.web.bbm.organization.OrgWorkpaneListPageModel;
import com.bluepumpkin.web.rm.Log;
import com.bluepumpkin.web.rm.l10n.RmWebBundleKey;
import com.bluepumpkin.web.rm.setup.validation.ValidationPageModel;
import com.witness.web.uif.base.Message;
import com.witness.web.uif.keys.PageAction;
import com.witness.web.uif.pagecomponent.dialog.DialogToolbarMenuPC;
import com.witness.web.uif.system.RequestContext;

/**
 * Title:        RmSettingsListPM
 * Description:  Base class for Request Managements Settings List Page Model
 * Copyright:    Copyright (c) 2003
 * Company:      Blue Pumpkin Software, Inc
 * @author       David Su, DSu
 * @version      1.0
 *
 * Created on Nov 10, 2003, 2:14:05 PM
 */
public abstract class RmSettingsListPM extends OrgWorkpaneListPageModel {
<span class="nc" id="L32">	private static final Category LOG = Log.initCategory(RmSettingsListPM.class.getName());</span>

	private static final String APPLY_RULE = &quot;APPLY_RULE&quot;;
	private static final String NEW_TIMEOFF = &quot;NEW_TIME_OFF&quot;;
	private static final String NEW_TIMEOFF_WITHDRAW = &quot;NEW_TIMEOFF_WITHDRAW&quot;;
	private static final String NEW_SHIFTSWAP = &quot;NEW_SHIFT_SWAP&quot;;
	private static final String NEW_SHIFTBID = &quot;NEW_SHIFT_BID&quot;;
	private static final String NEW_CUSTOMSHIFT = &quot;NEW_CUSTOM_SHIFT&quot;;
	private static final String NEW_FLEXTIME = &quot;NEW_FLEX_TIME&quot;;
	private static final String NEW_RULE_DIALOG_NAME = &quot;NEW_RULE_DIALOG_NAME&quot;;
	private static final String NEW_SHIFTSWAP_WITHDRAW = &quot;NEW_SHIFTSWAP_WITHDRAW&quot;;

	private ID m_privID_TOM;
	private ID m_privID_SS;
	private ID m_privID_SB;
	private ID m_privID_SC;
	private ID m_privID_FT;
	
	protected DialogToolbarMenuPC m_dialogMenuPC;
	private String[] m_appliedRuleIds;
	private String[] m_totalRuleIds;

<span class="nc" id="L54">	protected Collection m_ruleList = Collections.EMPTY_LIST;</span>
<span class="nc" id="L55">	protected boolean m_isEmpty = true;</span>
	protected ResourceBundle m_rmBundle;

	/**
	 * Constructor
	 */
	public RmSettingsListPM(RequestContext context, ID privID_TOM, ID privID_SS, 
			ID privID_SB, ID privID_SC) {
<span class="nc" id="L63">		super(context);</span>
<span class="nc" id="L64">		m_privID_TOM = privID_TOM;</span>
<span class="nc" id="L65">		m_privID_SS = privID_SS;</span>
<span class="nc" id="L66">		m_privID_SB = privID_SB;</span>
<span class="nc" id="L67">		m_privID_SC = privID_SC;</span>
		
<span class="nc" id="L69">		m_rmBundle = m_localizer.getBundle(RmWebBundleKey.BUNDLE_NAME);</span>

<span class="nc" id="L71">		initDialog(context);</span>
<span class="nc" id="L72">		addChildComponent(m_dialogMenuPC);</span>
<span class="nc" id="L73">	}</span>
	public RmSettingsListPM(RequestContext context, ID privID_TOM, ID privID_SS, 
			ID privID_SB, ID privID_SC,ID privID_FT) {
<span class="nc" id="L76">		super(context);</span>
<span class="nc" id="L77">		m_privID_TOM = privID_TOM;</span>
<span class="nc" id="L78">		m_privID_SS = privID_SS;</span>
<span class="nc" id="L79">		m_privID_SB = privID_SB;</span>
<span class="nc" id="L80">		m_privID_SC = privID_SC;</span>
<span class="nc" id="L81">		m_privID_FT = privID_FT;</span>

<span class="nc" id="L83">		m_rmBundle = m_localizer.getBundle(RmWebBundleKey.BUNDLE_NAME);</span>

<span class="nc" id="L85">		initDialog(context);</span>
<span class="nc" id="L86">		addChildComponent(m_dialogMenuPC);</span>
<span class="nc" id="L87">	}</span>

	/**
	 * Loads all the RuleList value objects for the selected Organization ID
	 *
	 * @return true if load was successful
	 */
	protected boolean loadRules() {
		try {
<span class="nc bnc" id="L96" title="All 2 branches missed.">			if (isAuthorizedToConfigure()) {</span>
<span class="nc" id="L97">				m_ruleList = loadSpecificRules();</span>
<span class="nc" id="L98">				m_isEmpty = m_ruleList.isEmpty();</span>
<span class="nc" id="L99">				return true;</span>
			} else {
<span class="nc" id="L101">				addPageMessage(Message.RESPONSE_TYPE,</span>
						BbmWebBundleKey.NOT_AUTHORIZED_TO_CONFIG_SELECTED_ORG,
						BbmWebBundleKey.BUNDLE_NAME);
			}
<span class="nc" id="L105">		} catch (Exception ex) {</span>
<span class="nc" id="L106">			handleUnableToLoadDataError(LOG, ex);</span>
<span class="nc" id="L107">		}</span>
<span class="nc" id="L108">		return false;</span>
	}

	protected abstract Collection loadSpecificRules() throws Exception;

	protected abstract String getDialogHeader();

	/**
	 * Use default tool bar
	 */
	protected void useDefaultToolbar(String applyRuleLabel, String addLabel,
			String copyLabel, String editLabel, String delLabel) {
		// Apply Rule
<span class="nc" id="L121">		m_toolbar.addSubmitTextButton(APPLY_RULE, applyRuleLabel,</span>
<span class="nc bnc" id="L122" title="All 4 branches missed.">									  isAddActionEnabled() &amp;&amp; !m_isEmpty);</span>

		// Display Add
<span class="nc" id="L125">		m_toolbar.addPopupDialogTextButton(NEW_RULE_DIALOG_NAME, addLabel,</span>
<span class="nc" id="L126">				isAddActionEnabled());</span>

		// Display Copy
<span class="nc" id="L129">		m_toolbar.addSubmitTextButton(PageAction.COPY, copyLabel,</span>
<span class="nc" id="L130">				isCopyActionEnabled());</span>

		// Display Edit and Delete
<span class="nc" id="L133">		m_toolbar.addSubmitTextButton(PageAction.EDIT, editLabel,</span>
<span class="nc" id="L134">				isEditActionEnabled());</span>

<span class="nc" id="L136">		m_toolbar.addDeleteTextButton(PageAction.DELETE, delLabel,</span>
<span class="nc" id="L137">				isDeleteActionEnabled());</span>
<span class="nc" id="L138">	}</span>
	protected void initDialogMenuAndAddTimeOffRules(ID selectedOrgID ,RequestContext context){
	
<span class="nc" id="L141">		m_dialogMenuPC = new DialogToolbarMenuPC(context, m_toolbar);</span>
<span class="nc" id="L142">		m_dialogMenuPC.setName(NEW_RULE_DIALOG_NAME);</span>

<span class="nc" id="L144">		m_dialogMenuPC.setHeader( getDialogHeader() );</span>

<span class="nc" id="L146">		m_dialogMenuPC.addSubmitButton(NEW_TIMEOFF,</span>
<span class="nc" id="L147">				i18n(m_rmBundle, RmWebBundleKey.REQUEST_TYPE_TIME_OFF),</span>
<span class="nc" id="L148">				isAuthorizedToConfigureTOM(selectedOrgID));</span>
		
<span class="nc" id="L150">		m_dialogMenuPC.addSubmitButton(NEW_TIMEOFF_WITHDRAW,</span>
<span class="nc" id="L151">				i18n(m_rmBundle, RmWebBundleKey.REQUEST_TYPE_TIME_OFF_WITHDRAW),</span>
<span class="nc" id="L152">				isAuthorizedToConfigureTOM(selectedOrgID));</span>
		
			
<span class="nc" id="L155">	}</span>
	protected void addShiftRulesToDialogMenu(ID selectedOrgID, RequestContext context){
<span class="nc" id="L157">		m_dialogMenuPC.addSubmitButton(NEW_SHIFTSWAP,</span>
<span class="nc" id="L158">				i18n(m_rmBundle, RmWebBundleKey.REQUEST_TYPE_SHIFT_SWAP),</span>
<span class="nc" id="L159">				isAuthorizedToConfigureSS(selectedOrgID));</span>
		
<span class="nc bnc" id="L161" title="All 2 branches missed.">		if (LicenseUtil.isAdvancedRMLicense()){</span>
<span class="nc" id="L162">			m_dialogMenuPC.addSubmitButton(NEW_SHIFTSWAP_WITHDRAW,</span>
<span class="nc" id="L163">					i18n(m_rmBundle, RmWebBundleKey.REQUEST_TYPE_SHIFT_SWAP_WITHDRAW),</span>
<span class="nc" id="L164">					isAuthorizedToConfigureSS(selectedOrgID));</span>
		}

<span class="nc" id="L167">		m_dialogMenuPC.addSubmitButton(NEW_SHIFTBID,</span>
<span class="nc" id="L168">				i18n(m_rmBundle, RmWebBundleKey.REQUEST_TYPE_SHIFT_BIDDING),</span>
<span class="nc" id="L169">				isAuthorizedToConfigureSB(selectedOrgID));</span>
		
<span class="nc" id="L171">		m_dialogMenuPC.addSubmitButton(NEW_CUSTOMSHIFT,</span>
<span class="nc" id="L172">				i18n(m_rmBundle, RmWebBundleKey.REQUEST_TYPE_CUSTOM_SHIFT),</span>
<span class="nc" id="L173">				isAuthorizedToConfigureSC(selectedOrgID));</span>
		
<span class="nc" id="L175">	}</span>
	protected void addFlexTimeToDialogMenu(ID selectedOrgID, RequestContext context){
<span class="nc" id="L177">		m_dialogMenuPC.addSubmitButton(NEW_FLEXTIME,</span>
<span class="nc" id="L178">				i18n(m_rmBundle, RmWebBundleKey.REQUEST_TYPE_FLEX_TIME),</span>
<span class="nc" id="L179">				isAuthorizedToConfigureFT(selectedOrgID));	</span>
<span class="nc" id="L180">	}</span>
	protected void initDialog(RequestContext context) {
<span class="nc" id="L182">		ID selectedOrgID = getSelectedIDObject();</span>
<span class="nc" id="L183">		initDialogMenuAndAddTimeOffRules(selectedOrgID,context);</span>
<span class="nc" id="L184">		addShiftRulesToDialogMenu(selectedOrgID,context);</span>
<span class="nc" id="L185">		addGenericHTML(m_dialogMenuPC.getHtmlDisplay());</span>
<span class="nc" id="L186">	}</span>

	public void setAppliedRuleIds(String[] ids) {
<span class="nc" id="L189">		m_appliedRuleIds = ids;</span>
<span class="nc" id="L190">	}</span>

	public String[] getAppliedRuleIds() {
<span class="nc" id="L193">		return m_appliedRuleIds;</span>
	}

	public void setTotalRuleIds(String[] ids) {
<span class="nc" id="L197">		m_totalRuleIds = ids;</span>
<span class="nc" id="L198">	}</span>

	public String[] getTotalRuleIds() {
<span class="nc" id="L201">		return m_totalRuleIds;</span>
	}

	@Override
	protected boolean isAuthorizedToConfigure() {
<span class="nc" id="L206">		return isAuthorizedToConfigure(getSelectedIDObject());</span>
	}

	/**
	 * Return true if Current User is authorized to configure specified Organization
	 */
	@Override
	protected boolean isAuthorizedToConfigure(ID orgID) {
<span class="nc bnc" id="L214" title="All 2 branches missed.">		return isAuthorizedToConfigureTOM(orgID) ||</span>
<span class="nc bnc" id="L215" title="All 2 branches missed.">			isAuthorizedToConfigureFT(orgID) ||</span>
<span class="nc bnc" id="L216" title="All 2 branches missed.">			isAuthorizedToConfigureSS(orgID) ||</span>
<span class="nc bnc" id="L217" title="All 2 branches missed.">			isAuthorizedToConfigureSB(orgID) ||</span>
<span class="nc bnc" id="L218" title="All 2 branches missed.">			isAuthorizedToConfigureSC(orgID);</span>
	}

	protected boolean isAuthorizedToConfigureTOM(ID orgID) {
<span class="nc" id="L222">		return m_context.getUser().isAuthorized(m_privID_TOM,</span>
<span class="nc" id="L223">				OrganizationScopeManagerProxy.getScopeID(orgID));</span>
	}
	
	protected boolean isAuthorizedToConfigureFT(ID orgID) {
<span class="nc" id="L227">		return m_context.getUser().isAuthorized(m_privID_FT,</span>
<span class="nc" id="L228">				OrganizationScopeManagerProxy.getScopeID(orgID));</span>
	}

	protected boolean isAuthorizedToConfigureSS(ID orgID) {
<span class="nc" id="L232">		return m_context.getUser().isAuthorized(m_privID_SS,</span>
<span class="nc" id="L233">				OrganizationScopeManagerProxy.getScopeID(orgID));</span>
	}

	protected boolean isAuthorizedToConfigureSB(ID orgID) {
<span class="nc" id="L237">		return m_context.getUser().isAuthorized(m_privID_SB,</span>
<span class="nc" id="L238">				OrganizationScopeManagerProxy.getScopeID(orgID));</span>
	}
	
	protected boolean isAuthorizedToConfigureSC(ID orgID) {
<span class="nc" id="L242">		return m_context.getUser().isAuthorized(m_privID_SC,</span>
<span class="nc" id="L243">				OrganizationScopeManagerProxy.getScopeID(orgID));</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>