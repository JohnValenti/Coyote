<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>TimeOffAgentsInfoPopupPM.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.rm.requests.timeoff</a> &gt; <span class="el_source">TimeOffAgentsInfoPopupPM.java</span></div><h1>TimeOffAgentsInfoPopupPM.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.rm.requests.timeoff;

import java.util.ArrayList;
import java.util.Collection;
import java.util.Collections;
import java.util.Date;
import java.util.Iterator;
import java.util.ResourceBundle;
import java.util.TimeZone;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.l10n.RegionalFormatBundleKey;
import com.bluepumpkin.common.util.StringUtil;
import com.bluepumpkin.ejb.bbm.timeoffcalculator.TOCalcUtil;
import com.bluepumpkin.ejb.bbm.workresource.model.EmployeeName;
import com.bluepumpkin.ejb.bbm.workresource.model.Organization;
import com.bluepumpkin.web.bbm.organization.OrganizationModelHandler;
import com.bluepumpkin.web.rm.keys.RmKeys;
import com.bluepumpkin.web.rm.l10n.RmWebBundleKey;
import com.witness.web.uif.base.Message;
import com.witness.web.uif.keys.JavaScriptFileID;
import com.witness.web.uif.keys.PageAction;
import com.witness.web.uif.l10n.UIFWebBundleKey;
import com.witness.web.uif.pagecomponent.DefaultMultiColumnNodeData;
import com.witness.web.uif.pagecomponent.list.MultiColListPC;
import com.witness.web.uif.pagecomponent.table.TableHeaderPC;
import com.witness.web.uif.pagecomponent.toolbar.ToolbarPC;
import com.witness.web.uif.pagecomponent.utilitypane.UtilityPane;
import com.witness.web.uif.pagemodel.ContainersInRowsPM;
import com.witness.web.uif.pagemodel.PageModel;
import com.witness.web.uif.pagemodel.PopupWindowPM;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.system.manager.impl.DefaultVerticalizationManager;
import com.witness.web.uif.util.ContainerList;
import com.witness.web.uif.util.js.JSUtil;

/**
 * Title:		     TimeOffAgentsInfoPopupPM
 * Description:  Display Agents Name for specified Time Off Info and Day
 * Copyright:    Copyright (c) 2002
 * Company:      Blue Pumpkin Software, inc
 *
 * @author David Su
 * @version 1.0
 */
public class TimeOffAgentsInfoPopupPM extends PopupWindowPM
        implements ContainersInRowsPM {
	private final ResourceBundle m_bundle;
	private final ContainerList m_containerList;
<span class="nc" id="L50">	private Collection m_empNameList = Collections.EMPTY_LIST;</span>
	private ID m_orgID;
	private ID m_poolID;
	private Date m_date;
	private boolean m_isParentView;
	private boolean m_isAgentCal;
<span class="nc" id="L56">	private String m_hourType = RmKeys.HOURS_PENDING_TYPE;</span>
	private TimeZone m_tz;

	private final MultiColListPC m_listPC;

	/**
	 * Constructor
	 */
	public TimeOffAgentsInfoPopupPM(RequestContext context) {
<span class="nc" id="L65">		super(context);</span>

<span class="nc" id="L67">		m_bundle = m_localizer.getBundle(RmWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L68">		m_containerList = new ContainerList(this, 1);</span>

		// Add toolbar
<span class="nc" id="L71">		m_toolbar = new ToolbarPC(context, getName() + &quot;_toolbar&quot;);</span>
<span class="nc" id="L72">		addChildComponent(m_toolbar);</span>

		// Add list
<span class="nc" id="L75">		m_listPC = new MultiColListPC(context);</span>
<span class="nc" id="L76">		m_containerList.add(m_listPC);</span>

		// Component specific required JavaScript Files
<span class="nc" id="L79">		addRequiredJavaScriptFile(JavaScriptFileID.MEDIATOR_WORKPANE);</span>
<span class="nc" id="L80">		setJSMediator(JavaScriptFileID.MEDIATOR_WORKPANE_GENERIC);</span>
<span class="nc" id="L81">		setName(JSUtil.WORKPANE_MEDIATOR);</span>
<span class="nc" id="L82">	}</span>
	
	/**
	 * Return instance of Model which is ready to be rendered
	 */
	public static PageModel getInstance(RequestContext context) {
<span class="nc" id="L88">		return getInstance(context, TimeOffAgentsInfoPopupPM.class);</span>
	}

	/**
	 * Ensure the model is populated
	 */
	@Override
	protected void initializeModel()
	{
<span class="nc bnc" id="L97" title="All 2 branches missed.">		if (m_isInitialized) </span>
<span class="nc" id="L98">			return; </span>
		else 
<span class="nc" id="L100">			m_isInitialized = true;</span>
		
		try 
		{
			//QA45178: Silk 80391
<span class="nc" id="L105">			Organization org = OrganizationModelHandler.getOrganization(m_context, m_orgID);</span>
<span class="nc" id="L106">			m_tz = org.getTimeZone();</span>
<span class="nc" id="L107">			m_date = TOCalcUtil.getDateForOrgDayStart(org, m_date);</span>
<span class="nc bnc" id="L108" title="All 2 branches missed.">			ID managerID = (m_context.getUser()==null) ? null : m_context.getUser().getEmployeeID();</span>
<span class="nc" id="L109">			m_empNameList = TimeOffRequestsMH.getEmpNamesForTOHour(managerID, m_orgID, m_poolID, m_date, m_hourType);</span>
		} 
<span class="nc" id="L111">		catch (Exception ex) </span>
		{
<span class="nc" id="L113">			handleUnableToLoadDataError(log, ex);</span>
		} 
		finally 
		{
<span class="nc" id="L117">			initContentTitle();</span>
<span class="nc" id="L118">			initList();</span>
<span class="nc" id="L119">			initToolbar();</span>
<span class="nc" id="L120">		}</span>
<span class="nc" id="L121">	}</span>

	/**
	 * Initialize For Display
	 */
	@Override
	public void initForDisplay() 
	{
<span class="nc bnc" id="L129" title="All 2 branches missed.">		if (m_isInitializedForDisplay)</span>
		{
<span class="nc" id="L131">			return;</span>
		}
		else 
		{
<span class="nc" id="L135">			super.initForDisplay();</span>

<span class="nc" id="L137">			String[] args = new String[1];</span>
<span class="nc" id="L138">			args[0] = m_context.getSystemManagerFactory()</span>
<span class="nc" id="L139">			        .getVerticalizationManager().getVerticalizedString(m_context, DefaultVerticalizationManager.WORKERSSMALL);</span>


			//add message if coming from PARENT_ORG_VIEW
<span class="nc bnc" id="L143" title="All 4 branches missed.">			if (m_isParentView || m_isAgentCal)</span>
<span class="nc" id="L144">				addPageMessage(Message.INFO_TYPE, RmWebBundleKey.AGENTS_SCHED_TO_NAMES, RmWebBundleKey.BUNDLE_NAME, args);</span>
		}
<span class="nc" id="L146">	}</span>

	/**
	 * Return localized Date
	 */
	private String localizeDate(Date date) {
<span class="nc bnc" id="L152" title="All 2 branches missed.">		if (date == null) return &quot;&quot;;</span>
		//QA45178: Silk 80391
		//TimeZone tz = m_context.getViewingTimeZone();
<span class="nc" id="L155">		return m_localizer.formatDate(date, m_tz, RegionalFormatBundleKey.DATE_FORMAT);</span>
	}

	//override base class;  buttons: back, forward, refresh, print, preferences, help, logout, close
	@Override
	protected void initUtilityPane() {
<span class="nc" id="L161">		UtilityPane pane = this.getUtilityPane();</span>
<span class="nc bnc" id="L162" title="All 2 branches missed.">		if (pane != null) {</span>
<span class="nc" id="L163">			pane.setIsRefreshEnabled(false);</span>
<span class="nc" id="L164">			pane.setIsHelpEnabled(false);</span>
		}
<span class="nc" id="L166">	}</span>

	/**
	 * Prepare content title for rendering
	 */
	protected void initContentTitle() {
		//String pageTitle = i18n(m_bundle, RmWebBundleKey.TIMEOFF_AGENTS);
		
		
<span class="nc" id="L175">		String pageTitle = m_context.getSystemManagerFactory()</span>
<span class="nc" id="L176">		        .getVerticalizationManager()</span>
<span class="nc" id="L177">		        .getVerticalizedString(m_context, DefaultVerticalizationManager.WORKERS);</span>

<span class="nc bnc" id="L179" title="All 2 branches missed.">		String hourTypeRKey = RmKeys.HOURS_PENDING_TYPE.equals(m_hourType)</span>
		        ? RmWebBundleKey.TIMEOFF_HOURS_PENDING
		        : RmWebBundleKey.TIMEOFF_SCHEDULED_TO;

<span class="nc" id="L183">		String itemName = i18n(m_bundle, hourTypeRKey) + &quot; - &quot; + localizeDate(m_date);</span>

<span class="nc" id="L185">		m_contentTitlePC.setPageTitle(pageTitle);</span>
<span class="nc" id="L186">		m_contentTitlePC.setItemName(itemName);</span>
<span class="nc" id="L187">	}</span>


	/**
	 * Initialize List
	 */
	private void initList() {
<span class="nc" id="L194">		TableHeaderPC header = m_listPC.getHeader();</span>
<span class="nc" id="L195">		header.addColumnHeaderData(&quot;Agent Name&quot;, i18n(m_common_bundle, UIFWebBundleKey.NAME));</span>

<span class="nc" id="L197">		m_listPC.setEnabled(false);</span>
<span class="nc" id="L198">		m_listPC.setIsBorderEnabled(true);</span>

<span class="nc bnc" id="L200" title="All 2 branches missed.">		if (!m_empNameList.isEmpty()) {</span>
<span class="nc" id="L201">			ArrayList listModel = new ArrayList(m_empNameList.size());</span>
<span class="nc bnc" id="L202" title="All 2 branches missed.">			for (Iterator it = m_empNameList.iterator(); it.hasNext();) {</span>
<span class="nc" id="L203">				EmployeeName eName = (EmployeeName) it.next();</span>

<span class="nc" id="L205">				DefaultMultiColumnNodeData node = new DefaultMultiColumnNodeData();</span>
<span class="nc" id="L206">				node.add(m_localizer.formatName(eName));</span>
<span class="nc" id="L207">				listModel.add(node);</span>
<span class="nc" id="L208">			}</span>
<span class="nc" id="L209">			m_listPC.setListModel(listModel);</span>
		}
<span class="nc" id="L211">	}</span>

	/**
	 * Prepare toolbar for rendering
	 */
	@Override
	protected void initToolbar() {
<span class="nc" id="L218">		m_toolbar.addCloseWindowTextButton(PageAction.CANCEL,</span>
<span class="nc" id="L219">		        i18n(m_common_bundle, UIFWebBundleKey.TOOLBAR_CLOSE),</span>
		        true);
<span class="nc" id="L221">	}</span>

	/**
	 * Set Organization ID
	 */
	public void setOrgID(String id) {
<span class="nc bnc" id="L227" title="All 2 branches missed.">		if (!StringUtil.isEmpty(id)) </span>
<span class="nc" id="L228">			m_orgID = new ID(id);</span>
<span class="nc" id="L229">	}</span>

	/**
	 * Set TOPool ID
	 */
	public void setPoolID(String id) {
<span class="nc bnc" id="L235" title="All 2 branches missed.">		if (!StringUtil.isEmpty(id))</span>
<span class="nc" id="L236">			m_poolID = new ID(id);</span>
<span class="nc" id="L237">	}</span>

	/**
	 * Set Date as Time
	 */
	public void setDate(long time) {
<span class="nc" id="L243">		m_date = new Date(time);</span>
<span class="nc" id="L244">	}</span>

	/**
	 * Set Hour Type
	 */
	public void setHourType(String type) {
<span class="nc" id="L250">		m_hourType = type;</span>
<span class="nc" id="L251">	}</span>

	/**
	 * Set isParentView
	 */
	public void setParentView(String parentView) {
<span class="nc" id="L257">		m_isParentView = new Boolean(parentView).booleanValue();</span>
<span class="nc" id="L258">	}</span>

	/**
	 * Set isAgentCal
	 */
	public void setAgentCal(String agentCal) {
<span class="nc" id="L264">		m_isAgentCal = new Boolean(agentCal).booleanValue();</span>
<span class="nc" id="L265">	}</span>

	/**
	 * Return List of Containers
	 * &lt;p/&gt;
	 * NOTE: Items in the Collection will be treated either as Page Components or
	 * just a basic Object.
	 */
	@Override
	public Collection getContainers() {
<span class="nc" id="L275">		return m_containerList;</span>
	}

	/**
	 * Return URL for HTML Form Action
	 */
	@Override
	public String getFormAction() {
<span class="nc" id="L283">		return RmKeys.RH_TIMEOFF_AGENTS_INFO;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>