<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>OrganizationConfigManagerEJB.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.ejb.rm.setup.settings.ejb</a> &gt; <span class="el_source">OrganizationConfigManagerEJB.java</span></div><h1>OrganizationConfigManagerEJB.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.ejb.rm.setup.settings.ejb;

import java.util.*;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.logging.Category;
import com.bluepumpkin.common.cache.CacheFactory;
import com.bluepumpkin.common.cache.Cache;
import com.bluepumpkin.ejb.bbm.base.BbmCreateException;
import com.bluepumpkin.ejb.bbm.base.BbmFinderException;
import com.bluepumpkin.ejb.bbm.base.BbmUpdateException;
import com.bluepumpkin.ejb.bbm.config.ConfigCacheUtil;
import com.bluepumpkin.ejb.bbm.config.ConfigKey;
import com.bluepumpkin.ejb.bbm.BbmManagerFactory;
import com.bluepumpkin.ejb.bbm.workresource.model.Organization;
import com.bluepumpkin.ejb.core.base.SessionEJBBase; //OUTSIDE_CONTAINER
import com.bluepumpkin.ejb.rm.Log;
import com.bluepumpkin.ejb.rm.RmManagerFactory;
import com.bluepumpkin.ejb.rm.util.RmUtil;
import com.bluepumpkin.ejb.rm.l10n.RmSettingKey;
import com.bluepumpkin.ejb.rm.requests.common.ejb.RequestUtil;
import com.bluepumpkin.ejb.rm.setup.settings.model.OrganizationSetting;
import com.bluepumpkin.ejb.bbm.activity.model.Activity;
import com.bluepumpkin.ejb.bbm.base.BbmRemoveException;
import com.bluepumpkin.ejb.rm.requests.timeoff.hoursperday.ejb.TimeOffHoursManagerBridgeImpl;

/**
 * Title:        OrganizationConfigManagerEJB
 * Description:  EJB for OrganizationConfig
 * Copyright:    Copyright (c) 2002
 * Company:      Blue Pumpkin Software, Inc.
 *
 * @author Sameet Joshi rewritten in Nov 2010 ; Shailendra Sharma
 * @version 1.0
 */
<span class="nc" id="L36">public class OrganizationConfigManagerEJB extends SessionEJBBase { //OUTSIDE_CONTAINER</span>

<span class="nc" id="L38">	private static Category m_cat = Log.initCategory(OrganizationConfigManagerEJB.class.getName());</span>
<span class="nc" id="L39">	private Cache m_OrgSettingCache = null;</span>
<span class="nc" id="L40">	private boolean lastCheckStatus = true;</span>

	/**
	 * Override the base class to provide the appropriate logging category
	 */
	@Override
	protected Category getCategory() {
<span class="nc" id="L47">		return m_cat;</span>
	}

	private void initCache() throws BbmFinderException {
<span class="nc" id="L51">		Boolean init = (Boolean) m_OrgSettingCache.get(&quot;INITIALIZED&quot;);</span>
<span class="nc bnc" id="L52" title="All 4 branches missed.">		if (init != null &amp;&amp; init.booleanValue()) {</span>
<span class="nc" id="L53">			return;</span>
		}
		// initialize the cache, load all Org Settings
		try {
<span class="nc" id="L57">			refreshCache(Organization.ROOT_ORG_ID_OBJ);</span>
<span class="nc" id="L58">			m_OrgSettingCache.put(&quot;INITIALIZED&quot;, Boolean.TRUE);</span>
<span class="nc" id="L59">		} catch (Exception e) {</span>
<span class="nc" id="L60">			m_cat.error(e);</span>
<span class="nc" id="L61">			m_OrgSettingCache.remove(&quot;INITIALIZED&quot;);</span>
<span class="nc" id="L62">			throw new BbmFinderException();</span>
<span class="nc" id="L63">		}</span>
<span class="nc" id="L64">	}</span>

	private void refreshCache(ID orgIDToRefresh) throws BbmFinderException {

<span class="nc" id="L68">		Set orgIDSet = new HashSet();</span>
<span class="nc" id="L69">		orgIDSet.add(orgIDToRefresh);</span>
<span class="nc" id="L70">		long startTime = System.currentTimeMillis();</span>
<span class="nc" id="L71">		ID orgID = null;</span>
		try {
			//orgIDSet.addAll(BbmManagerFactory.getWorkResourceManager().getOrganizationsChildrenByIDs(Collections.singleton(orgIDToRefresh)));
<span class="nc bnc" id="L74" title="All 2 branches missed.">			for (Iterator iterator = orgIDSet.iterator(); iterator.hasNext();) {</span>
<span class="nc" id="L75">				orgID = (ID) iterator.next();</span>
<span class="nc" id="L76">				HashMap ancestorMap = new HashMap();</span>
<span class="nc" id="L77">				HashMap&lt;String, ID&gt; ancestorIDsMap = new HashMap&lt;String, ID&gt;();</span>
<span class="nc" id="L78">				Map propertyMap = getPropertyList(orgID, getSettingProperties(), ancestorMap, ancestorIDsMap, false);</span>
<span class="nc" id="L79">				OrganizationSetting orgSetting = new OrganizationSetting(propertyMap, orgID.toString());</span>
<span class="nc" id="L80">				orgSetting.setAncestors(ancestorMap);</span>
<span class="nc" id="L81">				orgSetting.setAncestorIDs(ancestorIDsMap);</span>
<span class="nc" id="L82">				m_OrgSettingCache.put(orgID, orgSetting);</span>
<span class="nc" id="L83">			}</span>
<span class="nc" id="L84">		} catch (Exception e) {</span>
<span class="nc" id="L85">			m_cat.info(&quot;Caught Exception  orgID= &quot; + orgID);</span>
<span class="nc" id="L86">			handleException(e);</span>
<span class="nc" id="L87">			throw RequestUtil.createBbmFinderExceptionWrapper(e, m_cat);</span>
		} finally {
<span class="nc" id="L89">			m_cat.info(&quot;OrganizationSetting refreshCache  TIME=&quot; + (System.currentTimeMillis() - startTime) + &quot; msecs :orgIDSet=&quot; + RmUtil.dumpCommaSeparated(orgIDSet));</span>
<span class="nc" id="L90">		}</span>
<span class="nc" id="L91">	}</span>

	@SuppressWarnings(&quot;unchecked&quot;)
	private void clearCache(Collection&lt;ID&gt; orgIDsToRefresh) throws BbmFinderException {
<span class="nc" id="L95">		Set&lt;ID&gt; orgIDSet = new HashSet&lt;ID&gt;();</span>
<span class="nc" id="L96">		orgIDSet.addAll(orgIDsToRefresh);</span>
<span class="nc" id="L97">		long startTime = System.currentTimeMillis();</span>
<span class="nc" id="L98">		ID orgID = null;</span>
		try {
<span class="nc" id="L100">			orgIDSet.addAll(BbmManagerFactory.getWorkResourceManager().getOrganizationsChildrenByIDs(orgIDsToRefresh));</span>
<span class="nc bnc" id="L101" title="All 2 branches missed.">			for (Iterator&lt;ID&gt; iterator = orgIDSet.iterator(); iterator.hasNext();) {</span>
<span class="nc" id="L102">				orgID = iterator.next();</span>
<span class="nc" id="L103">				m_OrgSettingCache.remove(orgID);</span>
			}
<span class="nc" id="L105">		} catch (Exception e) {</span>
<span class="nc" id="L106">			m_cat.info(&quot;Caught Exception  orgID= &quot; + orgID);</span>
<span class="nc" id="L107">			handleException(e);</span>
<span class="nc" id="L108">			throw RequestUtil.createBbmFinderExceptionWrapper(e, m_cat);</span>
		} finally {
<span class="nc" id="L110">			m_cat.info(&quot;OrganizationSetting clearCache  TIME=&quot; + (System.currentTimeMillis() - startTime) + &quot; msecs :orgIDSet=&quot; + RmUtil.dumpCommaSeparated(orgIDSet));</span>
<span class="nc" id="L111">		}</span>
<span class="nc" id="L112">	}</span>

	private boolean cacheUsed() {
		// If Cache is null, then cache is not used
<span class="nc" id="L116">		boolean currentStatus = false;</span>
		try {
			// If cache is never instantiated, give it a chance to get initialized
			// If ConfigManager is cache aware, then always check it dynamically
<span class="nc bnc" id="L120" title="All 4 branches missed.">			if (m_OrgSettingCache == null || BbmManagerFactory.getDBConfigManager().cacheUsed()) {</span>
				// Access ConfigManager for the cache setting
<span class="nc bnc" id="L122" title="All 2 branches missed.">				if (ConfigCacheUtil.isCacheEnabled(BbmManagerFactory.getDBConfigManager(), ConfigKey.ORGANIZATIONSETTING_CACHE_USAGE)) {</span>
					// If Cache is null, initialize it
<span class="nc bnc" id="L124" title="All 2 branches missed.">					if (m_OrgSettingCache == null) {</span>
<span class="nc" id="L125">						m_OrgSettingCache = CacheFactory.getCache(RmManagerFactory.RM_ORGANIZATIONCONFIGMANAGER_EJBHOME, OrganizationConfigManagerEJB.class.getClassLoader());</span>
					}
<span class="nc" id="L127">					currentStatus = true;</span>
				} else {
<span class="nc" id="L129">					currentStatus = false;</span>
				}
			} else {
				// Or if m_TimeRecordCache is available, we think cache is enabled
<span class="nc bnc" id="L133" title="All 2 branches missed.">				currentStatus = (m_OrgSettingCache != null);</span>
			}
<span class="nc" id="L135">		} catch (Exception e) {</span>
<span class="nc" id="L136">			currentStatus = false;</span>
<span class="nc" id="L137">		}</span>
		// If there is state transition, we need flush cache content
<span class="nc bnc" id="L139" title="All 2 branches missed.">		if (lastCheckStatus != currentStatus) {</span>
			// If from Cache turn on to off, or vice versa, we will flush cache content
<span class="nc bnc" id="L141" title="All 2 branches missed.">			if (m_OrgSettingCache != null) {</span>
<span class="nc" id="L142">				m_OrgSettingCache.clear();</span>
				try {
					// if cache enabled, preload content
<span class="nc bnc" id="L145" title="All 2 branches missed.">					if (currentStatus) {</span>
<span class="nc" id="L146">						initCache();</span>
					}
<span class="nc" id="L148">				} catch (Exception e) {</span>
<span class="nc" id="L149">					m_cat.error(e.getMessage());</span>
<span class="nc" id="L150">				}</span>
			}
<span class="nc" id="L152">			lastCheckStatus = currentStatus;</span>
		}
<span class="nc" id="L154">		return currentStatus;</span>
	}

	{
<span class="nc" id="L158">		super.init(OrganizationConfigManagerEJB.class.getName());</span>
<span class="nc" id="L159">	}</span>

	/**
	 * Returns a Value Object that contains settings of the
	 * OrganizationId passed as argument. We get &quot;deep&quot; settings,
	 * meaning that the inheritted settings are also returned.
	 *
	 * @param orgId - Organisation ID object.
	 * @return OrganizationSetting Returns a value object that contains
	 *         settings of the requested organization.
	 * @throws BbmFinderException if there is a database error
	 */
	public OrganizationSetting getConfiguration(ID orgId) throws BbmFinderException {
<span class="nc" id="L172">		final String l_MethodName = &quot;getConfiguration&quot;;</span>
<span class="nc" id="L173">		methodStart(l_MethodName, orgId);</span>
		try {

<span class="nc bnc" id="L176" title="All 2 branches missed.">			if (cacheUsed()) {</span>
<span class="nc" id="L177">				initCache();</span>
<span class="nc" id="L178">				OrganizationSetting orgSetting = (OrganizationSetting) m_OrgSettingCache.get(orgId);</span>
<span class="nc bnc" id="L179" title="All 2 branches missed.">				if (orgSetting == null) {</span>
<span class="nc" id="L180">					refreshCache(orgId);</span>
<span class="nc" id="L181">					orgSetting = (OrganizationSetting) m_OrgSettingCache.get(orgId);</span>
				}
<span class="nc bnc" id="L183" title="All 2 branches missed.">				if (orgSetting != null) {</span>
<span class="nc" id="L184">					return orgSetting;</span>
				}
<span class="nc" id="L186">				m_cat.info(&quot;Failed to find OrganizationSetting for ID=&quot; + orgId + &quot; in the cache.&quot;);</span>
			}

<span class="nc" id="L189">			HashMap ancestorMap = new HashMap();</span>
<span class="nc" id="L190">			HashMap&lt;String, ID&gt; ancestorIDsMap = new HashMap&lt;String, ID&gt;();</span>
<span class="nc" id="L191">			Map propertyMap = getPropertyList(orgId, getSettingProperties(), ancestorMap, ancestorIDsMap, false);</span>
<span class="nc" id="L192">			OrganizationSetting orgSetting = new OrganizationSetting(propertyMap, orgId.toString());</span>
<span class="nc" id="L193">			orgSetting.setAncestors(ancestorMap);</span>
<span class="nc" id="L194">			orgSetting.setAncestorIDs(ancestorIDsMap);</span>
<span class="nc" id="L195">			return orgSetting;</span>

<span class="nc" id="L197">		} catch (Exception e) {</span>
<span class="nc" id="L198">			handleException(e);</span>
<span class="nc" id="L199">			throw RequestUtil.createBbmFinderExceptionWrapper(e, m_cat);</span>
		} finally {
<span class="nc" id="L201">			methodFinish();</span>
		}
	}

	/**
	 * Sets the configuration properties for an Organization.
	 *
	 * @param orgId      -  ID for Organization.
	 * @param orgSetting - value object
	 * @param shallow    - true if you want to update only this org, false to update children too.
	 * @throws BbmCreateException if there is a database error
	 * @throws BbmUpdateException if there is a database error
	 */
	public void setConfiguration(ID orgId, OrganizationSetting orgSetting, boolean shallow)
			throws BbmCreateException, BbmUpdateException {
<span class="nc" id="L216">		final String l_MethodName = &quot;setConfiguration&quot;;</span>

<span class="nc" id="L218">		methodStart(l_MethodName, orgId, orgSetting);</span>
		try {
<span class="nc" id="L220">			setPropertyList(orgId, orgSetting.getValues(), shallow); //default was false before. For V11, we give the user the option</span>
		} finally {
<span class="nc" id="L222">			methodFinish();</span>
<span class="nc" id="L223">		}</span>
<span class="nc" id="L224">	}</span>

	/**
	 * Returns the HashMap of OrganizationConfig object for the OrganizationId
	 * and HashMap of ID for the property passed as argument.
	 *
	 * @param orgId        - Organisation ID object.
	 * @param pPropertyMap - A Map that contains PROPERTY-KEYs mapped to PROPERTY-VALUEs
	 * @param pAncestorMap - A Map that contains PROPERTY-KEYs mapped to ancestor org names
	 * @param pAncestorIDsMap - A Map that contains PROPERTY-KEYs mapped to ancestor org IDs
	 * @param shallow      - true if you want to get custom settings only for this org,
	 *                     false to get inheritted settings as well.
	 * @return We return the pPropertyMap with the mapped values. We also modify pPropertyMap
	 *         and pAncestorMap, so you can get the return values from there.
	 * @throws BbmFinderException if there is an error while executing database
	 *                            query
	 */
	private Map getPropertyList(ID orgId, Map pPropertyMap, Map pAncestorMap, Map&lt;String, ID&gt; pAncestorIDsMap, boolean shallow) throws BbmFinderException {

<span class="nc" id="L243">		final String l_MethodName = &quot;getPropertyList&quot;;</span>
<span class="nc" id="L244">		methodStart(l_MethodName, orgId, pPropertyMap);</span>

<span class="nc" id="L246">		OrganizationConfigDAO orgCfgDAO = null;</span>
		try {
<span class="nc" id="L248">			orgCfgDAO = new OrganizationConfigDAO();</span>
<span class="nc" id="L249">			orgCfgDAO.getPropertyList(orgId, pPropertyMap, pAncestorMap, pAncestorIDsMap, shallow);</span>

<span class="nc" id="L251">		} catch (Exception e) {</span>
<span class="nc" id="L252">			handleException(e);</span>
<span class="nc" id="L253">			throw RequestUtil.createBbmFinderExceptionWrapper(e, m_cat);</span>
		} finally {
<span class="nc bnc" id="L255" title="All 4 branches missed.">			if (orgCfgDAO != null) {</span>
<span class="nc" id="L256">				orgCfgDAO.cleanUp();</span>
			}
<span class="nc" id="L258">			methodFinish();</span>
<span class="nc" id="L259">		}</span>
<span class="nc" id="L260">		return pPropertyMap;</span>
	}

	/**
	 * Set the property list for an Organization. The method will split
	 * the propertyMap into a set of properties to update and a set to
	 * insert. The value of the properties are copied to all children if
	 * shallow==false. This will overwrite the values of the children.
	 *
	 * @param pOrgId                 -  ID for OrganizationConfig object.
	 * @param pOrgConfigPropertyList - HashMap contains PROPERTY-KEY and PROPERTY-VALUE
	 * @param shallow                - true if you want to update only this org, false to update children too.
	 * @throws BbmCreateException if there is an error while executing database query
	 * @throws BbmUpdateException if there is an error while executing database query
	 * @throws BbmRemoveException if there is an error while executing database query
	 */
	private void setPropertyList(ID pOrgId, Map pOrgConfigPropertyList, boolean shallow) throws BbmUpdateException {

<span class="nc" id="L278">		final String l_MethodName = &quot;setPropertyList&quot;;</span>
<span class="nc" id="L279">		methodStart(l_MethodName, pOrgId, pOrgConfigPropertyList);</span>
<span class="nc" id="L280">		OrganizationConfigDAO dao = new OrganizationConfigDAO();</span>
		try {
<span class="nc" id="L282">			dao.setPropertyList(pOrgId, pOrgConfigPropertyList, shallow);</span>
<span class="nc bnc" id="L283" title="All 2 branches missed.">			if (!shallow) {</span>
<span class="nc" id="L284">				dao.deleteAllPropertiesFromChildren(pOrgId);</span>
			}
			//always refresh OrgSetting for passed org and all its children. irrespective of the shallow flag
<span class="nc bnc" id="L287" title="All 2 branches missed.">			if (cacheUsed()) {</span>
<span class="nc" id="L288">				clearCache(Arrays.asList(pOrgId));</span>
			}
<span class="nc" id="L290">		} catch (Exception e) {</span>
<span class="nc" id="L291">			handleException(e);</span>
<span class="nc" id="L292">			throw RequestUtil.createBbmUpdateExceptionWrapper(e, m_cat);</span>
		} finally {
<span class="nc" id="L294">			methodFinish();</span>
<span class="nc" id="L295">			dao.cleanUp();</span>
<span class="nc" id="L296">		}</span>
<span class="nc" id="L297">	}</span>


	/**
	 * Get Map of all possible settings
	 */
	private static Map&lt;String, Object&gt; getSettingProperties() {
<span class="nc" id="L304">		Map&lt;String, Object&gt; lHashMap = new HashMap&lt;String, Object&gt;();</span>

<span class="nc" id="L306">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_PROCESS_VACATION_REQUEST, &quot;true&quot;);</span>
<span class="nc" id="L307">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_REQUEST_VACATION, &quot;true&quot;);</span>
<span class="nc" id="L308">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_TIME_OFF_CHOICES_COUNT, &quot;1&quot;);</span>
<span class="nc" id="L309">		lHashMap.put(RmSettingKey.ORG_RM_TIME_OFF_TIME_INTERVAL, &quot;15&quot;);</span>


<span class="nc" id="L312">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_ALLOW_ESCALATION, &quot;true&quot;);</span>
<span class="nc" id="L313">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_SHOW_AUTOPROCESSING_RULES, &quot;true&quot;);</span>
<span class="nc" id="L314">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_SHOW_SCHEDULED_TIMEOFF, &quot;true&quot;);</span>
<span class="nc" id="L315">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_SHOW_PENDING_TIMEOFF, &quot;true&quot;);</span>

<span class="nc" id="L317">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_ANIVERSARY_DATE, &quot;true&quot;);</span>

<span class="nc" id="L319">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_FIXED_DATE_MONTH, &quot;0&quot;);</span>
<span class="nc" id="L320">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_FIXED_DATE_DAY, &quot;1&quot;);</span>

<span class="nc" id="L322">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_ACCRUAL_DAY_OF_MONTH, &quot;1&quot;);</span>
<span class="nc" id="L323">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_ACCRUAL_DAY_OF_WEEK, &quot;1&quot;);</span>


<span class="nc" id="L326">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_TO_AVAILABLE_COLOR, &quot;63C584&quot;);</span>
<span class="nc" id="L327">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_TO_WORKING_COLOR, &quot;FBC44D&quot;);</span>
<span class="nc" id="L328">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_TO_PENDING_COLOR, &quot;C4FB4D&quot;);</span>
<span class="nc" id="L329">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_TO_SCHEDULED_COLOR, &quot;C44DFB&quot;);</span>
<span class="nc" id="L330">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_TO_NO_AVAILABLE_COLOR, &quot;BCEFFA&quot;);</span>
<span class="nc" id="L331">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_TO_NON_OPERATION_COLOR, &quot;FFE4E1&quot;);</span>
<span class="nc" id="L332">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_TO_BLACKOUT_COLOR, &quot;FD3B3B&quot;);</span>
<span class="nc" id="L333">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_TO_NON_WORKING_COLOR, &quot;8CA8E2&quot;);</span>

<span class="nc" id="L335">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_TO_POLICY, null);</span>
<span class="nc" id="L336">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_SS_POLICY, null);</span>
<span class="nc" id="L337">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_SB_POLICY, null);</span>
<span class="nc" id="L338">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_CS_POLICY, null);</span>
<span class="nc" id="L339">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_FT_POLICY, null);</span>

<span class="nc" id="L341">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_ENABLE_SHIFT_SWAP, &quot;true&quot;);</span>
<span class="nc" id="L342">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_DISABLE_ONE_WAY_SHIFT_SWAP, &quot;false&quot;);</span>
<span class="nc" id="L343">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_SHIFT_SWAP_ORG_LIST, &quot;&quot;);</span>
<span class="nc" id="L344">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_GROUP_VIEW_ORG_LIST, &quot;&quot;);</span>
<span class="nc" id="L345">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_ALLOW_PARTIAL_SHIFT_SWAP, &quot;false&quot;);</span>
<span class="nc" id="L346">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_ALLOW_PARTIAL_SHIFT_PICKUP, &quot;false&quot;);</span>
<span class="nc" id="L347">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_MAX_SWAP_NEGOTIATIONS, &quot;5&quot;);</span>

		// shift bidding keys
<span class="nc" id="L350">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_MAX_PREFERENCE_VALUE, &quot;1&quot;);</span>
<span class="nc" id="L351">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_MAX_BIDS_PER_EMPLOYEE, &quot;100&quot;);</span>
<span class="nc" id="L352">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_SENIORITY_FACTOR, &quot;10.0&quot;);</span>
<span class="nc" id="L353">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_RANK_FACTOR, &quot;2.0&quot;);</span>
<span class="nc" id="L354">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_BONUSPOINT_FACTOR, &quot;5.0&quot;);</span>
<span class="nc" id="L355">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_FILTER_BID_OPTIONS_BY_EMPLOYEE_TYPE, &quot;false&quot;);</span>
<span class="nc" id="L356">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_DISPLAY_TEMPLATE_DESCRIPTION, &quot;false&quot;);</span>

		// custom shift request keys
<span class="nc" id="L359">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_ENABLE_CUSTOM_SHIFT_REQUESTS, &quot;true&quot;);</span>
<span class="nc" id="L360">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_ALLOW_OT_BEFORE_SHIFT, &quot;true&quot;);</span>
<span class="nc" id="L361">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_ALLOW_OT_AFTER_SHIFT, &quot;true&quot;);</span>
<span class="nc" id="L362">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_ALLOW_ENTIRE_OT_SHIFT, &quot;true&quot;);</span>
<span class="nc" id="L363">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_ALLOW_REGULAR_EXTENSION_BEFORE_SHIFT, &quot;true&quot;);</span>
<span class="nc" id="L364">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_ALLOW_REGULAR_EXTENSION_AFTER_SHIFT, &quot;true&quot;);</span>
<span class="nc" id="L365">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_ALLOW_ENTIRE_REGULAR_SHIFT, &quot;true&quot;);</span>
<span class="nc" id="L366">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_ALLOW_SHIFT_CHANGE_REQUESTS, &quot;true&quot;);</span>
		
		

		//Special activity attribute override keys
<span class="nc bnc" id="L371" title="All 2 branches missed.">		for (int i=0; i&lt;TimeOffHoursManagerBridgeImpl.specialActivityIDs.length; i++)</span>
		{
<span class="nc" id="L373">			ID activityID = TimeOffHoursManagerBridgeImpl.specialActivityIDs[i];</span>
<span class="nc" id="L374">			lHashMap.put(Activity.getMaxDurationOverrideKey(activityID), null);</span>
<span class="nc" id="L375">			lHashMap.put(Activity.getAdherenceToleranceOverrideKey(activityID), null);</span>
		}

		//Vacation special activity override key
<span class="nc" id="L379">		lHashMap.put(Activity.ACTIVITY_VACATION.toString(), null);</span>


		//FS Org settings keys
<span class="nc" id="L383">		lHashMap.put(RmSettingKey.ORG_FS_SETTINGS_CONTACT_QUEUE_ABOVE_REQ_TOLERANCE, &quot;10&quot;);</span>
<span class="nc" id="L384">		lHashMap.put(RmSettingKey.ORG_FS_SETTINGS_CONTACT_QUEUE_BELOW_REQ_TOLERANCE, &quot;10&quot;);</span>
<span class="nc" id="L385">		lHashMap.put(RmSettingKey.ORG_FS_SETTINGS_PROJECT_QUEUE_ABOVE_REQ_TOLERANCE, &quot;10&quot;);</span>
<span class="nc" id="L386">		lHashMap.put(RmSettingKey.ORG_FS_SETTINGS_PROJECT_QUEUE_BELOW_REQ_TOLERANCE, &quot;10&quot;);</span>

		// BackOffice settings keys
<span class="nc" id="L389">		lHashMap.put(RmSettingKey.ORG_BACKOFFICE_SETTINGS_DISALLOW_VCT_DECIMAL, &quot;false&quot;);</span>

		//Flex Time keys
<span class="nc" id="L392">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_ALLOW_MAKEUP_BEFORE_SHIFT, &quot;true&quot;);</span>
<span class="nc" id="L393">		lHashMap.put(RmSettingKey.ORG_RM_SETTINGS_ALLOW_MAKEUP_AFTER_SHIFT, &quot;true&quot;);</span>
		
<span class="nc" id="L395">		return lHashMap;</span>
	}

	/**
	 * Delete all PROPERTY-KEYs specified in Map for the pParentOrgId
	 * and all it's child Organization.
	 *
	 * @param pParentOrgId - Organisation ID object.
	 * @param pPropertyMap - A Map that contains PROPERTY-KEY
	 *                  and PROPERTY-VALUE
	 * @throws BbmRemoveException if there is an error while executing database
	 *                     query
	 * @deprecated Use the {@link #deletePropertyListForOrgs} method
	 */
	@Deprecated
	@SuppressWarnings({ &quot;unchecked&quot;, &quot;rawtypes&quot; })
	public void deletePropertyList(ID orgId, Set pPropertySet) throws BbmFinderException {
<span class="nc" id="L412">		deletePropertyListForOrgs(new HashSet&lt;ID&gt;(Arrays.asList(orgId)), pPropertySet);</span>
<span class="nc" id="L413">	}</span>

	/**
	 * Delete all specified PROPERTY-KEYs belong to provided organizations
	 * and all their child organizations.
	 *
	 * @param orgIds - organizations
	 * @param pPropertySet - PROPERTY-KEYs to be deleted
	 * @throws BbmRemoveException if there is an error while executing database query
	 */
	public void deletePropertyListForOrgs(Set&lt;ID&gt; orgIds, Set&lt;String&gt; pPropertySet) throws BbmFinderException {
<span class="nc" id="L424">		methodStart(&quot;deletePropertyListForOrgs&quot;, orgIds, pPropertySet);</span>

<span class="nc" id="L426">		OrganizationConfigDAO orgCfgDAO = null;</span>
		try {
<span class="nc" id="L428">			orgCfgDAO = new OrganizationConfigDAO();</span>
<span class="nc" id="L429">			orgCfgDAO.deletePropertyList(orgIds, pPropertySet);</span>

<span class="nc bnc" id="L431" title="All 2 branches missed.">			if (cacheUsed()) {</span>
<span class="nc" id="L432">				initCache();</span>
<span class="nc" id="L433">				clearCache(orgIds);</span>
			}
<span class="nc" id="L435">		} catch (Exception e) {</span>
<span class="nc" id="L436">			handleException(e);</span>
<span class="nc" id="L437">			throw RequestUtil.createBbmFinderExceptionWrapper(e, m_cat);</span>
		} finally {
<span class="nc bnc" id="L439" title="All 4 branches missed.">			if (orgCfgDAO != null) {</span>
<span class="nc" id="L440">				orgCfgDAO.cleanUp();</span>
			}
<span class="nc" id="L442">			methodFinish();</span>
<span class="nc" id="L443">		}</span>

<span class="nc" id="L445">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>