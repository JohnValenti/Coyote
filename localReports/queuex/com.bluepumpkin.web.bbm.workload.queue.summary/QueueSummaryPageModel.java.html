<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>QueueSummaryPageModel.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.bbm.workload.queue.summary</a> &gt; <span class="el_source">QueueSummaryPageModel.java</span></div><h1>QueueSummaryPageModel.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.bbm.workload.queue.summary;

import java.text.MessageFormat;
import java.util.ArrayList;
import java.util.Collection;
import java.util.Collections;
import java.util.Iterator;
import java.util.Map;
import java.util.ResourceBundle;
import java.util.Set;

import com.bluepumpkin.common.datatypes.BasicVO;
import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.util.StringUtil;
import com.bluepumpkin.ejb.bbm.workload.model.Queue;
import com.bluepumpkin.web.bbm.l10n.BbmWebBundleKey;
import com.bluepumpkin.web.bbm.organization.setup.datasource.group.GroupMH;
import com.bluepumpkin.web.bbm.workload.WorkloadModelHandler;
import com.bluepumpkin.web.bbm.workload.queue.QueueUtil;
import com.bluepumpkin.web.bbm.workload.queue.mapping.QueueGroupMH;
import com.verint.web.wfm.keys.WfmJavaScriptFileID;
import com.witness.ejb.core.security.PrivilegeKeys;
import com.witness.web.uif.keys.PageAction;
import com.witness.web.uif.l10n.UIFWebBundleKey;
import com.witness.web.uif.pagecomponent.DefaultMultiColumnNodeData;
import com.witness.web.uif.pagecomponent.MultiColumnNodeData;
import com.witness.web.uif.pagecomponent.table.TableHeaderPC;
import com.witness.web.uif.pagemodel.BasicVOSummaryPM;
import com.witness.web.uif.pagemodel.PageModel;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.system.manager.impl.DefaultVerticalizationManager;

/**
 * Title:        QueueSummaryPageModel
 * Description:  Displays the Data Source Setup List
 * Copyright:    Copyright (c) 2003
 * Company:      Blue Pumpkin Software, Inc
 * @author       Swati Tewari, David Su.
 * @version 1.0
 */
public class QueueSummaryPageModel extends BasicVOSummaryPM {
	private static final String LIST_NAME_SORT = &quot;LIST_NAME_SORT&quot;;
	private static final String LIST_DESCRIPTION_SORT = &quot;LIST_DESCRIPTION_SORT&quot;;
	private static final String LIST_MEDIA_TITLE_SORT = &quot;LIST_MEDIA_TITLE_SORT&quot;;
	private static final String LIST_TYPE_TITLE_SORT = &quot;LIST_TYPE_TITLE_SORT&quot;;
	private static final String LIST_MAPPING_TITLE_SORT = &quot;LIST_MAPPING_TITLE_SORT&quot;;
	public static final String CAN_CONFIGURE = &quot;CAN_CONFIGURE&quot;;

<span class="nc" id="L49">	private Map m_groupNameMap = Collections.emptyMap();</span>
<span class="nc" id="L50">	private Map m_queueGroupMap = Collections.emptyMap();</span>
	private ResourceBundle m_bundle;

	/**
	 * Constructor
	 */
	public QueueSummaryPageModel(RequestContext context) {
<span class="nc" id="L57">		super(context, &quot;queue_summary&quot;);</span>
<span class="nc" id="L58">		m_bundle = m_localizer.getBundle(BbmWebBundleKey.BUNDLE_NAME);</span>

<span class="nc" id="L60">		m_selectedID = QueueUtil.getSelectedQueueID(context);</span>
<span class="nc bnc" id="L61" title="All 2 branches missed.">		if (StringUtil.isEmpty(this.getPerformActionOnID()))</span>
<span class="nc" id="L62">			this.setPerformActionOnID(m_selectedID);</span>


		// Component specific required JavaScript Files
<span class="nc" id="L66">		setJSMediator(WfmJavaScriptFileID.MEDIATOR_QUEUE_LIST_WORKPANE);</span>

		// Add JavaScript Variables
<span class="nc" id="L69">		addJSVariable(DELETE_CONFIRMATION, m_bundle, BbmWebBundleKey.QUEUE_DELETE_CONFIRM);</span>
<span class="nc" id="L70">		addJSVariableAsString(CAN_CONFIGURE, String.valueOf(isAuthorizedToConfigure()));</span>
<span class="nc" id="L71">	}</span>

	/**
	 * Return an instance of the model that is ready for rendering
	 */
	public static PageModel getInstance(RequestContext context) throws Exception {
<span class="nc" id="L77">		return getInstance(context, QueueSummaryPageModel.class);</span>
	}

	protected Collection fetchDataList() throws Exception {
<span class="nc" id="L81">		Collection dataList = WorkloadModelHandler.getAllQueues(m_context);</span>

<span class="nc" id="L83">		ArrayList queueIDsColl = new ArrayList(dataList.size());</span>
<span class="nc bnc" id="L84" title="All 2 branches missed.">		for(Iterator it = dataList.iterator(); it.hasNext();) {</span>
<span class="nc" id="L85">			Queue queue = (Queue)it.next();</span>
<span class="nc" id="L86">			queueIDsColl.add(queue.getID());</span>
<span class="nc" id="L87">		}</span>
<span class="nc" id="L88">		m_queueGroupMap = QueueGroupMH.getLinkedGroupIDsForQueues(queueIDsColl);</span>

<span class="nc bnc" id="L90" title="All 4 branches missed.">		if (m_queueGroupMap != null &amp;&amp; m_queueGroupMap.size()&gt;0){</span>
<span class="nc" id="L91">			ArrayList groupIDSet = new ArrayList();</span>
<span class="nc" id="L92">			Set keySet = m_queueGroupMap.keySet();</span>
<span class="nc bnc" id="L93" title="All 2 branches missed.">			for(Iterator it1 = keySet.iterator(); it1.hasNext();) {</span>
<span class="nc" id="L94">				ID queueID = (ID)it1.next();</span>
<span class="nc" id="L95">				ArrayList groupColl = (ArrayList)m_queueGroupMap.get(queueID);</span>
<span class="nc bnc" id="L96" title="All 4 branches missed.">				if (groupColl != null &amp;&amp; groupColl.size()&gt;0){</span>
<span class="nc bnc" id="L97" title="All 2 branches missed.">					for (int i=0;i&lt;groupColl.size();i++){</span>
<span class="nc" id="L98">						ID groupID = (ID)groupColl.get(i);</span>
<span class="nc bnc" id="L99" title="All 2 branches missed.">						if (!groupIDSet.contains(groupID))</span>
<span class="nc" id="L100">							groupIDSet.add(groupID);</span>
					}
				}
<span class="nc" id="L103">			}</span>
<span class="nc" id="L104">			m_groupNameMap = GroupMH.getGroupNamesByIDs(groupIDSet);</span>
		}

<span class="nc" id="L107">		return dataList;</span>
	}

	protected Object getRootData() {
<span class="nc" id="L111">		return QueueUtil.ROOT_OBJ;</span>
	}

	/**
	 * Initialize Content Title
	 */
	protected void initContentTitle() {
    // verticalise queue
<span class="nc" id="L119">    Object[] args = new Object[1];</span>
<span class="nc" id="L120">    args[0] = m_context.getSystemManagerFactory().getVerticalizationManager().getVerticalizedString(m_context, DefaultVerticalizationManager.QUEUESMALL);</span>

<span class="nc" id="L122">    m_contentTitlePC.setPageTitle( MessageFormat.format( i18n(m_bundle, BbmWebBundleKey.QUEUE_SUMMARY), args) );</span>
<span class="nc" id="L123">	}</span>

	/**
	 * Initialize Header
	 */
	protected void initHeader() {
		// Initialize Header
<span class="nc" id="L130">		TableHeaderPC header = m_treePC.getHeader();</span>
<span class="nc" id="L131">		header.addColumnHeaderData(LIST_NAME_SORT, i18n(m_common_bundle, UIFWebBundleKey.LIST_HEADER_NAME), true);</span>
<span class="nc" id="L132">		header.addColumnHeaderData(LIST_DESCRIPTION_SORT, i18n(m_common_bundle, UIFWebBundleKey.LIST_HEADER_DESCRIPTION), false);</span>
<span class="nc" id="L133">		header.addColumnHeaderData(LIST_MEDIA_TITLE_SORT,	i18n(m_bundle, BbmWebBundleKey.QUEUE_LABEL_MEDIA), true);</span>
<span class="nc" id="L134">		header.addColumnHeaderData(LIST_TYPE_TITLE_SORT,	i18n(m_bundle, BbmWebBundleKey.QUEUE_LABEL_TYPE), true);</span>
<span class="nc" id="L135">		header.addColumnHeaderData(LIST_MAPPING_TITLE_SORT, i18n(m_bundle, BbmWebBundleKey.BBM_ORG_WORKLOADS_GROUPS_MAPPING),false);</span>

		// Enable List Sorting
<span class="nc" id="L138">		header.setPartialSortable(true);</span>
<span class="nc" id="L139">		header.setDefaultSortColumn(LIST_NAME_SORT);</span>
<span class="nc" id="L140">	}</span>

	protected void initToolbar() {

    // verticalise queue
<span class="nc" id="L145">    Object[] args = new Object[1];</span>
<span class="nc" id="L146">    args[0] = m_context.getSystemManagerFactory().getVerticalizationManager().getVerticalizedString(m_context, DefaultVerticalizationManager.QUEUESMALL);</span>

<span class="nc" id="L148">    String addLabel = MessageFormat.format( i18n(m_bundle, BbmWebBundleKey.QUEUE_CREATE_ACTION), args);</span>
<span class="nc" id="L149">		String copyLabel = MessageFormat.format( i18n(m_bundle, BbmWebBundleKey.QUEUE_COPY_ACTION), args);</span>
<span class="nc" id="L150">		String editLabel = MessageFormat.format( i18n(m_bundle, BbmWebBundleKey.QUEUE_EDIT_ACTION), args);</span>
<span class="nc" id="L151">		String deleteLabel = MessageFormat.format( i18n(m_bundle, BbmWebBundleKey.QUEUE_DELETE_ACTION), args);</span>

<span class="nc" id="L153">		boolean isAuth = isAuthorizedToConfigure();</span>
<span class="nc" id="L154">		m_toolbar.addSubmitTextButton(PageAction.ADD, addLabel, isAuth);</span>

<span class="nc bnc" id="L156" title="All 4 branches missed.">		boolean isBtnEnabled = isAuth &amp;&amp; !StringUtil.isEmpty(this.getPerformActionOnID());</span>
<span class="nc" id="L157">		m_toolbar.addSubmitTextButton(PageAction.QUEUE_COPY_ACTION, copyLabel, isBtnEnabled);</span>
<span class="nc" id="L158">		m_toolbar.addSubmitTextButton(PageAction.EDIT, editLabel, isBtnEnabled);</span>
<span class="nc" id="L159">		m_toolbar.addDeleteTextButton(PageAction.DELETE, deleteLabel, isBtnEnabled);</span>
<span class="nc" id="L160">	}</span>

	protected boolean isAuthorizedToConfigure() {
<span class="nc" id="L163">		return isUserAuthorized(PrivilegeKeys.CORE_CONFIGUREDATASOURCES_ID);</span>
	}

	/**
	 * Set Selected ID
	 */
	public void setSelectedID(String id) {
<span class="nc" id="L170">		super.setSelectedID(id);</span>
<span class="nc" id="L171">		QueueUtil.setSelectedQueueID(m_context, id);</span>
<span class="nc" id="L172">	}</span>

	protected MultiColumnNodeData toNodeData(BasicVO object) {
<span class="nc bnc" id="L175" title="All 2 branches missed.">		if (object==null) return null;</span>

<span class="nc" id="L177">		Queue queue = (Queue)object;</span>
<span class="nc" id="L178">		DefaultMultiColumnNodeData nodeData = new DefaultMultiColumnNodeData(queue.getID());</span>
<span class="nc" id="L179">		nodeData.add( queue.getName());</span>
<span class="nc" id="L180">		nodeData.add( queue.getDescription() );</span>
<span class="nc" id="L181">		nodeData.add( queue.getMediaName() );</span>
<span class="nc" id="L182">		nodeData.add( getQueueTypeName(queue.getQueueType()) );</span>
<span class="nc" id="L183">		nodeData.add( getMappingsStr(queue.getID()) );</span>

<span class="nc" id="L185">		return nodeData;</span>
	}

	private String getQueueTypeName(int type)
	{
<span class="nc bnc" id="L190" title="All 5 branches missed.">		switch ( type )</span>
		{
			case Queue.QUEUE_TYPE_NORMAL:
<span class="nc" id="L193">			    return m_localizer.i18n(BbmWebBundleKey.BUNDLE_NAME, BbmWebBundleKey.QUEUE_TYPE_NORMAL);</span>
			case Queue.QUEUE_TYPE_VIRTUAL:
<span class="nc" id="L195">			    return m_localizer.i18n(BbmWebBundleKey.BUNDLE_NAME, BbmWebBundleKey.QUEUE_TYPE_VIRTUAL);</span>
			case Queue.QUEUE_TYPE_DISTRIBUTED:
<span class="nc" id="L197">			    return m_localizer.i18n(BbmWebBundleKey.BUNDLE_NAME, BbmWebBundleKey.QUEUE_TYPE_DISTRIBUTED);</span>
			case Queue.QUEUE_TYPE_PROCESS:
<span class="nc" id="L199">			    return m_localizer.i18n(BbmWebBundleKey.BUNDLE_NAME, BbmWebBundleKey.QUEUE_TYPE_PROCESS);</span>
			default: //should never come here.
<span class="nc" id="L201">			    return &quot;&quot;;</span>
		}
	    
	}

	private String getMappingsStr(ID queueID){
<span class="nc" id="L207">		String mappingStr = &quot;&amp;nbsp;&quot;;</span>

<span class="nc" id="L209">		ArrayList groupColl = (ArrayList)m_queueGroupMap.get(queueID);</span>
<span class="nc bnc" id="L210" title="All 4 branches missed.">		if (groupColl != null &amp;&amp; !groupColl.isEmpty()){</span>
<span class="nc" id="L211">			StringBuffer str = new StringBuffer(50);</span>
<span class="nc bnc" id="L212" title="All 2 branches missed.">			for (int i=0; i&lt;groupColl.size(); i++){</span>
<span class="nc" id="L213">				String value = (String)m_groupNameMap.get(groupColl.get(i));</span>
<span class="nc" id="L214">				str.append(value);</span>
<span class="nc bnc" id="L215" title="All 2 branches missed.">				if (i&lt;groupColl.size()-1)</span>
<span class="nc" id="L216">					str.append(&quot;, &quot;);</span>
			}
<span class="nc" id="L218">			mappingStr = str.toString();</span>
		}

<span class="nc" id="L221">		return mappingStr;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>