<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>QuickViewRequestHandler.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.am.adherence.quickview</a> &gt; <span class="el_source">QuickViewRequestHandler.java</span></div><h1>QuickViewRequestHandler.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.am.adherence.quickview;

import java.util.*;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.logging.Category;
import com.bluepumpkin.common.util.StringUtil;
import com.witness.web.uif.base.*;
import com.witness.web.uif.keys.*;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.pagemodel.WorkpanePageModel;
import com.bluepumpkin.web.am.Log;
import com.bluepumpkin.web.am.adherence.AdherenceEJBInvoker;

/**
 * Title:        Request Handler for Quick View page
 * Description:  Request Handler for Quick View page
 * Copyright:    Copyright (c) 2002
 * Company:      Blue Pumpkin Software, Inc
 * @author       Shimon Kakon
 * @version 1.0
 */

<span class="nc" id="L24">public class QuickViewRequestHandler extends RequestHandler {</span>
<span class="fc" id="L25">	private static Category category = Log.initCategory(QuickViewRequestHandler.class.getName());</span>

	/**
	 * Process custum Request.
	 * @param contex The Request Context
	 * @throws WebException
	 */
	public void processRequest(RequestContext context) throws WebException {
<span class="nc bnc" id="L33" title="All 2 branches missed.">		if (isAction(context, QuickViewPageModel.CHANGE_REFRESH_RATE_ACTION)) {</span>
<span class="nc" id="L34">			processChangeRefreshRate(context);</span>
		}
<span class="nc bnc" id="L36" title="All 2 branches missed.">		else if (isAction(context, QuickViewPageModel.PUSH_PIN_ACTION)) {</span>
<span class="nc" id="L37">			processPushPin(context);</span>
		}
<span class="nc bnc" id="L39" title="All 2 branches missed.">		else if (isAction(context, QuickViewPageModel.REMOVE_PIN_ACTION)) {</span>
<span class="nc" id="L40">			processRemovePin(context);</span>
		} 

<span class="nc" id="L43">		String collapsedUserProfile = context.getUserProperty(QuickViewPageModel.SUMMARY_COLLAPSABLE_STATE_USER_PROPERTY_KEY);</span>
<span class="nc" id="L44">		String collapsedRequest = (String)context.getRequest().getParameter(QuickViewPageModel.SUMMARY_COLLAPSABLE_STATE_FN);</span>

<span class="nc" id="L46">        String collapsedDayUserProfile = context.getUserProperty(QuickViewPageModel.SUMMARY_DAY_COLLAPSABLE_STATE_USER_PROPERTY_KEY);</span>
<span class="nc" id="L47">        String collapsedDayRequest = (String)context.getRequest().getParameter(QuickViewPageModel.SUMMARY_DAY_COLLAPSABLE_STATE_FN);</span>

        
		// Now set the action back to new ID so next refresh won't update the user profile again
<span class="nc" id="L51">        QuickViewPageModel model = new QuickViewPageModel(context); </span>
<span class="nc" id="L52">		context.setPageModel(model);</span>
<span class="nc" id="L53">		model.setPageAction(PageAction.NEW_ID);</span>
        
		// Get the state of the summary collapsable container from user profile or request
<span class="nc" id="L56">		String summaryCollapsedState = QuickViewPageModel.SUMMARY_COLLAPSABLE_STATE_DEFAULT;</span>
<span class="nc bnc" id="L57" title="All 2 branches missed.">        if(!StringUtil.isEmpty(collapsedRequest)) {</span>
<span class="nc" id="L58">			summaryCollapsedState = collapsedRequest;</span>
<span class="nc" id="L59">			boolean userProfileToBeUpdated = false;</span>
<span class="nc bnc" id="L60" title="All 2 branches missed.">			if (StringUtil.isEmpty(collapsedUserProfile))</span>
<span class="nc" id="L61">				userProfileToBeUpdated = true;</span>
<span class="nc bnc" id="L62" title="All 2 branches missed.">			else if (!collapsedUserProfile.equals(collapsedRequest))</span>
<span class="nc" id="L63">				userProfileToBeUpdated = true;</span>
<span class="nc bnc" id="L64" title="All 2 branches missed.">			if(userProfileToBeUpdated)</span>
<span class="nc" id="L65">				context.setUserProperty(QuickViewPageModel.SUMMARY_COLLAPSABLE_STATE_USER_PROPERTY_KEY, collapsedRequest);</span>
<span class="nc" id="L66">		}</span>
		else {
<span class="nc bnc" id="L68" title="All 2 branches missed.">			if (!StringUtil.isEmpty(collapsedUserProfile)) {</span>
<span class="nc" id="L69">				summaryCollapsedState = collapsedUserProfile;</span>
			}
		}
<span class="nc" id="L72">		model.setSummaryCollapsableState(summaryCollapsedState);</span>

        // Get the state of the summary day collapsable container from user profile or request
<span class="nc" id="L75">        String summaryDayCollapsedState = QuickViewPageModel.SUMMARY_DAY_COLLAPSABLE_STATE_DEFAULT;</span>
<span class="nc bnc" id="L76" title="All 2 branches missed.">        if(!StringUtil.isEmpty(collapsedDayRequest)) {</span>
<span class="nc" id="L77">            summaryDayCollapsedState = collapsedDayRequest;</span>
<span class="nc" id="L78">            boolean userProfileToBeUpdated = false;</span>
<span class="nc bnc" id="L79" title="All 2 branches missed.">            if (StringUtil.isEmpty(collapsedDayUserProfile))</span>
<span class="nc" id="L80">                userProfileToBeUpdated = true;</span>
<span class="nc bnc" id="L81" title="All 2 branches missed.">            else if (!collapsedDayUserProfile.equals(collapsedDayRequest))</span>
<span class="nc" id="L82">                userProfileToBeUpdated = true;</span>
<span class="nc bnc" id="L83" title="All 2 branches missed.">            if(userProfileToBeUpdated)</span>
<span class="nc" id="L84">                context.setUserProperty(QuickViewPageModel.SUMMARY_DAY_COLLAPSABLE_STATE_USER_PROPERTY_KEY, collapsedDayRequest);</span>
<span class="nc" id="L85">        }</span>
        else {
<span class="nc bnc" id="L87" title="All 2 branches missed.">            if (!StringUtil.isEmpty(collapsedDayUserProfile)) {</span>
<span class="nc" id="L88">                summaryDayCollapsedState = collapsedDayUserProfile;</span>
            }
        }
<span class="nc" id="L91">        model.setSummaryDayCollapsableState(summaryDayCollapsedState);</span>

        // Process the page as usual
<span class="nc" id="L94">		processNewID(context, model);</span>
		
		/*add for 7.9
		if (isAction(context, QuickViewPageModel.RECORD_ACTION)) {
			processRecordAction(context);
		}
		*/
<span class="nc" id="L101">	}</span>


	// This method will be invoked in case the user changes the refresh rate.
	// The new value is saved in the user profile and the page is processed as usual
	private void processChangeRefreshRate(RequestContext context) {
		// Get the new refresh rate from the form and det it to the user profile
<span class="nc" id="L108">		String refreshRate = context.getRequest().getParameter(QuickViewPageModel.REFRESH_RATE_FN);</span>
<span class="nc" id="L109">		context.setUserProperty(QuickViewPageModel.REFRESH_RATE_USER_PROPERTY_KEY, refreshRate);</span>
<span class="nc" id="L110">	}</span>

	// This method will be invoked in case the user push in a pin
	private void processPushPin(RequestContext context) {
<span class="nc" id="L114">		Collection allPushedIds = (Collection)context.getAttribute(RequestContext.SESSION_SCOPE, QuickViewPageModel.PUSH_EMP_IDS_KEY);</span>
<span class="nc bnc" id="L115" title="All 2 branches missed.">		if(allPushedIds == null) {</span>
<span class="nc" id="L116">			allPushedIds = new ArrayList(16);</span>
		}
<span class="nc" id="L118">		String pushedIdString = (String)context.getRequest().getParameter(QuickViewPageModel.PUSH_EMP_ID_FN);</span>
<span class="nc bnc" id="L119" title="All 2 branches missed.">		if(!StringUtil.isEmpty(pushedIdString)) {</span>
<span class="nc" id="L120">			allPushedIds.add(new ID(pushedIdString));</span>
<span class="nc" id="L121">			context.setAttribute(RequestContext.SESSION_SCOPE, QuickViewPageModel.PUSH_EMP_IDS_KEY, allPushedIds);</span>
		}
<span class="nc" id="L123">	}</span>

	// This method will be invoked in case the user push out a pin
	private void processRemovePin(RequestContext context) {
<span class="nc" id="L127">		Collection allPushedIds = (Collection)context.getAttribute(RequestContext.SESSION_SCOPE, QuickViewPageModel.PUSH_EMP_IDS_KEY);</span>
<span class="nc bnc" id="L128" title="All 4 branches missed.">		if(allPushedIds != null &amp;&amp; !allPushedIds.isEmpty()) {</span>
<span class="nc" id="L129">			String pushedIdString = (String)context.getRequest().getParameter(QuickViewPageModel.PUSH_EMP_ID_FN);</span>
<span class="nc bnc" id="L130" title="All 2 branches missed.">			if(!StringUtil.isEmpty(pushedIdString)) {</span>
<span class="nc" id="L131">				allPushedIds.remove(new ID(pushedIdString));</span>
<span class="nc" id="L132">				context.setAttribute(RequestContext.SESSION_SCOPE, QuickViewPageModel.PUSH_EMP_IDS_KEY, allPushedIds);</span>
			}
		}
<span class="nc" id="L135">	}</span>
	
//	 record action
	private void processRecordAction(RequestContext context){	
<span class="nc" id="L139">		String recordIdString = (String)context.getRequest().getParameter(QuickViewPageModel.RECORD_EMP_ID_FN);</span>
<span class="nc" id="L140">		String startRecording = (String)context.getRequest().getParameter(QuickViewPageModel.START_RECORD_FN);</span>
<span class="nc bnc" id="L141" title="All 2 branches missed.">		if(!StringUtil.isEmpty(recordIdString)) {</span>
			try {
<span class="nc" id="L143">			AdherenceEJBInvoker.startRecording(new ID(recordIdString), context.getUser().getID());</span>
<span class="nc" id="L144">			} catch (Exception ex){</span>
<span class="nc" id="L145">				context.getPageModel().addPageMessage(new Message(Message.ERROR_TYPE, ex.getLocalizedMessage()));</span>
<span class="nc" id="L146">			}</span>
		}
<span class="nc" id="L148">	}</span>

	/**
	 * Process New ID
	 */
	protected void processNewID(RequestContext context, WorkpanePageModel model) {
<span class="nc" id="L154">		model.setNewID(true);</span>
<span class="nc" id="L155">	}</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>