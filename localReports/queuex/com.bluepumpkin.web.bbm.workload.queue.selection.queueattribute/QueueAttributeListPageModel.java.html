<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>QueueAttributeListPageModel.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.bbm.workload.queue.selection.queueattribute</a> &gt; <span class="el_source">QueueAttributeListPageModel.java</span></div><h1>QueueAttributeListPageModel.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.bbm.workload.queue.selection.queueattribute;

import java.rmi.RemoteException;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Collection;
import java.util.Collections;
import java.util.HashMap;
import java.util.Hashtable;
import java.util.Iterator;
import java.util.Map;
import java.util.Set;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.ScopeID;
import com.bluepumpkin.common.logging.Category;
import com.bluepumpkin.common.util.StringUtil;
import com.bluepumpkin.ejb.bbm.base.BbmException;
import com.bluepumpkin.ejb.bbm.workload.model.Queue;
import com.bluepumpkin.ejb.bbm.workload.model.queueattribute.QueueAttributeDefintion;
import com.bluepumpkin.ejb.bbm.workload.model.queueattribute.QueueAttributeDropDown;
import com.bluepumpkin.ejb.bbm.workload.model.queueattribute.QueueAttributePairDateValue;
import com.bluepumpkin.ejb.bbm.workload.model.queueattribute.QueueAttributePairDropDownValue;
import com.bluepumpkin.ejb.bbm.workload.model.queueattribute.QueueAttributePairNumericValue;
import com.bluepumpkin.ejb.bbm.workload.model.queueattribute.QueueAttributePairTextValue;
import com.bluepumpkin.ejb.bbm.workload.model.queueattribute.QueueAttributeType;
import com.bluepumpkin.web.bbm.Log;
import com.bluepumpkin.web.bbm.l10n.BbmWebBundleKey;
import com.bluepumpkin.web.bbm.organization.OrgWorkpaneListPageModel;
import com.bluepumpkin.web.bbm.organization.OrganizationModelHandler;
import com.bluepumpkin.web.bbm.organization.OrganizationUtil;
import com.bluepumpkin.web.bbm.organization.setup.datasource.group.GroupMH;
import com.bluepumpkin.web.bbm.workload.WorkloadModelHandler;
import com.bluepumpkin.web.bbm.workload.queue.mapping.QueueGroupMH;
import com.verint.web.wfm.keys.WfmJavaScriptFileID;
import com.witness.ejb.core.security.PrivilegeKeys;
import com.witness.ejb.core.security.Scope;
import com.witness.web.uif.base.Message;
import com.witness.web.uif.keys.PageAction;
import com.witness.web.uif.l10n.UIFWebBundleKey;
import com.witness.web.uif.pagecomponent.DefaultMultiColumnNodeData;
import com.witness.web.uif.pagecomponent.form.FormInputPC;
import com.witness.web.uif.pagecomponent.table.TableHeaderPC;
import com.witness.web.uif.pagemodel.PageModel;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.system.manager.impl.DefaultVerticalizationManager;


/**
 * Title:
 * Description:
 * Copyright:    Copyright (c) 2001
 * Company:      Blue Pumpkin Software, Inc
 * @author		Sankar Nair
 * @version 1.0
 */
public class QueueAttributeListPageModel extends OrgWorkpaneListPageModel {
<span class="fc" id="L58">	private static final Category log = Log.initCategory(QueueAttributeListPageModel.class.getName());</span>
	
	
	private static final String LIST_NAME_SORT = &quot;LIST_NAME_SORT&quot;;
	private static final String LIST_ATTRIBUTE_DEFINITIONS = &quot;LIST_ATTRIBUTE_DEFINITIONS&quot;;
	private static final String LIST_ORGANIZATION_SORT = &quot;LIST_ORGANIZATION_SORT&quot;;
	public static final String CAN_CONFIGURE = &quot;CAN_CONFIGURE&quot;;
	
<span class="fc" id="L66">	private boolean m_bIsScoped = true; // assume scoped</span>
	private Collection m_queueAttributeDefinition;
	
<span class="fc" id="L69">	private Map m_typeNameMap = Collections.emptyMap();</span>
	
<span class="fc" id="L71">	ID m_selectedOrgID = null;</span>

	private Collection m_QueueList;
	
<span class="fc" id="L75">	private Map m_groupNameMap = Collections.emptyMap();</span>
<span class="fc" id="L76">	private Map m_queueGroupMap = Collections.emptyMap();</span>

	/**
	 * Constructor
	 */
	public QueueAttributeListPageModel(RequestContext context) {
<span class="fc" id="L82">		super(context);</span>
		
<span class="fc" id="L84">		m_selectedOrgID = getSelectedIDObject();</span>
<span class="fc bfc" id="L85" title="All 2 branches covered.">		if (m_selectedOrgID == null)</span>
		{
<span class="pc bpc" id="L87" title="1 of 2 branches missed.">			if (OrganizationUtil.getSelectedOrganizationID(m_context) != null)</span>
			{
<span class="fc" id="L89">				m_selectedOrgID = new ID(OrganizationUtil.getSelectedOrganizationID(m_context));</span>
				
			}
			else {
<span class="nc" id="L93">				m_selectedOrgID = new ID(-3002);</span>
				
			}
		} 	
<span class="fc" id="L97">		setName(&quot;queueAttributeDefList&quot;);</span>

<span class="fc" id="L99">		setJSMediator(WfmJavaScriptFileID.MEDIATOR_QUEUE_ATTRIBUTE_LIST_WORKPANE);</span>
<span class="fc" id="L100">	}</span>

	/**
	 * Return instance of Model which is ready to be rendered
	 */
	public static PageModel getInstance(RequestContext context) {
<span class="fc" id="L106">		return getInstance(context, QueueAttributeListPageModel.class);</span>
	}
	
	/**
	 * Loads all the Job Title value objects for the selected Organization ID
	 *
	 * @return true if load was successful
	 */
	private boolean loadQueueAttributeDefinition() {
		
		try {
		
			
			// determine if current user has admin privilege
			//TODO
<span class="pc bpc" id="L121" title="1 of 2 branches missed.">			if (m_context.getUser().isAuthorized(PrivilegeKeys.CORE_VIEWORGANIZATION, new ScopeID(m_selectedOrgID, Scope.ORG_SCOPE))) {</span>
<span class="fc" id="L122">					m_queueAttributeDefinition = new QueueAttributeDefinitionModelHandler().getQueueAttributeDefinitions(m_context, m_selectedOrgID);</span>
<span class="fc" id="L123">					return true;</span>
			} else {
<span class="nc" id="L125">				addPageMessage(Message.INFO_TYPE, getNotAuthorizedToViewMsg());</span>
<span class="nc" id="L126">				m_bIsScoped = false;</span>
<span class="nc" id="L127">				return false;</span>
			}
<span class="nc" id="L129">		} catch (Exception ex) {</span>
<span class="nc" id="L130">			handleUnableToLoadDataError(log, ex);</span>
<span class="nc" id="L131">			return false;</span>
		}
	}

<span class="fc" id="L135">	private Hashtable&lt;ID, String&gt; dropDownLookup = new Hashtable&lt;ID, String&gt;();</span>

	/**
	 * Initialize List
	 */
	protected void initList() {
<span class="fc" id="L141">		super.initList();</span>
		
<span class="fc" id="L143">		m_list.setMultiRowSelectable(true);</span>
		
<span class="pc bpc" id="L145" title="1 of 2 branches missed.">		if (!loadQueueAttributeDefinition()) return;</span>
		
		// Setup Headers
<span class="fc" id="L148">		TableHeaderPC header = m_list.getHeader();</span>
<span class="fc" id="L149">		header.setSortable(true);</span>
		
		
<span class="fc" id="L152">		header.addColumnHeaderData(LIST_NAME_SORT, i18n(m_common_bundle, UIFWebBundleKey.LIST_HEADER_NAME), true);</span>
<span class="fc" id="L153">		header.addColumnHeaderData(LIST_ORGANIZATION_SORT,	i18n(m_bbmBundle, BbmWebBundleKey.CAMPAIGN_ORG_PAGE_TITLE), true);</span>

		
<span class="pc bpc" id="L156" title="1 of 2 branches missed.">		if(m_queueAttributeDefinition != null) {</span>
<span class="fc" id="L157">			Iterator&lt;QueueAttributeDefintion&gt; defIter = m_queueAttributeDefinition.iterator();</span>
<span class="fc" id="L158">			int counter=0;</span>
<span class="fc bfc" id="L159" title="All 2 branches covered.">			while(defIter.hasNext()) {</span>
<span class="fc" id="L160">				QueueAttributeDefintion def = defIter.next();</span>
<span class="fc" id="L161">				header.addColumnHeaderData(LIST_ATTRIBUTE_DEFINITIONS + def.getID(),	def.getName(), true);</span>
				
<span class="pc bpc" id="L163" title="1 of 2 branches missed.">				if(def.getType().equals(QueueAttributeType.TYPE_DROPDOWN)) {</span>
					try {
<span class="nc" id="L165">						def = new QueueAttributeDefinitionModelHandler().getQueueAttributeByID(m_context, def.getID());</span>
<span class="nc" id="L166">					} catch (BbmException e) {</span>
<span class="nc" id="L167">						handleUnableToLoadDataError(log, e);</span>
<span class="nc" id="L168">						e.printStackTrace();</span>
<span class="nc" id="L169">					} catch (RemoteException e) {</span>
						// TODO Auto-generated catch block
<span class="nc" id="L171">						e.printStackTrace();</span>
<span class="nc" id="L172">					}</span>
<span class="nc" id="L173">					Collection&lt;QueueAttributeDropDown&gt; dds = def.getQueueAttributeDropDown();</span>
					
<span class="nc" id="L175">					Iterator&lt;QueueAttributeDropDown&gt; iter = dds.iterator();</span>
<span class="nc bnc" id="L176" title="All 2 branches missed.">					while(iter.hasNext()) {</span>
<span class="nc" id="L177">						QueueAttributeDropDown ddObj = iter.next();</span>
<span class="nc" id="L178">						dropDownLookup.put(ddObj.getID(), ddObj.getValue());</span>
<span class="nc" id="L179">					}</span>
					
				}
<span class="fc" id="L182">			}</span>
			
		}

		// Setup basic table property
<span class="fc" id="L187">		m_list.setIsAutoSortEnabled(true);</span>
<span class="fc" id="L188">		header.setDefaultSortColumn(getDefaultSortColumn());</span>
<span class="fc" id="L189">	}</span>

        @Override
        public void setSortColumn(String column) {
<span class="nc bnc" id="L193" title="All 2 branches missed.">            if (column.matches(&quot;^\\w+$&quot;)) {</span>
<span class="nc" id="L194">                super.setSortColumn(column);</span>
            }
<span class="nc" id="L196">        }</span>

        @Override
	protected String getDefaultSortColumn() {
<span class="fc" id="L200">		return LIST_NAME_SORT;</span>
	}

	/**
	 * Create the list model
	 */
	protected void createListModel() {
		
<span class="pc bpc" id="L208" title="1 of 2 branches missed.">		if (!loadQueues()) return;</span>
<span class="pc bpc" id="L209" title="1 of 2 branches missed.">		if (!loadQueueAttributeDefinition()) return;</span>
		
		
		try {
		
<span class="fc" id="L214">		String selected = (String)m_context.getAttribute(RequestContext.SESSION_SCOPE, &quot;CACHED_QUEUE_ID&quot;);</span>
<span class="fc" id="L215">		this.setPerformActionOnID(selected);</span>
<span class="fc" id="L216">		QueueAttributeDefinitionModelHandler modelHandler = new QueueAttributeDefinitionModelHandler();</span>
<span class="pc bpc" id="L217" title="2 of 4 branches missed.">		boolean isAuth = m_bIsScoped &amp;&amp; isAuthorizedToConfigure();</span>
		
<span class="fc" id="L219">		Hashtable lookupValues = new Hashtable();</span>
		
<span class="fc" id="L221">		ArrayList listModel = new ArrayList();</span>
<span class="fc" id="L222">		ArrayList&lt;ID&gt; queueIDS = new ArrayList&lt;ID&gt;();</span>
<span class="pc bpc" id="L223" title="1 of 2 branches missed.">		if(m_QueueList != null) {</span>
<span class="fc bfc" id="L224" title="All 2 branches covered.">			for(Iterator it = m_QueueList.iterator(); it.hasNext();) {</span>
<span class="fc" id="L225">				Queue queue = (Queue)it.next();</span>
<span class="pc bpc" id="L226" title="1 of 2 branches missed.">				if(queue.getQueueType() != Queue.QUEUE_TYPE_PROCESS)</span>
<span class="fc" id="L227">					queueIDS.add(queue.getID());</span>
<span class="fc" id="L228">			}</span>
		}
		
<span class="fc" id="L231">		Collection&lt;QueueAttributePairDateValue&gt; dateValues = modelHandler.getDateValues(m_context, queueIDS);</span>
<span class="fc" id="L232">		Collection&lt;QueueAttributePairNumericValue&gt; numValues = modelHandler.getNumericValues(m_context, queueIDS);</span>
<span class="fc" id="L233">		Collection&lt;QueueAttributePairTextValue&gt; textValues = modelHandler.getTextValues(m_context, queueIDS);</span>
<span class="fc" id="L234">		Collection&lt;QueueAttributePairDropDownValue&gt; ddValues = modelHandler.getDropDownValues(m_context, queueIDS);</span>
		
		
<span class="fc" id="L237">		String pattern = m_context.getLocalizer().getDateInputFormat();</span>
<span class="fc" id="L238">		SimpleDateFormat format = new SimpleDateFormat(pattern, m_context.getLocalizer().getLocaleContext().getRegionalFormatLocale());</span>
		
<span class="pc bpc" id="L240" title="1 of 2 branches missed.">		if(dateValues != null) {</span>
<span class="fc" id="L241">			Iterator&lt;QueueAttributePairDateValue&gt; dateIter = dateValues.iterator();</span>
<span class="pc bpc" id="L242" title="1 of 2 branches missed.">			while(dateIter.hasNext()) {</span>
<span class="nc" id="L243">				QueueAttributePairDateValue obj = dateIter.next();</span>
<span class="nc" id="L244">				lookupValues.put(obj.getQueueID() +&quot;_&quot;+ obj.getQueueAttributeID(), format.format(obj.getValue()));</span>
<span class="nc" id="L245">			}</span>
		}

<span class="pc bpc" id="L248" title="1 of 2 branches missed.">		if(numValues != null) {</span>
<span class="fc" id="L249">			Iterator&lt;QueueAttributePairNumericValue&gt; numIter = numValues.iterator();</span>
<span class="pc bpc" id="L250" title="1 of 2 branches missed.">			while(numIter.hasNext()) {</span>
<span class="nc" id="L251">				QueueAttributePairNumericValue obj = numIter.next();</span>
<span class="nc" id="L252">				lookupValues.put(obj.getQueueID() +&quot;_&quot;+ obj.getQueueAttributeID(), FormInputPC.localizeRealNumber(obj.getValue() + &quot;&quot;, m_context.getLocalizer()));</span>
<span class="nc" id="L253">			}</span>
		}
		
<span class="pc bpc" id="L256" title="1 of 2 branches missed.">		if(textValues != null) {</span>
<span class="fc" id="L257">			Iterator&lt;QueueAttributePairTextValue&gt; textIter = textValues.iterator();</span>
<span class="pc bpc" id="L258" title="1 of 2 branches missed.">			while(textIter.hasNext()) {</span>
<span class="nc" id="L259">				QueueAttributePairTextValue obj = textIter.next();</span>
<span class="nc" id="L260">				lookupValues.put(obj.getQueueID() +&quot;_&quot;+ obj.getQueueAttributeID(), obj.getValue());</span>
<span class="nc" id="L261">			}</span>
		}
		//TODO - Store the drop down value name
		//TODO - Store the drop down value name
		//TODO - Store the drop down value name
<span class="pc bpc" id="L266" title="1 of 2 branches missed.">		if(ddValues != null) {</span>
<span class="fc" id="L267">			Iterator&lt;QueueAttributePairDropDownValue&gt; ddIter = ddValues.iterator();</span>
<span class="pc bpc" id="L268" title="1 of 2 branches missed.">			while(ddIter.hasNext()) {</span>
<span class="nc" id="L269">				QueueAttributePairDropDownValue obj = ddIter.next();</span>
				//ESR#4308718: When trying to find the queue attribute, if the value gets from queue of organization 
				//does not match the value get through organization, it just ignore (Per Sankar's suggestion,  
				//in such case, the value gets from queue of organization shouldn't include).
<span class="nc bnc" id="L273" title="All 2 branches missed.">				if (dropDownLookup.get(obj.getValue()) != null) {</span>
<span class="nc" id="L274">					lookupValues.put(obj.getQueueID() +&quot;_&quot;+ obj.getQueueAttributeID(), dropDownLookup.get(obj.getValue()));</span>
				}
<span class="nc" id="L276">			}</span>
		}
<span class="pc bpc" id="L278" title="1 of 2 branches missed.">		if(m_QueueList != null) {</span>
<span class="fc bfc" id="L279" title="All 2 branches covered.">			for(Iterator it = m_QueueList.iterator(); it.hasNext();) {</span>
<span class="fc" id="L280">				Queue queue = (Queue)it.next();</span>
<span class="pc bpc" id="L281" title="1 of 2 branches missed.">				if(queue.getQueueType() == Queue.QUEUE_TYPE_PROCESS)</span>
<span class="nc" id="L282">					continue;</span>
				// Create the row data
<span class="fc" id="L284">				String rowID = queue.getID().toString();</span>
<span class="fc" id="L285">				DefaultMultiColumnNodeData row_data =  new DefaultMultiColumnNodeData(rowID);</span>
				
				
<span class="fc" id="L288">				row_data.add( queue.getName());</span>
<span class="fc" id="L289">				row_data.add( queue.getOrganizationName() );</span>
	
				
<span class="fc" id="L292">				Iterator&lt;QueueAttributeDefintion&gt; iter = m_queueAttributeDefinition.iterator();</span>
<span class="fc bfc" id="L293" title="All 2 branches covered.">				while(iter.hasNext()) {</span>
<span class="fc" id="L294">					QueueAttributeDefintion def = iter.next();</span>
<span class="pc bpc" id="L295" title="1 of 2 branches missed.">					if(lookupValues.containsKey(queue.getID() + &quot;_&quot; + def.getID())) {</span>
<span class="nc" id="L296">						row_data.add(lookupValues.get(queue.getID() + &quot;_&quot; + def.getID()));</span>
					} else {
<span class="fc" id="L298">						row_data.add(&quot;-&quot;);</span>
					}
<span class="fc" id="L300">				}</span>
				
				// Set if the row should be editable or not. Row should be editable if the
				// selected org is the owner of the activity
<span class="fc" id="L304">				HashMap rowAttributes = row_data.getNodeAttributes();</span>
<span class="pc bpc" id="L305" title="3 of 8 branches missed.">				if ( isAuth &amp;&amp; m_selectedOrgID.equals(queue.getOrganizationID()) &amp;&amp; m_queueAttributeDefinition != null &amp;&amp; m_queueAttributeDefinition.size() &gt; 0) {</span>
<span class="fc" id="L306">					rowAttributes.put(IS_EDITABLE,	&quot;true&quot;);</span>
<span class="fc" id="L307">					rowAttributes.put(IS_DELETEABLE, &quot;true&quot;);</span>
<span class="fc" id="L308">					rowAttributes.put(IS_COPYABLE,   &quot;true&quot;);</span>
				} else {
<span class="fc" id="L310">					rowAttributes.put(IS_EDITABLE,	&quot;false&quot;);</span>
<span class="fc" id="L311">					rowAttributes.put(IS_DELETEABLE, &quot;false&quot;);</span>
<span class="fc" id="L312">					rowAttributes.put(IS_COPYABLE,   &quot;false&quot;);</span>
				}
<span class="fc" id="L314">				rowAttributes.put(COPY_ITEM_NAME, queue.getName());</span>
	
				// Add row data to list model
<span class="fc" id="L317">				listModel.add(row_data);</span>
	
				// Check if row should be selected, assuming only one should be selected
<span class="pc bpc" id="L320" title="1 of 2 branches missed.">				if (OrganizationModelHandler.UNREASONABLE_ORG_ID.equals(m_selectedRowOrgID)) {</span>
<span class="pc bpc" id="L321" title="1 of 2 branches missed.">					if(this.isRowSelected(queue.getID())) {</span>
<span class="nc" id="L322">						m_list.addSelectedRowID(rowID);</span>
<span class="nc" id="L323">						m_selectedRowOrgID = queue.getOrganizationID();</span>
					}
				}
<span class="fc" id="L326">			} //end for</span>
		}
<span class="fc" id="L328">		m_list.setListModel(listModel);     </span>
<span class="nc" id="L329">		} catch(Exception e) {</span>
<span class="nc" id="L330">			e.printStackTrace();</span>
<span class="nc" id="L331">			handleUnableToLoadDataError(log, e);</span>
<span class="fc" id="L332">		}</span>
<span class="fc" id="L333">	}</span>


	/**
	 * Get entity name. Used for title.
	 */
	protected String getTitleEntityType() {
<span class="fc" id="L340">		Object[] args = new Object[1];</span>
<span class="fc" id="L341">	    args[0] = m_context.getSystemManagerFactory().getVerticalizationManager().getVerticalizedString(m_context, DefaultVerticalizationManager.QUEUE);</span>
<span class="fc" id="L342">	    return m_localizer.i18n(m_bbmBundle, BbmWebBundleKey.QUEUE_ATTRIBUTE_ATTRIBUTES, args);</span>
	}
 
	/**
	 * Return URL for HTML Form Action
	 */
	public String getFormAction() {
<span class="fc" id="L349">		return &quot;queue_attribute&quot;;</span>
	}
	
	
	/**
	 * Loads all the Job Title value objects for the selected Organization ID
	 *
	 * @return true if load was successful
	 */
	private boolean loadQueues() {
		
		try {
		
			
			// determine if current user has access to selected Org..
<span class="pc bpc" id="L364" title="1 of 2 branches missed.">			if (m_context.getUser().isAuthorized(PrivilegeKeys.CORE_VIEWORGANIZATION, new ScopeID(m_selectedOrgID, Scope.ORG_SCOPE))) {</span>
<span class="fc" id="L365">					m_QueueList = WorkloadModelHandler.getQueuesByRecursedOrgID(m_context,m_selectedOrgID);</span>
<span class="fc" id="L366">					buildMaps();</span>
<span class="fc" id="L367">					return true;</span>
			} else {
				
<span class="nc" id="L370">				addPageMessage(Message.INFO_TYPE, getNotAuthorizedToViewMsg());</span>
<span class="nc" id="L371">				m_bIsScoped = false;</span>
<span class="nc" id="L372">				return false;</span>
			}
<span class="nc" id="L374">		} catch (Exception ex) {</span>
<span class="nc" id="L375">			handleUnableToLoadDataError(log, ex);</span>
<span class="nc" id="L376">			return false;</span>
		}
	}
	
	
	private void buildMaps() throws Exception {
		
		
		
		
		
		try {
			//Collection dataList = WorkloadModelHandler.getAllQueues(m_context);
			//Collection dataList = WorkloadModelHandler.getQueuesByOrgID(m_context,getSelectedIDObject());
			//ID idOrg = OrganizationUtil.getSelectedOrganizationID();
<span class="fc" id="L391">			Collection dataList = WorkloadModelHandler.getQueuesByRecursedOrgID(m_context,m_selectedOrgID);</span>
			
			
<span class="pc bpc" id="L394" title="2 of 4 branches missed.">			if ((dataList != null) &amp;&amp; (!dataList.isEmpty())) {</span>

<span class="fc" id="L396">			ArrayList queueIDsColl = new ArrayList(dataList.size());</span>
<span class="fc bfc" id="L397" title="All 2 branches covered.">				for(Iterator it = dataList.iterator(); it.hasNext();) {</span>
<span class="fc" id="L398">					Queue queue = (Queue)it.next();</span>
<span class="pc bpc" id="L399" title="1 of 2 branches missed.">					if(queue.getQueueType() != Queue.QUEUE_TYPE_PROCESS)</span>
<span class="fc" id="L400">						queueIDsColl.add(queue.getID());</span>
<span class="fc" id="L401">				}</span>
<span class="fc" id="L402">				m_queueGroupMap = QueueGroupMH.getLinkedGroupIDsForQueues(queueIDsColl);</span>
	
<span class="pc bpc" id="L404" title="2 of 4 branches missed.">				if (m_queueGroupMap != null &amp;&amp; m_queueGroupMap.size()&gt;0){</span>
<span class="nc" id="L405">					ArrayList groupIDSet = new ArrayList();</span>
<span class="nc" id="L406">					Set keySet = m_queueGroupMap.keySet();</span>
<span class="nc bnc" id="L407" title="All 2 branches missed.">					for(Iterator it1 = keySet.iterator(); it1.hasNext();) {</span>
<span class="nc" id="L408">						ID queueID = (ID)it1.next();</span>
<span class="nc" id="L409">						ArrayList groupColl = (ArrayList)m_queueGroupMap.get(queueID);</span>
<span class="nc bnc" id="L410" title="All 4 branches missed.">						if (groupColl != null &amp;&amp; groupColl.size()&gt;0){</span>
<span class="nc bnc" id="L411" title="All 2 branches missed.">							for (int i=0;i&lt;groupColl.size();i++){</span>
<span class="nc" id="L412">								ID groupID = (ID)groupColl.get(i);</span>
<span class="nc bnc" id="L413" title="All 2 branches missed.">								if (!groupIDSet.contains(groupID))</span>
<span class="nc" id="L414">									groupIDSet.add(groupID);</span>
							}
						}
<span class="nc" id="L417">					}</span>
<span class="nc" id="L418">					m_groupNameMap = GroupMH.getGroupNamesByIDs(groupIDSet);</span>
				}
				
			}
			
			
<span class="nc" id="L424">		} catch (Exception e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L426">			e.printStackTrace();</span>
<span class="fc" id="L427">		}</span>
		
	
<span class="fc" id="L430">	}</span>

	
	protected void initToolbar() {

	    // verticalise queue
<span class="fc" id="L436">	    Object[] args = new Object[1];</span>
<span class="fc" id="L437">	    args[0] = m_context.getSystemManagerFactory().getVerticalizationManager().getVerticalizedString(m_context, DefaultVerticalizationManager.QUEUESMALL);</span>

<span class="fc" id="L439">		String editLabel = m_toolbar.i18nCore(UIFWebBundleKey.TOOLBAR_EDIT);</span>
<span class="fc" id="L440">			boolean bOrgOwnsQueue = false;</span>
			try {
<span class="pc bpc" id="L442" title="1 of 2 branches missed.">				if (!StringUtil.isEmpty(this.getPerformActionOnID())) {</span>
<span class="nc" id="L443">					Queue queue = WorkloadModelHandler.getQueueByID(m_context, new ID(getPerformActionOnID()));</span>
<span class="nc bnc" id="L444" title="All 2 branches missed.">					if (queue != null) {</span>
<span class="nc bnc" id="L445" title="All 2 branches missed.">						if (queue.getOrganizationID() == m_selectedOrgID)</span>
<span class="nc" id="L446">							bOrgOwnsQueue = true;</span>
					}
					
				}
<span class="nc" id="L450">			} catch (Exception ex)</span>
			{
					
					// TODO: unlikely but handle.
<span class="fc" id="L454">			}</span>
			
			

<span class="pc bpc" id="L458" title="2 of 4 branches missed.">		boolean isAuth = m_bIsScoped &amp;&amp; isAuthorizedToConfigure();</span>
<span class="pc bpc" id="L459" title="2 of 4 branches missed.">		boolean isBtnEnabled = isAuth &amp;&amp; !StringUtil.isEmpty(this.getPerformActionOnID());</span>
		
<span class="fc" id="L461">		m_toolbar.addSubmitTextButton(PageAction.EDIT, editLabel, (isBtnEnabled));</span>
<span class="fc" id="L462">	}</span>
	
	/**
	 * Return the Selected Queue IDs
	 */
	public ID[] getSelectedQueueIDs() {
<span class="nc" id="L468">		return m_performActionOnIDs;</span>
	}
	
	private String getTypeMappingStr(ID typeID) throws Exception {
<span class="nc bnc" id="L472" title="All 2 branches missed.">		if(m_typeNameMap.isEmpty())</span>
<span class="nc" id="L473">			loadAttributeTypes();</span>
<span class="nc" id="L474">		return (String)m_typeNameMap.get(typeID);</span>
	}
	
	private void loadAttributeTypes() throws Exception {
<span class="nc" id="L478">		m_typeNameMap = new Hashtable&lt;ID,String&gt;();</span>
<span class="nc" id="L479">		Collection&lt;QueueAttributeType&gt; types = new QueueAttributeDefinitionModelHandler().getQueueAttributeTypes(m_context);</span>
<span class="nc" id="L480">		Iterator&lt;QueueAttributeType&gt; iter = types.iterator();</span>
		
<span class="nc bnc" id="L482" title="All 2 branches missed.">		while(iter.hasNext()) {</span>
<span class="nc" id="L483">			QueueAttributeType obj = iter.next();</span>
<span class="nc" id="L484">			m_typeNameMap.put(obj.getID(), obj.getName());</span>
<span class="nc" id="L485">		}</span>
<span class="nc" id="L486">	}</span>
	
	protected boolean isAuthorizedToConfigure() {
<span class="fc" id="L489">		return (m_context.getUser().isAuthorized(PrivilegeKeys.FS_CONFIGUREQUEUES));</span>
	}
	
	public void setSelectedOrgID(String id) {
<span class="nc" id="L493">		m_selectedOrgID = new ID(id);</span>
<span class="nc" id="L494">	}</span>

	public void deleteQueueAttributeDefinition(ID id) {
		try {
<span class="nc" id="L498">			new QueueAttributeDefinitionModelHandler().deleteQueueAttributeDefinition(m_context, id);</span>
<span class="nc" id="L499">		} catch (Exception e) {</span>
<span class="nc" id="L500">			Object[] args = new Object[1];</span>
<span class="nc" id="L501">		    args[0] = m_context.getSystemManagerFactory().getVerticalizationManager().getVerticalizedString(m_context, DefaultVerticalizationManager.QUEUE);</span>
		    
		    
<span class="nc" id="L504">			addPageMessage(Message.WARNING_TYPE, m_localizer.i18n(m_bbmBundle, BbmWebBundleKey.QUEUE_ATTRIBUTE_DEFINITION_HEADER, args));</span>
<span class="nc" id="L505">			e.printStackTrace();</span>
<span class="nc" id="L506">		}</span>
		
<span class="nc" id="L508">	}</span>
	
	
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>