<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>QueueMappingPM.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.bbm.workload.queue.mapping</a> &gt; <span class="el_source">QueueMappingPM.java</span></div><h1>QueueMappingPM.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.bbm.workload.queue.mapping;

import java.text.MessageFormat;
import java.util.ArrayList;
import java.util.Collection;
import java.util.Collections;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Map;
import java.util.ResourceBundle;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.StringsPair;
import com.bluepumpkin.common.logging.Category;
import com.bluepumpkin.common.util.StringUtil;
import com.bluepumpkin.ejb.bbm.BbmManagerFactory;
import com.bluepumpkin.ejb.bbm.config.ConfigKey;
import com.bluepumpkin.ejb.bbm.datasource.model.DataSource;
import com.bluepumpkin.ejb.bbm.datasourcegroup.model.Group;
import com.bluepumpkin.ejb.bbm.workload.ejb.WorkloadManager;
import com.bluepumpkin.ejb.bbm.workload.model.Queue;
import com.bluepumpkin.web.bbm.Log;
import com.bluepumpkin.web.bbm.keys.BbmImageFileID;
import com.bluepumpkin.web.bbm.keys.BbmJavaScriptFileID;
import com.bluepumpkin.web.bbm.l10n.BbmWebBundleKey;
import com.bluepumpkin.web.bbm.l10n.BbmWebLogBundleKey;
import com.bluepumpkin.web.bbm.organization.OrganizationUtil;
import com.bluepumpkin.web.bbm.organization.setup.datasource.DataSourceModelHandler;
import com.bluepumpkin.web.bbm.organization.setup.datasource.group.GroupMH;
import com.bluepumpkin.web.bbm.workload.WorkloadModelHandler;
import com.bluepumpkin.web.bbm.workload.queue.QueueUtil;
import com.verint.ejb.wfm.WfmManagerFactory;
import com.verint.web.wfm.keys.WfmJavaScriptFileID;
import com.witness.ejb.core.security.PrivilegeKeys;
import com.witness.web.uif.base.Message;
import com.witness.web.uif.jsp.HtmlButton;
import com.witness.web.uif.jsp.HtmlImage;
import com.witness.web.uif.jsp.HtmlTableCell;
import com.witness.web.uif.keys.JavaScriptFileID;
import com.witness.web.uif.keys.PageAction;
import com.witness.web.uif.l10n.UIFWebBundleKey;
import com.witness.web.uif.pagecomponent.DefaultMultiColumnNodeData;
import com.witness.web.uif.pagecomponent.PageComponent;
import com.witness.web.uif.pagecomponent.assignmentbox.AdvancedAssignBoxPC;
import com.witness.web.uif.pagecomponent.container.ContainerPC;
import com.witness.web.uif.pagecomponent.contenttitle.ContentTitlePC;
import com.witness.web.uif.pagecomponent.form.FormInputPC;
import com.witness.web.uif.pagecomponent.table.TableHeaderPC;
import com.witness.web.uif.pagecomponent.toolbar.ToolbarPC;
import com.witness.web.uif.pagemodel.WorkpaneFormPageModel;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.system.manager.impl.DefaultVerticalizationManager;
import com.witness.web.uif.util.HtmlUtil;
import com.witness.web.uif.util.html.HtmlLinkUtil;
import com.witness.web.uif.util.js.JSUtil;

/**
 * Title: QueueMappingPM Description: Display the page for mapping Queues to
 * datasources Copyright: Copyright (c) 2003 Company: Blue Pumpkin Software, inc
 *
 * @author Swati Tewari
 * @version 1.0
 */
public class QueueMappingPM extends WorkpaneFormPageModel {
<span class="fc" id="L66">    private static final Category log = Log.initCategory(QueueMappingPM.class.getName());</span>
    protected ResourceBundle m_bbmBundle;
    private final AdvancedAssignBoxPC m_groupsAssignBox;
<span class="nc" id="L69">    private boolean m_isInitiated = false;</span>
<span class="nc" id="L70">    private final ArrayList m_mappedGroupsIDs = new ArrayList();</span>
    private String m_mappedGroups;
    private HashMap m_allGroupsMap;
<span class="nc" id="L73">    private boolean m_showMappedGroups = true;</span>
<span class="nc" id="L74">    private Collection m_allMappedGroups = Collections.emptyList();</span>
<span class="nc" id="L75">    private ID m_datasourceID = new ID(&quot;-1&quot;);// default all</span>
<span class="nc" id="L76">    private ID m_organizationID = null;</span>
    private final ContainerPC m_containerPC;
    private HashMap m_allDSMap;
    private Collection&lt;DataSource&gt; sortedDSList;
    private Collection m_mappedGroupIDs;
    private boolean isOrgScoped;

<span class="nc" id="L83">    private int m_limitingPageSize = 0;</span>
    private final FormInputPC m_searchInputPC;

    public static final String DATA_SOURCE_MAPPING_URL = &quot;datasources_group_fs&quot;;
    public static final String DATA_SOURCE = &quot;DATA_SOURCE&quot;;

    // sort actions
    public static final String LIST_NAME_SRC_SORT = &quot;LIST_NAME_SRC_SORT&quot;;
    public static final String LIST_MAPPED_SRC_SORT = &quot;LIST_MAPPED_SRC_SORT&quot;;
    public static final String LIST_MAPPED_DST_SORT = &quot;LIST_MAPPED_DST_SORT&quot;;
    public static final String LIST_DATASOURCE_SRC_SORT = &quot;LIST_DATASOURCE_SRC_SORT&quot;;
    public static final String LIST_NAME_DST_SORT = &quot;LIST_NAME_DST_SORT&quot;;
    public static final String LIST_DATASOURCE_DST_SORT = &quot;LIST_DATASOURCE_DST_SORT&quot;;

    protected static final String ROW_HEIGHT = &quot;18&quot;;
    protected static final String DEFAULT_LABEL_STYLE_CLASS = &quot;headerText&quot;;
    protected static final String DEFAULT_LABEL_STYLE = &quot;white-space:nowrap;&quot;;

    protected static final int MAX_DSG_COUNT = 5000; // Limit page size to 5000
                                                     // for the
                                                     // DataSourceGroup
                                                     // screen, if this value
                                                     // is not configured in
                                                     // BPCONFIG for key
                                                     // &quot;bluepumpkin/dsg/pageIDSizeLimit&quot;
    protected static final int DEFAULT_DSG_COUNT = 200;

    public static final String DSG_LIMIT_COUNT_HTML_NAME = &quot;dsLimitCount&quot;;

    public QueueMappingPM(RequestContext context) {
<span class="nc" id="L113">        super(context, QueueMappingPM.FRAMED_MODEL);</span>
<span class="nc" id="L114">        m_bbmBundle = m_localizer.getBundle(BbmWebBundleKey.BUNDLE_NAME);</span>

<span class="nc" id="L116">        m_groupsAssignBox = new AdvancedAssignBoxPC(context);</span>
<span class="nc" id="L117">        addChildComponent(m_groupsAssignBox);</span>
<span class="nc" id="L118">        m_groupsAssignBox.setName(getName() + &quot;_assignmentbox&quot;);</span>

<span class="nc" id="L120">        m_containerPC = new ContainerPC(context);</span>
<span class="nc" id="L121">        addChildComponent(m_containerPC);</span>

        // Component specific required JavaScript Files
<span class="nc" id="L124">        addRequiredJavaScriptFile(JavaScriptFileID.MEDIATOR_WORKPANE);</span>
<span class="nc" id="L125">        setJSMediator(WfmJavaScriptFileID.MEDIATOR_QUEUE_WORKPANE_FORM);</span>

        // JQuery file added for the new dynamic DSG search
<span class="nc" id="L128">        addRequiredJavaScriptFile(JavaScriptFileID.JQUERY);</span>

        // Add JavaScript Variables
<span class="nc" id="L131">        addJSVariable(DELETE_CONFIRMATION, m_bbmBundle, BbmWebBundleKey.DATASOURCE_DELETE_CONFIRM);</span>
        // Add JavaScript Variables
<span class="nc" id="L133">        addJSVariable(&quot;LOSE_CHANGES&quot;, m_bbmBundle, BbmWebBundleKey.QUEUE_LOSE_CHANGES);</span>

        // People search messages
<span class="nc" id="L136">        addJSVariable(&quot;topResultsMsg&quot;, JSUtil.createStringLiteral(m_localizer.i18n(BbmWebBundleKey.BUNDLE_NAME, BbmWebBundleKey.EMPLOYEE_SEARCH_SHOWING_TOP_100_RESULTS)));</span>
<span class="nc" id="L137">        addJSVariable(&quot;xResults&quot;, JSUtil.createStringLiteral(m_localizer.i18n(BbmWebBundleKey.BUNDLE_NAME, BbmWebBundleKey.EMPLOYEE_SEARCH_X_RESULTS, &quot;{0}&quot;)));</span>

        // People search client-side logic.
<span class="nc" id="L140">        addRequiredJavaScriptFile(BbmJavaScriptFileID.DSG_SEARCH);</span>

        // Input box for the people search function.
<span class="nc" id="L143">        m_searchInputPC = new FormInputPC(m_context);</span>
<span class="nc" id="L144">        m_searchInputPC.reset();</span>
<span class="nc" id="L145">        m_searchInputPC.setInputFN(&quot;dsgSearchString&quot;);</span>
<span class="nc" id="L146">        m_searchInputPC.setStyle(&quot;width:134px; left:3px; top:-5px; margin-top: 5px;&quot;);</span>
<span class="nc" id="L147">        m_searchInputPC.setOnChangeJS(&quot;&quot;);</span>
<span class="nc" id="L148">        m_searchInputPC.setIsRequired(false);</span>
<span class="nc" id="L149">        m_limitingPageSize = DEFAULT_DSG_COUNT;</span>
<span class="nc" id="L150">        setLimitingPageSize();</span>
<span class="nc" id="L151">    }</span>

    @Override
    public void initForDisplay() {
<span class="nc bnc" id="L155" title="All 2 branches missed.">        if (m_isInitializedForDisplay) {</span>
<span class="nc" id="L156">            return;</span>
        } else {
<span class="nc" id="L158">            super.initForDisplay();</span>

<span class="nc" id="L160">            this.setSelectedID(OrganizationUtil.getSelectedOrganizationID(m_context));</span>
<span class="nc" id="L161">            QueueUtil.setSelectedQueueID(m_context, this.getPerformActionOnID());</span>

<span class="nc" id="L163">            m_context.setAttribute(RequestContext.SESSION_SCOPE, &quot;CACHED_QUEUE_ID&quot;, this.getPerformActionOnID());</span>

            // Init the form and toolbar should be called only after loading the
            // data. These components
            // need Data from the Back-End. The assumtion is that
            // populateModel() is called before initForDisplay
<span class="nc" id="L169">            initToolbar();</span>
        }
<span class="nc" id="L171">    }</span>

    public static QueueMappingPM getInstance(RequestContext context) {
<span class="nc" id="L174">        QueueMappingPM model = null;</span>
<span class="nc" id="L175">        model = new QueueMappingPM(context);</span>
<span class="nc" id="L176">        model.extractParameters(context);</span>
<span class="nc" id="L177">        context.setPageModel(model);</span>

<span class="nc" id="L179">        model.populateModel(context);</span>
<span class="nc" id="L180">        return model;</span>
    }

    /**
     * Override extract Parameters to handle date input
     */
    public boolean extractParameters(RequestContext context) {
<span class="nc" id="L187">        final boolean success = super.extractParameters(context.getRequest());</span>
<span class="nc bnc" id="L188" title="All 2 branches missed.">        if (m_groupsAssignBox != null) {</span>
<span class="nc" id="L189">            m_groupsAssignBox.extractParameters(context.getRequest());</span>
        }
<span class="nc" id="L191">        return success;</span>
    }

    /**
     * Populate Model
     *
     */
    public void populateModel(RequestContext context) {
<span class="nc" id="L199">        int type = 0;</span>
<span class="nc bnc" id="L200" title="All 8 branches missed.">        if ((this.getPageAction() != null) &amp;&amp; (this.getPageAction().equals(PageAction.RESET) || this.getPageAction().equals(&quot;CHANGEDS_ACTION&quot;) || this.getPageAction().equals(PageAction.SAVE))) {</span>
<span class="nc" id="L201">            m_groupsAssignBox.resetExtractedIDs();</span>
        }
        try {

<span class="nc" id="L205">            this.setSelectedID(OrganizationUtil.getSelectedOrganizationID(m_context));</span>
<span class="nc" id="L206">            QueueUtil.setSelectedQueueID(m_context, this.getPerformActionOnID());</span>

<span class="nc bnc" id="L208" title="All 2 branches missed.">            if (this.hasPerformActionOnID()) {</span>
<span class="nc" id="L209">                type = WorkloadModelHandler.getQueueByID(m_context, new ID(this.getPerformActionOnID())).getQueueType();</span>
            }
            // type =
            // WorkloadModelHandler.getQueueByID(m_context,getSelectedIDObject()).getQueueType();
<span class="nc bnc" id="L213" title="All 4 branches missed.">            if (!hasPerformActionOnID() || (type != Queue.QUEUE_TYPE_NORMAL)) {</span>
<span class="nc" id="L214">                this.removeChildComponent(m_groupsAssignBox);</span>
            }

<span class="nc bnc" id="L217" title="All 2 branches missed.">            if (m_isInitiated) {</span>
<span class="nc" id="L218">                return;</span>
            } else {
<span class="nc" id="L220">                m_isInitiated = true;</span>
            }

            // verticalise queue
<span class="nc" id="L224">            final Object[] args = new Object[1];</span>
<span class="nc" id="L225">            args[0] = m_context.getSystemManagerFactory().getVerticalizationManager().getVerticalizedString(m_context, DefaultVerticalizationManager.QUEUESMALL);</span>

<span class="nc bnc" id="L227" title="All 2 branches missed.">            if (!isAuthorizedToConfigure()) {</span>
<span class="nc" id="L228">                addPageMessage(Message.INFO_TYPE, MessageFormat.format(m_localizer.i18n(m_bbmBundle, BbmWebBundleKey.QUEUE_NOTAUTHORIZED_CONFIGURE), args));</span>
            }

<span class="nc bnc" id="L231" title="All 2 branches missed.">            if (hasSelectedID()) {</span>
<span class="nc bnc" id="L232" title="All 2 branches missed.">                if (type != Queue.QUEUE_TYPE_NORMAL) {</span>
<span class="nc" id="L233">                    addPageMessage(Message.ERROR_TYPE, MessageFormat.format(m_localizer.i18n(m_bbmBundle, BbmWebBundleKey.QUEUE_GROUP_SELECTION_ERROR), args));</span>
<span class="nc" id="L234">                    m_initFailure = true;</span>
                } else {
<span class="nc" id="L236">                    addPageMessage(Message.INFO_TYPE, MessageFormat.format(m_localizer.i18n(m_bbmBundle, BbmWebBundleKey.UPTO_N_DATA_SOURCE_GROUPS_SHOWN), new Object[] { m_limitingPageSize }));</span>
<span class="nc" id="L237">                    initGroupsAssignBox();</span>
                }
            } else {
<span class="nc" id="L240">                addPageMessage(Message.RESPONSE_TYPE, MessageFormat.format(i18n(m_bbmBundle, BbmWebBundleKey.QUEUE_MAKE_SELECTION), args));</span>
            }
<span class="nc" id="L242">        } catch (final Exception ex) {</span>
<span class="nc" id="L243">            handleUnableToLoadDataError(log, ex);</span>
<span class="nc" id="L244">            m_initFailure = true;</span>
<span class="nc" id="L245">        }</span>

<span class="nc" id="L247">    }</span>

    /**
     * Initialize Toolbar
     */
    @Override
    protected void initToolbar() {
<span class="nc" id="L254">        m_toolbar.setName(getName() + &quot;_toolbar&quot;);</span>
<span class="nc" id="L255">        m_toolbar.setAlignment(ToolbarPC.ALIGN_RIGHT);</span>
<span class="nc bnc" id="L256" title="All 2 branches missed.">        final boolean isSelectedID = !StringUtil.isEmpty(this.getPerformActionOnID());</span>

<span class="nc" id="L258">        final String rh_URL = HtmlLinkUtil.getJSUrlHandler(DATA_SOURCE_MAPPING_URL);</span>
<span class="nc" id="L259">        m_toolbar.addJSTextButton(DATA_SOURCE, i18n(m_bbmBundle, BbmWebBundleKey.QUEUE_DSGROUP_BUTTON), isAuthorizedForDSGroup(), rh_URL);</span>

<span class="nc bnc" id="L261" title="All 4 branches missed.">        m_toolbar.addValidateSubmitTextButton(PageAction.SAVE, i18n(m_bbmBundle, BbmWebBundleKey.GROUP_MAPPING_SAVE_LABEL), isSelectedID &amp;&amp; isAuthorizedToConfigure());</span>

<span class="nc bnc" id="L263" title="All 4 branches missed.">        m_toolbar.addConfirmSubmitTextButton(PageAction.RESET, i18n(m_common_bundle, UIFWebBundleKey.TOOLBAR_RESET), isSelectedID &amp;&amp; isAuthorizedToConfigure());</span>

<span class="nc" id="L265">        m_toolbar.addConfirmSubmitTextButton(PageAction.CANCEL, i18n(m_common_bundle, UIFWebBundleKey.TOOLBAR_CANCEL), true);</span>
<span class="nc" id="L266">    }</span>

    /**
     * Initialize the Pay Rules Assignment box
     */
    private void initGroupsAssignBox() throws Exception {
        // verticalise queue
<span class="nc" id="L273">        final Object[] args = new Object[1];</span>
<span class="nc" id="L274">        args[0] = m_context.getSystemManagerFactory().getVerticalizationManager().getVerticalizedString(m_context, DefaultVerticalizationManager.QUEUE);</span>
<span class="nc" id="L275">        m_groupsAssignBox.setHeaderTitle(MessageFormat.format(i18n(m_bbmBundle, BbmWebBundleKey.GROUPS_MAPPING_LIST_TITLE), args));</span>

<span class="nc" id="L277">        Collection allGroups = Collections.emptyList();</span>
<span class="nc" id="L278">        List mappedGroups = Collections.emptyList();</span>
<span class="nc" id="L279">        m_allMappedGroups = QueueGroupMH.getLinkedGroupIDs(m_context);</span>
<span class="nc bnc" id="L280" title="All 2 branches missed.">        final ID queueId = !StringUtil.isEmpty(getPerformActionOnID()) ? new ID(getPerformActionOnID()) : null;</span>
<span class="nc" id="L281">        isOrgScoped = DataSourceModelHandler.isOrgScopedDataSource();</span>
<span class="nc bnc" id="L282" title="All 4 branches missed.">        if ((queueId != null) &amp;&amp; isOrgScoped) {</span>
<span class="nc" id="L283">            final WorkloadManager wlMgr = WfmManagerFactory.getWorkloadManager();</span>
<span class="nc" id="L284">            setOrganizationID(wlMgr.getQueueByID(queueId).getOrganizationID());</span>
        }
<span class="nc" id="L286">        setAllDatasourceMap();</span>

<span class="nc" id="L288">        m_showMappedGroups = QueueGroupMH.isShowMappedGroups();</span>
<span class="nc bnc" id="L289" title="All 2 branches missed.">        if (queueId != null) {</span>
            // Map to store the DSG's already mapped to the queue
<span class="nc" id="L291">            m_mappedGroupIDs = QueueGroupMH.getLinkedGroupIDsForQueue(queueId);</span>
<span class="nc" id="L292">            m_datasourceID = getDataSourceId(m_mappedGroupIDs, isOrgScoped, m_datasourceID, m_allDSMap);</span>
        }

<span class="nc" id="L295">        createGroupsMap();</span>

        try {
<span class="nc" id="L298">            ArrayList availGroupCall = new ArrayList();</span>

<span class="nc" id="L300">            availGroupCall = (ArrayList) GroupMH.getGroupsByDatasource(this.getDatasourceID());</span>

<span class="nc" id="L302">            allGroups = getAllGroups(availGroupCall);</span>
<span class="nc" id="L303">        } catch (final Exception ex) {</span>
<span class="nc" id="L304">            log.l7dError(BbmWebLogBundleKey.QUEUE_GET_ALL_DS_FAIL, ex);</span>
<span class="nc" id="L305">            addPageMessage(Message.ERROR_TYPE, BbmWebBundleKey.QUEUE_GET_ALL_DS_FAIL, BbmWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L306">            return;</span>
<span class="nc" id="L307">        }</span>

<span class="nc" id="L309">        final StringBuffer sbfLeftTitle = new StringBuffer(1024);</span>
<span class="nc" id="L310">        sbfLeftTitle.append(i18n(m_bbmBundle, BbmWebBundleKey.AVAILABLE_GROUPS_HEADING));</span>
<span class="nc" id="L311">        sbfLeftTitle.append(&quot;&lt;br&gt;&lt;span style=\&quot;white-space:nowrap;\&quot;&gt;&quot;);</span>
<span class="nc bnc" id="L312" title="All 2 branches missed.">        sbfLeftTitle.append(HtmlUtil.makeSelectInput(&quot;datasourceID&quot;, m_datasourceID != null ? m_datasourceID.toString() : &quot;&quot;, &quot;changeDS();&quot;, getDatasourceStringsPair()));</span>
<span class="nc" id="L313">        sbfLeftTitle.append(&quot;&lt;/span&gt;&quot;);</span>
<span class="nc" id="L314">        sbfLeftTitle.append(&quot;&lt;br&gt;&lt;span style=\&quot;white-space:nowrap;\&quot;&gt;&quot;);</span>
<span class="nc" id="L315">        sbfLeftTitle.append(this.createSearchBox());</span>
<span class="nc" id="L316">        sbfLeftTitle.append(&quot;&lt;/span&gt;&quot;);</span>

<span class="nc" id="L318">        m_groupsAssignBox.setLeftTitle(sbfLeftTitle.toString());</span>
        // m_groupsAssignBox.setLeftTitle(i18n(m_bbmBundle,
        // BbmWebBundleKey.AVAILABLE_GROUPS_HEADING) +
        // &quot;&lt;br&gt;&lt;span style=\&quot;white-space:nowrap;\&quot;&gt;&quot; +
        // HtmlUtil.makeSelectInput(&quot;datasourceID&quot;, m_datasourceID != null ?
        // m_datasourceID.toString() : &quot;&quot;, &quot;changeDS();&quot;,
        // getDatasourceStringsPair()) + &quot;&lt;/span&gt;&quot;);
<span class="nc" id="L325">        m_groupsAssignBox.setRightTitle(i18n(m_bbmBundle, BbmWebBundleKey.MAPPED_GROUPS_HEADING) + &quot;&lt;br&gt;&amp;nbsp;&quot;);</span>

        try {
<span class="nc bnc" id="L328" title="All 2 branches missed.">            if (queueId != null) {</span>
<span class="nc bnc" id="L329" title="All 2 branches missed.">                if (m_mappedGroupIDs != null) {</span>
<span class="nc" id="L330">                    mappedGroups = getMappedGroups(m_mappedGroupIDs);</span>
<span class="nc" id="L331">                    m_mappedGroups = StringUtil.createDelimitedString(m_mappedGroupIDs, &quot;,&quot;);</span>
<span class="nc bnc" id="L332" title="All 2 branches missed.">                    if (mappedGroups != null) {</span>
<span class="nc bnc" id="L333" title="All 2 branches missed.">                        for (final Iterator it = mappedGroups.iterator(); it.hasNext();) {</span>
<span class="nc" id="L334">                            final DefaultMultiColumnNodeData data = (DefaultMultiColumnNodeData) it.next();</span>
<span class="nc" id="L335">                            m_mappedGroupsIDs.add(data.getID());</span>
<span class="nc" id="L336">                        }</span>
                    }
                }
            }
<span class="nc" id="L340">        } catch (final Exception ex) {</span>
<span class="nc" id="L341">            log.l7dError(BbmWebLogBundleKey.QUEUE_GET_MAPPED_DS_FAIL, ex);</span>
<span class="nc" id="L342">            addPageMessage(Message.ERROR_TYPE, BbmWebBundleKey.QUEUE_GET_MAPPED_DS_FAIL, BbmWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L343">            return;</span>
<span class="nc" id="L344">        }</span>

<span class="nc bnc" id="L346" title="All 2 branches missed.">        if (allGroups == null) {</span>
<span class="nc" id="L347">            allGroups = Collections.emptyList();</span>
        }
<span class="nc bnc" id="L349" title="All 2 branches missed.">        if (mappedGroups == null) {</span>
<span class="nc" id="L350">            mappedGroups = Collections.emptyList();</span>
        }
<span class="nc" id="L352">        final int mappedGroupsSize = mappedGroups.size();</span>
<span class="nc" id="L353">        final int availableGroupsSize = allGroups.size() - mappedGroupsSize;</span>
<span class="nc bnc" id="L354" title="All 2 branches missed.">        final int initialCapacity = availableGroupsSize &gt; 0 ? availableGroupsSize : 0;</span>
<span class="nc" id="L355">        final ArrayList availableGroups = new ArrayList(initialCapacity);</span>
<span class="nc" id="L356">        final Map&lt;String, DefaultMultiColumnNodeData&gt; mapOfAllGroups = makeGroupMapFromList(allGroups);</span>
<span class="nc" id="L357">        final Map&lt;String, DefaultMultiColumnNodeData&gt; mapOfMappedGroups = makeGroupMapFromList(mappedGroups);</span>
<span class="nc" id="L358">        int allFound = 0;</span>

<span class="nc bnc" id="L360" title="All 2 branches missed.">        for (final Iterator it1 = mapOfAllGroups.keySet().iterator(); it1.hasNext();) {</span>
<span class="nc bnc" id="L361" title="All 2 branches missed.">            if (allFound &gt;= m_limitingPageSize) {</span>
<span class="nc" id="L362">                break;</span>
            }
<span class="nc" id="L364">            final String key = (String) it1.next();</span>

<span class="nc bnc" id="L366" title="All 2 branches missed.">            if (!mapOfMappedGroups.containsKey(key)) {</span>
<span class="nc" id="L367">                availableGroups.add(mapOfAllGroups.get(key));</span>
<span class="nc" id="L368">                allFound++;</span>
            }
<span class="nc" id="L370">        }</span>

<span class="nc" id="L372">        final TableHeaderPC leftHeader = m_groupsAssignBox.getSrcListPC().getHeader();</span>
        // Set up Headers
<span class="nc" id="L374">        leftHeader.addColumnHeaderData(LIST_NAME_SRC_SORT, i18n(m_bbmBundle, BbmWebBundleKey.QUEUE_DS_GROUP), true);</span>
<span class="nc bnc" id="L375" title="All 2 branches missed.">        if (m_showMappedGroups) {</span>
<span class="nc" id="L376">            leftHeader.addColumnHeaderData(LIST_MAPPED_SRC_SORT, i18n(m_bbmBundle, BbmWebBundleKey.MAPPED), true);</span>
        }

        // Enable List Sorting
<span class="nc" id="L380">        leftHeader.setSortable(true);</span>
<span class="nc" id="L381">        leftHeader.setDefaultSortColumn(LIST_NAME_SRC_SORT);</span>

<span class="nc" id="L383">        final TableHeaderPC rightHeader = m_groupsAssignBox.getDstListPC().getHeader();</span>
        // Set up Headers
<span class="nc" id="L385">        rightHeader.addColumnHeaderData(LIST_NAME_DST_SORT, i18n(m_bbmBundle, BbmWebBundleKey.QUEUE_DS_GROUP), true);</span>
<span class="nc bnc" id="L386" title="All 2 branches missed.">        if (m_showMappedGroups) {</span>
<span class="nc" id="L387">            rightHeader.addColumnHeaderData(LIST_MAPPED_DST_SORT, i18n(m_bbmBundle, BbmWebBundleKey.MAPPED), true);</span>
        }

        // Enable List Sorting
<span class="nc" id="L391">        rightHeader.setSortable(true);</span>

<span class="nc" id="L393">        m_groupsAssignBox.setIsSortable(true);</span>
<span class="nc" id="L394">        m_groupsAssignBox.getSrcListPC().setWidth(&quot;225&quot;);</span>
<span class="nc" id="L395">        m_groupsAssignBox.getDstListPC().setWidth(&quot;225&quot;);</span>

<span class="nc" id="L397">        m_groupsAssignBox.getSrcListPC().setHeightInPixels(250);</span>
<span class="nc" id="L398">        m_groupsAssignBox.getDstListPC().setHeightInPixels(250);</span>

<span class="nc" id="L400">        m_groupsAssignBox.getSrcListPC().getHeader().setStyleClass(&quot;tableHeaderLightLeft&quot;);</span>
<span class="nc" id="L401">        m_groupsAssignBox.getDstListPC().getHeader().setStyleClass(&quot;tableHeaderLightLeft&quot;);</span>

<span class="nc" id="L403">        m_groupsAssignBox.getSrcListPC().getWrapper().setStyle(&quot;background-color:#F7F7F7; border:0px solid #D2D2D2; height: 250px; overflow: auto&quot;);</span>
<span class="nc" id="L404">        m_groupsAssignBox.getDstListPC().getWrapper().setStyle(&quot;background-color:#F7F7F7; border:0px solid #D2D2D2; height: 250px; overflow: auto&quot;);</span>

<span class="nc" id="L406">        m_groupsAssignBox.getSrcListPC().setListModel(availableGroups);</span>
<span class="nc" id="L407">        m_groupsAssignBox.getDstListPC().setListModel(mappedGroups);</span>

<span class="nc" id="L409">        m_containerPC.setTemplate(&quot;&lt;table&gt;&lt;tr&gt;&lt;td width = \&quot;*\&quot;&gt;{0}&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&quot;);</span>
<span class="nc" id="L410">        m_containerPC.addComponent(m_groupsAssignBox);</span>
<span class="nc" id="L411">    }</span>

    private ID getDataSourceId(Collection mappedGroupIDs, boolean isOrgScoped, ID defaultDatasourceID, HashMap allDSMap) throws Exception {

        ID datasourceID;

        // since groups are mapped, get the datasource for the first one
<span class="nc bnc" id="L418" title="All 4 branches missed.">        if ((mappedGroupIDs != null) &amp;&amp; (mappedGroupIDs.size() &gt; 0)) {</span>

<span class="nc bnc" id="L420" title="All 2 branches missed.">            if (isOrgScoped) {</span>
<span class="nc" id="L421">                boolean found = false;</span>
<span class="nc" id="L422">                datasourceID = new ID(&quot;-1&quot;);</span>
<span class="nc" id="L423">                final Iterator it = mappedGroupIDs.iterator();</span>
<span class="nc bnc" id="L424" title="All 4 branches missed.">                while (!found &amp;&amp; it.hasNext()) {</span>
<span class="nc bnc" id="L425" title="All 2 branches missed.">                    if (!allDSMap.entrySet().contains(datasourceID)) {</span>
<span class="nc" id="L426">                        Group thisGroup = GroupMH.getGroupByID((ID) it.next());</span>
<span class="nc" id="L427">                        datasourceID = thisGroup.getDatasourceID();</span>
<span class="nc" id="L428">                    } else {</span>
<span class="nc" id="L429">                        found = true;</span>
                    }
                }
<span class="nc bnc" id="L432" title="All 2 branches missed.">                if (datasourceID.equals(new ID(-1))) {</span>
<span class="nc bnc" id="L433" title="All 4 branches missed.">                    if ((allDSMap != null) &amp;&amp; (allDSMap.size() &gt; 0)) {</span>
<span class="nc" id="L434">                        datasourceID = (ID) allDSMap.keySet().iterator().next();</span>
                    }
                }
<span class="nc" id="L437">            } else {</span>
<span class="nc" id="L438">                Group thisGroup = GroupMH.getGroupByID((ID) mappedGroupIDs.iterator().next());</span>
<span class="nc" id="L439">                datasourceID = thisGroup.getDatasourceID();</span>
<span class="nc" id="L440">            }</span>
        } else {
<span class="nc bnc" id="L442" title="All 6 branches missed.">            if (defaultDatasourceID.equals(new ID(-1)) &amp;&amp; (allDSMap != null) &amp;&amp; (allDSMap.size() &gt; 0)) {</span>
<span class="nc" id="L443">                datasourceID = (ID) allDSMap.keySet().iterator().next();</span>
            } else {
<span class="nc" id="L445">                datasourceID = defaultDatasourceID;</span>
            }
        }
<span class="nc" id="L448">        return datasourceID;</span>
    }

    private String createSearchBox() {

<span class="nc" id="L453">        final ArrayList&lt;HtmlTableCell&gt; cells = new ArrayList&lt;HtmlTableCell&gt;();</span>
<span class="nc" id="L454">        final HtmlTableCell cell = createLabelCell(m_localizer.i18n(BbmWebBundleKey.BUNDLE_NAME, BbmWebBundleKey.EMPLOYEE_SEARCH_INPUT_LABEL));</span>
<span class="nc" id="L455">        cells.add(cell);</span>

<span class="nc" id="L457">        final HtmlImage searchIcon = new HtmlImage(BbmImageFileID.SEARCH, m_localizer.i18n(BbmWebBundleKey.BUNDLE_NAME, BbmWebBundleKey.SEARCH));</span>
<span class="nc" id="L458">        searchIcon.setWidth(&quot;16&quot;);</span>
<span class="nc" id="L459">        searchIcon.setHeight(&quot;16&quot;);</span>

<span class="nc" id="L461">        final HtmlButton searchButton = new HtmlButton(&quot;dataSourceSearchButton&quot;);</span>
<span class="nc" id="L462">        searchButton.setStyle(&quot;border: #7386ad 1px solid; padding: 0px; border-left: none; height: 18px; cursor: pointer; margin-top: 5px;&quot;);</span>
<span class="nc" id="L463">        searchButton.setInnerHtml(searchIcon);</span>

<span class="nc" id="L465">        final HtmlImage ajaxLoading = new HtmlImage(BbmImageFileID.AJAX_LOADING, m_localizer.i18n(BbmWebBundleKey.BUNDLE_NAME, BbmWebBundleKey.LOADING_DATA));</span>
<span class="nc" id="L466">        ajaxLoading.setWidth(&quot;14&quot;);</span>
<span class="nc" id="L467">        ajaxLoading.setHeight(&quot;14&quot;);</span>
<span class="nc" id="L468">        ajaxLoading.setStyleClass(&quot;employeeSearchLoading&quot;);</span>
<span class="nc" id="L469">        ajaxLoading.setStyle(&quot;display: none;&quot;);</span>

<span class="nc" id="L471">        return m_searchInputPC.toString() + searchButton.toString() + ajaxLoading.toString();</span>
    }

    protected HtmlTableCell createLabelCell(String label) {
<span class="nc" id="L475">        final HtmlTableCell cell = new HtmlTableCell(label + &quot;&amp;nbsp;&quot;);</span>
        // cell.setWidth(&quot;35&quot;);
<span class="nc" id="L477">        cell.setHeight(ROW_HEIGHT);</span>
<span class="nc" id="L478">        cell.setStyleClass(DEFAULT_LABEL_STYLE_CLASS);</span>
<span class="nc" id="L479">        cell.setStyle(DEFAULT_LABEL_STYLE);</span>
<span class="nc" id="L480">        return cell;</span>
    }

    private void createGroupsMap() throws Exception {
<span class="nc" id="L484">        ArrayList allGroups = null;</span>

<span class="nc" id="L486">        allGroups = (ArrayList) QueueGroupMH.getAllGroups();</span>

<span class="nc" id="L488">        m_allGroupsMap = new HashMap(allGroups.size());</span>
<span class="nc bnc" id="L489" title="All 2 branches missed.">        for (final Iterator it = allGroups.iterator(); it.hasNext();) {</span>
<span class="nc" id="L490">            final Group group = (Group) it.next();</span>
<span class="nc" id="L491">            m_allGroupsMap.put(group.getID(), group);</span>
<span class="nc" id="L492">        }</span>
<span class="nc" id="L493">    }</span>

    private void setAllDatasourceMap() throws Exception {
<span class="nc" id="L496">        Collection allDatasources = null;</span>
<span class="nc bnc" id="L497" title="All 2 branches missed.">        if (isOrgScoped) {</span>
<span class="nc" id="L498">            allDatasources = DataSourceModelHandler.getParentDataSources(null, getOrganizationID());</span>
        } else {
<span class="nc" id="L500">            allDatasources = DataSourceModelHandler.getParentDataSources(null);</span>
        }
<span class="nc bnc" id="L502" title="All 2 branches missed.">        if (allDatasources != null) {</span>
<span class="nc" id="L503">            m_allDSMap = new HashMap(allDatasources.size());</span>
<span class="nc" id="L504">            sortedDSList = allDatasources;</span>
<span class="nc" id="L505">            DataSource ds = null;</span>
<span class="nc bnc" id="L506" title="All 2 branches missed.">            for (final Iterator it = allDatasources.iterator(); it.hasNext();) {</span>
<span class="nc" id="L507">                ds = (DataSource) it.next();</span>
<span class="nc" id="L508">                m_allDSMap.put(ds.getID(), ds);</span>
            }
        }
<span class="nc" id="L511">    }</span>

    /**
     * Return Collection of Media StringsPair (String mediaId, String mediaName)
     */
    private Collection getDatasourceStringsPair() throws Exception {

<span class="nc" id="L518">        final Collection dsStringsPair = new ArrayList(m_allGroupsMap.size());</span>

        /*
         * Using the sorted list coming from Model Handler. Making minimal
         * changes to fix this issue at this point.
         */
<span class="nc bnc" id="L524" title="All 2 branches missed.">        if (sortedDSList != null) {</span>
<span class="nc bnc" id="L525" title="All 2 branches missed.">            for (final DataSource ds : sortedDSList) {</span>
<span class="nc bnc" id="L526" title="All 6 branches missed.">                if ((m_mappedGroupIDs == null) || (m_mappedGroupIDs.size() == 0) || m_datasourceID.equals(ds.getID())) {</span>
<span class="nc" id="L527">                    dsStringsPair.add(new StringsPair(ds.getID().toString(), ds.getName()));</span>
                }
<span class="nc" id="L529">            }</span>
        }
        /*
         * if (m_allDSMap != null){ DataSource ds = null; Set keys =
         * m_allDSMap.keySet();
         *
         * for(Iterator it = keys.iterator(); it.hasNext();) { ds = (DataSource)
         * m_allDSMap.get(it.next()); if (m_mappedGroupIDs == null ||
         * m_mappedGroupIDs.size()==0 || m_datasourceID.equals(ds.getID()))
         * dsStringsPair.add(new StringsPair(ds.getID().toString(),
         * ds.getName()) ); } }
         */
<span class="nc" id="L541">        return dsStringsPair;</span>
    }

    /**
     * Returns a collection of assigned pay rules with WorkRule id, WorkRule
     * object and WorkRule description.
     */
    private List getMappedGroups(Collection mappedGroups) throws Exception {
<span class="nc" id="L549">        ArrayList data = null;</span>

        // Build the collection
<span class="nc bnc" id="L552" title="All 4 branches missed.">        if ((mappedGroups != null) &amp;&amp; (mappedGroups.size() &gt; 0)) {</span>
<span class="nc" id="L553">            data = new ArrayList(mappedGroups.size());</span>
<span class="nc bnc" id="L554" title="All 2 branches missed.">            for (final Iterator it = mappedGroups.iterator(); it.hasNext();) {</span>
<span class="nc" id="L555">                final ID groupID = (ID) it.next();</span>
<span class="nc bnc" id="L556" title="All 2 branches missed.">                if (m_allGroupsMap.get(groupID) != null) {</span>
<span class="nc" id="L557">                    final Group thisGroup = (Group) m_allGroupsMap.get(groupID);</span>
<span class="nc" id="L558">                    final ArrayList rowData = new ArrayList(2);</span>
<span class="nc" id="L559">                    rowData.add(thisGroup.getName());</span>
<span class="nc bnc" id="L560" title="All 2 branches missed.">                    if (m_showMappedGroups) {</span>
<span class="nc" id="L561">                        rowData.add(i18n(m_bbmBundle, BbmWebBundleKey.MAPPED));</span>
                    }

<span class="nc" id="L564">                    final DefaultMultiColumnNodeData nodeData = new DefaultMultiColumnNodeData(thisGroup.getID().toString(), rowData);</span>

<span class="nc" id="L566">                    data.add(nodeData);</span>
                }
<span class="nc" id="L568">            }</span>
        }

<span class="nc" id="L571">        return data;</span>
    }

    /**
     * Returns a collection of assigned pay rules with WorkRule id, WorkRule
     * object and WorkRule description.
     */
    public Collection getAllGroups(Collection allGroups) throws Exception {
<span class="nc" id="L579">        ArrayList data = new ArrayList();</span>
<span class="nc" id="L580">        int rowCnt = 0;</span>

        // Build the collection
<span class="nc bnc" id="L583" title="All 4 branches missed.">        if ((allGroups != null) &amp;&amp; (allGroups.size() &gt; 0)) {</span>
<span class="nc" id="L584">            data = new ArrayList(allGroups.size());</span>
<span class="nc bnc" id="L585" title="All 4 branches missed.">            for (final Iterator it = allGroups.iterator(); it.hasNext() &amp;&amp; (rowCnt &lt;= m_limitingPageSize);) {</span>
<span class="nc" id="L586">                final Group group = (Group) it.next();</span>
<span class="nc" id="L587">                final ArrayList rowData = new ArrayList(2);</span>
<span class="nc bnc" id="L588" title="All 2 branches missed.">                if (m_showMappedGroups) {</span>
<span class="nc" id="L589">                    rowData.add(group.getName());</span>
<span class="nc bnc" id="L590" title="All 2 branches missed.">                    if (m_allMappedGroups.contains(group.getID())) {</span>
<span class="nc" id="L591">                        rowData.add(i18n(m_bbmBundle, BbmWebBundleKey.MAPPED));</span>
                    } else {
<span class="nc" id="L593">                        rowData.add(&quot;&quot;);</span>
                    }
                } else {
<span class="nc bnc" id="L596" title="All 2 branches missed.">                    if (!m_allMappedGroups.contains(group.getID())) {</span>
<span class="nc" id="L597">                        rowData.add(group.getName());</span>
                    } else {
                        continue;
                    }
                }

<span class="nc" id="L603">                final DefaultMultiColumnNodeData nodeData = new DefaultMultiColumnNodeData(group.getID().toString(), rowData);</span>

<span class="nc" id="L605">                data.add(nodeData);</span>
<span class="nc" id="L606">                rowCnt++;</span>
<span class="nc" id="L607">            }</span>
        }

<span class="nc" id="L610">        return data;</span>
    }

    @Override
    public void initFieldValidators() {

<span class="nc" id="L616">    }</span>

    /**
     * Return Required HTML
     */
    @Override
    public String getRequiredHTML() {
<span class="nc" id="L623">        return super.getRequiredHTML() + HtmlUtil.makeHiddenInput(&quot;curGroupID&quot;, m_mappedGroups) + HtmlUtil.makeHiddenInput(&quot;selectedID&quot;, this.getSelectedID()) + HtmlUtil.makeHiddenInput(&quot;performActionOnID&quot;, this.getPerformActionOnID()) + HtmlUtil.makeHiddenInput(&quot;dsLimitCount&quot;, m_limitingPageSize) + HtmlUtil.makeHiddenInput(IS_WORKPANE_MODE, true);</span>

    }

    /**
     * setCurGroupID
     */
    public void setCurGroupID(String curGroupID) {
<span class="nc" id="L631">        m_mappedGroups = curGroupID;</span>
<span class="nc" id="L632">    }</span>

    /**
     * getCurGroupID
     */
    public String getCurGroupID() {
<span class="nc" id="L638">        return m_mappedGroups;</span>
    }

    /**
     * setCurGroupID
     */
    public void setDatasourceID(ID curGroupID) {
<span class="nc" id="L645">        m_datasourceID = curGroupID;</span>
<span class="nc" id="L646">    }</span>

    /**
     * getCurGroupID
     */
    public ID getDatasourceID() {
<span class="nc" id="L652">        return m_datasourceID;</span>
    }

    /**
     * setOrganizationID
     */
    public void setOrganizationID(ID organizationID) {
<span class="nc" id="L659">        m_organizationID = organizationID;</span>
<span class="nc" id="L660">    }</span>

    /**
     * getOrganizationID
     */
    public ID getOrganizationID() {
<span class="nc" id="L666">        return m_organizationID;</span>
    }

    /**
     * getCurGroupID
     */
    public Collection getCurGroupIDColl() {
<span class="nc bnc" id="L673" title="All 2 branches missed.">        if (!StringUtil.isEmpty(m_mappedGroups)) {</span>
<span class="nc" id="L674">            return StringUtil.parseIDStringToCollection(m_mappedGroups);</span>
        } else {
<span class="nc" id="L676">            return null;</span>
        }
    }

    @Override
    public String getFormTitle() {
        // verticalise queue
<span class="nc" id="L683">        final Object[] args = new Object[1];</span>
<span class="nc" id="L684">        args[0] = m_context.getSystemManagerFactory().getVerticalizationManager().getVerticalizedString(m_context, DefaultVerticalizationManager.QUEUE);</span>

<span class="nc" id="L686">        return MessageFormat.format(i18n(m_bbmBundle, BbmWebBundleKey.ORG_WORKLOADS_GROUPS_MAPPING_LIST_TITLE), args);</span>
    }

    protected String getTitleEntityType() {
<span class="nc" id="L690">        return getFormTitle();</span>
    }

    /**
     * Returns an entity name. Used for title.
     */
    protected String getEntityName() {
<span class="nc" id="L697">        String name = &quot;&amp;nbsp;&quot;;</span>
        try {
<span class="nc bnc" id="L699" title="All 2 branches missed.">            if (hasSelectedID()) {</span>
<span class="nc" id="L700">                final Queue queue = WorkloadModelHandler.getQueueByID(m_context, new ID(getPerformActionOnID()));</span>
<span class="nc" id="L701">                name = queue.getName();</span>
            }
<span class="nc" id="L703">        } catch (final Exception ex) {</span>
<span class="nc" id="L704">        }</span>
<span class="nc" id="L705">        return name;</span>
    }

    /**
     * Return the title
     */
    @Override
    public ContentTitlePC getContentTitle() {
<span class="nc" id="L713">        final StringBuffer itemName = new StringBuffer(64);</span>

<span class="nc" id="L715">        m_contentTitlePC.setPageTitle(this.getTitleEntityType());</span>

        // Set the item name: [queue name]
<span class="nc" id="L718">        itemName.append(this.getEntityName());</span>

<span class="nc" id="L720">        m_contentTitlePC.setItemName(itemName.toString());</span>

<span class="nc" id="L722">        return m_contentTitlePC;</span>
    }

    /**
     * Return the Page Form Component associated with Page Model Use this method
     * if you have only one form
     */
    public PageComponent getContainerPC() {
<span class="nc" id="L730">        return m_containerPC;</span>
    }

    /**
     * Return URL for HTML Form Action
     */
    @Override
    public String getFormAction() {
<span class="nc" id="L738">        return &quot;queuegroup_mapping&quot;;</span>
    }

    public Collection getAssignedGroupIDs() {
<span class="nc" id="L742">        return m_groupsAssignBox.getDstListIDs();</span>
    }

    private boolean isAuthorizedForDSGroup() {
<span class="nc" id="L746">        final String privName = PrivilegeKeys.FS_VIEWDATASOURCEGROUPS;</span>
<span class="nc bnc" id="L747" title="All 4 branches missed.">        return (m_context.getUser() != null) &amp;&amp; m_context.getUser().isAuthorized(privName);</span>
    }

    @Override
    protected boolean isAuthorizedToConfigure() {
<span class="nc bnc" id="L752" title="All 4 branches missed.">        return (m_context.getUser() != null) &amp;&amp; m_context.getUser().isAuthorized(PrivilegeKeys.FS_CONFIGUREQUEUES);</span>
    }

    protected void createFormModel() {
<span class="nc" id="L756">        int type = 0;</span>
<span class="nc bnc" id="L757" title="All 8 branches missed.">        if ((this.getPageAction() != null) &amp;&amp; (this.getPageAction().equals(PageAction.RESET) || this.getPageAction().equals(&quot;CHANGEDS_ACTION&quot;) || this.getPageAction().equals(PageAction.SAVE))) {</span>
<span class="nc" id="L758">            m_groupsAssignBox.resetExtractedIDs();</span>
        }
        try {

<span class="nc" id="L762">            this.setSelectedID(OrganizationUtil.getSelectedOrganizationID(m_context));</span>
<span class="nc" id="L763">            QueueUtil.setSelectedQueueID(m_context, this.getPerformActionOnID());</span>

<span class="nc bnc" id="L765" title="All 2 branches missed.">            if (hasSelectedID()) {</span>
<span class="nc" id="L766">                type = WorkloadModelHandler.getQueueByID(m_context, new ID(QueueUtil.getSelectedQueueID(m_context))).getQueueType();</span>
            }
<span class="nc bnc" id="L768" title="All 4 branches missed.">            if (!hasSelectedID() || (type != Queue.QUEUE_TYPE_NORMAL)) {</span>
<span class="nc" id="L769">                this.removeChildComponent(m_groupsAssignBox);</span>
            }

<span class="nc bnc" id="L772" title="All 2 branches missed.">            if (m_isInitiated) {</span>
<span class="nc" id="L773">                return;</span>
            } else {
<span class="nc" id="L775">                m_isInitiated = true;</span>
            }

            // verticalise queue
<span class="nc" id="L779">            final Object[] args = new Object[1];</span>
<span class="nc" id="L780">            args[0] = m_context.getSystemManagerFactory().getVerticalizationManager().getVerticalizedString(m_context, DefaultVerticalizationManager.QUEUESMALL);</span>

<span class="nc bnc" id="L782" title="All 2 branches missed.">            if (!isAuthorizedToConfigure()) {</span>
<span class="nc" id="L783">                addPageMessage(Message.INFO_TYPE, MessageFormat.format(m_localizer.i18n(m_bbmBundle, BbmWebBundleKey.QUEUE_NOTAUTHORIZED_CONFIGURE), args));</span>
            }

<span class="nc bnc" id="L786" title="All 2 branches missed.">            if (hasSelectedID()) {</span>
<span class="nc bnc" id="L787" title="All 2 branches missed.">                if (type != Queue.QUEUE_TYPE_NORMAL) {</span>
<span class="nc" id="L788">                    addPageMessage(Message.ERROR_TYPE, MessageFormat.format(m_localizer.i18n(m_bbmBundle, BbmWebBundleKey.QUEUE_GROUP_SELECTION_ERROR), args));</span>
<span class="nc" id="L789">                    m_initFailure = true;</span>
                } else {
<span class="nc" id="L791">                    initGroupsAssignBox();</span>
                }
            } else {
<span class="nc" id="L794">                addPageMessage(Message.RESPONSE_TYPE, MessageFormat.format(i18n(m_bbmBundle, BbmWebBundleKey.QUEUE_MAKE_SELECTION), args));</span>
            }
<span class="nc" id="L796">        } catch (final Exception ex) {</span>
<span class="nc" id="L797">            handleUnableToLoadDataError(log, ex);</span>
<span class="nc" id="L798">            m_initFailure = true;</span>
<span class="nc" id="L799">        }</span>

<span class="nc" id="L801">    }</span>

    private Map&lt;String, DefaultMultiColumnNodeData&gt; makeGroupMapFromList(Collection&lt;DefaultMultiColumnNodeData&gt; groupColl) {
<span class="nc" id="L804">        final Map&lt;String, DefaultMultiColumnNodeData&gt; mapQGroup = new HashMap&lt;String, DefaultMultiColumnNodeData&gt;();</span>

<span class="nc bnc" id="L806" title="All 4 branches missed.">        if ((groupColl != null) &amp;&amp; !groupColl.isEmpty()) {</span>

<span class="nc bnc" id="L808" title="All 2 branches missed.">            for (final DefaultMultiColumnNodeData node : groupColl) {</span>

<span class="nc" id="L810">                mapQGroup.put(node.getID(), node);</span>
<span class="nc" id="L811">            }</span>
        }

<span class="nc" id="L814">        return mapQGroup;</span>
    }

    /**
     * Sets the maximum page size for the requests screens. The default value is
     * DEFAULT_DSG_COUNT , unless overridden by the BPCONFIG key
     * &quot;bluepumpkin/rm/pageIDSizeLimit&quot;
     */
    public int readLimitingPageSize() {
<span class="nc" id="L823">        int limitingPageSize = 0;</span>
        try {
<span class="nc" id="L825">            final String pageIDSizeFetched = BbmManagerFactory.getDBConfigManager().getValue(ConfigKey.DS_PAGE_ID_SIZE_LIMIT);</span>
<span class="nc bnc" id="L826" title="All 2 branches missed.">            if (pageIDSizeFetched != null) {</span>
<span class="nc" id="L827">                limitingPageSize = Integer.parseInt(pageIDSizeFetched);</span>
            } else {
<span class="nc" id="L829">                limitingPageSize = QueueMappingPM.DEFAULT_DSG_COUNT;</span>
            }
<span class="nc bnc" id="L831" title="All 4 branches missed.">            if ((limitingPageSize &lt;= 0) || (limitingPageSize &gt; QueueMappingPM.MAX_DSG_COUNT)) {</span>
<span class="nc" id="L832">                limitingPageSize = QueueMappingPM.DEFAULT_DSG_COUNT;</span>
            }

<span class="nc" id="L835">        } catch (final Exception ex) {</span>
            // ignoring any exception caught.
<span class="nc" id="L837">        }</span>
<span class="nc" id="L838">        return limitingPageSize;</span>
    }

    protected void setLimitingPageSize() {
<span class="nc" id="L842">        m_limitingPageSize = readLimitingPageSize();</span>
<span class="nc" id="L843">    }</span>

    @Override
    protected void initForm() {

<span class="nc" id="L848">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>