<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>ActivityRMUsage.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.bbm.activity</a> &gt; <span class="el_source">ActivityRMUsage.java</span></div><h1>ActivityRMUsage.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.bbm.activity;

import java.util.ArrayList;
import java.util.ResourceBundle;

import javax.servlet.http.HttpServletRequest;

import com.bluepumpkin.common.datatypes.StringsPair;
import com.bluepumpkin.common.util.StringUtil;
import com.bluepumpkin.ejb.bbm.activity.model.Activity;
import com.bluepumpkin.ejb.bbm.activity.model.ActivityCategory;
import com.bluepumpkin.ejb.bbm.activity.model.ActivityProperties;
import com.bluepumpkin.ejb.rm.requests.timeoff.ejb.TOAccrualCalculator;
import com.bluepumpkin.ejb.rm.util.LicenseUtil;
import com.bluepumpkin.web.bbm.l10n.BbmWebBundleKey;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.util.HtmlUtil;
import com.witness.web.uif.util.html.HtmlChoiceInput;
import com.witness.web.uif.util.js.JSUtil;

/**
 * Title: ActivityRMUsage Description: A collapsable container for the Activity's Request Management usage attributes Copyright:
 * Copyright (c) 2002 Company: Blue Pumpkin Software, Inc
 *
 * @author Shimon Kakon
 * @version 1.0
 */
public class ActivityRMUsage extends ActivityUsage {

	private ActivityCategory m_activityType;

	public ActivityRMUsage(RequestContext context, ResourceBundle bundle, Activity activity, ActivityProperties activityProperties) {
<span class="fc" id="L33">		super(context, bundle, activity, activityProperties);</span>
<span class="fc" id="L34">	}</span>

	@Override
	public boolean extractParameters(HttpServletRequest request) {
		// Requestable
<span class="fc" id="L39">		String boolValue = request.getParameter(ActivityFields.REQUESTABLE_FN);</span>
<span class="pc bpc" id="L40" title="1 of 2 branches missed.">		m_activity.setRequestable((!StringUtil.isEmpty(boolValue)) ? true : false);</span>

<span class="fc" id="L42">		boolValue = request.getParameter(ActivityFields.USE_DAILY_TOPOOL_FN);</span>
<span class="pc bpc" id="L43" title="1 of 2 branches missed.">		activityProperties.setUseDailyTOPool((!StringUtil.isEmpty(boolValue)) ? true : false);</span>

<span class="fc" id="L45">		boolValue = request.getParameter(ActivityFields.USE_INTERVAL_TOPOOL_FN);</span>
<span class="pc bpc" id="L46" title="1 of 2 branches missed.">		activityProperties.setUseIntervalTOPool((!StringUtil.isEmpty(boolValue)) ? true : false);</span>

<span class="fc" id="L48">		String flex = request.getParameter(ActivityFields.TIMEOFF_WITH_FLEX_FN);</span>
<span class="pc bpc" id="L49" title="1 of 2 branches missed.">		activityProperties.setTimeoffWithFlex(!StringUtil.isEmpty(flex) ? Integer.valueOf(flex).intValue() : ActivityProperties.TIME_OFF_TIME);</span>
<span class="pc bpc" id="L50" title="1 of 2 branches missed.">		if (isActivityTypeWithAllotment()) {// sync activity fields with its category</span>
<span class="nc" id="L51">			m_activity.setTimeoffWithAllotment(true);</span>
<span class="nc" id="L52">			m_activity.setTOAccrualSchedule(getActivityType().getTOAccrualSchedule());</span>
<span class="nc" id="L53">			m_activity.setTOAccrualPolicy(getActivityType().getTOAccrualPolicy());</span>
		} else {
			// Allotment
<span class="fc" id="L56">			boolValue = request.getParameter(ActivityFields.TIMEOFF_WITH_ALLOTMENT_FN);</span>
<span class="pc bpc" id="L57" title="1 of 2 branches missed.">			m_activity.setTimeoffWithAllotment((!StringUtil.isEmpty(boolValue)) ? true : false);</span>
			// Accrual Schedule
<span class="fc" id="L59">			String value = request.getParameter(ActivityFields.TIMEOFF_ACCRUAL_SCHEDULE_FN);</span>
<span class="fc bfc" id="L60" title="All 2 branches covered.">			if (!StringUtil.isEmpty(value)) {</span>
				try {
<span class="fc" id="L62">					m_activity.setTOAccrualSchedule(Integer.valueOf(value).intValue());</span>
<span class="nc" id="L63">				} catch (NumberFormatException e) {</span>
<span class="fc" id="L64">				}</span>
			}
			// Accrual Policy
<span class="fc" id="L67">			value = request.getParameter(ActivityFields.TIMEOFF_ACCRUAL_POLICY_FN);</span>
<span class="fc bfc" id="L68" title="All 2 branches covered.">			if (!StringUtil.isEmpty(value)) {</span>
				try {
<span class="fc" id="L70">					m_activity.setTOAccrualPolicy(Integer.valueOf(value).intValue());</span>
<span class="nc" id="L71">				} catch (NumberFormatException e) {</span>
<span class="fc" id="L72">				}</span>
			}
		}
<span class="fc" id="L75">		return true;</span>
	}

	@Override
	public void initForDisplay() {
<span class="pc bpc" id="L80" title="1 of 2 branches missed.">		if (m_isInitializedForDisplay) {</span>
<span class="nc" id="L81">			return;</span>
		} else {
<span class="fc" id="L83">			super.initForDisplay();</span>
<span class="pc bpc" id="L84" title="1 of 2 branches missed.">			if (m_visible) {</span>
<span class="fc" id="L85">				setTitle(i18n(m_bundle, BbmWebBundleKey.ACTIVITY_TITLE_RM_USAGE));</span>
<span class="fc" id="L86">				setName(&quot;rmUsage&quot;);</span>
			}
		}
<span class="fc" id="L89">	}</span>

	@Override
	protected void initFields() {
<span class="fc" id="L93">		boolean hasRMAdvanceLicense = LicenseUtil.isAdvancedRMLicense();</span>
<span class="fc" id="L94">		boolean hasLicense = TOAccrualCalculator.hasLicenseForAccrual();</span>

<span class="pc bpc" id="L96" title="1 of 2 branches missed.">		if (isActivityTypeWithAllotment()) {// sync activity fields with its category</span>
<span class="nc" id="L97">			m_activity.setTimeoffWithAllotment(true);</span>
<span class="nc" id="L98">			m_activity.setTOAccrualSchedule(getActivityType().getTOAccrualSchedule());</span>
<span class="nc" id="L99">			m_activity.setTOAccrualPolicy(getActivityType().getTOAccrualPolicy());</span>
		}

<span class="pc bpc" id="L102" title="1 of 2 branches missed.">		if (m_visible) {</span>
<span class="fc" id="L103">			m_fields = new StringBuffer(512);</span>
<span class="fc" id="L104">			int i = 0;</span>
			// Request-able
<span class="pc bpc" id="L106" title="3 of 4 branches missed.">			switch (m_displayMap[ActivityFields.REQUESTABLE]) {</span>
				case ActivityFields.EDITABLE:
<span class="fc" id="L108">					m_fields.append(addToTemplate(BbmWebBundleKey.ACTIVITY_LABEL_REQUESTABLE, i++));</span>
<span class="fc" id="L109">					addComponent(HtmlChoiceInput.makeChkBoxInput(ActivityFields.REQUESTABLE_FN, &quot;true&quot;, &quot;&quot;,</span>
<span class="fc" id="L110">							m_activity.isRequestable(), isFieldDisabled(ActivityFields.REQUESTABLE), ACTIVITY_FIELD_ON_CHANGE));</span>
<span class="fc" id="L111">					break;</span>
				case ActivityFields.DISPLAYABLE:
<span class="nc" id="L113">					m_fields.append(addToTemplate(BbmWebBundleKey.ACTIVITY_LABEL_REQUESTABLE, i++));</span>
<span class="nc" id="L114">					addComponent(m_localizer.formatYesNo(m_activity.isRequestable()));</span>
<span class="nc" id="L115">					addHiddenField(ActivityFields.REQUESTABLE);</span>
<span class="nc" id="L116">					break;</span>
				case ActivityFields.NON_DISPLAYABLE:
<span class="nc" id="L118">					addHiddenField(ActivityFields.REQUESTABLE);</span>
<span class="nc" id="L119">					break;</span>
				default:
<span class="nc" id="L121">					throw new IllegalStateException();</span>
			}

			// Add Daily &amp; Hourly controls if RMAdvanced License is present
<span class="pc bpc" id="L125" title="1 of 2 branches missed.">			if (hasRMAdvanceLicense) {</span>
				// Daily Time off Pool
<span class="nc bnc" id="L127" title="All 4 branches missed.">				switch (m_displayMap[ActivityFields.USE_DAILY_TOPOOL]) {</span>
					case ActivityFields.EDITABLE:
<span class="nc" id="L129">						m_fields.append(addToTemplate(BbmWebBundleKey.ACTIVITY_LABEL_USE_DAILY_TOPOOL, i++));</span>
<span class="nc" id="L130">						addComponent(HtmlChoiceInput.makeChkBoxInput(ActivityFields.USE_DAILY_TOPOOL_FN, &quot;true&quot;, &quot;&quot;,</span>
<span class="nc" id="L131">								activityProperties.isUseDailyTOPool(), isFieldDisabled(ActivityFields.USE_DAILY_TOPOOL), JSUtil.ON_CHANGE));</span>
<span class="nc" id="L132">						break;</span>
					case ActivityFields.DISPLAYABLE:
<span class="nc" id="L134">						m_fields.append(addToTemplate(BbmWebBundleKey.ACTIVITY_LABEL_USE_DAILY_TOPOOL, i++));</span>
<span class="nc" id="L135">						addComponent(m_localizer.formatYesNo(activityProperties.isUseDailyTOPool()));</span>
<span class="nc" id="L136">						addHiddenField(ActivityFields.USE_DAILY_TOPOOL);</span>
<span class="nc" id="L137">						break;</span>
					case ActivityFields.NON_DISPLAYABLE:
<span class="nc" id="L139">						addHiddenField(ActivityFields.USE_DAILY_TOPOOL);</span>
<span class="nc" id="L140">						break;</span>
					default:
<span class="nc" id="L142">						throw new IllegalStateException();</span>
				}

				// Hourly Time off Pool
<span class="nc bnc" id="L146" title="All 4 branches missed.">				switch (m_displayMap[ActivityFields.USE_INTERVAL_TOPOOL]) {</span>
					case ActivityFields.EDITABLE:
<span class="nc" id="L148">						m_fields.append(addToTemplate(BbmWebBundleKey.ACTIVITY_LABEL_USE_INTERVAL_TOPOOL, i++));</span>
<span class="nc" id="L149">						addComponent(HtmlChoiceInput.makeChkBoxInput(ActivityFields.USE_INTERVAL_TOPOOL_FN, &quot;true&quot;, &quot;&quot;,</span>
<span class="nc" id="L150">								activityProperties.isUseIntervalTOPool(), isFieldDisabled(ActivityFields.USE_INTERVAL_TOPOOL), JSUtil.ON_CHANGE));</span>
<span class="nc" id="L151">						break;</span>
					case ActivityFields.DISPLAYABLE:
<span class="nc" id="L153">						m_fields.append(addToTemplate(BbmWebBundleKey.ACTIVITY_LABEL_USE_INTERVAL_TOPOOL, i++));</span>
<span class="nc" id="L154">						addComponent(m_localizer.formatYesNo(activityProperties.isUseIntervalTOPool()));</span>
<span class="nc" id="L155">						addHiddenField(ActivityFields.USE_INTERVAL_TOPOOL);</span>
<span class="nc" id="L156">						break;</span>
					case ActivityFields.NON_DISPLAYABLE:
<span class="nc" id="L158">						addHiddenField(ActivityFields.USE_INTERVAL_TOPOOL);</span>
<span class="nc" id="L159">						break;</span>
					default:
<span class="nc" id="L161">						throw new IllegalStateException();</span>
				}
			} else {
<span class="fc" id="L164">				addHiddenField(ActivityFields.USE_DAILY_TOPOOL);</span>
<span class="fc" id="L165">				addHiddenField(ActivityFields.USE_INTERVAL_TOPOOL);</span>
			}

<span class="pc bpc" id="L168" title="1 of 2 branches missed.">			if (hasRMAdvanceLicense) {</span>
				// Flex Time
<span class="nc bnc" id="L170" title="All 4 branches missed.">				switch (m_displayMap[ActivityFields.TIMEOFF_WITH_FLEX]) {</span>
					case ActivityFields.EDITABLE:
<span class="nc" id="L172">						m_fields.append(addToTemplate(BbmWebBundleKey.ACTIVITY_LABEL_TIMEOFF_WITH_FLEX, i++));</span>
<span class="nc" id="L173">						addComponent(HtmlChoiceInput.makeChkBoxInput(ActivityFields.TIMEOFF_WITH_FLEX_FN, &quot;1&quot;, &quot;&quot;,</span>
<span class="nc" id="L174">								isTimeoffWithFlex(m_activity), isFieldDisabled(ActivityFields.TIMEOFF_WITH_FLEX), JSUtil.ON_CHANGE));</span>
<span class="nc" id="L175">						break;</span>
					case ActivityFields.DISPLAYABLE:
<span class="nc" id="L177">						m_fields.append(addToTemplate(BbmWebBundleKey.ACTIVITY_LABEL_TIMEOFF_WITH_FLEX, i++));</span>
<span class="nc" id="L178">						addComponent(m_localizer.formatYesNo(isTimeoffWithFlex(m_activity)));</span>
<span class="nc" id="L179">						addHiddenField(ActivityFields.TIMEOFF_WITH_FLEX);</span>
<span class="nc" id="L180">						break;</span>
					case ActivityFields.NON_DISPLAYABLE:
<span class="nc" id="L182">						addHiddenField(ActivityFields.TIMEOFF_WITH_FLEX);</span>
<span class="nc" id="L183">						break;</span>
					default:
<span class="nc" id="L185">						throw new IllegalStateException();</span>
				}
			}

			// Allotment
			String bundleKeyALLOTMENT;
<span class="pc bpc" id="L191" title="1 of 2 branches missed.">			if (!hasLicense)</span>
<span class="nc" id="L192">				bundleKeyALLOTMENT = BbmWebBundleKey.ACTIVITY_LABEL_TIMEOFF_WITH_ALLOTMENT;</span>
			else
<span class="fc" id="L194">				bundleKeyALLOTMENT = BbmWebBundleKey.ACTIVITY_LABEL_TIMEOFF_WITH_ACCRUAL;</span>

<span class="pc bpc" id="L196" title="3 of 4 branches missed.">			switch (m_displayMap[ActivityFields.TIMEOFF_WITH_ALLOTMENT]) {</span>
				case ActivityFields.EDITABLE:
<span class="fc" id="L198">					m_fields.append(addToTemplate(bundleKeyALLOTMENT, i++));</span>
<span class="fc" id="L199">					addComponent(HtmlChoiceInput.makeChkBoxInput(ActivityFields.TIMEOFF_WITH_ALLOTMENT_FN, &quot;true&quot;, &quot;&quot;,</span>
<span class="fc" id="L200">							m_activity.isTimeoffWithAllotment(), isFieldDisabled(ActivityFields.TIMEOFF_WITH_ALLOTMENT),</span>
							JSUtil.ON_CHANGE));
<span class="fc" id="L202">					break;</span>
				case ActivityFields.DISPLAYABLE:
<span class="nc" id="L204">					m_fields.append(addToTemplate(bundleKeyALLOTMENT, i++));</span>
<span class="nc" id="L205">					addComponent(m_localizer.formatYesNo(m_activity.isTimeoffWithAllotment()));</span>
<span class="nc" id="L206">					addHiddenField(ActivityFields.TIMEOFF_WITH_ALLOTMENT);</span>
<span class="nc" id="L207">					break;</span>
				case ActivityFields.NON_DISPLAYABLE:
<span class="nc" id="L209">					addHiddenField(ActivityFields.TIMEOFF_WITH_ALLOTMENT);</span>
<span class="nc" id="L210">					break;</span>
				default:
<span class="nc" id="L212">					throw new IllegalStateException();</span>
			}

			// Accrual Schedule, if no Accrual License, NON_DISPLAYABLE
<span class="pc bpc" id="L216" title="4 of 6 branches missed.">			switch (!hasLicense ? ActivityFields.NON_DISPLAYABLE : m_displayMap[ActivityFields.TIMEOFF_ACCRUAL_SCHEDULE]) {</span>
				case ActivityFields.EDITABLE:
<span class="fc" id="L218">					m_fields.append(addToTemplate(BbmWebBundleKey.ACTIVITY_LABEL_TIMEOFF_ACCRUAL_SCHEDULE, i++));</span>
<span class="fc" id="L219">					ArrayList options = new ArrayList();</span>
<span class="fc" id="L220">					options.add(new StringsPair(String.valueOf(Activity.TO_ACCRUAL_SCHEDULE_DAILY), ActivityModelHandler</span>
<span class="fc" id="L221">							.getAccrualScheduleStr(m_localizer, Activity.TO_ACCRUAL_SCHEDULE_DAILY)));</span>
<span class="fc" id="L222">					options.add(new StringsPair(String.valueOf(Activity.TO_ACCRUAL_SCHEDULE_WEEKLY), ActivityModelHandler</span>
<span class="fc" id="L223">							.getAccrualScheduleStr(m_localizer, Activity.TO_ACCRUAL_SCHEDULE_WEEKLY)));</span>
<span class="fc" id="L224">					options.add(new StringsPair(String.valueOf(Activity.TO_ACCRUAL_SCHEDULE_SEMI_MONTHLY), ActivityModelHandler</span>
<span class="fc" id="L225">							.getAccrualScheduleStr(m_localizer, Activity.TO_ACCRUAL_SCHEDULE_SEMI_MONTHLY)));</span>
<span class="fc" id="L226">					options.add(new StringsPair(String.valueOf(Activity.TO_ACCRUAL_SCHEDULE_MONTHLY), ActivityModelHandler</span>
<span class="fc" id="L227">							.getAccrualScheduleStr(m_localizer, Activity.TO_ACCRUAL_SCHEDULE_MONTHLY)));</span>
<span class="fc" id="L228">					options.add(new StringsPair(String.valueOf(Activity.TO_ACCRUAL_SCHEDULE_YEARLY), ActivityModelHandler</span>
<span class="fc" id="L229">							.getAccrualScheduleStr(m_localizer, Activity.TO_ACCRUAL_SCHEDULE_YEARLY)));</span>
<span class="fc" id="L230">					addComponent(HtmlUtil.makeSelectInput(ActivityFields.TIMEOFF_ACCRUAL_SCHEDULE_FN,</span>
<span class="fc" id="L231">							new String[] { String.valueOf(m_activity.getTOAccrualSchedule()) }, JSUtil.ON_CHANGE, options, false,</span>
<span class="pc bpc" id="L232" title="1 of 2 branches missed.">							!isFieldDisabled(ActivityFields.TIMEOFF_ACCRUAL_SCHEDULE)));</span>
<span class="fc" id="L233">					break;</span>
				case ActivityFields.DISPLAYABLE:
<span class="nc" id="L235">					m_fields.append(addToTemplate(BbmWebBundleKey.ACTIVITY_LABEL_TIMEOFF_ACCRUAL_SCHEDULE, i++));</span>
<span class="nc" id="L236">					addComponent(ActivityModelHandler.getAccrualScheduleStr(m_localizer, m_activity.getTOAccrualSchedule()));</span>
<span class="nc" id="L237">					addHiddenField(ActivityFields.TIMEOFF_ACCRUAL_SCHEDULE);</span>
<span class="nc" id="L238">					break;</span>
				case ActivityFields.NON_DISPLAYABLE:
<span class="nc" id="L240">					addHiddenField(ActivityFields.TIMEOFF_ACCRUAL_SCHEDULE);</span>
<span class="nc" id="L241">					break;</span>
				default:
<span class="nc" id="L243">					throw new IllegalStateException();</span>
			}

			// Accrual Policy, if no Accrual License, NON_DISPLAYABLE
<span class="pc bpc" id="L247" title="4 of 6 branches missed.">			switch (!hasLicense ? ActivityFields.NON_DISPLAYABLE : m_displayMap[ActivityFields.TIMEOFF_ACCRUAL_POLICY]) {</span>
				case ActivityFields.EDITABLE:
<span class="fc" id="L249">					m_fields.append(addToTemplate(BbmWebBundleKey.ACCRUAL_POLICY, i++));</span>
<span class="fc" id="L250">					ArrayList options = new ArrayList();</span>
<span class="fc" id="L251">					options.add(new StringsPair(String.valueOf(Activity.ACCRUAL_POLICY_ALL_HOURS_ON_START), ActivityModelHandler</span>
<span class="fc" id="L252">							.getAccrualPolicyStr(m_localizer, Activity.ACCRUAL_POLICY_ALL_HOURS_ON_START)));</span>
<span class="fc" id="L253">					options.add(new StringsPair(String.valueOf(Activity.ACCRUAL_POLICY_PRORATED_ON_START), ActivityModelHandler</span>
<span class="fc" id="L254">							.getAccrualPolicyStr(m_localizer, Activity.ACCRUAL_POLICY_PRORATED_ON_START)));</span>
<span class="fc" id="L255">					options.add(new StringsPair(String.valueOf(Activity.ACCRUAL_POLICY_ALL_HOURS_ON_NEXT), ActivityModelHandler</span>
<span class="fc" id="L256">							.getAccrualPolicyStr(m_localizer, Activity.ACCRUAL_POLICY_ALL_HOURS_ON_NEXT)));</span>
<span class="fc" id="L257">					options.add(new StringsPair(String.valueOf(Activity.ACCRUAL_POLICY_PRORATED_ON_NEXT), ActivityModelHandler</span>
<span class="fc" id="L258">							.getAccrualPolicyStr(m_localizer, Activity.ACCRUAL_POLICY_PRORATED_ON_NEXT)));</span>
<span class="fc" id="L259">					addComponent(HtmlUtil.makeSelectInput(ActivityFields.TIMEOFF_ACCRUAL_POLICY_FN,</span>
<span class="fc" id="L260">							new String[] { String.valueOf(m_activity.getTOAccrualPolicy()) }, JSUtil.ON_CHANGE, options, false,</span>
<span class="pc bpc" id="L261" title="1 of 2 branches missed.">							!isFieldDisabled(ActivityFields.TIMEOFF_ACCRUAL_POLICY)));</span>
<span class="fc" id="L262">					break;</span>
				case ActivityFields.DISPLAYABLE:
<span class="nc" id="L264">					m_fields.append(addToTemplate(BbmWebBundleKey.ACCRUAL_POLICY, i++));</span>
<span class="nc" id="L265">					addComponent(ActivityModelHandler.getAccrualPolicyStr(m_localizer, m_activity.getTOAccrualPolicy()));</span>
<span class="nc" id="L266">					addHiddenField(ActivityFields.TIMEOFF_ACCRUAL_POLICY);</span>
<span class="nc" id="L267">					break;</span>
				case ActivityFields.NON_DISPLAYABLE:
<span class="nc" id="L269">					addHiddenField(ActivityFields.TIMEOFF_ACCRUAL_POLICY);</span>
<span class="nc" id="L270">					break;</span>
				default:
<span class="nc" id="L272">					throw new IllegalStateException();</span>
			}

<span class="fc" id="L275">		} else { // container is invisible</span>
<span class="nc" id="L276">			addHiddenField(ActivityFields.REQUESTABLE);</span>
<span class="nc" id="L277">			addHiddenField(ActivityFields.USE_DAILY_TOPOOL);</span>
<span class="nc" id="L278">			addHiddenField(ActivityFields.USE_INTERVAL_TOPOOL);</span>
<span class="nc" id="L279">			addHiddenField(ActivityFields.TIMEOFF_WITH_FLEX);</span>
<span class="nc" id="L280">			addHiddenField(ActivityFields.TIMEOFF_WITH_ALLOTMENT);</span>
<span class="nc" id="L281">			addHiddenField(ActivityFields.TIMEOFF_ACCRUAL_SCHEDULE);</span>
<span class="nc" id="L282">			addHiddenField(ActivityFields.TIMEOFF_ACCRUAL_POLICY);</span>
		}
<span class="fc" id="L284">		m_hiddenFields.append(HtmlUtil.makeHiddenInput(&quot;isActivityTypeWithAllotment&quot;, isActivityTypeWithAllotment()));</span>
<span class="fc" id="L285">	}</span>

	private boolean isTimeoffWithFlex(Activity activity) {
<span class="nc bnc" id="L288" title="All 2 branches missed.">		return activityProperties.getTimeoffWithFlex() == ActivityProperties.FLEX_TIME;</span>
	}

	public boolean getRequestable() {
<span class="nc" id="L292">		return m_activity.isRequestable();</span>
	}

	public void setRequestable(boolean requestable) {
<span class="nc" id="L296">		m_activity.setRequestable(requestable);</span>
<span class="nc" id="L297">	}</span>

	public boolean getUseDailyTOPool() {
<span class="nc" id="L300">		return activityProperties.isUseDailyTOPool();</span>
	}

	public void setUseDailyTOPool(boolean useDailyTOPool) {
<span class="nc" id="L304">		activityProperties.setUseDailyTOPool(useDailyTOPool);</span>
<span class="nc" id="L305">	}</span>

	public boolean getUseIntervalTOPool() {
<span class="nc" id="L308">		return activityProperties.isUseIntervalTOPool();</span>
	}

	public void setUseIntervalTOPool(boolean useIntervalTOPool) {
<span class="nc" id="L312">		activityProperties.setUseIntervalTOPool(useIntervalTOPool);</span>
<span class="nc" id="L313">	}</span>

	public boolean getTimeoffWithAllotment() {
<span class="nc" id="L316">		return m_activity.isTimeoffWithAllotment();</span>
	}

	public void setTimeoffWithAllotment(boolean isAllotment) {
<span class="nc" id="L320">		m_activity.setTimeoffWithAllotment(isAllotment);</span>
<span class="nc" id="L321">	}</span>

	public int getTimeoffAccrualSchedule() {
<span class="nc" id="L324">		return m_activity.getTOAccrualSchedule();</span>
	}

	public void setTimeoffAccrualSchedule(int value) {
<span class="nc" id="L328">		m_activity.setTOAccrualSchedule(value);</span>
<span class="nc" id="L329">	}</span>

	public int getTimeoffAccrualPolicy() {
<span class="nc" id="L332">		return m_activity.getTOAccrualPolicy();</span>
	}

	public void setTimeoffAccrualPolicy(int value) {
<span class="nc" id="L336">		m_activity.setTOAccrualPolicy(value);</span>
<span class="nc" id="L337">	}</span>

	@Override
	public void setDefaultValues() {
<span class="fc" id="L341">	};</span>

	private void addHiddenField(short field) {
<span class="pc bpc" id="L344" title="6 of 8 branches missed.">		switch (field) {</span>
			case ActivityFields.REQUESTABLE:
<span class="nc" id="L346">				m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.REQUESTABLE_FN, </span>
<span class="nc bnc" id="L347" title="All 2 branches missed.">						m_activity.isRequestable() ? &quot;true&quot; : &quot;&quot;));</span>
<span class="nc" id="L348">				break;</span>
			case ActivityFields.USE_DAILY_TOPOOL:
<span class="fc" id="L350">				m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.USE_DAILY_TOPOOL_FN,</span>
<span class="pc bpc" id="L351" title="1 of 2 branches missed.">						activityProperties.isUseDailyTOPool() ? &quot;true&quot; : &quot;&quot;));</span>
<span class="fc" id="L352">				break;</span>
			case ActivityFields.USE_INTERVAL_TOPOOL:
<span class="fc" id="L354">				m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.USE_INTERVAL_TOPOOL_FN,</span>
<span class="pc bpc" id="L355" title="1 of 2 branches missed.">						activityProperties.isUseIntervalTOPool() ? &quot;true&quot; : &quot;&quot;));</span>
<span class="fc" id="L356">				break;</span>
			case ActivityFields.TIMEOFF_WITH_FLEX:
<span class="nc" id="L358">				m_hiddenFields</span>
<span class="nc" id="L359">						.append(HtmlUtil.makeHiddenInput(ActivityFields.TIMEOFF_WITH_FLEX_FN, activityProperties.getTimeoffWithFlex()));</span>
<span class="nc" id="L360">				break;</span>
			case ActivityFields.TIMEOFF_WITH_ALLOTMENT:
<span class="nc" id="L362">				m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.TIMEOFF_WITH_ALLOTMENT_FN,</span>
<span class="nc bnc" id="L363" title="All 2 branches missed.">						m_activity.isTimeoffWithAllotment() ? &quot;true&quot; : &quot;&quot;));</span>
<span class="nc" id="L364">				break;</span>
			case ActivityFields.TIMEOFF_ACCRUAL_SCHEDULE:
<span class="nc" id="L366">				m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.TIMEOFF_ACCRUAL_SCHEDULE_FN,</span>
<span class="nc" id="L367">						m_activity.getTOAccrualSchedule()));</span>
<span class="nc" id="L368">				break;</span>
			case ActivityFields.TIMEOFF_ACCRUAL_POLICY:
<span class="nc" id="L370">				m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.TIMEOFF_ACCRUAL_POLICY_FN,</span>
<span class="nc" id="L371">						m_activity.getTOAccrualPolicy()));</span>
				break;
		}
<span class="fc" id="L374">		m_hiddenFields.append(&quot;\n&quot;);</span>
<span class="fc" id="L375">	}</span>

	private boolean isFieldDisabled(short field) {
<span class="fc" id="L378">		boolean disabled = false;</span>
<span class="pc bpc" id="L379" title="4 of 8 branches missed.">		switch (field) {</span>
			case ActivityFields.REQUESTABLE:
				// disable field if the activity not requestable and is not defined as absence or unavailability
<span class="pc bpc" id="L382" title="1 of 2 branches missed.">				if (!m_activity.isRequestable()) {</span>
<span class="pc bpc" id="L383" title="2 of 4 branches missed.">					disabled = !(m_activity.isTimeoff() || m_activity.isUnavailability());</span>
				}
				break;
			case ActivityFields.USE_DAILY_TOPOOL:
				// disable field if the activity not requestable
<span class="nc bnc" id="L388" title="All 6 branches missed.">				disabled = !(m_activity.isTimeoff() || m_activity.isUnavailability()) || !m_activity.isRequestable();</span>
<span class="nc" id="L389">				break;</span>
			case ActivityFields.USE_INTERVAL_TOPOOL:
				// disable field if the activity not requestable
<span class="nc bnc" id="L392" title="All 6 branches missed.">				disabled = !(m_activity.isTimeoff() || m_activity.isUnavailability()) || !m_activity.isRequestable();</span>
<span class="nc" id="L393">				break;</span>
			case ActivityFields.TIMEOFF_WITH_FLEX:
				// disable field if the activity not timeoff or not requestable
<span class="nc bnc" id="L396" title="All 4 branches missed.">				disabled = !m_activity.isTimeoff() || !m_activity.isRequestable();</span>
<span class="nc" id="L397">				break;</span>
			case ActivityFields.TIMEOFF_WITH_ALLOTMENT:
				// disable field if ActivityType is with Allotment, or the activity is not timeoff with allotment and is not defined
				// as absence
<span class="pc bpc" id="L401" title="3 of 6 branches missed.">				if (isActivityTypeWithAllotment() || (!m_activity.isTimeoffWithAllotment() &amp;&amp; !m_activity.isTimeoff())) {</span>
<span class="fc" id="L402">					disabled = true;</span>
				}
				break;
			case ActivityFields.TIMEOFF_ACCRUAL_SCHEDULE:
				// disable field if ActivityType is with Allotment, or the activity is not timeoff
<span class="pc bpc" id="L407" title="2 of 4 branches missed.">				if (isActivityTypeWithAllotment() || !m_activity.isTimeoff()) {</span>
<span class="fc" id="L408">					disabled = true;</span>
				}
				break;
			case ActivityFields.TIMEOFF_ACCRUAL_POLICY:
				// disable field if ActivityType is with Allotment, or the activity is not timeoff
<span class="pc bpc" id="L413" title="2 of 4 branches missed.">				if (isActivityTypeWithAllotment() || !m_activity.isTimeoff()) {</span>
<span class="fc" id="L414">					disabled = true;</span>
				}
				break;
		}
<span class="fc" id="L418">		return disabled;</span>
	}

	private ActivityCategory getActivityType() {
<span class="pc bpc" id="L422" title="1 of 4 branches missed.">		if (m_activity == null || m_activity.getActivityCategoryId() == null)</span>
<span class="fc" id="L423">			return null;</span>
<span class="pc bpc" id="L424" title="1 of 4 branches missed.">		if (m_activityType == null || !m_activity.getActivityCategoryId().equals(m_activityType.getID())) {</span>
			try {
<span class="fc" id="L426">				m_activityType = ActivityTypeModelHandler.getActivityTypeByID(m_context, m_activity.getActivityCategoryId());</span>
<span class="nc" id="L427">			} catch (Exception ex) {</span>
<span class="nc" id="L428">				handleUnableToLoadDataError(log, ex);</span>
<span class="fc" id="L429">			}</span>
		}
<span class="fc" id="L431">		return m_activityType;</span>
	}

	private boolean isActivityTypeWithAllotment() {
<span class="fc" id="L435">		boolean result = false;</span>
<span class="fc" id="L436">		ActivityCategory activityType = getActivityType();</span>
<span class="fc bfc" id="L437" title="All 2 branches covered.">		if (activityType != null) {</span>
<span class="fc" id="L438">			result = activityType.isTOAllotment();</span>
		}
<span class="fc" id="L440">		return result;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>