<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>ActivityFormPageModel.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.bbm.activity</a> &gt; <span class="el_source">ActivityFormPageModel.java</span></div><h1>ActivityFormPageModel.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.bbm.activity;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.StringsPair;
import com.bluepumpkin.common.keys.DBInfo;
import com.bluepumpkin.common.logging.Category;
import com.bluepumpkin.common.util.StringUtil;
import com.bluepumpkin.ejb.bbm.activity.model.Activity;
import com.bluepumpkin.ejb.bbm.activity.model.ActivityFieldInfo;
import com.bluepumpkin.ejb.bbm.activity.model.ActivityProperties;
import com.bluepumpkin.ejb.bbm.base.BbmException;
import com.bluepumpkin.ejb.bbm.paypolicy.model.EarningTypeManager;
import com.bluepumpkin.ejb.bbm.workload.model.Media;
import com.bluepumpkin.ejb.bbm.workresource.OrganizationScopeManagerProxy;
import com.bluepumpkin.ejb.bbm.workresource.model.Organization;
import com.bluepumpkin.ejb.core.CoreManagerFactory;
import com.bluepumpkin.web.bbm.Log;
import com.bluepumpkin.web.bbm.earningtype.EarningTypeModelHandler;
import com.bluepumpkin.web.bbm.l10n.BbmWebBundleKey;
import com.bluepumpkin.web.bbm.l10n.BbmWebLogBundleKey;
import com.bluepumpkin.web.bbm.organization.OrgWorkpaneFormPageModel;
import com.bluepumpkin.web.bbm.organization.OrganizationModelHandler;
import com.bluepumpkin.web.bbm.workload.MediaSelectorPopupPageModel;
import com.bluepumpkin.web.bbm.workload.WorkloadModelHandler;
import com.bluepumpkin.web.bbm.workload.queue.QueueSelectorPopupPageModel;
import com.bluepumpkin.web.core.setup.mediatypes.MediaTypesSetupPageModel;
import com.verint.web.wfm.keys.WfmJavaScriptFileID;
import com.witness.ejb.core.licensing.LicenseKeys;
import com.witness.ejb.core.licensing.ejb.LicenseManager;
import com.witness.ejb.core.security.PrivilegeKeys;
import com.witness.web.uif.base.Message;
import com.witness.web.uif.keys.ImageFileID;
import com.witness.web.uif.keys.JavaScriptFileID;
import com.witness.web.uif.keys.PageAction;
import com.witness.web.uif.l10n.UIFWebBundleKey;
import com.witness.web.uif.pagecomponent.form.FormTwoColumnPC;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.util.ColorUtil;
import com.witness.web.uif.util.HtmlUtil;
import com.witness.web.uif.util.html.CSSUtil;
import com.witness.web.uif.util.html.HtmlChoiceInput;
import com.witness.web.uif.util.js.JSUtil;
import com.witness.web.uif.validator.IsEnteredFieldValidator;

import javax.servlet.http.HttpServletRequest;
import java.rmi.RemoteException;
import java.util.*;

/**
 * Title:        ActivityFormPageModel
 * Description:  Display a form for activity
 * Copyright:    Copyright (c) 2001
 * Company:      Blue Pumpkin Software, inc
 *
 * @author Shimon Kakon
 * @version 1.0
 */
@SuppressWarnings(&quot;serial&quot;)
public class ActivityFormPageModel extends OrgWorkpaneFormPageModel {
<span class="fc" id="L60">	private static final Category log = Log.initCategory(ActivityFormPageModel.class.getName());</span>
	private Activity m_activity;
	private ActivityProperties activityProperties;

	private Collection&lt;ID&gt; m_mediaIds;
<span class="fc" id="L65">	private boolean m_hasMedia = false;</span>
<span class="fc" id="L66">	private boolean m_hasProjectMedia = false;</span>

	private Collection&lt;ID&gt; m_queueIds; //the queue hopping (or Project) queueIDs linked to this activity (if any)
<span class="fc" id="L69">	private boolean m_hasQueues = false; //does this activity have any queue hopping (or Project) queues linked to it?</span>

	private Collection&lt;StringsPair&gt; m_activityTypeStringPair;
	private Collection&lt;StringsPair&gt; m_earningTypeStringPair;
	private String m_selectedActivityType;
	private String m_selectedEarningType;
	private FormTwoColumnPC m_formPC;
	private final ActivityUsage m_fsUsagePC;
	private final ActivityUsage m_rmUsagePC;
	private final ActivityUsage m_amUsagePC;
	private final ActivityUsage m_advisorUsagePC;
<span class="fc" id="L80">	private final StringBuffer m_hiddenFields = new StringBuffer(512);</span>
	private short[] m_displayMap;

	// Constants
	public static final boolean PAID_DEFAULT = false;
	public static final boolean TIMEOFF_DEFAULT = false;
<span class="fc" id="L86">	public static final ID EARNING_TYPE_DEFAULT = EarningTypeManager.REGULAR;</span>
	private static final String ACTIVITY_COLOR_PICKER_NAME = &quot;POPUP_ACTIVITY_COLOR_PICKER&quot;;
	private static final String ACTIVITY_COLOR_DEFAULT = &quot;#F7FFCF&quot;;

	private static final String MEDIA_NAMES_DISPLAY_FN = &quot;mediaNamesDisplay&quot;;
	private static final String MEDIA_NAMES_DISPLAY_SPAN = &quot;mediaSpan&quot;;
	private static final String ACTIVITY_FIELD_ON_CHANGE = &quot;activityOnChange(this);&quot;;

	private static final String QUEUE_NAMES_DISPLAY_FN = &quot;queueNamesDisplay&quot;;
	private static final String QUEUE_NAMES_DISPLAY_SPAN = &quot;queueSpan&quot;;

<span class="fc" id="L97">	private boolean m_hasPayrollLicense = false;</span>
<span class="fc" id="L98">	private boolean m_hasMultiMediaLicense = false;</span>
<span class="fc" id="L99">	private boolean m_hasQueueHoppingLicense = false;</span>
<span class="fc" id="L100">	private boolean m_hasAdvisorLicense = false;</span>

	/**
	 * Constructor
	 *
	 * @param context Request Context
	 */
	public ActivityFormPageModel(RequestContext context) {
<span class="fc" id="L108">		super(context);</span>
<span class="fc" id="L109">		addRequiredJavaScriptFile(JavaScriptFileID.JQUERY);</span>
<span class="fc" id="L110">		m_activity = new Activity();</span>
<span class="fc" id="L111">		activityProperties = new ActivityProperties();</span>

		// PC needed for extract parameters
<span class="fc" id="L114">		m_fsUsagePC = new ActivityFSUsage(context, m_bbmBundle, m_activity, activityProperties);</span>
<span class="fc" id="L115">		addChildComponent(m_fsUsagePC);</span>
<span class="fc" id="L116">		m_rmUsagePC = new ActivityRMUsage(context, m_bbmBundle, m_activity, activityProperties);</span>
<span class="fc" id="L117">		addChildComponent(m_rmUsagePC);</span>
<span class="fc" id="L118">		m_amUsagePC = new ActivityAMUsage(context, m_bbmBundle, m_activity, activityProperties);</span>
<span class="fc" id="L119">		addChildComponent(m_amUsagePC);</span>
<span class="fc" id="L120">		m_advisorUsagePC = new ActivityAdvisorUsage(context, m_bbmBundle, m_activity, activityProperties);</span>
<span class="fc" id="L121">		addChildComponent(m_advisorUsagePC);</span>
<span class="fc" id="L122">	}</span>


	public boolean extractParameters(HttpServletRequest request) {
<span class="fc" id="L126">		boolean success = super.extractParameters(request);</span>

		// now get the value for check boxes since checkboxes values are not
		// submitted with a form if they are not checked

<span class="fc" id="L131">		String boolValue = request.getParameter(ActivityFields.PAID_FN);</span>
<span class="pc bpc" id="L132" title="1 of 2 branches missed.">		setPaid((!StringUtil.isEmpty(boolValue)));</span>

<span class="fc" id="L134">		boolValue = request.getParameter(ActivityFields.TIMEOFF_FN);</span>
<span class="pc bpc" id="L135" title="1 of 2 branches missed.">		setTimeoff((!StringUtil.isEmpty(boolValue)));</span>

<span class="fc" id="L137">		boolValue = request.getParameter(ActivityFields.QUEUE_HOPPING_FN);</span>
<span class="pc bpc" id="L138" title="1 of 2 branches missed.">		setQueueHopping((!StringUtil.isEmpty(boolValue)));</span>

<span class="fc" id="L140">		boolValue = request.getParameter(ActivityFields.CAN_WORK_REMOTELY_FN);</span>
<span class="pc bpc" id="L141" title="1 of 2 branches missed.">		setAllowRemote((!StringUtil.isEmpty(boolValue)));</span>

<span class="fc" id="L143">		setSourceMeasureNullObjectIfNull();</span>

<span class="fc" id="L145">		return success;</span>
	}

	public boolean extractActivityPropertiesParameters(HttpServletRequest request) {
<span class="fc" id="L149">		super.extractParameters(request);</span>

<span class="fc" id="L151">		String boolValue = request.getParameter(ActivityFields.USE_DAILY_TOPOOL_FN);</span>
<span class="pc bpc" id="L152" title="1 of 2 branches missed.">		setUseDailyTOPool(!StringUtil.isEmpty(boolValue));</span>

<span class="fc" id="L154">		boolValue = request.getParameter(ActivityFields.USE_INTERVAL_TOPOOL_FN);</span>
<span class="pc bpc" id="L155" title="1 of 2 branches missed.">		setUseIntervalTOPool(!StringUtil.isEmpty(boolValue));</span>

<span class="fc" id="L157">		String flex = request.getParameter(ActivityFields.TIMEOFF_WITH_FLEX_FN);</span>
<span class="pc bpc" id="L158" title="1 of 2 branches missed.">		setTimeoffWithFlex(!StringUtil.isEmpty(flex) ? Integer.valueOf(flex).intValue() : ActivityProperties.TIME_OFF_TIME);</span>

<span class="fc" id="L160">		return true;</span>
	}


	/**
	 * Initialize Component For Display
	 */
	public void initForDisplay() {
<span class="pc bpc" id="L168" title="1 of 2 branches missed.">		if (m_isInitializedForDisplay) {</span>
<span class="nc" id="L169">			return;</span>
		} else {
<span class="fc" id="L171">			m_displayMap = ActivityFields.getDisplayMap(getActivityID());</span>
<span class="fc" id="L172">			super.initForDisplay();</span>
<span class="fc" id="L173">			addForm(m_formPC);</span>
<span class="fc" id="L174">			int numOfForms = 1;</span>
<span class="pc bpc" id="L175" title="1 of 2 branches missed.">			if (isAuthorizedToConfigureFSAttributes(getSelectedIDObject())) {</span>
<span class="pc bpc" id="L176" title="1 of 2 branches missed.">				if (ActivityFields.hasDisplayableField(m_displayMap, ActivityFields.FS)) {</span>
<span class="fc" id="L177">					addForm(m_fsUsagePC);</span>
<span class="fc" id="L178">					numOfForms++;</span>
				}
<span class="pc bpc" id="L180" title="1 of 2 branches missed.">				if (ActivityFields.hasDisplayableField(m_displayMap, ActivityFields.RM)) {</span>
<span class="fc" id="L181">					addForm(m_rmUsagePC);</span>
<span class="fc" id="L182">					numOfForms++;</span>
				}
			}
<span class="pc bpc" id="L185" title="2 of 4 branches missed.">			if (isAuthorizedToConfigureAMAttributes(getSelectedIDObject()) &amp;&amp; ActivityFields.hasDisplayableField(m_displayMap, ActivityFields.AM)) {</span>
<span class="fc" id="L186">				addForm(m_amUsagePC);</span>
<span class="fc" id="L187">				numOfForms++;</span>
			}
			//show advisor form only if license
<span class="pc bpc" id="L190" title="1 of 2 branches missed.">			if (m_hasAdvisorLicense) {</span>
<span class="fc" id="L191">				addForm(m_advisorUsagePC);</span>
<span class="fc" id="L192">				numOfForms++;</span>
			}
<span class="pc bpc" id="L194" title="1 of 2 branches missed.">			if (numOfForms &gt; 1) {</span>
<span class="fc" id="L195">				m_formPC.setWrapperCSSClass(CSSUtil.CLASS_BORDER_DEFAULT);</span>
			}
<span class="fc" id="L197">			addRequiredJavaScriptFile(JavaScriptFileID.MODULE_POPUPBUTTON);</span>
<span class="fc" id="L198">			addRequiredJavaScriptFile(JavaScriptFileID.MEDIATOR_WORKPANE_FORM);</span>
<span class="fc" id="L199">			setJSMediator(WfmJavaScriptFileID.MEDIATOR_ACTIVITY_WORKPANE_FORM);</span>
<span class="fc" id="L200">			addRequiredJavaScriptFile(WfmJavaScriptFileID.MEDIA_SELECTOR_POPUP);</span>
<span class="fc" id="L201">			addRequiredJavaScriptFile(WfmJavaScriptFileID.QUEUE_SELECTOR_POPUP);</span>
<span class="fc" id="L202">			addRequiredJavaScriptFile(WfmJavaScriptFileID.ACTIVITY_ON_CHANGE);</span>

			// Color picker popup
<span class="fc" id="L205">			addPopupArgs(ACTIVITY_COLOR_PICKER_NAME,</span>
				&quot;activity_color_picker&quot;,
				&quot;name=&quot; + ActivityFields.COLOR_FN, null, &quot;700,345,150,150&quot;, true, 1);

			// Media selector popup
<span class="fc" id="L210">			addPopupArgs(MediaSelectorPopupPageModel.MEDIA_SELECTOR_POPUP_ACTION,</span>
				MediaSelectorPopupPageModel.MEDIA_SELECTOR_POPUP_URL, ActivityFields.MEDIA_FN, null,
				MediaSelectorPopupPageModel.MEDIA_SELECTOR_POPUP_SIZE_POSITION, true, 1);

			// Queue selector popup
<span class="fc" id="L215">			addPopupArgs(QueueSelectorPopupPageModel.QUEUE_SELECTOR_POPUP_ACTION,</span>
				QueueSelectorPopupPageModel.QUEUE_SELECTOR_POPUP_URL, ActivityFields.QUEUES_FN + &quot;,&quot; + ActivityFields.MEDIA_FN + &quot;,&quot; + ActivityFields.OWNER_ORG_FN, null,
				QueueSelectorPopupPageModel.QUEUE_SELECTOR_POPUP_SIZE_POSITION, true, 1);
		}
<span class="fc" id="L219">	}</span>


	/**
	 * Return instance of Model which is ready to be rendered
	 *
	 * @param context Request Context
	 */
	public static ActivityFormPageModel getInstance(RequestContext context) {
<span class="fc" id="L228">		return (ActivityFormPageModel) getInstance(context, ActivityFormPageModel.class);</span>
	}

	/**
	 * Return the form title
	 *
	 * @return form title
	 */
	public String getFormTitle() {
<span class="fc" id="L237">		return i18n(m_bbmBundle, BbmWebBundleKey.ACTIVITY_FORM_TITLE);</span>
	}

	/**
	 * Return the Organization ID as a String. The selected ID is not always the
	 * owner org that is display in the form. For example - system activities org
	 * owner is the root, which cannot be selected from the selection pane.
	 *
	 * @return form title
	 */
	public String getOrganizationId() {
<span class="fc" id="L248">		return m_activity.getOrganizationId().toString();</span>
	}

	public void setOrganizationId(String id) {
<span class="fc" id="L252">		m_activity.setOrganizationId(new ID(id));</span>
<span class="fc" id="L253">	}</span>

	public ID getActivityID() {
<span class="pc bpc" id="L256" title="1 of 2 branches missed.">		if (m_performActionOnIDs == null) {</span>
<span class="fc" id="L257">			return null;</span>
		} else {
<span class="nc" id="L259">			return m_performActionOnIDs[getEditIndex()];</span>
		}
	}

	/**
	 * Returns the organization dispaly label
	 */
	public String getOrganizationLabel() {
<span class="fc" id="L267">		return i18n(m_bbmBundle, BbmWebBundleKey.LIST_HEADER_OWNER_ORG);</span>
	}

	public String getActivityOrganizationName() throws Exception {
<span class="fc" id="L271">		return OrganizationModelHandler.getOrganizationName(m_context, m_activity.getOrganizationId());</span>
	}

	public String getActivityName() {
<span class="pc bpc" id="L275" title="1 of 2 branches missed.">		return m_activity.getName() == null ? null : m_activity.getName().trim();</span>
	}

	public void setActivityName(String name) {
<span class="fc" id="L279">		m_activity.setName(name.trim());</span>
<span class="fc" id="L280">	}</span>

	public String getActivityDescription() {
<span class="fc" id="L283">		return m_activity.getDescription();</span>
	}

	public void setActivityDescription(String desc) {
<span class="fc" id="L287">		m_activity.setDescription(StringUtil.convertEmptyStringToNull(desc));</span>
<span class="fc" id="L288">	}</span>

	public String getActivityType() {
<span class="fc" id="L291">		ID id = m_activity.getActivityCategoryId();</span>
<span class="fc bfc" id="L292" title="All 2 branches covered.">		if (id != null) {</span>
<span class="fc" id="L293">			return id.toString();</span>
		} else {
<span class="fc" id="L295">			return &quot;&quot;;</span>
		}
	}

	public void setActivityType(String id) {
<span class="pc bpc" id="L300" title="1 of 2 branches missed.">		if (!StringUtil.isEmpty(id)) {</span>
<span class="fc" id="L301">			m_activity.setActivityCategoryId(new ID(id));</span>
		}
<span class="fc" id="L303">	}</span>

	public String getEarningType() {
<span class="nc" id="L306">		ID id = m_activity.getEarningTypeId();</span>
<span class="nc bnc" id="L307" title="All 2 branches missed.">		if (id != null) {</span>
<span class="nc" id="L308">			return id.toString();</span>
		} else {
<span class="nc" id="L310">			return &quot;&quot;;</span>
		}
	}

	public void setEarningType(String id) {
<span class="nc bnc" id="L315" title="All 4 branches missed.">		if (id != null &amp;&amp; id.length() &gt; 0) {</span>
<span class="nc" id="L316">			m_activity.setEarningTypeId(new ID(id));</span>
		}
<span class="nc" id="L318">	}</span>

	public boolean getPaid() {
<span class="fc" id="L321">		return m_activity.isPaid();</span>
	}

	public void setPaid(boolean isPaid) {
<span class="fc" id="L325">		m_activity.setPaid(isPaid);</span>
<span class="fc" id="L326">	}</span>

	public boolean getQueueHopping() {
<span class="fc" id="L329">		return m_activity.isQueueHopping();</span>
	}

	public void setQueueHopping(boolean isQueueHopping) {
<span class="fc" id="L333">		m_activity.setQueueHopping(isQueueHopping);</span>
<span class="fc" id="L334">	}</span>

	public void setAllowRemote(boolean allowRemote) {
<span class="fc" id="L337">		m_activity.setAllowRemote(allowRemote);</span>
<span class="fc" id="L338">	}</span>

	public boolean getAllowRemote() {
<span class="nc" id="L341">		return m_activity.isAllowRemote();</span>
	}

	public String getColor() {
<span class="fc" id="L345">		String colorStr = ColorUtil.getHtmlColorCode(m_activity.getColor());</span>
<span class="pc bpc" id="L346" title="1 of 2 branches missed.">		if (ColorUtil.validateColor(colorStr)) {</span>
<span class="fc" id="L347">			return &quot;#&quot; + colorStr;</span>
		} else {
<span class="nc" id="L349">			return ACTIVITY_COLOR_DEFAULT;</span>
		}
	}

	public void setColor(String color) {
<span class="fc" id="L354">		m_activity.setColor(StringUtil.convertEmptyStringToNull(color));</span>
<span class="fc" id="L355">	}</span>

	public String getColorCode() {
<span class="fc" id="L358">		return m_activity.getColorCode();</span>
	}

	public void setColorCode(String colorCode) {
<span class="fc" id="L362">		m_activity.setColorCode(StringUtil.convertEmptyStringToNull(colorCode));</span>
<span class="fc" id="L363">	}</span>

	public boolean getTimeoff() {
<span class="fc" id="L366">		return m_activity.isTimeoff();</span>
	}

	public void setTimeoff(boolean isTimeoff) {
<span class="fc" id="L370">		m_activity.setTimeoff(isTimeoff);</span>
<span class="fc" id="L371">	}</span>

	public boolean getUseDailyTOPool() {
<span class="nc" id="L374">		return activityProperties.isUseDailyTOPool();</span>
	}

	public void setUseDailyTOPool(boolean isUseDailyTOPool) {
<span class="fc" id="L378">		activityProperties.setUseDailyTOPool(isUseDailyTOPool);</span>
<span class="fc" id="L379">	}</span>

	public boolean getUseIntervalTOPool() {
<span class="nc" id="L382">		return activityProperties.isUseIntervalTOPool();</span>
	}

	public void setUseIntervalTOPool(boolean isUseIntervalTOPool) {
<span class="fc" id="L386">		activityProperties.setUseIntervalTOPool(isUseIntervalTOPool);</span>
<span class="fc" id="L387">	}</span>

	public int getTimeoffWithFlex() {
<span class="nc" id="L390">		return activityProperties.getTimeoffWithFlex();</span>
	}

	public void setTimeoffWithFlex(int timeoffWithFlex) {
<span class="fc" id="L394">		activityProperties.setTimeoffWithFlex(timeoffWithFlex);</span>
<span class="fc" id="L395">	}</span>

	public void setMedia(String mediaString) {
<span class="fc" id="L398">		ID[] mediaIdArray = StringUtil.parseIDString(mediaString, &quot;,&quot;);</span>
<span class="pc bpc" id="L399" title="2 of 4 branches missed.">		if (mediaIdArray != null &amp;&amp; mediaIdArray.length &gt; 0) {</span>
<span class="nc" id="L400">			m_mediaIds = Arrays.asList(mediaIdArray);</span>
		} else {
<span class="fc" id="L402">			m_mediaIds = Collections.emptyList();</span>
		}
<span class="fc" id="L404">		setHasMedia();</span>
<span class="fc" id="L405">		setHasProjectMedia();</span>
<span class="fc" id="L406">	}</span>

	public Collection&lt;ID&gt; getMedia() {
<span class="nc" id="L409">		return m_mediaIds;</span>
	}

	private void setHasMedia() {
<span class="pc bpc" id="L413" title="2 of 4 branches missed.">		m_hasMedia = ((m_mediaIds != null) &amp;&amp; (!m_mediaIds.isEmpty()));</span>
<span class="fc" id="L414">	}</span>

	private void setHasProjectMedia() {
<span class="pc bpc" id="L417" title="4 of 6 branches missed.">		m_hasProjectMedia = ((m_mediaIds != null) &amp;&amp; (!m_mediaIds.isEmpty()) &amp;&amp; (m_mediaIds.contains(Media.MEDIA_ID_PROJECT)));</span>
<span class="fc" id="L418">	}</span>

	public void setQueues(String queuesString) {
<span class="fc" id="L421">		ID[] queueIdArray = StringUtil.parseIDString(queuesString, &quot;,&quot;);</span>
<span class="pc bpc" id="L422" title="2 of 4 branches missed.">		if (queueIdArray != null &amp;&amp; queueIdArray.length &gt; 0) {</span>
<span class="nc" id="L423">			m_queueIds = Arrays.asList(queueIdArray);</span>
		} else {
<span class="fc" id="L425">			m_queueIds = Collections.emptyList();</span>
		}
<span class="fc" id="L427">		setHasQueues();</span>
<span class="fc" id="L428">	}</span>

	/**
	 * Return the Queue Hopping queueIDs linked to this activity.
	 *
	 * @return collection of queue IDs
	 */
	public Collection&lt;ID&gt; getQueues() {
<span class="nc" id="L436">		return m_queueIds;</span>
	}

	/**
	 * Determines whether this activity is linked to any Queue Hopping queues.
	 */
	private void setHasQueues() {
<span class="pc bpc" id="L443" title="2 of 4 branches missed.">		m_hasQueues = ((m_queueIds != null) &amp;&amp; (!m_queueIds.isEmpty()));</span>
<span class="fc" id="L444">	}</span>

	/**
	 * Gets the activity value object
	 *
	 * @return activity value object
	 */
	public Activity getActivity() {
<span class="fc" id="L452">		m_activity.setID(getActivityID());</span>
<span class="fc" id="L453">		return m_activity;</span>
	}

	/**
	 * Gets the activity value object
	 *
	 * @return activity value object
	 */
	public ActivityProperties getActivityProperties() {
<span class="fc" id="L462">		activityProperties.setActivityId(getActivityID());</span>
<span class="fc" id="L463">		return activityProperties;</span>
	}

	/**
	 * Return URL for HTML Form Action
	 */
	public String getFormAction() {
<span class="fc" id="L470">		return &quot;activity_form&quot;;</span>
	}


	/**
	 * Override method to generate necessary JS code needed for the Color Picker popup window from
	 * a popup button
	 */
	public String getJavaScriptInitCode() {
<span class="fc" id="L479">		StringBuffer jsInit = new StringBuffer(1256);</span>
<span class="fc" id="L480">		jsInit.append(super.getJavaScriptInitCode());</span>
<span class="fc" id="L481">		jsInit.append(&quot;\n// initialize the Color Picker popup button object\n&quot;)</span>
<span class="fc" id="L482">			.append(&quot;window.popupbutton0 = new PopupButton(\&quot;popupbutton0\&quot;);\n&quot;)</span>
<span class="fc" id="L483">			.append(&quot;window.popupbutton0.bind();\n&quot;)</span>
<span class="fc" id="L484">			.append(&quot;//add  popupbutton to the mediator's collection\n&quot;)</span>
<span class="fc" id="L485">			.append(&quot;top.workpaneMediator.addChild( popupbutton0 );\n&quot;)</span>
<span class="fc" id="L486">			.append(&quot;popupbutton0.setParent(top.workpaneMediator);\n&quot;)</span>
<span class="fc" id="L487">			.append(&quot; getRemoteInitJS();\n&quot;);</span>
<span class="fc" id="L488">		return jsInit.toString();</span>
	}

	public String getCustomJavaScript() {
<span class="fc" id="L492">		StringBuffer js = new StringBuffer();</span>
<span class="fc" id="L493">		js.append(super.getCustomJavaScript());</span>
<span class="fc" id="L494">		js.append(getRemoteInitJS());</span>
//		js.append(getQueueNameOnChange());
<span class="fc" id="L496">		return js.toString();</span>
	}

/*	public String getQueueNameOnChange() {
		StringBuffer js = new StringBuffer();
		js.append(&quot;jQuery('#&quot;).append(QUEUE_NAMES_DISPLAY_FN).append(&quot;').change(function() { \n&quot;);
		js.append(JSUtil.RESET_PAGEDIRTY + JSUtil.REFRESH_PAGE + &quot; \n&quot;);
		js.append(&quot;	}) \n&quot;);

		return js.toString();
	} */

	private String getRemoteInitJS() {
<span class="fc" id="L509">		StringBuffer js = new StringBuffer();</span>
<span class="fc" id="L510">		js.append(&quot;function getRemoteInitJS() {\n&quot;);</span>
<span class="fc" id="L511">		js.append(&quot;var queueName = document.getElementById('&quot;).append(QUEUE_NAMES_DISPLAY_FN).append(&quot;'); \n&quot;);</span>
<span class="fc" id="L512">		js.append(&quot;var mediaName = document.getElementById('&quot;).append(MEDIA_NAMES_DISPLAY_FN).append(&quot;'); \n&quot;);</span>
<span class="fc" id="L513">		js.append(&quot;var canRemote = document.getElementById('&quot;).append(ActivityFields.CAN_WORK_REMOTELY_FN).append(&quot;'); \n&quot;);</span>
		//js.append(&quot;var category = document.getElementById('&quot;).append(ActivityFields.ACTIVITY_CATEGORY_FN).append(&quot;'); \n&quot;);
<span class="fc" id="L515">		js.append(&quot;if(queueName == null || queueName === undefined || mediaName == null || mediaName === undefined || canRemote == null || canRemote === undefined) return; \n&quot;);</span>
		//js.append(&quot;var index = category.selectedIndex; \n&quot;);
		//js.append(&quot;if(index &amp;&amp; document.getElementById('&quot;).append(ActivityFields.ACTIVITY_CATEGORY_FN).append(&quot;').options[index].value == '-5003'&quot;);
<span class="fc" id="L518">		js.append(&quot;if(document.getElementById('&quot;).append(ActivityFields.USED_IN_SHIFT_EVENT_FN).append(&quot;').checked&quot;);</span>
<span class="fc" id="L519">		js.append(&quot;&amp;&amp; (jQuery.trim(queueName.value) != \&quot;\&quot; || jQuery.trim(mediaName.value) != \&quot;\&quot; )){ \n&quot;);</span>
<span class="fc" id="L520">		js.append(&quot;document.getElementById('&quot;).append(ActivityFields.CAN_WORK_REMOTELY_FN).append(&quot;').disabled = false; \n&quot;);</span>
<span class="fc" id="L521">		js.append(&quot;}else {\n&quot;);</span>
<span class="fc" id="L522">		js.append(&quot;document.getElementById('&quot;).append(ActivityFields.CAN_WORK_REMOTELY_FN).append(&quot;').disabled = true; \n&quot;);</span>
<span class="fc" id="L523">		js.append(&quot;}\n&quot;);</span>
<span class="fc" id="L524">		js.append(&quot;}\n&quot;);</span>

<span class="fc" id="L526">		return js.toString();</span>
	}


	/**
	 * Override method to return Required HTML for this component
	 * Use this to add a specific hidden field
	 */
	public String getRequiredHTML() {
<span class="fc" id="L535">		StringBuffer reqHtml = new StringBuffer(1256);</span>
<span class="fc" id="L536">		reqHtml.append(super.getRequiredHTML());</span>
<span class="fc" id="L537">		reqHtml.append(HtmlUtil.makeHiddenInput(ActivityFields.OWNER_ORG_FN, getOrganizationId()));</span>
<span class="fc" id="L538">		m_hiddenFields.append(&quot;\n&quot;);</span>
<span class="pc bpc" id="L539" title="1 of 2 branches missed.">		if (m_hiddenFields.length() &gt; 0) {</span>
<span class="fc" id="L540">			reqHtml.append(m_hiddenFields);</span>
		}
<span class="fc" id="L542">		return reqHtml.toString();</span>
	}


	/**
	 * Returns a (single) entity type.
	 */
	protected String getTitleEntityType() {
<span class="fc" id="L550">		return this.getFormTitle();</span>
	}

	/**
	 * Returns an entity name. Used for title.
	 */
	protected String getEntityName() {
<span class="nc" id="L557">		return this.getActivityName();</span>
	}

	/**
	 * Checks to see if there is a Phone media is linked to this activity.
	 *
	 * @return
	 */
	private boolean hasPhoneMedia(Collection&lt;ID&gt; mediaIds) {
<span class="nc bnc" id="L566" title="All 4 branches missed.">		return mediaIds != null &amp;&amp; mediaIds.contains(Media.MEDIA_ID_PHONE);</span>
	}

	private boolean hasOperationsMedia(Collection&lt;ID&gt; mediaIds) {
<span class="nc bnc" id="L570" title="All 4 branches missed.">		return mediaIds != null &amp;&amp; mediaIds.contains(Media.MEDIA_ID_OPERATIONS);</span>
	}

	protected Collection&lt;ID&gt; getActivityMedia(RequestContext context, ID activityID,
											  boolean hasMultiMediaLicense) throws Exception {
<span class="nc" id="L575">		Collection&lt;ID&gt; mediaIds = ActivityModelHandler.getActivityMedia(context, activityID);</span>
<span class="nc bnc" id="L576" title="All 2 branches missed.">		if (!hasMultiMediaLicense) {</span>
			//Since they don't have the Multi-Media license, we will only keep the Phone media
<span class="nc" id="L578">			ArrayList&lt;ID&gt; reducedMediaIds = new ArrayList&lt;ID&gt;(1);</span>
<span class="nc bnc" id="L579" title="All 2 branches missed.">			if (hasPhoneMedia(mediaIds))</span>
<span class="nc" id="L580">				reducedMediaIds.add(Media.MEDIA_ID_PHONE);</span>

<span class="nc bnc" id="L582" title="All 4 branches missed.">			if (hasOperationsMedia(mediaIds) &amp;&amp; MediaTypesSetupPageModel.hasAnyBackOfficeLicence()) {</span>
<span class="nc" id="L583">				reducedMediaIds.add(Media.MEDIA_ID_OPERATIONS);</span>
			}
<span class="nc" id="L585">			return reducedMediaIds;</span>
		}
<span class="nc" id="L587">		return mediaIds;</span>
	}

	/**
	 * Create the form model - fetch the data from backend
	 */
	protected void createFormModel() {
<span class="fc" id="L594">		checkForLicenses();</span>
		try {
			//When PageAction.REFRESH, and page has values inputed from UI, keep them, don't reload activity or create new
			//Note that after COPY an activity, page refreshes, that case m_activity is empty, needs to reload.
<span class="pc bpc" id="L598" title="1 of 2 branches missed.">			if (!(PageAction.REFRESH.equals(m_context.getParameter(PageAction.PAGE_ACTION))</span>
<span class="nc bnc" id="L599" title="All 2 branches missed.">				&amp;&amp; m_activity.getActivityCategoryId() != null)) {</span>
<span class="pc bpc" id="L600" title="1 of 2 branches missed.">				if (!this.isNew()) {</span>
<span class="nc" id="L601">					m_activity = ActivityModelHandler.getActivityByID(m_context, getCurrentID());</span>
					//if (m_hasMultiMediaLicense) //Fixed QC#81240: Activity Edit page in web suite doesn't have a Media selector when Multi-Media license not present.
					{
<span class="nc" id="L604">						m_mediaIds = getActivityMedia(m_context, m_activity.getID(), m_hasMultiMediaLicense);</span>
					}
<span class="nc" id="L606">					setHasMedia();</span>
<span class="nc" id="L607">					setHasProjectMedia();</span>

					//Load the Queue Hopping (or Project) Queue IDs that are already linked to this activity (if any).
<span class="nc bnc" id="L610" title="All 6 branches missed.">					if ((m_activity.isQueueHopping() &amp;&amp; m_hasQueueHoppingLicense) || hasProjectMedia()) {</span>
<span class="nc" id="L611">						m_queueIds = ActivityModelHandler.getActivityQueues(m_context, m_activity.getID());</span>
					}
<span class="nc" id="L613">					setHasQueues();</span>

					// Get Activity Properties
<span class="nc" id="L616">					activityProperties = ActivityModelHandler.getActivityProperties(m_context, m_activity.getID());</span>
				} else {
					// Create new mode - set the org ID
<span class="pc bpc" id="L619" title="1 of 2 branches missed.">					if (hasSelectedID()) {</span>
<span class="fc" id="L620">						m_activity.setOrganizationId(getSelectedIDObject());</span>
					}
<span class="fc" id="L622">					setDefaultValues();</span>
				}
			}

			// load the activity types for the drop down
			try {
<span class="pc bpc" id="L628" title="1 of 2 branches missed.">				if (hasSelectedID()) {</span>
<span class="fc" id="L629">					boolean filterSystemDefined = true;</span>
<span class="pc bpc" id="L630" title="1 of 2 branches missed.">					if (m_activity.getOrganizationId().equals(Organization.ROOT_ORG_ID_OBJ)) {</span>
<span class="nc" id="L631">						filterSystemDefined = false;</span>
					}
<span class="fc" id="L633">					m_activityTypeStringPair = ActivityTypeModelHandler.getActivityTypesStringsPair(m_context,</span>
<span class="fc" id="L634">						getSelectedIDObject(), filterSystemDefined);</span>
<span class="fc" id="L635">				} else {</span>
<span class="nc" id="L636">					m_activityTypeStringPair = Collections.emptyList();</span>
				}

<span class="fc" id="L639">				m_selectedActivityType = getActivityType();</span>
<span class="fc bfc" id="L640" title="All 2 branches covered.">				if (StringUtil.isEmpty(m_selectedActivityType)) {</span>
<span class="pc bpc" id="L641" title="1 of 2 branches missed.">					if (!m_activityTypeStringPair.isEmpty()) {</span>
<span class="fc" id="L642">						Iterator&lt;StringsPair&gt; it = m_activityTypeStringPair.iterator();</span>
<span class="fc" id="L643">						StringsPair firstActivityTypeStringsPair = it.next();</span>
<span class="fc" id="L644">						m_selectedActivityType = firstActivityTypeStringsPair.getKey();</span>
<span class="fc" id="L645">					} else {</span>
<span class="nc" id="L646">						m_selectedActivityType = &quot;&quot;;</span>
<span class="nc" id="L647">						m_initFailure = true;</span>
					}
				}
<span class="nc" id="L650">			} catch (Exception e) {</span>
<span class="nc" id="L651">				log.l7dError(BbmWebLogBundleKey.ACTIVITY_ACTIVITY_TYPES_RETRIEVE_FAILURE, e);</span>
<span class="nc" id="L652">				this.addPageMessage(Message.ERROR_TYPE,</span>
					BbmWebBundleKey.ACTIVITY_ACTIVITY_TYPES_RETRIEVE_FAILURE,
					BbmWebBundleKey.BUNDLE_NAME);
<span class="nc" id="L655">				m_activityTypeStringPair = null;</span>
<span class="nc" id="L656">				m_initFailure = true;</span>
<span class="fc" id="L657">			}</span>

<span class="pc bpc" id="L659" title="1 of 2 branches missed.">			if (m_hasPayrollLicense) {</span>
				// load the earning types for the drop down
				try {
<span class="nc" id="L662">					m_earningTypeStringPair = EarningTypeModelHandler.getEarningTypesStringsPair(</span>
						EarningTypeManager.SORT_EARNINGTYPE_BY_NAME, true);

<span class="nc bnc" id="L665" title="All 2 branches missed.">					if (!this.isNew()) {</span>
<span class="nc" id="L666">						m_selectedEarningType = getEarningType();</span>
					} else {
<span class="nc" id="L668">						m_selectedEarningType = EARNING_TYPE_DEFAULT.toString();</span>
					}

<span class="nc" id="L671">				} catch (Exception e) {</span>
<span class="nc" id="L672">					log.l7dError(BbmWebLogBundleKey.ACTIVITY_EARNING_TYPES_RETRIEVE_FAILURE, e);</span>
<span class="nc" id="L673">					this.addPageMessage(Message.ERROR_TYPE,</span>
						BbmWebBundleKey.ACTIVITY_EARNING_TYPES_RETRIEVE_FAILURE,
						BbmWebBundleKey.BUNDLE_NAME);
<span class="nc" id="L676">					m_earningTypeStringPair = null;</span>
<span class="nc" id="L677">					m_initFailure = true;</span>
<span class="nc" id="L678">				}</span>
			}

<span class="nc" id="L681">		} catch (Exception ex) {</span>
<span class="nc" id="L682">			handleUnableToLoadDataError(log, ex);</span>
<span class="nc" id="L683">			m_initFailure = true;</span>
<span class="fc" id="L684">		}</span>

<span class="fc" id="L686">	}</span>


	/**
	 * Initialize Form Display
	 */
	protected void initForm() {
		// Initialize Form PC
<span class="fc" id="L694">		m_formPC = new FormTwoColumnPC(m_context);</span>
<span class="fc" id="L695">		addChildComponent(m_formPC);</span>
<span class="fc" id="L696">		m_formPC.setTitle(getFormTitle());</span>

		try {
			// Organization
<span class="fc" id="L700">			m_formPC.addRow(getOrganizationLabel(), getActivityOrganizationName());</span>

			// Name
<span class="pc bpc" id="L703" title="3 of 4 branches missed.">			switch (m_displayMap[ActivityFields.NAME]) {</span>
				case ActivityFields.EDITABLE:
<span class="fc" id="L705">					m_formPC.addRow(getNameLabel(),</span>
<span class="fc" id="L706">						HtmlUtil.makeTextInput(ActivityFields.NAME_FN, 50, DBInfo.ACTIVITY_NAME_MAXLENGTH, getActivityName(), JSUtil.ON_CHANGE));</span>
<span class="fc" id="L707">					addValidator(new IsEnteredFieldValidator(this, ActivityFields.NAME_FN,</span>
						UIFWebBundleKey.LABEL_NAME, UIFWebBundleKey.BUNDLE_NAME));
<span class="fc" id="L709">					break;</span>
				case ActivityFields.DISPLAYABLE:
<span class="nc" id="L711">					m_formPC.addRow(getNameLabel(), getActivityName());</span>
				case ActivityFields.NON_DISPLAYABLE:
<span class="nc" id="L713">					m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.NAME_FN, getActivityName()));</span>
<span class="nc" id="L714">					m_hiddenFields.append(&quot;\n&quot;);</span>
					break;
			}


			// Description
<span class="pc bpc" id="L720" title="3 of 4 branches missed.">			switch (m_displayMap[ActivityFields.DESCRIPTION]) {</span>
				case ActivityFields.EDITABLE:
<span class="fc" id="L722">					m_formPC.addRow(getDescriptionLabel(),</span>
<span class="fc" id="L723">						HtmlUtil.makeTextInput(ActivityFields.DESCRIPTION_FN, 75, 75,</span>
<span class="fc" id="L724">							getActivityDescription(), JSUtil.ON_CHANGE));</span>
<span class="fc" id="L725">					break;</span>
				case ActivityFields.DISPLAYABLE:
<span class="nc" id="L727">					m_formPC.addRow(getDescriptionLabel(), getActivityDescription());</span>
				case ActivityFields.NON_DISPLAYABLE:
<span class="nc" id="L729">					m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.DESCRIPTION_FN, getActivityDescription()));</span>
<span class="nc" id="L730">					m_hiddenFields.append(&quot;\n&quot;);</span>
					break;
			}

			// Activity Type
<span class="pc bpc" id="L735" title="3 of 4 branches missed.">			switch (m_displayMap[ActivityFields.ACTIVITY_CATEGORY]) {</span>
				case ActivityFields.EDITABLE:
<span class="fc" id="L737">					m_formPC.addRow(getActivityTypeLabel(), getActivityTypeDropDown(JSUtil.RESET_PAGEDIRTY + JSUtil.REFRESH_PAGE));</span>
<span class="fc" id="L738">					break;</span>
				case ActivityFields.DISPLAYABLE:
<span class="nc" id="L740">					m_formPC.addRow(getActivityTypeLabel(), getActivityTypeName());</span>
				case ActivityFields.NON_DISPLAYABLE:
<span class="nc" id="L742">					m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.ACTIVITY_CATEGORY_FN, getActivityType()));</span>
<span class="nc" id="L743">					m_hiddenFields.append(&quot;\n&quot;);</span>
					break;
			}

			// Paid
<span class="pc bpc" id="L748" title="3 of 4 branches missed.">			switch (m_displayMap[ActivityFields.PAID]) {</span>
				case ActivityFields.EDITABLE:
<span class="fc" id="L750">					m_formPC.addRow(getPaidLabel(),</span>
<span class="fc" id="L751">						HtmlChoiceInput.makeChkBoxInput(ActivityFields.PAID_FN, &quot;true&quot;, &quot;&quot;, getPaid(), false, ACTIVITY_FIELD_ON_CHANGE));</span>
<span class="fc" id="L752">					break;</span>
				case ActivityFields.DISPLAYABLE:
<span class="nc" id="L754">					m_formPC.addRow(getPaidLabel(), m_localizer.formatYesNo(getPaid()));</span>
				case ActivityFields.NON_DISPLAYABLE:
<span class="nc bnc" id="L756" title="All 2 branches missed.">					m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.PAID_FN, (getPaid() ? &quot;true&quot; : &quot;&quot;)));</span>
<span class="nc" id="L757">					m_hiddenFields.append(&quot;\n&quot;);</span>
					break;
			}

<span class="pc bpc" id="L761" title="1 of 2 branches missed.">			if (m_hasPayrollLicense) {</span>
				// Earning Type
<span class="nc bnc" id="L763" title="All 4 branches missed.">				switch (m_displayMap[ActivityFields.EARNING_TYPE]) {</span>
					case ActivityFields.EDITABLE:
<span class="nc" id="L765">						m_formPC.addRow(getEarningTypeLabel(), getEarningTypeDropDown(JSUtil.ON_CHANGE));</span>
<span class="nc" id="L766">						break;</span>
					case ActivityFields.DISPLAYABLE:
<span class="nc" id="L768">						m_formPC.addRow(getEarningTypeLabel(), getEarningTypeName());</span>
					case ActivityFields.NON_DISPLAYABLE:
<span class="nc" id="L770">						m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.EARNING_TYPE_FN, getEarningType()));</span>
<span class="nc" id="L771">						m_hiddenFields.append(&quot;\n&quot;);</span>
						break;
				}
			}

			// Color
<span class="pc bpc" id="L777" title="3 of 4 branches missed.">			switch (m_displayMap[ActivityFields.COLOR]) {</span>
				case ActivityFields.EDITABLE:
<span class="fc" id="L779">					m_formPC.addRow(getColorLabel(), getColorDispaly(true));</span>
					// a hidden field for color is always required
<span class="fc" id="L781">					m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.COLOR_FN, getColor()));</span>
<span class="fc" id="L782">					break;</span>
				case ActivityFields.DISPLAYABLE:
<span class="nc" id="L784">					m_formPC.addRow(getColorLabel(), getColorDispaly(false));</span>
				case ActivityFields.NON_DISPLAYABLE:
<span class="nc" id="L786">					m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.COLOR_FN, getColor()));</span>
					break;
			}

			// Color code
<span class="pc bpc" id="L791" title="3 of 4 branches missed.">			switch (m_displayMap[ActivityFields.COLOR_CODE]) {</span>
				case ActivityFields.EDITABLE:
<span class="fc" id="L793">					m_formPC.addRow(getColorCodeLabel(),</span>
<span class="fc" id="L794">						HtmlUtil.makeTextInput(ActivityFields.COLOR_CODE_FN, 4, 4, getColorCode(), JSUtil.ON_CHANGE));</span>
<span class="fc" id="L795">					break;</span>
				case ActivityFields.DISPLAYABLE:
<span class="nc" id="L797">					m_formPC.addRow(getColorCodeLabel(), getColorCode());</span>
				case ActivityFields.NON_DISPLAYABLE:
<span class="nc" id="L799">					m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.COLOR_CODE_FN, getColorCode()));</span>
<span class="nc" id="L800">					m_hiddenFields.append(&quot;\n&quot;);</span>
					break;
			}

			// Timeoff
<span class="pc bpc" id="L805" title="3 of 4 branches missed.">			switch (m_displayMap[ActivityFields.TIMEOFF]) {</span>
				case ActivityFields.EDITABLE:
<span class="fc" id="L807">					m_formPC.addRow(getTimeoffLabel(),</span>
<span class="fc" id="L808">						HtmlChoiceInput.makeChkBoxInput(ActivityFields.TIMEOFF_FN, &quot;true&quot;, &quot;&quot;,</span>
<span class="fc" id="L809">							getTimeoff(), isFieldDisabled(ActivityFields.TIMEOFF), ACTIVITY_FIELD_ON_CHANGE));</span>
<span class="fc" id="L810">					break;</span>
				case ActivityFields.DISPLAYABLE:
<span class="nc" id="L812">					m_formPC.addRow(getTimeoffLabel(), m_localizer.formatYesNo(getTimeoff()));</span>
				case ActivityFields.NON_DISPLAYABLE:
<span class="nc bnc" id="L814" title="All 2 branches missed.">					m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.TIMEOFF_FN, (getTimeoff() ? &quot;true&quot; : &quot;&quot;)));</span>
<span class="nc" id="L815">					m_hiddenFields.append(&quot;\n&quot;);</span>
					break;
			}

			//if (m_hasMultiMediaLicense) //Fixed QC#81240: Activity Edit page in web suite doesn't have a Media selector when Multi-Media license not present.
			{
				// Media selector row
<span class="pc bpc" id="L822" title="3 of 4 branches missed.">				switch (m_displayMap[ActivityFields.MEDIA]) {</span>
					case ActivityFields.EDITABLE:
<span class="fc" id="L824">						m_formPC.addRow(getMediaLabel(), getMediaDisplay(true));</span>
						// a hidden field for media is always required
<span class="fc" id="L826">						m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.MEDIA_FN, getMediaIdsString()));</span>
<span class="fc" id="L827">						break;</span>
					case ActivityFields.DISPLAYABLE:
<span class="nc" id="L829">						m_formPC.addRow(getMediaLabel(), getMediaDisplay(false));</span>
					case ActivityFields.NON_DISPLAYABLE:
<span class="nc" id="L831">						m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.MEDIA_FN, getMediaIdsString()));</span>
						break;
				}
			}

			//Queue Hopping checkbox
<span class="pc bpc" id="L837" title="1 of 2 branches missed.">			if (m_hasQueueHoppingLicense) {</span>
<span class="pc bpc" id="L838" title="3 of 4 branches missed.">				switch (m_displayMap[ActivityFields.QUEUE_HOPPING]) {</span>
					case ActivityFields.EDITABLE:
<span class="fc" id="L840">						m_formPC.addRow(getQueueHoppingLabel(),</span>
<span class="fc" id="L841">							HtmlChoiceInput.makeChkBoxInput(ActivityFields.QUEUE_HOPPING_FN, &quot;true&quot;, &quot;&quot;,</span>
<span class="fc" id="L842">								getQueueHopping(), isFieldDisabled(ActivityFields.QUEUE_HOPPING), ACTIVITY_FIELD_ON_CHANGE + &quot;getRemoteInitJS();\n&quot;));</span>
<span class="fc" id="L843">						break;</span>

					case ActivityFields.DISPLAYABLE:
<span class="nc" id="L846">						m_formPC.addRow(getQueueHoppingLabel(), m_localizer.formatYesNo(getPaid()));</span>

					case ActivityFields.NON_DISPLAYABLE:
<span class="nc bnc" id="L849" title="All 2 branches missed.">						m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.QUEUE_HOPPING_FN, (getQueueHopping() ? &quot;true&quot; : &quot;&quot;)));</span>
<span class="nc" id="L850">						m_hiddenFields.append(&quot;\n&quot;);</span>
						break;
				}
			}

			//Queues selector row
<span class="pc bpc" id="L856" title="3 of 4 branches missed.">			if (m_hasQueueHoppingLicense || m_hasMultiMediaLicense) {</span>
<span class="pc bpc" id="L857" title="3 of 4 branches missed.">				switch (m_displayMap[ActivityFields.QUEUES]) {</span>
					case ActivityFields.EDITABLE:
<span class="fc" id="L859">						m_formPC.addRow(getQueuesLabel(), getQueuesDisplay(true));</span>
						// a hidden field for queues is always required
<span class="fc" id="L861">						m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.QUEUES_FN, getQueueIdsString()));</span>
<span class="fc" id="L862">						break;</span>

					case ActivityFields.DISPLAYABLE:
<span class="nc" id="L865">						m_formPC.addRow(getQueuesLabel(), getQueuesDisplay(false));</span>

					case ActivityFields.NON_DISPLAYABLE:
<span class="nc" id="L868">						m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.QUEUES_FN, getQueueIdsString()));</span>
<span class="fc" id="L869">						break;</span>
				}
<span class="nc bnc" id="L871" title="All 4 branches missed.">			} else if (m_displayMap[ActivityFields.QUEUES] == ActivityFields.EDITABLE ||</span>
				m_displayMap[ActivityFields.QUEUES] == ActivityFields.NON_DISPLAYABLE) {
<span class="nc" id="L873">				m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.QUEUES_FN, getQueueIdsString()));</span>
			}


/*			if(!ActivityFields.isSystemActivity(getActivityID()))
				m_formPC.addRow(getCanRemoteLabel(),
						HtmlChoiceInput.makeChkBoxInput(ActivityFields.CAN_WORK_REMOTELY_FN, &quot;true&quot;, &quot;&quot;, getAllowRemote(), false, &quot;&quot;));
			else
				m_hiddenFields.append(HtmlUtil.makeHiddenInput(ActivityFields.CAN_WORK_REMOTELY_FN, &quot;&quot;) ); */

			// init FS &amp; RM usage
<span class="pc bpc" id="L884" title="1 of 2 branches missed.">			if (isAuthorizedToConfigureFSAttributes(getSelectedIDObject())) {</span>
<span class="fc" id="L885">				m_fsUsagePC.initForm(m_activity, activityProperties, true, m_hiddenFields, m_displayMap, m_hasMedia, m_hasProjectMedia);</span>
<span class="fc" id="L886">				m_rmUsagePC.initForm(m_activity, activityProperties, true, m_hiddenFields, m_displayMap, m_hasMedia, m_hasProjectMedia);</span>
			} else {
<span class="nc" id="L888">				m_fsUsagePC.initForm(m_activity, activityProperties, true, m_hiddenFields, ActivityFields.nonDisplayableDisplayMap, m_hasMedia, m_hasProjectMedia);</span>
<span class="nc" id="L889">				m_rmUsagePC.initForm(m_activity, activityProperties, true, m_hiddenFields, ActivityFields.nonDisplayableDisplayMap, m_hasMedia, m_hasProjectMedia);</span>
			}

			// init AM usage
<span class="pc bpc" id="L893" title="1 of 2 branches missed.">			if (isAuthorizedToConfigureAMAttributes(getSelectedIDObject())) {</span>
<span class="fc" id="L894">				m_amUsagePC.initForm(m_activity, activityProperties, true, m_hiddenFields, m_displayMap, m_hasMedia, m_hasProjectMedia);</span>
			} else {
<span class="nc" id="L896">				m_amUsagePC.initForm(m_activity, activityProperties, true, m_hiddenFields, ActivityFields.nonDisplayableDisplayMap, m_hasMedia, m_hasProjectMedia);</span>
			}

			//init advisor usage
<span class="pc bpc" id="L900" title="1 of 2 branches missed.">			if (m_hasAdvisorLicense) {</span>
<span class="fc" id="L901">				m_advisorUsagePC.initForm(m_activity, activityProperties, true, m_hiddenFields, m_displayMap, m_hasMedia, m_hasProjectMedia);</span>
			} else {
<span class="nc" id="L903">				m_advisorUsagePC.initForm(m_activity, activityProperties, true, m_hiddenFields, ActivityFields.nonDisplayableDisplayMap, m_hasMedia, m_hasProjectMedia);</span>
			}

<span class="nc" id="L906">		} catch (Exception ex) {</span>
<span class="nc" id="L907">			handleUnableToLoadDataError(log, ex);</span>
<span class="nc" id="L908">			m_initFailure = true;</span>
<span class="fc" id="L909">		}</span>
<span class="fc" id="L910">	}</span>

	/**
	 * Return true if selected Org is valid; Override parent method to allow editing
	 * of activities define in the root (system)level
	 */
	protected boolean isValidSelectedOrg() {
<span class="fc" id="L917">		return hasSelectedID();</span>
	}

	protected void initFieldValidators() {
		// validators were added in initForm() since fields are not necessary rendered
<span class="fc" id="L922">	}</span>


	private String getNameLabel() {
<span class="fc" id="L926">		return i18n(m_common_bundle, UIFWebBundleKey.LABEL_NAME);</span>
	}

	private String getDescriptionLabel() {
<span class="fc" id="L930">		return i18n(m_common_bundle, UIFWebBundleKey.LABEL_DESCRIPTION);</span>
	}

	private String getActivityTypeLabel() {
<span class="fc" id="L934">		return i18n(m_bbmBundle, BbmWebBundleKey.ACTIVITY_LABEL_ACTIVITY_TYPE);</span>
	}

	/**
	 * Return the DropDown display of activity types
	 */
	private String getActivityTypeDropDown(String onChangeJS) {
<span class="pc bpc" id="L941" title="1 of 2 branches missed.">		if (m_activityTypeStringPair != null) {</span>
<span class="fc" id="L942">			return HtmlUtil.makeSelectInput(ActivityFields.ACTIVITY_CATEGORY_FN,</span>
				m_selectedActivityType, onChangeJS,
				m_activityTypeStringPair);
		} else {
<span class="nc" id="L946">			return &quot;&amp;nbsp;&quot;;</span>
		}
	}

	private String getActivityTypeName() {
		// Scan the m_activityTypeStringPair collection for the name of the activity type
<span class="nc bnc" id="L952" title="All 6 branches missed.">		if (m_activityTypeStringPair == null || m_activityTypeStringPair.isEmpty() || StringUtil.isEmpty(getActivityType())) {</span>
<span class="nc" id="L953">			return HtmlUtil.NBSP;</span>
		}

<span class="nc" id="L956">		String key = getActivityType();</span>
<span class="nc" id="L957">		StringsPair sp = null;</span>
<span class="nc bnc" id="L958" title="All 2 branches missed.">		for (Iterator&lt;StringsPair&gt; it = m_activityTypeStringPair.iterator(); it.hasNext(); ) {</span>
<span class="nc" id="L959">			sp = it.next();</span>
<span class="nc bnc" id="L960" title="All 2 branches missed.">			if (sp.getKey().equals(key)) {</span>
<span class="nc" id="L961">				return sp.getValue();</span>
			}
		}
<span class="nc" id="L964">		return HtmlUtil.NBSP;</span>
	}

	private String getEarningTypeName() {
		// Scan the m_activityTypeStringPair collection for the name of the activity type
<span class="nc bnc" id="L969" title="All 6 branches missed.">		if (m_earningTypeStringPair == null || m_earningTypeStringPair.isEmpty() || StringUtil.isEmpty(getEarningType())) {</span>
<span class="nc" id="L970">			return HtmlUtil.NBSP;</span>
		}
<span class="nc" id="L972">		StringsPair sp = null;</span>
<span class="nc" id="L973">		String key = getEarningType();</span>
<span class="nc bnc" id="L974" title="All 2 branches missed.">		for (Iterator&lt;StringsPair&gt; it = m_earningTypeStringPair.iterator(); it.hasNext(); ) {</span>
<span class="nc" id="L975">			sp = it.next();</span>
<span class="nc bnc" id="L976" title="All 2 branches missed.">			if (sp.getKey().equals(key)) {</span>
<span class="nc" id="L977">				return sp.getValue();</span>
			}
		}
<span class="nc" id="L980">		return HtmlUtil.NBSP;</span>
	}


	private String getEarningTypeLabel() {
<span class="nc" id="L985">		return i18n(m_bbmBundle, BbmWebBundleKey.ACTIVITY_LABEL_EARNING_TYPE);</span>
	}

	/**
	 * Return the DropDown display of activity types
	 */
	private String getEarningTypeDropDown(String onChangeJS) {
<span class="nc bnc" id="L992" title="All 2 branches missed.">		if (m_earningTypeStringPair != null) {</span>
<span class="nc" id="L993">			return HtmlUtil.makeSelectInput(ActivityFields.EARNING_TYPE_FN,</span>
				m_selectedEarningType, onChangeJS,
				m_earningTypeStringPair);
		} else {
<span class="nc" id="L997">			return &quot;&amp;nbsp;&quot;;</span>
		}
	}

	private String getPaidLabel() {
<span class="fc" id="L1002">		return i18n(m_bbmBundle, BbmWebBundleKey.ACTIVITY_LABEL_IS_PAID);</span>
	}

	private String getTimeoffLabel() {
<span class="fc" id="L1006">		return i18n(m_bbmBundle, BbmWebBundleKey.ACTIVITY_LABEL_TIMEOFF);</span>
	}

	private String getMediaLabel() {
<span class="fc" id="L1010">		return i18n(m_bbmBundle, BbmWebBundleKey.ACTIVITY_LABEL_MEDIA);</span>
	}

	//TBD: Verticalize string
	private String getQueuesLabel() {
<span class="fc" id="L1015">		return i18n(m_bbmBundle, BbmWebBundleKey.ACTIVITY_LABEL_QUEUES);</span>
	}

	//TBD: Verticalize string
	private String getQueueHoppingLabel() {
<span class="fc" id="L1020">		return i18n(m_bbmBundle, BbmWebBundleKey.ACTIVITY_LABEL_IS_QUEUE_HOPPING);</span>
	}

	private String getColorDispaly(boolean editable) {
<span class="fc" id="L1024">		StringBuffer htmlColor = new StringBuffer(256);</span>

<span class="fc" id="L1026">		htmlColor.append(&quot;\n&lt;input name=\&quot;&quot;).append(ActivityFields.COLOR_FN).append(&quot;Show\&quot;&quot;)</span>
<span class="fc" id="L1027">			.append(&quot; id=\&quot;&quot;).append(ActivityFields.COLOR_FN).append(&quot;Show\&quot;&quot;)</span>
<span class="fc" id="L1028">			.append(&quot; type=\&quot;text\&quot; class=\&quot;colorshow\&quot; readonly &quot;)</span>
<span class="fc" id="L1029">			.append(&quot;style=\&quot;background-color: &quot;).append(getColor())</span>
<span class="fc" id="L1030">			.append(&quot;; vertical-align:bottom\&quot; &quot;)</span>
<span class="fc" id="L1031">			.append(&quot;size=\&quot;1\&quot; maxlength=\&quot;1\&quot; value=\&quot; \&quot;&gt;&quot;);</span>

<span class="pc bpc" id="L1033" title="1 of 2 branches missed.">		if (editable) {</span>
<span class="fc" id="L1034">			htmlColor.append(&quot;\n&lt;img onClick=\&quot;popupbutton0.onSelect('&quot;)</span>
<span class="fc" id="L1035">				.append(ACTIVITY_COLOR_PICKER_NAME).append(&quot;', this);\&quot;&quot;)</span>
<span class="fc" id="L1036">				.append(&quot; width=\&quot;&quot;).append(ImageFileID.COLOR_PICKER_WIDTH)</span>
<span class="fc" id="L1037">				.append(&quot;\&quot; height=\&quot;&quot;).append(ImageFileID.COLOR_PICKER_HEIGHT)</span>
<span class="fc" id="L1038">				.append(&quot;\&quot; src=\&quot;&quot;).append(ImageFileID.COLOR_PICKER)</span>
				//.append(&quot;\&quot; alt=\&quot;&quot;).append(m_common_bundle.getString(UIFWebBundleKey.COLOR_PICKER))
<span class="fc" id="L1040">				.append(&quot;\&quot; alt=\&quot;&quot;).append(m_localizer.i18n(m_common_bundle, UIFWebBundleKey.COLOR_PICKER))</span>
<span class="fc" id="L1041">				.append(&quot;\&quot; align=\&quot;absmiddle\&quot;&gt;&quot;);</span>
		}
<span class="fc" id="L1043">		return htmlColor.toString();</span>
	}

	private String getMediaDisplay(boolean editable) throws RemoteException, BbmException {
<span class="fc" id="L1047">		StringBuffer sb = new StringBuffer(512);</span>
<span class="fc" id="L1048">		sb.append(makeTextReadOnlyInput(MEDIA_NAMES_DISPLAY_FN, 45, getMediaNamesString()));</span>
<span class="pc bpc" id="L1049" title="1 of 2 branches missed.">		if (editable) {</span>
<span class="fc" id="L1050">			sb.append(&quot;&lt;span &quot;).append(&quot;id=\&quot;&quot;).append(MEDIA_NAMES_DISPLAY_SPAN).append(&quot;\&quot; &quot;);</span>
<span class="fc" id="L1051">			sb.append(&quot;name=\&quot;&quot;).append(MEDIA_NAMES_DISPLAY_SPAN).append(&quot;\&quot; &quot;);</span>
<span class="fc" id="L1052">			sb.append(&quot;onClick=\&quot;&quot;).append(&quot;MediaSelectorPopup();\&quot;&quot;);</span>
<span class="pc bpc" id="L1053" title="1 of 2 branches missed.">			if (isFieldDisabled(ActivityFields.MEDIA)) {</span>
<span class="nc" id="L1054">				sb.append(&quot; style=\&quot;visibility:hidden;\&quot;&quot;);</span>
			} else {
<span class="fc" id="L1056">				sb.append(&quot; style=\&quot;visibility:visible;\&quot;&quot;);</span>
			}
<span class="fc" id="L1058">			sb.append(&quot; &gt;&quot;);</span>
<span class="fc" id="L1059">			sb.append(HtmlUtil.imageTag(ImageFileID.EDIT, ImageFileID.EDIT_WIDTH,</span>
<span class="fc" id="L1060">				ImageFileID.EDIT_HEIGHT, i18n(m_bbmBundle, BbmWebBundleKey.EDIT)));</span>
<span class="fc" id="L1061">			sb.append(&quot;&lt;/span&gt;&quot;);</span>
		}
<span class="fc" id="L1063">		return sb.toString();</span>
	}

	private String getMediaIdsString() {
<span class="fc" id="L1067">		return StringUtil.createDelimitedString(m_mediaIds, &quot;,&quot;);</span>
	}

	private String getMediaNamesString() throws RemoteException, BbmException {
<span class="fc" id="L1071">		return WorkloadModelHandler.getMediaDisplayFromIds(m_context, m_mediaIds);</span>
	}


	private String getQueuesDisplay(boolean editable) throws RemoteException, BbmException {
<span class="fc" id="L1076">		StringBuffer sb = new StringBuffer(512);</span>
<span class="fc" id="L1077">		sb.append(makeTextReadOnlyInput(QUEUE_NAMES_DISPLAY_FN, 45, getQueueNamesString()));</span>
<span class="pc bpc" id="L1078" title="1 of 2 branches missed.">		if (editable) {</span>
<span class="fc" id="L1079">			sb.append(&quot;&lt;span &quot;).append(&quot;id=\&quot;&quot;).append(QUEUE_NAMES_DISPLAY_SPAN).append(&quot;\&quot; &quot;);</span>
<span class="fc" id="L1080">			sb.append(&quot;name=\&quot;&quot;).append(QUEUE_NAMES_DISPLAY_SPAN).append(&quot;\&quot; &quot;);</span>
<span class="fc" id="L1081">			sb.append(&quot;onClick=\&quot;&quot;).append(&quot;QueueSelectorPopup();\&quot;&quot;);</span>
<span class="pc bpc" id="L1082" title="1 of 2 branches missed.">			if (isFieldDisabled(ActivityFields.QUEUES)) {</span>
<span class="fc" id="L1083">				sb.append(&quot; style=\&quot;visibility:hidden;\&quot;&quot;);</span>
			} else {
<span class="nc" id="L1085">				sb.append(&quot; style=\&quot;visibility:visible;\&quot;&quot;);</span>
			}
<span class="fc" id="L1087">			sb.append(&quot; &gt;&quot;);</span>
<span class="fc" id="L1088">			sb.append(HtmlUtil.imageTag(ImageFileID.EDIT, ImageFileID.EDIT_WIDTH,</span>
<span class="fc" id="L1089">				ImageFileID.EDIT_HEIGHT, i18n(m_bbmBundle, BbmWebBundleKey.EDIT)));</span>
<span class="fc" id="L1090">			sb.append(&quot;&lt;/span&gt;&quot;);</span>
		}
<span class="fc" id="L1092">		return sb.toString();</span>
	}

	private String makeTextReadOnlyInput(String name, int size, String value) {
<span class="fc" id="L1096">		StringBuffer sb = new StringBuffer(128);</span>
<span class="fc" id="L1097">		sb.append(&quot;&lt;input type=\&quot;text\&quot; class=\&quot;inputTextReadOnly\&quot; readonly &quot;)</span>
<span class="fc" id="L1098">			.append(&quot;name=\&quot;&quot;).append(name).append(&quot;\&quot; &quot;)</span>
<span class="fc" id="L1099">			.append(&quot;id=\&quot;&quot;).append(name).append(&quot;\&quot; &quot;)</span>
<span class="fc" id="L1100">			.append(&quot; onChange=\&quot;&quot;).append(&quot;getRemoteInitJS();\n&quot;).append(&quot;\&quot;&quot;);</span>
<span class="pc bpc" id="L1101" title="1 of 2 branches missed.">		if (size &gt; 0) sb.append(&quot;size=\&quot;&quot;).append(size).append(&quot;\&quot; &quot;);</span>
<span class="fc" id="L1102">		sb.append(&quot;value=\&quot;&quot;).append(HtmlUtil.escapeFieldValue(value)).append(&quot;\&quot; &quot;)</span>
<span class="fc" id="L1103">			.append(&quot;&gt;&quot;);</span>
<span class="fc" id="L1104">		return sb.toString();</span>
	}//makeTextReadOnlyInput

	private String getQueueIdsString() {
<span class="fc" id="L1108">		return StringUtil.createDelimitedString(m_queueIds, &quot;,&quot;);</span>
	}

	private String getQueueNamesString() throws RemoteException, BbmException {
<span class="fc" id="L1112">		return WorkloadModelHandler.getQueueDisplayFromIds(m_context, m_queueIds);</span>
	}


	private String getColorCodeLabel() {
<span class="fc" id="L1117">		return i18n(m_bbmBundle, BbmWebBundleKey.ACTIVITY_LABEL_COLOR_CODE);</span>
	}

	private String getColorLabel() {
<span class="fc" id="L1121">		return i18n(m_bbmBundle, BbmWebBundleKey.ACTIVITY_LABEL_COLOR);</span>
	}

	private void setDefaultValues() {
<span class="fc" id="L1125">		m_activity.setPaid(PAID_DEFAULT);</span>
<span class="fc" id="L1126">		m_activity.setColor(ACTIVITY_COLOR_DEFAULT);</span>
<span class="fc" id="L1127">		m_activity.setTimeoff(TIMEOFF_DEFAULT);</span>
<span class="fc" id="L1128">		m_fsUsagePC.setDefaultValues();</span>
<span class="fc" id="L1129">		m_rmUsagePC.setDefaultValues();</span>
<span class="fc" id="L1130">		m_amUsagePC.setDefaultValues();</span>
<span class="fc" id="L1131">	}</span>

	private boolean isFieldDisabled(short field) {
<span class="pc bpc" id="L1134" title="1 of 5 branches missed.">		switch (field) {</span>
			case ActivityFields.TIMEOFF:
<span class="pc bpc" id="L1136" title="1 of 2 branches missed.">				if (m_activity.isTimeoff()) return false;</span>
<span class="fc" id="L1137">				return m_hasMedia;</span>
			case ActivityFields.MEDIA:
<span class="pc bpc" id="L1139" title="1 of 2 branches missed.">				if (m_hasMedia) return false;</span>
<span class="pc bpc" id="L1140" title="3 of 6 branches missed.">				return m_activity.isUsedInCalendarEvent() || m_activity.isTimeoff() || m_activity.isUnavailability();</span>
			case ActivityFields.QUEUES:
<span class="pc bpc" id="L1142" title="1 of 2 branches missed.">				if (m_hasQueues) return false;</span>
<span class="pc bpc" id="L1143" title="2 of 4 branches missed.">				return !m_activity.isQueueHopping() &amp;&amp; !hasProjectMedia();</span>
			case ActivityFields.QUEUE_HOPPING:
<span class="pc bpc" id="L1145" title="1 of 2 branches missed.">				if (hasProjectMedia()) return true;</span>
<span class="fc" id="L1146">				return false;</span>
		}
<span class="nc" id="L1148">		return false;</span>
	}

	/**
	 * Checks to see if there is a Project media is linked to this activity.
	 *
	 * @return
	 */
	private boolean hasProjectMedia() {
<span class="pc bpc" id="L1157" title="3 of 4 branches missed.">		return m_mediaIds != null &amp;&amp; m_mediaIds.contains(Media.MEDIA_ID_PROJECT);</span>
	}

	/**
	 * Return true if Current User is authorized to configure activity FS attributes
	 */
	protected boolean isAuthorizedToConfigureFSAttributes(ID orgID) {
<span class="fc" id="L1164">		return m_context.getUser().isAuthorized(PrivilegeKeys.CORE_VIEWACTIVITIES,</span>
<span class="fc" id="L1165">			OrganizationScopeManagerProxy.getScopeID(orgID));</span>
	}

	/**
	 * Return true if Current User is authorized to configure activity AM attributes
	 */
	protected boolean isAuthorizedToConfigureAMAttributes(ID orgID) {
<span class="fc" id="L1172">		return m_context.getUser().isAuthorized(PrivilegeKeys.CORE_VIEWACTIVITIES,</span>
<span class="fc" id="L1173">			OrganizationScopeManagerProxy.getScopeID(orgID));</span>
	}

	/**
	 * Return true if Current User is authorized to configure activity AM attributes
	 */
	protected boolean isAuthorizedToConfigureAdvisorAttributes(ID orgID) {
<span class="nc" id="L1180">		return m_context.getUser().isAuthorized(PrivilegeKeys.CORE_VIEWACTIVITIES,</span>
<span class="nc" id="L1181">			OrganizationScopeManagerProxy.getScopeID(orgID));</span>
	}

	private void checkForLicenses() {
		try {
<span class="fc" id="L1186">			LicenseManager licManager = CoreManagerFactory.getLicenseManager();</span>
<span class="fc" id="L1187">			m_hasPayrollLicense = licManager.isLicensed(LicenseKeys.APP_PAYROLL);</span>
<span class="fc" id="L1188">			m_hasMultiMediaLicense = licManager.isLicensed(LicenseKeys.APP_MULTIMEDIA);</span>
<span class="fc" id="L1189">			m_hasQueueHoppingLicense = licManager.isLicensed(LicenseKeys.APP_QUEUE_HOPPING);</span>
<span class="fc" id="L1190">			m_hasAdvisorLicense = licManager.isLicensed(LicenseKeys.APP_ADVISOR_EXPRESS);</span>
<span class="nc" id="L1191">		} catch (Exception ex) {</span>
<span class="nc" id="L1192">			log.l7dError(BbmWebBundleKey.UNABLE_TO_LOAD_DATA, ex);</span>
<span class="fc" id="L1193">		}</span>
<span class="fc" id="L1194">	}</span>

	protected void setSourceMeasureNullObjectIfNull() {
<span class="pc bpc" id="L1197" title="1 of 2 branches missed.">		if (m_activity.getSourceMeasureId() == null)</span>
<span class="fc" id="L1198">			m_activity.setFieldNull(ActivityFieldInfo.SOURCEMEASUREID);</span>
<span class="fc" id="L1199">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>