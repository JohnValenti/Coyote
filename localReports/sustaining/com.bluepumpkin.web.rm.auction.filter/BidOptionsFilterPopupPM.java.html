<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>BidOptionsFilterPopupPM.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.rm.auction.filter</a> &gt; <span class="el_source">BidOptionsFilterPopupPM.java</span></div><h1>BidOptionsFilterPopupPM.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.rm.auction.filter;

import java.util.*;
import javax.servlet.http.HttpServletRequest;
import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.IDStringPair;
import com.bluepumpkin.common.datatypes.StringsPair;
import com.bluepumpkin.common.logging.Category;
import com.bluepumpkin.common.util.StringUtil;
import com.bluepumpkin.ejb.rm.base.RmHardValidationException;
import com.bluepumpkin.ejb.rm.requests.shiftbid.shiftbidauction.model.ShiftBidAuction;
import com.bluepumpkin.ejb.rm.setup.settings.model.OrganizationSetting;
import com.bluepumpkin.ejb.rm.util.LicenseUtil;
import com.bluepumpkin.web.bbm.l10n.BbmWebBundleKey;
import com.bluepumpkin.web.bbm.organization.OrganizationModelHandler;
import com.bluepumpkin.web.rm.Log;
import com.bluepumpkin.web.rm.auction.AuctionMH;
import com.bluepumpkin.web.rm.keys.RmKeys;
import com.bluepumpkin.web.rm.l10n.RmWebBundleKey;
import com.bluepumpkin.web.rm.l10n.RmWebLogBundleKey;
import com.witness.web.uif.base.Message;
import com.witness.web.uif.keys.JavaScriptFileID;
import com.witness.web.uif.pagecomponent.DefaultNodeData;
import com.witness.web.uif.pagecomponent.container.Collapsible2ColFormPC;
import com.witness.web.uif.pagecomponent.form.FormInputPC;
import com.witness.web.uif.pagecomponent.picker.time.TimePickerPC;
import com.witness.web.uif.pagecomponent.picker.time.TimeRangePickerPC;
import com.witness.web.uif.pagecomponent.toolbar.ToolbarUtil;
import com.witness.web.uif.pagemodel.ContainersInRowsPM;
import com.witness.web.uif.pagemodel.PageModel;
import com.witness.web.uif.pagemodel.PopupWindowPM;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.util.ContainerList;
import com.witness.web.uif.util.HtmlUtil;
import com.witness.web.uif.util.js.JSUtil;
import com.witness.web.uif.util.html.HtmlBooleanCheckbox;
import com.witness.web.uif.pagecomponent.assignmentbox.AssignmentBoxPC;
import com.bluepumpkin.web.bbm.skill.SkillModelHandler;
import com.bluepumpkin.ejb.bbm.skill.model.Skill;
import com.bluepumpkin.ejb.bbm.skill.model.SkillFieldInfo;
import com.bluepumpkin.ejb.bbm.activity.model.ActivityFilter;
import com.bluepumpkin.ejb.bbm.campaign.model.SchedulingPeriod;
import com.bluepumpkin.web.bbm.activity.ActivityModelHandler;
import com.bluepumpkin.ejb.bbm.activity.model.Activity;
import com.bluepumpkin.ejb.rm.requests.shiftbid.shiftbidrequest.model.ShiftBidder;
import com.witness.web.uif.util.SortUtil;
import com.bluepumpkin.web.rm.auction.AuctionUtil;
import com.bluepumpkin.web.rm.setup.settings.SettingsModelHandler;

/**
 * Title: BidOptionsFilterPopupPM Description: Model for the popup allowing the
 * user to configure a Bid Options Filter. The form will have collapsible
 * sections for grouping the main types of filtering options. Most of the
 * dropdown lists on the form will show/hide &quot;buddy&quot; elements depending on the
 * user's selection. A buddy element is just another form field (ex, an input
 * field) which is located close to the dropdown list. Copyright: Copyright (c)
 * 2005 Company: Witness Systems, Inc.
 * 
 * @author Gonzalo Quintanar
 * @version 1.0
 */
public class BidOptionsFilterPopupPM extends PopupWindowPM implements ContainersInRowsPM {
	// Field Name Constants
	public static final String AUCTION_ID_FN = &quot;auctionID&quot;;
	public static final String BIDDER_ID_FN = &quot;bidderID&quot;;
	// public static final String EMPLOYEE_ID_FN = &quot;employeeID&quot;;
	// public static final String CAMPAIGN_ID_FN = &quot;campaignID&quot;;
	public static final String USE_SESSION_FILTER_FN = &quot;useSessionFilter&quot;;

	private static final String AVAIL_VAL1 = &quot;availabilityValue1&quot;;
	private static final String AVAIL_VAL2 = &quot;availabilityValue2&quot;;
	private static final String SCHED_LEN_VAL1 = &quot;scheduleLengthValue1&quot;;
	private static final String SCHED_LEN_VAL2 = &quot;scheduleLengthValue2&quot;;
	private static final String SHIFT_LEN_VAL1 = &quot;shiftLengthValue1&quot;;
	private static final String SHIFT_LEN_VAL2 = &quot;shiftLengthValue2&quot;;
	private static final String SHIFT_START_TIME = &quot;shiftStartTime&quot;;
	private static final String SHIFT_START_RANGE = &quot;shiftStartRange&quot;;
	private static final String SHIFT_END_TIME = &quot;shiftEndTime&quot;;
	private static final String SHIFT_END_RANGE = &quot;shiftEndRange&quot;;
	private static final String ACTIVITY1_LEN_VAL1 = &quot;activity1LengthValue1&quot;;
	private static final String ACTIVITY1_LEN_VAL2 = &quot;activity1LengthValue2&quot;;
	private static final String ACTIVITY2_LEN_VAL1 = &quot;activity2LengthValue1&quot;;
	private static final String ACTIVITY2_LEN_VAL2 = &quot;activity2LengthValue2&quot;;
	private static final String ACTIVITY1_START_TIME = &quot;activity1StartTime&quot;;
	private static final String ACTIVITY1_START_RANGE = &quot;activity1StartRange&quot;;
	private static final String ACTIVITY2_START_TIME = &quot;activity2StartTime&quot;;
	private static final String ACTIVITY2_START_RANGE = &quot;activity2StartRange&quot;;

	// Span Name Constants
	private static final String SHIFT_CHECKBOX_SPAN = &quot;SHIFT_CHECKBOX_SPAN&quot;;
	private static final String WP_CHECKBOX_SPAN = &quot;WP_CHECKBOX_SPAN&quot;;
	private static final String SCHED_LEN_USE_LEFT_SPAN = &quot;SCHED_LEN_USE_LEFT_SPAN&quot;;
	private static final String SCHED_LEN_USE_RIGHT_SPAN = &quot;SCHED_LEN_USE_RIGHT_SPAN&quot;;
	private static final String SHIFT_LEN_CHECKBOX_SPAN = &quot;SHIFT_LEN_CHECKBOX_SPAN&quot;;
	private static final String SHIFT_LEN_USE_LEFT_SPAN = &quot;SHIFT_LEN_USE_LEFT_SPAN&quot;;
	private static final String SHIFT_LEN_USE_RIGHT_SPAN = &quot;SHIFT_LEN_USE_RIGHT_SPAN&quot;;
	private static final String SHIFT_START_TIME_SPAN = &quot;SHIFT_START_TIME_SPAN&quot;;
	private static final String SHIFT_START_RANGE_SPAN = &quot;SHIFT_START_RANGE_SPAN&quot;;
	private static final String SHIFT_END_TIME_SPAN = &quot;SHIFT_END_TIME_SPAN&quot;;
	private static final String SHIFT_END_RANGE_SPAN = &quot;SHIFT_END_RANGE_SPAN&quot;;
	private static final String SHIFT_START_CHECKBOX_SPAN = &quot;SHIFT_START_CHECKBOX_SPAN&quot;;
	private static final String SHIFT_END_CHECKBOX_SPAN = &quot;SHIFT_END_CHECKBOX_SPAN&quot;;
	private static final String ACTIVITY1_LEN_CHECKBOX_SPAN = &quot;ACTIVITY1_LEN_CHECKBOX_SPAN&quot;;
	private static final String ACTIVITY1_LEN_USE_LEFT_SPAN = &quot;ACTIVITY1_LEN_USE_LEFT_SPAN&quot;;
	private static final String ACTIVITY1_LEN_USE_RIGHT_SPAN = &quot;ACTIVITY1_LEN_USE_RIGHT_SPAN&quot;;
	private static final String ACTIVITY2_LEN_CHECKBOX_SPAN = &quot;ACTIVITY2_LEN_CHECKBOX_SPAN&quot;;
	private static final String ACTIVITY2_LEN_USE_LEFT_SPAN = &quot;ACTIVITY2_LEN_USE_LEFT_SPAN&quot;;
	private static final String ACTIVITY2_LEN_USE_RIGHT_SPAN = &quot;ACTIVITY2_LEN_USE_RIGHT_SPAN&quot;;
	private static final String ACTIVITY1_START_TIME_SPAN = &quot;ACTIVITY1_START_TIME_SPAN&quot;;
	private static final String ACTIVITY1_START_RANGE_SPAN = &quot;ACTIVITY1_START_RANGE_SPAN&quot;;
	private static final String ACTIVITY2_START_TIME_SPAN = &quot;ACTIVITY2_START_TIME_SPAN&quot;;
	private static final String ACTIVITY2_START_RANGE_SPAN = &quot;ACTIVITY2_START_RANGE_SPAN&quot;;
	private static final String ACTIVITY1_START_CHECKBOX_SPAN = &quot;ACTIVITY1_START_CHECKBOX_SPAN&quot;;
	private static final String ACTIVITY2_START_CHECKBOX_SPAN = &quot;ACTIVITY2_START_CHECKBOX_SPAN&quot;;

	// JavaScript variable name constants
	private static final String AVAIL_VISIBLE_MAP = &quot;AVAIL_VISIBLE_MAP&quot;;
	private static final String AVAIL_INVISIBLE_MAP = &quot;AVAIL_INVISIBLE_MAP&quot;;
	private static final String SCHED_LEN_VISIBLE_MAP = &quot;SCHED_LEN_VISIBLE_MAP&quot;;
	private static final String SCHED_LEN_INVISIBLE_MAP = &quot;SCHED_LEN_INVISIBLE_MAP&quot;;
	private static final String SHIFT_LEN_VISIBLE_MAP = &quot;SHIFT_LEN_VISIBLE_MAP&quot;;
	private static final String SHIFT_LEN_INVISIBLE_MAP = &quot;SHIFT_LEN_INVISIBLE_MAP&quot;;
	private static final String SHIFT_START_VISIBLE_MAP = &quot;SHIFT_START_VISIBLE_MAP&quot;;
	private static final String SHIFT_START_INVISIBLE_MAP = &quot;SHIFT_START_INVISIBLE_MAP&quot;;
	private static final String SHIFT_END_VISIBLE_MAP = &quot;SHIFT_END_VISIBLE_MAP&quot;;
	private static final String SHIFT_END_INVISIBLE_MAP = &quot;SHIFT_END_INVISIBLE_MAP&quot;;
	private static final String ACTIVITY1_LEN_VISIBLE_MAP = &quot;ACTIVITY1_LEN_VISIBLE_MAP&quot;;
	private static final String ACTIVITY1_LEN_INVISIBLE_MAP = &quot;ACTIVITY1_LEN_INVISIBLE_MAP&quot;;
	private static final String ACTIVITY2_LEN_VISIBLE_MAP = &quot;ACTIVITY2_LEN_VISIBLE_MAP&quot;;
	private static final String ACTIVITY2_LEN_INVISIBLE_MAP = &quot;ACTIVITY2_LEN_INVISIBLE_MAP&quot;;
	private static final String ACTIVITY1_START_VISIBLE_MAP = &quot;ACTIVITY1_START_VISIBLE_MAP&quot;;
	private static final String ACTIVITY1_START_INVISIBLE_MAP = &quot;ACTIVITY1_START_INVISIBLE_MAP&quot;;
	private static final String ACTIVITY2_START_VISIBLE_MAP = &quot;ACTIVITY2_START_VISIBLE_MAP&quot;;
	private static final String ACTIVITY2_START_INVISIBLE_MAP = &quot;ACTIVITY2_START_INVISIBLE_MAP&quot;;

	// Convenience Constants
	private static final String EMPTY = &quot;&quot;;
	private static final String SPACE = &quot; &quot;;
	private static final String NBSP = HtmlUtil.NBSP;
	private static final String DDWIDTH = &quot;128px&quot;; // &quot;192px&quot;; //Width for the
													// dropdown fields
	public static final int ASSIGNMENT_BOX_ENTRIES = 10;

	// Style Constants. TBD: Can we use HtmlUtil.mergeStyles() instead of
	// creating our own?
	private static final String STYLE1 = &quot;formRowLightNoBorderBottom&quot;; // has
																		// left
																		// and
																		// right
																		// padding
	private static final String STYLE2 = &quot;formRowLightNoBorderBottom2&quot;; // No
																		// left
																		// or
																		// right
																		// padding
	private static final String STYLE3 = &quot;formRowDarkNoBorderBottom&quot;; // No left
																		// or
																		// right
																		// padding
	private static final String STYLE4 = &quot;formRowLightNoBorderBottomNoHeight&quot;; // has
																				// left
																				// and
																				// right
																				// padding

	// Field Value Constants
	private static final String UNDEFINED_FV = EMPTY + BidOptionsFilter.UNDEFINED_STR;
	private static final String EQUAL_FV = EMPTY + BidOptionsFilter.EQUAL;
	private static final String MIN_FV = EMPTY + BidOptionsFilter.MIN;
	private static final String MAX_FV = EMPTY + BidOptionsFilter.MAX;
	private static final String BETWEEN_FV = EMPTY + BidOptionsFilter.BETWEEN;
	private static final String LENGTH_USE_ACTUAL_FV = EMPTY + BidOptionsFilter.LENGTH_USE_ACTUAL;
	private static final String LENGTH_USE_PAID_TIME_FV = EMPTY + BidOptionsFilter.LENGTH_USE_PAID_TIME;
	private static final String SKILLS_MATCH_EXACT_FV = EMPTY + BidOptionsFilter.SKILLS_MATCH_EXACT;
	private static final String SKILLS_MATCH_AT_LEAST_FV = EMPTY + BidOptionsFilter.SKILLS_MATCH_AT_LEAST;
	private static final String SKILLS_MATCH_AT_MOST_FV = EMPTY + BidOptionsFilter.SKILLS_MATCH_AT_MOST;

	// Constants representing the types of dropdown lists which can have &quot;buddy&quot;
	// fields next to them
	protected static final int DD_TYPE_ID = 0;
	protected static final int DD_TYPE_LENGTH = 1;
	protected static final int DD_TYPE_TIME = 2;
	protected static final int DD_TYPE_COUNT = 3;

	// Constants for &quot;Show&quot; modes, which tell us which dropdown buddies to
	// show/hide
	private static final int SHOW_NO_BUDS = 0;
	private static final int SHOW_BUD1_ONLY = 1;
	private static final int SHOW_BUD2_ONLY = 2;
	private static final int SHOW_ALL_BUDS = 3;

	// Dropdown buddy constants
	private static final int BUDDY1_INDEX = 0;
	private static final int BUDDY2_INDEX = 1;
	private static final int BUDDY3_INDEX = 2;
	private static final int BUDDY4_INDEX = 3;
	private static final int BUDDY5_INDEX = 4;

	// Variables needed for populating the form
	private ID m_auctionID;
	private ShiftBidAuction m_auction;
<span class="nc" id="L202">	private boolean m_isWeeklyAuction = false;</span>
	private ID m_bidderID;
<span class="nc" id="L204">	private boolean m_isSupervisor = false; // is the current user a supervisor</span>
											// or an agent?
	private ShiftBidder m_bidder;
	private SchedulingPeriod m_sp;
<span class="nc" id="L208">	private boolean m_isShowBidderSkillsOnly = false;</span>

	private Collection m_shifts; // all shifts for the auction
	// private Collection m_workPatterns; //all Work Patterns for the auction
	private Collection m_templates; // all Templates for the auction
	private Collection m_activities; // all Activitys for the auction
	private Collection m_skills; // all Skills in the entire system

	// The filter data structure contains all the form field values
	private BidOptionsFilter m_filter;

	// Containers and Form Fields
	protected ContainerList m_containerList;
	private Collapsible2ColFormPC m_shiftsContainerPC;
	private Collapsible2ColFormPC m_activitiesContainerPC;
	private Collapsible2ColFormPC m_skillsContainerPC;
	private FormInputPC m_inputPC;
	private TimePickerPC m_shiftStartTime;
	private TimeRangePickerPC m_shiftStartRange;
	private TimePickerPC m_shiftEndTime;
	private TimeRangePickerPC m_shiftEndRange;
	private TimePickerPC m_activity1StartTime;
	private TimeRangePickerPC m_activity1StartRange;
	private TimePickerPC m_activity2StartTime;
	private TimeRangePickerPC m_activity2StartRange;
	private AssignmentBoxPC m_skillsAssignmentBox;

	// Localization
<span class="fc" id="L236">	private static Category log = Log.initCategory(BidOptionsFilterPopupPM.class.getName());</span>
	protected ResourceBundle m_rmBundle;
	protected ResourceBundle m_bbmBundle;

	// Localized Label strings
	protected String m_anyAvailLabel;
	protected String m_anyLengthLabel;
	protected String m_anyTimeLabel;
	protected String m_atLabel;
	protected String m_equalLabel;
	protected String m_minLabel;
	protected String m_maxLabel;
	protected String m_betweenLabel;
	protected String m_notBeforeLabel;
	protected String m_notAfterLabel;
	protected String m_optionsLabel;
	protected String m_dashLabel;
	protected String m_checkBoxLabel;
	protected String m_actualShiftLengthLabel;
	protected String m_actualSchedLengthLabel;
	protected String m_paidTimeOnlyLabel;
	protected String m_hoursLabel;
	protected String m_skillsMatchAnyLabel;
	protected String m_skillsMatchExactlyLabel;
	protected String m_skillsMatchAtLeastLabel;
	protected String m_skillsMatchAtMostLabel;
	protected String m_skillsForShiftLabel;
	protected String m_assignBoxHeaderLabel;
	protected String m_assignBoxLeftLabel;
	protected String m_assignBoxRightLabel;
	protected String m_noneLabel;
	protected String m_lengthExampleLabel;

	// ///////////////////////////////////////////////////////
	// Standard Page Model Methods
	// ///////////////////////////////////////////////////////

	/**
	 * Return an instance of the model that is ready for rendering
	 */
	public static PageModel getInstance(RequestContext context) throws Exception {
<span class="nc" id="L277">		return getInstance(context, BidOptionsFilterPopupPM.class);</span>
	}

	/**
	 * Constructor
	 */
	public BidOptionsFilterPopupPM(RequestContext context) {
<span class="nc" id="L284">		super(context);</span>

		// Create the container list
<span class="nc" id="L287">		m_containerList = new ContainerList(this, 3);</span>

		// Initialize resource bundles
<span class="nc" id="L290">		m_rmBundle = m_localizer.getBundle(RmWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L291">		m_bbmBundle = m_localizer.getBundle(BbmWebBundleKey.BUNDLE_NAME);</span>

		// Initialize label strings
<span class="nc" id="L294">		initLabels();</span>

		// Initialize our filter data structure with default values
<span class="nc" id="L297">		m_filter = new BidOptionsFilter();</span>

		// Initialize our m_isSupervisor member variable (must be done before
		// initFormFields())
<span class="nc" id="L301">		setIsSupervisor();</span>

		// Initialize form fields
<span class="nc" id="L304">		initFormFields(context);</span>
<span class="nc" id="L305">	}</span>

	/**
	 * Read the parameters from the request, and set our fields accordingly.
	 */
	public boolean extractParameters(HttpServletRequest request) {
		// Let the framework do all of the automatic parameter extractions
<span class="nc" id="L312">		boolean success = super.extractParameters(request);</span>

		// Some of out parameters require special handling
		try {
			// If one parameter is extractable, then they all must be.
<span class="nc bnc" id="L317" title="All 2 branches missed.">			if (m_shiftStartTime.hasValueToExtract(request)) {</span>
<span class="nc" id="L318">				extractShiftStartParams();</span>
<span class="nc" id="L319">				extractShiftEndParams();</span>
<span class="nc" id="L320">				extractActivity1StartParams();</span>
<span class="nc" id="L321">				extractActivity2StartParams();</span>
<span class="nc bnc" id="L322" title="All 2 branches missed.">				if (isShowSkillsSection())</span>
<span class="nc" id="L323">					extractSkillsParams();</span>
			} else {
				// Load the filter from the session
<span class="nc" id="L326">				m_filter = (BidOptionsFilter) m_context.getAttribute(RequestContext.SESSION_SCOPE,</span>
						RmKeys.BID_OPTIONS_FILTER);
<span class="nc bnc" id="L328" title="All 2 branches missed.">				if (m_filter == null)</span>
<span class="nc" id="L329">					m_filter = new BidOptionsFilter();</span>
			}
<span class="nc" id="L331">		} catch (Exception e) {</span>
<span class="nc" id="L332">			log.l7dError(RmWebLogBundleKey.EXTRACT_PARAM_FAILED, e);</span>
<span class="nc" id="L333">		}</span>
<span class="nc" id="L334">		return success;</span>
	}

	/**
	 * Initialize Model with Data. This is called AFTER extractParameters(),
	 * which means our m_auctionID will be set already.
	 */
	protected void initializeModel() {
<span class="nc" id="L342">		boolean byEmplType = false;</span>
<span class="nc" id="L343">		OrganizationSetting orgSettings = null;</span>
<span class="nc" id="L344">		boolean hasRMAdvanceLicense = false;</span>
		
<span class="nc bnc" id="L346" title="All 2 branches missed.">		if (m_isInitialized) {</span>
<span class="nc" id="L347">			return;</span>
		} else {
<span class="nc" id="L349">			m_isInitialized = true;</span>
		}

		try {
			// Determine whether current auction is a full period auction or a
			// shift auction
<span class="nc" id="L355">			m_auction = AuctionMH.getAuction(m_auctionID);</span>
<span class="nc" id="L356">			m_isWeeklyAuction = m_auction.getIsFullPeriodSchedule();</span>

<span class="nc" id="L358">			m_bidder = AuctionMH.getShiftBidderByID(m_bidderID);</span>
<span class="nc" id="L359">			m_sp = BidOptionsFilterUtil.getSP(m_context, m_auction);</span>
<span class="nc" id="L360">			m_isShowBidderSkillsOnly = BidOptionsFilterUtil.isShowBidderSkillsOnly(m_context, m_sp,</span>
<span class="nc" id="L361">					m_bidder.getEmployeeID());</span>

			// Get Organization ID's linked to the auction's SP
<span class="nc" id="L364">			Collection orgIDs = BidOptionsFilterUtil.getOrgIDs(m_context, m_auction);</span>

			// Get Activities
<span class="nc" id="L367">			ActivityFilter activityFilter = new ActivityFilter();</span>
<span class="nc" id="L368">			activityFilter.setUsedInShiftEvent(true); // we do want to see shift</span>
														// activities
<span class="nc" id="L370">			activityFilter.setUsedInShift(false); // we don't want to see</span>
													// primary activities
<span class="nc" id="L372">			activityFilter.setActivityId(Activity.ACTIVITY_NONE.toString(), ActivityFilter.OP_NOT_IN_LIST);</span>

<span class="nc" id="L374">			m_activities = ActivityModelHandler.getActivities(m_context, orgIDs, activityFilter, true);</span>
<span class="nc bnc" id="L375" title="All 2 branches missed.">			if (m_activities == null)</span>
<span class="nc" id="L376">				m_activities = Collections.EMPTY_LIST;</span>

<span class="nc" id="L378">			Comparator iDStringPairComparator = new Comparator() {</span>
				public int compare(Object pairA, Object pairB) {
<span class="nc" id="L380">					return ((IDStringPair) pairA).getString().compareToIgnoreCase(((IDStringPair) pairB).getString());</span>
				}
			};

			// Get Users Org ID
<span class="nc" id="L385">			ID orgID = OrganizationModelHandler.getEmployeeOrgID(m_context, m_bidder.getEmployeeID());</span>
			
			// Get Filter by Employee Type Setting
<span class="nc" id="L388">			hasRMAdvanceLicense = LicenseUtil.isAdvancedRMLicense();</span>
<span class="nc bnc" id="L389" title="All 2 branches missed.">			if (hasRMAdvanceLicense) {</span>
<span class="nc" id="L390">				orgSettings = SettingsModelHandler.getSettings(orgID);</span>
<span class="nc" id="L391">				byEmplType = orgSettings.getFilterBidOptionsByEmpType();</span>
			}

			// Determine OrgID for filtering
<span class="nc bnc" id="L395" title="All 2 branches missed.">			if (!m_auction.getBidsOnlyWithinOrg()) {</span>
<span class="nc" id="L396">				orgID = null;</span>
			}

			
			// Get Templates
<span class="nc" id="L401">			m_templates = AuctionMH.getTemplateIDNamePairs(m_context, m_auctionID, orgID, m_bidderID, m_bidder.getEmployeeID(), byEmplType,</span>
<span class="nc" id="L402">					AuctionUtil.getWeekRanges(m_sp, m_auction.getOptMethods().getCampaign().getTimeZone()));</span>
<span class="nc" id="L403">			SortUtil.sort(m_templates, iDStringPairComparator);</span>

			// Get Shifts
<span class="nc" id="L406">			m_shifts = AuctionMH.getShiftIDNamePairs(orgIDs);</span>
<span class="nc" id="L407">			SortUtil.sort(m_shifts, iDStringPairComparator);</span>

			// Get skills
<span class="nc bnc" id="L410" title="All 2 branches missed.">			if (m_sp.getSkillBased()) {</span>
<span class="nc" id="L411">				m_skills = SkillModelHandler.getAvailableSkillsInOrg(m_context, orgIDs); // ID=string,</span>
																							// SID=int
<span class="nc" id="L413">				convertSkillStringIDsToIntIDs(m_skills);</span>
			}
<span class="nc" id="L415">		} catch (RmHardValidationException ex) {</span>
<span class="nc" id="L416">			Message msg = handleUnableToLoadDataErrorAndLogAsDebug(log, ex);</span>
<span class="nc" id="L417">			msg.setAssociatedMessage(ex.getLocalizedMessage(m_localizer, m_context.getViewingTimeZone()));</span>
<span class="nc" id="L418">		} catch (Exception ex) {</span>
<span class="nc" id="L419">			handleUnableToLoadDataError(log, ex);</span>
		} finally {
<span class="nc" id="L421">			initContentTitle();</span>
<span class="nc" id="L422">			initContent();</span>
<span class="nc" id="L423">			initToolbar();</span>
<span class="nc" id="L424">		}</span>
<span class="nc" id="L425">	}</span>

	/**
	 * Given a collection of Skills that use the DE Sting ID's in the skill.ID
	 * field and the SID's in the skill.SID field, copy the SID's into the ID
	 * field.
	 * 
	 * @param skills
	 */
	protected void convertSkillStringIDsToIntIDs(Collection skills) {
<span class="nc bnc" id="L435" title="All 2 branches missed.">		if (skills != null) {</span>
<span class="nc bnc" id="L436" title="All 2 branches missed.">			for (Iterator it = skills.iterator(); it.hasNext();) {</span>
<span class="nc" id="L437">				Skill skill = (Skill) it.next();</span>
<span class="nc" id="L438">				skill.setIDStr(skill.getID().toString());</span>
<span class="nc" id="L439">				skill.setID(skill.getFieldValueID(SkillFieldInfo.SKILL_SID));</span>
<span class="nc" id="L440">			}</span>
		}
<span class="nc" id="L442">	}</span>

	/**
	 * Initialize Component For Display
	 */
	public void initForDisplay() {
<span class="nc bnc" id="L448" title="All 2 branches missed.">		if (m_isInitializedForDisplay)</span>
<span class="nc" id="L449">			return;</span>
		else {
<span class="nc" id="L451">			super.initForDisplay();</span>

<span class="nc" id="L453">			addRequiredJavaScriptFile(JavaScriptFileID.MEDIATOR_WORKPANE);</span>
<span class="nc" id="L454">			addRequiredJavaScriptFile(JavaScriptFileID.MEDIATOR_WORKPANE_GENERIC);</span>
		}
<span class="nc" id="L456">	}</span>

	/**
	 * Prepare content title for rendering
	 */
	private void initContentTitle() {
<span class="nc" id="L462">		String pageTitle = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_EDIT_FILTER);</span>
<span class="nc" id="L463">		m_contentTitlePC.setPageTitle(pageTitle);</span>

<span class="nc" id="L465">		String name = EMPTY;</span>
<span class="nc bnc" id="L466" title="All 2 branches missed.">		if (!m_isSupervisor)</span>
<span class="nc" id="L467">			name = i18n(m_rmBundle, RmWebBundleKey.RM_MYSCHEDULE_BIDS);</span>
		else
<span class="nc" id="L469">			name = i18n(m_rmBundle, RmWebBundleKey.RM_SA_BID_OPTIONS);</span>
<span class="nc" id="L470">		m_contentTitlePC.setItemName(name);</span>
<span class="nc" id="L471">	}</span>

	/**
	 * Initialize Content
	 */
	protected void initContent() {
		// Initialize the collapsible form containers
<span class="nc" id="L478">		initShiftsAndSchedulesContainer();</span>
<span class="nc" id="L479">		initActivitiesContainer();</span>

<span class="nc bnc" id="L481" title="All 2 branches missed.">		if (isShowSkillsSection()) {</span>
<span class="nc" id="L482">			initSkillsContainer();</span>
		}
<span class="nc" id="L484">	}</span>

	/**
	 * Initialize Toolbar
	 */
	protected void initToolbar() {
<span class="nc" id="L490">		ToolbarUtil.addSaveBtn(m_toolbar, true);</span>
<span class="nc" id="L491">		m_toolbar.addConfirmSubmitTextButton(&quot;CLEAR_ACTION&quot;, i18n(m_rmBundle, RmWebBundleKey.TOOLBAR_CLEAR), true);</span>
<span class="nc" id="L492">		ToolbarUtil.addCloseWindowCancelBtn(m_toolbar, true);</span>
<span class="nc" id="L493">	}</span>

	/**
	 * Validates the Page Component TBD: Consider using ComponentValidator
	 * instead. PageComponent.addValidator(ComponentValidator validator)
	 */
	public boolean validate() {
<span class="nc" id="L500">		boolean success = super.validate();</span>
<span class="nc bnc" id="L501" title="All 2 branches missed.">		success = success</span>
<span class="nc bnc" id="L502" title="All 2 branches missed.">				&amp;&amp; validateDDInputInts(m_filter.getInt(&quot;availability&quot;), m_filter.getInt(&quot;availabilityValue1&quot;),</span>
<span class="nc" id="L503">						m_filter.getInt(&quot;availabilityValue2&quot;), RmWebBundleKey.RM_SA_FILTER_AVAILABILITY);</span>
<span class="nc bnc" id="L504" title="All 2 branches missed.">		success = success</span>
<span class="nc bnc" id="L505" title="All 2 branches missed.">				&amp;&amp; validateDDInputFloats(m_filter.getInt(&quot;scheduleLengthType&quot;),</span>
<span class="nc" id="L506">						m_filter.getFloat(&quot;scheduleLengthValue1&quot;), m_filter.getFloat(&quot;scheduleLengthValue2&quot;),</span>
						RmWebBundleKey.RM_SA_FILTER_SCHEDULE_LENGTH);
<span class="nc bnc" id="L508" title="All 2 branches missed.">		success = success</span>
<span class="nc bnc" id="L509" title="All 2 branches missed.">				&amp;&amp; validateDDInputFloats(m_filter.getInt(&quot;shiftLengthType&quot;), m_filter.getFloat(&quot;shiftLengthValue1&quot;),</span>
<span class="nc" id="L510">						m_filter.getFloat(&quot;shiftLengthValue2&quot;), RmWebBundleKey.RM_SA_FILTER_SHIFT_LENGTH);</span>
<span class="nc bnc" id="L511" title="All 2 branches missed.">		success = success</span>
<span class="nc bnc" id="L512" title="All 2 branches missed.">				&amp;&amp; validateDDInputFloats(m_filter.getInt(&quot;activity1LengthType&quot;),</span>
<span class="nc" id="L513">						m_filter.getFloat(&quot;activity1LengthValue1&quot;), m_filter.getFloat(&quot;activity1LengthValue2&quot;),</span>
						RmWebBundleKey.RM_SA_FILTER_ACTIVITY_LENGTH);
<span class="nc bnc" id="L515" title="All 2 branches missed.">		success = success</span>
<span class="nc bnc" id="L516" title="All 2 branches missed.">				&amp;&amp; validateDDInputFloats(m_filter.getInt(&quot;activity2LengthType&quot;),</span>
<span class="nc" id="L517">						m_filter.getFloat(&quot;activity2LengthValue1&quot;), m_filter.getFloat(&quot;activity2LengthValue2&quot;),</span>
						RmWebBundleKey.RM_SA_FILTER_ACTIVITY_LENGTH);
<span class="nc" id="L519">		return success;</span>
	}

	/**
	 * Get custom JavaScript code to be included in the page. This is where we
	 * will define our variables which contain arrays of buddy elements (or
	 * spans containing the buddy elements) to be shown or hidden depending on
	 * the corresponding dropdown selectedIndex. The JavaScript function which
	 * needs these arrays is FormUtil.js showDDBuddyElems(eSelectField,
	 * shownMap, hiddenMap)
	 */
	public String getCustomJavaScript() {
<span class="nc" id="L531">		StringBuffer sb = new StringBuffer(1000);</span>
<span class="nc" id="L532">		sb.append(super.getCustomJavaScript()).append(&quot;\n&quot;);</span>

		// Availability
<span class="nc" id="L535">		sb.append(createBuddyVisibilityMap(DD_TYPE_LENGTH, AVAIL_VISIBLE_MAP, AVAIL_INVISIBLE_MAP, new String[] {</span>
				AVAIL_VAL1, AVAIL_VAL2 }));

		// Schedule Length
<span class="nc bnc" id="L539" title="All 2 branches missed.">		if (m_isWeeklyAuction) {</span>
<span class="nc" id="L540">			sb.append(createBuddyVisibilityMap(DD_TYPE_LENGTH, SCHED_LEN_VISIBLE_MAP, SCHED_LEN_INVISIBLE_MAP,</span>
					new String[] { SCHED_LEN_VAL1, SCHED_LEN_VAL2, SCHED_LEN_USE_LEFT_SPAN, SCHED_LEN_USE_RIGHT_SPAN }));
		}

		// Shift Length
<span class="nc bnc" id="L545" title="All 2 branches missed.">		sb.append(createBuddyVisibilityMap(DD_TYPE_LENGTH, SHIFT_LEN_VISIBLE_MAP, SHIFT_LEN_INVISIBLE_MAP,</span>
				new String[] { SHIFT_LEN_VAL1, SHIFT_LEN_VAL2, m_isWeeklyAuction ? SHIFT_LEN_CHECKBOX_SPAN : &quot;&quot;,
						SHIFT_LEN_USE_LEFT_SPAN, SHIFT_LEN_USE_RIGHT_SPAN }));

		// Shift Start
<span class="nc bnc" id="L550" title="All 2 branches missed.">		sb.append(createBuddyVisibilityMap(DD_TYPE_TIME, SHIFT_START_VISIBLE_MAP, SHIFT_START_INVISIBLE_MAP,</span>
				new String[] { SHIFT_START_TIME_SPAN, SHIFT_START_RANGE_SPAN,
						m_isWeeklyAuction ? SHIFT_START_CHECKBOX_SPAN : &quot;&quot; }));

		// Shift end
<span class="nc bnc" id="L555" title="All 2 branches missed.">		sb.append(createBuddyVisibilityMap(DD_TYPE_TIME, SHIFT_END_VISIBLE_MAP, SHIFT_END_INVISIBLE_MAP, new String[] {</span>
				SHIFT_END_TIME_SPAN, SHIFT_END_RANGE_SPAN, m_isWeeklyAuction ? SHIFT_END_CHECKBOX_SPAN : &quot;&quot; }));

		// Activity 1 Length
<span class="nc bnc" id="L559" title="All 2 branches missed.">		sb.append(createBuddyVisibilityMap(DD_TYPE_LENGTH, ACTIVITY1_LEN_VISIBLE_MAP, ACTIVITY1_LEN_INVISIBLE_MAP,</span>
				new String[] { ACTIVITY1_LEN_VAL1, ACTIVITY1_LEN_VAL2,
						m_isWeeklyAuction ? ACTIVITY1_LEN_CHECKBOX_SPAN : &quot;&quot; }));

		// Activity 1 Start
<span class="nc bnc" id="L564" title="All 2 branches missed.">		sb.append(createBuddyVisibilityMap(DD_TYPE_TIME, ACTIVITY1_START_VISIBLE_MAP, ACTIVITY1_START_INVISIBLE_MAP,</span>
				new String[] { ACTIVITY1_START_TIME_SPAN, ACTIVITY1_START_RANGE_SPAN,
						m_isWeeklyAuction ? ACTIVITY1_START_CHECKBOX_SPAN : &quot;&quot; }));

		// Activity 2 Length
<span class="nc bnc" id="L569" title="All 2 branches missed.">		sb.append(createBuddyVisibilityMap(DD_TYPE_LENGTH, ACTIVITY2_LEN_VISIBLE_MAP, ACTIVITY2_LEN_INVISIBLE_MAP,</span>
				new String[] { ACTIVITY2_LEN_VAL1, ACTIVITY2_LEN_VAL2,
						m_isWeeklyAuction ? ACTIVITY2_LEN_CHECKBOX_SPAN : &quot;&quot; }));

		// Activity 2 Start
<span class="nc bnc" id="L574" title="All 2 branches missed.">		sb.append(createBuddyVisibilityMap(DD_TYPE_TIME, ACTIVITY2_START_VISIBLE_MAP, ACTIVITY2_START_INVISIBLE_MAP,</span>
				new String[] { ACTIVITY2_START_TIME_SPAN, ACTIVITY2_START_RANGE_SPAN,
						m_isWeeklyAuction ? ACTIVITY2_START_CHECKBOX_SPAN : &quot;&quot; }));

<span class="nc" id="L578">		return sb.toString();</span>
	}

	// ///////////////////////////////////////////////////////
	// Helper methods needed during initialization
	// ///////////////////////////////////////////////////////

	/**
	 * Tells us whether or not to show the skills section in the form.
	 * 
	 * @return true if we should show the skills section, false otherwise.
	 */
	private boolean isShowSkillsSection() {
<span class="nc bnc" id="L591" title="All 2 branches missed.">		if (m_sp == null) {</span>
			// Model has not yet been iniialized. Get info from the session.
<span class="nc" id="L593">			String isSkilledSP = (String) m_context.getAttribute(RequestContext.SESSION_SCOPE,</span>
					BidOptionsFilterUtil.IS_SKILLED_SP_KEY);
<span class="nc bnc" id="L595" title="All 4 branches missed.">			if ((isSkilledSP != null) &amp;&amp; isSkilledSP.equals(&quot;true&quot;))</span>
<span class="nc" id="L596">				return true;</span>
<span class="nc bnc" id="L597" title="All 2 branches missed.">		} else if (m_sp.getSkillBased()) {</span>
<span class="nc" id="L598">			return true;</span>
		}
<span class="nc" id="L600">		return false;</span>
	}

	/**
	 * Validates a dropdown field and its integer buddy input fields.
	 * 
	 * @param ddVal
	 *            The id of the selected value in the dropdown list
	 * @param val1
	 *            The first input field (for the min vlaue)
	 * @param val1
	 *            The second input field (for the max vlaue)
	 * @param fieldName
	 *            The resource bundle key to use for localizing name of field
	 */
	private boolean validateDDInputInts(int ddVal, int val1, int val2, String fieldNameKey) {
<span class="nc" id="L616">		boolean success = true;</span>
<span class="nc bnc" id="L617" title="All 3 branches missed.">		switch (ddVal) {</span>
		case BidOptionsFilter.EQUAL:
		case BidOptionsFilter.MIN:
		case BidOptionsFilter.MAX:
<span class="nc bnc" id="L621" title="All 2 branches missed.">			if (val1 == BidOptionsFilter.UNDEFINED_INT) {</span>
<span class="nc" id="L622">				String fieldName = i18n(m_rmBundle, fieldNameKey);</span>
<span class="nc" id="L623">				addPageMessage(Message.ERROR_TYPE, RmWebBundleKey.RM_SA_FILTER_INVALID_FIELD,</span>
						RmWebBundleKey.BUNDLE_NAME, new String[] { fieldName });
<span class="nc" id="L625">				success = false;</span>
<span class="nc" id="L626">			}</span>
			break;
		case BidOptionsFilter.BETWEEN:
<span class="nc bnc" id="L629" title="All 4 branches missed.">			if ((val1 == BidOptionsFilter.UNDEFINED_INT) || (val2 == BidOptionsFilter.UNDEFINED_INT)) {</span>
<span class="nc" id="L630">				String fieldName = i18n(m_rmBundle, fieldNameKey);</span>
<span class="nc" id="L631">				addPageMessage(Message.ERROR_TYPE, RmWebBundleKey.RM_SA_FILTER_INVALID_FIELDS,</span>
						RmWebBundleKey.BUNDLE_NAME, new String[] { fieldName });
<span class="nc" id="L633">				success = false;</span>
<span class="nc bnc" id="L634" title="All 2 branches missed.">			} else if (val2 &lt; val1) {</span>
<span class="nc" id="L635">				String fieldName = i18n(m_rmBundle, fieldNameKey);</span>
<span class="nc" id="L636">				addPageMessage(Message.ERROR_TYPE, RmWebBundleKey.RM_SA_FILTER_INVALID_RANGE,</span>
						RmWebBundleKey.BUNDLE_NAME, new String[] { fieldName });
<span class="nc" id="L638">				success = false;</span>
			}
			break;
		}
<span class="nc" id="L642">		return success;</span>
	}

	/**
	 * Validates a dropdown field and its float buddy input fields.
	 * 
	 * @param ddVal
	 *            The id of the selected value in the dropdown list
	 * @param val1
	 *            The first input field (for the min vlaue)
	 * @param val1
	 *            The second input field (for the max vlaue)
	 * @param fieldName
	 *            The resource bundle key to use for localizing name of field
	 */
	private boolean validateDDInputFloats(int ddVal, float val1, float val2, String fieldNameKey) {
<span class="nc" id="L658">		boolean success = true;</span>
<span class="nc bnc" id="L659" title="All 3 branches missed.">		switch (ddVal) {</span>
		case BidOptionsFilter.EQUAL:
		case BidOptionsFilter.MIN:
		case BidOptionsFilter.MAX:
<span class="nc bnc" id="L663" title="All 2 branches missed.">			if (val1 == BidOptionsFilter.UNDEFINED_FLOAT) {</span>
<span class="nc" id="L664">				String fieldName = i18n(m_rmBundle, fieldNameKey);</span>
<span class="nc" id="L665">				addPageMessage(Message.ERROR_TYPE, RmWebBundleKey.RM_SA_FILTER_INVALID_FIELD,</span>
						RmWebBundleKey.BUNDLE_NAME, new String[] { fieldName });
<span class="nc" id="L667">				success = false;</span>
<span class="nc" id="L668">			}</span>
			break;
		case BidOptionsFilter.BETWEEN:
<span class="nc bnc" id="L671" title="All 4 branches missed.">			if ((val1 == BidOptionsFilter.UNDEFINED_FLOAT) || (val2 == BidOptionsFilter.UNDEFINED_FLOAT)) {</span>
<span class="nc" id="L672">				String fieldName = i18n(m_rmBundle, fieldNameKey);</span>
<span class="nc" id="L673">				addPageMessage(Message.ERROR_TYPE, RmWebBundleKey.RM_SA_FILTER_INVALID_FIELDS,</span>
						RmWebBundleKey.BUNDLE_NAME, new String[] { fieldName });
<span class="nc" id="L675">				success = false;</span>
<span class="nc bnc" id="L676" title="All 2 branches missed.">			} else if (val2 &lt; val1) {</span>
<span class="nc" id="L677">				String fieldName = i18n(m_rmBundle, fieldNameKey);</span>
<span class="nc" id="L678">				addPageMessage(Message.ERROR_TYPE, RmWebBundleKey.RM_SA_FILTER_INVALID_RANGE,</span>
						RmWebBundleKey.BUNDLE_NAME, new String[] { fieldName });
<span class="nc" id="L680">				success = false;</span>
			}
			break;
		}
<span class="nc" id="L684">		return success;</span>
	}

	// ///////////////////////////////////////////////////////
	// Methods for the &quot;Shifts and Schedules&quot; container
	// ///////////////////////////////////////////////////////

	/**
	 * Add the &quot;Shifts and Schedules&quot; container to the page.
	 */
	private void initShiftsAndSchedulesContainer() {
<span class="nc" id="L695">		m_shiftsContainerPC = createFormPC(&quot;shiftsContainer&quot;);</span>
<span class="nc" id="L696">		String title = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_SHIFTS_SCHEDULES);</span>
<span class="nc" id="L697">		m_shiftsContainerPC.setTitle(title);</span>

		// Template (Work Pattern) Row
<span class="nc" id="L700">		createWorkPatternRow();</span>

		// Availability Row
<span class="nc" id="L703">		createAvailabilityRow();</span>

		// Schedule Length Row
<span class="nc bnc" id="L706" title="All 2 branches missed.">		if (m_isWeeklyAuction)</span>
<span class="nc" id="L707">			createScheduleLengthRow();</span>

		// Shift Name Row
<span class="nc" id="L710">		createShiftNameRow();</span>

		// Shift Length Row
<span class="nc" id="L713">		createShiftLengthRow();</span>

		// Shifts Starting Row
<span class="nc" id="L716">		createShiftsStartingRow();</span>

		// Shifts Ending Row
<span class="nc" id="L719">		createShiftsEndingRow();</span>
<span class="nc" id="L720">	}</span>

	private void createWorkPatternRow() {
		// Create the &quot;Work Pattern&quot; drop down
<span class="nc" id="L724">		String title = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_WORK_PATTERN);</span>
<span class="nc" id="L725">		String anyLabel = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_ANY_TEMPLATE);</span>
<span class="nc" id="L726">		String dropDown = BidOptionsFilterUtil.makeSelectInput(&quot;workPatternId&quot;, m_filter.getIDString(&quot;workPatternId&quot;),</span>
<span class="nc" id="L727">				JSUtil.ON_CHANGE, getStringsPairDDOptions(m_templates, anyLabel), DDWIDTH, title);</span>

		// Put it all together
<span class="nc" id="L730">		String rightRow = BidOptionsFilterUtil.wrapInTable1Row2Col(STYLE1, new String[] { dropDown, &quot;&quot; });</span>
<span class="nc" id="L731">		m_shiftsContainerPC.addRow(title, rightRow);</span>
<span class="nc" id="L732">	}</span>

	private void createAvailabilityRow() {
		// Create the &quot;Availability&quot; drop down
<span class="nc" id="L736">		String title = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_AVAILABILITY);</span>
<span class="nc" id="L737">		String onChangeJS = JSUtil.ON_CHANGE + &quot;showDDBuddyElems(this, AVAIL_VISIBLE_MAP, AVAIL_INVISIBLE_MAP)&quot;;</span>
<span class="nc" id="L738">		String dropDown = BidOptionsFilterUtil.makeSelectInput(&quot;availability&quot;, EMPTY + m_filter.getInt(&quot;availability&quot;),</span>
<span class="nc" id="L739">				onChangeJS, getMinMaxDDOptions(m_anyAvailLabel, m_equalLabel, m_minLabel, m_maxLabel, m_betweenLabel),</span>
				DDWIDTH, title);

		// Create the first buddy field
<span class="nc" id="L743">		resetInputPC(AVAIL_VAL1, FormInputPC.TYPE_INTEGER);</span>
<span class="nc" id="L744">		m_inputPC.setInputFieldDesc(RmWebBundleKey.RM_SA_FILTER_AVAILABILITY, RmWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L745">		m_inputPC.setInputValue(getInputValue(m_filter.getInt(&quot;availabilityValue1&quot;)));</span>
<span class="nc" id="L746">		String bud1Style = getBuddyStyle(DD_TYPE_LENGTH, m_filter.getInt(&quot;availability&quot;), BUDDY1_INDEX);</span>
<span class="nc" id="L747">		m_inputPC.setStyle(bud1Style);</span>
<span class="nc" id="L748">		m_inputPC.setTitle(i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_NUMBER_OF_OPTIONS));</span>
<span class="nc" id="L749">		m_inputPC.initForDisplay();</span>
<span class="nc" id="L750">		String input1 = m_inputPC.getHtmlDisplay();</span>

		// Create the second buddy field
<span class="nc" id="L753">		resetInputPC(AVAIL_VAL2, FormInputPC.TYPE_INTEGER);</span>
<span class="nc" id="L754">		m_inputPC.setInputFieldDesc(RmWebBundleKey.RM_SA_FILTER_AVAILABILITY, RmWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L755">		m_inputPC.setInputValue(getInputValue(m_filter.getInt(&quot;availabilityValue2&quot;)));</span>
<span class="nc" id="L756">		String bud2Style = getBuddyStyle(DD_TYPE_LENGTH, m_filter.getInt(&quot;availability&quot;), BUDDY2_INDEX);</span>
<span class="nc" id="L757">		m_inputPC.setStyle(bud2Style);</span>
<span class="nc" id="L758">		m_inputPC.setTitle(i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_MAX_NUMBER_OF_OPTIONS));</span>
<span class="nc" id="L759">		m_inputPC.initForDisplay();</span>
<span class="nc" id="L760">		String input2 = m_inputPC.getHtmlDisplay();</span>

		// Aggregate the elements into the inputs row
<span class="nc" id="L763">		String inputsRow = input1 + NBSP</span>
<span class="nc" id="L764">				+ BidOptionsFilterUtil.wrapInSpan(m_dashLabel, AVAIL_VAL2 + &quot;_label&quot;, bud2Style) + NBSP + input2 + NBSP</span>
<span class="nc" id="L765">				+ BidOptionsFilterUtil.wrapInSpan(m_optionsLabel, AVAIL_VAL1 + &quot;_label&quot;, bud1Style);</span>

		// Put it all together
<span class="nc" id="L768">		String rightRow = BidOptionsFilterUtil.wrapInTable1Row2Col(STYLE1, new String[] { dropDown, inputsRow });</span>
<span class="nc" id="L769">		m_shiftsContainerPC.addRow(title, rightRow);</span>
<span class="nc" id="L770">	}</span>

	private void createScheduleLengthRow() {
		// Create the &quot;Schedule Length&quot; drop down
<span class="nc" id="L774">		String title = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_SCHEDULE_LENGTH);</span>
<span class="nc" id="L775">		String onChangeJS = JSUtil.ON_CHANGE + &quot;showDDBuddyElems(this, SCHED_LEN_VISIBLE_MAP, SCHED_LEN_INVISIBLE_MAP)&quot;;</span>
<span class="nc" id="L776">		String dropDown = BidOptionsFilterUtil.makeSelectInput(&quot;scheduleLengthType&quot;,</span>
<span class="nc" id="L777">				EMPTY + m_filter.getInt(&quot;scheduleLengthType&quot;), onChangeJS,</span>
<span class="nc" id="L778">				getMinMaxDDOptions(m_anyLengthLabel, m_equalLabel, m_minLabel, m_maxLabel, m_betweenLabel), DDWIDTH,</span>
				title);

		// Create the first buddy field
<span class="nc" id="L782">		resetInputPC(SCHED_LEN_VAL1, FormInputPC.TYPE_NUMERIC);</span>
<span class="nc" id="L783">		m_inputPC.setInputFieldDesc(RmWebBundleKey.RM_SA_FILTER_SCHEDULE_LENGTH, RmWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L784">		m_inputPC.setInputValue(getInputValue(m_filter.getFloat(&quot;scheduleLengthValue1&quot;)));</span>
<span class="nc" id="L785">		String bud1Style = getBuddyStyle(DD_TYPE_LENGTH, m_filter.getInt(&quot;scheduleLengthType&quot;), BUDDY1_INDEX);</span>
<span class="nc" id="L786">		m_inputPC.setStyle(bud1Style);</span>
<span class="nc" id="L787">		m_inputPC.setTitle(i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_NUMBER_OF_HOURS));</span>
<span class="nc" id="L788">		m_inputPC.initForDisplay();</span>
<span class="nc" id="L789">		String input1 = m_inputPC.getHtmlDisplay();</span>

		// Create the second buddy field
<span class="nc" id="L792">		resetInputPC(SCHED_LEN_VAL2, FormInputPC.TYPE_NUMERIC);</span>
<span class="nc" id="L793">		m_inputPC.setInputFieldDesc(RmWebBundleKey.RM_SA_FILTER_SCHEDULE_LENGTH, RmWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L794">		m_inputPC.setInputValue(getInputValue(m_filter.getFloat(&quot;scheduleLengthValue2&quot;)));</span>
<span class="nc" id="L795">		String bud2Style = getBuddyStyle(DD_TYPE_LENGTH, m_filter.getInt(&quot;scheduleLengthType&quot;), BUDDY2_INDEX);</span>
<span class="nc" id="L796">		m_inputPC.setStyle(bud2Style);</span>
<span class="nc" id="L797">		m_inputPC.setTitle(i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_MAX_NUMBER_OF_HOURS));</span>
<span class="nc" id="L798">		m_inputPC.initForDisplay();</span>
<span class="nc" id="L799">		String input2 = m_inputPC.getHtmlDisplay();</span>

		// Aggregate the elements into the inputs column
<span class="nc" id="L802">		String inputsCol = input1 + NBSP</span>
<span class="nc" id="L803">				+ BidOptionsFilterUtil.wrapInSpan(m_dashLabel, SCHED_LEN_VAL2 + &quot;_label&quot;, bud2Style) + NBSP + input2</span>
<span class="nc" id="L804">				+ NBSP + BidOptionsFilterUtil.wrapInSpan(m_hoursLabel, SCHED_LEN_VAL1 + &quot;_label&quot;, bud1Style);</span>

		// Create the &quot;Actual Length/Paid Time Only&quot; Radio Button Row
<span class="nc" id="L807">		String defaultVal = EMPTY + m_filter.getInt(&quot;scheduleLengthUse&quot;);</span>

<span class="nc" id="L809">		String bud3Style = getBuddyStyle(DD_TYPE_LENGTH, m_filter.getInt(&quot;scheduleLengthType&quot;), BUDDY3_INDEX);</span>
<span class="nc" id="L810">		String leftStereo = BidOptionsFilterUtil.createRadio(&quot;scheduleLengthUse&quot;, LENGTH_USE_ACTUAL_FV,</span>
				m_actualSchedLengthLabel, defaultVal);
<span class="nc" id="L812">		String buddy3 = BidOptionsFilterUtil.wrapInSpan(leftStereo, SCHED_LEN_USE_LEFT_SPAN, bud3Style);</span>

<span class="nc" id="L814">		String bud4Style = getBuddyStyle(DD_TYPE_LENGTH, m_filter.getInt(&quot;scheduleLengthType&quot;), BUDDY4_INDEX);</span>
<span class="nc" id="L815">		String rightStereo = BidOptionsFilterUtil.createRadio(&quot;scheduleLengthUse&quot;, LENGTH_USE_PAID_TIME_FV,</span>
				m_paidTimeOnlyLabel, defaultVal);
<span class="nc" id="L817">		String buddy4 = BidOptionsFilterUtil.wrapInSpan(rightStereo, SCHED_LEN_USE_RIGHT_SPAN, bud4Style);</span>

		// Put it all together
<span class="nc" id="L820">		String rightRow = BidOptionsFilterUtil.wrapInTable2Row2Col(STYLE4, new String[] { dropDown, inputsCol, buddy3,</span>
				buddy4 });
<span class="nc" id="L822">		m_shiftsContainerPC.addRow(title, rightRow);</span>
<span class="nc" id="L823">	}</span>

	private void createShiftNameRow() {
		// Create the &quot;Shift Name&quot; drop down
<span class="nc" id="L827">		String title = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_SHIFT_NAME);</span>
<span class="nc" id="L828">		String buddyList = BidOptionsFilterUtil.toJSArray(new String[] { SHIFT_CHECKBOX_SPAN });</span>
<span class="nc" id="L829">		String onChangeJS = JSUtil.ON_CHANGE;</span>
<span class="nc bnc" id="L830" title="All 2 branches missed.">		if (m_isWeeklyAuction)</span>
<span class="nc" id="L831">			onChangeJS += &quot;showSimpleDDBuddyElems(this, &quot; + buddyList + &quot;)&quot;;</span>
<span class="nc" id="L832">		String anyLabel = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_ANY_SHIFT);</span>
<span class="nc" id="L833">		String dropDown = BidOptionsFilterUtil.makeSelectInput(&quot;shiftId&quot;, m_filter.getIDString(&quot;shiftId&quot;), onChangeJS,</span>
<span class="nc" id="L834">				getStringsPairDDOptions(m_shifts, anyLabel), DDWIDTH, title);</span>

		// Add the &quot;Match All shifts in schedule&quot; checkbox
<span class="nc" id="L837">		String buddy = &quot;&quot;;</span>
<span class="nc bnc" id="L838" title="All 2 branches missed.">		if (m_isWeeklyAuction) {</span>
<span class="nc" id="L839">			String checkBox = HtmlBooleanCheckbox.makeInput(&quot;shiftIdMatchAll&quot;, m_checkBoxLabel, JSUtil.ON_CHANGE,</span>
<span class="nc" id="L840">					m_filter.getBool(&quot;shiftIdMatchAll&quot;), false);</span>
<span class="nc" id="L841">			String budStyle = getBuddyStyle(DD_TYPE_ID, idToInteger(m_filter.getID(&quot;shiftId&quot;)), BUDDY1_INDEX);</span>
<span class="nc" id="L842">			buddy = BidOptionsFilterUtil.wrapInSpan(checkBox, SHIFT_CHECKBOX_SPAN, budStyle);</span>
		}

		// Put it all together
<span class="nc" id="L846">		String rightRow = BidOptionsFilterUtil.wrapInTable1Row2Col(STYLE1, new String[] { dropDown, buddy });</span>

<span class="nc" id="L848">		m_shiftsContainerPC.addRow(title, rightRow);</span>

<span class="nc" id="L850">	}</span>

	private void createShiftLengthRow() {
		// Create the &quot;Shift Length&quot; drop down
<span class="nc" id="L854">		String title = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_SHIFT_LENGTH);</span>
<span class="nc" id="L855">		String onChangeJS = JSUtil.ON_CHANGE + &quot;showDDBuddyElems(this, SHIFT_LEN_VISIBLE_MAP, SHIFT_LEN_INVISIBLE_MAP)&quot;;</span>
<span class="nc" id="L856">		String dropDown = BidOptionsFilterUtil.makeSelectInput(&quot;shiftLengthType&quot;,</span>
<span class="nc" id="L857">				EMPTY + m_filter.getInt(&quot;shiftLengthType&quot;), onChangeJS,</span>
<span class="nc" id="L858">				getMinMaxDDOptions(m_anyLengthLabel, m_equalLabel, m_minLabel, m_maxLabel, m_betweenLabel), DDWIDTH,</span>
				title);

		// Create the first buddy field
<span class="nc" id="L862">		resetInputPC(SHIFT_LEN_VAL1, FormInputPC.TYPE_NUMERIC);</span>
<span class="nc" id="L863">		m_inputPC.setInputFieldDesc(RmWebBundleKey.RM_SA_FILTER_SHIFT_LENGTH, RmWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L864">		m_inputPC.setInputValue(getInputValue(m_filter.getFloat(&quot;shiftLengthValue1&quot;)));</span>
<span class="nc" id="L865">		String bud1Style = getBuddyStyle(DD_TYPE_LENGTH, m_filter.getInt(&quot;shiftLengthType&quot;), BUDDY1_INDEX);</span>
<span class="nc" id="L866">		m_inputPC.setStyle(bud1Style);</span>
<span class="nc" id="L867">		m_inputPC.setTitle(i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_NUMBER_OF_HOURS));</span>
<span class="nc" id="L868">		m_inputPC.initForDisplay();</span>
<span class="nc" id="L869">		String input1 = m_inputPC.getHtmlDisplay();</span>

		// Create the second buddy field
<span class="nc" id="L872">		resetInputPC(SHIFT_LEN_VAL2, FormInputPC.TYPE_NUMERIC);</span>
<span class="nc" id="L873">		m_inputPC.setInputFieldDesc(RmWebBundleKey.RM_SA_FILTER_SHIFT_LENGTH, RmWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L874">		m_inputPC.setInputValue(getInputValue(m_filter.getFloat(&quot;shiftLengthValue2&quot;)));</span>
<span class="nc" id="L875">		String bud2Style = getBuddyStyle(DD_TYPE_LENGTH, m_filter.getInt(&quot;shiftLengthType&quot;), BUDDY2_INDEX);</span>
<span class="nc" id="L876">		m_inputPC.setStyle(bud2Style);</span>
<span class="nc" id="L877">		m_inputPC.setTitle(i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_MAX_NUMBER_OF_HOURS));</span>
<span class="nc" id="L878">		m_inputPC.initForDisplay();</span>
<span class="nc" id="L879">		String input2 = m_inputPC.getHtmlDisplay();</span>

		// Aggregate the elements into the inputs column
<span class="nc" id="L882">		String inputsCol = input1 + NBSP</span>
<span class="nc" id="L883">				+ BidOptionsFilterUtil.wrapInSpan(m_dashLabel, SHIFT_LEN_VAL2 + &quot;_label&quot;, bud2Style) + NBSP + input2</span>
<span class="nc" id="L884">				+ NBSP + BidOptionsFilterUtil.wrapInSpan(m_hoursLabel, SHIFT_LEN_VAL1 + &quot;_label&quot;, bud1Style);</span>

		// Add the &quot;Match All shifts in schedule&quot; checkbox
<span class="nc" id="L887">		String buddy3 = &quot;&quot;;</span>
<span class="nc bnc" id="L888" title="All 2 branches missed.">		if (m_isWeeklyAuction) {</span>
<span class="nc" id="L889">			String bud3Style = getBuddyStyle(DD_TYPE_LENGTH, m_filter.getInt(&quot;shiftLengthType&quot;), BUDDY3_INDEX);</span>
<span class="nc" id="L890">			String checkBox = HtmlBooleanCheckbox.makeInput(&quot;shiftLengthMatchAll&quot;, m_checkBoxLabel, JSUtil.ON_CHANGE,</span>
<span class="nc" id="L891">					m_filter.getBool(&quot;shiftLengthMatchAll&quot;), false);</span>
<span class="nc" id="L892">			buddy3 = BidOptionsFilterUtil.wrapInSpan(checkBox, SHIFT_LEN_CHECKBOX_SPAN, bud3Style);</span>
		}

		// Create the &quot;Actual Length/Paid Time Only&quot; Radio Button Row
<span class="nc" id="L896">		String defaultVal = EMPTY + m_filter.getInt(&quot;shiftLengthUse&quot;);</span>

<span class="nc" id="L898">		String bud4Style = getBuddyStyle(DD_TYPE_LENGTH, m_filter.getInt(&quot;shiftLengthType&quot;), BUDDY4_INDEX);</span>
<span class="nc" id="L899">		String leftStereo = BidOptionsFilterUtil.createRadio(&quot;shiftLengthUse&quot;, LENGTH_USE_ACTUAL_FV,</span>
				m_actualShiftLengthLabel, defaultVal);
<span class="nc" id="L901">		String buddy4 = BidOptionsFilterUtil.wrapInSpan(leftStereo, SHIFT_LEN_USE_LEFT_SPAN, bud4Style);</span>

<span class="nc" id="L903">		String bud5Style = getBuddyStyle(DD_TYPE_LENGTH, m_filter.getInt(&quot;shiftLengthType&quot;), BUDDY5_INDEX);</span>
<span class="nc" id="L904">		String rightStereo = BidOptionsFilterUtil.createRadio(&quot;shiftLengthUse&quot;, LENGTH_USE_PAID_TIME_FV,</span>
				m_paidTimeOnlyLabel, defaultVal);
<span class="nc" id="L906">		String buddy5 = BidOptionsFilterUtil.wrapInSpan(rightStereo, SHIFT_LEN_USE_RIGHT_SPAN, bud5Style);</span>

		// Put it all together
<span class="nc" id="L909">		String rightRow = BidOptionsFilterUtil.wrapInTable3Row2Col(STYLE4, new String[] { dropDown, inputsCol, buddy4,</span>
				buddy5, buddy3 });

<span class="nc" id="L912">		m_shiftsContainerPC.addRow(title, rightRow);</span>
<span class="nc" id="L913">	}</span>

	private void createShiftsStartingRow() {
		// Create the &quot;Shift Starting&quot; drop down
<span class="nc" id="L917">		String title = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_SHIFT_START);</span>
<span class="nc" id="L918">		String onChangeJS = JSUtil.ON_CHANGE</span>
				+ &quot;showDDBuddyElems(this, SHIFT_START_VISIBLE_MAP, SHIFT_START_INVISIBLE_MAP)&quot;;
<span class="nc" id="L920">		String dropDown = BidOptionsFilterUtil.makeSelectInput(&quot;shiftStartType&quot;,</span>
<span class="nc" id="L921">				EMPTY + m_filter.getInt(&quot;shiftStartType&quot;), onChangeJS,</span>
<span class="nc" id="L922">				getMinMaxDDOptions(m_anyTimeLabel, m_atLabel, m_notBeforeLabel, m_notAfterLabel, m_betweenLabel),</span>
				DDWIDTH, title);

		// Add the TimePickerPC buddy
<span class="nc" id="L926">		String bud1Style = getBuddyStyle(DD_TYPE_TIME, m_filter.getInt(&quot;shiftStartType&quot;), BUDDY1_INDEX);</span>
<span class="nc" id="L927">		m_shiftStartTime.setTime(getTime(m_filter.getInt(&quot;shiftStart1&quot;)) * 60); // seconds</span>
<span class="nc" id="L928">		String buddy1 = BidOptionsFilterUtil.wrapInSpan(m_shiftStartTime.getHtmlDisplay(), SHIFT_START_TIME_SPAN,</span>
				bud1Style);

		// Add the TimeRangePickerPC buddy
<span class="nc" id="L932">		String bud2Style = getBuddyStyle(DD_TYPE_TIME, m_filter.getInt(&quot;shiftStartType&quot;), BUDDY2_INDEX);</span>
<span class="nc" id="L933">		m_shiftStartRange.getStartTimePickerPC().setTime(getTime(m_filter.getInt(&quot;shiftStart1&quot;)) * 60); // seconds</span>
<span class="nc" id="L934">		m_shiftStartRange.getEndTimePickerPC().setTime(getTime(m_filter.getInt(&quot;shiftStart2&quot;)) * 60); // seconds</span>
<span class="nc" id="L935">		String buddy2 = BidOptionsFilterUtil.wrapInSpan(m_shiftStartRange.getHtmlDisplay(), SHIFT_START_RANGE_SPAN,</span>
				bud2Style);

		// Add the &quot;Match All shifts in schedule&quot; checkbox
<span class="nc" id="L939">		String buddy3 = &quot;&quot;;</span>
<span class="nc bnc" id="L940" title="All 2 branches missed.">		if (m_isWeeklyAuction) {</span>
<span class="nc" id="L941">			String bud3Style = getBuddyStyle(DD_TYPE_TIME, m_filter.getInt(&quot;shiftStartType&quot;), BUDDY3_INDEX);</span>
<span class="nc" id="L942">			String checkBox = HtmlBooleanCheckbox.makeInput(&quot;shiftStartMatchAll&quot;, m_checkBoxLabel, JSUtil.ON_CHANGE,</span>
<span class="nc" id="L943">					m_filter.getBool(&quot;shiftStartMatchAll&quot;), false);</span>
<span class="nc" id="L944">			buddy3 = BidOptionsFilterUtil.wrapInSpan(checkBox, SHIFT_START_CHECKBOX_SPAN, bud3Style);</span>
		}

		// Put it all together
<span class="nc" id="L948">		String rightRow = BidOptionsFilterUtil.wrapInTable1Row3Col(STYLE1, new String[] { dropDown, buddy1 + buddy2,</span>
				buddy3 });
<span class="nc" id="L950">		m_shiftsContainerPC.addRow(title, rightRow);</span>

<span class="nc" id="L952">	}</span>

	private void createShiftsEndingRow() {
		// Create the &quot;Shift Starting&quot; drop down
<span class="nc" id="L956">		String title = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_SHIFT_END);</span>
<span class="nc" id="L957">		String onChangeJS = JSUtil.ON_CHANGE + &quot;showDDBuddyElems(this, SHIFT_END_VISIBLE_MAP, SHIFT_END_INVISIBLE_MAP)&quot;;</span>
<span class="nc" id="L958">		String dropDown = BidOptionsFilterUtil.makeSelectInput(&quot;shiftEndType&quot;, EMPTY + m_filter.getInt(&quot;shiftEndType&quot;),</span>
				onChangeJS,
<span class="nc" id="L960">				getMinMaxDDOptions(m_anyTimeLabel, m_atLabel, m_notBeforeLabel, m_notAfterLabel, m_betweenLabel),</span>
				DDWIDTH, title);

		// Add the TimePickerPC buddy
<span class="nc" id="L964">		String bud1Style = getBuddyStyle(DD_TYPE_TIME, m_filter.getInt(&quot;shiftEndType&quot;), BUDDY1_INDEX);</span>
<span class="nc" id="L965">		m_shiftEndTime.setTime(getTime(m_filter.getInt(&quot;shiftEnd1&quot;)) * 60); // seconds</span>
<span class="nc" id="L966">		String buddy1 = BidOptionsFilterUtil</span>
<span class="nc" id="L967">				.wrapInSpan(m_shiftEndTime.getHtmlDisplay(), SHIFT_END_TIME_SPAN, bud1Style);</span>

		// Add the TimeRangePickerPC buddy
<span class="nc" id="L970">		String bud2Style = getBuddyStyle(DD_TYPE_TIME, m_filter.getInt(&quot;shiftEndType&quot;), BUDDY2_INDEX);</span>
<span class="nc" id="L971">		m_shiftEndRange.getStartTimePickerPC().setTime(getTime(m_filter.getInt(&quot;shiftEnd1&quot;)) * 60); // seconds</span>
<span class="nc" id="L972">		m_shiftEndRange.getEndTimePickerPC().setTime(getTime(m_filter.getInt(&quot;shiftEnd2&quot;)) * 60); // seconds</span>
<span class="nc" id="L973">		String buddy2 = BidOptionsFilterUtil.wrapInSpan(m_shiftEndRange.getHtmlDisplay(), SHIFT_END_RANGE_SPAN,</span>
				bud2Style);

		// Add the &quot;Match All shifts in schedule&quot; checkbox
<span class="nc" id="L977">		String buddy3 = &quot;&quot;;</span>
<span class="nc bnc" id="L978" title="All 2 branches missed.">		if (m_isWeeklyAuction) {</span>
<span class="nc" id="L979">			String bud3Style = getBuddyStyle(DD_TYPE_TIME, m_filter.getInt(&quot;shiftEndType&quot;), BUDDY3_INDEX);</span>
<span class="nc" id="L980">			String checkBox = HtmlBooleanCheckbox.makeInput(&quot;shiftEndMatchAll&quot;, m_checkBoxLabel, JSUtil.ON_CHANGE,</span>
<span class="nc" id="L981">					m_filter.getBool(&quot;shiftEndMatchAll&quot;), false);</span>
<span class="nc" id="L982">			buddy3 = BidOptionsFilterUtil.wrapInSpan(checkBox, SHIFT_END_CHECKBOX_SPAN, bud3Style);</span>
		}

		// Put it all together
<span class="nc" id="L986">		String rightRow = BidOptionsFilterUtil.wrapInTable1Row3Col(STYLE1, new String[] { dropDown, buddy1 + buddy2,</span>
				buddy3 });
<span class="nc" id="L988">		m_shiftsContainerPC.addRow(title, rightRow);</span>
<span class="nc" id="L989">	}</span>

	// ///////////////////////////////////////////////////////
	// Methods for the &quot;Activities&quot; container
	// ///////////////////////////////////////////////////////

	/**
	 * Add the &quot;Activities&quot; container to the page.
	 */
	private void initActivitiesContainer() {
<span class="nc" id="L999">		m_activitiesContainerPC = createFormPC(&quot;activitiesContainer&quot;);</span>
<span class="nc" id="L1000">		String title = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_ACTIVITIES);</span>
<span class="nc" id="L1001">		m_activitiesContainerPC.setTitle(title);</span>

		// First Activity Row
<span class="nc" id="L1004">		String activity1NameRow = createActivity1NameRow();</span>
<span class="nc" id="L1005">		String activity1LengthRow = createActivity1LengthRow();</span>
<span class="nc" id="L1006">		String activity1StartRow = createActivity1StartRow();</span>
<span class="nc" id="L1007">		String activity1Group = BidOptionsFilterUtil.wrapInTable4Row1Col(STYLE2, new String[] { activity1NameRow,</span>
				activity1LengthRow, activity1StartRow, NBSP });

<span class="nc" id="L1010">		String rowHeader1 = getActivityRowHeader(); // m_filter.getInt(&quot;activity1LengthType&quot;),</span>
													// ACTIVITY1_LENGTH_EXAMPLE);
<span class="nc" id="L1012">		m_activitiesContainerPC.addRow(rowHeader1, activity1Group);</span>

		// Second Activity Row
<span class="nc" id="L1015">		String activity2NameRow = createActivity2NameRow();</span>
<span class="nc" id="L1016">		String activity2LengthRow = createActivity2LengthRow();</span>
<span class="nc" id="L1017">		String activity2StartRow = createActivity2StartRow();</span>
<span class="nc" id="L1018">		String activity2Group = BidOptionsFilterUtil.wrapInTable3Row1Col(STYLE2, new String[] { activity2NameRow,</span>
				activity2LengthRow, activity2StartRow });

<span class="nc" id="L1021">		String rowHeader2 = getActivityRowHeader(); // m_filter.getInt(&quot;activity2LengthType&quot;),</span>
													// ACTIVITY2_LENGTH_EXAMPLE);
<span class="nc" id="L1023">		m_activitiesContainerPC.addRow(rowHeader2, activity2Group);</span>
<span class="nc" id="L1024">	}</span>

	private String createActivity1NameRow() {
		// Create the &quot;Activity Name&quot; drop down
<span class="nc" id="L1028">		String title = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_FIRST_ACTIVITY_NAME);</span>
<span class="nc" id="L1029">		String buddyList = BidOptionsFilterUtil.toJSArray(new String[] { &quot;ACTIVITY1_ID_CHECKBOX_SPAN&quot; });</span>
<span class="nc" id="L1030">		String onChangeJS = JSUtil.ON_CHANGE;</span>
<span class="nc bnc" id="L1031" title="All 2 branches missed.">		if (m_isWeeklyAuction)</span>
<span class="nc" id="L1032">			onChangeJS += &quot;showSimpleDDBuddyElems(this, &quot; + buddyList + &quot;)&quot;;</span>
<span class="nc" id="L1033">		String dropDown = BidOptionsFilterUtil.makeSelectInput(&quot;activity1Id&quot;, m_filter.getIDString(&quot;activity1Id&quot;),</span>
<span class="nc" id="L1034">				onChangeJS, getActivityDDOptions(), DDWIDTH, title);</span>

		// Add the &quot;Match All shifts in schedule&quot; checkbox
<span class="nc" id="L1037">		String buddy = &quot;&quot;;</span>
<span class="nc bnc" id="L1038" title="All 2 branches missed.">		if (m_isWeeklyAuction) {</span>
<span class="nc" id="L1039">			String synchJS = getCheckboxSynchJS(&quot;activity1LengthMatchAll&quot;, &quot;activity1StartMatchAll&quot;);</span>
<span class="nc" id="L1040">			String checkBox = HtmlBooleanCheckbox.makeInput(&quot;activity1IdMatchAll&quot;, m_checkBoxLabel, synchJS,</span>
<span class="nc" id="L1041">					m_filter.getBool(&quot;activity1IdMatchAll&quot;), false);</span>
<span class="nc" id="L1042">			String budStyle = getBuddyStyle(DD_TYPE_ID, idToInteger(m_filter.getID(&quot;activity1Id&quot;)), BUDDY1_INDEX);</span>
<span class="nc" id="L1043">			buddy = BidOptionsFilterUtil.wrapInSpan(checkBox, &quot;ACTIVITY1_ID_CHECKBOX_SPAN&quot;, budStyle);</span>
		}

		// Put it all together
<span class="nc" id="L1047">		return BidOptionsFilterUtil.wrapInTable1Row2Col(STYLE1, new String[] { dropDown, buddy });</span>
	}

	private String createActivity1LengthRow() {
		// Create the &quot;Activity1 Length&quot; drop down
<span class="nc" id="L1052">		String lengthLabel = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_ACTIVITY_LENGTH);</span>
<span class="nc" id="L1053">		String onChangeJS = JSUtil.ON_CHANGE</span>
				+ &quot;showDDBuddyElems(this, ACTIVITY1_LEN_VISIBLE_MAP, ACTIVITY1_LEN_INVISIBLE_MAP)&quot;;
<span class="nc" id="L1055">		String dropDown = BidOptionsFilterUtil.makeSelectInput(&quot;activity1LengthType&quot;,</span>
<span class="nc" id="L1056">				EMPTY + m_filter.getInt(&quot;activity1LengthType&quot;), onChangeJS,</span>
<span class="nc" id="L1057">				getMinMaxDDOptions(m_anyLengthLabel, m_equalLabel, m_minLabel, m_maxLabel, m_betweenLabel), DDWIDTH,</span>
				lengthLabel);

		// Create the first buddy field
<span class="nc" id="L1061">		resetInputPC(ACTIVITY1_LEN_VAL1, FormInputPC.TYPE_NUMERIC);</span>
<span class="nc" id="L1062">		m_inputPC.setInputFieldDesc(RmWebBundleKey.RM_SA_FILTER_ACTIVITY_LENGTH, RmWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L1063">		m_inputPC.setInputValue(getInputValue(m_filter.getFloat(&quot;activity1LengthValue1&quot;)));</span>
<span class="nc" id="L1064">		String bud1Style = getBuddyStyle(DD_TYPE_LENGTH, m_filter.getInt(&quot;activity1LengthType&quot;), BUDDY1_INDEX);</span>
<span class="nc" id="L1065">		m_inputPC.setStyle(bud1Style);</span>
<span class="nc" id="L1066">		m_inputPC.setTitle(i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_NUMBER_OF_HOURS));</span>
<span class="nc" id="L1067">		m_inputPC.initForDisplay();</span>
<span class="nc" id="L1068">		String input1 = m_inputPC.getHtmlDisplay();</span>

		// Create the second buddy field
<span class="nc" id="L1071">		resetInputPC(ACTIVITY1_LEN_VAL2, FormInputPC.TYPE_NUMERIC);</span>
<span class="nc" id="L1072">		m_inputPC.setInputFieldDesc(RmWebBundleKey.RM_SA_FILTER_ACTIVITY_LENGTH, RmWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L1073">		m_inputPC.setInputValue(getInputValue(m_filter.getFloat(&quot;activity1LengthValue2&quot;)));</span>
<span class="nc" id="L1074">		String bud2Style = getBuddyStyle(DD_TYPE_LENGTH, m_filter.getInt(&quot;activity1LengthType&quot;), BUDDY2_INDEX);</span>
<span class="nc" id="L1075">		m_inputPC.setStyle(bud2Style);</span>
<span class="nc" id="L1076">		m_inputPC.setTitle(i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_MAX_NUMBER_OF_HOURS));</span>
<span class="nc" id="L1077">		m_inputPC.initForDisplay();</span>
<span class="nc" id="L1078">		String input2 = m_inputPC.getHtmlDisplay();</span>

		// Aggregate the elements into the inputs column
<span class="nc" id="L1081">		String inputsCol = input1 + NBSP</span>
<span class="nc" id="L1082">				+ BidOptionsFilterUtil.wrapInSpan(m_dashLabel, ACTIVITY1_LEN_VAL2 + &quot;_label&quot;, bud2Style) + NBSP</span>
				+ input2 + NBSP
<span class="nc" id="L1084">				+ BidOptionsFilterUtil.wrapInSpan(m_hoursLabel, ACTIVITY1_LEN_VAL1 + &quot;_label&quot;, bud1Style);</span>

		// Add the &quot;Match All shifts in schedule&quot; checkbox
<span class="nc" id="L1087">		String buddy3 = &quot;&quot;;</span>
<span class="nc bnc" id="L1088" title="All 2 branches missed.">		if (m_isWeeklyAuction) {</span>
<span class="nc" id="L1089">			String bud3Style = getBuddyStyle(DD_TYPE_LENGTH, m_filter.getInt(&quot;activity1LengthType&quot;), BUDDY3_INDEX);</span>
<span class="nc" id="L1090">			String synchJS = getCheckboxSynchJS(&quot;activity1IdMatchAll&quot;, &quot;activity1StartMatchAll&quot;);</span>
<span class="nc" id="L1091">			String checkBox = HtmlBooleanCheckbox.makeInput(&quot;activity1LengthMatchAll&quot;, m_checkBoxLabel, synchJS,</span>
<span class="nc" id="L1092">					m_filter.getBool(&quot;activity1LengthMatchAll&quot;), false);</span>
<span class="nc" id="L1093">			buddy3 = BidOptionsFilterUtil.wrapInSpan(checkBox, ACTIVITY1_LEN_CHECKBOX_SPAN, bud3Style);</span>
		}

		// Put it all together
<span class="nc" id="L1097">		return BidOptionsFilterUtil.wrapInTable2Row2Col(STYLE4, new String[] { dropDown, inputsCol, buddy3, &quot;&quot; });</span>
	}

	private String createActivity1StartRow() {
		// Create the &quot;Start&quot; drop down
<span class="nc" id="L1102">		String startLabel = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_ACTIVITY_START);</span>
<span class="nc" id="L1103">		String onChangeJS = JSUtil.ON_CHANGE</span>
				+ &quot;showDDBuddyElems(this, ACTIVITY1_START_VISIBLE_MAP, ACTIVITY1_START_INVISIBLE_MAP)&quot;;
<span class="nc" id="L1105">		String dropDown = BidOptionsFilterUtil.makeSelectInput(&quot;activity1StartType&quot;,</span>
<span class="nc" id="L1106">				EMPTY + m_filter.getInt(&quot;activity1StartType&quot;), onChangeJS,</span>
<span class="nc" id="L1107">				getMinMaxDDOptions(m_anyTimeLabel, m_atLabel, m_notBeforeLabel, m_notAfterLabel, m_betweenLabel),</span>
				DDWIDTH, startLabel);

		// Add the TimePickerPC buddy
<span class="nc" id="L1111">		String bud1Style = getBuddyStyle(DD_TYPE_TIME, m_filter.getInt(&quot;activity1StartType&quot;), BUDDY1_INDEX);</span>
<span class="nc" id="L1112">		m_activity1StartTime.setTime(getTime(m_filter.getInt(&quot;activity1Start1&quot;)) * 60); // seconds</span>
<span class="nc" id="L1113">		String buddy1 = BidOptionsFilterUtil.wrapInSpan(m_activity1StartTime.getHtmlDisplay(),</span>
				ACTIVITY1_START_TIME_SPAN, bud1Style);

		// Add the TimeRangePickerPC buddy
<span class="nc" id="L1117">		String bud2Style = getBuddyStyle(DD_TYPE_TIME, m_filter.getInt(&quot;activity1StartType&quot;), BUDDY2_INDEX);</span>
<span class="nc" id="L1118">		m_activity1StartRange.getStartTimePickerPC().setTime(getTime(m_filter.getInt(&quot;activity1Start1&quot;)) * 60); // seconds</span>
<span class="nc" id="L1119">		m_activity1StartRange.getEndTimePickerPC().setTime(getTime(m_filter.getInt(&quot;activity1Start2&quot;)) * 60); // seconds</span>
<span class="nc" id="L1120">		String buddy2 = BidOptionsFilterUtil.wrapInSpan(m_activity1StartRange.getHtmlDisplay(),</span>
				ACTIVITY1_START_RANGE_SPAN, bud2Style);

		// Add the &quot;Match All shifts in schedule&quot; checkbox
<span class="nc" id="L1124">		String buddy3 = &quot;&quot;;</span>
<span class="nc bnc" id="L1125" title="All 2 branches missed.">		if (m_isWeeklyAuction) {</span>
<span class="nc" id="L1126">			String bud3Style = getBuddyStyle(DD_TYPE_TIME, m_filter.getInt(&quot;activity1StartType&quot;), BUDDY3_INDEX);</span>
<span class="nc" id="L1127">			String synchJS = getCheckboxSynchJS(&quot;activity1IdMatchAll&quot;, &quot;activity1LengthMatchAll&quot;);</span>
<span class="nc" id="L1128">			String checkBox = HtmlBooleanCheckbox.makeInput(&quot;activity1StartMatchAll&quot;, m_checkBoxLabel, synchJS,</span>
<span class="nc" id="L1129">					m_filter.getBool(&quot;activity1StartMatchAll&quot;), false);</span>
<span class="nc" id="L1130">			buddy3 = BidOptionsFilterUtil.wrapInSpan(checkBox, ACTIVITY1_START_CHECKBOX_SPAN, bud3Style);</span>
		}

		// Put it all together
<span class="nc" id="L1134">		return BidOptionsFilterUtil.wrapInTable1Row3Col(STYLE1, new String[] { dropDown, buddy1 + buddy2, buddy3 });</span>
	}

	private String createActivity2NameRow() {
		// Create the &quot;Activity Name&quot; drop down
<span class="nc" id="L1139">		String title = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_SECOND_ACTIVITY_NAME);</span>
<span class="nc" id="L1140">		String buddyList = BidOptionsFilterUtil.toJSArray(new String[] { &quot;ACTIVITY2_ID_CHECKBOX_SPAN&quot; });</span>
<span class="nc" id="L1141">		String onChangeJS = JSUtil.ON_CHANGE;</span>
<span class="nc bnc" id="L1142" title="All 2 branches missed.">		if (m_isWeeklyAuction)</span>
<span class="nc" id="L1143">			onChangeJS += &quot;showSimpleDDBuddyElems(this, &quot; + buddyList + &quot;)&quot;;</span>
<span class="nc" id="L1144">		String dropDown = BidOptionsFilterUtil.makeSelectInput(&quot;activity2Id&quot;, m_filter.getIDString(&quot;activity2Id&quot;),</span>
<span class="nc" id="L1145">				onChangeJS, getActivityDDOptions(), DDWIDTH, title);</span>

		// Add the &quot;Match All shifts in schedule&quot; checkbox
<span class="nc" id="L1148">		String buddy = &quot;&quot;;</span>
<span class="nc bnc" id="L1149" title="All 2 branches missed.">		if (m_isWeeklyAuction) {</span>
<span class="nc" id="L1150">			String synchJS = getCheckboxSynchJS(&quot;activity2LengthMatchAll&quot;, &quot;activity2StartMatchAll&quot;);</span>
<span class="nc" id="L1151">			String checkBox = HtmlBooleanCheckbox.makeInput(&quot;activity2IdMatchAll&quot;, m_checkBoxLabel, synchJS,</span>
<span class="nc" id="L1152">					m_filter.getBool(&quot;activity2IdMatchAll&quot;), false);</span>
<span class="nc" id="L1153">			String budStyle = getBuddyStyle(DD_TYPE_ID, idToInteger(m_filter.getID(&quot;activity2Id&quot;)), BUDDY1_INDEX);</span>
<span class="nc" id="L1154">			buddy = BidOptionsFilterUtil.wrapInSpan(checkBox, &quot;ACTIVITY2_ID_CHECKBOX_SPAN&quot;, budStyle);</span>
		}

		// Put it all together
<span class="nc" id="L1158">		return BidOptionsFilterUtil.wrapInTable1Row2Col(STYLE1, new String[] { dropDown, buddy });</span>

	}

	private String createActivity2LengthRow() {
		// Create the &quot;Activity2 Length&quot; drop down
<span class="nc" id="L1164">		String lengthLabel = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_ACTIVITY_LENGTH);</span>
<span class="nc" id="L1165">		String onChangeJS = JSUtil.ON_CHANGE</span>
				+ &quot;showDDBuddyElems(this, ACTIVITY2_LEN_VISIBLE_MAP, ACTIVITY2_LEN_INVISIBLE_MAP)&quot;;
<span class="nc" id="L1167">		String dropDown = BidOptionsFilterUtil.makeSelectInput(&quot;activity2LengthType&quot;,</span>
<span class="nc" id="L1168">				EMPTY + m_filter.getInt(&quot;activity2LengthType&quot;), onChangeJS,</span>
<span class="nc" id="L1169">				getMinMaxDDOptions(m_anyLengthLabel, m_equalLabel, m_minLabel, m_maxLabel, m_betweenLabel), DDWIDTH,</span>
				lengthLabel);

		// Create the first buddy field
<span class="nc" id="L1173">		resetInputPC(ACTIVITY2_LEN_VAL1, FormInputPC.TYPE_NUMERIC);</span>
<span class="nc" id="L1174">		m_inputPC.setInputFieldDesc(RmWebBundleKey.RM_SA_FILTER_ACTIVITY_LENGTH, RmWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L1175">		m_inputPC.setInputValue(getInputValue(m_filter.getFloat(&quot;activity2LengthValue1&quot;)));</span>
<span class="nc" id="L1176">		String bud1Style = getBuddyStyle(DD_TYPE_LENGTH, m_filter.getInt(&quot;activity2LengthType&quot;), BUDDY1_INDEX);</span>
<span class="nc" id="L1177">		m_inputPC.setStyle(bud1Style);</span>
<span class="nc" id="L1178">		m_inputPC.setTitle(i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_NUMBER_OF_HOURS));</span>
<span class="nc" id="L1179">		m_inputPC.initForDisplay();</span>
<span class="nc" id="L1180">		String input1 = m_inputPC.getHtmlDisplay();</span>

		// Create the second buddy field
<span class="nc" id="L1183">		resetInputPC(ACTIVITY2_LEN_VAL2, FormInputPC.TYPE_NUMERIC);</span>
<span class="nc" id="L1184">		m_inputPC.setInputFieldDesc(RmWebBundleKey.RM_SA_FILTER_ACTIVITY_LENGTH, RmWebBundleKey.BUNDLE_NAME);</span>
<span class="nc" id="L1185">		m_inputPC.setInputValue(getInputValue(m_filter.getFloat(&quot;activity2LengthValue2&quot;)));</span>
<span class="nc" id="L1186">		String bud2Style = getBuddyStyle(DD_TYPE_LENGTH, m_filter.getInt(&quot;activity2LengthType&quot;), BUDDY2_INDEX);</span>
<span class="nc" id="L1187">		m_inputPC.setStyle(bud2Style);</span>
<span class="nc" id="L1188">		m_inputPC.setTitle(i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_MAX_NUMBER_OF_HOURS));</span>
<span class="nc" id="L1189">		m_inputPC.initForDisplay();</span>
<span class="nc" id="L1190">		String input2 = m_inputPC.getHtmlDisplay();</span>

		// Aggregate the elements into the inputs column
<span class="nc" id="L1193">		String inputsCol = input1 + NBSP</span>
<span class="nc" id="L1194">				+ BidOptionsFilterUtil.wrapInSpan(m_dashLabel, ACTIVITY2_LEN_VAL2 + &quot;_label&quot;, bud2Style) + NBSP</span>
				+ input2 + NBSP
<span class="nc" id="L1196">				+ BidOptionsFilterUtil.wrapInSpan(m_hoursLabel, ACTIVITY2_LEN_VAL1 + &quot;_label&quot;, bud1Style);</span>

		// Add the &quot;Match All shifts in schedule&quot; checkbox
<span class="nc" id="L1199">		String buddy3 = &quot;&quot;;</span>
<span class="nc bnc" id="L1200" title="All 2 branches missed.">		if (m_isWeeklyAuction) {</span>
<span class="nc" id="L1201">			String bud3Style = getBuddyStyle(DD_TYPE_LENGTH, m_filter.getInt(&quot;activity2LengthType&quot;), BUDDY3_INDEX);</span>
<span class="nc" id="L1202">			String synchJS = getCheckboxSynchJS(&quot;activity2IdMatchAll&quot;, &quot;activity2StartMatchAll&quot;);</span>
<span class="nc" id="L1203">			String checkBox = HtmlBooleanCheckbox.makeInput(&quot;activity2LengthMatchAll&quot;, m_checkBoxLabel, synchJS,</span>
<span class="nc" id="L1204">					m_filter.getBool(&quot;activity2LengthMatchAll&quot;), false);</span>
<span class="nc" id="L1205">			buddy3 = BidOptionsFilterUtil.wrapInSpan(checkBox, ACTIVITY2_LEN_CHECKBOX_SPAN, bud3Style);</span>
		}

		// Put it all together
<span class="nc" id="L1209">		return BidOptionsFilterUtil.wrapInTable2Row2Col(STYLE4, new String[] { dropDown, inputsCol, buddy3, &quot;&quot; });</span>
	}

	private String createActivity2StartRow() {
		// Create the &quot;Start&quot; drop down
<span class="nc" id="L1214">		String startLabel = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_ACTIVITY_START);</span>
<span class="nc" id="L1215">		String onChangeJS = JSUtil.ON_CHANGE</span>
				+ &quot;showDDBuddyElems(this, ACTIVITY2_START_VISIBLE_MAP, ACTIVITY2_START_INVISIBLE_MAP)&quot;;
<span class="nc" id="L1217">		String dropDown = BidOptionsFilterUtil.makeSelectInput(&quot;activity2StartType&quot;,</span>
<span class="nc" id="L1218">				EMPTY + m_filter.getInt(&quot;activity2StartType&quot;), onChangeJS,</span>
<span class="nc" id="L1219">				getMinMaxDDOptions(m_anyTimeLabel, m_atLabel, m_notBeforeLabel, m_notAfterLabel, m_betweenLabel),</span>
				DDWIDTH, startLabel);

		// Add the TimePickerPC buddy
<span class="nc" id="L1223">		String bud1Style = getBuddyStyle(DD_TYPE_TIME, m_filter.getInt(&quot;activity2StartType&quot;), BUDDY1_INDEX);</span>
<span class="nc" id="L1224">		m_activity2StartTime.setTime(getTime(m_filter.getInt(&quot;activity2Start1&quot;)) * 60); // seconds</span>
<span class="nc" id="L1225">		String buddy1 = BidOptionsFilterUtil.wrapInSpan(m_activity2StartTime.getHtmlDisplay(),</span>
				ACTIVITY2_START_TIME_SPAN, bud1Style);

		// Add the TimeRangePickerPC buddy
<span class="nc" id="L1229">		String bud2Style = getBuddyStyle(DD_TYPE_TIME, m_filter.getInt(&quot;activity2StartType&quot;), BUDDY2_INDEX);</span>
<span class="nc" id="L1230">		m_activity2StartRange.getStartTimePickerPC().setTime(getTime(m_filter.getInt(&quot;activity2Start1&quot;)) * 60); // seconds</span>
<span class="nc" id="L1231">		m_activity2StartRange.getEndTimePickerPC().setTime(getTime(m_filter.getInt(&quot;activity2Start2&quot;)) * 60); // seconds</span>
<span class="nc" id="L1232">		String buddy2 = BidOptionsFilterUtil.wrapInSpan(m_activity2StartRange.getHtmlDisplay(),</span>
				ACTIVITY2_START_RANGE_SPAN, bud2Style);

		// Add the &quot;Match All shifts in schedule&quot; checkbox
<span class="nc" id="L1236">		String buddy3 = &quot;&quot;;</span>
<span class="nc bnc" id="L1237" title="All 2 branches missed.">		if (m_isWeeklyAuction) {</span>
<span class="nc" id="L1238">			String bud3Style = getBuddyStyle(DD_TYPE_TIME, m_filter.getInt(&quot;activity2StartType&quot;), BUDDY3_INDEX);</span>
<span class="nc" id="L1239">			String synchJS = getCheckboxSynchJS(&quot;activity2IdMatchAll&quot;, &quot;activity2LengthMatchAll&quot;);</span>
<span class="nc" id="L1240">			String checkBox = HtmlBooleanCheckbox.makeInput(&quot;activity2StartMatchAll&quot;, m_checkBoxLabel, synchJS,</span>
<span class="nc" id="L1241">					m_filter.getBool(&quot;activity2StartMatchAll&quot;), false);</span>
<span class="nc" id="L1242">			buddy3 = BidOptionsFilterUtil.wrapInSpan(checkBox, ACTIVITY2_START_CHECKBOX_SPAN, bud3Style);</span>
		}

		// Put it all together
<span class="nc" id="L1246">		return BidOptionsFilterUtil.wrapInTable1Row3Col(STYLE1, new String[] { dropDown, buddy1 + buddy2, buddy3 });</span>
	}

	/**
	 * Get the row header string to use for the &quot;Activity&quot; row, which consists
	 * of three subrows (activity name, length, and start).
	 * 
	 * @return The activity row header string.
	 */
	private String getActivityRowHeader() // int activityLengthType, String
											// lengthExampleBuddyElem)
	{
<span class="nc" id="L1258">		StringBuffer sb = new StringBuffer(100);</span>
<span class="nc" id="L1259">		String nameLabel = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_ACTIVITY_NAME);</span>

<span class="nc" id="L1261">		String lengthLabel = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_ACTIVITY_LENGTH);</span>

		// String style = getBuddyStyle(DD_TYPE_LENGTH, activityLengthType,
		// BUDDY3_INDEX);
		// lengthLabel +=
		// BidOptionsFilterUtil.wrapInSpan(NBSP+m_lengthExampleLabel,
		// lengthExampleBuddyElem, style);

<span class="nc" id="L1269">		String startLabel = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_ACTIVITY_START);</span>
<span class="nc" id="L1270">		return BidOptionsFilterUtil.wrapInTable3Row1Col(STYLE3, new String[] { nameLabel, lengthLabel, startLabel });</span>
	}

	// ///////////////////////////////////////////////////////
	// Methods for the &quot;Skills&quot; container
	// ///////////////////////////////////////////////////////

	/**
	 * Add the &quot;Skills&quot; container to the page.
	 */
	private void initSkillsContainer() {
<span class="nc" id="L1281">		m_skillsContainerPC = createFormPC(&quot;skillsContainer&quot;);</span>
<span class="nc" id="L1282">		String title = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_SKILLS);</span>
<span class="nc" id="L1283">		m_skillsContainerPC.setTitle(title);</span>

		// Skills Name Row
<span class="nc" id="L1286">		m_skillsContainerPC.addRow(m_skillsForShiftLabel, createSkillsRow());</span>
<span class="nc" id="L1287">	}</span>

	private String createSkillsRow() {
		// Create the &quot;Skill Names&quot; Assignment Box
<span class="nc" id="L1291">		initSkillsAssignmentBox();</span>

		// Create the &quot;Exactly These Skills/At Least These Skills&quot; Radio Button
		// Row
<span class="nc" id="L1295">		String defaultVal = EMPTY + m_filter.getInt(&quot;skillsMatchType&quot;);</span>
<span class="nc" id="L1296">		String radio1 = BidOptionsFilterUtil.createRadio(&quot;skillsMatchType&quot;, SKILLS_MATCH_AT_LEAST_FV,</span>
				m_skillsMatchAtLeastLabel, defaultVal);
<span class="nc" id="L1298">		String radio2 = BidOptionsFilterUtil.createRadio(&quot;skillsMatchType&quot;, SKILLS_MATCH_AT_MOST_FV,</span>
				m_skillsMatchAtMostLabel, defaultVal);
<span class="nc" id="L1300">		String radio3 = BidOptionsFilterUtil.createRadio(&quot;skillsMatchType&quot;, SKILLS_MATCH_EXACT_FV,</span>
				m_skillsMatchExactlyLabel, defaultVal);

		// Put it all together
<span class="nc" id="L1304">		String assignmentBoxString = BidOptionsFilterUtil.wrapInTable4Row1Col(STYLE2, new String[] {</span>
<span class="nc" id="L1305">				m_skillsAssignmentBox.getHtmlDisplay(), radio1, radio2, radio3 });</span>

<span class="nc bnc" id="L1307" title="All 2 branches missed.">		if (m_isShowBidderSkillsOnly) {</span>
			// we'll just list the bidder's skills in plain text
<span class="nc" id="L1309">			assignmentBoxString = BidOptionsFilterUtil.wrapInSpan(assignmentBoxString, &quot;HIDDEN_ASSIGN_BOX&quot;,</span>
					&quot;display:none&quot;);
<span class="nc" id="L1311">			assignmentBoxString += SPACE + getSkillNames(m_skillsMatchAtMostLabel);</span>
		}
<span class="nc" id="L1313">		return assignmentBoxString;</span>
	}

	/**
	 * Get an HTML plain text list of skill names which are selected in the
	 * filter. This list is unmodifiable.
	 */
	private String getSkillNames(String descriptionLabel) {
<span class="nc" id="L1321">		StringBuffer skillNames = new StringBuffer(100);</span>

<span class="nc" id="L1323">		skillNames.append(descriptionLabel).append(&quot;:&quot;);</span>

<span class="nc" id="L1325">		Collection skills = m_skillsAssignmentBox.getRightListPC().getData();</span>
<span class="nc bnc" id="L1326" title="All 4 branches missed.">		if ((skills != null) &amp;&amp; (skills.size() &gt; 0)) {</span>
<span class="nc" id="L1327">			skillNames.append(&quot;&lt;UL&gt;&quot;);</span>
<span class="nc bnc" id="L1328" title="All 2 branches missed.">			for (Iterator it = skills.iterator(); it.hasNext();) {</span>
<span class="nc" id="L1329">				DefaultNodeData node = (DefaultNodeData) it.next();</span>
<span class="nc" id="L1330">				skillNames.append(&quot;&lt;LI&gt;&quot;).append(node.getName());</span>
<span class="nc" id="L1331">			}</span>
<span class="nc" id="L1332">			skillNames.append(&quot;&lt;/UL&gt;&quot;);</span>
		} else {
<span class="nc" id="L1334">			skillNames.append(&quot;&lt;UL&gt;&lt;LI&gt;&quot;).append(m_noneLabel).append(&quot;&lt;/LI&gt;&quot;);</span>
		}
<span class="nc" id="L1336">		return skillNames.toString();</span>
	}

	/**
	 * Initialize the Skills Assignment box, and populate it with data.
	 */
	private void initSkillsAssignmentBox() {
		// m_skillsAssignmentBox.setHeaderTitle(m_assignBoxHeaderLabel);
<span class="nc" id="L1344">		m_skillsAssignmentBox.setLeftTitle(m_assignBoxLeftLabel + &quot;:&quot;);</span>
<span class="nc" id="L1345">		m_skillsAssignmentBox.setRightTitle(m_assignBoxRightLabel + &quot;:&quot;);</span>
<span class="nc" id="L1346">		m_skillsAssignmentBox.setItemCount(ASSIGNMENT_BOX_ENTRIES);</span>
<span class="nc" id="L1347">		m_skillsAssignmentBox.setMultiRowSelectable(true);</span>
<span class="nc" id="L1348">		m_skillsAssignmentBox.setShowMoveButtons(false); // the order of skills</span>
															// is meaningless

		try {
			// Get the list of skills already mapped by the user
<span class="nc" id="L1353">			ArrayList mappedSkillsList = new ArrayList(0);</span>
<span class="nc" id="L1354">			Collection mappedSkillIDsList = m_filter.getList(&quot;skills&quot;);</span>
<span class="nc bnc" id="L1355" title="All 2 branches missed.">			if (mappedSkillIDsList == null)</span>
<span class="nc" id="L1356">				mappedSkillIDsList = new ArrayList(0);</span>
			else {
<span class="nc" id="L1358">				mappedSkillsList = new ArrayList(SkillModelHandler.getSkillsByIDs(mappedSkillIDsList)); // ID=int,</span>
																										// SID=null
<span class="nc" id="L1360">				ArrayList mappedSkillsNodes = makeSkillAssignmentNodeList(mappedSkillsList);</span>
<span class="nc" id="L1361">				m_skillsAssignmentBox.getRightListPC().setData(mappedSkillsNodes);</span>
			}

			// Get the list of skills not yet mapped by the user
<span class="nc" id="L1365">			ArrayList availableSkillsList = getAvailableSkillsList();</span>
<span class="nc" id="L1366">			availableSkillsList.removeAll(mappedSkillsList);</span>

			// Sort the reduced list of skills
<span class="nc" id="L1369">			Comparator skillsComparator = new Comparator() {</span>
				public int compare(Object skillA, Object skillB) {
<span class="nc" id="L1371">					return ((Skill) skillA).getName().compareToIgnoreCase(((Skill) skillB).getName());</span>
				}
			};
<span class="nc" id="L1374">			Collections.sort(availableSkillsList, skillsComparator);</span>

<span class="nc" id="L1376">			ArrayList availableSkillsNodes = makeSkillAssignmentNodeList(availableSkillsList);</span>
<span class="nc" id="L1377">			m_skillsAssignmentBox.getLeftListPC().setData(availableSkillsNodes);</span>
<span class="nc" id="L1378">		} catch (Exception ex) {</span>
<span class="nc" id="L1379">			handleUnableToLoadDataError(log, ex);</span>
<span class="nc" id="L1380">		}</span>
<span class="nc" id="L1381">	}</span>

	// ///////////////////////////////////////////////////////
	// Getter methods (get the values of the form fields)
	// ///////////////////////////////////////////////////////

	/**
	 * Get the filter object containing the values of all the form fields.
	 */
	public BidOptionsFilter getFilter() {
<span class="nc" id="L1391">		return m_filter;</span>
	}

	// ///////////////////////////////////////////////////////
	// Setter methods called automatically by super.extractParameters()
	// ///////////////////////////////////////////////////////

	// Shift
	public void setShiftId(String id) {
<span class="nc bnc" id="L1400" title="All 2 branches missed.">		if (id.equals(BidOptionsFilter.UNDEFINED_STR))</span>
<span class="nc" id="L1401">			m_filter.remove(&quot;shiftId&quot;);</span>
		else
<span class="nc" id="L1403">			m_filter.put(&quot;shiftId&quot;, new ID(Integer.parseInt(id)));</span>
<span class="nc" id="L1404">	}</span>

	public void setShiftIdMatchAll(boolean value) {
<span class="nc" id="L1407">		m_filter.put(&quot;shiftIdMatchAll&quot;, new Boolean(value));</span>
<span class="nc" id="L1408">	}</span>

	// Work Pattern
	public void setWorkPatternId(String id) {
<span class="nc bnc" id="L1412" title="All 2 branches missed.">		if (id.equals(BidOptionsFilter.UNDEFINED_STR))</span>
<span class="nc" id="L1413">			m_filter.remove(&quot;workPatternId&quot;);</span>
		else
<span class="nc" id="L1415">			m_filter.put(&quot;workPatternId&quot;, new ID(Integer.parseInt(id)));</span>
<span class="nc" id="L1416">	}</span>

	// Availability
	public void setAvailability(int value) {
<span class="nc" id="L1420">		m_filter.put(&quot;availability&quot;, new Integer(value));</span>
<span class="nc" id="L1421">	}</span>

	public void setAvailabilityValue1(int value) {
<span class="nc" id="L1424">		m_filter.put(&quot;availabilityValue1&quot;, new Integer(value));</span>
<span class="nc" id="L1425">	}</span>

	public void setAvailabilityValue2(int value) {
<span class="nc" id="L1428">		m_filter.put(&quot;availabilityValue2&quot;, new Integer(value));</span>
<span class="nc" id="L1429">	}</span>

	// Schedule Length
	public void setScheduleLengthType(int value) {
<span class="nc" id="L1433">		m_filter.put(&quot;scheduleLengthType&quot;, new Integer(value));</span>
<span class="nc" id="L1434">	}</span>

	public void setScheduleLengthValue1(float value) {
<span class="nc" id="L1437">		m_filter.put(&quot;scheduleLengthValue1&quot;, new Float(value));</span>
<span class="nc" id="L1438">	}</span>

	public void setScheduleLengthValue2(float value) {
<span class="nc" id="L1441">		m_filter.put(&quot;scheduleLengthValue2&quot;, new Float(value));</span>
<span class="nc" id="L1442">	}</span>

	public void setScheduleLengthUse(int value) {
<span class="nc" id="L1445">		m_filter.put(&quot;scheduleLengthUse&quot;, new Integer(value));</span>
<span class="nc" id="L1446">	}</span>

	// Shift Length
	public void setShiftLengthType(int value) {
<span class="nc" id="L1450">		m_filter.put(&quot;shiftLengthType&quot;, new Integer(value));</span>
<span class="nc" id="L1451">	}</span>

	public void setShiftLengthValue1(float value) {
<span class="nc" id="L1454">		m_filter.put(&quot;shiftLengthValue1&quot;, new Float(value));</span>
<span class="nc" id="L1455">	}</span>

	public void setShiftLengthValue2(float value) {
<span class="nc" id="L1458">		m_filter.put(&quot;shiftLengthValue2&quot;, new Float(value));</span>
<span class="nc" id="L1459">	}</span>

	public void setShiftLengthUse(int value) {
<span class="nc" id="L1462">		m_filter.put(&quot;shiftLengthUse&quot;, new Integer(value));</span>
<span class="nc" id="L1463">	}</span>

	public void setShiftLengthMatchAll(boolean value) {
<span class="nc" id="L1466">		m_filter.put(&quot;shiftLengthMatchAll&quot;, new Boolean(value));</span>
<span class="nc" id="L1467">	}</span>

	// Shift Start
	public void setShiftStartType(int value) {
<span class="nc" id="L1471">		m_filter.put(&quot;shiftStartType&quot;, new Integer(value));</span>
<span class="nc" id="L1472">	}</span>

	public void setShiftStartMatchAll(boolean value) {
<span class="nc" id="L1475">		m_filter.put(&quot;shiftStartMatchAll&quot;, new Boolean(value));</span>
<span class="nc" id="L1476">	}</span>

	// Shift End
	public void setShiftEndType(int value) {
<span class="nc" id="L1480">		m_filter.put(&quot;shiftEndType&quot;, new Integer(value));</span>
<span class="nc" id="L1481">	}</span>

	public void setShiftEndMatchAll(boolean value) {
<span class="nc" id="L1484">		m_filter.put(&quot;shiftEndMatchAll&quot;, new Boolean(value));</span>
<span class="nc" id="L1485">	}</span>

	// Activity1
	public void setActivity1Id(String id) {
<span class="nc bnc" id="L1489" title="All 2 branches missed.">		if (id.equals(BidOptionsFilter.UNDEFINED_STR))</span>
<span class="nc" id="L1490">			m_filter.remove(&quot;activity1Id&quot;);</span>
		else
<span class="nc" id="L1492">			m_filter.put(&quot;activity1Id&quot;, new ID(Integer.parseInt(id)));</span>
<span class="nc" id="L1493">	}</span>

	public void setActivity1LengthType(int value) {
<span class="nc" id="L1496">		m_filter.put(&quot;activity1LengthType&quot;, new Integer(value));</span>
<span class="nc" id="L1497">	}</span>

	public void setActivity1LengthValue1(float value) {
<span class="nc" id="L1500">		m_filter.put(&quot;activity1LengthValue1&quot;, new Float(value));</span>
<span class="nc" id="L1501">	}</span>

	public void setActivity1LengthValue2(float value) {
<span class="nc" id="L1504">		m_filter.put(&quot;activity1LengthValue2&quot;, new Float(value));</span>
<span class="nc" id="L1505">	}</span>

	public void setActivity1LengthMatchAll(boolean value) {
<span class="nc" id="L1508">		m_filter.put(&quot;activity1LengthMatchAll&quot;, new Boolean(value));</span>
<span class="nc" id="L1509">	}</span>

	public void setActivity1StartType(int value) {
<span class="nc" id="L1512">		m_filter.put(&quot;activity1StartType&quot;, new Integer(value));</span>
<span class="nc" id="L1513">	}</span>

	public void setActivity1IdMatchAll(boolean value) {
<span class="nc" id="L1516">		m_filter.put(&quot;activity1IdMatchAll&quot;, new Boolean(value));</span>
<span class="nc" id="L1517">	}</span>

	public void setActivity1StartMatchAll(boolean value) {
<span class="nc" id="L1520">		m_filter.put(&quot;activity1StartMatchAll&quot;, new Boolean(value));</span>
<span class="nc" id="L1521">	}</span>

	// Activity2
	public void setActivity2Id(String id) {
<span class="nc bnc" id="L1525" title="All 2 branches missed.">		if (id.equals(BidOptionsFilter.UNDEFINED_STR))</span>
<span class="nc" id="L1526">			m_filter.remove(&quot;activity2Id&quot;);</span>
		else
<span class="nc" id="L1528">			m_filter.put(&quot;activity2Id&quot;, new ID(Integer.parseInt(id)));</span>
<span class="nc" id="L1529">	}</span>

	public void setActivity2LengthType(int value) {
<span class="nc" id="L1532">		m_filter.put(&quot;activity2LengthType&quot;, new Integer(value));</span>
<span class="nc" id="L1533">	}</span>

	public void setActivity2LengthValue1(float value) {
<span class="nc" id="L1536">		m_filter.put(&quot;activity2LengthValue1&quot;, new Float(value));</span>
<span class="nc" id="L1537">	}</span>

	public void setActivity2LengthValue2(float value) {
<span class="nc" id="L1540">		m_filter.put(&quot;activity2LengthValue2&quot;, new Float(value));</span>
<span class="nc" id="L1541">	}</span>

	public void setActivity2LengthMatchAll(boolean value) {
<span class="nc" id="L1544">		m_filter.put(&quot;activity2LengthMatchAll&quot;, new Boolean(value));</span>
<span class="nc" id="L1545">	}</span>

	public void setActivity2StartType(int value) {
<span class="nc" id="L1548">		m_filter.put(&quot;activity2StartType&quot;, new Integer(value));</span>
<span class="nc" id="L1549">	}</span>

	public void setActivity2IdMatchAll(boolean value) {
<span class="nc" id="L1552">		m_filter.put(&quot;activity2IdMatchAll&quot;, new Boolean(value));</span>
<span class="nc" id="L1553">	}</span>

	public void setActivity2StartMatchAll(boolean value) {
<span class="nc" id="L1556">		m_filter.put(&quot;activity2StartMatchAll&quot;, new Boolean(value));</span>
<span class="nc" id="L1557">	}</span>

	// Skills
	public void setSkillsMatchType(int value) {
<span class="nc" id="L1561">		m_filter.put(&quot;skillsMatchType&quot;, new Integer(value));</span>
<span class="nc" id="L1562">	}</span>

	public void setAuctionID(int id) {
<span class="nc" id="L1565">		m_auctionID = new ID(id);</span>
<span class="nc" id="L1566">	}</span>

	public void setBidderID(int id) {
<span class="nc" id="L1569">		m_bidderID = new ID(id);</span>
<span class="nc" id="L1570">	}</span>

	public int getAuctionID() {
<span class="nc bnc" id="L1573" title="All 2 branches missed.">		return (m_auctionID == null) ? -1 : m_auctionID.toInt();</span>
	}

	public int getBidderID() {
<span class="nc bnc" id="L1577" title="All 2 branches missed.">		return (m_bidderID == null) ? -1 : m_bidderID.toInt();</span>
	}

	// ///////////////////////////////////////////////////////
	// Setter methods called manually after super.extractParameters()
	// ///////////////////////////////////////////////////////

	/**
	 * Extract Shift Start Time / Shift Start Range parameters from the form. We
	 * use the shiftStartType value (which was auto-extracted) to determine
	 * which, if any, of the shiftStartType, shiftStart1, shiftStart2 parameters
	 * need to be stored in the filter for display.
	 */
	private void extractShiftStartParams() {
<span class="nc" id="L1591">		int shiftStartType = m_filter.getInt(&quot;shiftStartType&quot;);</span>

<span class="nc bnc" id="L1593" title="All 6 branches missed.">		if ((shiftStartType == BidOptionsFilter.EQUAL) || (shiftStartType == BidOptionsFilter.MIN)</span>
				|| (shiftStartType == BidOptionsFilter.MAX)) {
<span class="nc" id="L1595">			m_filter.put(&quot;shiftStart1&quot;, new Integer(m_shiftStartTime.getTimeInMinutes()));</span>
<span class="nc bnc" id="L1596" title="All 2 branches missed.">		} else if (shiftStartType == BidOptionsFilter.BETWEEN) {</span>
<span class="nc" id="L1597">			m_filter.put(&quot;shiftStart1&quot;, new Integer(m_shiftStartRange.getStartTimePickerPC().getTimeInMinutes()));</span>
<span class="nc" id="L1598">			m_filter.put(&quot;shiftStart2&quot;, new Integer(m_shiftStartRange.getEndTimePickerPC().getTimeInMinutes()));</span>
<span class="nc bnc" id="L1599" title="All 2 branches missed.">		} else if (shiftStartType == BidOptionsFilter.UNDEFINED_INT) {</span>
<span class="nc" id="L1600">			m_filter.remove(&quot;shiftStartType&quot;);</span>
<span class="nc" id="L1601">			m_filter.remove(&quot;shiftStart1&quot;);</span>
<span class="nc" id="L1602">			m_filter.remove(&quot;shiftStart2&quot;);</span>
		}
<span class="nc" id="L1604">	}</span>

	/**
	 * Extract Shift End Time / Shift End Range parameters from the form. We use
	 * the shiftEndType value (which was auto-extracted) to determine which, if
	 * any, of the shiftEndType, shiftEnd1, shiftEnd2 parameters need to be
	 * stored in the filter for display.
	 */
	private void extractShiftEndParams() {
<span class="nc" id="L1613">		int shiftEndType = m_filter.getInt(&quot;shiftEndType&quot;);</span>

<span class="nc bnc" id="L1615" title="All 6 branches missed.">		if ((shiftEndType == BidOptionsFilter.EQUAL) || (shiftEndType == BidOptionsFilter.MIN)</span>
				|| (shiftEndType == BidOptionsFilter.MAX)) {
<span class="nc" id="L1617">			m_filter.put(&quot;shiftEnd1&quot;, new Integer(m_shiftEndTime.getTimeInMinutes()));</span>
<span class="nc bnc" id="L1618" title="All 2 branches missed.">		} else if (shiftEndType == BidOptionsFilter.BETWEEN) {</span>
<span class="nc" id="L1619">			m_filter.put(&quot;shiftEnd1&quot;, new Integer(m_shiftEndRange.getStartTimePickerPC().getTimeInMinutes()));</span>
<span class="nc" id="L1620">			m_filter.put(&quot;shiftEnd2&quot;, new Integer(m_shiftEndRange.getEndTimePickerPC().getTimeInMinutes()));</span>
<span class="nc bnc" id="L1621" title="All 2 branches missed.">		} else if (shiftEndType == BidOptionsFilter.UNDEFINED_INT) {</span>
<span class="nc" id="L1622">			m_filter.remove(&quot;shiftEndType&quot;);</span>
<span class="nc" id="L1623">			m_filter.remove(&quot;shiftEnd1&quot;);</span>
<span class="nc" id="L1624">			m_filter.remove(&quot;shiftEnd2&quot;);</span>
		}
<span class="nc" id="L1626">	}</span>

	/**
	 * Extract Activity1 Start Time / Activity1 Start Range parameters from the
	 * form. We use the activity1StartType value (which was auto-extracted) to
	 * determine which, if any, of the activity1StartType, activity1Start1,
	 * activity1Start2 parameters need to be stored in the filter for display.
	 */
	private void extractActivity1StartParams() {
<span class="nc" id="L1635">		int activity1StartType = m_filter.getInt(&quot;activity1StartType&quot;);</span>

<span class="nc bnc" id="L1637" title="All 6 branches missed.">		if ((activity1StartType == BidOptionsFilter.EQUAL) || (activity1StartType == BidOptionsFilter.MIN)</span>
				|| (activity1StartType == BidOptionsFilter.MAX)) {
<span class="nc" id="L1639">			m_filter.put(&quot;activity1Start1&quot;, new Integer(m_activity1StartTime.getTimeInMinutes()));</span>
<span class="nc bnc" id="L1640" title="All 2 branches missed.">		} else if (activity1StartType == BidOptionsFilter.BETWEEN) {</span>
<span class="nc" id="L1641">			m_filter.put(&quot;activity1Start1&quot;,</span>
<span class="nc" id="L1642">					new Integer(m_activity1StartRange.getStartTimePickerPC().getTimeInMinutes()));</span>
<span class="nc" id="L1643">			m_filter.put(&quot;activity1Start2&quot;, new Integer(m_activity1StartRange.getEndTimePickerPC().getTimeInMinutes()));</span>
<span class="nc bnc" id="L1644" title="All 2 branches missed.">		} else if (activity1StartType == BidOptionsFilter.UNDEFINED_INT) {</span>
<span class="nc" id="L1645">			m_filter.remove(&quot;activity1StartType&quot;);</span>
<span class="nc" id="L1646">			m_filter.remove(&quot;activity1Start1&quot;);</span>
<span class="nc" id="L1647">			m_filter.remove(&quot;activity1Start2&quot;);</span>
		}
<span class="nc" id="L1649">	}</span>

	/**
	 * Extract Activity2 Start Time / Activity2 Start Range parameters from the
	 * form. We use the activity2StartType value (which was auto-extracted) to
	 * determine which, if any, of the activity2StartType, activity2Start1,
	 * activity2Start2 parameters need to be stored in the filter for display.
	 */
	private void extractActivity2StartParams() {
<span class="nc" id="L1658">		int activity2StartType = m_filter.getInt(&quot;activity2StartType&quot;);</span>

<span class="nc bnc" id="L1660" title="All 6 branches missed.">		if ((activity2StartType == BidOptionsFilter.EQUAL) || (activity2StartType == BidOptionsFilter.MIN)</span>
				|| (activity2StartType == BidOptionsFilter.MAX)) {
<span class="nc" id="L1662">			m_filter.put(&quot;activity2Start1&quot;, new Integer(m_activity2StartTime.getTimeInMinutes()));</span>
<span class="nc bnc" id="L1663" title="All 2 branches missed.">		} else if (activity2StartType == BidOptionsFilter.BETWEEN) {</span>
<span class="nc" id="L1664">			m_filter.put(&quot;activity2Start1&quot;,</span>
<span class="nc" id="L1665">					new Integer(m_activity2StartRange.getStartTimePickerPC().getTimeInMinutes()));</span>
<span class="nc" id="L1666">			m_filter.put(&quot;activity2Start2&quot;, new Integer(m_activity2StartRange.getEndTimePickerPC().getTimeInMinutes()));</span>
<span class="nc bnc" id="L1667" title="All 2 branches missed.">		} else if (activity2StartType == BidOptionsFilter.UNDEFINED_INT) {</span>
<span class="nc" id="L1668">			m_filter.remove(&quot;activity2StartType&quot;);</span>
<span class="nc" id="L1669">			m_filter.remove(&quot;activity2Start1&quot;);</span>
<span class="nc" id="L1670">			m_filter.remove(&quot;activity2Start2&quot;);</span>
		}
<span class="nc" id="L1672">	}</span>

	/**
	 * Extract the Skills selection from the AssignmentBox component in the
	 * form. Use the extracted list of skills from the assignment list and the
	 * skillsMatchType value (which was also auto-extracted) to determine which
	 * skills to store in the filter for display on the page.
	 */
	private void extractSkillsParams() {
<span class="nc" id="L1681">		ID[] idsRight = m_skillsAssignmentBox.getRightListPC().getExtractedListIDsAsIDArray();</span>
<span class="nc bnc" id="L1682" title="All 2 branches missed.">		if (idsRight != null) // &amp;&amp; (idsRight.length &gt; 0))</span>
		{
<span class="nc" id="L1684">			ArrayList idList = new ArrayList(idsRight.length);</span>
<span class="nc" id="L1685">			addToList(idList, idsRight);</span>
<span class="nc bnc" id="L1686" title="All 2 branches missed.">			if (idList.isEmpty()) {</span>
				// Special case when no skills have been selected.
<span class="nc" id="L1688">				int skillsMatchType = m_filter.getInt(&quot;skillsMatchType&quot;);</span>
<span class="nc bnc" id="L1689" title="All 4 branches missed.">				if ((skillsMatchType == BidOptionsFilter.SKILLS_MATCH_EXACT)</span>
						|| (skillsMatchType == BidOptionsFilter.SKILLS_MATCH_AT_MOST)) {
					// User wants to search for all options which require no
					// skills.
<span class="nc" id="L1693">					m_filter.put(&quot;skills&quot;, idList);</span>
<span class="nc bnc" id="L1694" title="All 2 branches missed.">				} else if (skillsMatchType == BidOptionsFilter.SKILLS_MATCH_AT_LEAST) {</span>
					// &quot;At least no skills&quot; means match any options. So, we do
					// not filter by skills.
<span class="nc" id="L1697">					m_filter.remove(&quot;skills&quot;);</span>
				}
<span class="nc" id="L1699">			} else {</span>
<span class="nc" id="L1700">				m_filter.put(&quot;skills&quot;, idList);</span>
			}
<span class="nc" id="L1702">		} else {</span>
<span class="nc" id="L1703">			m_filter.remove(&quot;skills&quot;);</span>
		}
<span class="nc" id="L1705">	}</span>

	// ///////////////////////////////////////////////////////
	// Container Support Methods
	// ///////////////////////////////////////////////////////

	/**
	 * Add a collapsible form container to the page.
	 * 
	 * @param name
	 *            The name of the container
	 * @return The container object.
	 */
	private Collapsible2ColFormPC createFormPC(String name) {
<span class="nc" id="L1719">		Collapsible2ColFormPC formPC = new Collapsible2ColFormPC(m_context);</span>
<span class="nc" id="L1720">		formPC.setName(name);</span>
<span class="nc" id="L1721">		formPC.setIsBorderEnabled(true);</span>
<span class="nc" id="L1722">		m_containerList.add(formPC);</span>
<span class="nc" id="L1723">		return formPC;</span>
	}

	/**
	 * Return List of Containers Note: Items in the Collection will be treated
	 * either as Page Components or just basic Objects.
	 */
	public Collection getContainers() {
<span class="nc" id="L1731">		return m_containerList;</span>
	}

	// ///////////////////////////////////////////////////////
	// Helper Methods
	// ///////////////////////////////////////////////////////

	/**
	 * Convert an integer to a String value, to be displayed in an input field.
	 */
	private String getInputValue(int val) {
<span class="nc bnc" id="L1742" title="All 2 branches missed.">		if (val == BidOptionsFilter.UNDEFINED_INT)</span>
<span class="nc" id="L1743">			return EMPTY;</span>
<span class="nc" id="L1744">		return EMPTY + val;</span>
	}

	/**
	 * Convert a float to a String value, to be displayed in an input field.
	 */
	private String getInputValue(float val) {
<span class="nc bnc" id="L1751" title="All 2 branches missed.">		if (val == BidOptionsFilter.UNDEFINED_FLOAT)</span>
<span class="nc" id="L1752">			return EMPTY;</span>
<span class="nc" id="L1753">		return EMPTY + val;</span>
	}

	/**
	 * Reset our global m_inputPC page component, so it can be reused.
	 * 
	 * @param name
	 *            The name of the input element.
	 * @param type
	 *            the type of input field (ex: FormInputPC.TYPE_INTEGER)
	 */
	private void resetInputPC(String name, int type) {
<span class="nc" id="L1765">		m_inputPC.reset();</span>
<span class="nc" id="L1766">		m_inputPC.setIsRequired(false); // TBD: we may need special validation</span>
<span class="nc" id="L1767">		m_inputPC.setInputType(type);</span>
<span class="nc" id="L1768">		m_inputPC.setLowerLimit(0);</span>
<span class="nc" id="L1769">		m_inputPC.setInputFN(name);</span>
<span class="nc" id="L1770">	}</span>

	/**
	 * Reset a TimePickerPC page component
	 */
	private void resetTimePickerPC(TimePickerPC picker, String name) {
<span class="nc" id="L1776">		picker.reset();</span>
<span class="nc" id="L1777">		picker.setTimeInterval(1);</span>
		// m_timePickerPC.setIsInputValueOptional(true);
<span class="nc" id="L1779">		picker.setOnChangeJS(JSUtil.ON_CHANGE);</span>
<span class="nc" id="L1780">		picker.setInputFieldName(name);</span>
<span class="nc" id="L1781">		picker.setTitle(i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_SET_TIME));</span>
<span class="nc" id="L1782">	}</span>

	/**
	 * Reset a TimeRangePickerPC page component
	 */
	private void resetTimeRangePickerPC(TimeRangePickerPC picker) {
<span class="nc" id="L1788">		picker.reset();</span>
<span class="nc" id="L1789">		picker.setTimeInterval(1);</span>
		// m_timePickerPC.setIsInputValueOptional(true);
<span class="nc" id="L1791">		picker.setOnChangeJS(JSUtil.ON_CHANGE);</span>
<span class="nc" id="L1792">		picker.setTitles(i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_SET_TIME),</span>
<span class="nc" id="L1793">				i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_SET_MAX_TIME));</span>
<span class="nc" id="L1794">	}</span>

	/**
	 * Create a drop down options list containing &quot;Any&quot;, &quot;Equal&quot;, &quot;Min&quot;, &quot;Max&quot;,
	 * and &quot;Between&quot; options.
	 * 
	 * @param anyLabel
	 *            The label for the &quot;Any&quot; option
	 * @return The list of StringsPair options.
	 */
	private List getMinMaxDDOptions(String anyLabel, String equalLabel, String minLabel, String maxLabel,
			String betweenLabel) {
<span class="nc" id="L1806">		ArrayList list = new ArrayList(4);</span>
<span class="nc" id="L1807">		list.add(new StringsPair(&quot;&quot; + ddIndexToVal(0), ddIndexToLabel(0, anyLabel, equalLabel, minLabel, maxLabel,</span>
				betweenLabel)));
<span class="nc" id="L1809">		list.add(new StringsPair(&quot;&quot; + ddIndexToVal(1), ddIndexToLabel(1, anyLabel, equalLabel, minLabel, maxLabel,</span>
				betweenLabel)));
<span class="nc" id="L1811">		list.add(new StringsPair(&quot;&quot; + ddIndexToVal(2), ddIndexToLabel(2, anyLabel, equalLabel, minLabel, maxLabel,</span>
				betweenLabel)));
<span class="nc" id="L1813">		list.add(new StringsPair(&quot;&quot; + ddIndexToVal(3), ddIndexToLabel(3, anyLabel, equalLabel, minLabel, maxLabel,</span>
				betweenLabel)));
<span class="nc" id="L1815">		list.add(new StringsPair(&quot;&quot; + ddIndexToVal(4), ddIndexToLabel(4, anyLabel, equalLabel, minLabel, maxLabel,</span>
				betweenLabel)));
<span class="nc" id="L1817">		return list;</span>
	}

	/**
	 * Return the &quot;Show&quot; mode to use for initially displaying a &quot;buddy&quot; form
	 * element. The element to be shown/hidden is a &quot;buddy&quot; of a dropdown list.
	 * 
	 * @param ddType
	 *            The type of dropdown which has the buddy. Should be either
	 *            DD_TYPE_ID, DD_TYPE_LENGTH or DD_TYPE_TIME.
	 * @param selectedID
	 *            The dropdown's currently selected ID (not the index). This
	 *            tells us which of the buddies should be hidden or shown.
	 * @return One of: SHOW_NO_BUDS, SHOW_BUD1_ONLY, SHOW_BUD2_ONLY,
	 *         SHOW_ALL_BUDS
	 */
	private int getShowMode(int ddType, Integer selectedID) {
<span class="nc" id="L1834">		int showMode = SHOW_NO_BUDS;</span>
<span class="nc bnc" id="L1835" title="All 2 branches missed.">		if (selectedID == null) {</span>
<span class="nc" id="L1836">			return SHOW_NO_BUDS;</span>
		}
<span class="nc" id="L1838">		int selectedInt = selectedID.intValue();</span>
<span class="nc bnc" id="L1839" title="All 4 branches missed.">		switch (ddType) {</span>
		case DD_TYPE_ID:
<span class="nc bnc" id="L1841" title="All 2 branches missed.">			switch (selectedInt) {</span>
			case BidOptionsFilter.UNDEFINED_INT:
<span class="nc" id="L1843">				showMode = SHOW_NO_BUDS;</span>
<span class="nc" id="L1844">				break;</span>
			default:
<span class="nc" id="L1846">				showMode = SHOW_ALL_BUDS;</span>
<span class="nc" id="L1847">				break;</span>
			}
			break;
		case DD_TYPE_LENGTH:
<span class="nc bnc" id="L1851" title="All 4 branches missed.">			switch (selectedInt) {</span>
			case BidOptionsFilter.UNDEFINED_INT:
<span class="nc" id="L1853">				showMode = SHOW_NO_BUDS;</span>
<span class="nc" id="L1854">				break;</span>
			case BidOptionsFilter.EQUAL:
			case BidOptionsFilter.MIN:
			case BidOptionsFilter.MAX:
<span class="nc" id="L1858">				showMode = SHOW_BUD1_ONLY;</span>
<span class="nc" id="L1859">				break;</span>
			case BidOptionsFilter.BETWEEN:
<span class="nc" id="L1861">				showMode = SHOW_ALL_BUDS;</span>
				break;
			}
<span class="nc" id="L1864">			break;</span>
		case DD_TYPE_TIME:
<span class="nc bnc" id="L1866" title="All 4 branches missed.">			switch (selectedInt) {</span>
			case BidOptionsFilter.UNDEFINED_INT:
<span class="nc" id="L1868">				showMode = SHOW_NO_BUDS;</span>
<span class="nc" id="L1869">				break;</span>
			case BidOptionsFilter.EQUAL:
			case BidOptionsFilter.MIN:
			case BidOptionsFilter.MAX:
<span class="nc" id="L1873">				showMode = SHOW_BUD1_ONLY;</span>
<span class="nc" id="L1874">				break;</span>
			case BidOptionsFilter.BETWEEN:
<span class="nc" id="L1876">				showMode = SHOW_BUD2_ONLY;</span>
				break;
			}
			break;
		}
<span class="nc" id="L1881">		return showMode;</span>
	}

	/**
	 * Determine whether a dropdown's &quot;buddy&quot; field should be shown or hidden.
	 * The field to be shown/hidden is a &quot;buddy&quot; of a dropdown list.
	 * 
	 * @param ddType
	 *            The type of dropdown which has the buddy. Should be either
	 *            DD_TYPE_ID, DD_TYPE_LENGTH or DD_TYPE_TIME.
	 * @param selectedID
	 *            The dropdown's currently selected ID (not the index). This
	 *            tells us which of the buddies should be hidden or shown.
	 * @param buddyIndex
	 *            The index of the buddy field to check. One of: BUDDY1_INDEX,
	 *            BUDDY2_INDEX, BUDDY3_INDEX, etc.. Note: buddy3 and greater are
	 *            shown whenever buddy1 OR buddy2 are shown.
	 * @return true: buddy should be shown. false: buddy should be hidden.
	 */
	private boolean isShowBuddy(int ddType, Integer selectedID, int buddyIndex) {
<span class="nc" id="L1901">		int showMode = getShowMode(ddType, selectedID);</span>
<span class="nc" id="L1902">		boolean bShow = false;</span>

<span class="nc bnc" id="L1904" title="All 5 branches missed.">		switch (showMode) {</span>
		case SHOW_NO_BUDS:
<span class="nc" id="L1906">			bShow = false;</span>
<span class="nc" id="L1907">			break;</span>
		case SHOW_BUD1_ONLY:
<span class="nc bnc" id="L1909" title="All 4 branches missed.">			bShow = (buddyIndex == BUDDY1_INDEX) || (buddyIndex &gt;= BUDDY3_INDEX);</span>
<span class="nc" id="L1910">			break;</span>
		case SHOW_BUD2_ONLY:
<span class="nc bnc" id="L1912" title="All 4 branches missed.">			bShow = (buddyIndex == BUDDY2_INDEX) || (buddyIndex &gt;= BUDDY3_INDEX);</span>
<span class="nc" id="L1913">			break;</span>
		case SHOW_ALL_BUDS:
<span class="nc" id="L1915">			bShow = true;</span>
			break;
		}
<span class="nc" id="L1918">		return bShow;</span>
	}

	/**
	 * Return the style string to use for initially displaying a &quot;buddy&quot; form
	 * field. The field whose style will be set is called a &quot;buddy&quot; of a
	 * dropdown list.
	 * 
	 * @param ddType
	 *            The type of dropdown which has the buddy. Should be either
	 *            DD_TYPE_ID, DD_TYPE_LENGTH or DD_TYPE_TIME.
	 * @param selectedID
	 *            The dropdown's currently selected ID (not the index). This
	 *            tells us which of the buddies should be hidden or shown.
	 * @param buddyIndex
	 *            The index of the buddy field to check. One of: BUDDY1_INDEX,
	 *            BUDDY2_INDEX, BUDDY3_INDEX, etc.
	 * @return the style string to use for initially displaying a &quot;buddy&quot; form
	 *         field.
	 */
	private String getBuddyStyle(int ddType, Integer selectedID, int buddyIndex) {
<span class="nc" id="L1939">		String style = &quot;&quot;; // visible</span>
<span class="nc bnc" id="L1940" title="All 2 branches missed.">		if (!isShowBuddy(ddType, selectedID, buddyIndex)) {</span>
<span class="nc" id="L1941">			style = &quot;display:none; &quot;; // hidden</span>
		}
<span class="nc" id="L1943">		return style;</span>
	}

	private String getBuddyStyle(int ddType, int selectedID, int buddyIndex) {
<span class="nc" id="L1947">		return getBuddyStyle(ddType, new Integer(selectedID), buddyIndex);</span>
	}

	/**
	 * Given an element's index in a dropdown options list, return the
	 * corresponding value.
	 * 
	 * @param index
	 *            The 0-based options list index
	 * @return
	 */
	private int ddIndexToVal(int index) {
<span class="nc" id="L1959">		int val = BidOptionsFilter.UNDEFINED_INT;</span>
<span class="nc bnc" id="L1960" title="All 6 branches missed.">		switch (index) {</span>
		case 0:
<span class="nc" id="L1962">			val = BidOptionsFilter.UNDEFINED_INT;</span>
<span class="nc" id="L1963">			break;</span>
		case 1:
<span class="nc" id="L1965">			val = BidOptionsFilter.EQUAL;</span>
<span class="nc" id="L1966">			break;</span>
		case 2:
<span class="nc" id="L1968">			val = BidOptionsFilter.MAX;</span>
<span class="nc" id="L1969">			break;</span>
		case 3:
<span class="nc" id="L1971">			val = BidOptionsFilter.MIN;</span>
<span class="nc" id="L1972">			break;</span>
		case 4:
<span class="nc" id="L1974">			val = BidOptionsFilter.BETWEEN;</span>
			break;
		}
<span class="nc" id="L1977">		return val;</span>
	}

	/**
	 * Given an element's index in a dropdown options list, return the
	 * corresponding label.
	 * 
	 * @param index
	 *            The 0-based options list index
	 * @param anyLabel
	 *            The label to use for the &quot;Any&quot; (or &quot;I don't care&quot;) option.
	 * @return
	 */
	private String ddIndexToLabel(int index, String anyLabel, String equalLabel, String minLabel, String maxLabel,
			String betweenLabel) {
<span class="nc" id="L1992">		String label = &quot;&quot;;</span>
<span class="nc bnc" id="L1993" title="All 6 branches missed.">		switch (index) {</span>
		case 0:
<span class="nc" id="L1995">			label = anyLabel;</span>
<span class="nc" id="L1996">			break;</span>
		case 1:
<span class="nc" id="L1998">			label = equalLabel;</span>
<span class="nc" id="L1999">			break;</span>
		case 2:
<span class="nc" id="L2001">			label = maxLabel;</span>
<span class="nc" id="L2002">			break;</span>
		case 3:
<span class="nc" id="L2004">			label = minLabel;</span>
<span class="nc" id="L2005">			break;</span>
		case 4:
<span class="nc" id="L2007">			label = betweenLabel;</span>
			break;
		}
<span class="nc" id="L2010">		return label;</span>
	}

	/**
	 * Create a String containing the JavaScript array data which is used by the
	 * showDDBuddyElems() JavaScript function to show/hide &quot;buddies&quot; of the
	 * various dropdown components on the page. The outter arrays are for
	 * looking up the selectedIndex of the dropdown. The inner arrays are lists
	 * of &quot;buddies&quot; of the selectedIndex, which should be either shown or hidden
	 * whenever the dropdown is on that selectedIndex. Note: This method should
	 * probably call ddIndexToVal() so that there is only a single place where
	 * the dropdown options order is defined. (ANY, EQUAL, MAX, MIN, BETWEEN)
	 * 
	 * @param ddType
	 *            The type of dropdown which has the buddy. Should be either
	 *            DD_TYPE_LENGTH or DD_TYPE_TIME.
	 * @param showName
	 *            Name of the global JS variable to hold a 2d array of buddies
	 *            to show.
	 * @param hideName
	 *            Name of the global JS variable to hold a 2d array of buddies
	 *            to hide.
	 * @param buds
	 *            An array of buddy element names. All buds with an index &gt;= 2
	 *            will be shown whenever the first or second bud are shown.
	 * @return String containing the custom JavaScript for the 2-dimentional
	 *         show/hide arrrays.
	 */
	private String createBuddyVisibilityMap(int ddType, String showName, String hideName, String buds[]) {
<span class="nc" id="L2039">		StringBuffer sb = new StringBuffer(1000);</span>

<span class="nc" id="L2041">		int numBuds = buds.length;</span>

		// create a list containing all buddies except the first one
<span class="nc" id="L2044">		ArrayList noBud1List = new ArrayList(numBuds - 1);</span>
<span class="nc bnc" id="L2045" title="All 2 branches missed.">		for (int i = 1; i &lt; numBuds; i++)</span>
<span class="nc" id="L2046">			noBud1List.add(buds[i]);</span>

		// create a list containing all buddies except the second one
<span class="nc" id="L2049">		ArrayList noBud2List = new ArrayList(numBuds);</span>
<span class="nc bnc" id="L2050" title="All 2 branches missed.">		for (int i = 0; i &lt; numBuds; i++)</span>
<span class="nc" id="L2051">			noBud2List.add(buds[i]);</span>

		// remove second buddy from list
<span class="nc bnc" id="L2054" title="All 2 branches missed.">		if (numBuds &gt; 1)</span>
<span class="nc" id="L2055">			noBud2List.remove(1);</span>

		// Create the arrays of Shown and Hidden elements
<span class="nc bnc" id="L2058" title="All 2 branches missed.">		if (ddType == DD_TYPE_LENGTH) {</span>
<span class="nc" id="L2059">			String showArrayAny[] = {}; // no buds</span>
<span class="nc" id="L2060">			String showArrayEqu[] = (String[]) noBud2List.toArray(new String[numBuds - 1]); // {bud1,</span>
																							// bud3,
																							// bud4,
																							// bud5,
																							// ...};
<span class="nc" id="L2065">			String showArrayMax[] = showArrayEqu;</span>
<span class="nc" id="L2066">			String showArrayMin[] = showArrayEqu;</span>
<span class="nc" id="L2067">			String showArrayBtw[] = buds; // all buds</span>
<span class="nc" id="L2068">			String showArray[][] = { showArrayAny, showArrayEqu, showArrayMax, showArrayMin, showArrayBtw };</span>

<span class="nc" id="L2070">			String hideArrayAny[] = buds; // all buds</span>
<span class="nc" id="L2071">			String hideArrayEqu[] = { buds[1] }; // second bud</span>
<span class="nc" id="L2072">			String hideArrayMax[] = { buds[1] };</span>
<span class="nc" id="L2073">			String hideArrayMin[] = { buds[1] };</span>
<span class="nc" id="L2074">			String hideArrayBtw[] = {}; // no buds</span>
<span class="nc" id="L2075">			String hideArray[][] = { hideArrayAny, hideArrayEqu, hideArrayMax, hideArrayMin, hideArrayBtw };</span>

<span class="nc" id="L2077">			constructJSArray(showName, showArray, sb);</span>
<span class="nc" id="L2078">			constructJSArray(hideName, hideArray, sb);</span>
<span class="nc bnc" id="L2079" title="All 2 branches missed.">		} else if (ddType == DD_TYPE_TIME) {</span>
<span class="nc" id="L2080">			String showArrayAny[] = {}; // no buds</span>
<span class="nc" id="L2081">			String showArrayEqu[] = (String[]) noBud2List.toArray(new String[numBuds - 1]); // {bud1,</span>
																							// bud3,
																							// bud4,
																							// bud5,
																							// ...};
<span class="nc" id="L2086">			String showArrayMax[] = showArrayEqu;</span>
<span class="nc" id="L2087">			String showArrayMin[] = showArrayEqu;</span>
<span class="nc" id="L2088">			String showArrayBtw[] = (String[]) noBud1List.toArray(new String[numBuds - 1]); // {bud2,</span>
																							// bud3,
																							// bud4,
																							// bud5,
																							// ...};
<span class="nc" id="L2093">			String showArray[][] = { showArrayAny, showArrayEqu, showArrayMax, showArrayMin, showArrayBtw };</span>

<span class="nc" id="L2095">			String hideArrayAny[] = buds; // all buds</span>
<span class="nc" id="L2096">			String hideArrayEqu[] = { buds[1] }; // second bud</span>
<span class="nc" id="L2097">			String hideArrayMax[] = { buds[1] };</span>
<span class="nc" id="L2098">			String hideArrayMin[] = { buds[1] };</span>
<span class="nc" id="L2099">			String hideArrayBtw[] = { buds[0] }; // first bud</span>
<span class="nc" id="L2100">			String hideArray[][] = { hideArrayAny, hideArrayEqu, hideArrayMax, hideArrayMin, hideArrayBtw };</span>

<span class="nc" id="L2102">			constructJSArray(showName, showArray, sb);</span>
<span class="nc" id="L2103">			constructJSArray(hideName, hideArray, sb);</span>
		}
<span class="nc" id="L2105">		return sb.toString();</span>
	}

	/**
	 * Construct a 2-D JavaScript array and store in a StringBuffer. The array
	 * lists which buddy elements should be shown or hidden for a particular
	 * dropdown option.
	 * 
	 * @param arrayName
	 *            The name to give to the JavaScript array we are creating.
	 * @param values
	 *            The Java array storing the buddy element names.
	 * @param sb
	 *            The StringBuffer to append our JavaScript array initialization
	 *            to.
	 */
	private void constructJSArray(String arrayName, String[][] values, StringBuffer sb) {
<span class="nc" id="L2122">		sb.append(&quot;var &quot;).append(arrayName).append(&quot; = [];\n&quot;);</span>
<span class="nc" id="L2123">		sb.append(arrayName).append(&quot;[0] = &quot;).append(BidOptionsFilterUtil.toJSArray(values[0])).append(&quot;;\n&quot;);</span>
<span class="nc" id="L2124">		sb.append(arrayName).append(&quot;[1] = &quot;).append(BidOptionsFilterUtil.toJSArray(values[1])).append(&quot;;\n&quot;);</span>
<span class="nc" id="L2125">		sb.append(arrayName).append(&quot;[2] = &quot;).append(BidOptionsFilterUtil.toJSArray(values[2])).append(&quot;;\n&quot;);</span>
<span class="nc" id="L2126">		sb.append(arrayName).append(&quot;[3] = &quot;).append(BidOptionsFilterUtil.toJSArray(values[3])).append(&quot;;\n&quot;);</span>
<span class="nc" id="L2127">		sb.append(arrayName).append(&quot;[4] = &quot;).append(BidOptionsFilterUtil.toJSArray(values[4])).append(&quot;;\n\n&quot;);</span>
<span class="nc" id="L2128">	}</span>

	/**
	 * An unelegant way to get the onClick JavaScript for synchronizing
	 * checkboxes.
	 * 
	 * @param name1
	 *            the name of the first checkbox to synchonize
	 * @param name2
	 *            the name of the second checkbox to synchonize
	 * @return The JavaScript to call in a checkbox's onClick handler in order
	 *         for two other checkboxes to be synchronized with it's setting.
	 */
	private String getCheckboxSynchJS(String name1, String name2) {
		/*
		 * 508 Radio button form element names have the following format:
		 * name_true_0 //the radio button name_true_0_hidden //the hidden field
		 * for the radio button
		 * 
		 * String synchJS = &quot;document.getElementById('&quot; + name1 +
		 * &quot;_true_0').value=this.checked;&quot;; synchJS +=
		 * &quot;document.getElementById('&quot; + name1 +
		 * &quot;_true_0').checked=this.checked;&quot;; synchJS +=
		 * &quot;document.getElementById('&quot; + name1 +
		 * &quot;_true_0_hidden').value=this.checked;&quot;;
		 * 
		 * synchJS += &quot;document.getElementById('&quot; + name2 +
		 * &quot;_true_0').value=this.checked;&quot;; synchJS +=
		 * &quot;document.getElementById('&quot; + name2 +
		 * &quot;_true_0').checked=this.checked;&quot;; synchJS +=
		 * &quot;document.getElementById('&quot; + name2 +
		 * &quot;_true_0_hidden').value=this.checked;&quot;;
		 * 
		 * synchJS += JSUtil.ON_CHANGE; return synchJS;
		 */

<span class="nc" id="L2164">		String synchJS = &quot;&quot;;</span>
<span class="nc" id="L2165">		synchJS += &quot;DOM2.getElementByIdOrName('bChk_&quot; + name1 + &quot;_true_0').value=this.checked;&quot;;</span>
<span class="nc" id="L2166">		synchJS += &quot;DOM2.getElementByIdOrName('bChk_&quot; + name1 + &quot;_true_0').checked=this.checked;&quot;;</span>
<span class="nc" id="L2167">		synchJS += &quot;DOM2.getElementByIdOrName('&quot; + name1 + &quot;_true_0').value=this.checked;&quot;;</span>
<span class="nc" id="L2168">		synchJS += &quot;DOM2.getElementByIdOrName('&quot; + name1 + &quot;_true_0').checked=this.checked;&quot;;</span>

<span class="nc" id="L2170">		synchJS += &quot;DOM2.getElementByIdOrName('bChk_&quot; + name2 + &quot;_true_0').value=this.checked;&quot;;</span>
<span class="nc" id="L2171">		synchJS += &quot;DOM2.getElementByIdOrName('bChk_&quot; + name2 + &quot;_true_0').checked=this.checked;&quot;;</span>
<span class="nc" id="L2172">		synchJS += &quot;DOM2.getElementByIdOrName('&quot; + name2 + &quot;_true_0').value=this.checked;&quot;;</span>
<span class="nc" id="L2173">		synchJS += &quot;DOM2.getElementByIdOrName('&quot; + name2 + &quot;_true_0').checked=this.checked;&quot;;</span>

<span class="nc" id="L2175">		synchJS += JSUtil.ON_CHANGE;</span>
<span class="nc" id="L2176">		return synchJS;</span>
	}

	/**
	 * Get the time to initialize a TimePickerPC with.
	 * 
	 * @param time
	 *            The time as stored in the filter object.
	 * @return The time to display in the TimePickerPC input.
	 */
	private int getTime(int time) {
<span class="nc bnc" id="L2187" title="All 2 branches missed.">		if (time == BidOptionsFilter.UNDEFINED_INT)</span>
<span class="nc" id="L2188">			return 0;</span>
<span class="nc" id="L2189">		return time;</span>
	}

	/**
	 * Convert an ID to an Integer
	 */
	private Integer idToInteger(ID id) {
<span class="nc bnc" id="L2196" title="All 2 branches missed.">		if (id == null)</span>
<span class="nc" id="L2197">			return null;</span>
<span class="nc" id="L2198">		return new Integer(id.toInt());</span>
	}

	/**
	 * Add each Object from an array to an ArrayList.
	 * 
	 * @param list
	 *            The ArrayList to receive the objects.
	 * @param ids
	 *            The array or Objects.
	 */
	private void addToList(ArrayList list, Object ids[]) {
<span class="nc bnc" id="L2210" title="All 4 branches missed.">		if ((list != null) &amp;&amp; (ids != null)) {</span>
<span class="nc bnc" id="L2211" title="All 2 branches missed.">			for (int i = 0; i &lt; ids.length; i++)</span>
<span class="nc" id="L2212">				list.add(ids[i]);</span>
		}
<span class="nc" id="L2214">	}</span>

	/**
	 * Initialize our member variable label strings.
	 */
	private void initLabels() {
<span class="nc" id="L2220">		m_anyAvailLabel = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_ANY_AVAILABILITY);</span>
<span class="nc" id="L2221">		m_anyLengthLabel = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_ANY_LENGTH);</span>
<span class="nc" id="L2222">		m_anyTimeLabel = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_ANY_TIME);</span>
<span class="nc" id="L2223">		m_atLabel = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_AT);</span>
<span class="nc" id="L2224">		m_equalLabel = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_EQUAL_TO);</span>
<span class="nc" id="L2225">		m_minLabel = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_NO_LESS_THAN);</span>
<span class="nc" id="L2226">		m_maxLabel = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_NO_MORE_THAN);</span>
<span class="nc" id="L2227">		m_betweenLabel = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_BETWEEN);</span>
<span class="nc" id="L2228">		m_notBeforeLabel = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_NOT_BEFORE);</span>
<span class="nc" id="L2229">		m_notAfterLabel = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_NOT_AFTER);</span>
<span class="nc" id="L2230">		m_optionsLabel = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_OPTIONS);</span>
<span class="nc" id="L2231">		m_dashLabel = &quot;-&quot;;</span>
<span class="nc" id="L2232">		m_checkBoxLabel = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_MATCH_ALL_SHIFTS);</span>
<span class="nc" id="L2233">		m_actualShiftLengthLabel = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_ACTUAL_SHIFT_LENGTH);</span>
<span class="nc" id="L2234">		m_actualSchedLengthLabel = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_ACTUAL_SCHEDULE_LENGTH);</span>
<span class="nc" id="L2235">		m_paidTimeOnlyLabel = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_PAID_TIME_ONLY);</span>
<span class="nc" id="L2236">		m_skillsMatchAnyLabel = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_SKILLS_ANY);</span>
<span class="nc" id="L2237">		m_skillsMatchExactlyLabel = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_SKILLS_EXACTLY);</span>
<span class="nc" id="L2238">		m_skillsMatchAtLeastLabel = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_SKILLS_MINIMUM);</span>
<span class="nc" id="L2239">		m_skillsMatchAtMostLabel = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_SKILLS_MAXIMUM);</span>
<span class="nc" id="L2240">		m_skillsForShiftLabel = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_SKILLS_FOR_SHIFT);</span>
<span class="nc" id="L2241">		m_assignBoxHeaderLabel = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_SKILLS);</span>
<span class="nc" id="L2242">		m_assignBoxLeftLabel = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_ASSIGN_BOX_LEFT);</span>
<span class="nc" id="L2243">		m_assignBoxRightLabel = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_ASSIGN_BOX_RIGHT);</span>
<span class="nc" id="L2244">		m_noneLabel = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_NONE);</span>
<span class="nc" id="L2245">		m_lengthExampleLabel = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_LENGTH_EXAMPLE);</span>
<span class="nc" id="L2246">		m_hoursLabel = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_HOURS) + NBSP + m_lengthExampleLabel;</span>
<span class="nc" id="L2247">	}</span>

	/**
	 * Initialize our member variable form fields. Note: All of the other form
	 * fields are constructed as needed.
	 */
	private void initFormFields(RequestContext context) {
<span class="nc" id="L2254">		m_inputPC = new FormInputPC(context);</span>
<span class="nc" id="L2255">		addChildComponent(m_inputPC);</span>

		// Shift Start Time
<span class="nc" id="L2258">		m_shiftStartTime = new TimePickerPC(m_context);</span>
<span class="nc" id="L2259">		resetTimePickerPC(m_shiftStartTime, SHIFT_START_TIME);</span>
<span class="nc" id="L2260">		addChildComponent(m_shiftStartTime);</span>

		// Shift Start Range
<span class="nc" id="L2263">		m_shiftStartRange = new TimeRangePickerPC(m_context, SHIFT_START_RANGE);</span>
<span class="nc" id="L2264">		resetTimeRangePickerPC(m_shiftStartRange);</span>
<span class="nc" id="L2265">		addChildComponent(m_shiftStartRange);</span>

		// Shift End Time
<span class="nc" id="L2268">		m_shiftEndTime = new TimePickerPC(m_context);</span>
<span class="nc" id="L2269">		resetTimePickerPC(m_shiftEndTime, SHIFT_END_TIME);</span>
<span class="nc" id="L2270">		addChildComponent(m_shiftEndTime);</span>

		// Shift End Range
<span class="nc" id="L2273">		m_shiftEndRange = new TimeRangePickerPC(m_context, SHIFT_END_RANGE);</span>
<span class="nc" id="L2274">		resetTimeRangePickerPC(m_shiftEndRange);</span>
<span class="nc" id="L2275">		addChildComponent(m_shiftEndRange);</span>

		// Activity1 Start Time
<span class="nc" id="L2278">		m_activity1StartTime = new TimePickerPC(m_context);</span>
<span class="nc" id="L2279">		resetTimePickerPC(m_activity1StartTime, ACTIVITY1_START_TIME);</span>
<span class="nc" id="L2280">		addChildComponent(m_activity1StartTime);</span>

		// Activity1 Start Range
<span class="nc" id="L2283">		m_activity1StartRange = new TimeRangePickerPC(m_context, ACTIVITY1_START_RANGE);</span>
<span class="nc" id="L2284">		resetTimeRangePickerPC(m_activity1StartRange);</span>
<span class="nc" id="L2285">		addChildComponent(m_activity1StartRange);</span>

		// Activity2 Start Time
<span class="nc" id="L2288">		m_activity2StartTime = new TimePickerPC(m_context);</span>
<span class="nc" id="L2289">		resetTimePickerPC(m_activity2StartTime, ACTIVITY2_START_TIME);</span>
<span class="nc" id="L2290">		addChildComponent(m_activity2StartTime);</span>

		// Activity2 Start Range
<span class="nc" id="L2293">		m_activity2StartRange = new TimeRangePickerPC(m_context, ACTIVITY2_START_RANGE);</span>
<span class="nc" id="L2294">		resetTimeRangePickerPC(m_activity2StartRange);</span>
<span class="nc" id="L2295">		addChildComponent(m_activity2StartRange);</span>

		// Skills Assignment Box
<span class="nc bnc" id="L2298" title="All 2 branches missed.">		if (isShowSkillsSection()) {</span>
<span class="nc" id="L2299">			m_skillsAssignmentBox = new AssignmentBoxPC(context);</span>
<span class="nc" id="L2300">			m_skillsAssignmentBox.setName(&quot;skills_assignmentbox&quot;);</span>
<span class="nc" id="L2301">			addChildComponent(m_skillsAssignmentBox);</span>
		}
<span class="nc" id="L2303">	}</span>

	/**
	 * Create a list of DefaultNodeData nodes for use in an AssignmentBox's left
	 * or right lists.
	 * 
	 * @param itemIDs
	 *            ID's to put in the nodes
	 * @param itemNames
	 *            Names corresponding to the IDs
	 * @param itemDescs
	 *            Descriptions corresponding to the IDs
	 * @return A list of DefaultNodeData nodes
	 */
	private ArrayList makeAssignmentNodeList(ArrayList itemIDs, ArrayList itemNames, ArrayList itemDescs) {
<span class="nc" id="L2318">		ArrayList nodes = new ArrayList(10);</span>
<span class="nc bnc" id="L2319" title="All 6 branches missed.">		if ((itemIDs != null) &amp;&amp; (itemNames != null) &amp;&amp; (itemDescs != null)) {</span>
<span class="nc bnc" id="L2320" title="All 2 branches missed.">			if (itemIDs.size() &gt; 0) {</span>
<span class="nc bnc" id="L2321" title="All 4 branches missed.">				if ((itemIDs.size() == itemNames.size()) &amp;&amp; (itemIDs.size() == itemDescs.size())) {</span>
<span class="nc" id="L2322">					nodes = new ArrayList(itemIDs.size());</span>
<span class="nc" id="L2323">					for (Iterator itIDs = itemIDs.iterator(), itNames = itemNames.iterator(), itDescs = itemDescs</span>
<span class="nc bnc" id="L2324" title="All 2 branches missed.">							.iterator(); itIDs.hasNext();) {</span>
<span class="nc" id="L2325">						DefaultNodeData node = new DefaultNodeData(((ID) itIDs.next()).toString(),</span>
<span class="nc" id="L2326">								(String) itNames.next(), StringUtil.convertEmptyStringToNBSP((String) itDescs.next()));</span>
<span class="nc" id="L2327">						nodes.add(node);</span>
<span class="nc" id="L2328">					}</span>
				}
			}
		}
<span class="nc" id="L2332">		return nodes;</span>
	}

	/**
	 * Create a list of Skill DefaultNodeData nodes for use in an
	 * AssignmentBox's left or right lists.
	 * 
	 * @param items
	 *            Objects (with id's, names, descriptions) to put in the list.
	 * @return A list of DefaultNodeData nodes
	 */
	private ArrayList makeSkillAssignmentNodeList(Collection items) {
<span class="nc" id="L2344">		ArrayList nodes = new ArrayList(10);</span>
<span class="nc bnc" id="L2345" title="All 2 branches missed.">		if (items != null) {</span>
<span class="nc bnc" id="L2346" title="All 2 branches missed.">			if (items.size() &gt; 0) {</span>
<span class="nc" id="L2347">				nodes = new ArrayList(items.size());</span>
<span class="nc bnc" id="L2348" title="All 2 branches missed.">				for (Iterator it = items.iterator(); it.hasNext();) {</span>
<span class="nc" id="L2349">					Skill skill = (Skill) it.next();</span>

<span class="nc" id="L2351">					ID skillSID = skill.getFieldValueID(SkillFieldInfo.SKILL_SID);</span>
<span class="nc bnc" id="L2352" title="All 2 branches missed.">					if (skillSID == null)</span>
<span class="nc" id="L2353">						skillSID = skill.getID();</span>

<span class="nc" id="L2355">					DefaultNodeData node = new DefaultNodeData(skillSID.toString(), skill.getName(),</span>
<span class="nc" id="L2356">							StringUtil.convertEmptyStringToNBSP(skill.getDescription()));</span>
<span class="nc" id="L2357">					nodes.add(node);</span>
<span class="nc" id="L2358">				}</span>
			}
		}
<span class="nc" id="L2361">		return nodes;</span>
	}

	/**
	 * Determine whether current user is a supervisor. We need this information
	 * in order to determine which content title to show.
	 */
	private void setIsSupervisor() {
<span class="nc" id="L2369">		m_isSupervisor = false;</span>
		try {
<span class="nc" id="L2371">			m_isSupervisor = BidOptionsFilterUtil.isSupervisor(m_context);</span>
<span class="nc" id="L2372">		} catch (Exception ex) {</span>
<span class="nc" id="L2373">			handleUnableToLoadDataError(log, ex);</span>
<span class="nc" id="L2374">		}</span>
<span class="nc" id="L2375">	}</span>

	/**
	 * Get the list of StringsPair options for a dropdown selector.
	 * 
	 * @param idStringPairs
	 *            A collection of IDStringPair's to be converted to
	 *            StringsPair's.
	 * @return the list of StringsPair options for the Template Name dropdown
	 *         selector.
	 */
	private List getStringsPairDDOptions(Collection idStringPairs, String anyLabel) {
<span class="nc" id="L2387">		ArrayList list = new ArrayList(20);</span>
<span class="nc" id="L2388">		list.add(new StringsPair(UNDEFINED_FV, anyLabel));</span>

<span class="nc bnc" id="L2390" title="All 2 branches missed.">		for (Iterator it = idStringPairs.iterator(); it.hasNext();) {</span>
<span class="nc" id="L2391">			IDStringPair idStringPair = (IDStringPair) it.next();</span>
<span class="nc" id="L2392">			list.add(new StringsPair(idStringPair.getID().toString(), idStringPair.getString()));</span>
<span class="nc" id="L2393">		}</span>
<span class="nc" id="L2394">		return list;</span>
	}

	/**
	 * Get the list of StringsPair options for the Activity Name dropdown
	 * selector.
	 * 
	 * @return the list of StringsPair options for the Activity Name dropdown
	 *         selector.
	 */
	private List getActivityDDOptions() {
<span class="nc" id="L2405">		String anyLabel = i18n(m_rmBundle, RmWebBundleKey.RM_SA_FILTER_ANY_ACTIVITY);</span>
<span class="nc" id="L2406">		ArrayList list = new ArrayList(20);</span>
<span class="nc" id="L2407">		list.add(new StringsPair(UNDEFINED_FV, anyLabel));</span>
<span class="nc bnc" id="L2408" title="All 2 branches missed.">		for (Iterator it = m_activities.iterator(); it.hasNext();) {</span>
<span class="nc" id="L2409">			Activity activity = (Activity) it.next();</span>
<span class="nc" id="L2410">			list.add(new StringsPair(activity.getID().toString(), activity.getName()));</span>
<span class="nc" id="L2411">		}</span>
<span class="nc" id="L2412">		return list;</span>
	}

	/**
	 * Get the list of skills
	 */
	private ArrayList getAvailableSkillsList() {
<span class="nc bnc" id="L2419" title="All 2 branches missed.">		if (m_skills != null)</span>
<span class="nc" id="L2420">			return new ArrayList(m_skills);</span>
<span class="nc" id="L2421">		return new ArrayList(0);</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>