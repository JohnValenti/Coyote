<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>MonthlyMinMaxHoursEmployeeAssignmentPM.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.verint.web.fs.workrules.assignment.monthly</a> &gt; <span class="el_source">MonthlyMinMaxHoursEmployeeAssignmentPM.java</span></div><h1>MonthlyMinMaxHoursEmployeeAssignmentPM.java</h1><pre class="source lang-java linenums">package com.verint.web.fs.workrules.assignment.monthly;

import com.bluepumpkin.common.datatypes.Duration;
import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.ScopeID;
import com.bluepumpkin.common.datatypes.StringsPair;
import com.bluepumpkin.common.localization.Localizer;
import com.bluepumpkin.common.util.StringUtil;
import com.bluepumpkin.common.util.TimeZoneUtil;
import com.bluepumpkin.ejb.bbm.empworkrule.ejb.EmpWorkRuleManager;
import com.bluepumpkin.ejb.bbm.empworkrule.model.WorkResourceMonthlyMinMaxHour;
import com.bluepumpkin.ejb.bbm.schedule.util.ScheduleUtil;
import com.bluepumpkin.ejb.bbm.workresource.model.Employee;
import com.bluepumpkin.web.bbm.employee.EmployeeModelHandler;
import com.bluepumpkin.web.fs.l10n.FsWebBundleKey;
import com.verint.ejb.wfm.WfmManagerFactory;
import com.witness.ejb.core.security.PrivilegeKeys;
import com.witness.ejb.core.security.Scope;
import com.witness.web.uif.keys.PageAction;
import com.witness.web.uif.l10n.UIFWebBundleKey;
import com.witness.web.uif.pagecomponent.DefaultMultiColumnNodeData;
import com.witness.web.uif.pagecomponent.MultiColumnNodeData;
import com.witness.web.uif.pagecomponent.list.MultiColListPC;
import com.witness.web.uif.pagecomponent.picker.time.DurationSpinnerPC;
import com.witness.web.uif.pagemodel.PageModel;
import com.witness.web.uif.pagemodel.WorkpaneFormPM;
import com.witness.web.uif.system.RequestContext;
import com.witness.web.uif.util.HtmlUtil;

import javax.servlet.http.HttpServletRequest;

import java.util.*;


public class MonthlyMinMaxHoursEmployeeAssignmentPM extends WorkpaneFormPM {

<span class="fc" id="L37">	private static String MIN_HOURS_PC_NAME_PREFIX = &quot;minhoursPC_&quot;;</span>
<span class="fc" id="L38">	private static String MAX_HOURS_PC_NAME_PREFIX = &quot;maxhoursPC_&quot;;</span>
<span class="fc" id="L39">	private static String SELECTED_YEAR_DROPDOWN_FN = &quot;selectedYearDropdown&quot;;</span>
	public static final String DROPDOWN_ON_CHANGE_SCRIPT =
			&quot;pageMediator.refreshPageWithAction('&quot; + PageAction.FORCE_REFRESH + &quot;', true);&quot;;

	private Map&lt;ID, List&lt;WorkResourceMonthlyMinMaxHour&gt;&gt; minMaxHourAssignments;
	private MultiColListPC assignmentTable;
<span class="nc" id="L45">	private List&lt;DurationSpinnerPC&gt; minHoursDurationSpinners = new ArrayList&lt;DurationSpinnerPC&gt;();</span>
<span class="nc" id="L46">	private List&lt;DurationSpinnerPC&gt; maxHoursDurationSpinners = new ArrayList&lt;DurationSpinnerPC&gt;();</span>
	private Map&lt;ID, Employee&gt; selectedEmployees;
	private int selectedYear;

	public MonthlyMinMaxHoursEmployeeAssignmentPM(RequestContext context) {
<span class="nc" id="L51">		super(context, PageModel.FRAMED_MODEL);</span>

<span class="nc" id="L53">		assignmentTable = new MultiColListPC(m_context, false);</span>
<span class="nc" id="L54">		assignmentTable.setName(&quot;MonthlyAssignmentTable&quot;);</span>
<span class="nc" id="L55">		assignmentTable.setIsBorderEnabled(false);</span>
<span class="nc" id="L56">		assignmentTable.setRowSelectable(false);</span>
<span class="nc" id="L57">		initializeTableHeader(assignmentTable);</span>
<span class="nc" id="L58">		addChildComponent(assignmentTable);</span>

<span class="nc" id="L60">		minHoursDurationSpinners = createDurationSpinners(m_context, true);</span>
<span class="nc" id="L61">		maxHoursDurationSpinners = createDurationSpinners(m_context, false);</span>
<span class="nc" id="L62">		initializeDurationSpinners();</span>

<span class="nc" id="L64">		selectedYear = getCurrentYear();</span>
<span class="nc" id="L65">	}</span>

	public static MonthlyMinMaxHoursEmployeeAssignmentPM getInstance(RequestContext context) {
<span class="nc" id="L68">		return (MonthlyMinMaxHoursEmployeeAssignmentPM) PageModel.getInstance(context, MonthlyMinMaxHoursEmployeeAssignmentPM.class);</span>
	}

	@Override
	protected void initContentTitle() {
<span class="nc" id="L73">		super.initContentTitle();</span>
<span class="nc" id="L74">		m_contentTitlePC.setPageTitle(m_localizer.i18n(FsWebBundleKey.BUNDLE_NAME, FsWebBundleKey.MONTHLY_HOURS_ASSIGNMENT));</span>
<span class="nc bnc" id="L75" title="All 2 branches missed.">		if (selectedEmployees.size() &gt; 1) {</span>
<span class="nc" id="L76">			m_contentTitlePC.setItemName(m_localizer.i18n(FsWebBundleKey.BUNDLE_NAME, FsWebBundleKey.N_PEOPLE,</span>
<span class="nc" id="L77">					selectedEmployees.size()));</span>
<span class="nc bnc" id="L78" title="All 2 branches missed.">		} else if (selectedEmployees.size() == 1) {</span>
<span class="nc" id="L79">			m_contentTitlePC.setItemName(selectedEmployees.values().iterator().next().getEmployeeName());</span>
		}

<span class="nc" id="L82">		m_contentTitlePC.setActiveComponent(m_localizer.i18n(FsWebBundleKey.BUNDLE_NAME, FsWebBundleKey.YEAR),</span>
<span class="nc" id="L83">				getYearElement(DROPDOWN_ON_CHANGE_SCRIPT));</span>
<span class="nc" id="L84">	}</span>

	@Override
	protected void initForm() {
		try {
<span class="nc" id="L89">			assignmentTable.setListModel(generateListData(minMaxHourAssignments, minHoursDurationSpinners,</span>
					maxHoursDurationSpinners, m_localizer));
<span class="nc" id="L91">			setForm(assignmentTable);</span>

<span class="nc" id="L93">		} catch (Exception ex) {</span>
<span class="nc" id="L94">			handleUnableToLoadDataError(log, ex);</span>
<span class="nc" id="L95">		}</span>
<span class="nc" id="L96">	}</span>

	/**
	 * Creates a list of MultiColumnNodeData objects, with each object containing the following:
	 * A localized month name, a DurationSpinnerPC representing the min monthly hours for that month,
	 * and a DurationSpinnerPC representing the max monthly hours for that month.  MultiEdit indicators
	 * are set on the duration spinner PC components that have differing values for the selected employees.
	 */
	static List&lt;MultiColumnNodeData&gt; generateListData(Map&lt;ID, List&lt;WorkResourceMonthlyMinMaxHour&gt;&gt; minMaxHourAssignments,
			List&lt;DurationSpinnerPC&gt; minHoursDurationSpinners, List&lt;DurationSpinnerPC&gt; maxHoursDurationSpinners,
			Localizer localizer) {
<span class="nc" id="L107">		List&lt;MultiColumnNodeData&gt; listData = new ArrayList&lt;MultiColumnNodeData&gt;();</span>

<span class="nc" id="L109">		boolean firstRun = true;</span>
<span class="nc bnc" id="L110" title="All 2 branches missed.">		for (List&lt;WorkResourceMonthlyMinMaxHour&gt; hoursForYear : minMaxHourAssignments.values()) {</span>
<span class="nc bnc" id="L111" title="All 2 branches missed.">			for (WorkResourceMonthlyMinMaxHour monthlyHours : hoursForYear) {</span>
<span class="nc" id="L112">				DefaultMultiColumnNodeData row = new DefaultMultiColumnNodeData();</span>
<span class="nc" id="L113">				int calendarMonth = monthlyHours.getCalendarMonth();</span>

<span class="nc" id="L115">				row.add(getLocalizedMonthString(localizer, calendarMonth));</span>

<span class="nc" id="L117">				DurationSpinnerPC minHoursSpinnerPC = minHoursDurationSpinners.get(calendarMonth);</span>
<span class="nc" id="L118">				DurationSpinnerPC maxHoursSpinnerPC = maxHoursDurationSpinners.get(calendarMonth);</span>

<span class="nc bnc" id="L120" title="All 2 branches missed.">				if (firstRun) {</span>
<span class="nc" id="L121">					minHoursSpinnerPC.setValue(Duration.fromMinutes(monthlyHours.getMinMinutes()));</span>
<span class="nc" id="L122">					maxHoursSpinnerPC.setValue(Duration.fromMinutes(monthlyHours.getMaxMinutes()));</span>
<span class="nc" id="L123">					row.add(minHoursSpinnerPC);</span>
<span class="nc" id="L124">					row.add(maxHoursSpinnerPC);</span>
<span class="nc" id="L125">					listData.add(row);</span>

				} else {
<span class="nc bnc" id="L128" title="All 2 branches missed.">					if (minHoursSpinnerPC.getDuration().getDurationInMinutes() != monthlyHours.getMinMinutes()) {</span>
<span class="nc" id="L129">						minHoursSpinnerPC.setMultiEdit(true);</span>
					}
<span class="nc bnc" id="L131" title="All 2 branches missed.">					if (maxHoursSpinnerPC.getDuration().getDurationInMinutes() != monthlyHours.getMaxMinutes()) {</span>
<span class="nc" id="L132">						maxHoursSpinnerPC.setMultiEdit(true);</span>
					}
				}
<span class="nc" id="L135">			}</span>
<span class="nc" id="L136">			firstRun = false;</span>
<span class="nc" id="L137">		}</span>

<span class="nc" id="L139">		return listData;</span>
	}

	@Override
	protected void loadData() throws Exception {
<span class="nc bnc" id="L144" title="All 2 branches missed.">		if (getSelectedIDSize() &gt; 0) {</span>
<span class="nc" id="L145">			Collection&lt;ID&gt; employeeIDs = getSelectedIDsAsCollection();</span>
<span class="nc" id="L146">			EmpWorkRuleManager ewrm = WfmManagerFactory.getEmpWorkRuleManager(m_context.isInWhatIfMode());</span>
<span class="nc" id="L147">			minMaxHourAssignments = ewrm.getMonthlyMinMaxHourAssignments(employeeIDs, selectedYear);</span>

			//For all employees that don't yet have hours records for the current year, initialize a new, blank
			//set of records for that employee/year.
<span class="nc bnc" id="L151" title="All 2 branches missed.">			for (ID employeeID : employeeIDs) {</span>
<span class="nc bnc" id="L152" title="All 2 branches missed.">				if (!minMaxHourAssignments.containsKey(employeeID)) {</span>
<span class="nc" id="L153">					minMaxHourAssignments.put(employeeID, initializeEmptyRecordSet(employeeID, selectedYear));</span>
				}
<span class="nc" id="L155">			}</span>
<span class="nc" id="L156">			selectedEmployees = EmployeeModelHandler.getEmployeeMap(m_context, employeeIDs, null);</span>
		}
<span class="nc" id="L158">	}</span>

	/**
	 * Returns the localized value for the full calendar month, where calendarMonth
	 * represents the month of the year starting at 0 = January.
	 */
	private static String getLocalizedMonthString(Localizer localizer, int calendarMonth) {
<span class="nc" id="L165">		return localizer.getMonthNames(true)[calendarMonth];</span>
	}

	private static DurationSpinnerPC createSpinnerComponent(RequestContext context, boolean isMinHours, int month) {
<span class="nc" id="L169">		DurationSpinnerPC spinnerPC = new DurationSpinnerPC(context, getSpinnerName(isMinHours, month));</span>
<span class="nc" id="L170">		return spinnerPC;</span>
	}

	/**
	 * Uses a Calendar object to return the exact number of hours in any month of any year.
	 * @param month - the month (ex: Calendar.FREBRUARY == 1)
	 * @param year - the year (ex: 2015)
	 * @return - the number of hours in that month (Ex: Feb 1, 2000 was a leap year with 29 days,
	 * 			so we would return 29*24 = 696.
	 */
	public static int getNumHoursInMonth(int month, int year) {
<span class="nc" id="L181">		Calendar cal = Calendar.getInstance(TimeZoneUtil.GMT_TIMEZONE);</span>
<span class="nc" id="L182">		cal.set(Calendar.YEAR, year);</span>
<span class="nc" id="L183">		cal.set(Calendar.MONTH, month);</span>
<span class="nc" id="L184">		cal.set(Calendar.DATE, 1);</span>
<span class="nc" id="L185">		int daysInMonth = cal.getActualMaximum(Calendar.DAY_OF_MONTH);</span>
<span class="nc" id="L186">		int maxNumHoursThisMonth = ScheduleUtil.HOURS_IN_DAY * daysInMonth;</span>
<span class="nc" id="L187">		return maxNumHoursThisMonth;</span>
	}

	private static String getSpinnerName(boolean isMinHours, int month) {
<span class="nc bnc" id="L191" title="All 2 branches missed.">		return isMinHours ? MIN_HOURS_PC_NAME_PREFIX + month : MAX_HOURS_PC_NAME_PREFIX + month;</span>
	}

	/**
	 * Get a drop down selector containing a range of -15 to +15 years from the current selected year.
	 */
	public String getYearElement(String onChangeJS) {
<span class="nc" id="L198">		return getYearDropDown(SELECTED_YEAR_DROPDOWN_FN, selectedYear, onChangeJS);</span>
	}

	/**
	 * Return the Year drop down
	 */
	public static String getYearDropDown(String name, int selectedYear, String onChangeJS) {
		// Create the Collection of Option Data
<span class="nc" id="L206">		List&lt;StringsPair&gt; options = new ArrayList&lt;StringsPair&gt;(31);</span>
<span class="nc bnc" id="L207" title="All 2 branches missed.">		for (int i = selectedYear - 15; i &lt;= selectedYear + 15; i++) {</span>
<span class="nc" id="L208">			StringsPair option = new StringsPair(Integer.toString(i), Integer.toString(i));</span>
<span class="nc" id="L209">			options.add(option);</span>
		}
<span class="nc" id="L211">		String selectedYearStr = Integer.toString(selectedYear);</span>
<span class="nc" id="L212">		return HtmlUtil.makeSelectInput(name, selectedYearStr, onChangeJS, options);</span>
	}

	/**
	 * Creates a WorkResourceMonthlyMinMaxHour record for each month of the given year for the given
	 * employee, initialized to 0 min/max minutes.
	 */
	static List&lt;WorkResourceMonthlyMinMaxHour&gt; initializeEmptyRecordSet(ID employeeID, int selectedYear) {
<span class="nc" id="L220">		List&lt;WorkResourceMonthlyMinMaxHour&gt; retVal = new ArrayList&lt;WorkResourceMonthlyMinMaxHour&gt;();</span>
<span class="nc bnc" id="L221" title="All 2 branches missed.">		for (int i = 0; i &lt; 12; i++) {</span>
<span class="nc" id="L222">			WorkResourceMonthlyMinMaxHour record = new WorkResourceMonthlyMinMaxHour();</span>
<span class="nc" id="L223">			record.setCalendarMonth(i);</span>
<span class="nc" id="L224">			record.setYear(selectedYear);</span>
<span class="nc" id="L225">			record.setMinMinutes(0);</span>
<span class="nc" id="L226">			record.setMaxMinutes(0);</span>
<span class="nc" id="L227">			record.setWorkResourceID(employeeID);</span>
<span class="nc" id="L228">			retVal.add(record);</span>
		}
<span class="nc" id="L230">		return retVal;</span>
	}

	@Override
	public boolean extractParameters(HttpServletRequest request) {
<span class="nc" id="L235">		boolean valid = super.extractParameters(request);</span>

<span class="nc" id="L237">		String selectedYearStr = request.getParameter(SELECTED_YEAR_DROPDOWN_FN);</span>
<span class="nc bnc" id="L238" title="All 2 branches missed.">		if (!StringUtil.isEmptyOrWhiteSpace(selectedYearStr)) {</span>
<span class="nc" id="L239">			selectedYear = Integer.parseInt(selectedYearStr);</span>
		} else {
			//selectedYearDropdown was not submitted in the form. Get from session.
			//If not in session, just leave it as-is (the current year).
<span class="nc" id="L243">			Integer year = (Integer) m_context.getAttribute(RequestContext.SESSION_SCOPE, SELECTED_YEAR_DROPDOWN_FN);</span>
<span class="nc bnc" id="L244" title="All 2 branches missed.">			if (year != null) {</span>
<span class="nc" id="L245">				selectedYear = year.intValue();</span>
			}
		}

		//add selected year to the session
<span class="nc bnc" id="L250" title="All 2 branches missed.">		if (selectedYear &gt; 0) {</span>
<span class="nc" id="L251">			m_context.setAttribute(RequestContext.SESSION_SCOPE, SELECTED_YEAR_DROPDOWN_FN, Integer.valueOf(selectedYear));</span>
		}
		
		//We need selectedYear in order to set the min and max allowable values in the min/max spinners.
<span class="nc" id="L255">		setDurationSpinnerLimitsPerMonth();</span>

<span class="nc" id="L257">		return valid;</span>
	}

	private void initializeTableHeader(MultiColListPC assignmentTable) {
<span class="nc" id="L261">		assignmentTable.getHeader().addColumnHeaderData(&quot;Month_Header&quot;, m_localizer.i18n(FsWebBundleKey.BUNDLE_NAME,</span>
				FsWebBundleKey.MONTH), false);
<span class="nc" id="L263">		assignmentTable.getHeader().addColumnHeaderData(&quot;MinimumMonthlyHours_Header&quot;,</span>
<span class="nc" id="L264">				m_localizer.i18n(FsWebBundleKey.BUNDLE_NAME, FsWebBundleKey.MINIMUM_MONTHLY_HOURS), false);</span>
<span class="nc" id="L265">		assignmentTable.getHeader().addColumnHeaderData(&quot;MaximumMonthlyHours_Header&quot;,</span>
<span class="nc" id="L266">				m_localizer.i18n(FsWebBundleKey.BUNDLE_NAME, FsWebBundleKey.MAXIMUM_MONTHLY_HOURS), false);</span>
<span class="nc" id="L267">	}</span>

	static List&lt;DurationSpinnerPC&gt; createDurationSpinners(RequestContext context, boolean isMinHours) {
<span class="nc" id="L270">		List&lt;DurationSpinnerPC&gt; durationSpinners = new ArrayList&lt;DurationSpinnerPC&gt;();</span>
<span class="nc bnc" id="L271" title="All 2 branches missed.">		for (int calendarMonth = 0; calendarMonth &lt; 12; calendarMonth++) {</span>
<span class="nc" id="L272">			durationSpinners.add(createSpinnerComponent(context, isMinHours, calendarMonth));</span>
		}

<span class="nc" id="L275">		return durationSpinners;</span>
	}

	/**
	 * Initialize the min and max allowable values in the min/max spinners. We take Year and Month into 
	 * account.
	 */
	public void setDurationSpinnerLimitsPerMonth() {
<span class="nc" id="L283">		int month = 0;</span>
<span class="nc bnc" id="L284" title="All 2 branches missed.">		for (DurationSpinnerPC spinner : minHoursDurationSpinners) {</span>
<span class="nc" id="L285">			int maxNumHoursThisMonth = getNumHoursInMonth(month, selectedYear);</span>
<span class="nc" id="L286">			spinner.setMinTime(0, 0, 0);</span>
<span class="nc" id="L287">			spinner.setMaxTime(maxNumHoursThisMonth, 0, 0);</span>
<span class="nc" id="L288">			spinner.setAsMinimumValueSpinner(getSpinnerName(false, month),</span>
<span class="nc" id="L289">					Duration.fromMinutes(maxNumHoursThisMonth * ScheduleUtil.MINUTES_IN_HOUR));</span>
<span class="nc" id="L290">			month++;</span>
<span class="nc" id="L291">		}</span>
<span class="nc" id="L292">		month = 0;</span>
<span class="nc bnc" id="L293" title="All 2 branches missed.">		for (DurationSpinnerPC spinner : maxHoursDurationSpinners) {</span>
<span class="nc" id="L294">			int maxNumHoursThisMonth = getNumHoursInMonth(month, selectedYear);</span>
<span class="nc" id="L295">			spinner.setMinTime(0, 0, 0);</span>
<span class="nc" id="L296">			spinner.setMaxTime(maxNumHoursThisMonth, 0, 0);</span>
<span class="nc" id="L297">			spinner.setAsMaximumValueSpinner(getSpinnerName(true, month),</span>
<span class="nc" id="L298">					Duration.fromMinutes(maxNumHoursThisMonth * ScheduleUtil.MINUTES_IN_HOUR));</span>
<span class="nc" id="L299">			month++;</span>
<span class="nc" id="L300">		}</span>
<span class="nc" id="L301">	}</span>

	private void initializeDurationSpinners() {
<span class="nc bnc" id="L304" title="All 2 branches missed.">		for (DurationSpinnerPC minHoursSpinner : minHoursDurationSpinners) {</span>
<span class="nc" id="L305">			this.addChildComponent(minHoursSpinner);</span>
<span class="nc" id="L306">		}</span>
<span class="nc bnc" id="L307" title="All 2 branches missed.">		for (DurationSpinnerPC maxHoursSpinner : maxHoursDurationSpinners) {</span>
<span class="nc" id="L308">			this.addChildComponent(maxHoursSpinner);</span>
<span class="nc" id="L309">		}</span>
<span class="nc" id="L310">	}</span>

	@Override
	protected void initToolbar() {
<span class="nc" id="L314">		m_toolbar.addValidateSubmitTextButton(PageAction.SAVE,</span>
<span class="nc" id="L315">				i18n(m_common_bundle, UIFWebBundleKey.TOOLBAR_SAVE), hasPermsToEdit());</span>
<span class="nc" id="L316">		m_toolbar.addResetTextButton(PageAction.RESET,</span>
<span class="nc" id="L317">				i18n(m_common_bundle, UIFWebBundleKey.TOOLBAR_RESET), hasPermsToEdit());</span>
<span class="nc" id="L318">	}</span>

	/**
	 * Returns a list of WorkResourceMonthlyMinMaxHour value objects that are populated with the values
	 * in the page components that were entered by the user.
	 */
	public Map&lt;ID, List&lt;WorkResourceMonthlyMinMaxHour&gt;&gt; getMonthlyMinMaxHourAssignments() {
<span class="nc bnc" id="L325" title="All 2 branches missed.">		for (ID employeeID : minMaxHourAssignments.keySet()) {</span>
<span class="nc" id="L326">			List&lt;WorkResourceMonthlyMinMaxHour&gt; employeeHours = minMaxHourAssignments.get(employeeID);</span>
<span class="nc bnc" id="L327" title="All 2 branches missed.">			for (int month = 0; month &lt; 12; month++) {</span>
<span class="nc" id="L328">				WorkResourceMonthlyMinMaxHour monthlyHours = employeeHours.get(month);</span>
<span class="nc bnc" id="L329" title="All 4 branches missed.">				if (minHoursDurationSpinners.get(month).isEdited() || monthlyHours.isNewRecord()) {</span>
<span class="nc" id="L330">					monthlyHours.setMinMinutes(minHoursDurationSpinners.get(month).getDuration().getDurationInMinutes());</span>
				}
<span class="nc bnc" id="L332" title="All 4 branches missed.">				if (maxHoursDurationSpinners.get(month).isEdited() || monthlyHours.isNewRecord()) {</span>
<span class="nc" id="L333">					monthlyHours.setMaxMinutes(maxHoursDurationSpinners.get(month).getDuration().getDurationInMinutes());</span>
				}
			}
<span class="nc" id="L336">		}</span>

<span class="nc" id="L338">		return minMaxHourAssignments;</span>
	}

	private int getCurrentYear() {
<span class="nc" id="L342">		Calendar cal = Calendar.getInstance(TimeZoneUtil.GMT_TIMEZONE);</span>
<span class="nc" id="L343">		cal.setTime(new Date());</span>
<span class="nc" id="L344">		return cal.get(Calendar.YEAR);</span>
	}

	/**
	 * Returns true if the current user has permissions to edit hours for ALL of the selected
	 * employees.
	 */
	private boolean hasPermsToEdit() {
<span class="nc bnc" id="L352" title="All 4 branches missed.">		if (selectedEmployees == null || selectedEmployees.isEmpty()) {</span>
<span class="nc" id="L353">			return false;</span>
		}

<span class="nc bnc" id="L356" title="All 2 branches missed.">		for (Employee emp : selectedEmployees.values()) {</span>
<span class="nc" id="L357">			ScopeID scopeID = new ScopeID(emp.getOrganizationID(), Scope.ORG_SCOPE);</span>
<span class="nc bnc" id="L358" title="All 2 branches missed.">			if (!m_context.getUser().isAuthorized(PrivilegeKeys.CORE_MODIFYPEOPLE, scopeID)) {</span>
<span class="nc" id="L359">				return false;</span>
			}
<span class="nc" id="L361">		}</span>

<span class="nc" id="L363">		return true;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>