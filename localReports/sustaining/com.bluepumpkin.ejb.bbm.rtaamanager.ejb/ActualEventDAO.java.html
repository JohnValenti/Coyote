<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>ActualEventDAO.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.ejb.bbm.rtaamanager.ejb</a> &gt; <span class="el_source">ActualEventDAO.java</span></div><h1>ActualEventDAO.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.ejb.bbm.rtaamanager.ejb;

import java.sql.Timestamp;
import java.sql.Types;
import java.util.ArrayList;
import java.util.Collection;
import java.util.Collections;
import java.util.Date;
import java.util.HashMap;
import java.util.HashSet;
import java.util.Iterator;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.jdmo.Jdmo;
import com.bluepumpkin.common.jdmo.JdmoException;
import com.bluepumpkin.common.jdmo.JdmoPKGenerator;
import com.bluepumpkin.common.jdmo.JdmoPKGeneratorFactory;
import com.bluepumpkin.common.jdmo.JdmoUtil;
import com.bluepumpkin.ejb.bbm.rtaamanager.model.ActualEvent;
import com.bluepumpkin.ejb.bbm.rtaamanager.model.ActualEventFieldInfo;
import com.bluepumpkin.ejb.bbm.rtaamanager.model.AdherenceException;
import com.bluepumpkin.ejb.bbm.rtaamanager.model.OrganizationDay;
import com.bluepumpkin.ejb.bbm.rtaamanager.model.UniqueEventID;
import com.bluepumpkin.ejb.bbm.rtaamanager.model.ActualEvent.UniqueKey;
import com.bluepumpkin.ejb.bbm.activity.model.Activity;
import com.bluepumpkin.ejb.bbm.activity.model.Event;
import com.bluepumpkin.ejb.bbm.dao.DAOBase;
import com.bluepumpkin.ejb.bbm.schedule.ejb.ScheduleDAOUtil;
import com.bluepumpkin.ejb.bbm.vo.FieldInfo;
import com.bluepumpkin.ejb.bbm.vo.ValueObjectBase;
import com.bluepumpkin.ejb.bbm.vo.ValueObjectUtil;

public class ActualEventDAO extends DAOBase {

<span class="nc" id="L35">	private static FieldInfo m_fieldInfo = new ActualEventFieldInfo();</span>
	//private static JdmoPKGenerator primaryKeyGenerator = JdmoPKGeneratorFactory.create(m_fieldInfo.getTableName(), false);
	
	protected FieldInfo getFieldInfo() {
<span class="nc" id="L39">		return m_fieldInfo;</span>
	}
	
	public ActualEventDAO(Jdmo dmo) {
<span class="nc" id="L43">		super(dmo);</span>
<span class="nc" id="L44">	}</span>

	protected ValueObjectBase createValueObject() {
<span class="nc" id="L47">		return new ActualEvent();</span>
	}

	public HashMap updateActualEventsTimeline (
			Collection colEmployeeIDs,
			Collection colActualEvents,
			HashMap hmParentEvents,
			HashMap orgDaysPerWKRS,
			HashMap spDaysPerWKRS,
			HashMap exceptionPerWKRS,
			Timestamp tsStart,
			Timestamp tsEnd,
			boolean bAdhocDumpEnabled)
			throws Exception {
			try {
<span class="nc" id="L62">				String inClause = m_dmo.createInClause(colEmployeeIDs);</span>
<span class="nc" id="L63">				Collection actualEvents = ScheduleDAOUtil.groupEventsByWorkResources(colActualEvents, colEmployeeIDs);</span>
				
				//get left overlaps
<span class="nc" id="L66">				String startDBString = &quot;'&quot; + JdmoUtil.formatDBString(tsStart,false) + &quot;'&quot;;</span>
<span class="nc" id="L67">				String endDBString = &quot;'&quot; + JdmoUtil.formatDBString(tsEnd,true) + &quot;'&quot;;</span>
<span class="nc" id="L68">				StringBuffer strSQL = new StringBuffer();</span>
<span class="nc" id="L69">				strSQL.append(&quot; EMPLOYEEID in &quot;).append(inClause);</span>
<span class="nc" id="L70">				strSQL.append(&quot; and STARTTIME &lt; &quot;).append(startDBString);</span>
<span class="nc" id="L71">				strSQL.append(&quot; and ENDTIME &gt; &quot;).append(startDBString);				</span>
<span class="nc" id="L72">				HashMap leftOverlaps = ValueObjectUtil.groupByField(ActualEventFieldInfo.ACTUALEVENT_EMPLOYEEID, getObjects(strSQL.toString()));</span>
				
				//get right overlaps
<span class="nc" id="L75">				strSQL = new StringBuffer();</span>
<span class="nc" id="L76">				strSQL.append(&quot; EMPLOYEEID in &quot;).append(inClause);</span>
<span class="nc" id="L77">				strSQL.append(&quot; and STARTTIME &lt; &quot;).append(endDBString);</span>
<span class="nc" id="L78">				strSQL.append(&quot; and ENDTIME &gt; &quot;).append(endDBString);</span>
<span class="nc" id="L79">				HashMap rightOverlaps = ValueObjectUtil.groupByField(ActualEventFieldInfo.ACTUALEVENT_EMPLOYEEID, getObjects(strSQL.toString()));</span>
				
<span class="nc" id="L81">				ActualEvent leftOverlap = null;</span>
<span class="nc" id="L82">				ActualEvent rightOverlap = null;</span>
<span class="nc" id="L83">				ActualEvent firstNewEvent = null;</span>
<span class="nc" id="L84">				ActualEvent lastNewEvent = null;</span>
				
				
<span class="nc" id="L87">				ArrayList insert = new ArrayList();</span>
				//ArrayList update = new ArrayList();
<span class="nc" id="L89">				HashSet delete = new HashSet();</span>
<span class="nc" id="L90">				ArrayList colFieldValues = new ArrayList();</span>
				
				//JdmoPKGenerator primaryKeyGenerator = JdmoPKGeneratorFactory.create(m_fieldInfo.getTableName(), false);
<span class="nc" id="L93">				Iterator iterID = colEmployeeIDs.iterator();</span>
<span class="nc" id="L94">				Iterator itEvents = actualEvents.iterator();</span>
<span class="nc" id="L95">				Collection orgDays = null;</span>
<span class="nc" id="L96">				Collection spDays = null;</span>
<span class="nc" id="L97">				ID exceptionID = null;</span>
<span class="nc" id="L98">				ID orgDayID = null;</span>
<span class="nc" id="L99">				ID spDayID = null;</span>
<span class="nc bnc" id="L100" title="All 2 branches missed.">				for (; itEvents.hasNext();){</span>
<span class="nc" id="L101">					Collection actualEventsPerEmp = (Collection) itEvents.next();</span>
<span class="nc" id="L102">					ID idEmployee = (ID)iterID.next();</span>
<span class="nc bnc" id="L103" title="All 4 branches missed.">					if (actualEventsPerEmp == null || actualEventsPerEmp.isEmpty())</span>
<span class="nc" id="L104">						continue;</span>
<span class="nc" id="L105">					ArrayList newActualEvents = new ArrayList();</span>
<span class="nc bnc" id="L106" title="All 2 branches missed.">					for (Iterator itEvent = actualEventsPerEmp.iterator(); itEvent.hasNext();) {</span>
<span class="nc" id="L107">						Event event = (Event) itEvent.next();</span>
<span class="nc bnc" id="L108" title="All 2 branches missed.">						if (!event.getWorkResourceIDs().iterator().hasNext())</span>
<span class="nc" id="L109">							continue;</span>
						
<span class="nc bnc" id="L111" title="All 2 branches missed.">						if (bAdhocDumpEnabled) {</span>
<span class="nc" id="L112">							orgDays = (Collection)orgDaysPerWKRS.get(idEmployee);</span>
<span class="nc bnc" id="L113" title="All 4 branches missed.">							if (orgDays != null &amp;&amp; !orgDays.isEmpty())</span>
<span class="nc" id="L114">								Collections.sort((ArrayList)orgDays);</span>
<span class="nc" id="L115">							spDays = (Collection)spDaysPerWKRS.get(idEmployee);</span>
<span class="nc bnc" id="L116" title="All 4 branches missed.">							if (spDays != null &amp;&amp; !spDays.isEmpty())</span>
<span class="nc" id="L117">								Collections.sort((ArrayList)spDays);</span>
						}
<span class="nc" id="L119">						Collection exceptionEvents = (Collection)exceptionPerWKRS.get(idEmployee);</span>
						
<span class="nc" id="L121">						ID idParentEvent = event.getParentID();</span>
<span class="nc" id="L122">						Event eventParent = null;</span>
<span class="nc bnc" id="L123" title="All 2 branches missed.">						if (idParentEvent != null)</span>
<span class="nc" id="L124">							eventParent = (Event) hmParentEvents.get(new UniqueEventID(idParentEvent, RTAAUtil.getParentEventType(event)));</span>
<span class="nc" id="L125">						Date dateTimeRecordStart = null;</span>
<span class="nc" id="L126">						Date dateTimeRecordEnd = null;</span>
<span class="nc bnc" id="L127" title="All 2 branches missed.">						if (eventParent != null) {</span>
<span class="nc" id="L128">							dateTimeRecordStart = eventParent.getStartTime();</span>
<span class="nc" id="L129">							dateTimeRecordEnd = eventParent.getEndTime();</span>
						}						

<span class="nc" id="L132">						ID idWorkResource = (ID) event.getWorkResourceIDs().iterator().next();</span>
<span class="nc" id="L133">						ID idActivity = event.getActivityID();</span>
<span class="nc bnc" id="L134" title="All 2 branches missed.">						if (idActivity.compareTo(Activity.ACTIVITY_DELETED) == 0)</span>
<span class="nc" id="L135">							idActivity = Activity.ACTIVITY_NONE;</span>

<span class="nc bnc" id="L137" title="All 2 branches missed.">						if (bAdhocDumpEnabled) {</span>
<span class="nc" id="L138">							exceptionID = findAdherenceExceptionID(event, exceptionEvents);</span>
<span class="nc" id="L139">							orgDayID = findOrgDayID(orgDays, event.getStartTime());</span>
<span class="nc" id="L140">							spDayID = findOrgDayID(spDays, event.getStartTime());</span>
						}
<span class="nc" id="L142">						newActualEvents.add(</span>
								new ActualEvent(
								//primaryKeyGenerator.generate(m_dmo.getConnection(), m_fieldInfo.getTableName()),
								idWorkResource,
								idActivity,
<span class="nc" id="L147">								event.getStartTime(),</span>
<span class="nc" id="L148">								event.getEndTime(),</span>
<span class="nc" id="L149">								event.getPaid(),</span>
								dateTimeRecordStart,
								dateTimeRecordEnd,
								exceptionID,
								orgDayID,
								spDayID));					
<span class="nc" id="L155">					}</span>
<span class="nc bnc" id="L156" title="All 2 branches missed.">					if (newActualEvents.isEmpty())</span>
<span class="nc" id="L157">						continue;</span>
					
<span class="nc" id="L159">					insert.addAll(newActualEvents);</span>
					
					//now for one employee we have leftoverlaps, rightoverlaps and new events.
<span class="nc" id="L162">					leftOverlap = (ActualEvent)RTAAUtil.getOverlap(leftOverlaps, idEmployee);</span>
<span class="nc" id="L163">					rightOverlap = (ActualEvent)RTAAUtil.getOverlap(rightOverlaps, idEmployee);</span>

<span class="nc" id="L165">					Collections.sort(newActualEvents);</span>
<span class="nc" id="L166">					firstNewEvent = (ActualEvent)newActualEvents.get(0);</span>
<span class="nc" id="L167">					lastNewEvent = (ActualEvent)newActualEvents.get(newActualEvents.size()-1);</span>
					
<span class="nc" id="L169">					ActualEvent cloned = null;</span>
					
<span class="nc bnc" id="L171" title="All 10 branches missed.">					if (firstNewEvent != null &amp;&amp; lastNewEvent != null &amp;&amp; firstNewEvent.equals(lastNewEvent) &amp;&amp; </span>
<span class="nc bnc" id="L172" title="All 2 branches missed.">						leftOverlap != null &amp;&amp; rightOverlap != null &amp;&amp; firstNewEvent.isBasicallyEqual(leftOverlap) ) {						</span>
<span class="nc bnc" id="L173" title="All 2 branches missed.">						if (!leftOverlap.equals(rightOverlap)) {</span>
							//update the left overlap event's endtime by delete and recreating
<span class="nc" id="L175">							delete.add(leftOverlap.getUniqueKey());</span>
							//we should use org day id and sp day id of leftoverlap event since it is ealier
<span class="nc" id="L177">							cloned = (ActualEvent)leftOverlap.clone();</span>
							//cloned.setID(getNextKey());
							
<span class="nc" id="L180">							cloned.setEndTime(firstNewEvent.getEndTime());</span>
<span class="nc" id="L181">							insert.add(cloned);</span>
							
							//update the right over lap event's start time by delete and recreate
<span class="nc" id="L184">							delete.add(rightOverlap.getUniqueKey());</span>
<span class="nc" id="L185">							cloned = (ActualEvent)rightOverlap.clone();</span>
							//cloned.setID(getNextKey());
<span class="nc" id="L187">							cloned.setStartTime(lastNewEvent.getEndTime());</span>
<span class="nc" id="L188">							insert.add(cloned);</span>
						} 
						//the newly dumpped event have no change
<span class="nc" id="L191">						insert.remove(firstNewEvent);</span>
<span class="nc" id="L192">						continue;</span>
					}
					
<span class="nc bnc" id="L195" title="All 2 branches missed.">					if (leftOverlap != null) {</span>
<span class="nc bnc" id="L196" title="All 2 branches missed.">						if (leftOverlap.isBasicallyEqual(firstNewEvent)) {</span>
<span class="nc bnc" id="L197" title="All 2 branches missed.">							if (!firstNewEvent.getEndTime().equals(leftOverlap.getEndTime())) {</span>
								//update the left overlap event's endtime by delete and recreating
<span class="nc" id="L199">								delete.add(leftOverlap.getUniqueKey());</span>
								//we should use org day id and sp day id of leftoverlap event since it is ealier
<span class="nc" id="L201">								cloned = (ActualEvent)leftOverlap.clone();</span>
								//cloned.setID(getNextKey());
<span class="nc" id="L203">								cloned.setEndTime(firstNewEvent.getEndTime());</span>
<span class="nc" id="L204">								insert.add(cloned);</span>
							}
<span class="nc" id="L206">							insert.remove(firstNewEvent);</span>
						} else {
							//update the existing event's endtime by delete and recreating
<span class="nc" id="L209">							delete.add(leftOverlap.getUniqueKey());</span>
<span class="nc" id="L210">							cloned = (ActualEvent)leftOverlap.clone();</span>
							//cloned.setID(getNextKey());
							
<span class="nc bnc" id="L213" title="All 4 branches missed.">							if(cloned.getActivityID().equals(firstNewEvent.getActivityID()) &amp;&amp; (cloned.isPaid()== firstNewEvent.isPaid())){</span>
<span class="nc" id="L214">								cloned.setFieldValue(ActualEventFieldInfo.ACTUALEVENT_TIMERECORDENDTIME, firstNewEvent.getTimeRecordEndTime());</span>
<span class="nc" id="L215">								cloned.setEndTime(firstNewEvent.getEndTime());</span>
<span class="nc" id="L216">								insert.remove(firstNewEvent);</span>
							}else{
<span class="nc" id="L218">								cloned.setEndTime(firstNewEvent.getStartTime());</span>
							}
<span class="nc" id="L220">							insert.add(cloned);</span>
						}
					}
					
<span class="nc bnc" id="L224" title="All 2 branches missed.">					if (rightOverlap != null) {</span>
<span class="nc bnc" id="L225" title="All 2 branches missed.">						if (rightOverlap.isBasicallyEqual(lastNewEvent)) {</span>
<span class="nc bnc" id="L226" title="All 2 branches missed.">							if (!lastNewEvent.getStartTime().equals(rightOverlap.getStartTime())) {</span>
								//update the right overlap event's start time by delete and recreating
<span class="nc" id="L228">								delete.add(rightOverlap.getUniqueKey());</span>
								//we should use org day id and sp day id of new created event since it is earlier
<span class="nc" id="L230">								lastNewEvent.setEndTime(rightOverlap.getEndTime());</span>
							} else {
<span class="nc" id="L232">								insert.remove(lastNewEvent);</span>
							}
						} else {
							//update the right over lap event's start time by delete and recreate
<span class="nc" id="L236">							delete.add(rightOverlap.getUniqueKey());</span>
<span class="nc" id="L237">							cloned = (ActualEvent)rightOverlap.clone();</span>
							//cloned.setID(getNextKey());
<span class="nc" id="L239">							cloned.setStartTime(lastNewEvent.getEndTime());</span>
<span class="nc" id="L240">							insert.add(cloned);</span>
						}
					}
<span class="nc" id="L243">				}</span>
				
				//clear out events that fall within window
<span class="nc" id="L246">				StringBuffer strQuery = new StringBuffer(200);</span>
<span class="nc" id="L247">				strQuery.append(&quot;delete from &quot;).append(m_fieldInfo.getTableName());</span>
				/*
				if (m_dmo.isMsSqlDB())
					strQuery.append(&quot; with (rowlock) &quot;);

					*/
<span class="nc" id="L253">				strQuery.append(&quot; where (EMPLOYEEID in &quot;);</span>
<span class="nc" id="L254">				strQuery.append(inClause);				</span>
<span class="nc" id="L255">				strQuery.append(&quot; and STARTTIME &gt;= &quot;);</span>
<span class="nc" id="L256">				strQuery.append(startDBString);</span>
<span class="nc" id="L257">				strQuery.append(&quot; and ENDTIME &lt;= &quot;);</span>
<span class="nc" id="L258">				strQuery.append(endDBString);</span>
<span class="nc" id="L259">				strQuery.append(&quot;)&quot;);</span>
				
<span class="nc" id="L261">                    m_dmo.execute(strQuery.toString());                       </span>
                    
<span class="nc bnc" id="L263" title="All 2 branches missed.">				if (!delete.isEmpty()) {</span>

<span class="nc bnc" id="L265" title="All 2 branches missed.">					for (Iterator it=delete.iterator(); it.hasNext();) {</span>
<span class="nc" id="L266">						UniqueKey uk = (UniqueKey)it.next();	</span>
						//Collections.sort(new ArrayList(delete));
<span class="nc" id="L268">						strQuery = new StringBuffer(200);</span>
<span class="nc" id="L269">						strQuery.append(&quot; delete from &quot;).append(m_fieldInfo.getTableName());</span>
						//strQuery.append(&quot; where id in &quot;).append(m_dmo.createInClause(delete));
<span class="nc" id="L271">						String stStartTime = &quot;'&quot; + JdmoUtil.formatDBString(uk.getStartTime(), true) + &quot;'&quot;;</span>
<span class="nc" id="L272">						String stEndTime = &quot;'&quot; + JdmoUtil.formatDBString(uk.getEndTime(), true) + &quot;'&quot;;						</span>
<span class="nc" id="L273">						strQuery.append(&quot; where EMPLOYEEID=&quot;).append(uk.getEmployeeID())</span>
<span class="nc" id="L274">								.append(&quot; and STARTTIME=&quot;).append(stStartTime)</span>
<span class="nc" id="L275">								.append(&quot; and ENDTIME=&quot;).append(stEndTime);</span>
<span class="nc" id="L276">						m_dmo.addBatch(strQuery.toString());</span>
<span class="nc" id="L277">					}</span>
<span class="nc" id="L278">					m_dmo.executeBatch();</span>
				}
				
				
				/*
				//update
				if (!update.isEmpty()) {
					JdmoPCommand pc = m_dmo.createPCommand(&quot;update &quot;+m_fieldInfo.getTableName()+&quot; with (rowlock) set starttime = ?, endtime = ? where id = ?&quot;);
					HashMap param = new HashMap();
					int ix = 0;
					ActualEvent event = null;
					for (Iterator iter = update.iterator(); iter.hasNext();) {
						event = (ActualEvent)iter.next();
						param.clear();
						param.put(new Integer(1), event.getStartTime());
						param.put(new Integer(2), event.getEndTime());
						param.put(new Integer(3), event.getID());
						m_dmo.addBatchPCommand(pc, param);
					}
					m_dmo.executeBatchPCommand(pc);
				}*/
				
				//insert
<span class="nc" id="L301">				String arrFieldNames[] =</span>
					new String[] {
						//&quot;ID&quot;,
						&quot;EMPLOYEEID&quot;,
						&quot;ACTIVITYID&quot;,
						&quot;STARTTIME&quot;,
						&quot;ENDTIME&quot;,
						&quot;ISPAID&quot;,
						&quot;TIMERECORDSTARTTIME&quot;,
						&quot;TIMERECORDENDTIME&quot;,
						&quot;ADHERENCEEXCEPTIONID&quot;,
						&quot;ORGANIZATIONDAYID&quot;,
						&quot;SPDAYID&quot;};
<span class="nc" id="L314">				int arrFieldTypes[] = { </span>
						//Types.INTEGER, 
						Types.INTEGER,
						Types.INTEGER, 
						Types.TIMESTAMP, 
						Types.TIMESTAMP, 
						Types.BOOLEAN,
						Types.TIMESTAMP, 
						Types.TIMESTAMP,
						Types.INTEGER, 
						Types.INTEGER,
						Types.INTEGER
				};
<span class="nc" id="L327">				ActualEvent event = null;</span>
<span class="nc" id="L328">				Object[] fields = null;</span>
<span class="nc bnc" id="L329" title="All 2 branches missed.">				for (Iterator i = insert.iterator(); i.hasNext(); ) {</span>
<span class="nc" id="L330">					event = (ActualEvent)i.next();</span>
<span class="nc" id="L331">					fields = event.getFieldValues();</span>
<span class="nc bnc" id="L332" title="All 2 branches missed.">					for (int ix = 0; ix &lt; fields.length; ix ++) {</span>
<span class="nc bnc" id="L333" title="All 2 branches missed.">						if (event.isFieldNull(ix))</span>
<span class="nc" id="L334">							fields[ix] = null;</span>
					}									
<span class="nc" id="L336">					colFieldValues.add(event.getFieldValues());			</span>
					
				}
<span class="nc" id="L339">                m_dmo.insertBatchAndExecute(m_fieldInfo.getTableName(), arrFieldNames, arrFieldTypes, colFieldValues);</span>
<span class="nc" id="L340">				return ValueObjectUtil.groupByField(ActualEventFieldInfo.ACTUALEVENT_EMPLOYEEID, insert);</span>

			}finally {
				
<span class="nc" id="L344">				m_dmo.cleanUp();</span>
			}
		}

	private ID findOrgDayID(Collection orgDays, Date timespot) {
<span class="nc bnc" id="L349" title="All 2 branches missed.">		if (orgDays == null)</span>
<span class="nc" id="L350">			return RTAAUtil.ID_0;</span>
<span class="nc" id="L351">		OrganizationDay orgDay = null;</span>
<span class="nc bnc" id="L352" title="All 2 branches missed.">		for (Iterator i = orgDays.iterator(); i.hasNext(); ) {</span>
<span class="nc" id="L353">			orgDay = (OrganizationDay)i.next();</span>
<span class="nc bnc" id="L354" title="All 4 branches missed.">			if ((orgDay.getEndTime() == null || timespot.before(orgDay.getEndTime())&amp;&amp;</span>
<span class="nc bnc" id="L355" title="All 2 branches missed.">				( !timespot.before(orgDay.getStartTime()))))</span>
<span class="nc" id="L356">				return orgDay.getID();</span>
		}
<span class="nc" id="L358">		return RTAAUtil.ID_0;</span>
	}
	
	private ID findAdherenceExceptionID (Event event, Collection exceptions) throws JdmoException {
<span class="nc bnc" id="L362" title="All 4 branches missed.">		if (exceptions == null || exceptions.isEmpty())</span>
<span class="nc" id="L363">			return null;</span>
<span class="nc" id="L364">		AdherenceException exception = null;</span>
<span class="nc bnc" id="L365" title="All 2 branches missed.">		for (Iterator i = exceptions.iterator(); i.hasNext(); ) {</span>
<span class="nc" id="L366">			exception = (AdherenceException)i.next();</span>
<span class="nc bnc" id="L367" title="All 2 branches missed.">			if (event.getStartTime().before(exception.getEndTime()) &amp;&amp;</span>
<span class="nc bnc" id="L368" title="All 2 branches missed.">				event.getEndTime().after(exception.getStartTime()))</span>
<span class="nc" id="L369">				return exception.getID();</span>
		}
<span class="nc" id="L371">		return null;</span>
	}
	
/*	private ID getNextKey() throws Exception {
		return primaryKeyGenerator.generate(m_dmo.getConnection(), m_fieldInfo.getTableName());
	}
*/	
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>