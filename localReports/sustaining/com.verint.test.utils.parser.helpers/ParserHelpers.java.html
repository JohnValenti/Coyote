<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>ParserHelpers.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.verint.test.utils.parser.helpers</a> &gt; <span class="el_source">ParserHelpers.java</span></div><h1>ParserHelpers.java</h1><pre class="source lang-java linenums">package com.verint.test.utils.parser.helpers;

import com.gargoylesoftware.htmlunit.html.*;
import org.apache.commons.lang3.StringUtils;

import java.util.List;
import java.util.function.Predicate;
import java.util.stream.Collectors;

/**
 * Class contain Common helpers methods which often could be used for various screen.
 */
<span class="nc" id="L13">public class ParserHelpers {</span>

	/**
	 * Extract Name from the TH Cells.
	 * We often have situation when name for the record wrapped inside HTML tags like this:
	 * &lt;th&gt;&lt;a&gt;&lt;span&gt;Test Name&lt;/span&gt;&lt;label&gt;&lt;/label&gt;&lt;/a&gt;&lt;/th&gt;
	 */
	public static String extractNameFromHtmlRow(HtmlElement htmlRow) {

		//Search through standard table row
<span class="nc" id="L23">		return htmlRow.getElementsByTagName(HtmlTableHeaderCell.TAG_NAME).stream()</span>
<span class="nc" id="L24">				.flatMap(htmlElement -&gt; htmlElement.getElementsByTagName(HtmlSpan.TAG_NAME).stream())</span>
<span class="nc" id="L25">				.findFirst()</span>
<span class="nc" id="L26">				.map(DomNode::getTextContent)</span>
<span class="nc" id="L27">				.orElse(&quot;&quot;);</span>
	}

	/**
	 * Extract Input Element by provided name from HTML wrappers elements.
	 *
	 * @param element element wrapper
	 * @param name    of the element for which we are looking for.
	 */
	public static HtmlInput getHtmlInputByName(HtmlElement element, final String name) {

<span class="nc" id="L38">		List&lt;HtmlElement&gt; inputs = element.getElementsByTagName(HtmlInput.TAG_NAME);</span>

<span class="nc" id="L40">		HtmlElement input = inputs.stream().</span>
<span class="nc" id="L41">				filter(e -&gt; StringUtils.equals(e.getAttribute(&quot;name&quot;), name))</span>
<span class="nc" id="L42">				.findFirst().orElse(null);</span>

		//if we have null search by ddName attributes
		//some inputs use JS and ddName instead name
<span class="nc bnc" id="L46" title="All 2 branches missed.">		if (null == input) {</span>
<span class="nc" id="L47">			input = inputs.stream()</span>
<span class="nc" id="L48">					.filter(e -&gt; StringUtils.equals(e.getAttribute(&quot;ddName&quot;), name))</span>
<span class="nc" id="L49">					.findFirst().orElse(null);</span>
		}

<span class="nc" id="L52">		return (HtmlInput) input;</span>
	}

	private static HtmlInput getHtmlInputByNameLike(HtmlElement element, final String name) {

<span class="nc" id="L57">		List&lt;HtmlElement&gt; inputs = element.getElementsByTagName(HtmlInput.TAG_NAME);</span>

<span class="nc" id="L59">		HtmlElement input = inputs.stream().</span>
<span class="nc" id="L60">				filter(e -&gt; StringUtils.containsIgnoreCase(e.getAttribute(&quot;name&quot;), name))</span>
<span class="nc" id="L61">				.findFirst().orElse(null);</span>

		//if we have null search by ddName attributes
		//some inputs use JS and ddName instead name
<span class="nc bnc" id="L65" title="All 2 branches missed.">		if (null == input) {</span>
<span class="nc" id="L66">			input = inputs.stream()</span>
<span class="nc" id="L67">					.filter(e -&gt; StringUtils.containsIgnoreCase(e.getAttribute(&quot;ddName&quot;), name))</span>
<span class="nc" id="L68">					.findFirst().orElse(null);</span>
		}

<span class="nc" id="L71">		return (HtmlInput) input;</span>
	}

	/**
	 * This method is for returning page xml string, but sometimes it fails with concurrentModificationException,
	 * that is why method trying to catch any exception and if it appears then method trying again to return xml string,
	 * with recursive call.
	 * If there is some problems after a lot of calls you should get StackOverflowError when recursive stack will be overflowed.
	 *
	 * @param page HtmlUnit HtmlPage object
	 * @return page xml as string.
	 */
	public static String getHtmlPageXmlString(HtmlPage page) {
		try {
<span class="nc" id="L85">			return page.asXml();</span>
<span class="nc" id="L86">		} catch (Exception ex) {</span>
<span class="nc" id="L87">			System.out.println(&quot;Exception on trying tor return page.asXml() it will be repeated&quot;);</span>
<span class="nc" id="L88">			return getHtmlPageXmlString(page);</span>
		}
	}

	public static List&lt;HtmlTableRow&gt; findTableRowsByColumnValue(List&lt;HtmlTableRow&gt; rows, int columnIndex, String searchValue) {
<span class="nc" id="L93">		return findTableRows(rows, row -&gt; row.getCell(columnIndex).getTextContent().equals(searchValue));</span>
	}

	public static List&lt;HtmlTableRow&gt; findTableRows(List&lt;HtmlTableRow&gt; rows, Predicate&lt;HtmlTableRow&gt; rule) {
<span class="nc" id="L97">		return rows.stream().filter(rule).collect(Collectors.toList());</span>
	}

	/**
	 * This method uses a helper to find an HtmlInput element in a given HtmlRow and extracts it's value attribute.
	 *
	 * @return- value attribute of given HtmlInput or an empty String (if input is not found)
	 */
	public static String getHtmlInputValueByName(HtmlElement row, String name) {
<span class="nc" id="L106">		HtmlInput input = ParserHelpers.getHtmlInputByName(row, name);</span>

<span class="nc bnc" id="L108" title="All 2 branches missed.">		if (null != input) {</span>
<span class="nc" id="L109">			return input.getValueAttribute().trim();</span>
		}
<span class="nc" id="L111">		return &quot;&quot;;</span>
	}

	public static String getHtmlInputValueByNameLike(HtmlElement row, String name) {
<span class="nc" id="L115">		HtmlInput input = ParserHelpers.getHtmlInputByNameLike(row, name);</span>

<span class="nc bnc" id="L117" title="All 2 branches missed.">		if (null != input) {</span>
<span class="nc" id="L118">			return input.getValueAttribute().trim();</span>
		}
<span class="nc" id="L120">		return &quot;&quot;;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>