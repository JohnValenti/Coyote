<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>ShiftBidder.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.ejb.rm.requests.shiftbid.shiftbidrequest.model</a> &gt; <span class="el_source">ShiftBidder.java</span></div><h1>ShiftBidder.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.ejb.rm.requests.shiftbid.shiftbidrequest.model;

import com.bluepumpkin.common.datatypes.*;
import com.bluepumpkin.ejb.bbm.vo.*;
import com.bluepumpkin.ejb.bbm.workresource.model.Employee;
import com.bluepumpkin.ejb.bbm.cache.CacheUtilBBM;
import com.bluepumpkin.ejb.rm.requests.common.model.RequestDetailLevel;
import com.bluepumpkin.ejb.rm.requests.common.validation.Validatable;
import com.bluepumpkin.ejb.rm.requests.common.validation.ValidationCache;
import com.bluepumpkin.ejb.rm.requests.common.validation.ValidationResult;

import java.util.ArrayList;
import java.util.Collection;
import java.util.Collections;
import java.util.Date;



/**
 * Represents a participant of a shift bid auction.
 *
 * &lt;p&gt; Mapping of UI field names (when a shift bidder is displayed) and the corr. backend concepts:
 * &lt;li&gt; point: Accumulated bonus for this shiftBidder.  See {@link ShiftBidder.ShiftBidderOptMethods#getAccumulatedBonus()}.
 * &lt;li&gt; bonus: shift bidder bonus assigned for this auction. see {@link ShiftBidder#getBonusThisAuction()}
 * &lt;li&gt; rank: employee's rank assigned in DE. see {@link ShiftBidder.ShiftBidderOptMethods#getEmployee()#getRank()}
 * &lt;li&gt; score: score with or without bonus ???. see {@link ShiftBidder.ShiftBidderOptMethods#getScoreWithBonus()}
 *
 * &lt;p&gt; see {@link com.bluepumpkin.ejb.rm.requests.shiftbid.shiftbidauction.ejb.ShiftBidAuctionManager ShiftBidAuctionManager}
 * for a description of the shift bidding process.
 *
 * Title:        ShiftBidder
 * Description:  This class represents an ShiftBidder
 * Copyright:    Copyright (c) 2002
 * Company:      Blue Pumpkin Software, Inc.
 * @author       Jagdish Seelam
 * @version 1.0
 */

public class ShiftBidder extends ValueObjectNode implements Validatable {
<span class="nc" id="L40">	private static final ShiftBidderFieldInfo m_fieldInfo = new ShiftBidderFieldInfo();</span>

    /**
     * ID, employeeID, shiftBidAuctionID, deadLine, Status, BonusThisAuction.
     */
    public static final long DL_BASIC = RequestDetailLevel.DL_BASIC ;

    /**
     * Employee object (name, employee rank, seniority, total accumulated points) and
     * employee score.
     *
     * &lt;br&gt;Employee score = weighted sum of(rank, seniority, accumulated points, bonus this auction).
     * Note that only the accumulated bonus and bonus this auction are used towards this score.
     * The BiddableSchedule and ShiftBidAuction bonus are not used to calculate this.
     * These bonuses are added to the accumulated bonus (BiddableSchedule Bonus is added if the employee
     * wins the biddableSchedule.  ShiftBidAuction bonus is added if the employee does not win any
     * biddableSchedules that he/she bid in a round of auction).
     */
    public static final long DL_EMPLOYEE = RequestDetailLevel.DL_EMPLOYEE_SHIFTBIDDER_CHILD;

    /**
     * @see RequestDetailLevel#DL_NUMBER_OF_SHIFTBIDREQUESTS
     */
    public static final long DL_NUMBER_OF_SHIFTBIDREQUESTS =
        RequestDetailLevel.DL_NUMBER_OF_SHIFTBIDREQUESTS_FOR_SHIFTBIDDER;

    /**
     * Score computed for the shift bidder
     * See {@link ShiftBidderOptMethods#getScoreWithBonus() getScoreWithBonus()} for more information.
     */
    public static final long DL_SHIFTBIDDER_SCORE =
        RequestDetailLevel.DL_SCORECOMPUTED_FOR_SHIFTBIDDER;

    /*
     * Shift Bidder Status
     */
    public static final int STATUS_FIRST = 1;
    public static final int STATUS_NOT_ADDED = 1;
    public static final int STATUS_ADDED = 2;
    // For auction with &quot;Include Previously Scheduled Employees = false&quot;: A bidder with any shifts for the auction week will be marked as &quot;unavailable&quot; (AKA &quot;scheduled&quot;).  An &quot;unavailable&quot;
    // bidder can not be added to an auction.
    // For auction with &quot;Include Previously Scheduled Employees = true&quot;: A bidder with any approved bidding requests for the current auction will be marked as &quot;unavailable&quot; (AKA &quot;scheduled&quot;).  An &quot;unavailable&quot;
    // bidder can not be added to an auction.

    public static final int STATUS_UNAVAILABLE = 3;
    //Usage context is: 'Bid Options for bidder'.  For the given bidder, the biddable schedules
    // and their associated shiftBidRequests will be fetched (for displaying rank, 'using bonus' etc).
    // These associated shift bid requests can be used to infer (from the presence or absence of these requests)
    // this state.
    public static final int STATUS_BIDSUBMITTED = 4;
    public static final int STATUS_LAST = 4;

<span class="nc" id="L92">    public final static String[] STATUS_STRARR = new String[] { &quot;&quot;, &quot;NotAdded&quot;, &quot;Added&quot;, &quot;Scheduled&quot;, &quot;BidSubmitted&quot;};</span>

    /**
     * ShiftBidder ranking criteria for ordering bidders to be added to a serialized auction.
     */
    public static final int RANKBY_SENIORITY = 1;
    public static final int RANKBY_EMPLOYEERANK = 2;
    public static final int RANKBY_ACCUMULATEDBONUS = 3;
    public static final int RANKBY_SCORE = 4;
    public static final int RANKBY_SHIFTBIDDER_BONUS = 5;

    /**
     * SORTBY criteria for sorting a collection of shift bidders.
     */
    public static final int SORTBY_NONE = 1;
    /**
     * Sort by the computed score (weighted sum)
     * &lt;p&gt;Note: does an in-memory sort.
     */
    public static final int SORTBY_SCORE = 2;
    /**
     * Sort by bidder status
     * &lt;p&gt;Note: does a SQL sort
     */
    public static final int SORTBY_STATUS = 3;
    /**
     * Sort by seniority.
     * &lt;p&gt;Note: does a SQL sort
     */
    public static final int SORTBY_SENIORITY = 4;
    /**
     * Sort by rank (of employee)
     * &lt;p&gt;Note: does a SQL sort
     */
    public static final int SORTBY_RANK = 5;
    /**
     * Sort by accumulated points (for employee)
     * &lt;p&gt;Note: does a SQL sort
     */
    public static final int SORTBY_POINTS = 6;
    /**
     * Sort by bonus (assigned to shift bidder).
     * &lt;p&gt;Note: does a SQL sort
     */
    public static final int SORTBY_BONUS = 7;
    /**
     * Sort by bidder deadline.
     * &lt;p&gt;Note: does a SQL sort
     */
    public static final int SORTBY_DEADLINE = 8;
    /**
     * Sort by bidder name.
     * &lt;p&gt;Note: does a SQL sort
     */
    public static final int SORTBY_NAME = 9;

    //  cache doesn't need to be invalidated when certain methods are called since it is read only.
    private transient Employee m_cachedEmployee;

    private transient ShiftBidderOptMethods m_shiftBidderOptMethods;

    private transient ShiftBidderSetters m_shiftBidderSetters;

<span class="nc" id="L155">    private long m_detailLevel = DL_BASIC;</span>

<span class="nc" id="L157">    private int m_numOfReqs = 0;</span>

    private int m_scoreWithoutBonus;

    private int m_scoreWithBonus;

    private int m_computedBonus;

	/**
	 * validation results of type {@link ValidationResult ValidationResult} associated
	 * with this bidder
	 */
	private Collection m_valResults;

<span class="nc bnc" id="L171" title="All 2 branches missed.">    public class ShiftBidderOptMethods  {</span>
        /**
         * @return
         * @see //ShiftBidAuctionUtil#computeBonusAndScoreWithAndWithoutPoints(ShiftBidRequest, ShiftBidder, ShiftBidAuction, ID, OrganizationSetting, Map, Map)
         */
        public int getAccumulatedBonus() {
<span class="nc" id="L177">            return getEmployee().getAssignedPoints();</span>
        }

        public Employee getEmployee() {
<span class="nc bnc" id="L181" title="All 4 branches missed.">            assert (m_detailLevel &amp; DL_EMPLOYEE) != 0:&quot;(m_detailLevel &amp; DL_EMPLOYEE) != 0): &quot; + m_detailLevel;</span>

<span class="nc bnc" id="L183" title="All 2 branches missed.">            if ( m_cachedEmployee != null ) return m_cachedEmployee;</span>

            try {
<span class="nc" id="L186">                m_cachedEmployee= CacheUtilBBM.getEmployeeByID(getEmployeeID(), null,</span>
                                        Employee.DETAIL_LEVEL_EMPLOYEE_BASIC | Employee.DETAIL_LEVEL_EMPLOYEE_TIMEBASEDPROPERTY);
<span class="nc" id="L188">            } catch (Exception e) {</span>
<span class="nc" id="L189">                e.printStackTrace();  //To change body of catch statement use File | Settings | File Templates.</span>
<span class="nc" id="L190">            }</span>
            /*
            Collection employees = getChildObjects(ShiftBidderFieldInfo.EMPLOYEE_CHILDTYPE);
            assert employees.size() == 1:&quot;employees.size() == 1: &quot; + employees.size();
            m_cachedEmployee = (Employee) employees.iterator().next();
            m_cachedEmployee.setDetailLevel(Employee.DETAIL_LEVEL_EMPLOYEE_TIMEBASEDPROPERTY);
            */
<span class="nc" id="L197">            return m_cachedEmployee;</span>
        }

        public int getNumOfShiftBidRequests() {
<span class="nc" id="L201">            return m_numOfReqs;</span>
        }

        /**
         * @see ShiftBidRequest.ShiftBidRequestOptMethods#getBonusComputed
         * @param //computedBonus
         * @see //ShiftBidAuctionUtil#computeBonusAndScoreWithAndWithoutPoints(ShiftBidRequest, ShiftBidder, ShiftBidAuction, ID, OrganizationSetting, Map, Map)
         */
        public int getBonusComputed() {
<span class="nc" id="L210">            return m_computedBonus;</span>
        }

        /**
         * @see ShiftBidRequest.ShiftBidRequestOptMethods#getScoreWithBonus
         * @param  //computedScore
         * @see //ShiftBidAuctionUtil#computeBonusAndScoreWithAndWithoutPoints(ShiftBidRequest, ShiftBidder, ShiftBidAuction, ID, OrganizationSetting, Map, Map)
         */
        public int getScoreWithBonus() {
<span class="nc" id="L219">            return m_scoreWithBonus;</span>
        }

        /**
         * @see ShiftBidRequest.ShiftBidRequestOptMethods#getScoreWithoutBonus
         * @param //computedScore
         * @see //ShiftBidAuctionUtil#computeBonusAndScoreWithAndWithoutPoints(ShiftBidRequest, ShiftBidder, ShiftBidAuction, ID, OrganizationSetting, Map, Map)
         */
        public int getScoreWithoutBonus() {
<span class="nc" id="L228">            return m_scoreWithoutBonus;</span>
        }
    }

<span class="nc" id="L232">    public class ShiftBidderSetters  {</span>
        // setters
        public void setEmployeeID(ID id) {
<span class="nc" id="L235">            setFieldValue(ShiftBidderFieldInfo.SHIFTBIDDER_I_EMPLOYEEID, id);</span>
<span class="nc" id="L236">        }</span>

        public void setShiftBidAuctionID(ID id) {
<span class="nc" id="L239">            setFieldValue(ShiftBidderFieldInfo.SHIFTBIDDER_I_SHIFTBIDAUCTIONID, id);</span>
<span class="nc" id="L240">        }</span>

        public void setStatus(int status)  {
<span class="nc" id="L243">            setFieldValue(ShiftBidderFieldInfo.SHIFTBIDDER_N_STATUS, status);</span>
<span class="nc" id="L244">        }</span>

        /**
         * @param i
         */
        public void setNumOfShiftBidRequests(int numOfReqs) {
<span class="nc" id="L250">            m_numOfReqs = numOfReqs;</span>
<span class="nc" id="L251">        }</span>

        /**
         * @see ShiftBidRequest.ShiftBidRequestOptMethods#getBonusComputed
         *
         * @param computedBonus
         */
        public void setBonusComputed(int computedBonus) {
<span class="nc" id="L259">            m_computedBonus = computedBonus;</span>
<span class="nc" id="L260">        }</span>

        /**
         * @see ShiftBidRequest.ShiftBidRequestOptMethods#getScoreWithBonus
         * @param computedScore
         */
        public void setScoreWithBonus(int scoreWithBonus) {
<span class="nc" id="L267">            m_scoreWithBonus = scoreWithBonus;</span>
<span class="nc" id="L268">        }</span>

        /**
         * @see ShiftBidRequest.ShiftBidRequestOptMethods#getScoreWithoutBonus
         *
         * @param computedScore
         */
        public void setScoreWithoutBonus(int scoreWithoutBonus) {
<span class="nc" id="L276">            m_scoreWithoutBonus = scoreWithoutBonus;</span>
<span class="nc" id="L277">        }</span>

        public void setIsSerializedAuctionBidder(boolean isSerAucBidder) {
<span class="nc" id="L280">            setFieldValue(ShiftBidderFieldInfo.SHIFTBIDDER_B_ISSERIALIZEDBIDDER, isSerAucBidder);</span>
<span class="nc" id="L281">        }</span>

        /**
         * Adds employee to the update list.  When this object is updated in the
         * DB, a cascaded update will be done and the employee will be updated as well.
         *
         * @param bidderEmp
         */
        public void updateEmployee(Employee bidderEmp) {
<span class="nc" id="L290">            updateChildObject(ShiftBidderFieldInfo.EMPLOYEE_CHILDTYPE, bidderEmp);</span>
<span class="nc" id="L291">        }</span>


        /**
         * Copy unset fields from origBidderFromDB to this shiftBidder object.
         *
         * @param origBidderFromDB
         */
        public void copyUnsetFields(ShiftBidder origBidderFromDB) {
<span class="nc bnc" id="L300" title="All 2 branches missed.">            for (int i = 0; i &lt; m_fieldInfo.getFieldCount(); i++) {</span>
                // if field value is not set
<span class="nc bnc" id="L302" title="All 2 branches missed.">                if ( !isFieldValueSet(i) ) {</span>
                    // copy field value from origBidderFromDB.
<span class="nc" id="L304">                    setFieldValue(i, origBidderFromDB.getFieldValue(i));</span>
                }
            }
<span class="nc" id="L307">        }</span>
    }

    public ShiftBidder(long detailLevel) {
<span class="nc" id="L311">        super();</span>
<span class="nc" id="L312">        m_detailLevel = detailLevel;</span>
<span class="nc" id="L313">    }</span>

	// getters
	public ID getEmployeeID() {
<span class="nc" id="L317">		return getFieldValueID(ShiftBidderFieldInfo.SHIFTBIDDER_I_EMPLOYEEID);</span>
	}

	public ID getShiftBidAuctionID() {
<span class="nc" id="L321">		return getFieldValueID(ShiftBidderFieldInfo.SHIFTBIDDER_I_SHIFTBIDAUCTIONID);</span>
	}

	/**
     * Earlier of the deadline associted with the shiftBidder or the auction
     * @return
     */
    public Date getDeadlineDate() {
<span class="nc" id="L329">		return getFieldValueDate(ShiftBidderFieldInfo.SHIFTBIDDER_D_DEADLINETIME);</span>
	}

    public int getStatus()  {
<span class="nc" id="L333">        return getFieldValueInt(ShiftBidderFieldInfo.SHIFTBIDDER_N_STATUS);</span>
    }

    public int getBonusThisAuction() {
<span class="nc" id="L337">        return getFieldValueInt(ShiftBidderFieldInfo.SHIFTBIDDER_N_BONUSTHISAUCTION);</span>
    }

    public boolean getIsSerializedAuctionBidder() {
<span class="nc" id="L341">        return getFieldValueBoolean(ShiftBidderFieldInfo.SHIFTBIDDER_B_ISSERIALIZEDBIDDER);</span>
    }

    public long getDetailLevel()  {
<span class="nc" id="L345">        return m_detailLevel;</span>
    }

    /**
     * @return
     */
    public static long getDetailLevelForValidation() {
<span class="nc" id="L352">        return ShiftBidder.DL_BASIC | ShiftBidder.DL_EMPLOYEE;</span>
    }

    /**
     * @return
     */
    public boolean getIsAddedToAuction() {
<span class="nc bnc" id="L359" title="All 2 branches missed.">        return getStatus() == STATUS_ADDED;</span>
    }

    public ShiftBidderOptMethods getOptMethods()  {
<span class="nc bnc" id="L363" title="All 2 branches missed.">        return (m_shiftBidderOptMethods = (m_shiftBidderOptMethods == null)?</span>
            new ShiftBidderOptMethods():m_shiftBidderOptMethods);
    }

    public ShiftBidderSetters getSetters()  {
<span class="nc bnc" id="L368" title="All 2 branches missed.">        return (m_shiftBidderSetters = (m_shiftBidderSetters == null)?</span>
            new ShiftBidderSetters():m_shiftBidderSetters);
    }

    public boolean isStatusAdded() {
<span class="nc bnc" id="L373" title="All 2 branches missed.">        return getStatus() == STATUS_ADDED;</span>
    }

    public boolean isStatusNotAdded() {
<span class="nc bnc" id="L377" title="All 2 branches missed.">        return getStatus() == STATUS_NOT_ADDED;</span>
    }

    public boolean isStatusUnavailable() {
<span class="nc bnc" id="L381" title="All 2 branches missed.">        return getStatus() == STATUS_UNAVAILABLE;</span>
    }

	public void setDeadlineDate(Date eDate) {
<span class="nc" id="L385">		setFieldValue(ShiftBidderFieldInfo.SHIFTBIDDER_D_DEADLINETIME, eDate);</span>
<span class="nc" id="L386">	}</span>

    public void setBonusThisAuction(int bonusThisAuc) {
<span class="nc" id="L389">        setFieldValue(ShiftBidderFieldInfo.SHIFTBIDDER_N_BONUSTHISAUCTION, bonusThisAuc);</span>
<span class="nc" id="L390">    }</span>

    protected FieldInfo getFieldInfo() {
<span class="nc" id="L393">    	return m_fieldInfo;</span>
    }

    /*
	public String toString() {
		StringBuffer sb = new StringBuffer(1024);
		sb.append(&quot;ShiftBidder@&quot;);
		sb.append(Integer.toHexString(hashCode()));
		sb.append('[');
		FieldInfoEntry fieldEntries[] = m_fieldInfo.getFieldInfo();
		for (int j = 0; j &lt; fieldEntries.length; j++) {
			sb.append(fieldEntries[j].getFieldName());
			sb.append(&quot; = &quot;);
			sb.append(getFieldValue(j));
			sb.append('\n');
		}
		sb.append(']');
		return sb.toString();
	} */

	public static void main(String[] args) {
<span class="nc" id="L414">		return;</span>
	}

	/* (non-Javadoc)
	 * @see com.bluepumpkin.ejb.rm.requests.common.validation.Validatable#getValidationResults(boolean)
	 */
	public Collection getValidationResults(boolean entireBranch) {
<span class="nc bnc" id="L421" title="All 2 branches missed.">		return (m_valResults == null)?Collections.EMPTY_LIST:m_valResults;</span>
	}

	/* (non-Javadoc)
	 * @see com.bluepumpkin.ejb.rm.requests.common.validation.Validatable#clearValidationResults(boolean)
	 */
	public void clearValidationResults(boolean entireBranch) {
<span class="nc bnc" id="L428" title="All 2 branches missed.">		if (m_valResults != null) {</span>
<span class="nc" id="L429">			m_valResults.clear();</span>
		}
<span class="nc" id="L431">	}</span>

	/* (non-Javadoc)
	 * @see com.bluepumpkin.ejb.rm.requests.common.validation.Validatable#addValidationResult(com.bluepumpkin.ejb.rm.requests.common.validation.ValidationResult)
	 */
	public void addValidationResult(ValidationResult result) {
<span class="nc bnc" id="L437" title="All 2 branches missed.">		m_valResults = (m_valResults != null)?m_valResults:new ArrayList(8);</span>

<span class="nc" id="L439">		m_valResults.add(result);</span>
<span class="nc" id="L440">	}</span>

	/* (non-Javadoc)
	 * @see com.bluepumpkin.ejb.rm.requests.common.validation.Validatable#getValidationCache()
	 */
	public ValidationCache getValidationCache() {
		// TODO Auto-generated method stub
<span class="nc" id="L447">		return null;</span>
	}

	/* (non-Javadoc)
	 * @see com.bluepumpkin.ejb.rm.requests.common.validation.Validatable#getValidationTimeRanges()
	 */
	public Collection getValidationTimeRanges() {
		// TODO Auto-generated method stub
<span class="nc" id="L455">		return null;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>