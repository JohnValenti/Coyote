<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>ShiftBidRequestBiddableSchedule.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.ejb.rm.requests.shiftbid.shiftbidrequest.model</a> &gt; <span class="el_source">ShiftBidRequestBiddableSchedule.java</span></div><h1>ShiftBidRequestBiddableSchedule.java</h1><pre class="source lang-java linenums">/*
 * Created on Aug 1, 2003
 *
 * To change this generated comment go to 
 * Window&gt;Preferences&gt;Java&gt;Code Generation&gt;Code and Comments
 */
package com.bluepumpkin.ejb.rm.requests.shiftbid.shiftbidrequest.model;

import java.util.Collection;
import java.util.Map;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.ejb.bbm.vo.FieldInfo;
import com.bluepumpkin.ejb.bbm.vo.ValueObjectNode;
import com.bluepumpkin.ejb.rm.requests.common.ejb.RequestUtil;
import com.bluepumpkin.ejb.rm.requests.common.model.RequestDetailLevel;

/**
 * @author RRajendran
 *
 * To change this generated comment go to 
 * Window&gt;Preferences&gt;Java&gt;Code Generation&gt;Code and Comments
 */
<span class="nc bnc" id="L24" title="All 2 branches missed.">public class ShiftBidRequestBiddableSchedule extends ValueObjectNode {</span>
    
    // Note: superclass ValueObjectBase has a m_fieldInfo which is initialized by a call to
    // getFieldInfo() even before the constructor of this object executes.  As a result, the
    // base object's m_fieldInfo can be different than this fieldinfo due to this early
    // initialization.
    private ShiftBidRequestBiddableScheduleFieldInfo m_fieldInfoForSubClass;

    public static final long DL_BASIC = RequestDetailLevel.DL_BASIC;
    public static final long DL_SHIFT_ASSIGNMENTS_COLL = RequestDetailLevel.DL_SHIFT_ASSIGNMENTS_COLL_ROOTED_SHIFTBIDREQUEST;

<span class="nc" id="L35">    protected long m_detailLevel = DL_BASIC;</span>
    
    /**
     * transient, as needed only in the backend.
     */
    private transient String m_parentDAOName;

<span class="nc" id="L42">    public ShiftBidRequestBiddableSchedule(String parentDAOName, long detailLevel)  {</span>
<span class="nc" id="L43">        m_detailLevel = detailLevel;</span>
<span class="nc" id="L44">        m_parentDAOName = parentDAOName;</span>

        // Note: m_fieldInfo is accessed (by a call to getFieldInfo() in ValueObjectBase.constructor()) 
        //   even before it is initialized here.  This case is handled by the getFieldInfo() method below.
<span class="nc bnc" id="L48" title="All 2 branches missed.">        if (isParentShiftBidRequest())   {</span>
            // setup a FieldInfo which returns ShiftBidRequestBiddableScheduleFieldInfo.SHIFTBIDREQUESTBIDDABLESCHEDULE_I_SHIFTBIDREQUESTID
            // when its getParentIDFieldIndex() method is called.
<span class="nc" id="L51">            m_fieldInfoForSubClass = ShiftBidRequestBiddableScheduleFieldInfo.getFieldInfoForParentType(</span>
                ShiftBidRequestBiddableScheduleFieldInfo.SHIFTBIDREQUESTBIDDABLESCHEDULE_I_SHIFTBIDREQUESTID);
            
<span class="nc bnc" id="L54" title="All 2 branches missed.">        } else if (isParentBiddableSchedule())  {</span>
            // setup a FieldInfo which returns ShiftBidRequestBiddableScheduleFieldInfo.SHIFTBIDREQUESTBIDDABLESCHEDULE_I_BIDDABLESCHEDULEID
            // when its getParentIDFieldIndex() method is called.
<span class="nc" id="L57">            m_fieldInfoForSubClass = ShiftBidRequestBiddableScheduleFieldInfo.getFieldInfoForParentType(</span>
                ShiftBidRequestBiddableScheduleFieldInfo.SHIFTBIDREQUESTBIDDABLESCHEDULE_I_BIDDABLESCHEDULEID);            
        }
<span class="nc" id="L60">    }</span>
    
    /**
     * Forced to override ValueObjectBasae.getParenetID() implementation because it uses a
     * private m_fieldInfo which is initialized before the m_fieldInfo for this instance is 
     * decided (in the constructor).  Once initialized, this ValueObjectBase's m_fieldInfo is 
     * immutable (no setter method provided) and hence cannot be replaced with the actual 
     * m_fieldInfo for this instance. 
     * 
     *  (non-Javadoc)
     * @see com.bluepumpkin.ejb.bbm.vo.ValueObjectBase#getParentID()
     */
    public ID getParentID() {
<span class="nc" id="L73">        return getFieldValueID(m_fieldInfoForSubClass.getParentIDFieldIndex());</span>
    }

    /**
    /**
     * Forced to override ValueObjectBasae.setParenetID() implementation because it uses a
     * private m_fieldInfo which is initialized before the m_fieldInfo for this instance is 
     * decided (in the constructor).  Once initialized, this ValueObjectBase's m_fieldInfo is 
     * immutable (no setter method provided) and hence cannot be replaced with the actual 
     * m_fieldInfo for this instance. 
     * 
     *  (non-Javadoc)
     * @see com.bluepumpkin.ejb.bbm.vo.ValueObjectBase#setParentID(com.bluepumpkin.common.datatypes.ID)
     */
    public void setParentID(ID id) {
<span class="nc" id="L88">        setFieldValue(m_fieldInfoForSubClass.getParentIDFieldIndex(), id);</span>
<span class="nc" id="L89">    }</span>

    /**
     * Is ShiftBidRequest the parent of this object?
     * @return
     */
    private boolean isParentShiftBidRequest() {
<span class="nc bnc" id="L96" title="All 2 branches missed.">        return m_parentDAOName.toLowerCase().indexOf(&quot;shiftbidrequestdao&quot;) &gt;= 0;</span>
    }

    /**
     * Is BiddableSchedule the parent of this object?
     * @return
     */
    private boolean isParentBiddableSchedule() {
<span class="nc bnc" id="L104" title="All 2 branches missed.">        return m_parentDAOName.toLowerCase().indexOf(&quot;biddablescheduledao&quot;) &gt;= 0;</span>
    }

    /* (non-Javadoc)
     * @see com.bluepumpkin.ejb.bbm.vo.ValueObjectBase#getFieldInfo()
     */
    protected FieldInfo getFieldInfo() {
        // if m_fieldInfo not yet initialized, return default.  Necessary since ValueObjectBase.constructor()
        // calls this method before m_fieldInfo is initialized in this class's constructor.
<span class="nc bnc" id="L113" title="All 2 branches missed.">        if (m_fieldInfoForSubClass == null) return ShiftBidRequestBiddableScheduleFieldInfo.getFieldInfoForParentType(-1);</span>

<span class="nc" id="L115">        return m_fieldInfoForSubClass;</span>
    }

    public ID getShiftBidRequestID()  {
<span class="nc" id="L119">        return getFieldValueID(</span>
            ShiftBidRequestBiddableScheduleFieldInfo.SHIFTBIDREQUESTBIDDABLESCHEDULE_I_SHIFTBIDREQUESTID);
    }

    public ID getBiddableScheduleID()  {
<span class="nc" id="L124">        return getFieldValueID(</span>
            ShiftBidRequestBiddableScheduleFieldInfo.SHIFTBIDREQUESTBIDDABLESCHEDULE_I_BIDDABLESCHEDULEID);
    }
    
    public int getOrder()  {
<span class="nc" id="L129">        return getFieldValueInt(</span>
            ShiftBidRequestBiddableScheduleFieldInfo.SHIFTBIDREQUESTBIDDABLESCHEDULE_N_ITEMORDER);
    }

    public void setOrder(int order)  {
<span class="nc" id="L134">        setFieldValue(</span>
            ShiftBidRequestBiddableScheduleFieldInfo.SHIFTBIDREQUESTBIDDABLESCHEDULE_N_ITEMORDER, order);
<span class="nc" id="L136">    }</span>

    public void setBiddableScheduleID(ID bidSchedID)  {
<span class="nc" id="L139">        setFieldValue(</span>
            ShiftBidRequestBiddableScheduleFieldInfo.SHIFTBIDREQUESTBIDDABLESCHEDULE_I_BIDDABLESCHEDULEID, bidSchedID);
<span class="nc" id="L141">    }</span>

    /**
     * Optional method: returns valid values only if the BiddableSchedules were loaded as children (using
     * the right detailLevel).
     * 
     * &lt;p&gt;Note:   
     * A ShiftBidRequestBiddableSchedule will not have a biddableSChedule child if the associated bidSched
     * has numOfAvailInstances == 0. BiddableScheduleDAO will not return any biddable schedules with numOfAvailInstances == 0
     * unless the ShiftBidRequest was loaded with
     * {@link RequestDetailLevel#DL_INCLUDE_ZERO_NUM_OF_AVAIL_INSTANCES DL_INCLUDE_ZERO_NUM_OF_AVAIL_INSTANCES}.
     * 
     * @return Null if the associated biddableSchedule has numOfAvailInstances == 0 (See above).  
     * The associated BiddableSChedule otherwise.
     */
    public BiddableSchedule getBiddableSchedule() {
<span class="nc" id="L157">        Collection bidScheds = getChildObjects(ShiftBidRequestBiddableScheduleFieldInfo.BIDDABLESCHEDULE_CHILD_TYPE);</span>
        // See 'Note' above.  It is valid for a shiftBidRequestBiddableSched to not be associated with a 
        // biddableschedule 
<span class="nc bnc" id="L160" title="All 4 branches missed.">        assert bidScheds.size() &lt;= 1:&quot;bidScheds.size() &lt;= 1: &quot; + bidScheds.size();</span>
        
<span class="nc bnc" id="L162" title="All 2 branches missed.">        return bidScheds.isEmpty()?null:(BiddableSchedule) bidScheds.iterator().next(); </span>
    }

    /**
     * Note: This method add it only to the 'persisted child list' and not the 'create child list'.
     * 
     * @param object
     */
    public void setBiddableSchedule(BiddableSchedule bidSched) {
<span class="nc" id="L171">        fillChildObject(ShiftBidRequestBiddableScheduleFieldInfo.BIDDABLESCHEDULE_CHILD_TYPE, bidSched);</span>
<span class="nc" id="L172">        m_detailLevel |= DL_SHIFT_ASSIGNMENTS_COLL;</span>
<span class="nc" id="L173">    }</span>

    /**
     * @return
     */
    public ShiftBidRequest getShiftBidRequest() {
<span class="nc" id="L179">        Collection sbReqs = getChildObjects(ShiftBidRequestBiddableScheduleFieldInfo.SHIFTBIDREQUEST_CHILD_TYPE);</span>
        
<span class="nc bnc" id="L181" title="All 2 branches missed.">        if (sbReqs.size() != 1) throw new IllegalArgumentException(&quot;sbReqs.size != 1: &quot; + sbReqs.size());</span>
        
<span class="nc" id="L183">        return (ShiftBidRequest) sbReqs.iterator().next();</span>
    }

	/**
	 * Replace the associated 'persisted' biddableSchedule child with a  
	 * new biddableSchedule from the given map.  We do not search for the child in the other
	 * child collections such as 'created', 'updated' etc since a biddableSchedule is never created or updated.
	 * thru a ShiftBidRequestBiddableSchedule.
	 *  
	 * @param toBidSchedMap
	 * @return
	 */
	boolean replaceBidSched(Map bidSchedIDTOBidSchedMap) {
		// Note: this returns the child from the 'persisted', 'updated', 'deleted' and 'created' child collection.
<span class="nc" id="L197">		BiddableSchedule oldBidSched = getBiddableSchedule();</span>
<span class="nc" id="L198">		ID oldBidSchedID = oldBidSched.getID();</span>
<span class="nc" id="L199">		BiddableSchedule newBidSched = (BiddableSchedule) bidSchedIDTOBidSchedMap.get(oldBidSchedID);</span>
		
		// if a matching new bidSched is not found, return false. 
<span class="nc bnc" id="L202" title="All 2 branches missed.">		if (newBidSched == null) { </span>
<span class="nc" id="L203">			return false;</span>
		}

<span class="nc" id="L206">		int bidSchedChildType = ShiftBidRequestBiddableScheduleFieldInfo.BIDDABLESCHEDULE_CHILD_TYPE;</span>

		// Note: this returns the child only from the 'persisted', 'updated'and 'deleted' child collection but
		// not from the 'created' child collection.
<span class="nc bnc" id="L210" title="All 2 branches missed.">		if (getChildObjectByID(bidSchedChildType, oldBidSchedID) != null) {</span>
			// we assume that it must be from the 'persisted' child collection and not the 'updated' collection.
<span class="nc" id="L212">			clearChildObjectMap(bidSchedChildType);</span>
			// associate the new BidSched as a 'persisted' child.
<span class="nc" id="L214">			fillChildObject(bidSchedChildType, newBidSched);</span>
		} else { 
<span class="nc" id="L216">			throw RequestUtil.createIllegalArgumentException(oldBidSchedID.toString(), null);</span>
		}		
		
<span class="nc" id="L219">		return true;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>