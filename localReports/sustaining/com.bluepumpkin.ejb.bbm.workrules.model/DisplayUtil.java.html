<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>DisplayUtil.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.ejb.bbm.workrules.model</a> &gt; <span class="el_source">DisplayUtil.java</span></div><h1>DisplayUtil.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.ejb.bbm.workrules.model;
  
  /**
   * Title:        Blue Pumpkin Software Activity Management
   * Description:
   * Copyright:    Copyright (c) 2001
   * Company:      Blue Pumpkin Software, Inc
   * @author
   * @version 1.0
   */
  
import java.io.IOException;
import java.io.StringReader;
import java.util.ArrayList;
import java.util.Collection;
import java.util.HashMap;
import java.util.Iterator;
import java.util.LinkedList;

import org.apache.xerces.parsers.DOMParser;
import org.w3c.dom.Node;
import org.w3c.dom.NodeList;
import org.xml.sax.InputSource;
import org.xml.sax.SAXException;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.datatypes.TimeOfDay;
import com.bluepumpkin.common.l10n.RegionalFormatBundleKey;
import com.bluepumpkin.common.localization.Localizer;
import com.bluepumpkin.ejb.bbm.activity.model.Activity;
import com.bluepumpkin.ejb.bbm.paypolicy.model.EarningType;


<span class="nc" id="L34">class ClauseCounter {</span>
<span class="nc" id="L35">	int n = 0;</span>
}

class ClauseSeperator {
<span class="nc" id="L39">	ClauseSeperator(int nActiveClause) {</span>
<span class="nc" id="L40">		m_nActiveClause = nActiveClause;</span>
<span class="nc" id="L41">	}</span>
	int m_nActiveClause;
}

<span class="nc" id="L45">public class DisplayUtil {</span>
	
<span class="nc" id="L47">	public static String[] asWeekDays = {&quot;&quot;,&quot;Sunday&quot;,&quot;Monday&quot;,&quot;Tuesday&quot;,&quot;Wednesday&quot;,&quot;Thursday&quot;,&quot;Friday&quot;,&quot;Saturday&quot;};</span>
<span class="nc" id="L48">	public static String[] asPeriods = {&quot; WorkDay&quot;,&quot; WorkWeek&quot;,&quot; Month&quot;};</span>
<span class="nc" id="L49">	public static String[] asPartsOfDay = {&quot; Anytime&quot;,&quot; Morning&quot;,&quot; Afternoon&quot;,&quot; Evening&quot;,&quot; Night&quot;};</span>
	
	public static Collection getActivityIDsForWorkRules(Collection pWorkRules) throws WorkRuleException{
<span class="nc" id="L52">		HashMap hActivityIDs = new HashMap();</span>
<span class="nc bnc" id="L53" title="All 2 branches missed.">		for( Iterator w = pWorkRules.iterator(); w.hasNext(); ) {</span>
<span class="nc" id="L54">			WorkRule pWorkRule = (WorkRule)w.next();</span>
<span class="nc bnc" id="L55" title="All 2 branches missed.">			for( Iterator i = pWorkRule.getWorkRuleParameters().iterator();i.hasNext(); ) {</span>
<span class="nc" id="L56">				WorkRuleParameter pWorkRuleParameter = (WorkRuleParameter)i.next();</span>
<span class="nc bnc" id="L57" title="All 2 branches missed.">				if (pWorkRuleParameter.getType() == WorkRuleParameter.ACTIVITY)</span>
<span class="nc" id="L58">					hActivityIDs.put(pWorkRuleParameter.getActivityIDValue(),null);</span>
<span class="nc" id="L59">			}</span>
<span class="nc" id="L60">		}</span>
<span class="nc" id="L61">		return new ArrayList(hActivityIDs.keySet());</span>
	}
	
	public static Collection getShiftIDsForWorkRules(Collection pWorkRules) throws WorkRuleException{
<span class="nc" id="L65">		HashMap hShiftIDs = new HashMap();</span>
<span class="nc bnc" id="L66" title="All 2 branches missed.">		for( Iterator w = pWorkRules.iterator(); w.hasNext(); ) {</span>
<span class="nc" id="L67">			WorkRule pWorkRule = (WorkRule)w.next();</span>
<span class="nc bnc" id="L68" title="All 2 branches missed.">			for( Iterator i = pWorkRule.getWorkRuleParameters().iterator();i.hasNext(); ) {</span>
<span class="nc" id="L69">				WorkRuleParameter pWorkRuleParameter = (WorkRuleParameter)i.next();</span>
<span class="nc bnc" id="L70" title="All 2 branches missed.">				if (pWorkRuleParameter.getType() == WorkRuleParameter.SHIFT)</span>
<span class="nc" id="L71">					hShiftIDs.put(pWorkRuleParameter.getShiftIDValue(),null);</span>
<span class="nc" id="L72">			}</span>
<span class="nc" id="L73">		}</span>
<span class="nc" id="L74">		return new ArrayList(hShiftIDs.keySet());</span>
	}
	
	public static Collection getEarningTypeIDsForWorkRules(Collection pWorkRules) {
<span class="nc" id="L78">		HashMap hEarningTypeIDs = new HashMap();</span>
<span class="nc bnc" id="L79" title="All 2 branches missed.">		for( Iterator w = pWorkRules.iterator(); w.hasNext(); ) {</span>
<span class="nc" id="L80">			WorkRule pWorkRule = (WorkRule)w.next();</span>
<span class="nc bnc" id="L81" title="All 2 branches missed.">			if (pWorkRule.getEarningType() != null)</span>
<span class="nc" id="L82">				hEarningTypeIDs.put(pWorkRule.getEarningType(),null);</span>
<span class="nc" id="L83">		}</span>
<span class="nc" id="L84">		return new ArrayList(hEarningTypeIDs.keySet());</span>
	}
	
	public static Collection parseSentence(WorkRule pWorkRule,WorkRuleTemplate pWorkRuleTemplate,
			HashMap hActivities,HashMap hShifts, Localizer locale)
	throws WorkRuleException {
		
<span class="nc" id="L91">		LinkedList llParsedSentence = new LinkedList();</span>
		
		try {
<span class="nc" id="L94">			String sXMLString = pWorkRuleTemplate.getXMLText();</span>
<span class="nc" id="L95">			DOMParser pDomParser = new DOMParser();</span>
<span class="nc" id="L96">			InputSource isInputSource = new InputSource(new</span>
					StringReader(sXMLString));
<span class="nc" id="L98">			pDomParser.parse(isInputSource);</span>
<span class="nc" id="L99">			Iterator i = null;</span>
<span class="nc" id="L100">			int nActiveClause = 1;</span>
<span class="nc bnc" id="L101" title="All 2 branches missed.">			if (pWorkRule != null) {</span>
<span class="nc" id="L102">				i = pWorkRule.getWorkRuleParameters().iterator();</span>
<span class="nc bnc" id="L103" title="All 2 branches missed.">				if (i.hasNext()) {</span>
<span class="nc" id="L104">					WorkRuleParameter pParam = (WorkRuleParameter)i.next();</span>
<span class="nc bnc" id="L105" title="All 2 branches missed.">					if (pParam.getType() == WorkRuleParameter.CLAUSE)</span>
<span class="nc" id="L106">						nActiveClause = pParam.getClauseValue();</span>
					else
<span class="nc" id="L108">						i = pWorkRule.getWorkRuleParameters().iterator();</span>
				}
			}
			
<span class="nc" id="L112">			traverseParseWorkRule(pDomParser.getDocument(),i,hActivities,hShifts,new ClauseCounter(),nActiveClause,llParsedSentence);</span>
<span class="nc" id="L113">			return transformClauses(llParsedSentence);</span>
		}
<span class="nc" id="L115">		catch (IOException e) {</span>
<span class="nc" id="L116">			throw new WorkRuleException(&quot;could not parse sentence&quot;);</span>
		}
<span class="nc" id="L118">		catch (SAXException e) {</span>
<span class="nc" id="L119">			throw new WorkRuleException(&quot;could not parse sentence&quot;);</span>
		}
	}
	
	public static Collection transformClauses(Collection llParsedSentence) {
<span class="nc" id="L124">		int nSeperators = 0;</span>
<span class="nc" id="L125">		int nActiveClause = 1;</span>
<span class="nc bnc" id="L126" title="All 2 branches missed.">		for(Iterator w = llParsedSentence.iterator(); w.hasNext(); ) {</span>
<span class="nc" id="L127">			Object o = w.next();</span>
<span class="nc bnc" id="L128" title="All 2 branches missed.">			if (o instanceof ClauseSeperator){</span>
<span class="nc" id="L129">				nSeperators++;</span>
<span class="nc" id="L130">				nActiveClause = ((ClauseSeperator)o).m_nActiveClause;</span>
			}
<span class="nc" id="L132">		}</span>
<span class="nc bnc" id="L133" title="All 2 branches missed.">		if (nSeperators == 0)</span>
<span class="nc" id="L134">			return llParsedSentence;</span>
		
<span class="nc" id="L136">		ClauseCollection cClauses = new ClauseCollection();</span>
<span class="nc" id="L137">		cClauses.nSelectedClause = nActiveClause;</span>
		
<span class="nc" id="L139">		int nClauses = nSeperators + 1;</span>
<span class="nc" id="L140">		Iterator w = llParsedSentence.iterator();</span>
<span class="nc bnc" id="L141" title="All 2 branches missed.">		for (int i = 0; i &lt; nClauses; i++) {</span>
<span class="nc" id="L142">			ArrayList aObjects = new ArrayList();</span>
<span class="nc" id="L143">			cClauses.cClauses.add(aObjects);</span>
<span class="nc bnc" id="L144" title="All 2 branches missed.">			while (w.hasNext()) {</span>
<span class="nc" id="L145">				Object o = w.next();</span>
<span class="nc bnc" id="L146" title="All 2 branches missed.">				if (o instanceof ClauseSeperator)</span>
<span class="nc" id="L147">					break;</span>
<span class="nc" id="L148">				else aObjects.add(o);</span>
<span class="nc" id="L149">			}</span>
		}
		
<span class="nc" id="L152">		ArrayList aReturn = new ArrayList();</span>
<span class="nc" id="L153">		aReturn.add(cClauses);</span>
<span class="nc" id="L154">		return aReturn;</span>
	}
	
	
	
	public static String displaySentence(WorkRule pWorkRule, WorkRuleTemplate pWorkRuleTemplate,
			HashMap hActivities, HashMap hEarningTypes, HashMap hShifts, Localizer locale)
	throws WorkRuleException{
		
<span class="nc" id="L163">		StringBuffer sParsedString = new StringBuffer(200);</span>
		
		try {
<span class="nc" id="L166">			String sXMLString = pWorkRuleTemplate.getXMLText();</span>
<span class="nc" id="L167">			DOMParser pDomParser = new DOMParser();</span>
<span class="nc" id="L168">			InputSource isInputSource = new InputSource(new</span>
					StringReader(sXMLString));
<span class="nc" id="L170">			pDomParser.parse(isInputSource);</span>
<span class="nc" id="L171">			int nActiveClause = 1;</span>
<span class="nc" id="L172">			Iterator i = pWorkRule.getWorkRuleParameters().iterator();</span>
<span class="nc bnc" id="L173" title="All 2 branches missed.">			if (i.hasNext()) {</span>
<span class="nc" id="L174">				WorkRuleParameter pParam = (WorkRuleParameter)i.next();</span>
<span class="nc bnc" id="L175" title="All 2 branches missed.">				if (pParam.getType() == WorkRuleParameter.CLAUSE)</span>
<span class="nc" id="L176">					nActiveClause = pParam.getClauseValue();</span>
				else
<span class="nc" id="L178">					i = pWorkRule.getWorkRuleParameters().iterator();</span>
			}
<span class="nc" id="L180">			traverseDisplayWorkRule(pDomParser.getDocument(),i,hActivities, hShifts,new ClauseCounter(),nActiveClause,sParsedString,locale);</span>
			
<span class="nc bnc" id="L182" title="All 2 branches missed.">			if (pWorkRule.getPeriodType() != WorkRule.NOPERIOD) {</span>
<span class="nc" id="L183">				sParsedString.append(&quot; each &quot; );</span>
<span class="nc" id="L184">				sParsedString.append(&quot;&lt;b&gt;&quot;);</span>
<span class="nc" id="L185">				sParsedString.append(pWorkRule.getPeriodLength());</span>
<span class="nc" id="L186">				sParsedString.append(asPeriods[pWorkRule.getPeriodType()]);</span>
<span class="nc" id="L187">				sParsedString.append(&quot;&lt;/b&gt;&quot;);</span>
			}
			
<span class="nc bnc" id="L190" title="All 2 branches missed.">			if (pWorkRuleTemplate.getIsPayRule()) {</span>
<span class="nc" id="L191">				sParsedString.append(&quot; are paid &quot;);</span>
				//we may want to italicize or color the pay modification and earning type
<span class="nc" id="L193">				sParsedString.append(&quot;&lt;b&gt;&quot;);</span>
<span class="nc bnc" id="L194" title="All 2 branches missed.">				if (pWorkRule.getPayModification() &gt; 0.0)</span>
<span class="nc" id="L195">					sParsedString.append(pWorkRule.getPayModification() + &quot; &quot;);</span>
<span class="nc bnc" id="L196" title="All 2 branches missed.">				if (pWorkRule.getEarningType() != null)</span>
<span class="nc" id="L197">					sParsedString.append(((EarningType)hEarningTypes.get(pWorkRule.getEarningType())).getName());</span>
<span class="nc" id="L198">				sParsedString.append(&quot;&lt;/b&gt;&quot;);</span>
			}
			
			//start dates and end dates printing should be localized, the dates could be italicized or colored
<span class="nc" id="L202">			sParsedString.append(&quot;, starting on &quot;);</span>
<span class="nc" id="L203">			sParsedString.append(&quot;&lt;b&gt;&quot;);</span>
<span class="nc" id="L204">			sParsedString.append(locale.formatDate(pWorkRule.getStartDate(),</span>
					RegionalFormatBundleKey.MEDIUM_DATE_FORMAT));
<span class="nc" id="L206">			sParsedString.append(&quot;&lt;/b&gt;&quot;);</span>
<span class="nc bnc" id="L207" title="All 2 branches missed.">			if (pWorkRule.getEndDate() != null) {</span>
<span class="nc" id="L208">				sParsedString.append(&quot; and ending on &quot;);</span>
<span class="nc" id="L209">				sParsedString.append(&quot;&lt;b&gt;&quot;);</span>
<span class="nc" id="L210">				sParsedString.append(locale.formatDate(pWorkRule.getEndDate(),</span>
						RegionalFormatBundleKey.MEDIUM_DATE_FORMAT));
<span class="nc" id="L212">				sParsedString.append(&quot;&lt;/b&gt;&quot;);</span>
				
			}
<span class="nc" id="L215">			sParsedString.append(&quot;.&quot;);</span>
		}
<span class="nc" id="L217">		catch (IOException e) {</span>
<span class="nc" id="L218">			throw new WorkRuleException(&quot;could not parse sentence&quot;);</span>
		}
<span class="nc" id="L220">		catch (SAXException e) {</span>
<span class="nc" id="L221">			throw new WorkRuleException(&quot;could not parse sentence&quot;);</span>
<span class="nc" id="L222">		}</span>
		
<span class="nc" id="L224">		return sParsedString.toString();</span>
	}
	
	private static void traverseParseWorkRule(Node node,Iterator w, HashMap hActivities,HashMap hShifts,
			ClauseCounter N, int nActiveClause, Collection cParsedRule)
	throws WorkRuleException{
<span class="nc" id="L230">		int type = node.getNodeType();</span>
		
<span class="nc bnc" id="L232" title="All 2 branches missed.">		if (node.getNodeName().equals(&quot;Clause&quot;)) {</span>
<span class="nc" id="L233">			N.n++;</span>
<span class="nc bnc" id="L234" title="All 2 branches missed.">			if (N.n &gt; 1)</span>
<span class="nc" id="L235">				cParsedRule.add(new ClauseSeperator(nActiveClause));</span>
		}
<span class="nc bnc" id="L237" title="All 2 branches missed.">		if (type == Node.TEXT_NODE) {</span>
<span class="nc" id="L238">			String sParent = node.getParentNode().getNodeName();</span>
<span class="nc bnc" id="L239" title="All 2 branches missed.">			if (sParent.equals(&quot;Text&quot;))</span>
<span class="nc" id="L240">				cParsedRule.add(node.getNodeValue());</span>
<span class="nc bnc" id="L241" title="All 2 branches missed.">			else if (sParent.equals(&quot;Selector&quot;))</span>
<span class="nc bnc" id="L242" title="All 4 branches missed.">				if (w != null &amp;&amp; N.n == nActiveClause) {</span>
<span class="nc bnc" id="L243" title="All 2 branches missed.">					if (!w.hasNext()) throw new WorkRuleException(&quot;Invalid Rule&quot;);</span>
<span class="nc" id="L244">					WorkRuleParameter pWorkRuleParameter = (WorkRuleParameter)w.next();</span>
<span class="nc" id="L245">					addParameter(node.getParentNode(),pWorkRuleParameter,hActivities,hShifts,cParsedRule);</span>
<span class="nc" id="L246">				}</span>
				else
<span class="nc" id="L248">					addSelector(node.getParentNode(),node.getNodeValue(),hActivities,hShifts,cParsedRule);</span>
		}
<span class="nc" id="L250">		NodeList children = node.getChildNodes();</span>
<span class="nc bnc" id="L251" title="All 2 branches missed.">		if (children != null) {</span>
<span class="nc bnc" id="L252" title="All 2 branches missed.">			for (int i=0; i&lt; children.getLength(); i++)</span>
<span class="nc" id="L253">				traverseParseWorkRule(children.item(i),w,hActivities,hShifts,N,nActiveClause,cParsedRule);</span>
		}
<span class="nc" id="L255">	}</span>
	
	private static void traverseDisplayWorkRule(Node node,Iterator w, HashMap hActivities, HashMap hShifts,
			ClauseCounter N, int nActiveClause, StringBuffer sParsedString, Localizer locale)
	throws WorkRuleException{
<span class="nc" id="L260">		int type = node.getNodeType();</span>
		
<span class="nc bnc" id="L262" title="All 2 branches missed.">		if (node.getNodeName().equals(&quot;Clause&quot;))</span>
<span class="nc" id="L263">			N.n++;</span>
		
<span class="nc bnc" id="L265" title="All 4 branches missed.">		if (N.n == nActiveClause &amp;&amp; type == Node.TEXT_NODE) {</span>
<span class="nc" id="L266">			String sParent = node.getParentNode().getNodeName();</span>
<span class="nc bnc" id="L267" title="All 2 branches missed.">			if (sParent.equals(&quot;Text&quot;)) {</span>
<span class="nc" id="L268">				sParsedString.append(node.getNodeValue());</span>
			}
<span class="nc bnc" id="L270" title="All 2 branches missed.">			else if (sParent.equals(&quot;Selector&quot;)) {</span>
<span class="nc bnc" id="L271" title="All 2 branches missed.">				if (!w.hasNext()) throw new WorkRuleException(&quot;Invalid Rule&quot;);</span>
<span class="nc" id="L272">				sParsedString.append(&quot;&lt;b&gt;&quot;);//we might want to italicize or color the parameters...</span>
<span class="nc" id="L273">				WorkRuleParameter pWorkRuleParameter = (WorkRuleParameter)w.next();</span>
<span class="nc" id="L274">				sParsedString.append(displayParameter(node.getParentNode(),pWorkRuleParameter,hActivities,hShifts,locale));</span>
<span class="nc" id="L275">				sParsedString.append(&quot;&lt;/b&gt;&quot;);</span>
			}
		}
<span class="nc" id="L278">		NodeList children = node.getChildNodes();</span>
<span class="nc bnc" id="L279" title="All 2 branches missed.">		if (children != null) {</span>
<span class="nc bnc" id="L280" title="All 2 branches missed.">			for (int i=0; i&lt; children.getLength(); i++)</span>
<span class="nc" id="L281">				traverseDisplayWorkRule(children.item(i),w,hActivities,hShifts,N,nActiveClause,sParsedString,locale);</span>
		}
<span class="nc" id="L283">	}</span>
	
	private static String displayParameter(Node node, WorkRuleParameter pWorkRuleParameter,
			HashMap hActivities, HashMap hShifts, Localizer locale) throws WorkRuleException{
<span class="nc bnc" id="L287" title="All 8 branches missed.">		switch (pWorkRuleParameter.getType()) {</span>
		case WorkRuleParameter.INT:
<span class="nc" id="L289">			return Integer.toString(pWorkRuleParameter.getIntValue());</span>
		case WorkRuleParameter.DOUBLE:
<span class="nc" id="L291">			return Double.toString(pWorkRuleParameter.getDoubleValue());</span>
		case WorkRuleParameter.WEEKDAY:
<span class="nc" id="L293">			return asWeekDays[pWorkRuleParameter.getWeekDayValue()];</span>
		case WorkRuleParameter.ACTIVITY:
<span class="nc" id="L295">			return ((Activity)hActivities.get(pWorkRuleParameter.getActivityIDValue())).getName();</span>
		case WorkRuleParameter.TIME:
<span class="nc" id="L297">			return pWorkRuleParameter.getTimeValue().toString(RegionalFormatBundleKey.TIME_FORMAT);</span>
		case WorkRuleParameter.PARTOFDAY:
<span class="nc" id="L299">			return asPartsOfDay[pWorkRuleParameter.getIntValue()];</span>
//			case WorkRuleParameter.SHIFT:
//			return ((Shift)hShifts.get(pWorkRuleParameter.getShiftIDValue())).getName();
		case WorkRuleParameter.ELEMENT:
<span class="nc" id="L303">			Collection cSelectorElements = getElements(node.getChildNodes(),pWorkRuleParameter.getIntValue());</span>
<span class="nc bnc" id="L304" title="All 2 branches missed.">			for( Iterator i = cSelectorElements.iterator(); i.hasNext(); ) {</span>
<span class="nc" id="L305">				SelectorElement pElement = (SelectorElement)i.next();</span>
<span class="nc bnc" id="L306" title="All 2 branches missed.">				if (pElement.getSelected())</span>
<span class="nc" id="L307">					return pElement.getName();</span>
<span class="nc" id="L308">			}</span>
<span class="nc" id="L309">			return &quot;&quot;;</span>
		default:
<span class="nc" id="L311">			throw new WorkRuleException(&quot;Unknown Parameter Type&quot;);</span>
		}
	}
	
	private static void addParameter(Node node, WorkRuleParameter pWorkRuleParameter,
			HashMap hActivities, HashMap hShifts, Collection cParsedRule) throws WorkRuleException{
<span class="nc bnc" id="L317" title="All 8 branches missed.">		switch (pWorkRuleParameter.getType()) {</span>
		case WorkRuleParameter.INT:
<span class="nc" id="L319">			cParsedRule.add(new Integer(pWorkRuleParameter.getIntValue()));</span>
<span class="nc" id="L320">			return;</span>
		case WorkRuleParameter.DOUBLE:
<span class="nc" id="L322">			cParsedRule.add(new Double(pWorkRuleParameter.getDoubleValue()));</span>
<span class="nc" id="L323">			return;</span>
		case WorkRuleParameter.WEEKDAY:
<span class="nc" id="L325">			cParsedRule.add(getWeekDayCollection(pWorkRuleParameter.getWeekDayValue()));</span>
<span class="nc" id="L326">			return;</span>
		case WorkRuleParameter.ACTIVITY:
<span class="nc" id="L328">			cParsedRule.add(getActivityCollection(hActivities, pWorkRuleParameter.getActivityIDValue()));</span>
<span class="nc" id="L329">			return;</span>
//			case WorkRuleParameter.SHIFT:
//			cParsedRule.add(getShiftCollection(hShifts, pWorkRuleParameter.getShiftIDValue()));
//			return;
		case WorkRuleParameter.TIME:
<span class="nc" id="L334">			cParsedRule.add(pWorkRuleParameter.getTimeValue());</span>
<span class="nc" id="L335">			return;</span>
		case WorkRuleParameter.PARTOFDAY:
<span class="nc" id="L337">			cParsedRule.add(getPartOfDayCollection(pWorkRuleParameter.getIntValue()));</span>
<span class="nc" id="L338">			return;</span>
		case WorkRuleParameter.ELEMENT:
<span class="nc" id="L340">			cParsedRule.add(getElements(node.getChildNodes(),pWorkRuleParameter.getIntValue()));</span>
<span class="nc" id="L341">			return;</span>
		default:
<span class="nc" id="L343">			throw new WorkRuleException(&quot;Unknown Parameter Type&quot;);</span>
		}
	}
	
	private static void addSelector(Node node, String sSelector, HashMap hActivities,HashMap hShifts,
			Collection cParsedRule) throws WorkRuleException{
<span class="nc bnc" id="L349" title="All 2 branches missed.">		if (sSelector.equals(&quot;int&quot;)) {</span>
<span class="nc" id="L350">			cParsedRule.add(new Integer(0));</span>
<span class="nc" id="L351">			return;</span>
<span class="nc bnc" id="L352" title="All 2 branches missed.">		} else if (sSelector.equals(&quot;double&quot;)) {</span>
<span class="nc" id="L353">			cParsedRule.add(new Double(0));</span>
<span class="nc" id="L354">			return;</span>
<span class="nc bnc" id="L355" title="All 2 branches missed.">		} else if (sSelector.equals(&quot;weekday&quot;)) {</span>
<span class="nc" id="L356">			cParsedRule.add(getWeekDayCollection(-1));</span>
<span class="nc" id="L357">			return;</span>
<span class="nc bnc" id="L358" title="All 2 branches missed.">		} else if (sSelector.equals(&quot;partofday&quot;)) {</span>
<span class="nc" id="L359">			cParsedRule.add(getPartOfDayCollection(-1));</span>
<span class="nc" id="L360">			return;</span>
<span class="nc bnc" id="L361" title="All 2 branches missed.">		} else if (sSelector.equals(&quot;time&quot;)) {</span>
<span class="nc" id="L362">			cParsedRule.add(new TimeOfDay(0));</span>
<span class="nc" id="L363">			return;</span>
<span class="nc bnc" id="L364" title="All 2 branches missed.">		} else if (sSelector.equals(&quot;activity&quot;)) {</span>
<span class="nc" id="L365">			cParsedRule.add(getActivityCollection(hActivities, null));</span>
<span class="nc" id="L366">			return;</span>
//			} else if (sSelector.equals(&quot;shift&quot;)) {
//			cParsedRule.add(getShiftCollection(hShifts, null));
//			return;
<span class="nc bnc" id="L370" title="All 2 branches missed.">		} else if (sSelector.equals(&quot;element&quot;)) {</span>
<span class="nc" id="L371">			cParsedRule.add(getElements(node.getChildNodes(),-1));</span>
<span class="nc" id="L372">			return;</span>
<span class="nc" id="L373">		}else throw new WorkRuleException(&quot;Unknown Parameter Type&quot;);</span>
	}
	
	public static Collection getWeekDayCollection(int nSelectedWeekDay) {
		
<span class="nc" id="L378">		LinkedList llWeekDays = new LinkedList();</span>
		
<span class="nc bnc" id="L380" title="All 2 branches missed.">		for (int i = 1; i &lt;= 7; i++ ) {</span>
<span class="nc bnc" id="L381" title="All 2 branches missed.">			boolean bSelected = (i == nSelectedWeekDay);</span>
<span class="nc" id="L382">			SelectorElement pElement = new SelectorElement(new ID(i),asWeekDays[i],bSelected,</span>
					WorkRuleParameter.WEEKDAY);
<span class="nc" id="L384">			llWeekDays.add(pElement);</span>
		}
<span class="nc" id="L386">		return llWeekDays;</span>
	}
	
	public static Collection getPartOfDayCollection(int nSelectedPartOfDay) {
		
<span class="nc" id="L391">		LinkedList llPartDays = new LinkedList();</span>
		
<span class="nc bnc" id="L393" title="All 2 branches missed.">		for (int i = 0; i &lt; 5; i++ ) {</span>
<span class="nc bnc" id="L394" title="All 2 branches missed.">			boolean bSelected = (i == nSelectedPartOfDay);</span>
<span class="nc" id="L395">			SelectorElement pElement = new SelectorElement(new ID(i),asPartsOfDay[i],bSelected,</span>
					WorkRuleParameter.PARTOFDAY);
<span class="nc" id="L397">			llPartDays.add(pElement);</span>
		}
<span class="nc" id="L399">		return llPartDays;</span>
	}
	
	public static Collection getActivityCollection(HashMap hActivities, ID idSelectedActivity) {
		
<span class="nc" id="L404">		LinkedList llActivities = new LinkedList();</span>
<span class="nc bnc" id="L405" title="All 2 branches missed.">		for( Iterator w = hActivities.values().iterator(); w.hasNext(); ) {</span>
<span class="nc" id="L406">			Activity pActivity = (Activity)w.next();</span>
<span class="nc bnc" id="L407" title="All 4 branches missed.">			boolean bSelected = (idSelectedActivity != null &amp;&amp; pActivity.getID().equals(idSelectedActivity));</span>
<span class="nc" id="L408">			SelectorElement pElement = new SelectorElement(pActivity.getID(),pActivity.getName(),</span>
					bSelected,WorkRuleParameter.ACTIVITY);
<span class="nc" id="L410">			llActivities.add(pElement);</span>
<span class="nc" id="L411">		}</span>
<span class="nc" id="L412">		return llActivities;</span>
	}
	/*
	 public static Collection getShiftCollection(HashMap hShifts, ID idSelectedShift) {
	 
	 LinkedList llShifts = new LinkedList();
	 for( Iterator w = hShifts.values().iterator(); w.hasNext(); ) {
	 Shift pShift = (Shift)w.next();
	 boolean bSelected = (idSelectedShift != null &amp;&amp; pShift.getID().equals(idSelectedShift));
	 SelectorElement pElement = new SelectorElement(pShift.getID(),pShift.getName(),
	 bSelected,WorkRuleParameter.SHIFT);
	 llShifts.add(pElement);
	 }
	 return llShifts;
	 }
	 */
	public static Collection getElements(NodeList children,int nSelected) {
<span class="nc" id="L429">		LinkedList llElements = new LinkedList();</span>
<span class="nc" id="L430">		int nCurrentNode = 1;</span>
<span class="nc bnc" id="L431" title="All 2 branches missed.">		if (children != null)</span>
<span class="nc bnc" id="L432" title="All 2 branches missed.">			for (int i = 0; i &lt; children.getLength(); i++) {</span>
<span class="nc bnc" id="L433" title="All 2 branches missed.">				if (children.item(i).getNodeType() != Node.TEXT_NODE) {</span>
<span class="nc bnc" id="L434" title="All 2 branches missed.">					boolean bSelected = (nCurrentNode == nSelected);</span>
<span class="nc" id="L435">					nCurrentNode++;</span>
<span class="nc" id="L436">					SelectorElement pElement = new SelectorElement(new ID(i),</span>
<span class="nc" id="L437">							children.item(i).getFirstChild().getNodeValue(),bSelected,WorkRuleParameter.ELEMENT);</span>
<span class="nc" id="L438">					llElements.add(pElement);</span>
				}
			}
<span class="nc" id="L441">		return llElements;</span>
	}
	
	/*
	 public static void main(String[] args) {
	 try {
	 
	 WorkRuleTemplate pWorkRuleTemplate5 = new WorkRuleTemplate(new ID(10),
	 &quot;Must Work&quot;,true,true,false,true,
	 &quot;&lt;Clause&gt;&lt;Text&gt; Employees on this team must &lt;/Text&gt; &lt;Selector&gt;element&lt;e&gt;start at the same time&lt;/e&gt;&lt;e&gt;start at the same time on the same days&lt;/e&gt;&lt;e&gt;start and end at the same time&lt;/e&gt;&lt;e&gt;start and end at the same time on the same days&lt;/e&gt;&lt;/Selector&gt;&lt;/Clause&gt;&quot;
	 ,null);
	 
	 EarningType pEarningType = new EarningType(&quot;OT1&quot;,1,true,1.5f,&quot;&quot;);
	 ID idEarningType = new ID(1);
	 HashMap hEarningTypes = new HashMap();
	 hEarningTypes.put(idEarningType,pEarningType);
	 HashMap hShifts = new HashMap();
	 //	Shift pShift = new Shift(new ID(1),&quot;hello&quot;,&quot;&quot;,null,null,null,null,0);
	  //	hShifts.put(idEarningType,pShift);
	   
	   ID idOrganization = null;
	   
	   
	   LocalDate dtStartDate = new LocalDate(1910,1,1,0,0);
	   LocalDate dtEndDate = new LocalDate(1960,1,1,0,0);
	   Locale locale = Locale.getDefault();
	   
	   //create Test WorkRule
	    TreeSet pWorkRuleParameters = new TreeSet();
	    pWorkRuleParameters.add(new WorkRuleParameter(0,WorkRuleParameter.CLAUSE,2));
	    pWorkRuleParameters.add(new WorkRuleParameter(1,WorkRuleParameter.INT,60));
	    pWorkRuleParameters.add(new WorkRuleParameter(2,WorkRuleParameter.INT,80));
	    pWorkRuleParameters.add(new WorkRuleParameter(3,WorkRuleParameter.SHIFT,new ID(1)));
	    
	    Calendar cCurrentTime = Calendar.getInstance();
	    
	    WorkRule pWorkRule = new WorkRule(null,new ID(10),&quot;40 to 60 hours&quot;,
	    idOrganization,dtStartDate,dtEndDate,WorkRule.WORKWEEK,1,idEarningType,
	    WorkRule.NOPAYMODIFICATION,
	    pWorkRuleParameters,1);
	    
	    
	    System.out.println(pWorkRuleTemplate5.getXMLText());
	    //System.out.println(displaySentence(pWorkRule,pWorkRuleTemplate5,null,hEarningTypes,hShifts,locale));
	     
	     Collection cParsedRule = parseSentence(pWorkRule,pWorkRuleTemplate5,null,hShifts,null);
	     for( Iterator i = cParsedRule.iterator(); i.hasNext(); ) {
	     System.out.println(i.next());
	     }
	     
	     cParsedRule = parseSentence(null,pWorkRuleTemplate5,null,hShifts,null);
	     for( Iterator i = cParsedRule.iterator(); i.hasNext(); ) {
	     System.out.println(i.next());
	     }
	     
	     } catch (Exception e) {
	     e.printStackTrace(System.out);
	     }
	     }
	     */  
}

</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>