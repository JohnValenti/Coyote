<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>CampaignServiceDelegate.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.verint.wfm.ws.entityImport.campaign</a> &gt; <span class="el_source">CampaignServiceDelegate.java</span></div><h1>CampaignServiceDelegate.java</h1><pre class="source lang-java linenums">/**
 * @author Eliot Clingman, Copyright (c) 2011, 2017 by Verint Systems, Inc. All Rights Reserved. Campaign Manager Web Service
 *         Delegate
 *
 *         This supports methods to synchronize campaigns between WFO and an external application
 */

package com.verint.wfm.ws.entityImport.campaign;

import java.rmi.RemoteException;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collection;
import java.util.List;
import java.util.Map;
import java.util.TimeZone;

import javax.annotation.PostConstruct;
import javax.annotation.PreDestroy;
import javax.jws.WebMethod;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.jdmo.JdmoException;
import com.bluepumpkin.common.l10n.TimeZoneBundleKey;
import com.bluepumpkin.common.logging.Category;
import com.bluepumpkin.common.util.StringUtil;
import com.bluepumpkin.ejb.bbm.BbmEJBCreateException;
import com.bluepumpkin.ejb.bbm.base.BbmCreateException;
import com.bluepumpkin.ejb.bbm.base.BbmFinderException;
import com.bluepumpkin.ejb.bbm.base.BbmUpdateException;
import com.bluepumpkin.ejb.bbm.campaign.ejb.CampaignManager;
import com.bluepumpkin.ejb.bbm.campaign.model.Campaign;
import com.bluepumpkin.ejb.bbm.dao.MapUtil;
import com.bluepumpkin.ejb.bbm.dao.MapUtil.SystemType;
import com.bluepumpkin.ejb.bbm.vo.validators.ValidatorConstants;
import com.bluepumpkin.ejb.core.Log;
import com.verint.ejb.wfm.WfmManagerFactory;
import com.verint.wfm.ws.ServiceApplicationException;
import com.verint.wfm.ws.entityImport.EntityImportService;
import com.verint.wfm.ws.entityImport.campaign.model.CampaignDTO;
import com.verint.wfm.ws.entityImport.schedulingPeriod.SchedulingPeriodServiceDelegate;
import com.verint.wfm.ws.util.ExternalIDUtil;
import com.verint.wfm.ws.util.MapJAXBType;
import com.verint.wfm.ws.util.SyncUtil;
import com.verint.wfm.ws.util.TimePeriodUtil;

<span class="fc" id="L47">public class CampaignServiceDelegate {</span>
	private static final long serialVersionUID = 1L;

<span class="fc" id="L50">	private static Category CAT = Log.initCategory(CampaignServiceDelegate.class.getName());</span>
<span class="fc" id="L51">	private static int MINUTES_IN_DAY = 60 * 24;</span>
<span class="fc" id="L52">	private CampaignManager m_manager = null;</span>

	public List&lt;CampaignNotPersistedInfo&gt; createOrUpdate(Collection&lt;CampaignDTO&gt; campaignDTOs, String systemTypeName)
			throws ServiceApplicationException {

<span class="nc" id="L57">		SystemType systemType = SystemType.valueOf(systemTypeName);</span>
<span class="nc" id="L58">		CAT.info(&quot;createOrUpdate(): systemType.name(): &quot; + systemType.name());</span>
<span class="nc" id="L59">		List&lt;CampaignNotPersistedInfo&gt; campaignNotPersistedInfos = new ArrayList&lt;CampaignNotPersistedInfo&gt;();</span>
<span class="nc bnc" id="L60" title="All 4 branches missed.">		if (campaignDTOs == null || campaignDTOs.isEmpty()) {</span>
<span class="nc" id="L61">			CAT.debug(&quot;No campaigns to create/update&quot;);</span>
<span class="nc" id="L62">			return campaignNotPersistedInfos;</span>
		}

		// Convert From DTO's to entities so that the EJB layer can handle them
<span class="nc" id="L66">		Collection&lt;Campaign&gt; newCampaigns = new ArrayList&lt;Campaign&gt;();</span>
<span class="nc" id="L67">		Collection&lt;Campaign&gt; oldCampaigns = new ArrayList&lt;Campaign&gt;();</span>
		try {
<span class="nc" id="L69">			convertToEntity(campaignDTOs, systemType, newCampaigns, oldCampaigns, campaignNotPersistedInfos);</span>
<span class="nc" id="L70">			CAT.info(&quot;Succeeded to convert DTOs!&quot;);</span>
<span class="nc" id="L71">		} catch (RuntimeException e) {</span>
<span class="nc" id="L72">			CAT.error(&quot;Unrecoverable system bug while converting DTO to entity Campaign&quot;, e);</span>
<span class="nc" id="L73">			throw new ServiceApplicationException(e);</span>
<span class="nc" id="L74">		}</span>

<span class="nc" id="L76">		CAT.info(&quot;createOrUpdate(): new and old Campaigns.size() resp.: &quot; + newCampaigns.size() + &quot;, &quot; + oldCampaigns.size());</span>
<span class="nc bnc" id="L77" title="All 2 branches missed.">		if (m_manager == null) {</span>
<span class="nc" id="L78">			CAT.error(&quot;In createOrUpdate method: bean manager does not exist&quot;);</span>
		}

		// Create persist the new campaigns
<span class="nc bnc" id="L82" title="All 2 branches missed.">		for (Campaign campaign : newCampaigns) {</span>
			try {
<span class="nc" id="L84">				m_manager.createCampaign(campaign, systemType);</span>
<span class="nc bnc" id="L85" title="All 2 branches missed.">				if (campaign.getID() == null) {</span>
<span class="nc" id="L86">					CAT.error(&quot;campaign.getID() should not be null after being persisted&quot;);</span>
<span class="nc" id="L87">					throw new ServiceApplicationException(&quot;campaign.getID() should not be null after being persisted&quot;);</span>
				}

				// Note: any problem with validity or database state should have been detected by now
				// So any exceptions thrown here are unrecoverable system bugs
				// They are captured separately in case invoked method's contract changes
<span class="nc" id="L93">			} catch (BbmCreateException e) {</span>
<span class="nc" id="L94">				CAT.error(&quot;Failed to create the campaign!&quot;, e);</span>
<span class="nc" id="L95">				throw new ServiceApplicationException(&quot;Failed to create the campaign!&quot;, e);</span>
<span class="nc" id="L96">			} catch (RemoteException e) {</span>
<span class="nc" id="L97">				CAT.error(&quot;There was a communication fault invoking activityManager.createCampaign()&quot;, e);</span>
<span class="nc" id="L98">				throw new ServiceApplicationException(</span>
						&quot;There was a communication fault invoking activityManager.createCampaign()&quot;, e);
<span class="nc" id="L100">			} catch (RuntimeException e) {</span>
<span class="nc" id="L101">				CAT.error(&quot;Failed to create the campaign due to Runtime Exception&quot;, e);</span>
<span class="nc" id="L102">				throw new ServiceApplicationException(&quot;Failed to create the campaign due to Runtime Exception&quot;, e);</span>
<span class="nc" id="L103">			}</span>
<span class="nc" id="L104">		}</span>

		// persist updates for the old campaigns
		try {
<span class="nc" id="L108">			m_manager.updateCampaigns(oldCampaigns);</span>
<span class="nc bnc" id="L109" title="All 2 branches missed.">			for (Campaign campaign : oldCampaigns) {</span>
<span class="nc bnc" id="L110" title="All 2 branches missed.">				if(campaign.getExternalID() != null) {</span>
<span class="nc" id="L111">					ID wfoCampaignSID = MapUtil.getExternalToWfoID(systemType, MapUtil.ObjectType.Campaign,campaign.getExternalID());</span>
<span class="nc bnc" id="L112" title="All 2 branches missed.">					if(wfoCampaignSID == null) {</span>
<span class="nc" id="L113">						m_manager.matchCampaignWithExternalID(campaign,systemType, campaign.getExternalID());</span>
					}
				 }
<span class="nc" id="L116">			}</span>
<span class="nc" id="L117">			CAT.info(&quot;suceeded to update campaigns!&quot;);</span>
<span class="nc" id="L118">		} catch (JdmoException e) {</span>
<span class="nc" id="L119">			CAT.error(&quot;failed to Create/Update Campaign!&quot;, e);</span>
<span class="nc" id="L120">			throw new ServiceApplicationException(e);</span>
<span class="nc" id="L121">		} catch (BbmUpdateException e) {</span>
<span class="nc" id="L122">			CAT.error(&quot;Failed to update the campaign!&quot;, e);</span>
<span class="nc" id="L123">			throw new ServiceApplicationException(&quot;Failed to update the campaign!&quot;, e);</span>
<span class="nc" id="L124">		} catch (RemoteException e) {</span>
<span class="nc" id="L125">			CAT.error(&quot;There was a communication fault invoking campaignManager.updateCampaign()&quot;, e);</span>
<span class="nc" id="L126">			throw new ServiceApplicationException(</span>
					&quot;There was a communication fault invoking campaignManager.updateCampaign)&quot;, e);
<span class="nc" id="L128">		} catch (RuntimeException e) {</span>
<span class="nc" id="L129">			CAT.error(&quot;Failed to update the campaign due to Runtime Exception&quot;, e);</span>
<span class="nc" id="L130">			throw new ServiceApplicationException(&quot;Failed to update the campaign due to Runtime Exception&quot;, e);</span>
<span class="nc" id="L131">		}</span>

<span class="nc" id="L133">		return campaignNotPersistedInfos;</span>
	}

	@WebMethod
	public MapJAXBType areSaved(Collection&lt;String&gt; campaignExternalSourceIds, String systemTypeName)
			throws ServiceApplicationException {
<span class="nc" id="L139">		return SyncUtil.areSaved(campaignExternalSourceIds, systemTypeName, MapUtil.ObjectType.Campaign);</span>
	}

	@PostConstruct
	public void postConstruct() {
		try {
<span class="fc" id="L145">			m_manager = WfmManagerFactory.getCampaignManager();</span>
<span class="fc" id="L146">			CAT.info(&quot;Succeeded to obtain reference to CampaignManager :)&quot;);</span>
<span class="nc" id="L147">		} catch (BbmEJBCreateException e) {</span>
<span class="nc" id="L148">			CAT.error(&quot;Failed to obtain reference to CampaignManager :(&quot;, e);</span>
<span class="fc" id="L149">		}</span>
<span class="fc" id="L150">	}</span>

	@PreDestroy
	public void preDestroy() {
<span class="nc" id="L154">		m_manager = null;</span>
<span class="nc" id="L155">	}</span>

	// ---------------------------------------------------------------------- helpers
	protected void convertToEntity(
			Collection&lt;CampaignDTO&gt; campaignDTOs,
			SystemType systemType,
			Collection&lt;Campaign&gt; newCampaigns,
			Collection&lt;Campaign&gt; oldCampaigns,
			List&lt;CampaignNotPersistedInfo&gt; campaignNotPersistedInfos)
					throws ServiceApplicationException {

		// Clear the external id cache in case its stale
<span class="nc" id="L167">		MapUtil.flushMap(systemType);</span>

		// First pass: get all the campaign external ids, and map them to local ids and load those campaigns that are
		// pushed, as well as the count of SP's
		// We need have the campaigns around to verify that start day of week has not changed
<span class="nc" id="L172">		Collection&lt;ID&gt; campaignExternalSourceIds = new ArrayList&lt;ID&gt;();</span>
<span class="nc bnc" id="L173" title="All 2 branches missed.">		for (CampaignDTO campaignDTO : campaignDTOs) {</span>
<span class="nc bnc" id="L174" title="All 2 branches missed.">			if (!StringUtil.isEmptyOrWhiteSpace(campaignDTO.getExternalSourceId())) {</span>
<span class="nc" id="L175">				campaignExternalSourceIds.add(ExternalIDUtil.buildExternalID(systemType, campaignDTO.getExternalSourceId()));</span>
			}
<span class="nc" id="L177">		}</span>

		Map&lt;ID, ID&gt; campaignExternalIDSIDMap;
		Map&lt;ID, Campaign&gt; campaignSIDBeforeUpdatedCampaignMap;
		Map&lt;ID, Integer&gt; campaignSIDAttachedSchedulingPeriodCountMap;
		try {
<span class="nc" id="L183">			campaignExternalIDSIDMap = MapUtil.getExternalIDMap(</span>
					systemType, MapUtil.ObjectType.Campaign, campaignExternalSourceIds, true);
			// Map external source id to campaign SID for campaigns which exist on RFS and WFO but have not been synched at all
<span class="nc bnc" id="L186" title="All 2 branches missed.">			for(CampaignDTO campaignDTO : campaignDTOs) {</span>
<span class="nc" id="L187">				ID extSourceId = ExternalIDUtil.buildExternalID(systemType, campaignDTO.getExternalSourceId());</span>
<span class="nc bnc" id="L188" title="All 2 branches missed.">				if(!campaignExternalIDSIDMap.containsKey(extSourceId)) {</span>
<span class="nc" id="L189">					ID campaignSID = m_manager.getCampaignIDByName(campaignDTO.getName());</span>
<span class="nc bnc" id="L190" title="All 2 branches missed.">					if(campaignSID != null) {</span>
<span class="nc" id="L191">						campaignExternalIDSIDMap.put(extSourceId, campaignSID);</span>
					}
				}
<span class="nc" id="L194">			}</span>
<span class="nc" id="L195">			campaignSIDBeforeUpdatedCampaignMap = SchedulingPeriodServiceDelegate.getIDCampaignMap(</span>
<span class="nc" id="L196">					m_manager, campaignExternalIDSIDMap.values());</span>
<span class="nc" id="L197">			campaignSIDAttachedSchedulingPeriodCountMap = m_manager.getCampaignSIDAttachedSchedulingPeriodCountMap(</span>
<span class="nc" id="L198">					campaignExternalIDSIDMap.values());</span>
<span class="nc" id="L199">		} catch (JdmoException e) {</span>
<span class="nc" id="L200">			throw new ServiceApplicationException(e);</span>
<span class="nc" id="L201">		} catch (BbmFinderException e) {</span>
<span class="nc" id="L202">			throw new ServiceApplicationException(e);</span>
<span class="nc" id="L203">		} catch (RemoteException e) {</span>
<span class="nc" id="L204">			throw new ServiceApplicationException(e);</span>
<span class="nc" id="L205">		}</span>

<span class="nc" id="L207">		ConvertCampaignDTOMapParameters parameters = new ConvertCampaignDTOMapParameters(</span>
				campaignExternalIDSIDMap,
				campaignSIDBeforeUpdatedCampaignMap,
				campaignSIDAttachedSchedulingPeriodCountMap);
		// Second pass: convert the DTOs to WFO style entities
<span class="nc bnc" id="L212" title="All 2 branches missed.">		for (CampaignDTO campaignDTO : campaignDTOs) {</span>
<span class="nc" id="L213">			convertCampaignDTO(</span>
					systemType,
					campaignDTO,
					campaignNotPersistedInfos,
					newCampaigns,
					oldCampaigns,
					parameters);
<span class="nc" id="L220">		}</span>
<span class="nc" id="L221">	}</span>

	private void convertCampaignDTO(SystemType systemType,
			CampaignDTO campaignDTO,
			List&lt;CampaignNotPersistedInfo&gt; campaignNotPersistedInfos,
			Collection&lt;Campaign&gt; newCampaigns,
			Collection&lt;Campaign&gt; oldCampaigns,
			ConvertCampaignDTOMapParameters mapParameters) {
		// We will create exception info; only add to collection if there is an exception
<span class="nc" id="L230">		CampaignNotPersistedInfo campaignNotPersistedInfo = new CampaignNotPersistedInfo(campaignDTO.getExternalSourceId());</span>

		// Campaign Validation
<span class="nc bnc" id="L233" title="All 2 branches missed.">		if (StringUtil.isEmptyOrWhiteSpace(campaignDTO.getExternalSourceId())) {</span>
<span class="nc" id="L234">			campaignNotPersistedInfo.addExternalIdMissingMessage(campaignDTO.getName());</span>
<span class="nc bnc" id="L235" title="All 2 branches missed.">		} else if (campaignDTO.getExternalSourceId().length() &gt; EntityImportService.EXTERNALID_MAX_LENGTH) {</span>
<span class="nc" id="L236">			campaignNotPersistedInfo.addExternalIdLengthExceededMessage(</span>
<span class="nc" id="L237">					campaignDTO.getExternalSourceId().length(),</span>
					EntityImportService.EXTERNALID_MAX_LENGTH);
		}
<span class="nc bnc" id="L240" title="All 2 branches missed.">		if (StringUtil.isEmptyOrWhiteSpace(campaignDTO.getName())) {</span>
<span class="nc" id="L241">			campaignNotPersistedInfo.addNameMissingMessage();</span>
<span class="nc bnc" id="L242" title="All 2 branches missed.">		} else if (StringUtil.containsInvalidChars(campaignDTO.getName(), ValidatorConstants.INVALID_NAME_CHARS)){</span>
<span class="nc" id="L243">			campaignNotPersistedInfo.addNameHasInvalidCharactersMessage(ValidatorConstants.INVALID_NAME_CHARS);</span>
<span class="nc bnc" id="L244" title="All 2 branches missed.">		} else if (campaignDTO.getName().length() &gt; EntityImportService.NAME_MAX_LENGTH) {</span>
<span class="nc" id="L245">			campaignNotPersistedInfo.addNameLengthExceededMessage(</span>
<span class="nc" id="L246">					campaignDTO.getName().length(),</span>
					EntityImportService.NAME_MAX_LENGTH);
		}

<span class="nc bnc" id="L250" title="All 2 branches missed.">		if (StringUtil.isEmptyOrWhiteSpace(campaignDTO.getTimeZoneId())) {</span>
<span class="nc" id="L251">			campaignNotPersistedInfo.addTimeZoneMissingMessage();</span>
		}else {
			//QC-112257 If the timezone is not present, do not persist the campaign
			//there will be problem persisting it anyways!
<span class="nc" id="L255">			List&lt;String&gt; timezones = Arrays.asList(TimeZoneBundleKey.TIMEZONES);</span>
<span class="nc bnc" id="L256" title="All 2 branches missed.">			if (!timezones.contains(campaignDTO.getTimeZoneId())) {</span>
<span class="nc" id="L257">				campaignNotPersistedInfo.addTimeZoneInvalidMessage(campaignDTO.getTimeZoneId());</span>
			}
		}

<span class="nc bnc" id="L261" title="All 4 branches missed.">		if (campaignDTO.getWeekStart() &lt; 1 || campaignDTO.getWeekStart() &gt; 7) {</span>
<span class="nc" id="L262">			campaignNotPersistedInfo.addWeekStartMessage(campaignDTO.getWeekStart());</span>
		}

<span class="nc bnc" id="L265" title="All 2 branches missed.">		if (!campaignNotPersistedInfo.getMessages().isEmpty()) {</span>
<span class="nc" id="L266">			CAT.error(&quot;User error: Campaign entity will not be persisted&quot;);</span>
<span class="nc" id="L267">			campaignNotPersistedInfos.add(campaignNotPersistedInfo);</span>
		} else {
<span class="nc" id="L269">			final ID campaignExternalSourceID = ExternalIDUtil.buildExternalID(systemType, campaignDTO.getExternalSourceId());</span>
<span class="nc" id="L270">			ID wfoCampaignSID = mapParameters.getCampaignExternalIDSIDMap().get(campaignExternalSourceID);</span>
<span class="nc" id="L271">			CAT.info(&quot;Mapped external id to: &quot; + wfoCampaignSID);</span>

			// construct the native object
<span class="nc" id="L274">			Campaign campaign = new Campaign();</span>
			// TODO don't use this property... its for ultra only... danger... danger
<span class="nc" id="L276">			campaign.setValueObjectExternalID(campaignExternalSourceID);</span>
			// SNAFU: The SID that has only partially replaced ID (DEID) on that entity/table... go figure
<span class="nc" id="L278">			campaign.setID(wfoCampaignSID);</span>

			// remaining properties are straightforward
<span class="nc" id="L281">			campaign.setName(campaignDTO.getName());</span>
<span class="nc" id="L282">			campaign.setDescription(campaignDTO.getDescription());</span>
<span class="nc" id="L283">			String zoneIdString = campaignDTO.getTimeZoneId().replace('\\', '/');</span>
<span class="nc" id="L284">			campaign.setTimeZone(TimeZone.getTimeZone(zoneIdString));</span>
<span class="nc" id="L285">			campaign.setTimeZoneID(ID.fromString(zoneIdString));</span>
<span class="nc" id="L286">			campaign.setWeekStart(dayOfWeekToCampaignWeekStartMinutes(campaignDTO.getWeekStart()));</span>
<span class="nc" id="L287">			campaign.setIsDistributed(campaignDTO.isDistributed());</span>
<span class="nc" id="L288">			campaign.setExternalID(campaignExternalSourceID);</span>

			// sort into new and old
<span class="nc bnc" id="L291" title="All 2 branches missed.">			if (campaign.getID() == null) {</span>
<span class="nc" id="L292">				newCampaigns.add(campaign);</span>
			} else {
				// verify that start day of the week is unchanged when there are attached SPs,
				// otherwise don't perist and return an info
<span class="nc" id="L296">				Campaign beforeUpdatedCampaign = mapParameters.getCampaignSIDBeforeUpdatedCampaignMap().get(campaign.getID());</span>
<span class="nc" id="L297">				Integer schedulingPeriodCount = mapParameters.getCampaignSIDAttachedSchedulingPeriodCountMap().get(campaign.getID());</span>
<span class="nc" id="L298">				if (</span>
<span class="nc bnc" id="L299" title="All 2 branches missed.">						isWeekStartUnchanged(</span>
								campaignNotPersistedInfos,
								campaignNotPersistedInfo,
								campaign,
								beforeUpdatedCampaign,
								schedulingPeriodCount)
<span class="nc bnc" id="L305" title="All 2 branches missed.">						&amp;&amp; isTimeZoneUnchanged(</span>
								campaignNotPersistedInfos,
								campaignNotPersistedInfo,
								campaign,
								beforeUpdatedCampaign,
								schedulingPeriodCount)) {
<span class="nc" id="L311">					oldCampaigns.add(campaign);</span>
				}
			}
		}
<span class="nc" id="L315">	}</span>

	private boolean isWeekStartUnchanged(
			List&lt;CampaignNotPersistedInfo&gt; campaignNotPersistedInfos,
			CampaignNotPersistedInfo campaignNotPersistedInfo,
			Campaign campaign,
			Campaign beforeUpdatedCampaign,
			Integer schedulingPeriodCount) {
<span class="nc bnc" id="L323" title="All 4 branches missed.">		if (schedulingPeriodCount &gt; 0 &amp;&amp; beforeUpdatedCampaign.getWeekStart() != campaign.getWeekStart()) {</span>
<span class="nc" id="L324">			campaignNotPersistedInfo.logAndAddError(</span>
					CAT,
<span class="nc" id="L326">					campaignNotPersistedInfo.getWeekStartUpdateForbiddenMessage(</span>
<span class="nc" id="L327">							TimePeriodUtil.formatToDayAndTime(campaign.getWeekStart()),</span>
<span class="nc" id="L328">							TimePeriodUtil.formatToDayAndTime(beforeUpdatedCampaign.getWeekStart())));</span>
<span class="nc" id="L329">			campaignNotPersistedInfos.add(campaignNotPersistedInfo);</span>
<span class="nc" id="L330">			return false;</span>
		}
<span class="nc" id="L332">		return true;</span>
	}

	private boolean isTimeZoneUnchanged(
			List&lt;CampaignNotPersistedInfo&gt; campaignNotPersistedInfos,
			CampaignNotPersistedInfo campaignNotPersistedInfo,
			Campaign campaign,
			Campaign beforeUpdatedCampaign,
			Integer schedulingPeriodCount) {
<span class="nc bnc" id="L341" title="All 4 branches missed.">		if (schedulingPeriodCount &gt; 0 &amp;&amp; ! beforeUpdatedCampaign.getTimeZone().equals(campaign.getTimeZone())) {</span>
<span class="nc" id="L342">			campaignNotPersistedInfo.logAndAddError(</span>
					CAT,
<span class="nc" id="L344">					campaignNotPersistedInfo.getTimeZoneUpdateForbiddenMessage(</span>
<span class="nc" id="L345">							campaign.getTimeZone().getDisplayName(),</span>
<span class="nc" id="L346">							beforeUpdatedCampaign.getTimeZone().getDisplayName()));</span>
<span class="nc" id="L347">			campaignNotPersistedInfos.add(campaignNotPersistedInfo);</span>
<span class="nc" id="L348">			return false;</span>
		}
<span class="nc" id="L350">		return true;</span>
	}

	public static int dayOfWeekToCampaignWeekStartMinutes(short dayOfWeek) {
<span class="nc" id="L354">		return (dayOfWeek - 1) * MINUTES_IN_DAY;</span>
	}

	public static int campaignWeekStartMinutesToDayOfWeek(int weekStartMinutes) {
<span class="nc" id="L358">		return 1 + (weekStartMinutes / MINUTES_IN_DAY);</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>