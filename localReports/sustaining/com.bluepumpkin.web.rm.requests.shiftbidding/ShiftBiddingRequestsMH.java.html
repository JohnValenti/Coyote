<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>ShiftBiddingRequestsMH.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.rm.requests.shiftbidding</a> &gt; <span class="el_source">ShiftBiddingRequestsMH.java</span></div><h1>ShiftBiddingRequestsMH.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.rm.requests.shiftbidding;

import java.rmi.RemoteException;
import java.util.Collection;
import java.util.HashMap;
import java.util.Map;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.ejb.bbm.base.BbmCreateException;
import com.bluepumpkin.ejb.bbm.base.BbmFinderException;
import com.bluepumpkin.ejb.core.base.MultiUserException;
import com.bluepumpkin.ejb.rm.RmManagerFactory;
import com.bluepumpkin.ejb.rm.base.RmException;
import com.bluepumpkin.ejb.rm.base.RmHardValidationException;
import com.bluepumpkin.ejb.rm.requests.common.ejb.RequestUtil;
import com.bluepumpkin.ejb.rm.requests.common.model.RequestAggregate;
import com.bluepumpkin.ejb.rm.requests.common.model.RequestAuditTrail;
import com.bluepumpkin.ejb.rm.requests.common.model.RequestDetailLevel;
import com.bluepumpkin.ejb.rm.requests.shiftbid.shiftbidrequest.ejb.ShiftBidRequestManager;
import com.bluepumpkin.ejb.rm.requests.shiftbid.shiftbidrequest.model.ShiftBidRequest;
import com.bluepumpkin.web.rm.requests.RequestsMH;

/**
 * Title:        ShiftBiddingRequestsMH
 * Description:  Model Handler for Shift Bidding Requests
 * Copyright:    Copyright (c) 2003
 * Company:      Blue Pumpkin Software, Inc
 * @author       David Su, DSu
 * @version      1.0
 *
 * Created on Aug 19, 2003, 11:20:58 AM
 */
<span class="nc" id="L33">public class ShiftBiddingRequestsMH extends RequestsMH {</span>
	/**
	 * Return Shift Bid Manager
	 *
	 * @return ShiftSwapRequestManager
	 */
	private static ShiftBidRequestManager getSBManager() throws BbmCreateException {
<span class="nc" id="L40">		RmManagerFactory rmf = RmManagerFactory.getInstance();</span>
<span class="nc" id="L41">		return rmf.getShiftBidRequestManager();</span>
	}

	/**
	 * Return Request for a Employee
	 */
	public static Collection getRequestsByEmployee(ID empID, boolean incExpired) throws Exception  {
<span class="nc" id="L48">		ShiftBidRequestManager sbrMgr = RequestUtil.getShiftBidRequestManager(null, null);</span>
<span class="nc" id="L49">		return sbrMgr.getRequestsByEmployee(empID, incExpired, true,</span>
				ShiftBidRequest.DL_EMPLOYEE |
				ShiftBidRequest.DL_AUDIT_TRAIL);
	}

	public static Map&lt;ID, ShiftBidRequest&gt; getRequestMapByIDs(Collection&lt;ID&gt; requestIDs) throws Exception {
<span class="nc" id="L55">		ShiftBidRequestManager sbrMgr = RequestUtil.getShiftBidRequestManager(null, null);</span>
<span class="nc" id="L56">		Map&lt;ID, RequestAggregate&gt; reqAggs = sbrMgr.getRequestMapByIDs(requestIDs, ShiftBidRequest.DL_BASIC);</span>
<span class="nc" id="L57">		Map&lt;ID, ShiftBidRequest&gt; requests = new HashMap&lt;ID, ShiftBidRequest&gt;();</span>
<span class="nc bnc" id="L58" title="All 2 branches missed.">		for (RequestAggregate reqAgg : reqAggs.values()) {</span>
<span class="nc" id="L59">			requests.put(reqAgg.getID(), (ShiftBidRequest) reqAgg);</span>
<span class="nc" id="L60">		}</span>
<span class="nc" id="L61">		return requests;</span>
	}

	/**
	 * Approve Shift Bid Request
	 */
	public static void approveSBRequest(ID requestID, String requestVersion, String comment)
	throws RemoteException, MultiUserException, RmHardValidationException, BbmCreateException, RmException {
<span class="nc" id="L69">		getSBManager().approveRequestByID(requestID, null, requestVersion, comment);</span>
<span class="nc" id="L70">	}</span>

	/**
	 * Deny Shift Bid Request
	 */
	public static void denySBRequest(ID requestID, String requestVersion, String comment)
	throws RemoteException, MultiUserException, RmHardValidationException, BbmCreateException, RmException {
<span class="nc" id="L77">		getSBManager().denyRequestByID(requestID, requestVersion, comment);</span>
<span class="nc" id="L78">	}</span>

	/**
	 * Withdraw approved Shift Bid Request
	 */
	public static void withdrawApprovedSBRequest(ID requestID, String requestType,
			String requestVersion, String requestStatus, String comment)
	throws RemoteException, BbmFinderException, Exception {
<span class="nc" id="L86">		ShiftBidRequest request = (ShiftBidRequest)RmManagerFactory.getInstance().getShiftBidRequestManager().getRequestByID(requestID,</span>
				false, false, ShiftBidRequest.DL_BASIC | ShiftBidRequest.DL_BIDDABLESCHEDULE_IDS
        		| ShiftBidRequest.DL_SHIFT_ASSIGNMENTS_COLL
        		| RequestDetailLevel.DL_INCLUDE_ZERO_NUM_OF_AVAIL_INSTANCES
				);
<span class="nc bnc" id="L91" title="All 2 branches missed.">		if (request.getRequestStatus().equals(RequestAuditTrail.STATUS_APPROVED))</span>
<span class="nc" id="L92">			getSBManager().withdrawApprovedBidRequest(request, comment);</span>
		else
<span class="nc" id="L94">			RequestsMH.changeRequestStatus(requestID, requestType, requestVersion, requestStatus, comment);</span>
<span class="nc" id="L95">	}</span>

	/**
	 * &lt;p&gt;
	 * Gets the number of requests by the employee for the specified list of auctions.
	 * &lt;/p&gt;
	 * &lt;p&gt;
	 * The map's key is the auction ID and the value is the count.
	 * &lt;/p&gt;
	 */
	public static Map&lt;ID, Integer&gt; getRequestCountsForEmployeeAuctions(ID employeeID, Collection&lt;ID&gt; auctionIDs)
			throws BbmCreateException, RmException, RemoteException { // NOSONAR
<span class="nc" id="L107">		ShiftBidRequestManager sbrMgr = RequestUtil.getShiftBidRequestManager(null, null);</span>
<span class="nc" id="L108">		return sbrMgr.getRequestCountsForEmployeeAuctions(employeeID, auctionIDs);</span>
	}

	/**
	 * Updates the preferences for the specified requests.
	 */
	public static void updatePreferences(Collection&lt;ShiftBidRequest&gt; requests) throws Exception {
<span class="nc" id="L115">		ShiftBidRequestManager sbrMgr = RequestUtil.getShiftBidRequestManager(null, null);</span>
<span class="nc" id="L116">		sbrMgr.updatePreferences(requests);</span>
<span class="nc" id="L117">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>