<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>RequestFilingRuleManagerEJB.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.ejb.rm.setup.filingrules.ejb</a> &gt; <span class="el_source">RequestFilingRuleManagerEJB.java</span></div><h1>RequestFilingRuleManagerEJB.java</h1><pre class="source lang-java linenums">/*
 * RequestFilingRuleManagerEJB.java
 * Copyright (c) 2002, Blue Pumpkin Software, Inc.
 * All rights reserved.
 */
package com.bluepumpkin.ejb.rm.setup.filingrules.ejb;

import java.util.Collection;
import java.util.Map;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.logging.Category;
import com.bluepumpkin.ejb.bbm.base.BbmCreateException;
import com.bluepumpkin.ejb.bbm.base.BbmFinderException;
import com.bluepumpkin.ejb.bbm.base.BbmRemoveException;
import com.bluepumpkin.ejb.bbm.base.BbmUpdateException;
import com.bluepumpkin.ejb.core.base.MultiUserException;
import com.bluepumpkin.ejb.core.base.SessionEJBBase; //OUTSIDE_CONTAINER
import com.bluepumpkin.ejb.rm.Log;
import com.bluepumpkin.ejb.rm.requests.common.ejb.RequestUtil;
//import com.bluepumpkin.ejb.rm.requests.common.ejb.SessionEjbBaseForTest; //OUTSIDE_CONTAINER
import com.bluepumpkin.ejb.rm.requests.common.model.Request;
import com.bluepumpkin.ejb.rm.setup.filingrules.model.RequestFilingRule;

/**
 * EJB for RequestFilingRule.
 * This class implements EJB for managing RequestFiling Rules.
 */
<span class="fc" id="L29">public class RequestFilingRuleManagerEJB extends SessionEJBBase { //OUTSIDE_CONTAINER</span>
//public class RequestFilingRuleManagerEJB extends SessionEjbBaseForTest implements RequestFilingRuleManager { //OUTSIDE_CONTAINER
    
<span class="fc" id="L32">    private static Category m_cat = Log.initCategory(</span>
<span class="fc" id="L33">    RequestFilingRuleManagerEJB.class.getName());</span>
    
    /** override the base class to provide the appropriate logging category */
    protected Category getCategory() {
<span class="fc" id="L37">        return m_cat;</span>
    }
    
    {
<span class="fc" id="L41">        super.init( RequestFilingRuleManagerEJB.class.getName() );</span>
<span class="fc" id="L42">    }</span>
    
    
    /**
     * Find the RequestFilingRules for the all parent organization id including
     * OrganizationId passed as argument and returns a collection of
     * RequestFilingRule Object if found.
     * @param pOrganizationId - Organisation ID object.
     * @return Collection A collection of RequestFilingRule Object
     * @throws BbmFinderException if there is an error.
     */
    public Collection findFilingRulesByOrgId(ID pOrganizationId)
    throws BbmFinderException {
<span class="fc" id="L55">        final String methodName = &quot;findFilingRulesByOrgId&quot;;</span>
<span class="fc" id="L56">        methodStart(methodName, pOrganizationId);</span>
        Collection results;
        try {
<span class="fc" id="L59">            results = findFilingRulesByOrgId(pOrganizationId,</span>
            Request.REQUESTTYPE_ALL,
            false,
            null);
<span class="nc" id="L63">        } catch (BbmFinderException e) {</span>
<span class="nc" id="L64">            handleException(e);</span>
<span class="nc" id="L65">            m_cat.error(pOrganizationId, e);</span>
<span class="nc" id="L66">            throw e;</span>
        } finally {
<span class="pc" id="L68">            methodFinish();</span>
<span class="fc" id="L69">        }</span>
<span class="fc" id="L70">        return results;</span>
    }
    
    /**
     * Find the RequestFilingRules for the OrganizationId and request type
     * passed as argument and returns a collection of RequestFilingRule
     * Object if found.
     * @param pOrganizationId - Organisation ID object.
     * @param pRequestType - RequestType.
     * @return Collection A collection of RequestFilingRule Object
     * @throws BbmFinderException if there is an error.
     */
    public Collection findFilingRulesByOrgId(ID pOrganizationId,
    String pRequestType)
    throws BbmFinderException {
<span class="nc" id="L85">        final String methodName = &quot;findFilingRulesByOrgId&quot;;</span>
<span class="nc" id="L86">        methodStart(methodName, pOrganizationId, pRequestType);</span>
        Collection results;
        try {
<span class="nc" id="L89">            results = findFilingRulesByOrgId(pOrganizationId,</span>
            pRequestType,
            false,
            null);
<span class="nc" id="L93">        } catch (BbmFinderException e) {</span>
<span class="nc" id="L94">            handleException(e);</span>
<span class="nc" id="L95">            m_cat.error(pOrganizationId, e);</span>
<span class="nc" id="L96">            throw e;</span>
        } finally {
<span class="nc" id="L98">            methodFinish();</span>
<span class="nc" id="L99">        }</span>
<span class="nc" id="L100">        return results;</span>
    }
    
        /* Find the RequestFilingRules rules for the organization id.
         * @param pOrganizationId- ID object for  organization.
         * @param pRequestType - request type
         * @return Collection of RequestFilingRule objects.
         * @throw BbmFinderException.
         */
    public Collection findEnabledFilingRules(ID pOrganizationId,
    String pRequestType)
    throws BbmFinderException {
        
<span class="nc" id="L113">        final String l_MethodName = &quot;findEnabledFilingRules&quot;;</span>
<span class="nc" id="L114">        methodStart(l_MethodName, pOrganizationId, pRequestType);</span>
        try {
<span class="nc" id="L116">            Collection results = findFilingRulesByOrgId(pOrganizationId,</span>
            pRequestType,
            true,
            null);
<span class="nc" id="L120">            return results;</span>
<span class="nc" id="L121">        } catch (BbmFinderException e) {</span>
<span class="nc" id="L122">            handleException(e);</span>
<span class="nc" id="L123">            m_cat.error(pOrganizationId, e);</span>
<span class="nc" id="L124">            throw e;</span>
        } finally {
<span class="nc" id="L126">            methodFinish();</span>
        }
    }
    
        /* Find the RequestFilingRules rules for the organization id.
         * @param pOrganizatioId - ID object for organization.
         * @param pRequestType - request type
         * @param pActivityId - id of the activity type, can be null
         * @return Collection of RequestFilingRule objects.
         * @throw BbmFinderException.
         */
    public Collection findEnabledFilingRules(ID pOrganizationId,
    String pRequestType,
    ID pActivityId)
    throws BbmFinderException {
        
<span class="fc" id="L142">        final String l_MethodName = &quot;findEnabledFilingRules&quot;;</span>
<span class="fc" id="L143">        methodStart(l_MethodName, pOrganizationId, pRequestType);</span>
        try {
<span class="fc" id="L145">            Collection results = findFilingRulesByOrgId(pOrganizationId, pRequestType,</span>
                    true, pActivityId);
            
<span class="fc" id="L148">            return results;</span>
<span class="nc" id="L149">        } catch (BbmFinderException e) {</span>
<span class="nc" id="L150">            handleException(e);</span>
<span class="nc" id="L151">            m_cat.error(pOrganizationId, e);</span>
<span class="nc" id="L152">            throw e;</span>
        } finally {
<span class="pc" id="L154">            methodFinish();</span>
        }
    }
    
    
    /**
     * Find the RequestFilingRules for the OrganizationId and request type
     * passed as argument and returns a collection of RequestFilingRule
     * Object if found.
     * @param pOrganizationId - Organisation ID object.
     * @param pRequestType - RequestType.
     * @param onlyIfApplied - only returns applied rules if true
     * @param pActivityId - id of the activity type, can be null
     * @return Collection A collection of RequestFilingRule Object
     * @throws BbmFinderException if there is an error.
     */
    public Collection findFilingRulesByOrgId(ID pOrganizationId, String pRequestType, 
            boolean onlyIfApplied, ID pActivityId) throws BbmFinderException {
<span class="fc" id="L172">        final String methodName = &quot;findFilingRulesByOrgId&quot;;</span>
<span class="fc" id="L173">        methodStart(methodName, pOrganizationId, pRequestType);</span>
        Collection results;
        
<span class="fc" id="L176">        RequestFilingRuleDAO dao = null;</span>
        try {
<span class="fc" id="L178">            dao = new RequestFilingRuleDAO();</span>
            
<span class="fc" id="L180">            results = dao.findFilingRules(pOrganizationId,</span>
            pRequestType,
            onlyIfApplied,
            pActivityId);
<span class="nc" id="L184">        } catch (Exception e) {</span>
<span class="nc" id="L185">            handleException(e);</span>
<span class="nc" id="L186">            throw RequestUtil.createBbmFinderExceptionWrapper(e, m_cat);</span>
        } finally {
<span class="pc bpc" id="L188" title="3 of 4 branches missed.">            if (dao != null) dao.cleanUp();</span>
<span class="pc" id="L189">            methodFinish();</span>
<span class="fc" id="L190">        }</span>
<span class="fc" id="L191">        return results;</span>
    }
    
    /**
     * Find the RequestFilingRules for the ID, RequestFilingRuleId passed as argument
     * and returns a RequestFilingRule Object if found.
     * @param pRequestFilingRuleId -  ID for RequestFilingRule object.
     * @return RequestFilingRule - A RequestFilingRule Object
     * @throws BbmFinderException if there is an error.
     */
    public RequestFilingRule findFilingRuleById( ID pRequestFilingRuleId )
    throws BbmFinderException {
<span class="nc" id="L203">        final String methodName = &quot;findFilingRuleById&quot;;</span>
<span class="nc" id="L204">        methodStart(methodName, pRequestFilingRuleId);</span>
        
<span class="nc" id="L206">        RequestFilingRule lRequestFilingRule = null;</span>
        
<span class="nc" id="L208">        RequestFilingRuleDAO dao = new RequestFilingRuleDAO();</span>
        try {
<span class="nc" id="L210">            lRequestFilingRule = dao.findFilingRuleById(pRequestFilingRuleId);</span>
<span class="nc" id="L211">        } catch (Exception e) {</span>
<span class="nc" id="L212">            handleException(e);</span>
<span class="nc" id="L213">            m_cat.error(pRequestFilingRuleId, e);</span>
<span class="nc" id="L214">            throw new BbmFinderException(e);</span>
        } finally {
<span class="nc" id="L216">            methodFinish();</span>
<span class="nc" id="L217">            dao.cleanUp();</span>
<span class="nc" id="L218">        }</span>
<span class="nc" id="L219">        return lRequestFilingRule;</span>
    }
    
    /**
     * update the  RequestFilingRule database with the RequestFilingRule object
     * values passed as argument.
     * @param pRequestFilingRule - RequestFilingRule object.
     * @throws BbmUpdateException if there is an error.
     * @throws MultiUserException if there is an error.
     */
    public void updateFilingRule(RequestFilingRule pRequestFilingRule)
    throws BbmUpdateException, MultiUserException {
<span class="nc" id="L231">        final String methodName = &quot;updateFilingRule&quot;;</span>
<span class="nc" id="L232">        methodStart(methodName, pRequestFilingRule);</span>
<span class="nc" id="L233">        RequestFilingRuleDAO dao = new RequestFilingRuleDAO();</span>
        try {
<span class="nc" id="L235">            dao.updateObject(pRequestFilingRule);</span>
<span class="nc" id="L236">        } catch (Exception e) {</span>
<span class="nc" id="L237">            handleException(e);</span>
<span class="nc" id="L238">            throw RequestUtil.createBbmUpdateExceptionWrapper(e, m_cat);</span>
        } finally {
<span class="nc" id="L240">            methodFinish();</span>
<span class="nc" id="L241">            dao.cleanUp();</span>
<span class="nc" id="L242">        }</span>
<span class="nc" id="L243">    }</span>
    
    /**
     * Delete the RequestFilingRule from database whose ID is passed as argument.
     * @param pRequestFilingRuleId - Id for RequestFilingRule.
     * @throws BbmRemoveException if there is an error.
     */
    public void deleteFilingRule(ID pRequestFilingRuleId)
    throws BbmRemoveException {
<span class="nc" id="L252">        final String methodName = &quot;deleteFilingRule&quot;;</span>
<span class="nc" id="L253">        methodStart(methodName, pRequestFilingRuleId);</span>
<span class="nc" id="L254">        RequestFilingRuleDAO dao = new RequestFilingRuleDAO();</span>
        try {
<span class="nc" id="L256">            dao.deleteObject(pRequestFilingRuleId);</span>
<span class="nc" id="L257">        } catch (BbmRemoveException e) {</span>
<span class="nc" id="L258">            m_cat.error(pRequestFilingRuleId, e);</span>
<span class="nc" id="L259">            handleException(e);</span>
<span class="nc" id="L260">            throw e;</span>
        }  finally {            
<span class="nc" id="L262">            methodFinish();</span>
<span class="nc" id="L263">            dao.cleanUp();</span>
<span class="nc" id="L264">        }</span>
<span class="nc" id="L265">    }</span>
    
    /**
     * creates a new RequestFilingRules from the  RequestFilingRules object
     * passed as argument.
     * @param pOrganizationId -  ID object for organization.
     * @throws BbmCreateException if there is an error.
     */
    public ID createFilingRule( RequestFilingRule pRequestFilingRule)
    throws BbmCreateException {
<span class="fc" id="L275">        final String methodName = &quot;createFilingRule&quot;;</span>
<span class="fc" id="L276">        methodStart(methodName, pRequestFilingRule);</span>
        ID lCreatedID;
<span class="fc" id="L278">        RequestFilingRuleDAO dao = new RequestFilingRuleDAO();</span>
        try {
            //insert record in filing rule table.
<span class="fc" id="L281">            lCreatedID = dao.createObject(pRequestFilingRule);</span>
<span class="nc" id="L282">        } catch (Exception e) {</span>
<span class="nc" id="L283">            handleException(e);</span>
<span class="nc" id="L284">            throw RequestUtil.createBbmCreateExceptionWrapper(e, m_cat);</span>
        } finally {
<span class="pc" id="L286">            methodFinish();</span>
<span class="pc" id="L287">            dao.cleanUp();</span>
<span class="fc" id="L288">        }</span>
<span class="fc" id="L289">        return lCreatedID;</span>
    }
    
    /**
     * Update the applied status for the for the RequestFilingRules
     * whose ids and status pair are passed as Map argument.
     * @param pOrganizationId -  ID object for organization.
     * @param pRequestFilingRuleIDStatus - Map of RequestFilingRuleID
     * (key) and apply status (true or false as value)
     * @throws BbmUpdateException if there is an error.
     * @throws MultiUserException if there is an error.
     * @throws RemoteException if there is an error.
     */
    
    public void saveApplied(ID pOrganizationId, Map pRequestFilingRuleIDStatus)
    throws BbmUpdateException  {
<span class="nc" id="L305">        final String methodName = &quot;saveApplied&quot;;</span>
<span class="nc" id="L306">        methodStart(methodName, pRequestFilingRuleIDStatus);</span>
<span class="nc" id="L307">        AppliedFilingRuleDAO dao = new AppliedFilingRuleDAO();</span>
        try {
<span class="nc" id="L309">            dao.saveAppliedStatus( pOrganizationId,</span>
            pRequestFilingRuleIDStatus);
<span class="nc" id="L311">        } catch (Exception e) {</span>
<span class="nc" id="L312">            handleException(e);</span>
<span class="nc" id="L313">            throw RequestUtil.createBbmUpdateExceptionWrapper(e, m_cat);</span>
        } finally {
<span class="nc" id="L315">            methodFinish();</span>
<span class="nc" id="L316">            dao.cleanUp();</span>
<span class="nc" id="L317">        }</span>
<span class="nc" id="L318">    }</span>
    
    /**
     * Copy an exisitng RequestFilingRule to the organization
     * whose id is passed as the argument.
     * @param pRequestFilingRuleId -  ID object for RequestFilingRule.
     * @param pOrganizationId -  ID object for organization.
     * @throws BbmCreateException if there is an error.
     * @throws BbmFinderException if there is an error.
     */
    public ID copyRequestFilingRule(ID pRequestFilingRuleId, ID OrganizationId)
    throws BbmCreateException, BbmFinderException {
        
<span class="nc" id="L331">        final String methodName = &quot;copyRequestFilingRule&quot;;</span>
<span class="nc" id="L332">        methodStart(methodName, pRequestFilingRuleId, OrganizationId);</span>
        try {
<span class="nc" id="L334">            RequestFilingRule rfr = findFilingRuleById(pRequestFilingRuleId);</span>
<span class="nc" id="L335">            rfr.setID(null);</span>
<span class="nc" id="L336">            rfr.setOrganizationId(OrganizationId);</span>
            // FIXME: this may not be correct. We should copy the applied flag
            // from the source but this data is not stored in the rule
            // so we don't know it. Since we don't know the correct value, we use
            // true as the default.
<span class="nc" id="L341">            rfr.setApplied(true);</span>
<span class="nc" id="L342">            return createFilingRule(rfr);</span>
<span class="nc" id="L343">        } catch (BbmCreateException e) {</span>
<span class="nc" id="L344">            handleException(e);</span>
<span class="nc" id="L345">            m_cat.error(pRequestFilingRuleId, e);</span>
<span class="nc" id="L346">            throw e;</span>
<span class="nc" id="L347">        } catch (Exception  e) {</span>
<span class="nc" id="L348">            handleException(e);</span>
<span class="nc" id="L349">            m_cat.error(pRequestFilingRuleId, e);</span>
<span class="nc" id="L350">            throw new BbmCreateException(e);</span>
        } finally {
<span class="nc" id="L352">            methodFinish();</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>