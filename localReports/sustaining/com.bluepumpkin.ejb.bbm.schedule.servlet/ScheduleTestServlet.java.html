<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>ScheduleTestServlet.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.ejb.bbm.schedule.servlet</a> &gt; <span class="el_source">ScheduleTestServlet.java</span></div><h1>ScheduleTestServlet.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.ejb.bbm.schedule.servlet;

/**
 * &lt;p&gt;Title: Blue Pumpkin Software Basic Business Model&lt;/p&gt;
 * &lt;p&gt;Description: Test Servlet for schedule-related back-end functionality&lt;/p&gt;
 * &lt;p&gt;Copyright: Copyright (c) 2002&lt;/p&gt;
 * &lt;p&gt;Company: Blue Pumpkin Software, inc&lt;/p&gt;
 * @author Greg Fichtenholtz
 * @version 1.0
 */

import java.io.IOException;
import java.io.PrintWriter;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.Collection;
import java.util.Date;
import java.util.HashSet;
import java.util.Iterator;
import java.util.Locale;
import java.util.Random;
import java.util.TimeZone;

import javax.servlet.ServletConfig;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.bluepumpkin.common.base.BPErrorHandling;
import com.bluepumpkin.common.base.BPException;
import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.localization.Localizer;
import com.bluepumpkin.ejb.bbm.BbmManagerFactory;
import com.bluepumpkin.ejb.bbm.activity.ejb.ActivityManager;
import com.bluepumpkin.ejb.bbm.activity.model.Activity;
import com.bluepumpkin.ejb.bbm.activity.model.ActivityCategory;
import com.bluepumpkin.ejb.bbm.activity.model.Event;
import com.bluepumpkin.ejb.bbm.localization.DefaultLocalizationManager;
import com.bluepumpkin.ejb.bbm.schedule.ejb.ScheduleAccessManager;
import com.bluepumpkin.ejb.bbm.schedule.model.CalendarEvent;
import com.bluepumpkin.ejb.bbm.schedule.model.ImportedEvent;
import com.bluepumpkin.ejb.bbm.schedule.model.ShiftAssignment;
import com.bluepumpkin.ejb.bbm.schedule.model.ShiftEventAssignment;
import com.bluepumpkin.ejb.bbm.workresource.ejb.WorkResourceManager;
import com.bluepumpkin.ejb.bbm.workresource.model.Employee;
import com.bluepumpkin.ejb.bbm.workresource.model.Organization;
import com.verint.ejb.wfm.WfmManagerFactory;

<span class="nc" id="L51">public class ScheduleTestServlet extends HttpServlet</span>
{
	/**
	 * 
	 */
	private static final long serialVersionUID = 1L;
	private static final String CONTENT_TYPE = &quot;text/html&quot;;
	private static final String ENCODING = &quot;UTF-8&quot;;
	private static ScheduleAccessManager m_scheduleMgr;
	private WorkResourceManager   m_WorkResourceManager;
	private static ScheduleTestSampleEnvironmentSetup m_envSetup;

	/**Initialize global variables*/
	public void init(ServletConfig config) throws ServletException
	{
<span class="nc" id="L66">		super.init(config);</span>
<span class="nc" id="L67">		synchronized (ScheduleTestServlet.class)</span>
		{
			try
			{
<span class="nc" id="L71">				m_scheduleMgr = WfmManagerFactory.getScheduleAccessManager();</span>
<span class="nc" id="L72">				m_WorkResourceManager = BbmManagerFactory.getWorkResourceManager();</span>
			}
<span class="nc" id="L74">			catch (BPException e)</span>
			{
<span class="nc" id="L76">				e.printStackTrace(System.err);</span>
<span class="nc" id="L77">			}</span>
<span class="nc" id="L78">		}</span>
<span class="nc" id="L79">	}</span>

	/**Process the HTTP Get request*/
	public void doGet(HttpServletRequest request, HttpServletResponse response)
		throws ServletException, IOException
	{
<span class="nc" id="L85">		response.setContentType(CONTENT_TYPE);</span>
<span class="nc" id="L86">		PrintWriter out = response.getWriter();</span>
<span class="nc" id="L87">		out.println(&quot;&lt;html&gt;&quot;);</span>
<span class="nc" id="L88">		out.println(&quot;&lt;head&gt;&lt;title&gt;Blue Pumpkin Schedule Test&lt;/title&gt;&quot;);</span>
<span class="nc" id="L89">		out.println(&quot;&lt;meta http-equiv='expires' content='0'&gt;&quot;);</span>
<span class="nc" id="L90">		out.println(&quot;&lt;meta http-equiv='pragma' content='no-cache'&gt;&quot;);</span>
<span class="nc" id="L91">		out.println(&quot;&lt;/head&gt;&quot;);</span>
<span class="nc" id="L92">		out.println(&quot;&lt;body&gt;&quot;);</span>

<span class="nc" id="L94">		String actionStr = request.getParameter(&quot;action&quot;);</span>
		try
		{
<span class="nc" id="L97">			Localizer localizer = DefaultLocalizationManager.getDefaultInstance().getLocalizer();</span>
<span class="nc bnc" id="L98" title="All 2 branches missed.">			if (actionStr == null)</span>
			{
<span class="nc" id="L100">				printMainPage(out, localizer);</span>
			}
<span class="nc bnc" id="L102" title="All 2 branches missed.">			else if (actionStr.equals(&quot;main&quot;))</span>
			{
<span class="nc" id="L104">				printMainPage(out, localizer);</span>
			}
<span class="nc bnc" id="L106" title="All 2 branches missed.">			else if (actionStr.equals(&quot;getImportEvent&quot;))</span>
			{
<span class="nc" id="L108">				String eventID = request.getParameter(&quot;eventID&quot;);</span>
<span class="nc" id="L109">				printImportEventInfo(out, new ID(eventID));</span>
<span class="nc" id="L110">			}</span>
<span class="nc bnc" id="L111" title="All 2 branches missed.">			else if (actionStr.equals(&quot;getCalendarEvent&quot;))</span>
			{
<span class="nc" id="L113">				String eventID = request.getParameter(&quot;eventID&quot;);</span>
<span class="nc" id="L114">				printCalendarEventInfo(out, new ID(eventID));</span>
<span class="nc" id="L115">			}</span>
<span class="nc bnc" id="L116" title="All 2 branches missed.">			else if (actionStr.equals(&quot;getEventsForEmployee&quot;))</span>
			{
<span class="nc" id="L118">				String empID = request.getParameter(&quot;empID&quot;);</span>
<span class="nc" id="L119">				String strStart =</span>
<span class="nc" id="L120">					java.net.URLDecoder.decode(request.getParameter(&quot;start&quot;),ENCODING);</span>
<span class="nc" id="L121">				String strEnd =</span>
<span class="nc" id="L122">					java.net.URLDecoder.decode(request.getParameter(&quot;end&quot;), ENCODING);</span>
<span class="nc" id="L123">				SimpleDateFormat dateFormat = new SimpleDateFormat(&quot;MM/dd/yyyy&quot;);</span>
<span class="nc" id="L124">				Date dtStart = dateFormat.parse(strStart);</span>
<span class="nc" id="L125">				Date dtEnd = dateFormat.parse(strEnd);</span>
<span class="nc" id="L126">				printEventsForEmployee(out, empID, dtStart, dtEnd);</span>
<span class="nc" id="L127">			}</span>
<span class="nc bnc" id="L128" title="All 2 branches missed.">			else if (actionStr.equals(&quot;createCalendarEvent&quot;))</span>
			{
<span class="nc" id="L130">				String strDescr =</span>
<span class="nc" id="L131">					java.net.URLDecoder.decode(request.getParameter(&quot;descr&quot;), ENCODING);</span>
<span class="nc" id="L132">				String strStart =</span>
<span class="nc" id="L133">					java.net.URLDecoder.decode(request.getParameter(&quot;start&quot;), ENCODING);</span>
<span class="nc" id="L134">				SimpleDateFormat dateFormat = new SimpleDateFormat(&quot;MM/dd/yyyy&quot;);</span>
<span class="nc" id="L135">				Date dtStart = dateFormat.parse(strStart);</span>
<span class="nc" id="L136">				int nDuration = Integer.parseInt(request.getParameter(&quot;duration&quot;));</span>
<span class="nc" id="L137">				printCreateCalendarEvent(out, strDescr, dtStart, nDuration);</span>
<span class="nc" id="L138">			}</span>
<span class="nc bnc" id="L139" title="All 2 branches missed.">			else if (actionStr.equals(&quot;updateCalendarEvent&quot;))</span>
			{
<span class="nc" id="L141">				String eventID = request.getParameter(&quot;eventID&quot;);</span>
<span class="nc" id="L142">				String strDescr =</span>
<span class="nc" id="L143">					java.net.URLDecoder.decode(request.getParameter(&quot;descr&quot;), ENCODING);</span>
<span class="nc" id="L144">				printUpdateCalendarEvent(out, new ID(eventID), strDescr);</span>
<span class="nc" id="L145">			}</span>
<span class="nc bnc" id="L146" title="All 2 branches missed.">			else if (actionStr.equals(&quot;deleteCalendarEvent&quot;))</span>
			{
<span class="nc" id="L148">				String eventID = request.getParameter(&quot;eventID&quot;);</span>
<span class="nc" id="L149">				printDeleteCalendarEvent(out, new ID(eventID));</span>
<span class="nc" id="L150">			}</span>
<span class="nc bnc" id="L151" title="All 2 branches missed.">			else if (actionStr.equals(&quot;setUpEnv&quot;))</span>
			{
<span class="nc" id="L153">				ScheduleTestSampleEnvironmentSetup envSetup =</span>
					new ScheduleTestSampleEnvironmentSetup();
<span class="nc" id="L155">				int nEmployees = Integer.parseInt(request.getParameter(&quot;numemployees&quot;));</span>
<span class="nc" id="L156">				envSetup.setUp(nEmployees);</span>
<span class="nc" id="L157">				m_envSetup = envSetup;</span>
<span class="nc" id="L158">				out.println(&quot;Successfully created sample test environment with following employees:&quot;);</span>
<span class="nc" id="L159">				Employee[] emps = m_envSetup.getEmployees();</span>
<span class="nc bnc" id="L160" title="All 2 branches missed.">				for (int i = 0; i &lt; emps.length; i++)</span>
<span class="nc" id="L161">					out.println(&quot;&lt;BR&gt;&quot; + localizer.formatName(emps[i]));</span>
<span class="nc" id="L162">			}</span>
<span class="nc bnc" id="L163" title="All 2 branches missed.">			else if (actionStr.equals(&quot;createShiftAssignments&quot;))</span>
			{
<span class="nc" id="L165">				int nAssignments = Integer.parseInt(request.getParameter(&quot;numshifts&quot;));</span>
<span class="nc" id="L166">				printCreateShiftAssignments(out, nAssignments);</span>
<span class="nc" id="L167">			}</span>
<span class="nc bnc" id="L168" title="All 2 branches missed.">			else if (actionStr.equals(&quot;getShiftAssignments&quot;))</span>
			{
<span class="nc" id="L170">				String[] employees = request.getParameterValues(&quot;employees&quot;);</span>
<span class="nc" id="L171">				HashSet workResourceIDs = new HashSet();</span>
<span class="nc bnc" id="L172" title="All 2 branches missed.">				for (int i = 0; i &lt; employees.length; i++)</span>
<span class="nc" id="L173">					workResourceIDs.add(new ID(employees[i]));</span>

<span class="nc" id="L175">				printGetShiftAssignments(out, workResourceIDs);</span>
<span class="nc" id="L176">			}</span>
<span class="nc bnc" id="L177" title="All 2 branches missed.">			else if (actionStr.equals(&quot;tearDownEnv&quot;))</span>
			{
<span class="nc" id="L179">				m_envSetup.tearDown();</span>
<span class="nc" id="L180">				out.println(&quot;Sample test environment has been deleted&quot;);</span>
			}
		}
<span class="nc" id="L183">		catch (BPException e)</span>
		{
<span class="nc" id="L185">			out.print(&quot;&lt;pre&gt;&lt;B&gt;&quot;);</span>
<span class="nc" id="L186">			Exception src = e.getCoreException();</span>
<span class="nc bnc" id="L187" title="All 2 branches missed.">			if (src == null)</span>
			{
<span class="nc" id="L189">				out.print(&quot;Failure: &quot; + e.getLocalizedMessage());</span>
<span class="nc" id="L190">				e.printStackTrace(out);</span>
			}
			else
			{
<span class="nc bnc" id="L194" title="All 2 branches missed.">				if (src instanceof BPErrorHandling)</span>
				{
<span class="nc" id="L196">					BPErrorHandling bperr = (BPErrorHandling)src;</span>
<span class="nc" id="L197">					out.println(&quot;Failure: &quot; + bperr.getLocalizedMessage(Locale.getDefault()));</span>
<span class="nc" id="L198">				}</span>
				else
				{
<span class="nc" id="L201">					out.println(&quot;Failure: &quot; + src.getMessage());</span>
				}
			}
<span class="nc" id="L204">			out.println(&quot;&lt;BR&gt;&lt;/B&gt;&lt;/pre&gt;&quot;);</span>
		}
<span class="nc" id="L206">		catch (Exception e)</span>
		{
<span class="nc" id="L208">			out.print(&quot;&lt;pre&gt;&lt;B&gt;&quot;);</span>
<span class="nc" id="L209">			out.println(&quot;Failure: &quot; + e.getMessage());</span>
<span class="nc" id="L210">			e.printStackTrace(out);</span>
<span class="nc" id="L211">			out.println(&quot;&lt;BR&gt;&lt;/B&gt;&lt;/pre&gt;&quot;);</span>
		}
		finally
		{
<span class="nc" id="L215">			printBackToMain(out);</span>
<span class="nc" id="L216">		}</span>
<span class="nc" id="L217">		out.println(&quot;&lt;/body&gt;&lt;/html&gt;&quot;);</span>
<span class="nc" id="L218">	}</span>

	/**Process the HTTP Post request*/
	public void doPost(HttpServletRequest request, HttpServletResponse response)
		throws ServletException, java.io.IOException
	{
<span class="nc" id="L224">		response.sendError(HttpServletResponse.SC_FORBIDDEN);</span>
<span class="nc" id="L225">	}</span>

	private void printMainPage(PrintWriter out, Localizer localzer) throws Exception {
<span class="nc" id="L228">		out.println(&quot;&lt;h3&gt;Choose your action&lt;/h3&gt;&quot;);</span>
<span class="nc" id="L229">		out.println(&quot;&lt;table&gt;&quot;);</span>
<span class="nc" id="L230">		out.println(&quot;&lt;tr&gt;&lt;td&gt;&lt;form method='GET'&gt;&quot;);</span>
<span class="nc" id="L231">		out.println(&quot;&lt;input type='hidden' name='action' value='getImportEvent'&gt;&quot;);</span>
<span class="nc" id="L232">		out.println(&quot;&lt;b&gt;Information about import event&lt;/b&gt; with ID: &quot;);</span>
<span class="nc" id="L233">		out.println(&quot;&lt;input type='text' name='eventID' size='10'&gt;&quot;);</span>
<span class="nc" id="L234">		out.println(&quot;&lt;input type='submit' value='Submit'&gt;&quot;);</span>
<span class="nc" id="L235">		out.println(&quot;&lt;/form&gt;&lt;/td&gt;&lt;/tr&gt;&quot;);</span>
<span class="nc" id="L236">		out.println(&quot;&lt;tr&gt;&lt;td&gt;&lt;form method='GET'&gt;&quot;);</span>
<span class="nc" id="L237">		out.println(&quot;&lt;input type='hidden' name='action' value='getCalendarEvent'&gt;&quot;);</span>
<span class="nc" id="L238">		out.println(&quot;&lt;b&gt;Information about calendar event&lt;/b&gt; with ID: &quot;);</span>
<span class="nc" id="L239">		out.println(&quot;&lt;input type='text' name='eventID' size='10'&gt;&quot;);</span>
<span class="nc" id="L240">		out.println(&quot;&lt;input type='submit' value='Submit'&gt;&quot;);</span>
<span class="nc" id="L241">		out.println(&quot;&lt;/form&gt;&lt;/td&gt;&lt;/tr&gt;&quot;);</span>
<span class="nc" id="L242">		out.println(&quot;&lt;tr&gt;&lt;td&gt;&lt;form method='GET'&gt;&quot;);</span>
<span class="nc" id="L243">		out.println(&quot;&lt;input type='hidden' name='action' value='getEventsForEmployee'&gt;&quot;);</span>
<span class="nc" id="L244">		out.println(&quot;&lt;b&gt;Events for employee&lt;/b&gt; with:&quot;);</span>
<span class="nc" id="L245">		out.println(&quot;&lt;table&gt;&quot;);</span>
<span class="nc" id="L246">		out.println(&quot;&lt;tr&gt;&quot;);</span>
<span class="nc" id="L247">		out.println(&quot;&lt;td&gt;ID&lt;/td&gt;&quot;);</span>
<span class="nc" id="L248">		out.println(&quot;&lt;td&gt;&lt;input type='text' name='empID' size='10'&gt;&lt;/td&gt;&quot;);</span>
<span class="nc" id="L249">		out.println(&quot;&lt;/tr&gt;&quot;);</span>
<span class="nc" id="L250">		out.println(&quot;&lt;tr&gt;&quot;);</span>
<span class="nc" id="L251">		out.println(&quot;&lt;td&gt;Start time&lt;/td&gt;&quot;);</span>
<span class="nc" id="L252">		out.println(&quot;&lt;td&gt;&lt;input type='text' name='start' value='01/01/2000' size='15'&gt;&lt;/td&gt;&quot;);</span>
<span class="nc" id="L253">		out.println(&quot;&lt;/tr&gt;&quot;);</span>
<span class="nc" id="L254">		out.println(&quot;&lt;tr&gt;&quot;);</span>
<span class="nc" id="L255">		out.println(&quot;&lt;td&gt;End time&lt;/td&gt;&quot;);</span>
<span class="nc" id="L256">		out.println(&quot;&lt;td&gt;&lt;input type='text' name='end' value='01/01/2001' size='10'&gt;&lt;/td&gt;&quot;);</span>
<span class="nc" id="L257">		out.println(&quot;&lt;/tr&gt;&quot;);</span>
<span class="nc" id="L258">		out.println(&quot;&lt;/table&gt;&quot;);</span>
<span class="nc" id="L259">		out.println(&quot;&lt;input type='submit' value='Submit'&gt;&quot;);</span>
<span class="nc" id="L260">		out.println(&quot;&lt;/form&gt;&lt;/td&gt;&lt;/tr&gt;&quot;);</span>
<span class="nc" id="L261">		out.println(&quot;&lt;tr&gt;&lt;td&gt;&lt;form method='GET'&gt;&quot;);</span>
<span class="nc" id="L262">		out.println(&quot;&lt;input type='hidden' name='action' value='createCalendarEvent'&gt;&quot;);</span>
<span class="nc" id="L263">		out.println(&quot;&lt;b&gt;Create calendar event &lt;/b&gt;with:&quot;);</span>
<span class="nc" id="L264">		out.println(&quot;&lt;table&gt;&quot;);</span>
<span class="nc" id="L265">		out.println(&quot;&lt;tr&gt;&quot;);</span>
<span class="nc" id="L266">		out.println(&quot;&lt;td&gt;Description &lt;/td&gt;&quot;);</span>
<span class="nc" id="L267">		out.println(&quot;&lt;td&gt;&lt;input type='text' name='descr'&gt;&lt;/td&gt;&quot;);</span>
<span class="nc" id="L268">		out.println(&quot;&lt;/tr&gt;&quot;);</span>
<span class="nc" id="L269">		out.println(&quot;&lt;tr&gt;&quot;);</span>
<span class="nc" id="L270">		out.println(&quot;&lt;td&gt;Start time&lt;/td&gt;&quot;);</span>
<span class="nc" id="L271">		out.println(&quot;&lt;td&gt;&lt;input type='text' name='start' value='01/01/2000' size='15'&gt;&lt;/td&gt;&quot;);</span>
<span class="nc" id="L272">		out.println(&quot;&lt;/tr&gt;&quot;);</span>
<span class="nc" id="L273">		out.println(&quot;&lt;tr&gt;&quot;);</span>
<span class="nc" id="L274">		out.println(&quot;&lt;td&gt;Duration&lt;/td&gt;&quot;);</span>
<span class="nc" id="L275">		out.println(&quot;&lt;td&gt;&lt;input type='text' name='duration' value='60' size='10'&gt;&lt;/td&gt;&quot;);</span>
<span class="nc" id="L276">		out.println(&quot;&lt;/tr&gt;&quot;);</span>
<span class="nc" id="L277">		out.println(&quot;&lt;/table&gt;&quot;);</span>
<span class="nc" id="L278">		out.println(&quot;&lt;input type='submit' value='Submit'&gt;&quot;);</span>
<span class="nc" id="L279">		out.println(&quot;&lt;/form&gt;&lt;/td&gt;&lt;/tr&gt;&quot;);</span>
<span class="nc" id="L280">		out.println(&quot;&lt;tr&gt;&lt;td&gt;&lt;form method='GET'&gt;&quot;);</span>
<span class="nc" id="L281">		out.println(&quot;&lt;b&gt;Shift assignment test:&lt;/b&gt;&quot;);</span>
<span class="nc" id="L282">		out.println(&quot;&lt;table&gt;&quot;);</span>
<span class="nc" id="L283">		out.println(&quot;&lt;tr&gt;&lt;td&gt;&quot;);</span>
<span class="nc" id="L284">		out.println(&quot;&lt;form method='GET'&gt;&quot;);</span>
<span class="nc" id="L285">		out.println(&quot;&lt;input type='hidden' name='action' value='setUpEnv'&gt;&quot;);</span>
<span class="nc" id="L286">		out.println(&quot;Set up sample test environment with &quot;);</span>
<span class="nc" id="L287">		out.println(&quot;&lt;input type='text' name='numemployees' value='3' size='5'&gt;&quot;);</span>
<span class="nc" id="L288">		out.println(&quot; employees&quot;);</span>
<span class="nc" id="L289">		out.println(&quot;&lt;input type='submit' value='Submit'&gt;&quot;);</span>
<span class="nc" id="L290">		out.println(&quot;&lt;/form&gt;&quot;);</span>
<span class="nc" id="L291">		out.println(&quot;&lt;/td&gt;&lt;/tr&gt;&quot;);</span>
<span class="nc" id="L292">		out.println(&quot;&lt;tr&gt;&lt;td&gt;&quot;);</span>
<span class="nc" id="L293">		out.println(&quot;&lt;form method='GET'&gt;&quot;);</span>
<span class="nc" id="L294">		out.println(&quot;&lt;input type='hidden' name='action' value='createShiftAssignments'&gt;&quot;);</span>
<span class="nc" id="L295">		out.println(&quot;Create &quot;);</span>
<span class="nc" id="L296">		out.println(&quot;&lt;input type='text' name='numshifts' value='333' size='5'&gt;&quot;);</span>
<span class="nc" id="L297">		out.println(&quot; shift assignments for each employee&quot;);</span>
<span class="nc" id="L298">		out.println(&quot;&lt;input type='submit' value='Submit'&gt;&quot;);</span>
<span class="nc" id="L299">		out.println(&quot;&lt;/form&gt;&quot;);</span>
<span class="nc" id="L300">		out.println(&quot;&lt;/td&gt;&lt;/tr&gt;&quot;);</span>

<span class="nc" id="L302">		Collection listEmployees =</span>
<span class="nc" id="L303">			m_WorkResourceManager.getEmployees(Organization.ROOT_ORG_ID_OBJ,</span>
																				 null,
																				 Employee.DETAIL_LEVEL_EMPLOYEE_BASIC);
<span class="nc bnc" id="L306" title="All 2 branches missed.">		if (!listEmployees.isEmpty())</span>
		{
<span class="nc" id="L308">			out.println(&quot;&lt;tr&gt;&lt;td&gt;&quot;);</span>
<span class="nc" id="L309">			out.println(&quot;&lt;form method='GET'&gt;&quot;);</span>
<span class="nc" id="L310">			out.println(&quot;&lt;input type='hidden' name='action' value='getShiftAssignments'&gt;&quot;);</span>
<span class="nc" id="L311">			out.println(&quot;Get shift assignments for these employees:&lt;BR&gt;&quot;);</span>
<span class="nc" id="L312">			out.println(&quot;&lt;select size=\&quot;5\&quot; name=\&quot;employees\&quot; multiple&gt;&quot;);</span>
<span class="nc bnc" id="L313" title="All 2 branches missed.">			for (Iterator it = listEmployees.iterator(); it.hasNext(); )</span>
			{
<span class="nc" id="L315">				Employee employee = (Employee)it.next();</span>
<span class="nc" id="L316">				out.print(&quot;&lt;option value='&quot; + employee.getID() + &quot;'&gt;&quot;);</span>
<span class="nc" id="L317">				out.print(localzer.formatName( employee ) );</span>
<span class="nc" id="L318">				out.println(&quot;&lt;/option&gt;&quot;);</span>
<span class="nc" id="L319">			}</span>
<span class="nc" id="L320">			out.println(&quot;&lt;/select&gt;&quot;);</span>
<span class="nc" id="L321">			out.println(&quot;&lt;input type='submit' value='Submit'&gt;&quot;);</span>
<span class="nc" id="L322">			out.println(&quot;&lt;/form&gt;&quot;);</span>
<span class="nc" id="L323">			out.println(&quot;&lt;/td&gt;&lt;/tr&gt;&quot;);</span>
		}
<span class="nc" id="L325">		out.println(&quot;&lt;tr&gt;&lt;td&gt;&quot;);</span>
<span class="nc" id="L326">		out.println(&quot;&lt;form method='GET'&gt;&quot;);</span>
<span class="nc" id="L327">		out.println(&quot;&lt;input type='hidden' name='action' value='tearDownEnv'&gt;&quot;);</span>
<span class="nc" id="L328">		out.println(&quot;&lt;input type='submit' value='Delete Sample Environment'&gt;&quot;);</span>
<span class="nc" id="L329">		out.println(&quot;&lt;/form&gt;&quot;);</span>
<span class="nc" id="L330">		out.println(&quot;&lt;/td&gt;&lt;/tr&gt;&quot;);</span>
<span class="nc" id="L331">		out.println(&quot;&lt;/table&gt;&quot;);</span>
<span class="nc" id="L332">		out.println(&quot;&lt;/form&gt;&lt;/td&gt;&lt;/tr&gt;&quot;);</span>
<span class="nc" id="L333">		out.println(&quot;&lt;/table&gt;&quot;);</span>
<span class="nc" id="L334">	}</span>

	private void printImportEventInfo(PrintWriter out, ID eventID)
		throws Exception
	{
		ImportedEvent event;
<span class="nc" id="L340">		synchronized (ScheduleTestServlet.class)</span>
		{
<span class="nc" id="L342">			event = m_scheduleMgr.getImportedEventByID(eventID);</span>
<span class="nc" id="L343">		}</span>
<span class="nc" id="L344">		out.println(&quot;&lt;h3&gt;Imported Event &quot; + eventID + &quot;&lt;/h3&gt;&quot;);</span>
<span class="nc" id="L345">		out.println(&quot;&lt;table border='1'&gt;&quot;);</span>
<span class="nc" id="L346">		out.println(&quot;&lt;tr&gt;&lt;td&gt;Import Source&lt;/td&gt;&quot;);</span>
<span class="nc" id="L347">		out.println(&quot;&lt;td&gt;&quot; + event.getImportSource() + &quot;&lt;/td&gt;&lt;/tr&gt;&quot;);</span>
<span class="nc" id="L348">		out.println(&quot;&lt;tr&gt;&lt;td&gt;Import Time&lt;/td&gt;&quot;);</span>
<span class="nc" id="L349">		out.println(&quot;&lt;td&gt;&quot; + event.getImportTime() + &quot;&lt;/td&gt;&lt;/tr&gt;&quot;);</span>
<span class="nc" id="L350">		out.println(&quot;&lt;tr&gt;&lt;td&gt;Start time&lt;/td&gt;&quot;);</span>
<span class="nc" id="L351">		out.println(&quot;&lt;td&gt;&quot; + event.getStartTime() + &quot;&lt;/td&gt;&lt;/tr&gt;&quot;);</span>
<span class="nc" id="L352">		out.println(&quot;&lt;tr&gt;&lt;td&gt;End time&lt;/td&gt;&quot;);</span>
<span class="nc" id="L353">		out.println(&quot;&lt;td&gt;&quot; + event.getEndTime() + &quot;&lt;/td&gt;&lt;/tr&gt;&quot;);</span>
<span class="nc" id="L354">		out.println(&quot;&lt;tr&gt;&lt;td&gt;Description&lt;/td&gt;&quot;);</span>
<span class="nc" id="L355">		out.println(&quot;&lt;td&gt;&quot; + event.getDescription() + &quot;&lt;/td&gt;&lt;/tr&gt;&quot;);</span>
<span class="nc" id="L356">		Iterator it = event.getChildren().iterator();</span>
<span class="nc bnc" id="L357" title="All 2 branches missed.">		if (it.hasNext())</span>
		{
<span class="nc" id="L359">			out.println(&quot;&lt;tr&gt;&lt;td&gt;Children&lt;/td&gt;&quot;);</span>
<span class="nc" id="L360">			out.println(&quot;&lt;td&gt;&quot;);</span>
<span class="nc" id="L361">			out.println(&quot;&lt;table&gt;&quot;);</span>
<span class="nc bnc" id="L362" title="All 2 branches missed.">			while (it.hasNext())</span>
			{
<span class="nc" id="L364">				ImportedEvent child = (ImportedEvent)it.next();</span>
<span class="nc" id="L365">				out.print(&quot;&lt;tr&gt;&lt;td&gt;&quot;);</span>
<span class="nc" id="L366">				out.print(&quot;&lt;a href='?action=getImportEvent&amp;eventID=&quot; + child.getID() + &quot;'&gt;&quot;);</span>
<span class="nc" id="L367">				out.print(&quot;Child ID &quot; + child.getID() + &quot;&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;&quot;);</span>
<span class="nc" id="L368">			}</span>
<span class="nc" id="L369">			out.println(&quot;&lt;/table&gt;&quot;);</span>
<span class="nc" id="L370">			out.println(&quot;&lt;/td&gt;&lt;/tr&gt;&quot;);</span>
		}
<span class="nc" id="L372">		out.println(&quot;&lt;/table&gt;&quot;);</span>
<span class="nc" id="L373">	}</span>

	private void printCalendarEventInfo(PrintWriter out, ID eventID)
		throws Exception
	{
		CalendarEvent event;
<span class="nc" id="L379">		synchronized (ScheduleTestServlet.class)</span>
		{
<span class="nc" id="L381">			event =</span>
<span class="nc" id="L382">				(CalendarEvent)m_scheduleMgr.getCalendarEventAssignmentByID(eventID);</span>
<span class="nc" id="L383">		}</span>
<span class="nc" id="L384">		out.println(&quot;&lt;h3&gt;Calendar Event &quot; + eventID + &quot;&lt;/h3&gt;&quot;);</span>
<span class="nc" id="L385">		out.println(&quot;&lt;form method='GET'&gt;&quot;);</span>
<span class="nc" id="L386">		out.println(&quot;&lt;input type='hidden' name='action' value='updateCalendarEvent'&gt;&quot;);</span>
<span class="nc" id="L387">		out.println(&quot;&lt;input type='hidden' name='eventID' value='&quot; + eventID + &quot;'&gt;&quot;);</span>
<span class="nc" id="L388">		out.println(&quot;&lt;table border='1'&gt;&quot;);</span>
<span class="nc" id="L389">		out.println(&quot;&lt;tr&gt;&lt;td&gt;Start time&lt;/td&gt;&quot;);</span>
<span class="nc" id="L390">		out.println(&quot;&lt;td&gt;&lt;input type='text' name='startTime' value='&quot; + event.getStartTime() + &quot;'&gt;&lt;/td&gt;&lt;/tr&gt;&quot;);</span>
<span class="nc" id="L391">		out.println(&quot;&lt;tr&gt;&lt;td&gt;End time&lt;/td&gt;&quot;);</span>
<span class="nc" id="L392">		out.println(&quot;&lt;td&gt;&lt;input type='text' name='endTime' value='&quot; + event.getEndTime() + &quot;'&gt;&lt;/td&gt;&lt;/tr&gt;&quot;);</span>
<span class="nc" id="L393">		out.println(&quot;&lt;tr&gt;&lt;td&gt;Description&lt;/td&gt;&quot;);</span>
<span class="nc" id="L394">		out.println(&quot;&lt;td&gt;&lt;input type='text' name='descr' value='&quot; + event.getDescription() + &quot;'&gt;&lt;/td&gt;&lt;/tr&gt;&quot;);</span>
<span class="nc" id="L395">		out.println(&quot;&lt;/table&gt;&quot;);</span>
<span class="nc" id="L396">		out.println(&quot;&lt;p&gt;&lt;input type='submit' value='Update this event'&gt;&lt;/p&gt;&quot;);</span>
<span class="nc" id="L397">		out.println(&quot;&lt;/form&gt;&quot;);</span>
<span class="nc" id="L398">		out.println(&quot;&lt;form method='GET'&gt;&quot;);</span>
<span class="nc" id="L399">		out.println(&quot;&lt;input type='hidden' name='action' value='deleteCalendarEvent'&gt;&quot;);</span>
<span class="nc" id="L400">		out.println(&quot;&lt;input type='hidden' name='eventID' value='&quot; + eventID + &quot;'&gt;&quot;);</span>
<span class="nc" id="L401">		out.println(&quot;&lt;p&gt;&lt;input type='submit' value='Delete this event'&gt;&lt;/p&gt;&quot;);</span>
<span class="nc" id="L402">		out.println(&quot;&lt;/form&gt;&quot;);</span>
<span class="nc" id="L403">	}</span>

	private void printEventsForEmployee(PrintWriter out,
																			String empID,
																			Date dtStart,
																			Date dtEnd)
		throws Exception
	{
		Collection events;
<span class="nc" id="L412">		synchronized (ScheduleTestServlet.class)</span>
		{
<span class="nc" id="L414">			events = m_scheduleMgr.getEventsForWorkResource(new ID(empID), dtStart, dtEnd);</span>
<span class="nc" id="L415">		}</span>
<span class="nc" id="L416">		out.println(&quot;&lt;h3&gt;Events for employee &quot; + empID + &quot;&lt;/h3&gt;&quot;);</span>
<span class="nc" id="L417">		out.println(&quot;&lt;table&gt;&quot;);</span>
<span class="nc" id="L418">		Iterator it = events.iterator();</span>
<span class="nc bnc" id="L419" title="All 2 branches missed.">		while (it.hasNext())</span>
		{
<span class="nc" id="L421">			out.print(&quot;&lt;tr&gt;&lt;td&gt;&quot;);</span>
<span class="nc" id="L422">			Event event = (Event)it.next();</span>
<span class="nc" id="L423">			int type = event.getEventType();</span>
<span class="nc bnc" id="L424" title="All 2 branches missed.">			if (type == Event.EVENT_TYPE_IMPORTED)</span>
			{
<span class="nc" id="L426">				out.print(&quot;&lt;a href='?action=getImportEvent&amp;eventID=&quot; + event.getID() + &quot;'&gt;&quot;);</span>
<span class="nc" id="L427">				out.print(&quot;Imported Event ID &quot; + event.getID() + &quot;&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;&quot;);</span>
			}
<span class="nc" id="L429">		}</span>
<span class="nc" id="L430">		out.println(&quot;&lt;/table&gt;&quot;);</span>
<span class="nc" id="L431">	}</span>

	private void printCreateCalendarEvent(PrintWriter out,
																				 String strDescr,
																				 Date dtStart,
																				 int nDuration)
		throws Exception
	{
<span class="nc" id="L439">		CalendarEvent event = new CalendarEvent();</span>
<span class="nc" id="L440">		event.setActivityID(new ID(1));</span>
<span class="nc" id="L441">		event.setDescription(strDescr);</span>
<span class="nc" id="L442">		event.setStartTime(dtStart);</span>
<span class="nc" id="L443">		event.setDuration(nDuration);</span>
<span class="nc" id="L444">		event.addWorkResourceID(new ID(1));</span>

		ID eventID;
<span class="nc" id="L447">		synchronized (ScheduleTestServlet.class)</span>
		{
<span class="nc" id="L449">			eventID = m_scheduleMgr.createCalendarEventAssignment(event);</span>
<span class="nc" id="L450">		}</span>
<span class="nc" id="L451">		out.println(&quot;Event with ID &quot; + eventID + &quot; has been successfully created&quot;);</span>
<span class="nc" id="L452">	}</span>

	private void printUpdateCalendarEvent(PrintWriter out,
																				ID eventID,
																				String newDescr)
		throws Exception
	{
<span class="nc" id="L459">		CalendarEvent event = new CalendarEvent();</span>
<span class="nc" id="L460">		event.setID(eventID);</span>
<span class="nc" id="L461">		event.setDescription(newDescr);</span>
<span class="nc" id="L462">		synchronized (ScheduleTestServlet.class)</span>
		{
<span class="nc" id="L464">			m_scheduleMgr.updateCalendarEventAssignment(event);</span>
<span class="nc" id="L465">		}</span>
<span class="nc" id="L466">		out.println(&quot;Event with ID &quot; + eventID + &quot; has been successfully updated&quot;);</span>
<span class="nc" id="L467">	}</span>

	private void printDeleteCalendarEvent(PrintWriter out, ID eventID)
		throws Exception
	{
<span class="nc" id="L472">		ArrayList list = new ArrayList();</span>
<span class="nc" id="L473">		list.add(eventID);</span>
<span class="nc" id="L474">		synchronized (ScheduleTestServlet.class)</span>
		{
<span class="nc" id="L476">			m_scheduleMgr.deleteCalendarEventAssignments(list);</span>
<span class="nc" id="L477">		}</span>
<span class="nc" id="L478">		out.println(&quot;Event with ID &quot; + eventID + &quot; has been successfully deleted&quot;);</span>
<span class="nc" id="L479">	}</span>

	private void printCreateShiftAssignments(PrintWriter out, int nAssignments)
		throws Exception
	{
<span class="nc" id="L484">		Collection listToCreate =</span>
<span class="nc" id="L485">			m_envSetup.getShiftAssignmentsToCreate(nAssignments);</span>

<span class="nc" id="L487">		long lStart = System.currentTimeMillis();</span>
<span class="nc" id="L488">		Collection listCreated =</span>
<span class="nc" id="L489">			m_scheduleMgr.createShiftAssignments(listToCreate);</span>
<span class="nc" id="L490">		long lEnd = System.currentTimeMillis();</span>
<span class="nc" id="L491">		out.println(&quot;Successfully created &quot; + listCreated.size() + &quot; shift assignments.&lt;BR&gt;&quot;);</span>
<span class="nc" id="L492">		out.println(&quot;Operation took &quot; + (lEnd - lStart) + &quot; milliseconds &quot;);</span>
<span class="nc" id="L493">		out.println(&quot;as measured by the Web Tier. To see how long it took &quot;);</span>
<span class="nc" id="L494">		out.println(&quot;the EJB to execute the call, look in the log file(s).&quot;);</span>
<span class="nc" id="L495">	}</span>

	private void printGetShiftAssignments(PrintWriter out, Collection workResourceIDs)
		throws Exception
	{
<span class="nc" id="L500">		Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L501">		cal.set(2000, 1, 1);</span>
<span class="nc" id="L502">		Date dtStart = cal.getTime();</span>
<span class="nc" id="L503">		cal.set(2005, 1, 1);</span>
<span class="nc" id="L504">		Date dtEnd = cal.getTime();</span>

<span class="nc" id="L506">		long lStart = System.currentTimeMillis();</span>
<span class="nc" id="L507">		Collection listEvents =</span>
<span class="nc" id="L508">			m_scheduleMgr.getEventsForWorkResourcesByType(</span>
					Event.EVENT_TYPE_SHIFT_ASSIGNMENT, workResourceIDs, dtStart, dtEnd);
<span class="nc" id="L510">		long lEnd = System.currentTimeMillis();</span>
<span class="nc" id="L511">		out.println(&quot;Successfully retrieved schedules of &quot; + listEvents.size() + &quot; employees.&lt;BR&gt;&quot;);</span>
<span class="nc" id="L512">		out.println(&quot;Operation took &quot; + (lEnd - lStart) + &quot; milliseconds &quot;);</span>
<span class="nc" id="L513">		out.println(&quot;as measured by the Web Tier. To see how long it took &quot;);</span>
<span class="nc" id="L514">		out.println(&quot;the EJB to execute the call, look in the log file(s).&quot;);</span>
<span class="nc" id="L515">	}</span>

	private void printBackToMain(PrintWriter out)
	{
<span class="nc" id="L519">		out.println(&quot;&lt;form method='GET'&gt;&quot;);</span>
<span class="nc" id="L520">		out.println(&quot;&lt;input type='hidden' name='action' value='main'&gt;&quot;);</span>
<span class="nc" id="L521">		out.println(&quot;&lt;p&gt;&lt;input type='submit' value='Back to main page'&gt;&lt;/p&gt;&quot;);</span>
<span class="nc" id="L522">		out.println(&quot;&lt;/form&gt;&quot;);</span>
<span class="nc" id="L523">	}</span>
}

/*****************************************************************************
 * This is a helper class for setting up a sample test environment for the
 * schedule tests
 */
<span class="nc" id="L530">class ScheduleTestSampleEnvironmentSetup</span>
{
	private ActivityManager       m_ActivityManager;
	private WorkResourceManager   m_WorkResourceManager;

	// all of these data members have package access
	private Organization m_org;
	private Activity m_activity;
	private Activity m_activityNonWork;
	private Employee[] m_employees;

	private Random m_random;

	private void createOrganization()
		throws Exception
	{
<span class="nc" id="L546">		m_org = new Organization();</span>
<span class="nc" id="L547">		m_org.setName(&quot;World Headquarters&quot; + m_random.nextLong() );</span>
<span class="nc" id="L548">		m_org.setDescription( &quot;Parent organization for all &quot; );</span>
<span class="nc" id="L549">		m_org.setTimeZone( TimeZone.getTimeZone(&quot;America/Los_Angeles&quot;) );</span>
<span class="nc" id="L550">		m_org.setDayBoundaryOffset(0);</span>
<span class="nc" id="L551">		m_org.setWeekStartDate((short)1);</span>
<span class="nc" id="L552">		m_org.setParentID( Organization.ROOT_ORG_ID_OBJ );</span>
<span class="nc" id="L553">		m_org.setID( m_WorkResourceManager.createOrganization(m_org) );</span>
<span class="nc" id="L554">	}</span>

	private void deleteOrganization()
		throws Exception
	{
<span class="nc" id="L559">		ArrayList ids = new ArrayList();</span>
<span class="nc" id="L560">		ids.add(m_org.getID());</span>
<span class="nc" id="L561">		m_WorkResourceManager.deleteOrganizations(ids);</span>
<span class="nc" id="L562">	}</span>

	private void createActivity()
		throws Exception
	{
		/* first create a work activity */
<span class="nc" id="L568">		m_activity = new Activity();</span>
<span class="nc" id="L569">		m_activity.setName(&quot;Answer Calls &quot; + m_random.nextInt());</span>
<span class="nc" id="L570">		m_activity.setDescription(&quot;This is some kind of work activity&quot;);</span>
<span class="nc" id="L571">		m_activity.setPaid(true);</span>
<span class="nc" id="L572">		m_activity.setOrganizationId(m_org.getID());</span>
<span class="nc" id="L573">		m_activity.setActivityCategoryId(null);</span>
<span class="nc" id="L574">		m_activity.setAdherenceTolerance(0);</span>
		// use a predefined activity category
<span class="nc" id="L576">		m_activity.setActivityCategoryId(ActivityCategory.SYSTEM_DEFINED);</span>
<span class="nc" id="L577">		m_activity.setUsedInShift(true);</span>
<span class="nc" id="L578">		m_activity.setID(m_ActivityManager.createActivity(m_activity));</span>

		/* now create a non-work activity */
<span class="nc" id="L581">		m_activityNonWork = new Activity();</span>
<span class="nc" id="L582">		m_activityNonWork.setName(&quot;Break &quot; + m_random.nextInt());</span>
<span class="nc" id="L583">		m_activityNonWork.setDescription(&quot;This is some kind of non-work activity&quot;);</span>
<span class="nc" id="L584">		m_activityNonWork.setPaid(false);</span>
<span class="nc" id="L585">		m_activityNonWork.setOrganizationId(m_org.getID());</span>
<span class="nc" id="L586">		m_activityNonWork.setActivityCategoryId(null);</span>
<span class="nc" id="L587">		m_activityNonWork.setAdherenceTolerance(0);</span>
		// use a predefined activity category
<span class="nc" id="L589">		m_activityNonWork.setActivityCategoryId(ActivityCategory.SYSTEM_DEFINED);</span>
<span class="nc" id="L590">		m_activityNonWork.setUsedInShift(false);</span>
<span class="nc" id="L591">		m_activityNonWork.setID(m_ActivityManager.createActivity(m_activityNonWork));</span>
<span class="nc" id="L592">	}</span>

	private void deleteActivity()
		throws Exception
	{
<span class="nc" id="L597">		ArrayList arActivities = new ArrayList(2);</span>
<span class="nc" id="L598">		arActivities.add(m_activity);</span>
<span class="nc" id="L599">		arActivities.add(m_activityNonWork);</span>
<span class="nc" id="L600">		m_ActivityManager.deleteActivitiesForTestOnly(arActivities);</span>
<span class="nc" id="L601">	}</span>

	private void createEmployees(int numEmployees)
		throws Exception
	{
<span class="nc" id="L606">		m_employees = new Employee[numEmployees];</span>
<span class="nc" id="L607">		Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L608">		cal.set(2001, 7, 11, 0, 0);</span>
<span class="nc" id="L609">		Date dtStart = cal.getTime();</span>

<span class="nc bnc" id="L611" title="All 2 branches missed.">		for (int i = 0; i &lt; m_employees.length; i++)</span>
		{
<span class="nc" id="L613">			m_employees[i] = new Employee();</span>
<span class="nc" id="L614">			m_employees[i].setStartTime(dtStart);</span>
<span class="nc" id="L615">			m_employees[i].setFirstName(&quot;FirstName&quot; + m_random.nextInt());</span>
<span class="nc" id="L616">			m_employees[i].setLastName(&quot;LastName&quot; + m_random.nextInt());</span>
<span class="nc" id="L617">			m_employees[i].setOrganizationID(m_org.getID());</span>
<span class="nc" id="L618">			m_employees[i].setOrganizationEffectiveDate(dtStart);</span>
<span class="nc" id="L619">			m_employees[i].setID(m_WorkResourceManager.createEmployee(m_employees[i]));</span>
		}
<span class="nc" id="L621">	}</span>

	private void deleteEmployees()
		throws Exception
	{
<span class="nc" id="L626">		ArrayList ids = new ArrayList();</span>
<span class="nc bnc" id="L627" title="All 2 branches missed.">		for (int i = 0; i &lt; m_employees.length; i++)</span>
		{
<span class="nc" id="L629">			ids.add(m_employees[i].getID());</span>
		}
<span class="nc" id="L631">		m_WorkResourceManager.deleteEmployees(ids);</span>
<span class="nc" id="L632">	}</span>

	public Collection getShiftAssignmentsToCreate(int nAssignments)
		throws Exception
	{
<span class="nc" id="L637">		Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L638">		cal.set(2001, 7, 11, 0, 0);</span>
<span class="nc" id="L639">		ArrayList listAssignments = new ArrayList();</span>
<span class="nc bnc" id="L640" title="All 2 branches missed.">		while (nAssignments &gt; 0)</span>
		{
<span class="nc bnc" id="L642" title="All 2 branches missed.">			for (int i = 0; i &lt; m_employees.length; i++)</span>
			{
<span class="nc" id="L644">				ShiftAssignment shiftAssignment = new ShiftAssignment();</span>
<span class="nc" id="L645">				shiftAssignment.setActivityID(m_activity.getID());</span>
<span class="nc" id="L646">				shiftAssignment.addWorkResourceID(m_employees[i].getID());</span>
<span class="nc" id="L647">				String strShiftAssignmentDescr = &quot;Shift Assignment Description&quot;;</span>
<span class="nc" id="L648">				shiftAssignment.setDescription(strShiftAssignmentDescr);</span>
<span class="nc" id="L649">				shiftAssignment.setDuration(480);</span>
<span class="nc" id="L650">				shiftAssignment.setLocked(false);</span>
<span class="nc" id="L651">				Date shiftAssignmentStart = cal.getTime();</span>
<span class="nc" id="L652">				shiftAssignment.setStartTime(shiftAssignmentStart);</span>

				// lets create a shift event assignment (break)
<span class="nc" id="L655">				ShiftEventAssignment aBreak = new ShiftEventAssignment();</span>
<span class="nc" id="L656">				aBreak.addWorkResourceID(m_employees[i].getID());</span>
<span class="nc" id="L657">				aBreak.setActivityID(m_activityNonWork.getID());</span>
<span class="nc" id="L658">				aBreak.setDuration(30);</span>
<span class="nc" id="L659">				aBreak.setLocked(false);</span>
<span class="nc" id="L660">				aBreak.setPaid(false);</span>
<span class="nc" id="L661">				Date breakStart = new Date(shiftAssignmentStart.getTime() + ShiftAssignment.MILLIS_IN_ONE_HOUR * 3);</span>
<span class="nc" id="L662">				aBreak.setStartTime(breakStart);</span>

<span class="nc" id="L664">				shiftAssignment.addShiftEventAssignment(aBreak);</span>
<span class="nc" id="L665">				listAssignments.add(shiftAssignment);</span>
			}
<span class="nc" id="L667">			cal.add(Calendar.DATE, 1);</span>
<span class="nc" id="L668">			nAssignments--;</span>
		}
<span class="nc" id="L670">		return listAssignments;</span>
	}

<span class="nc" id="L673">	public Employee[] getEmployees() { return m_employees; }</span>

	public void setUp(int numEmployees)
		throws Exception
	{
<span class="nc" id="L678">		m_random = new Random(System.currentTimeMillis());</span>
<span class="nc" id="L679">		m_WorkResourceManager = BbmManagerFactory.getWorkResourceManager();</span>
<span class="nc" id="L680">		m_ActivityManager = WfmManagerFactory.getActivityManager();</span>

		 // first, set up the seed data that is needed by all tests
<span class="nc" id="L683">		createOrganization();</span>
<span class="nc" id="L684">		createActivity();</span>
<span class="nc" id="L685">		createEmployees(numEmployees);</span>
<span class="nc" id="L686">	}</span>

	public void tearDown()
		throws Exception
	{
		// now, remove the seed data, we've previously set up
<span class="nc" id="L692">		deleteActivity();</span>
<span class="nc" id="L693">		deleteEmployees();</span>
<span class="nc" id="L694">		deleteOrganization();</span>
<span class="nc" id="L695">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>