<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>AdherenceMapping.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">QA Code Coverage</a> &gt; <a href="index.source.html" class="el_package">com.bluepumpkin.web.am.adherence.mapping</a> &gt; <span class="el_source">AdherenceMapping.java</span></div><h1>AdherenceMapping.java</h1><pre class="source lang-java linenums">package com.bluepumpkin.web.am.adherence.mapping;

import java.util.ArrayList;
import java.util.Collection;

import com.bluepumpkin.common.datatypes.ID;
import com.bluepumpkin.common.util.StringUtil;
import com.bluepumpkin.ejb.bbm.activity.model.Activity;


/**
 * Title:        AdherenceMapping
 * Description:  Value object to hold adherence mapping for one activity
 * Copyright:    Copyright (c) 2001
 * Company:      Blue Pumpkin Software, Inc
 * @author       Shimon Kakon
 * @version 1.0
 */

public class AdherenceMapping {

	private Activity m_activity;
	private Activity[] m_mappedActivities;
	private boolean[] m_isMappedActivitiesEditable;
	//private ID[] m_mappedActivitiesIDs;
	//private String[] m_mappedActivitiesNames;
	//private String[] m_mappedActivitiesDesc;


	// Constants
	public static final String MAPPING_DELIMITER = &quot;, &quot;;

<span class="fc" id="L33">	public AdherenceMapping() {</span>
<span class="fc" id="L34">		m_activity = new Activity();</span>
<span class="fc" id="L35">		m_mappedActivities = new Activity[]{};</span>
<span class="fc" id="L36">		m_isMappedActivitiesEditable = new boolean[]{};</span>
<span class="fc" id="L37">	}</span>

	public AdherenceMapping(Activity activity, Activity[] mappedActivities,
<span class="nc" id="L40">		boolean[] isMappedActivitiesEditable) {</span>

<span class="nc" id="L42">		m_activity = activity;</span>
<span class="nc" id="L43">		m_mappedActivities = mappedActivities;</span>
<span class="nc" id="L44">		m_isMappedActivitiesEditable = isMappedActivitiesEditable;</span>
<span class="nc" id="L45">	}</span>


	public Activity getActivity() {
<span class="fc" id="L49">		return m_activity;</span>
	}

	public void setActivity(Activity activity) {
<span class="fc" id="L53">		m_activity = activity;</span>
<span class="fc" id="L54">	}</span>

	public Activity[] getMappedActivities() {
<span class="fc" id="L57">		return m_mappedActivities;</span>
	}

	public void setMappedActivities(Activity[] mappedActivities) {
<span class="fc" id="L61">		m_mappedActivities = mappedActivities;</span>
<span class="fc" id="L62">	}</span>

	public boolean[] getIsMappedActivitiesEditable() {
<span class="nc" id="L65">		return m_isMappedActivitiesEditable;</span>
	}

	public void setIsMappedActivitiesEditable(boolean[] isMappedActivitiesEditable) {
<span class="fc" id="L69">		m_isMappedActivitiesEditable = isMappedActivitiesEditable;</span>
<span class="fc" id="L70">	}</span>


	public String getMappedActivitiesString() {
<span class="nc" id="L74">		return StringUtil.createDelimitedString(getMappedActivitiesName(),</span>
			MAPPING_DELIMITER);
	}
	
	/**
	 * Get the comma-delimitted string of mapped activities that the user has org scope for.
	 * @param scopedOrgIDs - We will only show the mapped activities that are in this list of orgs.
	 */
	public String getMappedActivitiesString(Collection scopedOrgIDs) {
<span class="fc" id="L83">		return StringUtil.createDelimitedString(getMappedActivitiesName(scopedOrgIDs),</span>
			MAPPING_DELIMITER);
	}

	public String[] getMappedActivitiesName() {
		String[] names;
<span class="pc bpc" id="L89" title="1 of 4 branches missed.">		if(m_mappedActivities != null &amp;&amp; m_mappedActivities.length &gt; 0) {</span>
<span class="fc" id="L90">			names = new String[m_mappedActivities.length];</span>
<span class="fc bfc" id="L91" title="All 2 branches covered.">			for(int i = 0; i &lt; m_mappedActivities.length; i++) {</span>
<span class="pc bpc" id="L92" title="1 of 2 branches missed.">				names[i] = m_mappedActivities[i]==null?&quot;&quot;:m_mappedActivities[i].getName();</span>
			}
		}
		else {
<span class="fc" id="L96">			names = new String[]{};</span>
		}
<span class="fc" id="L98">		return names;</span>
	}
	
	/**
	 * Get the string array of mapped activities that the user has org scope for.
	 * @param scopedOrgIDs - We will only show the mapped activities that are in this list of orgs.
	 */
	public String[] getMappedActivitiesName(Collection scopedOrgIDs) 
	{
<span class="fc" id="L107">		ArrayList namesList = new ArrayList();</span>
<span class="fc" id="L108">		String[] names = new String[]{};</span>
<span class="pc bpc" id="L109" title="1 of 4 branches missed.">		if(m_mappedActivities != null &amp;&amp; m_mappedActivities.length &gt; 0) </span>
		{
<span class="fc bfc" id="L111" title="All 2 branches covered.">			for(int i = 0; i &lt; m_mappedActivities.length; i++) </span>
			{
<span class="fc bfc" id="L113" title="All 2 branches covered.">				if (m_mappedActivities[i] != null)</span>
				{
<span class="pc bpc" id="L115" title="1 of 2 branches missed.">					if (scopedOrgIDs.contains(m_mappedActivities[i].getOrganizationId()))</span>
<span class="fc" id="L116">						namesList.add(m_mappedActivities[i].getName());</span>
				}
			}
			
<span class="fc bfc" id="L120" title="All 2 branches covered.">			if (namesList.size() &gt; 0)</span>
<span class="fc" id="L121">				names = (String[])namesList.toArray(names);</span>
		}
<span class="fc" id="L123">		return names;</span>
	}

	public String[] getMappedActivitiesDesc() {
		String[] desc;
<span class="pc bpc" id="L128" title="1 of 4 branches missed.">		if(m_mappedActivities != null &amp;&amp; m_mappedActivities.length &gt; 0) {</span>
<span class="fc" id="L129">			desc = new String[m_mappedActivities.length];</span>
<span class="fc bfc" id="L130" title="All 2 branches covered.">			for(int i = 0; i &lt; m_mappedActivities.length; i++) {</span>
<span class="pc bpc" id="L131" title="1 of 2 branches missed.">				desc[i] = m_mappedActivities[i]==null?&quot;&quot;:m_mappedActivities[i].getDescription();</span>
			}
		}
		else {
<span class="fc" id="L135">			desc = new String[]{};</span>
		}
<span class="fc" id="L137">		return desc;</span>
	}


	public ID[] getMappedActivitiesIds() {
		ID[] ids;
<span class="pc bpc" id="L143" title="1 of 4 branches missed.">		if(m_mappedActivities != null &amp;&amp; m_mappedActivities.length &gt; 0) {</span>
<span class="fc" id="L144">			ids = new ID[m_mappedActivities.length];</span>
<span class="fc bfc" id="L145" title="All 2 branches covered.">			for(int i = 0; i &lt; m_mappedActivities.length; i++) {</span>
<span class="pc bpc" id="L146" title="1 of 2 branches missed.">				ids[i] = m_mappedActivities[i]==null?null:m_mappedActivities[i].getID();</span>
			}
		}
		else {
<span class="fc" id="L150">			ids = new ID[]{};</span>
		}
<span class="fc" id="L152">		return ids;</span>
	}

	public AdherenceMapping getEditableMapping(ID selectedOrgID) {
<span class="pc bpc" id="L156" title="1 of 2 branches missed.">		if(selectedOrgID.equals(m_activity.getOrganizationId())) {</span>
<span class="nc" id="L157">			return this;</span>
		}
<span class="fc" id="L159">		AdherenceMapping am = new AdherenceMapping();</span>
<span class="fc" id="L160">		am.setActivity(getActivity());</span>
<span class="fc" id="L161">		am.setMappedActivities(getPartialMappedActivities(true));</span>
<span class="fc" id="L162">		return am;</span>
	}

	public AdherenceMapping getNonEditableMapping(ID selectedOrgID) {
<span class="pc bpc" id="L166" title="1 of 2 branches missed.">		if(selectedOrgID.equals(m_activity.getOrganizationId())) {</span>
<span class="nc" id="L167">			return new AdherenceMapping();</span>
		}
<span class="fc" id="L169">		AdherenceMapping am = new AdherenceMapping();</span>
<span class="fc" id="L170">		am.setActivity(getActivity());</span>
<span class="fc" id="L171">		am.setMappedActivities(getPartialMappedActivities(false));</span>
<span class="fc" id="L172">		return am;</span>
	}

	private Activity[] getPartialMappedActivities(boolean editable) {
<span class="pc bpc" id="L176" title="1 of 2 branches missed.">		if(m_mappedActivities == null) {</span>
<span class="nc" id="L177">			return null;</span>
		}

<span class="pc bpc" id="L180" title="1 of 4 branches missed.">		if(m_isMappedActivitiesEditable == null || m_isMappedActivitiesEditable.length == 0) {</span>
<span class="fc" id="L181">			return new Activity[]{};</span>
		}

<span class="fc" id="L184">		ArrayList al = new ArrayList(m_mappedActivities.length);</span>
<span class="fc bfc" id="L185" title="All 2 branches covered.">		for(int i = 0 ; i &lt; m_mappedActivities.length; i++) {</span>
<span class="pc bpc" id="L186" title="1 of 6 branches missed.">			if(m_isMappedActivitiesEditable[i] &amp;&amp; editable &amp;&amp; m_mappedActivities[i]!=null) {</span>
<span class="fc" id="L187">				al.add(m_mappedActivities[i]);</span>
			}
<span class="fc bfc" id="L189" title="All 6 branches covered.">			else if(!m_isMappedActivitiesEditable[i] &amp;&amp; !editable &amp;&amp; m_mappedActivities[i]!=null) {</span>
<span class="fc" id="L190">				al.add(m_mappedActivities[i]);</span>
			}
		}

<span class="fc" id="L194">		return( (Activity[])al.toArray(new Activity[0]) );</span>
	}

	public int getMappedActivitiesCount() {
<span class="fc" id="L198">		return m_mappedActivities.length;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>